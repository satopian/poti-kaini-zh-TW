!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i=n.parcelRequire94c2;i.register("6NgYC",(function(n,r){t(n.exports,"Embed",(function(){return d}));var a=i("3kC7t"),o=i("cijLd");i("jyMxU");var s=i("3C7jC"),l=i("5ngYX"),c=i("gWfkn"),u=i("941rU"),h=i("1mH1z");function d(t){var n,r,d=function(e){try{if(p)throw new Error("Already called openProject");p=!0;var i=new(0,l.SaveReminder)(c.klHistory,!1,!1,(function(){}),(function(){return!!n&&n.isDrawing()}),null,null);n=new(0,s.KlApp)(e,{saveReminder:i,bottomBar:t.bottomBar,aboutEl:t.aboutEl,embed:{url:t.embedUrl,onSubmit:t.onSubmit}}),i.init(),f&&f.parentNode&&f.parentNode.removeChild(f),f=null,m=null,document.body.appendChild(n.getEl())}catch(e){m&&(m.textContent="❌ "+e),f&&(f.className+="loading-screen-error"),console.error(e)}},p=!1,g=[],f=document.getElementById("loading-screen"),m=document.getElementById("loading-screen-text");m&&(m.textContent=(0,h.LANG)("embed-init-waiting")),t.project&&d(t.project),this.openProject=d,this.initError=function(e){m&&(m.textContent="❌ "+e),f&&(f.className+="loading-screen-error")},this.getPNG=function(){if(!n)throw new Error("App not initialized");return n.getPNG()},this.getPSD=(0,a.default)(e(o).mark((function t(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new Error("App not initialized");case 2:return e.next=4,n.getPSD();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),t)}))),this.readPSDs=function(t){if(0!==t.length){var n=function(e){try{var t=r.readPsd(e.blob),n=(0,u.klPsdToKlProject)((0,u.readPsd)(t));e.callback(n)}catch(t){console.error("failed to read psd",t),e.callback(null)}};r?t.forEach(n):(0===g.length&&(0,a.default)(e(o).mark((function t(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i("bxnoy");case 3:r=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),r="error";case 9:for(;g.length;)n(g.shift());case 10:case"end":return e.stop()}}),t,null,[[0,6]])})))(),t.forEach((function(e){g.push(e)})))}}}})),i.register("jyMxU",(function(e,t){if(i("5dg4B"),i("izcMZ"),i("iD0Yt"),i("fIU0v"),"scrollTo"in Element.prototype||Object.defineProperty(Element.prototype,"scrollTo",{value:function(e,t){this.scrollLeft=e,this.scrollTop=t}}),"scrollBy"in Element.prototype||Object.defineProperty(Element.prototype,"scrollBy",{value:function(e,t){this.scrollLeft+=e,this.scrollTop+=t}}),!("localStorage"in window))try{window.localStorage={getItem:function(){return null},setItem:function(){},removeItem:function(){}}}catch(e){}})),i.register("5dg4B",(function(e,t){var n;n=function(){var e=Array.prototype.slice.call(arguments),t=document.createDocumentFragment();e.forEach((function(e){var n=e instanceof Node;t.appendChild(n?e:document.createTextNode(String(e)))})),this.appendChild(t)},[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach((function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:n})}))})),i.register("izcMZ",(function(e,t){var n;n=function(){var e=Array.prototype.slice.call(arguments),t=document.createDocumentFragment();e.forEach((function(e){var n=e instanceof Node;t.appendChild(n?e:document.createTextNode(String(e)))})),this.insertBefore(t,this.firstChild)},[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach((function(e){e.hasOwnProperty("prepend")||Object.defineProperty(e,"prepend",{configurable:!0,enumerable:!0,writable:!0,value:n})}))})),i.register("iD0Yt",(function(e,t){String.prototype.padStart||(String.prototype.padStart=function(e,t){return e>>=0,t=String(t||" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),t.slice(0,e)+String(this))})})),i.register("fIU0v",(function(e,t){Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],r=0;r<n;){var a=t[r];if(e.call(i,a,r,t))return r;r++}return-1}})})),i.register("3C7jC",(function(n,r){t(n.exports,"KlApp",(function(){return k}));var a=i("3kC7t"),o=i("cijLd"),s=i("hrnUX"),l=i("gWfkn"),c=i("eWjiX"),u=i("5ebUJ");i("eK8ID");var h=i("85H3x"),d=i("iUR3L"),p=i("2wCWz"),g=i("3WOmu"),f=i("1mH1z"),m=i("fxAg2"),v=i("2dTGs"),y=i("fuF9j"),x=i("3N9oF"),b=i("adBnR"),B=i("cafM1"),w=i("eIlXd"),C=i("23J3k"),S=i("6l0gQ");function k(t,n){var i,r=this,d=function(e){return 1==e?.5:2==e?.84:3==e?.965:4==e?.9825:5==e?.99125:e},k=function(e){te.emitSize(e),oe&&oe.setCursorSize(2*e)},L=function(e,t,n){function i(e,t){var n=parseInt(e),i=parseInt(t);return n>N&&(i*=N/n,n=N),i>N&&(n*=N/i,i=N),{width:n=parseInt(""+n),height:i=parseInt(""+i)}}function r(e){var n=i(e.width,e.height),r=c.BB.canvas(e.width,e.height);r.getContext("2d").drawImage(e,0,0),c.BB.resizeCanvas(r,n.width,n.height),K.reset({width:n.width,height:n.height,image:r,layerName:t}),Ie.update(0),T(K.getLayer(0)),oe.resetView(),Se.update(oe.getScale(),oe.getAngleDeg()),!1}function a(e,t){function n(e,t,n){t.width=t.width,t.getContext("2d").drawImage(e,-n.x,-n.y),e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(t,0,0)}if(t&&(t.width!==e.width||t.height!==e.height)){var r=c.BB.canvas(t.width,t.height);if(e.width=t.width,e.height=t.height,e.layers||n(e.canvas,r,t),e.layers)for(var a=0;a<e.layers.length;a++){n(e.layers[a].image,r,t)}}var o,s=i(e.width,e.height);if(e.width=s.width,e.height=s.height,e.layers||c.BB.resizeCanvas(e.canvas,e.width,e.height),e.layers)for(var l=0;l<e.layers.length;l++){var u=e.layers[l];c.BB.resizeCanvas(u.image,e.width,e.height)}o=e.layers?K.reset({width:e.width,height:e.height,layers:e.layers}):K.reset({width:e.width,height:e.height,image:e.canvas}),Ie.update(o),T(K.getLayer(o)),oe.resetView(),Se.update(oe.getScale(),oe.getAngleDeg()),!1}function o(e){s.KL.showImportAsLayerDialog({target:X,klCanvas:K,importImage:e,callback:function(n,i){if(n){l.klHistory.pause(!0),K.addLayer();var r=K.getLayers().length-1;t&&K.renameLayer(r,t);var a=K.getLayerContext(r);c.BB.drawTransformedImageWithBounds(a,e,n,null,i),T(K.getLayer(r)),Ie.update(r),l.klHistory.pause(!1),l.klHistory.push({tool:["misc"],action:"importImage",params:[c.BB.copyCanvas(a.canvas),t]})}}})}!e||isNaN(e.width)||isNaN(e.height)||e.width<=0||e.height<=0?s.KL.popup({target:X,type:"error",message:(0,f.LANG)("import-broken-file"),buttons:["Ok"]}):("default"!==n&&n||s.KL.showImportImageDialog({image:e,target:X,maxSize:N,callback:function(e){"as-image"===e.type?r(e.image):"as-image-psd"===e.type?a(e.image,e.cropObj):"as-layer"===e.type?o(e.image):e.type}}),"layer"===n&&o(e.canvas),"image"===n&&("psd"===e.type?a(e):r(e.canvas)))},M=function(e,t){function n(){s.KL.popup({target:X,type:"warning",message:(0,f.LANG)("import-psd-unsupported")+"<br /><br />",buttons:["Ok"]})}for(var i,r=!1,a=0;i=e[a];a++){var o=i.name.split(".");"psd"===(o=o[o.length-1].toLowerCase())?function(i){var r=4096;if(i.size>=1073741824)s.KL.popup({target:X,type:"error",message:"File too big. Unable to import.<br /><br />",buttons:["Ok"]});else{var a,o=1===e.length&&i.size>=26214400,l=!0;o&&s.KL.popup({target:X,message:(0,f.LANG)("import-opening"),callback:function(e){l=!1,a=null},closefunc:function(e){a=e}});var c=new FileReader;c.onload=function(e){s.KL.loadAgPsd().then((function(c){if(!o||l)try{var u;if((u=c.readPsd(e.target.result,{skipLayerImageData:!0,skipThumbnail:!0,skipCompositeImageData:!0})).width>r||u.height>r)return a&&a(),void s.KL.popup({target:X,type:"error",message:(0,f.LANG)("import-psd-too-large").replace(/{x}/g,"4096")+"<br /><br />"+(0,f.LANG)("import-psd-size")+": "+u.width+" x "+u.height+" pixels<br /><br />",buttons:["Ok"]});u=null;try{u=c.readPsd(e.target.result)}catch(e){}if(u){var h=s.KL.PSD.readPsd(u);"image"===t&&h.error&&n(),a&&a(),L(h,i.name,t)}else u=c.readPsd(e.target.result,{skipLayerImageData:!0,skipThumbnail:!0}),"image"===t&&n(),a&&a(),L({type:"psd",width:u.width,height:u.height,canvas:u.canvas,error:!0},i.name,t)}catch(e){a&&a(),s.KL.popup({target:X,type:"error",message:"Failed to load PSD.<br /><br />",buttons:["Ok"]})}})).catch((function(){a(),alert("Error: failed to load PSD library")}))},c.readAsArrayBuffer(i)}}(i):i.type.match("image.*")?function(e){window.URL=window.URL||window.webkitURL;var n=window.URL.createObjectURL(e),i=new Image;i.src=n,c.BB.loadImage(i,(function(){L({type:"image",width:i.width,height:i.height,canvas:i},e.name,t)}))}(i):r=!0}r&&s.KL.popup({target:X,message:(0,f.LANG)("import-unsupported-file"),type:"error",buttons:["OK"]})},E=function(){F<z?(me.getElement().style.display="block",me.setDirection(G),me.isOpen()?("left"===G?(c.BB.css(me.getElement(),{left:"271px",right:""}),c.BB.css(oe.getElement(),{left:"271px"})):(c.BB.css(me.getElement(),{left:"",right:"271px"}),c.BB.css(oe.getElement(),{left:"0"})),de.style.display="block",oe.setSize(Math.max(0,F-V),U),he.setWide(!1)):("left"===G?(c.BB.css(me.getElement(),{left:"0",right:""}),c.BB.css(oe.getElement(),{left:"0"})):(c.BB.css(me.getElement(),{left:"",right:"0"}),c.BB.css(oe.getElement(),{left:"0"})),de.style.display="none",oe.setSize(Math.max(0,F),U),he.setWide(!0))):(me.getElement().style.display="none","left"===G?c.BB.css(oe.getElement(),{left:"271px"}):c.BB.css(oe.getElement(),{left:"0"}),de.style.display="block",oe.setSize(Math.max(0,F-V),U),he.setWide(!1))},A=function(){"left"===G?(c.BB.css(de,{left:"0",right:"",borderLeft:"none",borderRight:"1px solid rgb(135, 135, 135)"}),c.BB.css(oe.getElement(),{left:"271px"})):(c.BB.css(de,{left:"",right:"0",borderLeft:"1px solid rgb(135, 135, 135)",borderRight:"none"}),c.BB.css(oe.getElement(),{left:"0"})),he.setUiState(G),Re.setUiState(""+G),Ie.setUiState(""+G),E(),je.updateUiState(G)},T=function(e){ee=e.context,Q.setContext(e.context),Re.setLayer(e)},I=function(){s.KL.newImageDialog({currentColor:$,secondaryColor:ve.getSecondaryRGB(),maxCanvasSize:N,canvasWidth:K.getWidth(),canvasHeight:K.getHeight(),workspaceWidth:window.innerWidth<z?F:F-V,workspaceHeight:U,onConfirm:function(e,t,n){K.reset({width:e,height:t,color:1===n.a?n:null}),Ie.update(0),T(K.getLayer(0)),oe.resetView(),Se.update(oe.getScale(),oe.getAngleDeg()),!1},onCancel:function(){}})},R=function(e){c.BB.shareCanvas({canvas:K.getCompleteCanvas(1),fileName:c.BB.getDate()+j+".png",title:c.BB.getDate()+j+".png",callback:e||function(){}})},P=function(){if(W)for(var e=ye.getActive(),t=W.getOpenedTabId(),n=Object.keys({draw:{},hand:{},fill:{},gradient:{},text:{},shape:{}}),i=0;i<n.length;i++)e===n[i]?W.setIsVisible(n[i],!0):(W.setIsVisible(n[i],!1),t===n[i]&&W.open(e))},O=function(e){s.KL.clipboardDialog(X,K.getCompleteCanvas(1),(function(e){0===e.left&&0===e.right&&0===e.top&&0===e.bottom||(s.KL.filterLib.cropExtend.apply({context:ee,klCanvas:K,input:e,history:l.klHistory}),Ie.update(),oe.resetView(),Se.update(oe.getScale(),oe.getAngleDeg()))}),he,e)},D=function(){if(n.bottomBar){var e=617<window.innerHeight&&pe.scrollHeight+50<window.innerHeight;Ge.style.display=e?"":"none"}},N=Math.min(4096,Math.max(2048,Math.max(window.screen.width,window.screen.height))),z=820,G=n.embed?"left":S.LocalStorage.getItem("uiState")?S.LocalStorage.getItem("uiState"):"right",j=(null===(i=n.app)||void 0===i?void 0:i.filenameBase)?n.app.filenameBase:"Klecks",H=n.projectStore,X=document.createElement("div");X.className="g-root";var F=Math.max(0,window.innerWidth),U=Math.max(0,window.innerHeight),V=271,Y="png",K=new s.KL.KlCanvas(t?{projectObj:t}:{width:Math.max(10,Math.min(N,window.innerWidth<z?F:F-V)),height:Math.max(10,Math.min(N,U))},n.embed?-1:0);K.setHistory(l.klHistory);var W,_=null;n.saveReminder||(n.saveReminder={init:function(){},reset:function(){}});t?(t.layers.forEach((function(e){e.image=null})),t=null):(l.klHistory.pause(!0),K.addLayer(),K.layerFill(0,{r:255,g:255,b:255}),l.klHistory.pause(!1));try{_={canvas:new s.KL.KlCanvas({copy:K},n.embed?-1:0),focus:K.getLayerCount()-1,brushes:{}}}catch(e){throw"kl-create-canvas-error"===e.message&&K.destroy(),e}for(var q in s.KL.brushes)s.KL.brushes.hasOwnProperty(q)&&(_.brushes[q]=new s.KL.brushes[q],_.canvas&&_.brushes[q].setContext(_.canvas.getLayerContext(_.focus)));var Q,J,Z,$=new c.BB.RGB(0,0,0),ee=K.getLayerContext(K.getLayerCount()-1),te=new s.KL.BrushSettingService((function(e){ve.setColor(e),Q.setColor(e),$=c.BB.copyObj(e)}),(function(e){Q.setSize(e),oe.setCursorSize(2*e)}),(function(e){Q.setOpacity(e)}),(function(){return ve.getColor()}),(function(){return le[J].getSize()}),(function(){return le[J].getOpacity()}),(function(){return{sizeSlider:s.KL.brushesUI[J].sizeSlider,opacitySlider:s.KL.brushesUI[J].opacitySlider}})),ne=new c.BB.EventChain.LineSmoothing({smoothing:d(1)}),ie=new c.BB.EventChain.LineSanitizer,re=new c.BB.EventChain.EventChain({chainArr:[ie,ne]});re.setChainOut((function(e){"down"===e.type&&(de.style.pointerEvents="none",Q.startLine(e.x,e.y,e.pressure),oe.requestFrame()),"move"===e.type&&(Q.goLine(e.x,e.y,e.pressure,!1,e.isCoalesced),oe.setLastDrawEvent(e.x,e.y,e.pressure),oe.requestFrame()),"up"===e.type&&(de.style.pointerEvents="",Q.endLine(),oe.requestFrame()),"line"===e.type&&(Q.getBrush().drawLineSegment(e.x0,e.y0,e.x1,e.y1),oe.requestFrame())}));var ae={size:20,align:"left",isBold:!1,isItalic:!1,font:"sans-serif",opacity:1},oe=new s.KL.KlCanvasWorkspace({klCanvas:K,width:Math.max(0,F-V),height:U,onDraw:re.chainIn,onPick:function(e,t){te.setColor(e),t&&(ve.pickingDone(),oe.setMode(ye.getActive()))},onFill:function(e,t){var n=K.getLayerIndex(ee.canvas);K.floodFill(n,e,t,ke.getIsEraser()?null:ve.getColor(),ke.getOpacity(),ke.getTolerance(),ke.getSample(),ke.getGrow(),ke.getContiguous()),oe.requestFrame()},onGradient:function(e,t,n,i){"down"===e&&Ae.onDown(t,n,i),"move"===e&&Ae.onMove(t,n),"up"===e&&Ae.onUp(t,n)},onText:function(e,t,n){s.KL.dialogCounter.get()>0||s.KL.textToolDialog({klCanvas:K,layerIndex:K.getLayerIndex(ee.canvas),x:e,y:t,angleRad:n,color:ve.getColor(),secondaryColor:ve.getSecondaryRGB(),size:ae.size,align:ae.align,isBold:ae.isBold,isItalic:ae.isItalic,font:ae.font,opacity:ae.opacity,onConfirm:function(e){var t=e.color;t.a=e.opacity,ae.size=e.size,ae.align=e.align,ae.isBold=e.isBold,ae.isItalic=e.isItalic,ae.font=e.font,ae.opacity=e.opacity;var i=K.getLayerIndex(ee.canvas);K.text(i,{textStr:e.textStr,x:e.x,y:e.y,size:e.size,font:e.font,align:e.align,isBold:e.isBold,isItalic:e.isItalic,angleRad:n,color:c.BB.ColorConverter.toRgbaStr(t)}),oe.requestFrame()}})},onShape:function(e,t,n,i){"down"===e&&Te.onDown(t,n,i),"move"===e&&Te.onMove(t,n),"up"===e&&Te.onUp(t,n)},onViewChange:function(e){e.changed.includes("scale")&&he.out({type:"transform",scale:e.scale,angleDeg:180*e.angle/Math.PI}),ye.setEnableZoomIn(e.scale!==oe.getMaxScale()),ye.setEnableZoomOut(e.scale!==oe.getMinScale()),Se.update(e.scale,180*e.angle/Math.PI)},onUndo:function(){l.klHistory.canUndo()&&Oe.undo()&&he.out((0,f.LANG)("undo"),!0)},onRedo:function(){l.klHistory.canRedo()&&Oe.redo()&&he.out((0,f.LANG)("redo"),!0)}}),se=new c.BB.KeyListener({onDown:function(t,i,r){if(!(s.KL.dialogCounter.get()>0||c.BB.isInputFocused(!0))&&!(ie.getIsDrawing()||oe.getIsDrawing())){if("plus"===r&&oe.zoomByStep(se.isPressed("shift")?1/8:.5),"minus"===r&&oe.zoomByStep(se.isPressed("shift")?-1/8:-.5),"home"===r&&oe.fitView(),"end"===r&&oe.resetView(!0),["ctrl+z","cmd+z"].includes(r)&&(i.preventDefault(),Oe.undo()),(["ctrl+y","cmd+y"].includes(r)||(c.BB.sameKeys("ctrl+shift+z",r)||c.BB.sameKeys("cmd+shift+z",r))&&"z"===t)&&(i.preventDefault(),Oe.redo()),n.embed||(["ctrl+s","cmd+s"].includes(r)&&(i.preventDefault(),De.save()),["ctrl+shift+s","cmd+shift+s"].includes(r)&&(i.preventDefault(),(0,a.default)(e(o).mark((function t(){var i;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=!0,e.prev=1,e.next=4,H.store(K.getProject());case 4:e.next=11;break;case 6:e.prev=6,e.t0=e.catch(1),i=!1,setTimeout((function(){throw new Error("keyboard-shortcut: failed to store browser storage, "+e.t0)}),0),he.out("❌ "+(0,f.LANG)("file-storage-failed"),!0);case 11:i&&(n.saveReminder.reset(),he.out((0,f.LANG)("file-storage-stored"),!0));case 12:case"end":return e.stop()}}),t,null,[[1,6]])})))()),["ctrl+c","cmd+c"].includes(r)&&(i.preventDefault(),O(!0))),["ctrl+a","cmd+a"].includes(r)&&i.preventDefault(),se.comboOnlyContains(["left","right","up","down"])&&("left"===t&&oe.translateView(1,0),"right"===t&&oe.translateView(-1,0),"up"===t&&oe.translateView(0,1),"down"===t&&oe.translateView(0,-1)),["r+left","r+right"].includes(r)&&("left"===t&&(oe.setAngle(-15,!0),Se.update(oe.getScale(),oe.getAngleDeg())),"right"===t&&(oe.setAngle(15,!0),Se.update(oe.getScale(),oe.getAngleDeg()))),["r+up"].includes(r)&&(oe.setAngle(0),Se.update(oe.getScale(),oe.getAngleDeg())),"sqbr_open"===r&&Q.decreaseSize(.03/oe.getScale()),"sqbr_close"===r&&Q.increaseSize(.03/oe.getScale()),"enter"===r&&(K.layerFill(K.getLayerIndex(ee.canvas),ve.getColor()),he.out((0,f.LANG)("filled"),!0)),["delete","backspace"].includes(r)){var l=K.getLayerIndex(ee.canvas);0!==l||le.eraserBrush.getIsTransparentBg()?K.clearLayer(l):K.layerFill(l,{r:255,g:255,b:255},"source-in"),he.out((0,f.LANG)("cleared-layer"),!0)}if("e"===r&&(i.preventDefault(),oe.setMode("draw"),ye.setActive("draw"),W.open("draw"),P(),we.open("eraserBrush")),"b"===r){i.preventDefault();var u=oe.getMode();oe.setMode("draw"),ye.setActive("draw"),W.open("draw"),P(),we.open("draw"===u?function(){if("eraserBrush"===J)return Z;var e=Object.keys(le).filter((function(e){return"eraserBrush"!==e})),t=e.findIndex((function(e){return e===J}));return e[(t+1)%e.length]}():J)}if("g"===r){i.preventDefault();var h="fill"===oe.getMode()?"gradient":"fill";oe.setMode(h),ye.setActive(h),W.open(h),P()}"t"===r&&(i.preventDefault(),oe.setMode("text"),ye.setActive("text"),W.open("text"),P()),"u"===r&&(i.preventDefault(),oe.setMode("shape"),ye.setActive("shape"),W.open("shape"),P()),"x"===r&&(i.preventDefault(),ve.swapColors())}},onUp:function(e,t){}});n.embed||(new s.KL.KlImageDropper({target:document.body,onDrop:function(e,t){s.KL.dialogCounter.get()>0||M(e,t)},enabledTest:function(){return 0===s.KL.dialogCounter.get()}}),c.BB.addEventListener(window,"paste",(function(e){s.KL.dialogCounter.get()>0||(e.stopPropagation(),e.preventDefault(),e.clipboardData.files[0]?function(e,t){0==e.clipboardData&&"function"==typeof t&&t(void 0);var n=e.clipboardData.items;if(null==n)"function"==typeof t&&t(void 0);else for(var i=0;i<n.length;i++)if(-1!=n[i].type.indexOf("image")){var r=n[i].getAsFile();"function"==typeof t&&t(r)}}(e,(function(e){if(e){var t=new Image;t.onload=function(){URL.revokeObjectURL(t.src),L({type:"image",width:t.width,height:t.height,canvas:t},null,"default")};var n=window.URL||window.webkitURL;t.src=n.createObjectURL(e)}})):e.clipboardData.items[0]&&e.clipboardData.items[0].getAsString((function(e){if((e=e.trim()).match(/^https?/)){var t=new Image;t.onload=function(){L({type:"image",width:t.width,height:t.height,canvas:t},null,"default")},t.onerror=function(e){console.log("error loading",e)},t.crossOrigin="Anonymous",t.src=e}else if(e.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)){var n=c.BB.ColorConverter.hexToRGB(e.replace("#",""));te.setColor(n)}})))}),!1));var le={};for(var ce in s.KL.brushesUI)if(s.KL.brushesUI.hasOwnProperty(ce)){var ue=new s.KL.brushesUI[ce].Ui({onSizeChange:k,onOpacityChange:function(e){te.emitOpacity(e)},onConfigChange:function(){te.emitSliderConfig({sizeSlider:s.KL.brushesUI[J].sizeSlider,opacitySlider:s.KL.brushesUI[J].opacitySlider})}});le[ce]=ue,ue.getElement().style.padding="10px"}c.BB.css(X,{position:"absolute",left:"0",top:"0",right:"0",bottom:"0"});var he=new s.KL.StatusOverlay,de=c.BB.el({}),pe=c.BB.el({parent:de});de.oncontextmenu=function(){return!1},de.onclick=c.BB.handleClick;var ge,fe,me=new s.KL.ToolspaceCollapser({onChange:function(){E()}});E(),setTimeout((function(){ge=new s.KL.OverlayToolspace({enabledTest:function(){return 0===s.KL.dialogCounter.get()&&!ie.getIsDrawing()},brushSettingService:te}),X.appendChild(ge.getElement())}),0),c.BB.append(X,[oe.getElement(),de,me.getElement()]),c.BB.css(de,{position:"absolute",right:"0",top:"0",bottom:"0",width:V-1+"px",overflow:"hidden",backgroundColor:"#ddd",borderLeft:"1px solid rgb(135, 135, 135)",userSelect:"none",touchAction:"none"}),fe=n.embed?new(0,h.ToolspaceTopRow)({onHelp:function(){(0,u.showIframePopup)(n.embed.url+"/help.html",!!n.embed)},onSubmit:function(){var t;s.KL.popup({target:X,message:(0,f.LANG)("submit-prompt"),buttons:[(0,f.LANG)("submit"),"Cancel"],callback:(t=(0,a.default)(e(o).mark((function t(i){var r;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i===(0,f.LANG)("submit")){e.next=2;break}return e.abrupt("return");case 2:r=c.BB.el({parent:X,className:"upload-overlay",content:'<div class="spinner"></div> '+(0,f.LANG)("submit-submitting")}),n.embed.onSubmit((function(){n.saveReminder.reset(),X.removeChild(r)}),(function(){X.removeChild(r)}));case 4:case"end":return e.stop()}}),t)}))),function(e){return t.apply(this,arguments)})})},onLeftRight:function(){G="left"===G?"right":"left",A()}}):new s.KL.ToolspaceTopRow({logoImg:n.logoImg,onLogo:function(){(0,u.showIframePopup)("./home/",!!n.embed)},onNew:function(){I()},onImport:function(){Ne.triggerImport()},onSave:function(){De.save()},onShare:function(){R()},onHelp:function(){(0,u.showIframePopup)("./help/",!!n.embed)}}),fe.getElement().classList.add("toolspace-row-shadow"),fe.getElement().style.marginBottom="10px",pe.appendChild(fe.getElement());var ve,ye=new s.KL.ToolspaceToolRow({onActivate:function(e){if("draw"===e)oe.setMode("draw");else if("hand"===e)oe.setMode("hand");else if("fill"===e)oe.setMode("fill");else if("gradient"===e)oe.setMode("gradient");else if("text"===e)oe.setMode("text");else{if("shape"!==e)throw new Error("unknown activeStr");oe.setMode("shape")}W.open(e),P(),ve.pickingDone()},onZoomIn:function(){oe.zoomByStep(se.isPressed("shift")?1/8:.5)},onZoomOut:function(){oe.zoomByStep(se.isPressed("shift")?-1/8:-.5)},onUndo:function(){Oe.undo()},onRedo:function(){Oe.redo()}});ye.setIsSmall(U<540),l.klHistory.addListener((function(){ye.setEnableUndo(l.klHistory.canUndo()),ye.setEnableRedo(l.klHistory.canRedo())})),ye.getElement().classList.add("toolspace-row-shadow"),pe.appendChild(ye.getElement()),(ve=new s.KL.KlColorSlider({width:250,height:30,svHeight:100,startValue:new c.BB.RGB(0,0,0),onPick:function(e){$=e,Q.setColor(e),te.emitColor(e),ve.pickingDone()}})).setHeight(Math.max(163,Math.min(400,U-505))),ve.setPickCallback((function(e){e?oe.setMode("pick"):(oe.setMode(ye.getActive()),P())}));var xe=document.createElement("div"),be=document.createElement("div");c.BB.css(be,{margin:"10px",display:"flex",flexWrap:"wrap",justifyContent:"space-between",alignItems:"flex-end"});var Be=new s.KL.ToolspaceStabilizerRow({smoothing:1,onSelect:function(e){ne.setSmoothing(d(e))}});xe.appendChild(be),c.BB.append(be,[ve.getElement(),ve.getOutputElement(),Be.getElement()]);var we=new s.KL.TabRow({initialId:"penBrush",useAccent:!0,tabArr:function(){for(var e=function(e){return{id:e,image:s.KL.brushesUI[e].image,title:s.KL.brushesUI[e].tooltip,onOpen:function(){var t;le[e].getElement().style.display="block","eraserBrush"!==(t=e)&&(Z=t),ve&&("eraserBrush"===t?ve.enable(!1):ve.enable(!0)),J=t,(Q=le[t]).setColor($),Q.setContext(ee),oe.setMode("draw"),ye.setActive("draw"),P(),ve.pickingDone(),te.emitSliderConfig({sizeSlider:s.KL.brushesUI[e].sizeSlider,opacitySlider:s.KL.brushesUI[e].opacitySlider}),k(le[e].getSize()),te.emitOpacity(le[e].getOpacity())},onClose:function(){le[e].getElement().style.display="none"}}},t=[],n=Object.keys(le),i=0;i<n.length;i++)t.push(e(n[i]));return t}()});for(var Ce in xe.appendChild(we.getElement()),s.KL.brushesUI)s.KL.brushesUI.hasOwnProperty(Ce)&&xe.appendChild(le[Ce].getElement());var Se=new s.KL.HandUi({scale:1,angleDeg:0,onReset:function(){oe.resetView(!0),Se.update(oe.getScale(),oe.getAngleDeg())},onFit:function(){oe.fitView(),Se.update(oe.getScale(),oe.getAngleDeg())},onAngleChange:function(e,t){oe.setAngle(e,t),Se.update(oe.getScale(),oe.getAngleDeg())}}),ke=new s.KL.FillUi({colorSlider:ve}),Le=new s.KL.GradientUi({colorSlider:ve}),Me=new s.KL.TextUi({colorSlider:ve}),Ee=new s.KL.ShapeUi({colorSlider:ve}),Ae=new s.KL.GradientTool({onGradient:function(e,t,n,i,r,a){var o=K.getLayerIndex(ee.canvas),l=Le.getSettings(),c={type:l.type,color1:ve.getColor(),isReversed:l.isReversed,opacity:l.opacity,doLockAlpha:l.doLockAlpha,isEraser:l.isEraser,doSnap:se.isPressed("shift")||l.doSnap,x1:t,y1:n,x2:i,y2:r,angleRad:a};e?(K.setComposite(o,null),K.drawGradient(o,c)):K.setComposite(o,{draw:function(e){s.KL.drawGradient(e,c)}}),oe.requestFrame()}}),Te=new s.KL.ShapeTool({onShape:function(e,t,n,i,r,a){var o=K.getLayerIndex(ee.canvas),l={type:Ee.getShape(),x1:t,y1:n,x2:i,y2:r,angleRad:a,isOutwards:Ee.getIsOutwards(),opacity:Ee.getOpacity(),isEraser:Ee.getIsEraser(),doLockAlpha:Ee.getDoLockAlpha()};"line"===Ee.getShape()?(l.strokeRgb=ve.getColor(),l.lineWidth=Ee.getLineWidth(),l.isAngleSnap=Ee.getIsSnap()||se.isPressed("shift")):(l.isFixedRatio=Ee.getIsFixed()||se.isPressed("shift"),"stroke"===Ee.getMode()?(l.strokeRgb=ve.getColor(),l.lineWidth=Ee.getLineWidth()):l.fillRgb=ve.getColor()),e?(K.setComposite(o,null),K.drawShape(o,l)):K.setComposite(o,{draw:function(e){s.KL.drawShape(e,l)}}),oe.requestFrame()}}),Ie=s.KL.klLayerManager(K,(function(e){T(K.getLayer(e)),l.klHistory.push({tool:["misc"],action:"focusLayer",params:[e]})}),X),Re=new s.KL.LayerPreview({klRootEl:X,onClick:function(){W.open("layers")}});Re.setIsVisible(U>=579),Re.setLayer(K.getLayer(K.getLayerIndex(ee.canvas)));var Pe=new s.KL.FilterTab(X,ve,Ie,oe,Se,(function(){return $}),(function(){return N}),(function(){return K}),(function(){return ee}),!!n.embed,he),Oe=new s.KL.UndoRedoCatchup(le,Re,Ie,Se,oe,(function(){if(!_)throw new Error("initState not initialized");return _}),(function(){return K}),(function(){return ee}),(function(e){ee=e}),(function(){return Q}));l.klHistory.addListener((function(e){Oe.catchup(e)}));var De=new s.KL.SaveToComputer(n.saveReminder,X,(function(){return Y}),(function(){return K}),j),Ne=n.embed?null:new s.KL.FileTab(X,H,(function(){return K.getProject()}),Y,(function(e){Y=e}),M,(function(){De.save()}),I,R,(function(){s.KL.imgurUpload(K,X,n.saveReminder,n.app&&n.app.imgurKey?n.app.imgurKey:null)}),O,n.saveReminder),ze=new s.KL.SettingsTab((function(){G="left"===G?"right":"left",A(),n.embed||S.LocalStorage.setItem("uiState",G)}),n.aboutEl);W=new s.KL.TabRow({initialId:"draw",tabArr:[{id:"draw",title:(0,f.LANG)("tool-brush"),image:e(m),onOpen:function(){"eraserBrush"===J&&ve.enable(!1),c.BB.append(be,[ve.getElement(),ve.getOutputElement(),Be.getElement()]),xe.style.display="block"},onClose:function(){xe.style.display="none"},css:{minWidth:"45px"}},{id:"hand",title:(0,f.LANG)("tool-hand"),image:e(v),isVisible:!1,onOpen:function(){Se.setIsVisible(!0)},onClose:function(){Se.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"fill",title:(0,f.LANG)("tool-paint-bucket"),image:e(y),isVisible:!1,onOpen:function(){ve.enable(!0),ke.setIsVisible(!0)},onClose:function(){ke.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"gradient",title:(0,f.LANG)("tool-gradient"),image:e(x),isVisible:!1,onOpen:function(){ve.enable(!0),Le.setIsVisible(!0)},onClose:function(){Le.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"text",title:(0,f.LANG)("tool-text"),image:e(b),isVisible:!1,onOpen:function(){ve.enable(!0),Me.setIsVisible(!0)},onClose:function(){Me.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"shape",title:(0,f.LANG)("tool-shape"),image:e(B),isVisible:!1,onOpen:function(){ve.enable(!0),Ee.setIsVisible(!0)},onClose:function(){Ee.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"layers",title:(0,f.LANG)("tab-layers"),image:e(C),onOpen:function(){Ie.update(),Ie.style.display="block"},onClose:function(){Ie.style.display="none"},css:{minWidth:"45px"}},{id:"edit",label:(0,f.LANG)("tab-edit"),onOpen:function(){Pe.show()},onClose:function(){Pe.hide()},css:{padding:"0 7px"}},{id:"file",label:(0,f.LANG)("tab-file"),isVisible:!!Ne,onOpen:function(){Ne&&(Ne.getElement().style.display="block",Ne.setIsVisible(!0))},onClose:function(){Ne&&(Ne.getElement().style.display="none",Ne.setIsVisible(!1))},css:{padding:"0 7px"}},{id:"settings",title:(0,f.LANG)("tab-settings"),image:e(w),onOpen:function(){ze.getElement().style.display="block"},onClose:function(){ze.getElement().style.display="none"},css:{minWidth:"45px"}}]});var Ge=c.BB.el({css:{width:"270px",position:"absolute",bottom:"0",left:"0"}});n.bottomBar&&(Ge.append(n.bottomBar),new MutationObserver((function(){return D()})).observe(pe,{attributes:!0,childList:!0,subtree:!0}));c.BB.append(pe,[Re.getElement(),W.getElement(),xe,Se.getElement(),ke.getElement(),Le.getElement(),Me.getElement(),Ee.getElement(),Ie,Pe.getElement(),Ne?Ne.getElement():null,ze.getElement(),c.BB.el({css:{height:"10px"}}),Ge||null]);var je=new s.KL.ToolspaceScroller({toolspace:de,uiState:G});this.getEl=function(){return X},this.resize=function(e,t){window.scrollY>0&&window.scrollTo(0,0),F===Math.max(0,e)&&U===Math.max(0,t)||(F=Math.max(0,e),U=Math.max(0,t),E(),D(),Re.setIsVisible(U>=579),ve.setHeight(Math.max(163,Math.min(400,U-505))),ye.setIsSmall(U<540))},this.out=function(e){he.out(e)},this.getPNG=function(){return(0,p.base64ToBlob)(K.getCompleteCanvas(1).toDataURL("image/png"))},this.getPSD=(0,a.default)(e(o).mark((function t(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,g.klCanvasToPsdBlob)(K);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),t)}))),this.getProject=function(){return K.getProject()},this.swapUiLeftRight=function(){G="left"===G?"right":"left",n.embed||S.LocalStorage.setItem("uiState",G),A()},this.saveAsPsd=function(){De.save("psd")},this.isDrawing=function(){return ie.getIsDrawing()||oe.getIsDrawing()},this.resize(F,U),A(),c.BB.addEventListener(window,"resize",(function(){r.resize(window.innerWidth,window.innerHeight)})),c.BB.addEventListener(window,"orientationchange",(function(){r.resize(window.innerWidth,window.innerHeight)}));var He=c.BB.el({parent:document.body,css:{position:"fixed",left:"0",top:"0",right:"0",bottom:"0",pointerEvents:"none",zIndex:"-1",userSelect:"none"}});try{new ResizeObserver((function(){return r.resize(window.innerWidth,window.innerHeight)})).observe(He)}catch(e){He.parentNode.removeChild(He)}c.BB.addEventListener(X,"wheel",(function(e){se.isPressed("ctrl")&&e.preventDefault()}));var Xe=function(e){e.preventDefault()};window.addEventListener("gesturestart",Xe),window.addEventListener("gesturechange",Xe),window.addEventListener("gestureend",Xe)}(0,d.importFilters)()})),i.register("hrnUX",(function(e,n){t(e.exports,"KL",(function(){return Ce}));var r=i("gWfkn"),a=i("ekHRj"),o=i("i8UFO"),s=i("lXqiv"),l=i("c4LUw"),c=i("21VAD"),u=i("jKOQl"),h=i("gmlbk"),d=i("fCJWy"),p=i("llzZ0"),g=i("l4PqG"),f=i("lfHl9"),m=i("h7i9r"),v=i("kzhsD"),y=i("bd9hB"),x=i("9A7OD"),b=i("iskOY"),B=i("bmB93"),w=i("auloj"),C=i("hRdOL"),S=i("isYih"),k=i("5rdL4"),L=i("7bo3M"),M=i("lV6Vy"),E=i("i5nyl"),A=i("cNhNm"),T=i("kEeSq"),I=i("32CBv"),R=i("kqmpc"),P=i("j1kEL"),O=i("8ebuX"),D=i("13r5y"),N=i("9p4Zp"),z=i("8jqzp"),G=i("84zxV"),j=i("9Kxky"),H=i("1Ax5m"),X=i("e4sAN"),F=i("khi8I"),U=i("dJXmR"),V=i("iS9xS"),Y=i("9J17G"),K=i("76Qvv"),W=i("1uc3b"),_=i("h20yl"),q=i("keKW3"),Q=i("kDGzx"),J=i("30Cml"),Z=i("941rU"),$=i("3ujzu"),ee=i("705qg"),te=i("9BlwZ"),ne=i("kyVjY"),ie=i("dAXbp"),re=i("3P46L"),ae=i("5ebUJ"),oe=i("bHZQg"),se=i("9pcu9"),le=i("aSJRf"),ce=i("6mTnI"),ue=i("eK8ID"),he=i("2umOB"),de=i("5ENro"),pe=i("lkluh"),ge=i("5ngYX"),fe=i("eyygR"),me=i("6rdi0"),ve=(te=i("9BlwZ"),i("7pyBK")),ye=i("iDHln"),xe=i("bIgqE"),be=i("iVHpg"),Be=i("5Gc7M"),we=i("7EG77"),Ce={brushes:ie.brushes,brushesUI:re.brushesUI,BrushSettingService:ve.BrushSettingService,KlCanvas:ee.KlCanvas,drawProject:le.drawProject,WorkspaceSvgOverlay:L.WorkspaceSvgOverlay,KlCanvasWorkspace:M.KlCanvasWorkspace,KlCanvasPreview:E.KlCanvasPreview,filterLibStatus:ne.filterLibStatus,filterLib:ne.filterLib,UndoRedoCatchup:me.UndoRedoCatchup,renderText:_.renderText,floodFillBits:J.floodFillBits,ShapeTool:$.ShapeTool,drawShape:$.drawShape,GradientTool:we.GradientTool,drawGradient:we.drawGradient,PSD:Z,setDbName:te.setDbName,indexedDb:te,ProjectStore:ce.ProjectStore,loadAgPsd:pe.loadAgPsd,SaveToComputer:fe.SaveToComputer,calcSliderFalloffFactor:g.calcSliderFalloffFactor,Checkbox:s.Checkbox,input:l.input,Select:c.Select,ImageToggle:u.ImageToggle,ImageRadioList:h.ImageRadioList,RadioList:oe.RadioList,penPressureToggle:d.penPressureToggle,KlSlider:p.KlSlider,HexColorDialog:f.HexColorDialog,KlColorSlider:m.KlColorSlider,KlSmallColorSlider:v.KlSmallColorSlider,PointSlider:y.PointSlider,ColorOptions:x.ColorOptions,Options:b.Options,BoxToggle:ye.BoxToggle,StatusOverlay:B.StatusOverlay,CropCopy:C.CropCopy,FreeTransform:A.FreeTransform,FreeTransformCanvas:T.FreeTransformCanvas,Cropper:I.Cropper,LayerPreview:R.LayerPreview,FittedImage:P.FittedImage,KlImageDropper:D.KlImageDropper,OverlayToolspace:N.OverlayToolspace,ToolspaceTopRow:z.ToolspaceTopRow,ToolDropdown:G.ToolDropdown,ToolspaceToolRow:j.ToolspaceToolRow,ToolspaceStabilizerRow:H.ToolspaceStabilizerRow,TabRow:X.TabRow,ToolspaceCollapser:W.ToolspaceCollapser,BrowserStorageUi:se.BrowserStorageUi,SaveReminder:ge.SaveReminder,ToolspaceScroller:be.ToolspaceScroller,dialogCounter:o.dialogCounter,popup:a.popup,Popup:a.Popup,exportDialog:w.exportDialog,clipboardDialog:S.clipboardDialog,showImportAsLayerDialog:O.showImportAsLayerDialog,newImageDialog:K.newImageDialog,textToolDialog:q.textToolDialog,showImportImageDialog:Q.showImportImageDialog,showIframePopup:ae.showIframePopup,imgurUpload:de.imgurUpload,HandUi:F.HandUi,FillUi:U.FillUi,GradientUi:Be.GradientUi,TextUi:V.TextUi,ShapeUi:Y.ShapeUi,FileTab:ue.FileTab,FilterTab:he.FilterTab,SettingsTab:xe.SettingsTab,klLayerManager:k.klLayerManager,klHistory:r.klHistory,DecoyKlHistory:r.DecoyKlHistory}})),i.register("gWfkn",(function(e,n){t(e.exports,"DecoyKlHistory",(function(){return l})),t(e.exports,"klHistory",(function(){return c}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("7U0Ew"),s=!1,l=function(){"use strict";function e(){(0,r.default)(this,e)}return(0,a.default)(e,[{key:"pause",value:function(e){}},{key:"addListener",value:function(e){}},{key:"push",value:function(e){}},{key:"undo",value:function(){return[]}},{key:"redo",value:function(){return[]}},{key:"getAll",value:function(){return[]}},{key:"canRedo",value:function(){return!1}},{key:"canUndo",value:function(){return!1}},{key:"getState",value:function(){return 0}},{key:"getActionNumber",value:function(){return 0}}]),e}(),c=new(function(){"use strict";function e(){if((0,r.default)(this,e),(0,o.default)(this,"max",20),s)throw new Error("klHistory already instantiated");s=!0,this.state=0,this.dataArr=[],this.listeners=[],this.pauseStack=0,this.maxState=-1,this.actionNumber=-1}return(0,a.default)(e,[{key:"broadcast",value:function(e){var t=this;setTimeout((function(){for(var n=0;n<t.listeners.length;n++)t.listeners[n](e);t.state++}),1)}},{key:"pause",value:function(e){!1===e?this.pauseStack=Math.max(0,this.pauseStack-1):this.pauseStack++}},{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"push",value:function(e){if(!(this.pauseStack>0)){for(;this.actionNumber<this.dataArr.length-1;)this.dataArr.pop();var t=this.dataArr[this.dataArr.length-1];if("layerOpacity"===e.action&&t&&"layerOpacity"===t.action&&t.params[0]===e.params[0])return this.dataArr[this.dataArr.length-1]=e,void this.state++;if("focusLayer"===e.action&&t&&"focusLayer"===t.action)return this.dataArr[this.dataArr.length-1]=e,void this.state++;this.dataArr[this.dataArr.length]=e,this.actionNumber=this.dataArr.length-1;var n=this.maxState;this.maxState=Math.max(this.maxState,this.actionNumber-this.max),n<this.maxState?this.broadcast({bufferUpdate:this.dataArr[this.maxState]}):this.broadcast(null),this.maxState>=0&&(this.dataArr[this.maxState]=null)}}},{key:"undo",value:function(){var e;if(this.canUndo()){e=[];for(var t=this.maxState+1;t<this.actionNumber;t++)e.push(this.dataArr[t]);this.actionNumber--,this.broadcast(null)}return e}},{key:"redo",value:function(){var e=[];return this.canRedo()&&(this.actionNumber++,e.push(this.dataArr[this.actionNumber]),this.broadcast(null)),e}},{key:"getAll",value:function(){return[].concat(this.dataArr)}},{key:"canRedo",value:function(){return this.actionNumber<this.dataArr.length-1}},{key:"canUndo",value:function(){return this.actionNumber>this.maxState}},{key:"getState",value:function(){return this.state}},{key:"getActionNumber",value:function(){return this.actionNumber+1}}]),e}())})),i.register("ekHRj",(function(n,r){t(n.exports,"popup",(function(){return u})),t(n.exports,"Popup",(function(){return h}));var a=i("i8UFO"),o=i("eWjiX"),s=i("c0kqC"),l=i("fh18w"),c=i("1mH1z");function u(t){var n=function(e){i||(i=!0,o.BB.clearSelection(),o.BB.unfocusAnyInput(),document.body.removeChild(r),a.dialogCounter.decrease(),o.BB.destroyEl(p),o.BB.destroyEl(d),m.destroy(),o.BB.removeEventListener(u,"wheel",v),u.onclick=null,B.forEach((function(e){o.BB.destroyEl(e)})),B.splice(0,B.length),t.callback&&t.callback(e))};a.dialogCounter.increase();var i=!1,r=o.BB.el({parent:document.body,css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",overflow:"hidden"}}),u=o.BB.el({parent:r,className:"kl-popup"}),h=o.BB.el({parent:u,css:{width:"100%",minHeight:"100%",position:"relative",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}}),d=o.BB.el({parent:h,onClick:function(){t.ignoreBackground||n("Cancel")},css:{position:"absolute",left:"0",top:"0",zIndex:"0",width:"100%",height:"100%"}}),p=o.BB.el({tagName:"button",className:"popup-x",content:'<img alt="'.concat((0,c.LANG)("modal-close"),'" height="20" src="').concat(e(l),'">'),title:(0,c.LANG)("modal-close"),onClick:function(){n("Cancel")},css:{width:"40px",height:"40px",lineHeight:"40px",position:"absolute",right:"0",top:"0",background:"none",boxShadow:"none"}}),g=["kl-popup-box"];g.push("kl-popup-box--sm");var f=o.BB.el({content:[p,o.BB.el({content:t.message,css:{marginBottom:t.div?"10px":null,marginRight:"15px"}}),t.div],className:g.join(" "),css:t.style?t.style:null});h.append(o.BB.el({css:{flex:"0.5"}}),f,o.BB.el({css:{flex:"1"}})),"error"===t.type&&f.classList.add("poperror"),"ok"===t.type&&f.classList.add("popok"),"warning"===t.type&&f.classList.add("popwarning"),"upload"===t.type&&f.classList.add("popupload");var m=new o.BB.KeyListener({onDown:function(e,t,r){i||(x&&"enter"===r&&!o.BB.isInputFocused()&&(t.stopPropagation(),setTimeout((function(){x.click()}),10)),"esc"===r&&(t.stopPropagation(),n("Cancel")))}}),v=function(e){m.isPressed("ctrl")&&e.preventDefault()};o.BB.addEventListener(u,"wheel",v),u.onclick=o.BB.handleClick;var y=null;y=t.autoFocus?t.autoFocus:!1===t.autoFocus?null:"Ok";var x,b=t.buttons&&t.buttons.length>0?o.BB.el({parent:f,css:{display:"flex",flexWrap:"wrap",justifyContent:"flex-end",marginTop:"12px",marginLeft:"-8px"}}):null,B=[];t.buttons&&t.buttons.forEach((function(i){var r,a=["kl-popup__btn"];("Ok"===i||t.primaries&&t.primaries.includes(i))&&a.push("kl-button-primary");var h=i;"Ok"===i&&(h=(0,c.LANG)("modal-ok"),r=e(s)),"Cancel"===i&&(h=(0,c.LANG)("modal-cancel"),r=e(l));var d=null;r&&(d=o.BB.el({tagName:"img",custom:{src:r,height:"17"}}));var p=o.BB.el({parent:b,tagName:"button",className:a.join(" "),content:[d,h],onClick:function(){n(i)}});B.push(p),y===i&&(setTimeout((function(){p.focus(),u.scrollTo(0,0)}),10),setTimeout((function(){u.scrollTo(0,0)}),20)),i===t.clickOnEnter&&(x=p)})),t.closefunc&&t.closefunc((function(){n("Cancel")}))}window.onscroll=function(e){e.preventDefault()};var h=function(t){var n=function(){a.dialogCounter.decrease(),s.onclick=null,r.removeChild(s),clearInterval(undefined),window.removeEventListener("resize",i),f.destroy(),o.BB.destroyEl(p),o.BB.destroyEl(u),t.onClose&&t.onClose()},i=function(){var e=h.offsetWidth,t=h.offsetHeight;o.BB.css(h,{left:Math.max(0,(window.innerWidth-e)/2)+"px",top:Math.max(20,(window.innerHeight-t)/2-.2*t)+"px"})};a.dialogCounter.increase();var r=document.body,s=o.BB.el({parent:r,className:"g-root",css:{position:"fixed",left:"0",top:"0",bottom:"0",right:"0",background:"rgba(0, 0, 0, 0.45)",overflow:"auto",animationName:"consoleIn",animationDuration:"0.3s",animationTimingFunction:"ease-out"}});s.onclick=o.BB.handleClick;var u=o.BB.el({parent:s,css:{position:"absolute",left:"0",top:"0",bottom:"0",right:"0"},onClick:n}),h=o.BB.el({parent:s,css:{position:"absolute",width:o.BB.isCssMinMaxSupported()?"min(calc(100% - 40px), "+(t.width?t.width:400)+"px)":(t.width?t.width:400)+"px",height:"calc(100% - 40px)",background:"#eee",borderRadius:"10px",overflow:"hidden",boxShadow:"rgba(0, 0, 0, 0.25) 0px 5px 60px"}});i(),window.addEventListener("resize",i);var d=o.BB.el({parent:h,css:{height:"40px",display:"flex",justifyContent:"space-between",alignItems:"center",paddingLeft:"20px"}});t.title&&d.appendChild(t.title);var p=o.BB.el({parent:d,tagName:"button",className:"popup-x",content:'<img alt="'.concat((0,c.LANG)("modal-close"),'" height="20" src="').concat(e(l),'">'),title:(0,c.LANG)("modal-close"),onClick:n,css:{width:"40px",height:"40px",lineHeight:"40px",background:"none",boxShadow:"none"},custom:{tabindex:"0"}}),g=o.BB.el({parent:h,css:{height:"calc(100% - 40px)"}});t.content&&g.appendChild(t.content);var f=new o.BB.KeyListener({onDown:function(e,t){"esc"===e&&(t.stopPropagation(),n())}});this.close=function(){n()}}})),i.register("i8UFO",(function(e,n){t(e.exports,"dialogCounter",(function(){return s}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("7U0Ew"),s=new(function(){"use strict";function e(){(0,r.default)(this,e),(0,o.default)(this,"listeners",[]),(0,o.default)(this,"count",0)}return(0,a.default)(e,[{key:"emit",value:function(){var e=this;this.listeners.forEach((function(t){t(e.count)}))}},{key:"increase",value:function(e){void 0!==e?this.count+=e:this.count++,this.emit()}},{key:"decrease",value:function(e){void 0!==e?this.count-=e:this.count--,this.emit()}},{key:"get",value:function(){return this.count}},{key:"subscribe",value:function(e){this.listeners.push(e)}}]),e}())})),i.register("eWjiX",(function(e,n){t(e.exports,"BB",(function(){return b}));var r=i("h4olN"),a=i("7jh4K"),o=i("6J2My"),s=i("idV3L"),l=i("04lDo"),c=i("exufe"),u=i("eIcQa"),h=i("kVHNC"),d=i("4toIY"),p=i("af1iA"),g=i("dJ1E2"),f=i("72Jv0"),m=i("eg83P"),v=i("eelgW"),y=i("i0uIf"),x=i("6l0gQ"),b={eventUsesHighResTimeStamp:o.eventUsesHighResTimeStamp,mouseEventHasMovement:o.mouseEventHasMovement,hasPointerEvents:o.hasPointerEvents,hasWebGl:o.hasWebGl,getVisitor:o.getVisitor,isCssMinMaxSupported:o.isCssMinMaxSupported,canShareFiles:o.canShareFiles,insertAfter:a.insertAfter,loadImage:a.loadImage,css:a.css,setAttributes:a.setAttributes,append:a.append,fitInto:a.fitInto,centerWithin:a.centerWithin,getDate:a.getDate,gcd:a.gcd,reduce:a.reduce,decToFraction:a.decToFraction,imageBlobToUrl:a.imageBlobToUrl,dateDayDifference:a.dateDayDifference,copyObj:a.copyObj,shareCanvas:a.shareCanvas,handleClick:a.handleClick,createSvg:a.createSvg,BbLog:y.BbLog,LocalStorage:x.LocalStorage,mix:m.mix,dist:m.dist,distSquared:m.distSquared,lenSquared:m.lenSquared,pointsToAngleRad:m.pointsToAngleRad,pointsToAngleDeg:m.pointsToAngleDeg,isInsideRect:m.isInsideRect,clamp:m.clamp,rotate:m.rotate,rotateAround:m.rotateAround,Matrix:h.Matrix,Vec2:d.Vec2,intDxy:m.intDxy,roundEven:m.roundEven,roundUneven:m.roundUneven,round:m.round,updateBounds:m.updateBounds,boundsInArea:m.boundsInArea,projectPointOnLine:p.projectPointOnLine,PointLine:p.PointLine,BezierLine:p.BezierLine,SplineInterpolator:p.SplineInterpolator,quadraticSplineInput:p.quadraticSplineInput,canvas:v.createCanvas,copyCanvas:u.copyCanvas,testShouldPixelate:u.testShouldPixelate,drawTransformedImageWithBounds:u.drawTransformedImageWithBounds,drawTransformedImageOnCanvas:u.drawTransformedImageOnCanvas,createCheckerCanvas:u.createCheckerCanvas,createCheckerDataUrl:u.createCheckerDataUrl,resizeCanvas:u.resizeCanvas,convertToAlphaChannelCanvas:u.convertToAlphaChannelCanvas,freeCanvas:u.freeCanvas,canvasBounds:u.canvasBounds,HSV:g.HSV,RGB:g.RGB,CMYK:g.CMYK,ColorConverter:g.ColorConverter,testIsWhiteBestContrast:g.testIsWhiteBestContrast,appendTextDiv:f.appendTextDiv,clearSelection:f.clearSelection,makeUnfocusable:f.makeUnfocusable,el:f.el,destroyEl:f.destroyEl,isInputFocused:f.isInputFocused,unfocusAnyInput:f.unfocusAnyInput,addEventListener:r.addEventListener,removeEventListener:r.removeEventListener,setEventListener:r.setEventListener,KeyListener:s.KeyListener,PointerListener:l.PointerListener,sameKeys:s.sameKeys,EventChain:c}})),i.register("h4olN",(function(e,n){t(e.exports,"setEventListener",(function(){return a})),t(e.exports,"addEventListener",(function(){return o})),t(e.exports,"removeEventListener",(function(){return s}));var r=i("6J2My"),a=function(e,t,n){r.hasPointerEvents||(t=t.replace("pointer","mouse")),e[t]=n},o=function(e,t,n,i){r.hasPointerEvents||(t=t.replace("pointer","mouse")),e.addEventListener(t,n,i)},s=function(e,t,n,i){r.hasPointerEvents||(t=t.replace("pointer","mouse")),e.removeEventListener(t,n,i)}})),i.register("6J2My",(function(e,n){t(e.exports,"isFirefox",(function(){return h})),t(e.exports,"eventUsesHighResTimeStamp",(function(){return d})),t(e.exports,"mouseEventHasMovement",(function(){return p})),t(e.exports,"hasPointerEvents",(function(){return g})),t(e.exports,"hasWebGl",(function(){return f})),t(e.exports,"getVisitor",(function(){return m})),t(e.exports,"isCssMinMaxSupported",(function(){return v})),t(e.exports,"canShareFiles",(function(){return y}));var r,a,o,s,l,c,u=i("eelgW"),h=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,d=(a=null,document.body?(r=new Event(""),a=r.timeStamp<36e5):window.addEventListener("DOMContentLoaded",(function(e){a=e.timeStamp<36e5})),function(){if(null===a)throw"eventUsesHighResTimeStamp not initialized";return a}),p=function(){if(!("MouseEvent"in window))return!1;var e;try{e=new MouseEvent("mousemove")}catch(e){return!1}return"movementX"in e&&!h}(),g=!!window.PointerEvent,f=(o=function(){var e=(0,u.createCanvas)();try{return e.getContext("experimental-webgl",{premultipliedAlpha:!1}),!0}catch(e){return!1}}(),function(){return o}),m=(s={chrome:!1,gl:!1},window.chrome&&window.chrome.app&&(s.chrome=!0),s.gl=f(),function(){return JSON.parse(JSON.stringify(s))}),v=(l=function(){var e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.left="max(0px, 25px)",document.body.appendChild(e),setTimeout((function(){c=25===e.offsetLeft,document.body.removeChild(e)}),25)},c=null,document.body?l():window.addEventListener("DOMContentLoaded",(function(){l()})),function(){if(null===c)throw new Error("isCssMinMaxSupported not initialized");return c}),y=function(){return"share"in navigator&&"canShare"in navigator}})),i.register("eelgW",(function(e,n){function i(e,t){var n=document.createElement("canvas");return e&&t&&(n.width=e,n.height=t),n}t(e.exports,"createCanvas",(function(){return i}))})),i.register("7jh4K",(function(e,n){function i(e,t){e.parentNode&&e.parentNode.insertBefore(t,e.nextSibling)}function r(e,t){var n=0;!function i(){1e3!==n?e.complete?(n++,t()):setTimeout(i,1):alert("couldn't load")}()}function a(e,t){for(var n,i=Object.keys(t),r=e.style,a=0;a<i.length;a++)r[n=i[a]]=t[n],r.alignContent="true","userSelect"===n&&(r.webkitUserSelect=t[n])}function o(e,t){for(var n,i=Object.keys(t),r=0;r<i.length;r++)n=i[r],e.setAttribute(n,t[n])}function s(e,t){var n=document.createDocumentFragment();t.forEach((function(e){return e?n.append(e):null})),e.append(n)}function l(e,t,n,i,r){var a=e*n,o=t*n;return a>n&&(o*=n/a,a=n),o>i&&(a*=i/o,o=i),r&&(a=Math.max(r,a),o=Math.max(r,o)),{width:a,height:o}}function c(e,t,n,i){return{x:e/2-n/2,y:t/2-i/2}}function u(){var e=new Date;return e.getFullYear()+"_"+(e.getMonth()+1).toString().padStart(2,"0")+"_"+e.getDate().toString().padStart(2,"0")+"_"+(60*e.getHours()+e.getMinutes()).toString(36).padStart(3,"0")+"_"}function h(e,t){return t?h(t,e%t):e}function d(e,t){var n=h(e,t);return[e/n,t/n]}function p(e){var t=e.toString().length-2,n=Math.pow(10,t);return d(e*n,n)}function g(e){if(!e)throw new Error("blobObj is undefined or null");if(window.Blob&&e instanceof Blob)return URL.createObjectURL(e);if("Object"===e.constructor.name){var t=e;return"data:"+t.type+";"+t.encoding+","+t.data}throw new Error("unknown blob format")}function f(e,t){return e=new Date(e),t=new Date(t),e.setHours(0,0,0,0),t.setHours(0,0,0,0),(t.getTime()-e.getTime())/864e5}function m(e){return JSON.parse(JSON.stringify(e))}function v(e){var t="image/png",n=function(){return alert("sharing not supported")};e.canvas.toBlob((function(i){if(null===i)return n(),void e.callback();try{var r=[new File([i],e.fileName,{type:t})];navigator.share({title:e.title,files:r}).then((function(e){})).catch((function(e){n()}))}catch(e){n()}e.callback()}),t)}function y(e){var t=e.target;return!!t&&(!(!["A","LABEL","INPUT"].includes(t.tagName)&&!t.allowClick)||(e.preventDefault(),!1))}function x(e){for(var t,n=document.createElementNS("http://www.w3.org/2000/svg",e.elementType),i=Object.keys(e),r=0;r<i.length;r++)if("childrenArr"===(t=i[r]))for(var a=0;a<e.childrenArr.length;a++)n.appendChild(x(e.childrenArr[a]));else"elementType"!==t&&n.setAttribute(t,e[t]);return n}t(e.exports,"insertAfter",(function(){return i})),t(e.exports,"loadImage",(function(){return r})),t(e.exports,"css",(function(){return a})),t(e.exports,"setAttributes",(function(){return o})),t(e.exports,"append",(function(){return s})),t(e.exports,"fitInto",(function(){return l})),t(e.exports,"centerWithin",(function(){return c})),t(e.exports,"getDate",(function(){return u})),t(e.exports,"gcd",(function(){return h})),t(e.exports,"reduce",(function(){return d})),t(e.exports,"decToFraction",(function(){return p})),t(e.exports,"imageBlobToUrl",(function(){return g})),t(e.exports,"dateDayDifference",(function(){return f})),t(e.exports,"copyObj",(function(){return m})),t(e.exports,"shareCanvas",(function(){return v})),t(e.exports,"handleClick",(function(){return y})),t(e.exports,"createSvg",(function(){return x}))})),i.register("idV3L",(function(e,n){t(e.exports,"KeyListener",(function(){return l})),t(e.exports,"sameKeys",(function(){return c}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("h4olN"),s=function(){for(var e=function(e,t,n,i){d.forEach((function(r){r[0]&&r[0](e,t,n,i)}))},t=function(e,t,n){d.forEach((function(i){i[1]&&i[1](e,t,n)}))},n=function(t){var n=t.key,i="code"in t?t.code:t.keyCode;if(n in c){var r=c[n];if(l[r])return void e(r,t,u.join("+"),!0);l[r]=!0,h[i]=r,u.push(r),e(r,t,u.join("+"))}},i=function(e){e.key;var n="code"in e?e.code:e.keyCode,i=u.join("+");if(["Meta","MetaLeft","MetaRight","OSLeft","OSRight"].includes(n))r(null);else if(n in h&&null!==h[n]){var a=h[n];l[a]=!1,h[n]=null;for(var o=0;o<u.length;o++)u[o]==a&&(u.splice(o,1),o--);t(a,e,i)}},r=function(e){var n=u.join("+");u=[],h={};for(var i=[],r=0;r<s.length;r++)l[s[r]]&&(l[s[r]]=!1,i.push(s[r]));for(var a=0;a<i.length;a++)t(i[a],{preventDefault:function(){},stopPropagation:function(){}},n);d.forEach((function(e){e[2]&&e[2]()}))},a={space:[" ","Spacebar"],alt:["Alt","AltGraph"],shift:"Shift",ctrl:"Control",cmd:["Meta","MetaLeft","MetaRight"],enter:"Enter",esc:"Escape",backspace:"Backspace",delete:"Delete",sqbr_open:"[",sqbr_close:"]",a:["a","A"],b:["b","B"],c:["c","C"],e:["e","E"],f:["f","F"],g:["g","G"],r:["r","R"],s:["s","S"],t:["t","T"],u:["u","U"],x:["x","X"],y:["y","Y"],z:["z","Z"],plus:"+",minus:"-",left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown",home:"Home",end:"End"},s=Object.keys(a),l={},c={},u=[],h={},d=[],p=0;p<s.length;p++){l[s[p]]=!1;var g=a[s[p]];if("string"==typeof g)c[a[s[p]]]=s[p];else for(var f=0;f<g.length;f++)c[g[f]]=s[p]}return{add:function(e){if(!d.includes(e)){var t=0===d.length;d.push(e),t&&((0,o.addEventListener)(document,"keydown",n),(0,o.addEventListener)(document,"keyup",i),(0,o.addEventListener)(window,"blur",r))}},remove:function(e){if(d.includes(e)){for(var t=1===d.length,a=0;a<d.length;a++)if(d[a]===e){d.splice(a,1);break}t&&((0,o.removeEventListener)(document,"keydown",n),(0,o.removeEventListener)(document,"keyup",i),(0,o.removeEventListener)(window,"blur",r))}},getIsDown:function(){return l},getCombo:function(){return u}}}(),l=function(){"use strict";function e(t){(0,r.default)(this,e),this.onDown=t.onDown,this.onUp=t.onUp,this.onBlur=t.onBlur,this.ref=[this.onDown,this.onUp,this.onBlur],s.add(this.ref)}return(0,a.default)(e,[{key:"isPressed",value:function(e){if(!(e in s.getIsDown()))throw'key "'+e+'" not found';return s.getIsDown()[e]}},{key:"getComboStr",value:function(){return s.getCombo().join("+")}},{key:"comboOnlyContains",value:function(e){for(var t=0;t<s.getCombo().length;t++)if(!e.includes(s.getCombo()[t]))return!1;return!0}},{key:"destroy",value:function(){s.remove(this.ref)}}]),e}();function c(e,t){return e.split("+").sort().join("+")===t.split("+").sort().join("+")}})),i.register("04lDo",(function(e,n){t(e.exports,"PointerListener",(function(){return p}));var r,a,o,s,l,c=i("h4olN"),u=i("6J2My"),h=i("eg83P"),d=function(e){var t,n=function(t){e({deltaY:Math.round(t/o),pageX:l.pageX,pageY:l.pageY,clientX:l.clientX,clientY:l.clientY})},i=function(){null!==s&&(n(s),s=null),null===o||r.includes(o)||r.push(o),a=0,o=null},r=[100],a=0,o=null,s=null,l=null;this.process=function(e){l={pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY},clearTimeout(t),t=setTimeout(i,200);var c=e.deltaY;"deltaMode"in e&&1===e.deltaMode&&(c*=100/3);var u=Math.abs(c);if(a>0&&null===o)s=null;else{if(0===a){if(a++,u<50)return;return o=u,void(r.includes(o)?n(c):s=c)}if(0!==u){if(u===o||u/o%1<1e-4);else if(o/u%1<1e-4)o=u;else if(u!==o)return o=null,void(s=null);null!==s&&(n(s),s=null),n(c)}}}},p=(r=[],a=0,o=null,s=!1,l=1,function(e){var t,n,i,p=function(e){for(var t=0;t<H.length;t++)if(e===H[t].pointerId)return H[t];return null},g=function(e){for(var t=null,n=0;n<X.length;n++)X[n]===e&&(t=H[n],H.splice(n,1),X.splice(n,1),n--);return t},f=function(e,t){return 0===e||1===e?e:(a<60?(o=0===a?e:(0,h.mix)(e,o,.95),a++):s||(s=!0,o<.13&&(l=2.3)),Math.pow(e,1/l))},m=function(e){if(e.corrected)return e.corrected;var t={pointerId:e.pointerId,pointerType:e.pointerType,pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY,movementX:e.movementX,movementY:e.movementY,timeStamp:e.timeStamp+z,pressure:f(e.pressure,e.type),buttons:e.buttons,button:e.button,coalescedArr:[],eventPreventDefault:function(){e.preventDefault()},eventStopPropagation:function(){e.stopPropagation()}};e.corrected=t;var n=null;"pointerId"in e?"pressure"in e&&0!==e.buttons&&(["mouse"].includes(e.pointerType)||"touch"===e.pointerType&&0===e.pressure)&&(t.pressure=1,n=1):(t.pointerId=0,t.pointerType="mouse",t.pressure=0!==e.buttons?1:0,n=t.pressure),u.isFirefox&&"mouse"!=e.pointerType&&"pointermove"===e.type&&0===e.buttons&&(t.buttons=1);var i=[];"getCoalescedEvents"in e&&(i=e.getCoalescedEvents());var a=function(e){for(var t=r.length-1;t>=0;t--)if(e.pointerId===r[t].pointerId)return r[t];return null}(t);null===a&&(a=function(e){var t={pointerId:e.pointerId,lastPageX:null,lastPageY:null};return r.push(t),r.length>15&&r.shift(),t}(t));for(var o=a.lastPageX,s=a.lastPageY,l=0;l<i.length;l++){var c=i[l];t.coalescedArr.push({pageX:c.pageX,pageY:c.pageY,clientX:c.clientX,clientY:c.clientY,movementX:null===a.lastPageX?0:c.pageX-a.lastPageX,movementY:null===a.lastPageY?0:c.pageY-a.lastPageY,timeStamp:0===c.timeStamp?t.timeStamp:c.timeStamp+z,pressure:null===n?f(c.pressure):n}),a.lastPageX=c.pageX,a.lastPageY=c.pageY}return a.lastPageX=t.pageX,a.lastPageY=t.pageY,t.movementX=null===o?0:a.lastPageX-o,t.movementY=null===s?0:a.lastPageY-s,t},v=function(e,t,n){var i=A.getBoundingClientRect(),r={type:e,pointerId:t.pointerId,pointerType:t.pointerType,pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY,relX:t.clientX-i.left+A.scrollLeft,relY:t.clientY-i.top+A.scrollTop,dX:t.movementX,dY:t.movementY,time:t.timeStamp,eventPreventDefault:t.eventPreventDefault,eventStopPropagation:t.eventStopPropagation};if("pointermove"===e&&(r.coalescedArr=[],t.coalescedArr.length>1))for(var a,o=0;o<t.coalescedArr.length;o++)a=t.coalescedArr[o],r.coalescedArr.push({pageX:a.pageX,pageY:a.pageY,clientX:a.clientX,clientY:a.clientY,relX:a.clientX-i.left+A.scrollLeft,relY:a.clientY-i.top+A.scrollTop,dX:a.movementX,dY:a.movementY,time:a.timeStamp});if(n)for(var s=Object.keys(n),l=0;l<s.length;l++)r[s[l]]=n[s[l]];return r},y=function(e,t,n,i){var r=A.getBoundingClientRect(),a={type:e,pointerId:t.identifier,pointerType:"touch",pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY,relX:t.pageX-r.left+A.scrollLeft,relY:t.pageY-r.top+A.scrollTop,time:n.timeStamp+z,eventPreventDefault:function(){n.preventDefault()},eventStopPropagation:function(){n.stopPropagation()}};"pointermove"===e&&(a.coalescedArr=[]);for(var o=Object.keys(i),s=0;s<o.length;s++)a[o[s]]=i[o[s]];return a},x=function(){(0,c.removeEventListener)(document,"pointermove",S),(0,c.removeEventListener)(document,"pointerup",k),(0,c.removeEventListener)(document,"pointerleave",L)},b=function(){F++,R&&R(!0)},B=function(){F--,R&&R(!1)},w=function(e){e=m(e);var t=G;if(G=e.pointerType,X.includes(e.pointerId)||X.length===P||"touch"===e.pointerType)j=!1;else if(j||"mouse"!==e.pointerType||"pen"!==t){j=!1;var n=v("pointermove",e);T(n)}else j=!0},C=function(e){if(e=m(e),!X.includes(e.pointerId)&&X.length!==P&&[1,2,4].includes(e.buttons)){0===H.length&&((0,c.addEventListener)(document,"pointermove",S),(0,c.addEventListener)(document,"pointerup",k),(0,c.addEventListener)(document,"pointerleave",L));var t={pointerId:e.pointerId,pointerType:e.pointerType,downPageX:e.pageX,downPageY:e.pageY,buttons:e.buttons,lastPageX:e.pageX,lastPageY:e.pageY,lastTimeStamp:e.timeStamp};H.push(t),M(t),X.push(e.pointerId);var n=v("pointerdown",e,{downPageX:e.pageX,downPageY:e.pageY,button:O[e.buttons],pressure:e.pressure});T(n)}},S=function(e){if(e=m(e),X.includes(e.pointerId)){var t=p(e.pointerId);if(E(t),e.buttons===t.buttons){if(M(t),"pen"!==e.pointerType||e.pageX!==t.lastPageX||e.pageY!==t.lastPageY||e.timeStamp!==t.lastTimeStamp){var n=v("pointermove",e,{downPageX:t.downPageX,downPageY:t.downPageY,button:O[e.buttons],pressure:e.pressure});t.lastPageX=e.pageX,t.lastPageY=e.pageY,t.lastTimeStamp=e.timeStamp,T(n)}}else{1===H.length&&x(),g(e.pointerId);var i=v("pointerup",e,{downPageX:t.downPageX,downPageY:t.downPageY});T(i)}}},k=function(e){if(e=m(e),X.includes(e.pointerId)){1===H.length&&x();var t=g(e.pointerId);E(t);var n=v("pointerup",e,{downPageX:t.downPageX,downPageY:t.downPageY});T(n)}},L=function(e){if(e=m(e),X.includes(e.pointerId)){1===H.length&&x();var t=g(e.pointerId);E(t);var n=v("pointerup",e,{downPageX:t.downPageX,downPageY:t.downPageY});T(n)}},M=function(e){"touch"===e.pointerType&&(e.touchTimeout=setTimeout((function(){!function(e){var t={pointerId:e.pointerId,pointerType:e.pointerType,type:"pointerup",timeStamp:performance.now(),pageX:0,pageY:0,clientX:0,clientY:0,preventDefault:function(){},stopPropagation:function(){}};k(t)}(e)}),2500))},E=function(e){e.touchTimeout&&(clearTimeout(e.touchTimeout),e.touchTimeout=null)},A=e.target,T=e.onPointer,I=e.onWheel,R=e.onEnterLeave,P="maxPointers"in e?e.maxPointers:1,O={1:"left",2:"right",4:"middle"},D=new d((function(e){if(!N&&I){var t=A.getBoundingClientRect();e.relX=e.clientX-t.left+A.scrollLeft,e.relY=e.clientY-t.top+A.scrollTop,I(e)}})),N=!1,z=(0,u.eventUsesHighResTimeStamp)()?0:-performance.timing.navigationStart,G="",j=!1,H=[],X=[],F=0;R&&((0,c.addEventListener)(A,"pointerenter",b),(0,c.addEventListener)(A,"pointerleave",B)),T&&((0,c.addEventListener)(A,"pointermove",w),(0,c.addEventListener)(A,"pointerdown",C)),I&&(0,c.addEventListener)(A,"wheel",D.process),u.hasPointerEvents?e.fixScribble&&(n=function(e){e.preventDefault()},(0,c.addEventListener)(A,"touchmove",n)):(t=function(e){e.preventDefault();for(var t=e.changedTouches,r=0;r<t.length&&H.length<P;r++){var a=t[r];0===H.length&&((0,c.addEventListener)(document,"touchmove",n),(0,c.addEventListener)(document,"touchend",i),(0,c.addEventListener)(document,"touchcancel",i)),H.push({pointerId:a.identifier,downPageX:a.pageX,downPageY:a.pageY,buttons:1,lastPageX:a.pageX,lastPageY:a.pageY}),X.push(a.identifier);var o=y("pointerdown",a,e,{dX:0,dY:0,downPageX:a.downPageX,downPageY:a.downPageY,button:"left",pressure:1});T(o)}},n=function(e){e.preventDefault();for(var t=e.changedTouches,n=0;n<t.length;n++){var i=t[n];if(X.includes(i.identifier)){var r=p(i.identifier),a=y("pointermove",i,e,{dX:i.pageX-r.lastPageX,dY:i.pageY-r.lastPageY,downPageX:r.downPageX,downPageY:r.downPageY,button:"left",isCoalesced:!1,pressure:1});r.lastPageX=i.pageX,r.lastPageY=i.pageY,T(a)}}},i=function(e){"touchcancel"!==e.type&&e.preventDefault();for(var t=e.changedTouches,r=0;r<t.length;r++){var a=t[r];if(X.includes(a.identifier)){1===H.length&&((0,c.removeEventListener)(document,"touchmove",n),(0,c.removeEventListener)(document,"touchend",i),(0,c.removeEventListener)(document,"touchcancel",i));var o=g(a.identifier),s=y("pointerup",a,e,{dX:a.pageX-o.lastPageX,dY:a.pageY-o.lastPageY,downPageX:o.downPageX,downPageY:o.downPageY});T(s)}}},T&&(0,c.addEventListener)(A,"touchstart",t)),this.isOver=function(){return F>0},this.destroy=function(){N||(N=!0,(0,c.removeEventListener)(A,"pointerenter",b),(0,c.removeEventListener)(A,"pointerleave",B),(0,c.removeEventListener)(A,"pointermove",w),(0,c.removeEventListener)(A,"pointerdown",C),(0,c.removeEventListener)(A,"wheel",D.process),H.length>0&&x(),u.hasPointerEvents?(0,c.removeEventListener)(A,"touchmove",n):((0,c.removeEventListener)(A,"touchstart",t),H.length>0&&((0,c.removeEventListener)(document,"touchmove",n),(0,c.removeEventListener)(document,"touchend",i),(0,c.removeEventListener)(document,"touchcancel",i))))}})})),i.register("eg83P",(function(e,n){function i(e,t,n){return e*(1-n)+t*n}function r(e,t,n,i){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-i,2))}function a(e,t,n,i){return Math.pow(e-n,2)+Math.pow(t-i,2)}function o(e,t){return e*e+t*t}function s(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function l(e,t){return 180*s(e,t)/Math.PI}function c(e,t){return t.x<=e.x&&e.x<=t.x+t.width&&t.y<=e.y&&e.y<=t.y+t.height}function u(e,t,n){return e<=t?t:e>=n?n:e}function h(e,t,n){var i=n*(Math.PI/180),r=Math.cos(i),a=Math.sin(i);return{x:e*r-t*a,y:e*a+t*r}}function d(e,t,n){var i=h(t.x-e.x,t.y-e.y,n);return i.x+=e.x,i.y+=e.y,i}function p(e,t,n){e.x+=t,e.y+=n;var i=Math.round(e.x),r=Math.round(e.y);return e.x-=i,e.y-=r,{dX:i,dY:r}}function g(e){if(e%1==0)return e%2==0?e:e+1;var t=Math.ceil(e),n=Math.floor(e);return t%2==0?t:n}function f(e){if(e%1==0)return e%2==0?e+1:e;var t=Math.ceil(e),n=Math.floor(e);return t%2==1?t:n}function m(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}function v(e,t){return t?(e?(e.x1=Math.min(e.x1,t.x1),e.y1=Math.min(e.y1,t.y1),e.x2=Math.max(e.x2,t.x2),e.y2=Math.max(e.y2,t.y2)):e={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2},e):e}function y(e,t,n){var i=Math.max(0,e.x1),r=Math.max(0,e.y1),a=Math.min(t-1,e.x2),o=Math.min(n-1,e.y2);return i>a||r>o?null:{x1:i,y1:r,x2:a,y2:o}}t(e.exports,"mix",(function(){return i})),t(e.exports,"dist",(function(){return r})),t(e.exports,"distSquared",(function(){return a})),t(e.exports,"lenSquared",(function(){return o})),t(e.exports,"pointsToAngleRad",(function(){return s})),t(e.exports,"pointsToAngleDeg",(function(){return l})),t(e.exports,"isInsideRect",(function(){return c})),t(e.exports,"clamp",(function(){return u})),t(e.exports,"rotate",(function(){return h})),t(e.exports,"rotateAround",(function(){return d})),t(e.exports,"intDxy",(function(){return p})),t(e.exports,"roundEven",(function(){return g})),t(e.exports,"roundUneven",(function(){return f})),t(e.exports,"round",(function(){return m})),t(e.exports,"updateBounds",(function(){return v})),t(e.exports,"boundsInArea",(function(){return y}))})),i.register("exufe",(function(e,n){t(e.exports,"EventChain",(function(){return a})),t(e.exports,"DoubleTapper",(function(){return o})),t(e.exports,"NFingerTapper",(function(){return s})),t(e.exports,"PinchZoomer",(function(){return l})),t(e.exports,"CoalescedExploder",(function(){return c})),t(e.exports,"OnePointerLimiter",(function(){return u})),t(e.exports,"LinetoolProcessor",(function(){return h})),t(e.exports,"LineSanitizer",(function(){return d})),t(e.exports,"LineSmoothing",(function(){return p}));var r=i("eg83P"),a=function(e){for(var t=function(e,t){for(;e<n.length;e++)if(null===(t=n[e].chainIn(t)))return null;return i(t),null},n=e.chainArr,i=function(){},r=0;r<n.length;r++)!function(e){n[e].setChainOut((function(n){t(e+1,n)}))}(r);this.chainIn=function(e){return t(0,e)},this.setChainOut=function(e){i=e}},o=function(e){var t=function(){if(0!==f.length){clearTimeout(b.fail),clearTimeout(b.maxUntilSecondDown),clearTimeout(b.success),b.fail=null,b.maxUntilSecondDown=null,b.success=null;for(var e=0;e<x.length;e++)a(x[e]);x=[],f=[]}},n=function(){b.fail=null,b.success=null,x=[];var t=f[f.length-1];f=[],e.onDoubleTap({pageX:t.pageX,pageY:t.pageY,relX:t.relX,relY:t.relY})},i=function(e,t,n){var i=n-y;return!(i<=0)&&(b[e]=setTimeout(t,i),!0)},a=function(){},o=400,s=300,l=10,c=19,u=500,h=300,d=250,p=["touch","mouse","pen"],g=["left"],f=[],m=[],v=0,y=0,x=[],b={fail:null,maxUntilSecondDown:null,success:null};this.chainIn=function(e){return function(e){if("pointerdown"===e.type)m.push(e.pointerId);else if("pointerup"===e.type)for(var a=0;a<m.length;a++)if(m[a]===e.pointerId){m.splice(a,1);break}if(p.includes(e.pointerType)){y=performance.now();var x=f.length>0?f[f.length-1]:null;if("pointerup"===e.type&&(v=e.time),"pointerdown"===e.type){if(m.length>1)return void t();if(null!==b.success)return void t();if(0===f.length&&y-v<o)return void t();if(!g.includes(e.button))return void t();if(x&&x.isDown||f.length>2)return void t();if(x&&(0,r.dist)(x.position[0],x.position[1],e.pageX,e.pageY)>c&&(t(),y-x.time<o))return;if(f.push({isDown:!0,time:y,position:[e.pageX,e.pageY],pointerId:e.pointerId}),f.length>1)clearTimeout(b.maxUntilSecondDown);else if(!i("maxUntilSecondDown",t,e.time+h))return void t();if(clearTimeout(b.fail),!i("fail",t,e.time+s))return void t()}if(x&&"pointermove"===e.type&&x.pointerId===e.pointerId&&(0,r.dist)(x.position[0],x.position[1],e.pageX,e.pageY)>l)return void t();if(x&&"pointerup"===e.type){if(x.pointerId!==e.pointerId)return void t();if(y>=x.time+s)return void t();if(clearTimeout(b.fail),f.length<3)return i("fail",t,e.time+u)?void(f=[x,{isUp:!0,time:y,position:[e.pageX,e.pageY]}]):void t();y<f[1].time+u?(f.push({pageX:e.pageX,pageY:e.pageY,relX:e.relX,relY:e.relY}),i("success",n,e.time+d)||t()):t()}}else t()}(e),0===f.length?(t(),e):(x.push(e),null)},this.setChainOut=function(e){a=e},this.setAllowedPointerTypeArr=function(e){p=e},this.setAllowedButtonArr=function(e){g=e}},s=function(e){var t,n,i=function(){if(0!==g.length){clearTimeout(v.firstLastDownTimeout),clearTimeout(v.tapTimeout);for(var e=0;e<g.length;e++)l(g[e]);g=[],p=[]}},a=function(e,t){var r=t-n;return!(r<=0)&&(v[e]=setTimeout(i,r),!0)},o=function(o){var l=f;if(f=o.time,"pointerdown"===o.type)m.push(o.pointerId);else if("pointerup"===o.type)for(var y=0;y<m.length;y++)if(m[y]===o.pointerId){m.splice(y,1);break}if("touch"===o.pointerType){if(n=performance.now(),"pointerdown"===o.type)return p.length+1!==m.length||p.length===s||p.length>0&&o.time-h>p[0].downTime||0===p.length&&o.time-c<l?void i():0!==p.length||(t=o.time,a("firstLastDownTimeout",o.time+h)&&a("tapTimeout",o.time+u))?void p.push({pointerId:o.pointerId,downTime:o.time,downPageX:o.pageX,downPageY:o.pageY}):void i();if("pointermove"===o.type){if(0===p.length)return;for(var x=null,b=0;b<p.length;b++)if(p[b].pointerId===o.pointerId){x=p[b];break}if(null===x)return void i();if(o.time-u>t)return void i();if((0,r.dist)(o.pageX,o.pageY,x.downPageX,x.downPageY)>d)return void i()}if("pointerup"===o.type){if(0===p.length)return;if(p.length!==s)return void i();for(var B=null,w=0;w<p.length;w++)if(p[w].pointerId===o.pointerId){B=p[w];break}if(null===B)return;if(o.time-u>t)return void i();if((0,r.dist)(o.pageX,o.pageY,B.downPageX,B.downPageY)>d)return void i();B.isUp=!0;for(var C=!0,S=0;S<p.length;S++)if(!p[S].isUp){C=!1;break}if(C)return clearTimeout(v.firstLastDownTimeout),clearTimeout(v.tapTimeout),g=[],p=[],e.onTap(),!0}}else p.length>0&&i()},s=e.fingers,l=function(){},c=50,u=500,h=250,d=12,p=[],g=[],f=0,m=[],v={firstLastDownTimeout:null,tapTimeout:null};this.chainIn=function(e){return!0===o(e)?null:0===p.length?e:(g.push(e),null)},this.setChainOut=function(e){l=e}},l=function(e){var t,n=function(){p=null,g=[]},i=function(e){if(p){if(clearTimeout(f.secondFingerTimeout),!e)for(var t=0;t<g.length;t++)h(g[t]);n()}},a=function(e){if("pointerdown"===e.type)d.push(e.pointerId);else if("pointerup"===e.type)for(var a=0;a<d.length;a++)if(d[a]===e.pointerId){d.splice(a,1);break}if(p||!("touch"!==e.pointerType||"pointermove"===e.type&&d.length>0||d.length>1||"pointerup"===e.type)){if(t=performance.now(),"pointerdown"===e.type)return p?"touch"===e.pointerType?(p.touchPointerArr.push({pointerId:e.pointerId,relX:e.relX,relY:e.relY}),void(p.isInProgress?s(p,{type:"down",index:p.touchPointerArr.length-1}):(clearTimeout(f.secondFingerTimeout),p.isInProgress=!0,o(p)))):void(p.isInProgress?p.otherPointerIdArr.push(e.pointerId):i()):(p={touchPointerArr:[{pointerId:e.pointerId,relX:e.relX,relY:e.relY,downRelX:e.relX,downRelY:e.relY}],otherPointerIdArr:[],isInProgress:!1},h="secondFingerTimeout",g=function(){i()},m=e.time+u,(v=m-t)<=0||(f[h]=setTimeout(g,v),0)?void i():void 0);var h,g,m,v;if("pointermove"!==e.type||"touch"!==e.pointerType){if("pointerup"===e.type){if("touch"===e.pointerType){for(var y=0;y<p.touchPointerArr.length;y++)if(p.touchPointerArr[y].pointerId===e.pointerId){p.touchPointerArr.splice(y,1);break}p.touchPointerArr.length>0&&s(p,{type:"up",index:y})}else for(var x=0;x<p.otherPointerIdArr.length;x++)if(p.otherPointerIdArr[x]===e.pointerId){p.otherPointerIdArr.splice(x,1);break}if(0===p.touchPointerArr.length&&0===p.otherPointerIdArr.length)return void(p.isInProgress?(n(),l()):i())}}else{for(var b=null,B=0;B<p.touchPointerArr.length;B++)if(e.pointerId===p.touchPointerArr[B].pointerId){b=p.touchPointerArr[B];break}if(b.relX=e.relX,b.relY=e.relY,p.isInProgress)B<2&&s(p,{type:"move",index:B});else if((0,r.dist)(b.downRelX,b.downRelY,b.relX,b.relY)>c)return void i()}}},o=function(t){for(var n=0;n<t.touchPointerArr.length;n++){var i=t.touchPointerArr[n];m.push({pointerId:i.pointerId,relX:i.relX,relY:i.relY,downRelX:i.relX,downRelY:i.relY})}var r={type:"move",angleRad:0,scale:1};1===m.length?(r.relX=m[0].downRelX,r.relY=m[0].downRelY):(r.relX=.5*(m[0].downRelX+m[1].downRelX),r.relY=.5*(m[0].downRelY+m[1].downRelY)),r.downRelX=r.relX,r.downRelY=r.relY,e.onPinch(r)},s=function(t,n){if(!(n.index>1))if("move"===n.type){var i;if(m[n.index].relX=t.touchPointerArr[n.index].relX,m[n.index].relY=t.touchPointerArr[n.index].relY,1===m.length)i={type:"move",downRelX:m[0].downRelX,downRelY:m[0].downRelY,relX:m[0].relX,relY:m[0].relY,angleRad:0,scale:1};else{var a=(0,r.dist)(m[0].downRelX,m[0].downRelY,m[1].downRelX,m[1].downRelY),s=(0,r.dist)(m[0].relX,m[0].relY,m[1].relX,m[1].relY),c=(0,r.pointsToAngleRad)({x:m[0].downRelX,y:m[0].downRelY},{x:m[1].downRelX,y:m[1].downRelY}),u=(0,r.pointsToAngleRad)({x:m[0].relX,y:m[0].relY},{x:m[1].relX,y:m[1].relY});i={type:"move",downRelX:.5*(m[0].downRelX+m[1].downRelX),downRelY:.5*(m[0].downRelY+m[1].downRelY),relX:.5*(m[0].relX+m[1].relX),relY:.5*(m[0].relY+m[1].relY),angleRad:u-c,scale:s/a}}e.onPinch(i)}else"down"!==n.type&&"up"!==n.type||(l(),o(t))},l=function(){m=[],e.onPinch({type:"end"})},c=10,u=250,h=function(){},d=[],p=null,g=[],f={secondFingerTimeout:null},m=[];this.chainIn=function(e){return a(e),p?(p.isInProgress||g.push(e),null):e},this.setChainOut=function(e){h=e}},c=function(){var e=function(){};this.chainIn=function(t){if("pointermove"!==t.type)return t;if(!(t.coalescedArr.length>0))return t;var n,i=JSON.parse(JSON.stringify(t));i.coalescedArr=[];for(var r=0;r<t.coalescedArr.length;r++)r>0&&(i=JSON.parse(JSON.stringify(t))),n=t.coalescedArr[r],i.pageX=n.pageX,i.pageY=n.pageY,i.relX=n.relX,i.relY=n.relY,i.dX=n.dX,i.dY=n.dY,i.time=n.time,r<t.coalescedArr.length-1&&(i.isCoalesced=!0),e(i);return null},this.setChainOut=function(t){e=t}},u=function(e){var t=null,n=[];this.chainIn=function(e){if(n.includes(e.pointerId)){if("pointerup"===e.type)for(var i=0;i<n.length;i++)if(n[i]===e.pointerId){n.splice(i,1);break}return null}return null===t?("pointerdown"===e.type&&(t=e.pointerId),e):e.pointerId!==t?("pointerdown"===e.type&&n.push(e.pointerId),null):("pointerup"===e.type&&(t=null),e)},this.setChainOut=function(e){e}},h=function(e){var t=null,n=[],i=null;this.process=function(r){if("down"===r.type&&(t=r,i=null,r.shiftIsPressed))return e.onDraw({type:"line",x0:null,y0:null,pressure0:null,x1:r.x,y1:r.y,pressure1:r.pressure}),void n.push(r);if("move"===r.type)if(r.shiftIsPressed){if(null===i){var a=Math.abs(r.x-t.x),o=Math.abs(r.y-t.y);if(a>5||o>5){i=a>o?0:1;for(var s=0;s<n.length;s++){var l=n[s];0===i?l.y=t.y:l.x=t.x,e.onDraw(JSON.parse(JSON.stringify(l)))}n=[]}}if(null===i)return void n.push(r);0===i?r.y=t.y:r.x=t.x}else if(n.length>0){for(var c=0;c<n.length;c++)e.onDraw(JSON.parse(JSON.stringify(n[c])));n=[]}"up"===r.type&&(n=[]),e.onDraw(JSON.parse(JSON.stringify(r)))}},d=function(){var e=function(){},t=!1;this.chainIn=function(n){return"down"===n.type&&(t?e({type:"up",scale:n.scale,shiftIsPressed:n.shiftIsPressed,isCoalesced:!1}):t=!0),t||"move"!==n.type&&"up"!==n.type?("up"===n.type&&t&&(t=!1),n):null},this.setChainOut=function(t){e=t},this.getIsDrawing=function(){return t}},p=function(e){var t,n,i,a=function(){},o=(0,r.clamp)(e.smoothing,0,1);this.chainIn=function(e){if(e=JSON.parse(JSON.stringify(e)),clearTimeout(i),clearInterval(n),"down"===e.type&&(t={x:e.x,y:e.y,pressure:e.pressure}),"move"===e.type){var s=e.x,l=e.y,c=e.pressure;e.x=(0,r.mix)(e.x,t.x,o),e.y=(0,r.mix)(e.y,t.y,o),e.pressure=(0,r.mix)(e.pressure,t.pressure,o),t={x:e.x,y:e.y,pressure:e.pressure},o>0&&(i=setTimeout((function(){n=setInterval((function(){(e=JSON.parse(JSON.stringify(e))).x=(0,r.mix)(s,t.x,o),e.y=(0,r.mix)(l,t.y,o),e.pressure=(0,r.mix)(c,t.pressure,o),t={x:e.x,y:e.y,pressure:e.pressure},a(e)}),35)}),80))}return e},this.setChainOut=function(e){a=e},this.setSmoothing=function(e){o=(0,r.clamp)(e,0,1)}}})),i.register("eIcQa",(function(e,n){t(e.exports,"copyCanvas",(function(){return a})),t(e.exports,"testShouldPixelate",(function(){return o})),t(e.exports,"drawTransformedImageWithBounds",(function(){return s})),t(e.exports,"drawTransformedImageOnCanvas",(function(){return l})),t(e.exports,"createCheckerCanvas",(function(){return u})),t(e.exports,"createCheckerDataUrl",(function(){return h})),t(e.exports,"resizeCanvas",(function(){return d})),t(e.exports,"convertToAlphaChannelCanvas",(function(){return p})),t(e.exports,"freeCanvas",(function(){return g})),t(e.exports,"canvasBounds",(function(){return f}));var r=i("eelgW");function a(e){var t=(0,r.createCanvas)(e.width,e.height),n=t.getContext("2d");if(!n)throw new Error("2d context not supported or canvas already initialized");return n.drawImage(e,0,0),t}function o(e,t,n){if(![1,-1].includes(t)||![1,-1].includes(n)||e.width%1!=0||e.height%1!=0||Math.abs(e.angleDeg)%90!=0)return!1;var i=Math.abs(e.angleDeg-90)%180==0,r=i?e.height:e.width,a=i?e.width:e.height;return(Math.abs(r)%2==0&&e.x%1==0||Math.abs(r)%2==1&&e.x%1==.5)&&(Math.abs(a)%2==0&&e.y%1==0||Math.abs(a)%2==1&&e.y%1==.5)}function s(e,t,n,i,r){i||(i={x:0,y:0,width:t.width,height:t.height}),e.save(),r?e.imageSmoothingEnabled=!1:(e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high"),e.translate(n.x,n.y),e.rotate(n.angleDeg/180*Math.PI),e.scale(n.width>0?1:-1,n.height>0?1:-1),e.drawImage(t,i.x,i.y,i.width,i.height,-Math.abs(n.width)/2,-Math.abs(n.height)/2,Math.abs(n.width),Math.abs(n.height)),e.restore()}function l(e,t,n){(n=JSON.parse(JSON.stringify(n))).center||(n.center={x:t.width/2,y:t.height/2}),n.scale||(n.scale={x:1,y:1}),n.angleDegree||(n.angleDegree=0),n.translate||(n.translate={x:0,y:0});var i=e.getContext("2d");if(!i)throw new Error("2d context not supported or canvas already initialized");i.save(),Math.abs(n.scale.x-1)>1e-6||Math.abs(n.scale.y-1)>1e-6||Math.abs(n.angleDegree%90)>1e-6?(i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high"):i.imageSmoothingEnabled=!1,i.translate(n.translate.x,n.translate.y),i.translate(n.center.x,n.center.y),i.rotate(n.angleDegree/180*Math.PI),i.scale(n.scale.x,n.scale.y),i.translate(-n.center.x,-n.center.y),i.drawImage(t,0,0,t.width,t.height),i.restore()}var c,u=function(e){var t,n=(0,r.createCanvas)();if(e<1){if(n.width=1,n.height=1,!(t=n.getContext("2d")))throw new Error("2d context not supported or canvas already initialized");t.fillStyle="rgb(128, 128, 128)",t.fillRect(0,0,1,1)}else if(e>200)n.width=401,n.height=401;else{if(n.width=2*e,n.height=2*e,!(t=n.getContext("2d")))throw new Error("2d context not supported or canvas already initialized");t.fillStyle="rgb(255, 255, 255)",t.fillRect(0,0,2*e,2*e),t.fillStyle="rgb(200, 200, 200)",t.fillRect(0,0,e,e),t.fillRect(e,e,2*e,2*e)}return n},h=(c={8:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC",4:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC"},function(e,t){var n=function(e){if(e=parseInt(""+e),c[""+e])return c[""+e];var t=u(e).toDataURL("image/png");return c[""+e]=t,t};if(!t)return n(e);setTimeout((function(){t(n(e))}),1)});function d(e,t,n,i,a){var o,s,l,c,u;if(t&&n&&(t!==e.width||n!==e.height))if(t=Math.max(t,1),n=Math.max(n,1),t<=e.width&&n<=e.height){i=i||(0,r.createCanvas)(),a=a||(0,r.createCanvas)();var h,p,g=(o=e.width,s=e.height,l=t,c=n,(u={oldWidthEx:Math.round(Math.log2(o)),oldHeightEx:Math.round(Math.log2(s)),newWidthEx:Math.ceil(Math.log2(l)),newHeightEx:Math.ceil(Math.log2(c))}).oldWidthEx=Math.max(u.oldWidthEx,u.newWidthEx),u.oldHeightEx=Math.max(u.oldHeightEx,u.newHeightEx),u);a.width=g.oldWidthEx>g.newWidthEx?Math.pow(2,g.oldWidthEx):t,a.height=g.oldHeightEx>g.newHeightEx?Math.pow(2,g.oldHeightEx):n,i.getContext("2d").save(),a.getContext("2d").save();var f=i,m=a;h=g.oldWidthEx,p=g.oldHeightEx;var v=m.getContext("2d");v.imageSmoothingEnabled=!0,v.imageSmoothingQuality="high",v.globalCompositeOperation="copy",v.drawImage(e,0,0,m.width,m.height);for(var y=m.width,x=m.height;h>g.newWidthEx||p>g.newHeightEx;h--,p--){(v=f.getContext("2d")).imageSmoothingEnabled=!0,v.imageSmoothingQuality="high",v.globalCompositeOperation="copy";var b=h>g.newWidthEx?y/2:y,B=p>g.newHeightEx?x/2:x;f.width=b,f.height=B,v.drawImage(m,0,0,y,x,0,0,b,B),y=b,x=B;var w=f;f=m,m=w}e.width=t,e.height=n;var C=e.getContext("2d");C.save(),C.imageSmoothingEnabled=!0,C.imageSmoothingQuality="high",C.drawImage(m,0,0,y,x,0,0,t,n),C.restore(),i.getContext("2d").restore(),a.getContext("2d").restore()}else if(t>=e.width&&n>=e.height){(i=i||(0,r.createCanvas)()).width=t,i.height=n;var S=i.getContext("2d");S.save(),S.imageSmoothingEnabled=!0,S.imageSmoothingQuality="high",S.drawImage(e,0,0,t,n),S.restore(),e.width=t,e.height=n,e.getContext("2d").drawImage(i,0,0)}else d(e,t,e.height,i,a),d(e,t,n,i,a)}function p(e){for(var t=e.getContext("2d").getImageData(0,0,e.width,e.height),n=0;n<t.data.length;n+=4)0!==t.data[n+3]&&(t.data[n+3]=(t.data[n]+t.data[n+1]+t.data[n+2])/3*(t.data[n+3]/255));e.getContext("2d").putImageData(t,0,0)}function g(e){e.width=1,e.height=1;var t=e.getContext("2d");t&&t.clearRect(0,0,1,1)}function f(e){var t={x:0,y:0,width:0,height:0},n={x1:null,y1:null,x2:null,y2:null},i=e.getImageData(0,0,e.canvas.width,e.canvas.height);if(i.data[3]>0&&i.data[i.data.length-1]>0)n.x1=0,n.y1=0,n.x2=e.canvas.width-1,n.y2=e.canvas.height-1;else for(var r=3;r<i.data.length;r+=4)if(i.data[r]>0){var a=(r-3)/4%e.canvas.width,o=Math.floor((r-3)/4/e.canvas.width);(n.x1>a||null===n.x1)&&(n.x1=a),null===n.y1&&(n.y1=o),(n.x2<a||null===n.x2)&&(n.x2=a),(n.y2<o||null===n.y2)&&(n.y2=o)}return null===n.x1||null===n.y1?null:(t.x=n.x1,t.y=n.y1,t.width=n.x2-n.x1+1,t.height=n.y2-n.y1+1,t)}})),i.register("kVHNC",(function(e,n){t(e.exports,"Matrix",(function(){return r}));var i,r={getIdentity:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},multiplyMatrixAndPoint:i=function(e,t){return[t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15]]},multiplyMatrices:function(e,t){var n=[t[0],t[1],t[2],t[3]],r=[t[4],t[5],t[6],t[7]],a=[t[8],t[9],t[10],t[11]],o=[t[12],t[13],t[14],t[15]],s=i(e,n),l=i(e,r),c=i(e,a),u=i(e,o);return[s[0],s[1],s[2],s[3],l[0],l[1],l[2],l[3],c[0],c[1],c[2],c[3],u[0],u[1],u[2],u[3]]},createTranslationMatrix:function(e,t){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]},createRotationMatrix:function(e){return[Math.cos(-e),-Math.sin(-e),0,0,Math.sin(-e),Math.cos(-e),0,0,0,0,1,0,0,0,0,1]},createScaleMatrix:function(e){return[e,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]}}})),i.register("4toIY",(function(e,n){t(e.exports,"Vec2",(function(){return i}));var i={add:function(e,t){return{x:e.x+t.x,y:e.y+t.y}},sub:function(e,t){return{x:e.x-t.x,y:e.y-t.y}},nor:function(e){var t=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2));return{x:e.x/t,y:e.y/t}},len:function(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))},dist:function(e,t){return i.len(i.sub(e,t))},mul:function(e,t){return{x:e.x*t,y:e.y*t}},angle:function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},dot:function(e,t){var n=[e.x,e.y],i=[t.x,t.y];return n.map((function(e,t){return n[t]*i[t]})).reduce((function(e,t){return e+t}))}}})),i.register("af1iA",(function(e,n){t(e.exports,"projectPointOnLine",(function(){return o})),t(e.exports,"PointLine",(function(){return s})),t(e.exports,"BezierLine",(function(){return l})),t(e.exports,"SplineInterpolator",(function(){return c})),t(e.exports,"quadraticSplineInput",(function(){return u}));var r=i("4toIY"),a=i("eg83P"),o=function(e,t,n){if(e.x===t.x)return{x:e.x,y:n.y};var i=(t.y-e.y)/(t.x-e.x),r=e.y-i*e.x;return{x:(i*n.y+n.x-i*r)/(i*i+1),y:(i*i*n.y+i*n.x+r)/(i*i+1)}},s=function(e){for(var t=[],n=this,i=0;i<e.points.length;i++)!function(n){var i=void 0;n<e.points.length-1&&(i=(0,a.dist)(e.points[n].x,e.points[n].y,e.points[n+1].x,e.points[n+1].y)),t[n]={x:e.points[n].x,y:e.points[n].y,length:i}}(i);this.getAtDist=function(e){for(var i=Math.min(n.getLength(),e),r=0;i>t[r].length&&r<t.length-2;r++)i-=t[r].length;var a=Math.min(1,Math.max(0,i/t[r].length));return{x:t[r].x*(1-a)+t[r+1].x*a,y:t[r].y*(1-a)+t[r+1].y*a}},this.getLength=function(){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].length;return e}},l=function(){var e,t,n,i=this,o=[],l=0,c=null;this.add=function(i,u,h,d,p){if(!e||i!==e.x||u!==e.y)if(e={x:i,y:u},o[o.length]={x:i,y:u,spacing:h},1!==o.length){if(2===o.length)return o[0].dir=r.Vec2.nor(r.Vec2.sub(o[1],o[0])),l=h,void(c=h);var g=o[o.length-1],f=o[o.length-2],m=o[o.length-3];f.dir=r.Vec2.nor(r.Vec2.sub(g,m)),(isNaN(f.dir.x)||isNaN(f.dir.y))&&(f.dir=JSON.parse(JSON.stringify(m.dir)));var v,y,x=o[o.length-3],b=o[o.length-2],B=x,w=r.Vec2.add(x,r.Vec2.mul(x.dir,r.Vec2.dist(x,b)/4)),C=r.Vec2.sub(b,r.Vec2.mul(b.dir,r.Vec2.dist(x,b)/4)),S=b;if(d)y=function(e,t,n,i,r){for(var a,o,s=[],l=0;l<=r;l++)a=l/r,(o={}).x=Math.pow(1-a,3)*e.x+3*Math.pow(1-a,2)*a*t.x+3*(1-a)*Math.pow(a,2)*n.x+Math.pow(a,3)*i.x,o.y=Math.pow(1-a,3)*e.y+3*Math.pow(1-a,2)*a*t.y+3*(1-a)*Math.pow(a,2)*n.y+Math.pow(a,3)*i.y,s[s.length]=o;return s}(B,w,C,S,20),v=new s({points:y});else v=new s({points:[B,S]});for(var k=v.getLength(),L=(0,a.mix)(c,h,(0,a.clamp)(l/k,0,1)),M=l;M<=k;M+=L){L=(0,a.mix)(c,h,(0,a.clamp)(M/k,0,1));var E=v.getAtDist(M),A=t?(0,a.pointsToAngleDeg)(t,E):void 0;d&&d({x:E.x,y:E.y,t:M/k,angle:A,dAngle:t?A-n:0}),t=E,n=A}d?l=M-k:(l=0,p({p1:B,p2:w,p3:C,p4:S})),c=h}else c=h},this.addFinal=function(e,t,n){if(!(o.length<2)){var a=o[o.length-2],s=o[o.length-1],l=r.Vec2.add(s,r.Vec2.sub(s,a));i.add(l.x,l.y,e,t,n)}}},c=function(e){var t,n=e.length;this.xa=[],this.ya=[],this.u=[],this.y2=[];var i=e[0][0],r=e[e.length-1][0];for(e.sort((function(e,t){return e[0]-t[0]})),t=0;t<n;t++)this.xa.push(e[t][0]),this.ya.push(e[t][1]);for(this.u[0]=0,this.y2[0]=0,t=1;t<n-1;++t){var a=this.xa[t+1]-this.xa[t-1],o=(this.xa[t]-this.xa[t-1])/a,s=o*this.y2[t-1]+2;this.y2[t]=(o-1)/s;var l=(this.ya[t+1]-this.ya[t])/(this.xa[t+1]-this.xa[t])-(this.ya[t]-this.ya[t-1])/(this.xa[t]-this.xa[t-1]);this.u[t]=(6*l/a-o*this.u[t-1])/s}for(this.y2[n-1]=0,t=n-2;t>=0;--t)this.y2[t]=this.y2[t]*this.y2[t+1]+this.u[t];this.getFirstX=function(){return i},this.getLastX=function(){return r}};c.prototype.interpolate=function(e){for(var t=0,n=this.ya.length-1;n-t>1;){var i=n+t>>1;this.xa[i]>e?n=i:t=i}var r=this.xa[n]-this.xa[t],a=(this.xa[n]-e)/r,o=(e-this.xa[t])/r;return a*this.ya[t]+o*this.ya[n]+((a*a*a-a)*this.y2[t]+(o*o*o-o)*this.y2[n])*(r*r)/6},c.prototype.findX=function(e,t){for(var n=null,i=null,r=0;r<=t;r++){var a=r/t,o=this.interpolate(a);if(null!==n){var s=Math.abs(o-e);if(!(s<i))break;n=a,i=s}else n=a,i=Math.abs(o-e)}return n};var u=function(e,t,n){for(var i=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},r=[],a=0;a<=1;a+=n)r.push([i(a,4),i(e+Math.pow(a,2)*(t-e),4)]);return r}})),i.register("dJ1E2",(function(e,n){t(e.exports,"HSV",(function(){return a})),t(e.exports,"RGB",(function(){return o})),t(e.exports,"CMYK",(function(){return s})),t(e.exports,"ColorConverter",(function(){return l})),t(e.exports,"testIsWhiteBestContrast",(function(){return c}));var r=i("gFgFC"),a=function e(t,n,i){"use strict";(0,r.default)(this,e),this.h=Math.max(0,Math.min(360,t)),this.s=Math.max(.001,Math.min(100,n)),this.v=Math.max(0,Math.min(100,i))},o=function e(t,n,i){"use strict";(0,r.default)(this,e),this.r=Math.max(0,Math.min(255,t)),this.g=Math.max(0,Math.min(255,n)),this.b=Math.max(0,Math.min(255,i))},s=function e(t,n,i,a){"use strict";(0,r.default)(this,e),this.c=Math.max(0,Math.min(100,t)),this.m=Math.max(0,Math.min(100,n)),this.y=Math.max(0,Math.min(100,i)),this.k=Math.max(0,Math.min(100,a))},l={_RGBtoHSV:function(e){var t=new a(0,0,0),n=e.r/255,i=e.g/255,r=e.b/255,o=Math.min(n,i,r),s=Math.max(n,i,r),l=s-o;if(t.v=s,0==l)t.h=0,t.s=0;else{t.s=l/s;var c=((s-n)/6+l/2)/l,u=((s-i)/6+l/2)/l,h=((s-r)/6+l/2)/l;n==s?t.h=h-u:i==s?t.h=1/3+c-h:r==s&&(t.h=2/3+u-c),t.h<0&&(t.h+=1),t.h>1&&(t.h-=1)}return t.h=Math.round(360*t.h),t.s=Math.round(100*t.s),t.v=Math.round(100*t.v),t},_HSVtoRGB:function(e){var t,n,i,r,a,s,l,c,u=new o(0,0,0),h=e.h/360%1,d=e.s/100,p=e.v/100;return 0==d?(u.r=255*p,u.g=255*p,u.b=255*p):(i=p*(1-d),r=p*(1-d*((t=6*h)-(n=Math.floor(t)))),a=p*(1-d*(1-(t-n))),0==n?(s=p,l=a,c=i):1==n?(s=r,l=p,c=i):2==n?(s=i,l=p,c=a):3==n?(s=i,l=r,c=p):4==n?(s=a,l=i,c=p):(s=p,l=i,c=r),u.r=255*s,u.g=255*l,u.b=255*c,u.r=Math.round(u.r),u.g=Math.round(u.g),u.b=Math.round(u.b)),u},_CMYKtoRGB:function(e){var t=new o(0,0,0),n=e.c/100,i=e.m/100,r=e.y/100,a=e.k/100;return t.r=1-Math.min(1,n*(1-a)+a),t.g=1-Math.min(1,i*(1-a)+a),t.b=1-Math.min(1,r*(1-a)+a),t.r=Math.round(255*t.r),t.g=Math.round(255*t.g),t.b=Math.round(255*t.b),t},_RGBtoCMYK:function(e){var t=new s(0,0,0,0),n=e.r/255,i=e.g/255,r=e.b/255;return t.k=Math.min(1-n,1-i,1-r),t.c=(1-n-t.k)/(1-t.k),t.m=(1-i-t.k)/(1-t.k),t.y=(1-r-t.k)/(1-t.k),t.c=Math.round(100*t.c),t.m=Math.round(100*t.m),t.y=Math.round(100*t.y),t.k=Math.round(100*t.k),t},toRGB:function(e){return e instanceof o?e:e instanceof a?this._HSVtoRGB(e):e instanceof s?this._CMYKtoRGB(e):void 0},toHSV:function(e){return e instanceof a?e:e instanceof o?this._RGBtoHSV(e):e instanceof s?this._RGBtoHSV(this._CMYKtoRGB(e)):void 0},toCMYK:function(e){return e instanceof s?e:e instanceof o?this._RGBtoCMYK(e):e instanceof a?this._RGBtoCMYK(this._HSVtoRGB(e)):void 0},toHexString:function(e){if(e instanceof o||"r"in e&&"g"in e&&"b"in e){var t=parseInt(""+e.r).toString(16),n=parseInt(""+e.g).toString(16),i=parseInt(""+e.b).toString(16);return 1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),1==i.length&&(i="0"+i),t+n+i}},toRgbStr:function(e){return"rgb("+Math.round(e.r)+", "+Math.round(e.g)+", "+Math.round(e.b)+")"},toRgbaStr:function(e){return"rgba("+Math.round(e.r)+", "+Math.round(e.g)+", "+Math.round(e.b)+", "+e.a+")"},hexToRGB:function(e){e=(e=e.trim()).replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,i){return t+t+n+n+i+i}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?new o(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)):null}};function c(e){return.299*e.r+.587*e.g+.114*e.b<125}})),i.register("72Jv0",(function(e,n){t(e.exports,"appendTextDiv",(function(){return s})),t(e.exports,"isInputFocused",(function(){return l})),t(e.exports,"unfocusAnyInput",(function(){return c})),t(e.exports,"clearSelection",(function(){return u})),t(e.exports,"makeUnfocusable",(function(){return d})),t(e.exports,"el",(function(){return g})),t(e.exports,"destroyEl",(function(){return f}));var r=i("h4olN"),a=i("7jh4K"),o=i("eWjiX");function s(e,t){var n=document.createElement("div");return n.innerHTML=t,e.appendChild(n),n}function l(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.tagName);return e?t:t&&!document.activeElement.getAttribute("data-ignore-focus")}function c(){if(l(!0)){var e=o.BB.el({parent:document.body,tagName:"input",css:{opacity:"0",width:"0",height:"0"}});setTimeout((function(){e.select(),e.focus(),e.parentNode.removeChild(e)}),10)}}function u(){if(window.getSelection){var e=window.getSelection();e&&(e.empty?e.empty():e.removeAllRanges&&e.removeAllRanges())}else"selection"in document&&document.selection.empty()}var h,d=(h=function(e){e.preventDefault();var t=!1;if(e.relatedTarget)try{e.relatedTarget.focus(),t=!0}catch(e){console.error("failed to focus")}t||e.currentTarget.blur()},function(e){e.setAttribute("tabindex","-1"),(0,r.addEventListener)(e,"focus",h)}),p=[];function g(e){var t=document.createElement(e.tagName?e.tagName:"div");e.css&&(0,a.css)(t,e.css),e.content&&("string"==typeof e.content?t.innerHTML=e.content:Array.isArray(e.content)?o.BB.append(t,e.content):t.appendChild(e.content)),e.textContent&&(t.textContent=e.textContent),e.className&&(t.className=e.className),e.id&&(t.id=e.id),e.parent&&e.parent.appendChild(t),"title"in e&&void 0!==e.title&&(t.title=e.title);var n=[];if("onClick"in e&&((0,r.addEventListener)(t,"click",e.onClick),n.push(["click",e.onClick])),"onChange"in e&&((0,r.addEventListener)(t,"change",e.onChange),n.push(["change",e.onChange])),n.length>0&&p.push({el:t,listeners:n}),"custom"in e)for(var i=Object.keys(e.custom),s=0;s<i.length;s++)t.setAttribute(i[s],e.custom[i[s]]);return t}function f(e){for(var t=0;t<p.length;t++){var n=p[t];if(n.el===e)return n.listeners.forEach((function(t){e.removeEventListener(t[0],t[1])})),void p.splice(t,1)}}})),i.register("i0uIf",(function(e,n){t(e.exports,"BbLog",(function(){return s}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("7U0Ew"),s=function(){"use strict";function e(){(0,r.default)(this,e)}return(0,a.default)(e,null,[{key:"subscribe",value:function(t){e.listeners.includes(t)||e.listeners.push(t)}},{key:"unsubscribe",value:function(t){for(var n=0;n<e.listeners.length;n++)if(t===e.listeners[n])return void e.listeners.splice(n,1)}},{key:"emit",value:function(t){e.listeners.forEach((function(e){e(t)}))}}]),e}();(0,o.default)(s,"listeners",[])})),i.register("6l0gQ",(function(e,n){t(e.exports,"LocalStorage",(function(){return o}));var r=i("gFgFC"),a=i("kiQ5H"),o=function(){"use strict";function e(){(0,r.default)(this,e)}return(0,a.default)(e,null,[{key:"getItem",value:function(e){var t=null;try{t=localStorage.getItem(e)}catch(e){this.error=e}return t}},{key:"setItem",value:function(e,t){try{localStorage.setItem(e,t)}catch(e){this.error=e}}},{key:"removeItem",value:function(e){try{localStorage.removeItem(e)}catch(e){this.error=e}}},{key:"getError",value:function(){return this.error}}]),e}()})),i.register("c0kqC",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("l7FYj")})),i.register("fh18w",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("kbyFQ")})),i.register("lXqiv",(function(e,n){t(e.exports,"Checkbox",(function(){return s}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("eWjiX"),s=function(){"use strict";function e(t){var n=this;(0,r.default)(this,e),this.doHighlight=t.doHighlight,this.element=o.BB.el({className:"kl-checkbox"});var i=o.BB.el({parent:this.element,tagName:"label",className:"kl-checkbox__inner"});this.check=o.BB.el({parent:i,tagName:"input",css:{marginLeft:"0",display:"inline-block"},custom:{type:"checkbox"}}),this.check.checked=t.init,this.doHighlight&&this.check.checked&&this.element.classList.add("kl-checkbox--highlight"),t.allowTab||(this.check.tabIndex=-1),t.title&&(i.title=t.title);var a=document.createElement("div");a.style.display="inline-block",a.innerHTML=t.label,a.allowClick=!0,i.appendChild(a),this.check.onchange=function(){n.doHighlight&&n.element.classList.toggle("kl-checkbox--highlight",n.check.checked),t.callback(n.check.checked),setTimeout((function(){n.check.blur()}),0)},t.css&&o.BB.css(this.element,t.css)}return(0,a.default)(e,[{key:"getValue",value:function(){return this.check.checked}},{key:"setValue",value:function(e){this.check.checked=!!e,this.doHighlight&&this.element.classList.toggle("kl-checkbox--highlight",this.check.checked)}},{key:"getElement",value:function(){return this.element}},{key:"destroy",value:function(){this.check.onchange=null}}]),e}()})),i.register("c4LUw",(function(e,n){t(e.exports,"input",(function(){return a}));var r=i("eWjiX"),a=function(e){var t=document.createElement("input");if(e.type)try{t.type=e.type}catch(e){}else t.type="text";return void 0!==e.min&&(t.min=""+e.min),void 0!==e.max&&(t.max=""+e.max),t.value=""+e.init,e.callback&&(t.onchange=function(){e.callback(t.value)}),e.css&&r.BB.css(t,e.css),t}})),i.register("21VAD",(function(e,n){t(e.exports,"Select",(function(){return l}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("7U0Ew"),s=i("eWjiX"),l=function(){"use strict";function e(t){var n=this;(0,r.default)(this,e),(0,o.default)(this,"destroy",(function(){n.selectEl.removeEventListener("change",n.changeListener)})),this.selectEl=s.BB.el({tagName:"select",title:t.title,css:{cursor:"pointer",fontSize:"15px",padding:"3px",background:"#fff",colorScheme:"only light"}}),t.css&&s.BB.css(this.selectEl,t.css);var i=t.isFocusable;i||(this.selectEl.tabIndex=-1),this.optionArr=t.optionArr;for(var a=0;a<this.optionArr.length;a++)if(null!==this.optionArr[a]){var l=document.createElement("option");l.value=this.optionArr[a][0],l.textContent=this.optionArr[a][1],this.selectEl.append(l)}this.onChange=t.onChange,this.changeListener=function(e){i||n.selectEl.blur(),n.onChange(n.selectEl.value)},this.selectEl.addEventListener("change",this.changeListener),this.selectEl.value="initValue"in t?t.initValue:null}return(0,a.default)(e,[{key:"setValue",value:function(e){this.selectEl.value=e}},{key:"getValue",value:function(){return this.selectEl.value}},{key:"setDeltaValue",value:function(e){for(var t=0,n=0;n<this.optionArr.length;n++)if(""+this.optionArr[n][0]===this.selectEl.value){t=n;break}t=Math.max(0,Math.min(this.optionArr.length-1,t+e)),this.selectEl.value=this.optionArr[t][0],this.onChange(this.selectEl.value)}},{key:"getElement",value:function(){return this.selectEl}}]),e}()})),i.register("jKOQl",(function(e,n){t(e.exports,"ImageToggle",(function(){return a}));var r=i("eWjiX"),a=function(e){var t=function(){i.classList.toggle("image-toggle-active",n)},n=!!e.initValue,i=r.BB.el({className:"image-toggle",title:e.title,css:{backgroundImage:"url('"+e.image+"')"},onClick:function(i){i.preventDefault(),e.isRadio&&n||(n=!n,t(),e.onChange(n))}});t(),this.setValue=function(e){n=!!e,t()},this.getElement=function(){return i},this.getValue=function(){return n},this.destroy=function(){r.BB.destroyEl(i)}}})),i.register("gmlbk",(function(e,n){t(e.exports,"ImageRadioList",(function(){return o}));var r=i("eWjiX"),a=i("jKOQl"),o=function(e){for(var t,n=function(n,r){r.id===e.initId&&(t=n);var s=new(0,a.ImageToggle)({image:r.image,title:r.title,initValue:r.id===e.initId,isRadio:!0,onChange:function(){!function(n,i){t=n;for(var r=0;r<o.length;r++)o[r].setValue(r===t);e.onChange(i)}(n,r.id)}});return i.appendChild(s.getElement()),s},i=r.BB.el({className:"image-radio-wrapper",css:{display:"flex"}}),o=[],s=0;s<e.optionArr.length;s++)o.push(n(s,e.optionArr[s]));this.getElement=function(){return i},this.getValue=function(){return e.optionArr[t].id},this.destroy=function(){o.forEach((function(e){e.destroy()}))}}})),i.register("fCJWy",(function(n,r){t(n.exports,"penPressureToggle",(function(){return l}));var a=i("eWjiX"),o=i("e1Rnq"),s=i("1mH1z"),l=function(t,n){var i=function(){t?a.BB.css(r,{backgroundColor:"#fff",opacity:"0.9",border:"1px solid var(--active-highlight-color)"}):a.BB.css(r,{backgroundColor:"transparent",opacity:"0.5",border:"1px solid #666"})},r=a.BB.el({css:{cssFloat:"right",borderRadius:"3px",width:"18px",height:"18px",backgroundImage:'url("'+e(o)+'")',backgroundSize:"contain",backgroundRepeat:"no-repeat",cursor:"pointer",boxSizing:"border-box",colorScheme:"only light"}});return a.BB.hasPointerEvents||(r.style.display="none"),r.title=(0,s.LANG)("brush-toggle-pressure"),r.onclick=function(){t=!t,i(),n(t)},i(),n(t),r}})),i.register("e1Rnq",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("5H9IS")})),i.register("llzZ0",(function(e,n){t(e.exports,"KlSlider",(function(){return d}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("7U0Ew"),s=i("eWjiX"),l=i("l4PqG"),c=i("1mH1z"),u=i("exufe"),h=i("348ou"),d=function(){"use strict";function e(t){var n=this;(0,r.default)(this,e),(0,o.default)(this,"emitValue",null);if(this.isEnabled=!1!==t.isEnabled,this.manualInputRoundDigits=t.manualInputRoundDigits,this.useSpline=!!t.curve,!t.label)throw new Error("KlSlider missing params");if(!(0==t.min||0==t.max||0==t.value||t.min&&t.max&&t.value))throw new Error("KlSlider broken params");if(t.min>=t.max)throw new Error("KlSlider broken params");if(this.min=t.min,this.max=t.max,this.value=s.BB.clamp(t.value,this.min,this.max),this.elementWidth=t.width,this.elementHeight=t.height,this.resolution=t.resolution?t.resolution:2*this.elementWidth,this.onChange=t.onChange?t.onChange:function(){},!this.displayValueToValue!=!this.valueToDisplayValue)throw new Error("both or neither have to be set, toValue and toDisplayValue");if(this.displayValueToValue=t.toValue?t.toValue:function(e){return e},this.valueToDisplayValue=t.toDisplayValue?t.toDisplayValue:function(e){return e},this.isChangeOnFinal=!!t.isChangeOnFinal,this.formatFunc=t.formatFunc,this.eventResMs=t.eventResMs,this.useSpline){var i="quadratic"===t.curve?s.BB.quadraticSplineInput(this.min,this.max,.1):t.curve;this.splineInterpolator=new s.BB.SplineInterpolator(i)}this.roolEl=s.BB.el({css:{display:"flex"}}),this.sliderWrapperEl=s.BB.el({parent:this.roolEl,className:"sliderWrapper",css:{overflow:"hidden",position:"relative",width:this.elementWidth+"px",height:this.elementHeight+"px",userSelect:"none"}}),this.roolEl.oncontextmenu=function(){return!1},this.label=t.label;var a=this.elementHeight-14;this.textEl=s.BB.el({content:this.label,css:{position:"absolute",left:"7px",top:this.elementHeight/2-a/2+1+"px",lineHeight:a+"px",fontSize:a+"px",pointerEvents:"none"}}),this.control=s.BB.el({className:"sliderInner",css:{position:"absolute",left:"0",top:"0",width:this.valueToSliderValue(this.value)*this.elementWidth+"px",height:this.elementHeight+"px"}});var c=document.createElement("div");this.sliderWrapperEl.append(this.control,this.textEl),this.control.append(c),this.updateEnable();var h=new(0,u.DoubleTapper)({onDoubleTap:function(){n.showManualInput()}});h.setAllowedButtonArr(["left","right"]);var d,p=new(0,u.EventChain)({chainArr:[h]});this.pointerListenerTimeout=setTimeout((function(){n.pointerListener=new s.BB.PointerListener({target:n.sliderWrapperEl,maxPointers:1,fixScribble:!0,onPointer:function(e){!function(e){if(e.eventPreventDefault(),n.isEnabled){if("pointerdown"===e.type){if(s.BB.unfocusAnyInput(),n.sliderWrapperEl.className="sliderWrapper sliderWrapperActive","left"===e.button){var t=e.relX/n.elementWidth;t=Math.max(0,Math.min(1,t)),n.value=n.sliderValuetoValue(t),n.updateLabel(),n.emit(!1)}d=n.valueToSliderValue(n.value)}if("pointermove"===e.type&&["left","right"].includes(e.button)){var i=e.dX,r=Math.abs(e.pageY-e.downPageY);i*=(0,l.calcSliderFalloffFactor)(r,"right"===e.button),i/=n.elementWidth,d+=i;var a=Math.max(0,Math.min(1,d));n.value=n.sliderValuetoValue(a),n.updateLabel(),n.emit(!1)}"pointerup"===e.type&&(n.sliderWrapperEl.className="sliderWrapper",n.emit(!0))}}(e),p.chainIn(e)},onWheel:function(e){var t=n.valueToSliderValue(n.value);t=s.BB.clamp(t-e.deltaY/40,0,1),n.value=n.sliderValuetoValue(t),n.updateLabel(),n.onChange(n.value)}}),n.updateLabel()}),1)}return(0,a.default)(e,[{key:"valueToSliderValue",value:function(e){return this.useSpline?this.splineInterpolator.findX(e,Math.floor(this.resolution)):(e-this.min)/(this.max-this.min)}},{key:"sliderValuetoValue",value:function(e){var t=this.min+e*(this.max-this.min);return this.useSpline&&(t=this.splineInterpolator.interpolate(e)),t}},{key:"updateLabel",value:function(){var e=this.valueToDisplayValue(this.value);e=(e=this.formatFunc?this.formatFunc(e):Math.round(e)).toLocaleString(c.languageStrings.getCode()),this.textEl.innerHTML=this.label+'&nbsp;&nbsp;<span style="font-weight:bold">'+e+"</span>";var t=this.valueToSliderValue(this.value);this.control.style.width=t*this.elementWidth+"px"}},{key:"emit",value:function(e){var t=this;if(e||!this.isChangeOnFinal)return e||!this.eventResMs?(this.onChange(this.value),void(this.emitInterval&&(clearInterval(this.emitInterval),this.emitInterval=null))):void(this.emitInterval?this.emitValue=this.value:(this.onChange(this.value),this.emitInterval=setInterval((function(){null===t.emitValue?(clearInterval(t.emitInterval),t.emitInterval=null):(t.onChange(t.emitValue),t.emitValue=null)}),this.eventResMs)))}},{key:"updateEnable",value:function(){s.BB.css(this.sliderWrapperEl,{opacity:this.isEnabled?null:"0.5",pointerEvents:this.isEnabled?null:"none"}),this.manualInput&&this.manualInput.setIsEnabled(this.isEnabled)}},{key:"showManualInput",value:function(){var e=this;this.manualInput=new(0,h.KlSliderManualInput)(this.valueToDisplayValue(this.value),this.valueToDisplayValue(this.min),this.valueToDisplayValue(this.max),this.sliderWrapperEl.getBoundingClientRect(),(function(t){t=e.displayValueToValue(t),e.setValue(s.BB.clamp(t,e.min,e.max)),e.onChange(e.value)}),(function(){s.BB.css(e.sliderWrapperEl,{display:null}),e.roolEl.removeChild(e.manualInput.getElement()),e.manualInput.destroy(),e.manualInput=null}),this.manualInputRoundDigits&&this.manualInputRoundDigits>0?this.manualInputRoundDigits:0),this.roolEl.append(this.manualInput.getElement()),setTimeout((function(){e.manualInput.focus()})),s.BB.css(this.sliderWrapperEl,{display:"none"})}},{key:"changeSliderValue",value:function(e){if(this.isEnabled){var t=this.valueToSliderValue(this.value);t=s.BB.clamp(t+e,0,1),this.value=this.sliderValuetoValue(t),this.updateLabel(),this.onChange(this.value)}}},{key:"setValue",value:function(e){this.value=s.BB.clamp(e,this.min,this.max),this.updateLabel()}},{key:"getValue",value:function(){return this.value}},{key:"update",value:function(e){if(this.min=e.min,this.max=e.max,this.useSpline=!!e.curve,this.useSpline){var t="quadratic"===e.curve?s.BB.quadraticSplineInput(this.min,this.max,.1):e.curve;this.splineInterpolator=new s.BB.SplineInterpolator(t)}else this.splineInterpolator=null;this.setIsEnabled(!e.isDisabled)}},{key:"setIsEnabled",value:function(e){this.isEnabled=!!e,this.updateEnable()}},{key:"destroy",value:function(){clearTimeout(this.pointerListenerTimeout),this.pointerListener&&this.pointerListener.destroy(),this.manualInput&&this.manualInput.destroy(),this.emitInterval&&clearInterval(this.emitInterval)}},{key:"getElement",value:function(){return this.roolEl}}]),e}()})),i.register("l4PqG",(function(e,n){t(e.exports,"calcSliderFalloffFactor",(function(){return i}));var i=function(e,t){var n=Math.min(10,1+Math.pow(Math.floor(e/50),2));return t&&(n*=2),1/n}})),i.register("348ou",(function(e,n){t(e.exports,"KlSliderManualInput",(function(){return l}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("eWjiX"),s=i("c4LUw"),l=function(){"use strict";function e(t,n,i,a,l,c,u){var h,d=this;(0,r.default)(this,e),this.onChange=l,this.onClose=c,this.isClosed=!1,this.input=(0,s.input)({type:"number",init:t,min:n,max:i,callback:function(e){d.emit()}}),0!==u&&this.input.setAttribute("step","any"),this.input.onblur=function(){d.privateOnClose()},this.input.addEventListener("keyup",(function(e){["Enter","Escape"].includes(e.key)?d.privateOnClose():d.emit()})),this.input.addEventListener("wheel",(function(){return d.emit()})),this.scrollBefore={x:window.scrollX,y:window.scrollY},h=u||0===u?o.BB.round(t,u):t,this.lastValue=h,this.input.value=""+h,o.BB.css(this.input,{width:a.width+"px",height:a.height+"px"})}return(0,a.default)(e,[{key:"emit",value:function(){this.lastValue!==Number(this.input.value)&&(this.onChange(Number(this.input.value)),this.lastValue=Number(this.input.value))}},{key:"privateOnClose",value:function(){var e=this;this.isClosed||(this.isClosed=!0,this.emit(),this.onClose(),setTimeout((function(){window.scrollTo(e.scrollBefore.x,e.scrollBefore.y),e.scrollBefore=null})))}},{key:"getElement",value:function(){return this.input}},{key:"setIsEnabled",value:function(e){this.isEnabled=!!e}},{key:"focus",value:function(){this.input.focus(),this.input.select()}},{key:"destroy",value:function(){o.BB.destroyEl(this.input)}}]),e}()})),i.register("lfHl9",(function(n,r){t(n.exports,"HexColorDialog",(function(){return u}));var a=i("eWjiX"),o=i("c4LUw"),s=i("ekHRj"),l=i("1mH1z"),c=i("fcsnL"),u=function(t){var n=function(e,t){var n={},s=a.BB.el({css:{display:"flex",alignItems:"center",marginTop:"5px"}}),l=a.BB.el({content:e,css:{width:"60px"}}),c=(0,o.input)({init:i[t],min:0,max:255,type:"number",css:{width:"80px"},callback:function(){""===c.value||parseFloat(c.value)<0||parseFloat(c.value)>255?n.update():(c.value=""+Math.round(parseFloat(c.value)),i[t]=c.value,u.style.background="#"+a.BB.ColorConverter.toHexString(i),p.value="#"+a.BB.ColorConverter.toHexString(i))}});return s.appendChild(l),s.appendChild(c),r.appendChild(s),n.update=function(){c.value=i[t]},n.destroy=function(){c.onchange=null},n},i=new a.BB.RGB(t.color.r,t.color.g,t.color.b),r=a.BB.el({}),u=a.BB.el({css:{width:"20px",height:"20px",marginBottom:"10px",boxShadow:"inset 0 0 0 1px #fff, 0 0 0 1px #000",background:"#"+a.BB.ColorConverter.toHexString(i),colorScheme:"only light"}});r.appendChild(u);var h=a.BB.el({css:{display:"flex",alignItems:"center",marginBottom:"15px"}}),d=a.BB.el({content:(0,l.LANG)("mci-hex"),css:{width:"60px"}}),p=(0,o.input)({init:"#"+a.BB.ColorConverter.toHexString(i),css:{width:"80px"},callback:function(){var e=a.BB.ColorConverter.hexToRGB(p.value);null===e?(e=i,p.value="#"+a.BB.ColorConverter.toHexString(i)):i=e,u.style.background="#"+a.BB.ColorConverter.toHexString(e);for(var t=0;t<f.length;t++)f[t].update()}}),g=a.BB.el({tagName:"button",content:'<img src="'+e(c)+'" height="20"/>',title:(0,l.LANG)("mci-copy"),css:{marginLeft:"10px"},onClick:function(){p.select(),document.execCommand("copy")}});h.appendChild(d),h.appendChild(p),h.appendChild(g),r.appendChild(h),setTimeout((function(){p.focus(),p.select()}),0);var f=[];f.push(n((0,l.LANG)("red"),"r")),f.push(n((0,l.LANG)("green"),"g")),f.push(n((0,l.LANG)("blue"),"b")),(0,s.popup)({target:document.body,message:"<b>".concat((0,l.LANG)("manual-color-input"),"</b>"),div:r,autoFocus:!1,clickOnEnter:"Ok",buttons:["Ok","Cancel"],callback:function(e){a.BB.destroyEl(g),f.forEach((function(e){return e.destroy()})),f.splice(0,f.length),t.onClose("Ok"===e?a.BB.ColorConverter.hexToRGB(p.value):null)}})}})),i.register("fcsnL",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("la7yv")})),i.register("h7i9r",(function(n,r){t(n.exports,"KlColorSlider",(function(){return u}));var a=i("eWjiX"),o=i("lfHl9"),s=i("l4PqG"),l=i("1nsGS"),c=i("1mH1z"),u=function(t){var n=function(e){w=0===e.s?new a.BB.HSV(w.h,e.s,e.v):new a.BB.HSV(e.h,e.s,e.v)},i=function(){var e=a.BB.ColorConverter.toRGB(new a.BB.HSV(w.h,100,100));a.BB.setAttributes(M,{"stop-color":"#"+a.BB.ColorConverter.toHexString(e)})},r=function(){var e=w.s/100*v-7,t=(1-w.v/100)*y-6;a.BB.css(R,{left:e+"px",top:t+"px"})},u=function(){A.style.backgroundColor="rgb("+B.r+","+B.g+","+B.b+")",a.BB.testIsWhiteBestContrast(B)?(a.BB.css(O,{filter:"invert(1)"}),a.BB.css(N,{filter:"invert(1)"})):(a.BB.css(O,{filter:""}),a.BB.css(N,{filter:""}))},h=function(){z.style.backgroundColor=a.BB.ColorConverter.toRgbStr(C)},d=function(){var e=S;S=w,n(e),e=C,C=B,B=e,T.style.left=parseInt(""+(w.h/359*v-1))+"px",i(),r(),u(),h(),b(new a.BB.RGB(B.r,B.g,B.b))},p=this,g=function(e){},f=document.createElement("div");f.style.position="relative",f.className="colorSlider";var m=a.BB.el({css:{display:"flex",alignItems:"center"}}),v=t.width,y=t.svHeight,x=t.height,b=t.onPick,B={r:parseInt(t.startValue.r,10),g:parseInt(t.startValue.g,10),b:parseInt(t.startValue.b,10)},w=a.BB.ColorConverter.toHSV(t.startValue),C={r:255,g:255,b:255},S=a.BB.ColorConverter._RGBtoHSV(C),k=a.BB.el({}),L=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"> <defs> <linearGradient id="value" gradientTransform="rotate(90)"> <stop offset="0" stop-color="rgba(0,0,0,0)"/> <stop offset="100%" stop-color="rgba(0,0,0,1)"/> </linearGradient> <linearGradient id="hue" gradientTransform="rotate(0)"> <stop offset="0" stop-color="#fff"/> <stop id="hue-stop" offset="100%" stop-color="#f00"/> </linearGradient> </defs> <rect x="0" y="0" width="100" height="100" fill="url(\'#hue\')"/> <rect x="0" y="0" width="100" height="100" fill="url(\'#value\')"/></svg>',"image/svg+xml").documentElement,M=L.getElementById("hue-stop");a.BB.setAttributes(M,{"stop-color":"#f0f"}),a.BB.css(L,{width:v+"px",height:y+"px"}),k.appendChild(L);var E=document.createElement("div");a.BB.css(E,{position:"relative",height:x+"px"});var A=document.createElement("div"),T=document.createElement("div");i(),f.style.width=v+"px",f.oncontextmenu=function(){return!1};var I=document.createElement("div");a.BB.css(I,{width:v+"px",height:y+"px",overflow:"hidden",display:"block",position:"relative",cursor:"crosshair",boxShadow:"rgb(188, 188, 188) 0 0 0 1px"});var R=document.createElement("div");a.BB.css(R,{width:"12px",height:"12px",borderRadius:"6px",position:"absolute",pointerEvents:"none",boxShadow:"0px 0px 0 1px #000, inset 0px 0px 0 1px #fff"}),I.appendChild(k),I.appendChild(R),r(),f.appendChild(I),f.appendChild(E),m.appendChild(A),a.BB.css(A,{display:"flex",justifyContent:"space-between",width:2.5*x+"px",height:x+"px",boxShadow:"rgb(188, 188, 188) 0 0 0 1px",colorScheme:"only light"}),a.BB.css(E,{overflow:"hidden",position:"relative",width:v+"px",height:x+"px",cursor:"ew-resize",boxShadow:"rgb(188, 188, 188) 0 0 0 1px",marginTop:"1px",marginBottom:"1px"}),a.BB.css(T,{width:"1px",height:x+"px",background:"#000",borderLeft:"1px solid #fff",position:"absolute",top:"0",left:parseInt(""+(w.h/360*v-1))+"px"});var P={h:0,s:0,v:0},O=a.BB.el({title:(0,c.LANG)("eyedropper")+" [Alt]",className:"color-picker-preview-button",css:{width:"30px",height:"30px",backgroundImage:"url("+e(l)+")",backgroundRepeat:"no-repeat",backgroundSize:"70%",backgroundPosition:"center"}}),D=!1;O.onclick=function(){!1===D?(O.classList.remove("color-picker-preview-button-hover"),O.classList.add("color-picker-preview-button-active"),D=!0,g(!0)):(g(!1),p.pickingDone())};new a.BB.PointerListener({target:O,onEnterLeave:function(e){D||O.classList.toggle("color-picker-preview-button-hover",e)}});A.appendChild(O);var N=a.BB.el({content:"#",className:"color-picker-preview-button",title:(0,c.LANG)("manual-color-input"),css:{height:"100%",width:x+"px",lineHeight:x+"px",fontSize:.65*x+"px"},onClick:function(){(0,o.HexColorDialog)({color:new a.BB.RGB(B.r,B.g,B.b),onClose:function(e){e&&(p.setColor(e),b(new a.BB.RGB(B.r,B.g,B.b)))}})}});new a.BB.PointerListener({target:N,onEnterLeave:function(e){N.classList.toggle("color-picker-preview-button-hover",e)}});A.appendChild(N),u(),setTimeout((function(){!function(e){var t=new Image;a.BB.css(t,{position:"absolute",left:"0",top:"0",display:"none",pointerEvents:"none"});for(var n=a.BB.canvas(v,x),i=n.getContext("2d"),r=i.createLinearGradient(0,0,v,0),o=0;o<1;o+=.01){var s=a.BB.ColorConverter.toRGB(new a.BB.HSV(360*o,100,100)),l=parseInt(""+s.r).toString(16),c=parseInt(""+s.g).toString(16),u=parseInt(""+s.b).toString(16);1===l.length&&(l="0"+l),1===c.length&&(c="0"+c),1===u.length&&(u="0"+u),r.addColorStop(o,"#"+l+c+u)}i.fillStyle=r,i.fillRect(0,0,v,x),e.appendChild(t),t.alt="hue",t.src=n.toDataURL("image/png"),t.style.display="block"}(E),E.appendChild(T),new a.BB.PointerListener({target:k,maxPointers:1,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&(a.BB.unfocusAnyInput(),a.BB.css(I,{boxShadow:"0px 0px 0px 1px rgb(255,255,255)",zIndex:"1"}),"left"===e.button?(P.s=e.relX/v*100,P.v=100-e.relY/y*100,w=new a.BB.HSV(w.h,P.s,P.v),B=a.BB.ColorConverter.toRGB(w),r(),u(),b(a.BB.ColorConverter.toRGB(w))):(P.s=w.s,P.v=w.v)),"pointermove"===e.type&&["left","right"].includes(e.button)){var t=1;"right"===e.button&&(t=.5),P.s+=e.dX/v*100*t,P.v-=e.dY/y*100*t,w=new a.BB.HSV(w.h,P.s,P.v),B=a.BB.ColorConverter.toRGB(w),r(),u(),b(a.BB.ColorConverter.toRGB(w))}"pointerup"===e.type&&a.BB.css(I,{boxShadow:"0 0 0 1px rgb(188, 188, 188)",zIndex:"0"})}}),new a.BB.PointerListener({target:E,maxPointers:1,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&(a.BB.unfocusAnyInput(),a.BB.css(E,{boxShadow:"0px 0px 0px 1px rgba(255,255,255,1)"}),"left"===e.button?(P.h=e.relX/v*359.99,w=new a.BB.HSV(P.h,w.s,w.v),B=a.BB.ColorConverter.toRGB(w),T.style.left=Math.round(w.h/359.99*v)-1+"px",i(),u(),b(a.BB.ColorConverter.toRGB(w))):P.h=w.h),"pointermove"===e.type&&["left","right"].includes(e.button)){var t=Math.abs(e.pageY-e.downPageY),n=(0,s.calcSliderFalloffFactor)(t,"right"===e.button);P.h+=e.dX/v*359.99*n,"right"===e.button&&(P.h=P.h%359.99,P.h<0&&(P.h+=359.99)),P.h=Math.min(359.99,P.h),w=new a.BB.HSV(P.h,w.s,w.v),B=a.BB.ColorConverter.toRGB(w),T.style.left=Math.round(w.h/359.99*v)-1+"px",i(),u(),b(a.BB.ColorConverter.toRGB(w))}"pointerup"===e.type&&a.BB.css(E,{boxShadow:"rgb(188, 188, 188) 0 0 0 1px"})}})}),1);var z=a.BB.el({parent:m,title:(0,c.LANG)("secondary-color")+" [X]",css:{cursor:"pointer",marginLeft:"5px",width:"22px",height:"22px",boxShadow:"rgb(188, 188, 188) 0px 0px 0px 1px",colorScheme:"only light"},onClick:function(e){e.preventDefault(),d()}});h(),this.setColor=function(e){B={r:parseInt(e.r,10),g:parseInt(e.g,10),b:parseInt(e.b,10)},n(a.BB.ColorConverter.toHSV(e)),T.style.left=parseInt(""+(w.h/359*v-1))+"px",i(),r(),u()},this.getColor=function(){return new a.BB.RGB(B.r,B.g,B.b)},this.getSecondaryRGB=function(){return new a.BB.RGB(C.r,C.g,C.b)},this.setPickCallback=function(e){g=e},this.pickingDone=function(){D&&(D=!1,O.classList.remove("color-picker-preview-button-active"))},this.enable=function(e){e?(f.style.pointerEvents="",f.style.opacity="1",m.style.pointerEvents="",m.style.opacity="1"):(f.style.pointerEvents="none",f.style.opacity="0.5",m.style.pointerEvents="none",m.style.opacity="0.5")},this.setHeight=function(e){(e=parseInt(""+(e-2*x-3),10))!==y&&(y=e,a.BB.css(L,{width:v+"px",height:y+"px"}),I.style.height=y+"px",r())},this.swapColors=function(){d()},this.getElement=function(){return f},this.getOutputElement=function(){return m}}})),i.register("1nsGS",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("cTtMO")})),i.register("kzhsD",(function(e,n){t(e.exports,"KlSmallColorSlider",(function(){return o}));var r=i("eWjiX"),a=i("l4PqG"),o=function(e){var t=function(){for(var e=l.getContext("2d"),t=0;t<l.height;t+=1){var n=e.createLinearGradient(0,0,l.width,0),i=r.BB.ColorConverter.toRGB(new r.BB.HSV(s.h,1,100-t/l.height*100)),a=r.BB.ColorConverter.toRGB(new r.BB.HSV(s.h,100,100-t/l.height*100));n.addColorStop(0,"#"+r.BB.ColorConverter.toHexString(i)),n.addColorStop(1,"#"+r.BB.ColorConverter.toHexString(a)),e.fillStyle="#ff0000",e.fillStyle=n,e.fillRect(0,t,l.width,1)}},n=function(){var t=s.s/100*e.width-4,n=(1-s.v/100)*e.heightSV-4;r.BB.css(u,{left:t+"px",top:n+"px"})},i=function(){h.style.left=s.h/359.999*e.width-1+"px"},o=document.createElement("div");o.oncontextmenu=function(e){e.preventDefault()};var s=r.BB.ColorConverter.toHSV(new r.BB.RGB(e.color.r,e.color.g,e.color.b));r.BB.css(o,{width:e.width+"px",position:"relative",overflow:"hidden",userSelect:"none"});var l=r.BB.canvas(10,10);l.style.width=e.width+"px",l.style.height=e.heightSV+"px",l.style.cursor="crosshair",t();var c=r.BB.canvas(e.width,e.heightH);c.style.cursor="ew-resize",function(){for(var t=c.getContext("2d"),n=t.createLinearGradient(0,0,e.width,0),i=0;i<1;i+=.01){var a=r.BB.ColorConverter.toRGB(new r.BB.HSV(360*i,100,100));n.addColorStop(i,"rgba("+parseInt(""+a.r)+", "+parseInt(""+a.g)+", "+parseInt(""+a.b)+", 1)")}t.fillStyle=n,t.fillRect(0,0,e.width,e.heightH)}(),r.BB.css(l,{width:e.width+"px",height:e.heightSV+"px",overflow:"hidden",position:"relative"}),l.style.cssFloat="left",c.style.cssFloat="left",o.appendChild(l),o.appendChild(c);var u=document.createElement("div");r.BB.css(u,{width:"8px",height:"8px",borderRadius:"8px",position:"absolute",pointerEvents:"none",boxShadow:"0 0 0 1px #000, inset 0 0 0 1px #fff"}),o.appendChild(u);var h=document.createElement("div");r.BB.css(h,{width:"0",height:e.heightH+"px",borderLeft:"1px solid #fff",borderRight:"1px solid #000",position:"absolute",top:e.heightSV+"px",pointerEvents:"none"}),o.appendChild(h),n(),i();var d={h:0,s:0,v:0},p=null,g=new r.BB.PointerListener({target:l,maxPointers:1,fixScribble:!0,onPointer:function(t){if("pointerdown"===t.type&&(r.BB.unfocusAnyInput(),p=t.pointerId,"left"===t.button?(d.s=t.relX/e.width*100,d.v=100-t.relY/e.heightSV*100,s=new r.BB.HSV(s.h,d.s,d.v),n(),e.callback(r.BB.ColorConverter.toRGB(s))):(d.s=s.s,d.v=s.v)),"pointermove"===t.type&&["left","right"].includes(t.button)&&p===t.pointerId){var i=1;"right"===t.button&&(i=.5),d.s+=t.dX/e.width*100*i,d.v-=t.dY/e.heightSV*100*i,s=new r.BB.HSV(s.h,d.s,d.v),n(),e.callback(r.BB.ColorConverter.toRGB(s))}"pointerup"===t.type&&(p=null)}}),f=null,m=new r.BB.PointerListener({target:c,maxPointers:1,fixScribble:!0,onPointer:function(n){if("pointerdown"===n.type&&(f=n.pointerId,"left"===n.button?(d.h=n.relX/e.width*359.99,s=new r.BB.HSV(d.h,s.s,s.v),t(),i(),e.callback(r.BB.ColorConverter.toRGB(s))):d.h=s.h),"pointermove"===n.type&&["left","right"].includes(n.button)&&f===n.pointerId){var o=Math.abs(n.pageY-n.downPageY),l=(0,a.calcSliderFalloffFactor)(o,"right"===n.button);d.h+=n.dX/e.width*359.99*l,"right"===n.button&&(d.h=d.h%359.99,d.h<0&&(d.h+=359.99)),d.h=Math.min(359.99,d.h),s=new r.BB.HSV(d.h,s.s,s.v),t(),i(),e.callback(r.BB.ColorConverter.toRGB(s))}"pointerup"===n.type&&(f=null)}}),v=document.createElement("div");v.style.clear="both",o.appendChild(v),this.setColor=function(e){s=r.BB.ColorConverter.toHSV(new r.BB.RGB(e.r,e.g,e.b)),t(),n(),i()},this.getColor=function(){return r.BB.ColorConverter.toRGB(s)},this.getElement=function(){return o},this.destroy=function(){g.destroy(),m.destroy()},this.end=function(){p=null,f=null}}})),i.register("bd9hB",(function(e,n){t(e.exports,"PointSlider",(function(){return a}));var r=i("eWjiX"),a=function(e){var t=function(){s.style.left=a+"px",s.style.boxShadow=l?"0 0 6px rgba(0,0,0,1)":"0 0 3px rgba(0,0,0,0.8)"},n=function(){return a/(e.width-e.pointSize)},i=document.createElement("div");i.style.position="relative";var a,o=r.BB.el({}),s=r.BB.el({css:{colorScheme:"only light"}});i.appendChild(o),i.appendChild(s);var l=!1;r.BB.css(o,{marginTop:parseInt(""+(e.pointSize/2-1))+"px",height:"2px",background:"#aaa",width:e.width+"px"});var c,u,h;r.BB.el({parent:s,css:{margin:"-7px 0 0 -7px",width:"calc(100% + 14px)",height:"calc(100% + 7px)"}});a=r.BB.clamp(e.init*(e.width-e.pointSize),0,e.width-e.pointSize),r.BB.css(s,{position:"absolute",top:"0px",backgroundColor:"#eaeaea",boxShadow:"0 0 3px rgba(0,0,0,0.8)",width:e.pointSize+"px",height:e.pointSize+"px",borderRadius:e.pointSize+"px",cursor:"ew-resize",transition:"box-shadow 0.2s ease-in-out"}),t(),c=new r.BB.PointerListener({target:s,fixScribble:!0,onPointer:function(i){"pointerdown"===i.type&&"left"===i.button?(u=!0,l=!0,h=a,t(),i.eventStopPropagation()):"pointermove"===i.type&&"left"===i.button&&(i.eventStopPropagation(),h+=i.dX,a=parseInt(""+r.BB.clamp(h,0,e.width-e.pointSize)),t(),e.callback(n(),u,!1),u=!1),"pointerup"===i.type&&(i.eventStopPropagation(),l=!1,t(),e.callback(n(),!1,!0))}}),this.getEl=function(){return i},this.setActive=function(e){s.style.backgroundColor=e?"#fff":"#eaeaea"},this.destroy=function(){c.destroy()}}})),i.register("9A7OD",(function(e,n){t(e.exports,"ColorOptions",(function(){return a}));var r=i("eWjiX"),a=function(e){for(var t=function(){for(var e=0;e<o.length;e++)o[e].setIsSelected(e===i)},n=r.BB.el({content:e.label?e.label:"",css:{display:"flex",alignItems:"center",colorScheme:"only light"}}),i=0,a=[],o=[],s=r.BB.createCheckerDataUrl(5),l=0;l<e.colorArr.length;l++){for(var c=e.colorArr[l],u=!1,h=0;h<a.length;h++){var d=a[h];if(null!==d&&null!==c&&(d.r===c.r&&d.g===c.g&&d.b===c.b&&d.a===c.a)){u=!0;break}}u||(a.push(c),"initialIndex"in e&&e.initialIndex===l&&(i=a.length-1))}for(var p=0;p<a.length;p++)!function(l){var c=r.BB.el({content:a[l]?"":"X",css:{width:"22px",height:"22px",backgroundColor:a[l]?r.BB.ColorConverter.toRgbaStr(a[l]):"transparent",marginLeft:"7px",boxShadow:"0 0 0 1px #aaa",cursor:"pointer",userSelect:"none",textAlign:"center",lineHeight:"23px",color:"#aaa"}});a[l]&&0===a[l].a&&(c.style.backgroundImage="url("+s+")"),c.onclick=function(n){n.preventDefault(),i=l,t(),e.onChange(a[l])},c.setIsSelected=function(e){e?r.BB.css(c,{boxShadow:"0 0 0 2px var(--active-highlight-color), 0 0 5px 0 var(--active-highlight-color)",pointerEvents:"none"}):r.BB.css(c,{boxShadow:"0 0 0 1px #aaa",pointerEvents:""})},n.appendChild(c),o.push(c)}(p);t(),this.getElement=function(){return n},this.destroy=function(){o.forEach((function(e){e.onclick=null})),o.splice(0,o.length)}}})),i.register("iskOY",(function(e,n){t(e.exports,"Options",(function(){return a}));var r=i("eWjiX"),a=function(e){for(var t=function(t){var i={id:t.id,el:null},a=["kl-option"];e.isSmall&&a.push("kl-option--small"),"string"!=typeof t.label&&(a.push("kl-option--custom-el"),r.BB.css(t.label,{display:"block",pointerEvents:"none"})),i.el=r.BB.el({parent:o,content:t.label,className:a.join(" "),onClick:function(){l!==i.id&&(l=i.id,n(),e.onChange(l))}}),t.title&&(i.el.title=t.title),s.push(i)},n=function(){for(var e=0;e<s.length;e++)s[e].el.classList.toggle("kl-option-selected",s[e].id===l)},i=function(){for(var e=0;e<s.length;e++)if(s[e].id===l)return e},a=r.BB.el({}),o=r.BB.el({parent:a,className:"kl-option-wrapper",css:{display:"flex"}}),s=[],l=("initialId"in e?e.initialId:e.optionArr[0].id),c=0;c<e.optionArr.length;c++)t(e.optionArr[c]);n(),e.changeOnInit&&setTimeout((function(){e.onChange(l)}),0),this.getElement=function(){return a},this.getValue=function(){return l},this.next=function(){l=s[(i()+1)%s.length].id,n(),e.onChange(l)},this.previous=function(){l=s[(s.length+i()-1)%s.length].id,n(),e.onChange(l)},this.destroy=function(){s.forEach((function(e){r.BB.destroyEl(e.el)})),s.splice(0,s.length)}}})),i.register("bmB93",(function(n,r){t(n.exports,"StatusOverlay",(function(){return c}));var a=i("gFgFC"),o=i("kiQ5H"),s=i("eWjiX"),l=i("bv5Zj"),c=function(){"use strict";function t(){(0,a.default)(this,t),this.init()}return(0,o.default)(t,[{key:"updateUiState",value:function(){this.el&&(setTimeout((function(){}),100),"left"===this.uiState?this.el.style.left="271px":this.el.style.removeProperty("left"))}},{key:"init",value:function(){this.el=s.BB.el({className:"top-overlay g-root",onClick:s.BB.handleClick}),this.isWide&&(this.el.style.width="100%"),this.updateUiState(),this.innerEl=s.BB.el({className:"top-overlay-inner"}),this.angleIm=new Image,this.angleIm.src=e(l),s.BB.css(this.angleIm,{verticalAlign:"bottom",width:"20px",height:"20px",marginLeft:"5px",borderRadius:"10px"}),this.innerInnerEl=document.createElement("div"),this.innerInnerEl.style.display="inline-block",this.innerEl.appendChild(this.innerInnerEl),this.innerEl.appendChild(this.angleIm),this.el.appendChild(this.innerEl),document.body.appendChild(this.el),this.el.style.display="none"}},{key:"setWide",value:function(e){this.isWide=!!e,this.el&&(this.isWide?(this.el.style.width="100%",this.el.style.left=""):(this.el.style.removeProperty("width"),this.el.style.left="left"===this.uiState?"271px":""))}},{key:"setUiState",value:function(e){this.uiState=e,this.updateUiState()}},{key:"out",value:function(e,t){var n=this;e&&"object"==typeof e?"transform"===e.type?(this.angleIm.style.display="inline-block",this.angleIm.style.transform="rotate("+e.angleDeg+"deg)",e.angleDeg%90==0?this.angleIm.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.7)":this.angleIm.style.boxShadow="",this.innerInnerEl.innerHTML=Math.round(100*e.scale)+"%"):this.angleIm.style.display="none":"string"==typeof e&&(this.angleIm.style.display="none",this.innerInnerEl.innerHTML=e),t&&(this.innerEl.style.animation="",setTimeout((function(){return n.innerEl.style.animation="top-overlay-pulse 0.5s ease-out"}),20),this.timeout3&&clearTimeout(this.timeout3),this.timeout3=window.setTimeout((function(){return n.innerEl.style.animation=""}),520)),this.timeout&&clearTimeout(this.timeout),this.timeout2&&clearTimeout(this.timeout2),this.el.style.animationName=t?"consoleInFast":"consoleIn",this.el.style.opacity="1",this.timeout=window.setTimeout((function(){n.el.style.opacity="0",n.el.style.animationName="consoleOut",n.timeout2=window.setTimeout((function(){n.el.style.display="none",n.timeout2=0}),450),n.timeout=0}),1200),this.el.style.display="flex"}}]),t}()})),i.register("bv5Zj",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("iQ1f0")})),i.register("auloj",(function(e,n){t(e.exports,"exportDialog",(function(){return o}));var r=i("eWjiX"),a=i("ekHRj");function o(e,t){var n,i,o,s,l,c,u,h;i=!1,o=!1,n=document.createElement("div"),r.BB.css(n,{width:"308px"}),s=document.createElement("div"),(l=new Image).src=t.src,s.appendChild(l),s.appendChild(t),r.BB.css(s,{width:"264px",height:"176px",marginTop:"21px",marginLeft:"21px",position:"relative",overflow:"hidden",boxShadow:"0 0 10px 4px rgba(255,255,255, 0)",border:"1px solid rgba(255, 255, 255, 1)",transition:"box-shadow 0.7s linear"}),r.BB.css(t,{position:"absolute",left:"0",top:"0",width:"264px",height:"176px",opacity:"0"}),(c={width:264,height:264/t.width*t.height}).height<176&&(c.height=176,c.width=c.height/t.height*t.width),r.BB.css(l,{position:"absolute",top:"88px",left:"132px",width:c.width+"px",height:c.height+"px",marginLeft:-c.width/2+"px",marginTop:-c.height/2+"px"}),function e(){i||((o=!o)?r.BB.css(s,{border:"1px solid rgba(0, 0, 0, 1)"}):r.BB.css(s,{border:"1px solid rgba(200, 200, 200, 1)"}),setTimeout(e,510))}(),(u=document.createElement("div")).innerHTML="Right-Click or Press-Hold on the image, then save.",u.ontouchstart=function(){return!1},r.BB.css(u,{fontSize:"17.6px",color:"#666",padding:"10px",textAlign:"center"}),n.appendChild(s),n.appendChild(u),t.ontouchstart=function(){r.BB.css(s,{boxShadow:"0 0 10px 8px rgba(0,255,255, 1)"}),!0,h=setTimeout((function(){!1,r.BB.css(s,{boxShadow:"0 0 10px 4px rgba(0,255,255, 0)"})}),1500)},t.ontouchmove=function(){r.BB.css(s,{boxShadow:"0 0 10px 4px rgba(0,255,255, 0)"}),!1,clearTimeout(h)},t.ontouchend=function(){r.BB.css(s,{boxShadow:"0 0 10px 4px rgba(0,255,255, 0)"}),!1,clearTimeout(h)},(0,a.popup)({target:e,message:"<b>Save Image</b>",div:n,buttons:["Close"],callback:function(e){i=!0}})}})),i.register("hRdOL",(function(e,n){t(e.exports,"CropCopy",(function(){return a}));var r=i("eWjiX");function a(e){var t,n=function(){t={x:0,y:0,width:e.canvas.width,height:e.canvas.height}},i=function(){u.width=Math.round(t.width),u.height=Math.round(t.height),u.getContext("2d").drawImage(e.canvas,Math.round(-t.x),Math.round(-t.y)),d&&(d.src=u.toDataURL("image/png")),e.onChange&&e.onChange(u.width,u.height)},a=function(){r.BB.css(w,{left:x+t.x*m+"px",top:b+t.y*v+"px",width:t.width*m+"px",height:t.height*v+"px"}),e.onChange&&e.onChange(Math.round(t.width),Math.round(t.height))},o=function(t){return{x:r.BB.clamp((t.x-x)/m,0,e.canvas.width),y:r.BB.clamp((t.y-b)/v,0,e.canvas.height)}},s=function(e,t){var n={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)},i={x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)},r=o(n),a=o(i);return r.x=Math.floor(r.x),r.y=Math.floor(r.y),a.x=Math.ceil(a.x),a.y=Math.ceil(a.y),{x:r.x,y:r.y,width:a.x-r.x,height:a.y-r.y}},l=function(){return 0===t.x&&0===t.y&&t.width===e.canvas.width&&t.height===e.canvas.height},c=document.createElement("div");r.BB.css(c,{position:"relative",height:e.height+"px",width:e.width+"px",overflow:"hidden",colorScheme:"only light"}),c.style.position="relative",n();var u=r.BB.canvas(),h=u,d=null;e.isNotCopy||(d=new Image,h=d),r.BB.css(h,{height:e.height+"px",width:e.width+"px"}),c.appendChild(h),i();var p=r.BB.el({css:{width:e.width+"px",height:e.height+"px",position:"absolute",left:"0",top:"0",pointerEvents:"none"}});c.appendChild(p),r.BB.createCheckerDataUrl(4,(function(e){p.style.backgroundImage="url("+e+")"}));var g=r.BB.fitInto(e.canvas.width,e.canvas.height,e.width-40,e.height-40,1),f=r.BB.canvas(Math.round(g.width),Math.round(g.height));f.style.imageRendering="pixelated";var m=f.width/e.canvas.width,v=f.height/e.canvas.height,y=f.getContext("2d");y.imageSmoothingEnabled=!1,y.drawImage(e.canvas,0,0,f.width,f.height),p.appendChild(f);var x=parseInt(""+(e.width-f.width)/2),b=parseInt(""+(e.height-f.height)/2);r.BB.css(f,{position:"absolute",left:x+"px",top:b+"px"});var B,w=r.BB.el({css:{position:"absolute",boxShadow:"0 0 0 1px #fff, 0 0 0 2px #000, 0 0 40px 1px #000"}});p.appendChild(w),a();var C,S=null,k=!1,L=!1,M=new r.BB.PointerListener({target:h,fixScribble:!0,onPointer:function(o){var c,u;"pointerdown"===o.type&&"left"===o.button?(o.eventPreventDefault(),k=!0,B={x:o.relX,y:o.relY},!l()&&(c=B,u={x:Math.round(x+t.x*m),y:Math.round(b+t.y*v),width:Math.round(t.width*m),height:Math.round(t.height*v)},r.BB.isInsideRect(c,u))?S={x:t.x,y:t.y,width:t.width,height:t.height}:t=s(B,B)):"pointermove"===o.type&&"left"===o.button?(o.eventPreventDefault(),L=!0,S?(t.x=S.x+Math.round((o.relX-B.x)/m),t.y=S.y+Math.round((o.relY-B.y)/v),t.x=r.BB.clamp(t.x,0,e.canvas.width-t.width),t.y=r.BB.clamp(t.y,0,e.canvas.height-t.height)):t=s(B,{x:o.relX,y:o.relY}),a()):"pointerup"===o.type&&B&&(o.eventPreventDefault(),k=!1,S=null,B=null,0!==t.width&&0!==t.height&&L||(n(),a()),L=!1,C=setTimeout(i,1))}}),E=new r.BB.KeyListener({onDown:function(n,o,s){if(!k){var l=!1,c=Math.max(1,1/m),u=E.isPressed("shift");"left"===n&&(u?t.width=r.BB.clamp(t.width-c,1,e.canvas.width-t.x):t.x=r.BB.clamp(t.x-c,0,e.canvas.width-t.width),l=!0),"right"===n&&(u?t.width=r.BB.clamp(t.width+c,1,e.canvas.width-t.x):t.x=r.BB.clamp(t.x+c,0,e.canvas.width-t.width),l=!0),"up"===n&&(u?t.height=r.BB.clamp(t.height-c,1,e.canvas.height-t.y):t.y=r.BB.clamp(t.y-c,0,e.canvas.height-t.height),l=!0),"down"===n&&(u?t.height=r.BB.clamp(t.height+c,1,e.canvas.height-t.y):t.y=r.BB.clamp(t.y+c,0,e.canvas.height-t.height),l=!0),l&&(o.preventDefault(),a(),clearTimeout(C),C=setTimeout(i,100))}}});this.getEl=function(){return c},this.reset=function(){n(),i(),a()},this.destroy=function(){h.style.removeProperty("width"),h.style.removeProperty("height"),E.destroy(),M.destroy()},this.isReset=function(){return l()},this.getRect=function(){return JSON.parse(JSON.stringify(t))},this.getCroppedImage=function(){return u}}})),i.register("isYih",(function(n,r){t(n.exports,"clipboardDialog",(function(){return d}));var a=i("3kC7t"),o=i("7U0Ew"),s=i("cijLd"),l=i("eWjiX"),c=i("ekHRj"),u=i("hRdOL"),h=i("1mH1z");function d(t,n,i,r,d){var p=function(){var t=x.getCroppedImage().toDataURL("image/png");setTimeout((0,a.default)(e(s).mark((function n(){var i,a;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:return i=e.sent,e.next=6,i.blob();case 6:return a=e.sent,e.next=9,navigator.clipboard.write([new ClipboardItem((0,o.default)({},a.type,a))]);case 9:setTimeout((function(){r.out((0,h.LANG)("cropcopy-copied"),!0)}),200),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0.name,e.t0.message);case 15:case"end":return e.stop()}}),n,null,[[0,12]])}))),0)},g=function(){b()},f=!1;try{f=!!ClipboardItem}catch(e){}var m=document.createElement("div"),v=window.innerWidth<550||window.innerHeight<550,y=l.BB.el({content:(0,h.LANG)("crop-drag-to-crop")+(f?"":"<br>"+(0,h.LANG)("cropcopy-click-hold")),css:{textAlign:"center"}});m.appendChild(y);var x=new(0,u.CropCopy)({width:v?340:540,height:v?300:350,canvas:n,clipboardItemIsSupported:f});l.BB.css(x.getEl(),{marginTop:"10px",marginLeft:"-20px",borderTop:"1px solid #bbb",borderBottom:"1px solid #bbb"}),m.appendChild(x.getEl());var b,B=new l.BB.KeyListener({onDown:function(e,t,n){"ctrl+c"===n&&(p(),b())}});l.BB.addEventListener(window,"blur",g);var w=[];f&&w.push((0,h.LANG)("cropcopy-btn-copy")),d&&w.push((0,h.LANG)("cropcopy-btn-crop")),w.push("Cancel"),(0,c.popup)({target:t,message:"<b>"+(d?"".concat((0,h.LANG)("cropcopy-title-copy")," / ").concat((0,h.LANG)("cropcopy-title-crop")):"".concat((0,h.LANG)("cropcopy-title-copy")))+"</b>",div:m,style:v?{}:{width:"500px"},buttons:w,primaries:[(0,h.LANG)("cropcopy-btn-copy")],callback:function(e){if(e===(0,h.LANG)("cropcopy-btn-copy"))p();else if(e===(0,h.LANG)("cropcopy-btn-crop")){var t=x.getRect();i({left:Math.round(-t.x),right:Math.round(t.x+t.width-n.width),top:Math.round(-t.y),bottom:Math.round(t.y+t.height-n.height)})}l.BB.removeEventListener(window,"blur",g),x.destroy(),B.destroy()},clickOnEnter:(0,h.LANG)("cropcopy-btn-copy"),closefunc:function(e){b=e}})}})),i.register("5rdL4",(function(n,r){t(n.exports,"klLayerManager",(function(){return x}));var a=i("eWjiX"),o=i("ekHRj"),s=i("gWfkn"),l=i("iskOY"),c=i("21VAD"),u=i("bd9hB"),h=i("d42vI"),d=i("dKwR8"),p=i("3VpTB"),g=i("8yL1I"),f=i("g91IK"),m=i("705qg"),v=i("1mH1z"),y=i("bBcC4");function x(t,n,i){var r,x=function(t){var n=document.createElement("div"),r=a.BB.el({content:(0,v.LANG)("layers-rename-name")+":",css:{marginRight:"5px"}}),l=a.BB.el({css:{display:"flex"}}),c=document.createElement("input");c.value=k.getLayer(t).name,c.setAttribute("data-ignore-focus","true");var u=a.BB.el({tagName:"Button",content:'<img src="'+e(g)+'" height="20"/>',title:(0,v.LANG)("layers-rename-clear"),css:{marginLeft:"10px"},onClick:function(){c.value="",c.focus()}}),h=[(0,v.LANG)("layers-rename-sketch"),(0,v.LANG)("layers-rename-colors"),(0,v.LANG)("layers-rename-shading"),(0,v.LANG)("layers-rename-lines"),(0,v.LANG)("layers-rename-effects"),(0,v.LANG)("background"),(0,v.LANG)("layers-rename-foreground")],d=[],p=a.BB.el({css:{display:"flex",flexWrap:"wrap",marginTop:"5px",marginLeft:"-5px"}});h.forEach((function(e){var t=a.BB.el({parent:p,tagName:"Button",content:e,onClick:function(){c.value=t.textContent},css:{margin:"5px 0 0 5px"}});d.push(t)})),n.appendChild(r),r.append(l,p),l.append(c,u),setTimeout((function(){c.focus(),c.select()}),10),(0,o.popup)({target:i,message:"<b>".concat((0,v.LANG)("layers-rename-title"),"</b>"),div:n,buttons:[(0,v.LANG)("layers-rename"),"Cancel"],primaries:[(0,v.LANG)("layers-rename")],callback:function(e){if(a.BB.destroyEl(u),d.forEach((function(e){a.BB.destroyEl(e)})),d.splice(0,d.length),e===(0,v.LANG)("layers-rename")){if(c.value===k.getLayer(t).name)return;k.renameLayer(t,c.value),b(),s.klHistory.pause(!0),A(t),s.klHistory.pause(!1)}},clickOnEnter:(0,v.LANG)("layers-rename")})},b=function(){function e(e){var t=k.getLayer(e).name,n=D[e].opacity,i=D[e].context.canvas,r=document.createElement("div");r.className="layerBox",L[e]=r,r.posY=35*(D.length-1)-35*e,a.BB.css(r,{width:"250px",height:"34px",backgroundColor:"rgb( 220, 220, 220)",border:"1px solid #aaa",position:"absolute",left:"0 px",top:r.posY+"px",transition:"all 0.1s linear",borderRadius:"5px",boxSizing:"border-box"});var o=document.createElement("div");a.BB.css(o,{position:"relative"});var l=document.createElement("div");a.BB.css(l,{width:"250px",height:"34px"});var c=document.createElement("div");r.appendChild(o),o.appendChild(l),o.appendChild(c),r.spot=e;var h,d=a.BB.fitInto(i.width,i.height,30,30,1),p=r.thumb=a.BB.canvas(d.width,d.height),g=p.getContext("2d");g.save(),p.width>i.width&&(g.imageSmoothingEnabled=!1),g.drawImage(i,0,0,p.width,p.height),g.restore(),a.BB.css(r.thumb,{position:"absolute",left:(32-r.thumb.width)/2+"px",top:(32-r.thumb.height)/2+"px",colorScheme:"only light"}),a.BB.createCheckerDataUrl(4,(function(e){p.style.backgroundImage="url("+e+")"})),r.label=document.createElement("div"),r.lname=t,r.label.append(r.lname),a.BB.css(r.label,{position:"absolute",left:"38px",top:"1px",fontSize:"13px",width:"170px",height:"20px",overflow:"hidden",color:"#666",whiteSpace:"nowrap"}),r.label.ondblclick=function(){x(r.spot)},r.opacityLabel=document.createElement("div"),r.opacity=n,r.opacityLabel.append(parseInt(""+100*r.opacity)+"%"),a.BB.css(r.opacityLabel,{position:"absolute",left:"194px",top:"1px",fontSize:"13px",textAlign:"right",width:"50px",color:"#666",transition:"color 0.2s ease-in-out"});var f=new(0,u.PointSlider)({init:r.opacity,width:204,pointSize:14,callback:function(e,t,n){return t?(h=k.getLayer(r.spot).opacity,void s.klHistory.pause(!0)):n?(s.klHistory.pause(!1),void(h!==e&&k.layerOpacity(r.spot,e))):(r.opacityLabel.innerHTML=Math.round(100*e)+"%",void k.layerOpacity(r.spot,e))}});a.BB.css(f.getEl(),{position:"absolute",left:"39px",top:"17px"}),r.opacitySlider=f,a.BB.setEventListener(r.thumb,"onpointerover",(function(e){if(0===e.buttons||e.pointerType&&"touch"===e.pointerType){var t=a.BB.fitInto(i.width,i.height,250,250,1);P.width===t.width&&P.height===t.height||(P.width=t.width,P.height=t.height);var n=P.getContext("2d");n.save(),P.width>i.width&&(n.imageSmoothingEnabled=!1),n.imageSmoothingQuality="high",n.clearRect(0,0,P.width,P.height),n.drawImage(i,0,0,P.width,P.height),n.restore(),a.BB.css(T,{top:e.clientY-P.height/2+"px",opacity:"0"}),!1===O&&(document.body.appendChild(T),O=!0),clearTimeout(R),R=setTimeout((function(){a.BB.css(T,{opacity:"1"})}),20),clearTimeout(I)}})),a.BB.setEventListener(r.thumb,"onpointerout",(function(){clearTimeout(R),a.BB.css(T,{opacity:"0"}),clearTimeout(I),I=setTimeout((function(){O&&(document.body.removeChild(T),O=!1)}),300)})),l.appendChild(r.thumb),l.appendChild(r.label),l.appendChild(r.opacityLabel),l.appendChild(f.getEl());var m=!1,v=!1;r.pointerListener=new a.BB.PointerListener({target:l,maxPointers:1,onPointer:function(e){if("pointerdown"===e.type&&"left"===e.button)a.BB.css(r,{transition:"box-shadow 0.3s ease-in-out"}),r.style.zIndex="1",W=r.spot,v=!1,r.isSelected||(v=!0,z.activateLayer(r.spot)),m=!0;else if("pointermove"===e.type&&"left"===e.button){m&&(m=!1,a.BB.css(r,{boxShadow:"1px 3px 5px rgba(0,0,0,0.4)"})),r.posY+=e.dY;var t=Math.max(0,Math.min(35*(D.length-1),r.posY));r.style.top=t+"px",w(r.spot,B(r.posY))}if("pointerup"===e.type){a.BB.css(r,{transition:"all 0.1s linear"}),setTimeout((function(){a.BB.css(r,{boxShadow:""})}),20),r.posY=Math.max(0,Math.min(35*(D.length-1),r.posY)),r.style.zIndex="";var n=B(r.posY),i=r.spot;C(r.spot,n),i!=n&&(s.klHistory.pause(!0),A(N),s.klHistory.pause(!1)),i===n&&v&&A(N),v=!1}}}),j.appendChild(r)}for(r=s.klHistory.getState(),L=[];j.firstChild;){var t=j.firstChild;t.pointerListener.destroy(),t.opacitySlider.destroy(),j.removeChild(t)}for(var n=0;n<D.length;n++)e(n);z.activateLayer(N),S()},B=function(e){var t=parseInt(""+(e/(M+E)+.5));return t=Math.min(D.length-1,Math.max(0,t)),t=D.length-t-1},w=function(e,t){if((t=Math.min(D.length-1,Math.max(0,t)))!==W){for(var n=0;n<D.length;n++)if(L[n].spot!==e){var i=L[n].spot;L[n].spot>e&&i--,i>=t&&i++,L[n].posY=(M+E)*(D.length-i-1),L[n].style.top=L[n].posY+"px"}W=t}},C=function(e,t){if(isNaN(e)||isNaN(t))throw"layermanager - invalid move";for(var n=0;n<D.length;n++)!function(n){var i=L[n].spot;L[n].spot===e?i=t:(L[n].spot>e&&i--,i>=t&&i++),L[n].spot=i,L[n].posY=(M+E)*(D.length-i-1),L[n].style.top=L[n].posY+"px"}(n);e!==t&&(k.moveLayer(N,t-e),D=k.getLayers(),N=t,V.disabled=0===N)},S=function(){j.style.height=35*L.length+"px"},k=t,L=[],M=35,E=0,A=n,T=a.BB.el({onClick:a.BB.handleClick,css:{position:"absolute",right:"280px",top:"500px",background:"#aaa",boxShadow:"1px 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none",padding:"0",border:"1px solid #aaa",transition:"opacity 0.3s ease-out",userSelect:"none",colorScheme:"only light"}});a.BB.createCheckerDataUrl(4,(function(e){T.style.backgroundImage="url("+e+")"}));var I,R,P=a.BB.canvas(200,200);P.style.display="block",T.appendChild(P);var O=!1,D=k.getLayers(),N=D.length-1,z=document.createElement("div");z.style.marginRight="10px",z.style.marginBottom="10px",z.style.marginLeft="10px",z.style.marginTop="10px",z.style.cursor="default";var G=document.createElement("div");a.BB.css(G,{width:"250px",position:"relative"});var j=a.BB.el({});z.disableButtons=function(){},z.enableButtons=function(){};var H,X,F=document.createElement("button"),U=document.createElement("button"),V=document.createElement("button"),Y=document.createElement("button"),K=document.createElement("button");z.appendChild(function(){var t=document.createElement("div");return setTimeout((function(){a.BB.makeUnfocusable(F),a.BB.makeUnfocusable(U),a.BB.makeUnfocusable(V),a.BB.makeUnfocusable(Y),a.BB.makeUnfocusable(K),F.style.cssFloat="left",U.style.cssFloat="left",V.style.cssFloat="left",Y.style.cssFloat="left",K.style.cssFloat="left",F.title=(0,v.LANG)("layers-new"),U.title=(0,v.LANG)("layers-duplicate"),Y.title=(0,v.LANG)("layers-remove"),V.title=(0,v.LANG)("layers-merge"),K.title=(0,v.LANG)("layers-rename-title"),F.style.paddingLeft="5px",F.style.paddingRight="3px",Y.style.paddingLeft="5px",Y.style.paddingRight="3px",U.style.paddingLeft="5px",U.style.paddingRight="3px",V.style.paddingLeft="5px",V.style.paddingRight="3px",K.style.height="30px",K.style.lineHeight="20px",F.innerHTML="<img src='"+e(h)+"' height='20'/>",U.innerHTML="<img src='"+e(d)+"' height='20'/>",V.innerHTML="<img src='"+e(p)+"' height='20'/>",Y.innerHTML="<img src='"+e(g)+"' height='20'/>",K.innerHTML="<img src='"+e(f)+"' height='20'/>",F.style.marginRight="5px",Y.style.marginRight="5px",U.style.marginRight="5px",V.style.marginRight="5px",t.appendChild(F),t.appendChild(Y),t.appendChild(U),t.appendChild(V),t.appendChild(K),t.appendChild(a.BB.el({css:{clear:"both"}}));var n=document.createElement("div");n.style.clear="both",n.style.height="10px",t.appendChild(n),F.onclick=function(){!1!==k.addLayer(N)&&((D=k.getLayers()).length===m.MAX_LAYERS&&(F.disabled=!0,U.disabled=!0),Y.disabled=!1,N+=1,b(),s.klHistory.pause(!0),A(N),s.klHistory.pause(!1))},U.onclick=function(){!1!==k.duplicateLayer(N)&&((D=k.getLayers()).length===m.MAX_LAYERS&&(F.disabled=!0,U.disabled=!0),Y.disabled=!1,N++,b(),s.klHistory.pause(!0),A(N),s.klHistory.pause(!1))},Y.onclick=function(){L.length<=1||(k.removeLayer(N),N>0&&N--,D=k.getLayers(),b(),s.klHistory.pause(!0),A(N),s.klHistory.pause(!1),1===D.length&&(Y.disabled=!0),D.length<m.MAX_LAYERS&&(F.disabled=!1,U.disabled=!1))},V.onclick=function(){N<=0||function(e){var t=document.createElement("div");t.innerHTML=(0,v.LANG)("layers-merge-description");var n=new(0,l.Options)({optionArr:[{id:e.mixModeStr,label:(0,y.translateBlending)(e.mixModeStr)},{id:"source-in",label:"source-in"},{id:"source-out",label:"source-out"},{id:"source-atop",label:"source-atop"},{id:"destination-in",label:"destination-in"},{id:"destination-out",label:"destination-out"},{id:"destination-atop",label:"destination-atop"},{id:"xor",label:"xor"}],initId:e.mixModeStr,onChange:function(e){h()},isSmall:!0});n.getElement().style.marginTop="5px",t.appendChild(n.getElement());var r=a.BB.fitInto(e.topCanvas.width,e.topCanvas.height,200,200,1),s=a.BB.canvas(r.width,r.height);s.title=(0,v.LANG)("preview");var c=document.createElement("div");c.innerHTML="<br/>",c.style.clear="both",t.appendChild(c),t.appendChild(s),a.BB.css(s,{display:"block",marginLeft:"auto",marginRight:"auto",colorScheme:"only light"}),s.style.boxShadow="0 0 3px rgba(0,0,0,0.5)",a.BB.createCheckerDataUrl(4,(function(e){s.style.backgroundImage="url("+e+")"}));var u=a.BB.copyCanvas(s);function h(){var t=s.getContext("2d");t.save(),t.clearRect(0,0,s.width,s.height),s.width>e.topCanvas.width&&(t.imageSmoothingEnabled=!1),t.drawImage(e.bottomCanvas,0,0,s.width,s.height),"as-alpha"===n.getValue()?(t.globalCompositeOperation="destination-in",t.globalAlpha=e.topOpacity,t.drawImage(u,0,0,s.width,s.height)):(t.globalCompositeOperation=n.getValue(),t.globalAlpha=e.topOpacity,t.drawImage(e.topCanvas,0,0,s.width,s.height)),t.restore()}u.getContext("2d").drawImage(e.topCanvas,0,0,u.width,u.height),a.BB.convertToAlphaChannelCanvas(u),h();var d=new a.BB.KeyListener({onDown:function(e){"right"===e&&n.next(),"left"===e&&n.previous()}});(0,o.popup)({target:i,message:"<b>".concat((0,v.LANG)("layers-merge-modal-title"),"</b>"),div:t,buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(t){d.destroy(),n.destroy(),"Ok"===t&&e.callback(n.getValue())}})}({topCanvas:D[N].context.canvas,bottomCanvas:D[N-1].context.canvas,topOpacity:k.getLayer(N).opacity,mixModeStr:D[N].mixModeStr,callback:function(e){k.mergeLayers(N,N-1,e),D=k.getLayers(),N--,1===D.length&&(Y.disabled=!0),D.length<m.MAX_LAYERS&&(F.disabled=!1,U.disabled=!1),b(),s.klHistory.pause(!0),A(N),s.klHistory.pause(!1)}})},K.onclick=function(){x(N)}}),1),t}()),H=a.BB.el({content:(0,v.LANG)("layers-blending")+"&nbsp;",css:{fontSize:"15px"}}),X=new(0,c.Select)({optionArr:["source-over",null,"darken","multiply","color-burn",null,"lighten","screen","color-dodge",null,"overlay","soft-light","hard-light",null,"difference","exclusion",null,"hue","saturation","color","luminosity"].map((function(e){return e?[e,(0,y.translateBlending)(e)]:null})),onChange:function(e){k.setMixMode(N,e),z.update(N)},css:{marginBottom:"10px"}}),H.appendChild(X.getElement()),z.appendChild(H),G.appendChild(j),z.appendChild(G);var W=0;setInterval((function(){if("block"===z.style.display){var e=s.klHistory.getState();if(e!==r){r=e;for(var t=0;t<L.length;t++)if(N===L[t].spot&&D[L[t].spot]){var n=L[t].thumb.getContext("2d");n.save(),n.clearRect(0,0,n.canvas.width,n.canvas.height),D[L[t].spot].context.canvas.width<L[t].thumb.width&&(n.imageSmoothingEnabled=!1),n.drawImage(D[L[t].spot].context.canvas,0,0,L[t].thumb.width,L[t].thumb.height),n.restore()}}}}),1);return z.update=function(e){D=k.getLayers(),(e||0===e)&&(N=e),Y.disabled=1===D.length,D.length===m.MAX_LAYERS?(F.disabled=!0,U.disabled=!0):(F.disabled=!1,U.disabled=!1),setTimeout((function(){b()}),1)},z.getSelected=function(){return N},z.activateLayer=function(e){if(e<0||e>L.length-1)throw"invalid spotIndex "+e+", layerElArr.length "+L.length;N=e,X.setValue(D[N].mixModeStr);for(var t=0;t<L.length;t++)N===L[t].spot?(L[t].style.backgroundColor="rgb( 250, 250, 250)",L[t].label.style.color="#000",L[t].style.boxShadow="",L[t].style.border="1px solid var(--active-highlight-color)",L[t].opacitySlider.setActive(!0),L[t].isSelected=!0):(L[t].style.backgroundColor="rgb( 220, 220, 220)",L[t].label.style.color="#666",L[t].style.boxShadow="",L[t].style.border="1px solid rgb(158, 158, 158)",L[t].opacitySlider.setActive(!1),L[t].isSelected=!1);V.disabled=0===N},z.setUiState=function(e){"left"===""+e?a.BB.css(T,{left:"280px",right:""}):a.BB.css(T,{left:"",right:"280px"})},b(),z}})),i.register("d42vI",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("1mb1v")})),i.register("dKwR8",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("11KJK")})),i.register("3VpTB",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("floUo")})),i.register("8yL1I",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("kino6")})),i.register("g91IK",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("hhQeq")})),i.register("705qg",(function(e,n){t(e.exports,"MAX_LAYERS",(function(){return f})),t(e.exports,"KlCanvas",(function(){return m}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("eWjiX"),s=i("30Cml"),l=i("3ujzu"),c=i("h20yl"),u=i("gWfkn"),h=i("aSJRf"),d=i("1mH1z"),p=i("7EG77"),g=["source-over","darken","multiply","color-burn","lighten","screen","color-dodge","overlay","soft-light","hard-light","difference","exclusion","hue","saturation","color","luminosity"],f=16,m=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((0,r.default)(this,e),this.layerNrOffset=n,this.layerCanvasArr=[],this.pickCanvas=o.BB.canvas(1,1),this.history=new(0,u.DecoyKlHistory),"copy"in t?(this.width=1,this.height=1):"width"in t&&"height"in t?(this.width=t.width,this.height=t.height):(this.width=1,this.height=1),this.init(this.width,this.height),this.changeListenerArr=[],"copy"in t)try{this.copy(t.copy)}catch(e){throw this.destroy(),e}else if("projectObj"in t){var i=[].concat(t.projectObj.layers);if(this.init(t.projectObj.width,t.projectObj.height),!i.length)throw new Error("project.layers needs at least 1 layer");for(var a=0;a<i.length;a++){if(i[a].mixModeStr&&!g.includes(i[a].mixModeStr))throw new Error("unknown mixModeStr "+i[a].mixModeStr);this.addLayer(),this.layerOpacity(a,i[a].opacity),this.layerCanvasArr[a].name=i[a].name,this.layerCanvasArr[a].mixModeStr=i[a].mixModeStr?i[a].mixModeStr:"source-over",this.layerCanvasArr[a].getContext("2d").drawImage(i[a].image,0,0)}}this.updateIndices()}return(0,a.default)(e,[{key:"init",value:function(e,t){if(!e||!t||isNaN(e)||isNaN(t)||e<1||t<1)throw new Error("init - invalid canvas size: "+e+", "+t);this.width=e,this.height=t}},{key:"emitChange",value:function(){this.changeListenerArr.forEach((function(e){return e()}))}},{key:"updateIndices",value:function(){this.layerCanvasArr.forEach((function(e,t){e.index=t}))}},{key:"setHistory",value:function(e){this.history=e}},{key:"reset",value:function(e){if(!e.width||!e.height||e.width<1||e.height<1||isNaN(e.width)||isNaN(e.height))throw new Error("invalid canvas size");if(this.history.pause(!0),this.width=e.width,this.height=e.height,this.layerCanvasArr.splice(1,Math.max(0,this.layerCanvasArr.length-1)),e.layers)for(var t=0;t<e.layers.length;t++){var n=e.layers[t];this.layerCanvasArr[t]||this.addLayer(),this.layerCanvasArr[t].name=n.name,this.layerCanvasArr[t].width=this.width,this.layerCanvasArr[t].height=this.height,this.layerCanvasArr[t].mixModeStr=n.mixModeStr?n.mixModeStr:"source-over",this.layerCanvasArr[t].getContext("2d").drawImage(n.image,0,0),this.layerOpacity(t,n.opacity)}else this.layerCanvasArr[0].name=e.layerName?e.layerName:(0,d.LANG)("layers-layer")+" 1",this.layerCanvasArr[0].width=this.width,this.layerCanvasArr[0].height=this.height,this.layerCanvasArr[0].mixModeStr="source-over",this.layerOpacity(0,1),e.color?this.layerFill(0,e.color):e.image&&this.layerCanvasArr[0].getContext("2d").drawImage(e.image,0,0);return this.updateIndices(),this.history.pause(!1),this.history.push({tool:["canvas"],action:"reset",params:[e]}),this.layerCanvasArr.length-1}},{key:"isLayerLimitReached",value:function(){return this.layerCanvasArr.length>=f}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"copy",value:function(e){if(e.getWidth()<1||e.getHeight()<1||isNaN(e.getWidth())||isNaN(e.getHeight()))throw new Error("invalid canvas size");for(var t=e.getLayers();this.layerCanvasArr.length>t.length;)this.removeLayer(this.layerCanvasArr.length-1);e.getWidth()==this.width&&e.getHeight()==this.height||this.init(e.getWidth(),e.getHeight());for(var n=0;n<t.length;n++)n>=this.layerCanvasArr.length?this.addLayer():(this.layerCanvasArr[n].width=this.width,this.layerCanvasArr[n].height=this.height),this.layerOpacity(n,t[n].opacity),this.layerCanvasArr[n].name=t[n].name,this.layerCanvasArr[n].mixModeStr=t[n].mixModeStr,this.layerCanvasArr[n].getContext("2d").drawImage(t[n].context.canvas,0,0);this.updateIndices()}},{key:"getLayerCount",value:function(){return this.layerCanvasArr.length}},{key:"resize",value:function(e,t){var n,i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"smooth";if(!e||!t||e===this.width&&t===this.height||isNaN(e)||isNaN(t)||e<1||t<1)return!1;if(e=Math.max(e,1),t=Math.max(t,1),"pixelated"===r){var a=(n=o.BB.canvas(e,t)).getContext("2d");a.imageSmoothingEnabled=!1;for(var s=0;s<this.layerCanvasArr.length;s++){s>0&&a.clearRect(0,0,e,t);var l=this.layerCanvasArr[s];a.drawImage(l,0,0,e,t),l.width=e,l.height=t;var c=l.getContext("2d");c.drawImage(n,0,0)}}else{if("smooth"!==r)throw new Error("unknown resize algorithm");n=o.BB.canvas(),i=o.BB.canvas();for(var u=0;u<this.layerCanvasArr.length;u++)o.BB.resizeCanvas(this.layerCanvasArr[u],e,t,n,i)}return this.width=e,this.height=t,!0}},{key:"resizeCanvas",value:function(e){var t=Math.round(e.left)+this.width+Math.round(e.right),n=Math.round(e.top)+this.height+Math.round(e.bottom),i=Math.round(e.left),r=Math.round(e.top);if(isNaN(t)||isNaN(n)||t<1||n<1)throw new Error("KlCanvas.resizeCanvas - invalid canvas size");for(var a=0;a<this.layerCanvasArr.length;a++){var s=o.BB.canvas(this.width,this.height),l=this.layerCanvasArr[a],c=this.layerCanvasArr[a].getContext("2d");s.getContext("2d").drawImage(l,0,0),this.layerCanvasArr[a].width=t,this.layerCanvasArr[a].height=n,c.save(),0===a&&e.fillColor&&(c.fillStyle=o.BB.ColorConverter.toRgbStr(e.fillColor),c.fillRect(0,0,t,n),c.clearRect(i,r,this.width,this.height)),c.drawImage(s,i,r),c.restore()}this.width=t,this.height=n}},{key:"addLayer",value:function(e){if(this.isLayerLimitReached())return!1;var t=o.BB.canvas(this.width,this.height);if(!t.getContext("2d"))throw new Error("kl-create-canvas-error");return t.mixModeStr="source-over",void 0===e?(this.layerCanvasArr[this.layerCanvasArr.length]=t,e=Math.max(0,this.layerCanvasArr.length-1)):(this.layerCanvasArr.splice(e+1,0,t),e++),t.name=(0,d.LANG)("layers-layer")+" "+(this.layerCanvasArr.length+this.layerNrOffset),this.history.pause(!0),this.layerOpacity(e,1),this.history.pause(!1),this.updateIndices(),this.history.push({tool:["canvas"],action:"addLayer",params:[e-1]}),e}},{key:"duplicateLayer",value:function(e){if(!this.layerCanvasArr[e]||this.isLayerLimitReached())return!1;var t=o.BB.canvas(this.width,this.height);return this.layerCanvasArr.splice(e+1,0,t),t.name=this.layerCanvasArr[e].name+" "+(0,d.LANG)("layers-copy"),t.mixModeStr=this.layerCanvasArr[e].mixModeStr,t.getContext("2d").drawImage(this.layerCanvasArr[e],0,0),this.history.pause(!0),this.layerOpacity(e+1,this.layerCanvasArr[e].opacity),this.history.pause(!1),this.updateIndices(),this.history.push({tool:["canvas"],action:"duplicateLayer",params:[e]}),e+1}},{key:"getLayerContext",value:function(e,t){if(this.layerCanvasArr[e])return this.layerCanvasArr[e].getContext("2d");if(t)return null;throw new Error("layer of index "+e+" not found (in "+this.layerCanvasArr.length+" layers)")}},{key:"removeLayer",value:function(e){return!!this.layerCanvasArr[e]&&(this.layerCanvasArr.splice(e,1),this.updateIndices(),this.history.push({tool:["canvas"],action:"removeLayer",params:[e]}),Math.max(0,e-1))}},{key:"renameLayer",value:function(e,t){return!!this.layerCanvasArr[e]&&(this.layerCanvasArr[e].name=t,this.history.push({tool:["canvas"],action:"renameLayer",params:[e,t]}),!0)}},{key:"layerOpacity",value:function(e,t){this.layerCanvasArr[e]&&(t=Math.max(0,Math.min(1,t)),this.layerCanvasArr[e].opacity=t,this.history.push({tool:["canvas"],action:"layerOpacity",params:[e,t]}),this.emitChange())}},{key:"moveLayer",value:function(e,t){if(0!==t&&this.layerCanvasArr[e]){var n=this.layerCanvasArr[e];this.layerCanvasArr.splice(e,1);var i=Math.max(0,Math.min(e+t,this.layerCanvasArr.length));return this.layerCanvasArr.splice(i,0,n),this.updateIndices(),this.history.push({tool:["canvas"],action:"moveLayer",params:[e,t]}),i}}},{key:"mergeLayers",value:function(e,t,n){if(this.layerCanvasArr[e]&&this.layerCanvasArr[t]&&e!==t){if(e>t){var i=e;e=t,t=i}var r=this.layerCanvasArr[t].opacity;if(0!==r&&r){var a=this.layerCanvasArr[e].getContext("2d");a.save(),"as-alpha"===n?(o.BB.convertToAlphaChannelCanvas(this.layerCanvasArr[t]),a.globalCompositeOperation="destination-in",a.globalAlpha=r,this.layerCanvasArr[e].getContext("2d").drawImage(this.layerCanvasArr[t],0,0)):(n&&(a.globalCompositeOperation=n),a.globalAlpha=r,this.layerCanvasArr[e].getContext("2d").drawImage(this.layerCanvasArr[t],0,0)),a.restore(),n&&(a.save(),a.fillStyle="rgba(0,0,0,0.01)",a.fillRect(-.9999999,-.9999999,1,1),a.restore())}return this.updateIndices(),this.history.pause(!0),this.removeLayer(t),this.history.pause(!1),this.history.push({tool:["canvas"],action:"mergeLayers",params:[e,t,n]}),e}}},{key:"rotate",value:function(e){for(;e<0;)e+=360;if((e%=360)%90==0&&0!==e){var t=o.BB.canvas();0===e||180===e?(t.width=this.width,t.height=this.height):90!==e&&270!==e||(t.width=this.height,t.height=this.width);for(var n=t.getContext("2d"),i=0;i<this.layerCanvasArr.length;i++)n.clearRect(0,0,t.width,t.height),n.save(),n.translate(t.width/2,t.height/2),n.rotate(e*Math.PI/180),180===e?n.drawImage(this.layerCanvasArr[i],-t.width/2,-t.height/2):90!==e&&270!==e||n.drawImage(this.layerCanvasArr[i],-t.height/2,-t.width/2),this.layerCanvasArr[i].width=t.width,this.layerCanvasArr[i].height=t.height,this.layerCanvasArr[i].getContext("2d").clearRect(0,0,this.layerCanvasArr[i].width,this.layerCanvasArr[i].height),this.layerCanvasArr[i].getContext("2d").drawImage(t,0,0),n.restore();this.width=t.width,this.height=t.height}}},{key:"flip",value:function(e,t,n){if(e||t){var i=o.BB.canvas(this.width,this.height);i.width=this.width,i.height=this.height;for(var r=i.getContext("2d"),a=0;a<this.layerCanvasArr.length;a++)(!n&&0!==n||a===n)&&(r.save(),r.clearRect(0,0,i.width,i.height),r.translate(i.width/2,i.height/2),r.scale(e?-1:1,t?-1:1),r.drawImage(this.layerCanvasArr[a],-i.width/2,-i.height/2),r.restore(),this.layerCanvasArr[a].getContext("2d").clearRect(0,0,this.layerCanvasArr[a].width,this.layerCanvasArr[a].height),this.layerCanvasArr[a].getContext("2d").drawImage(i,0,0))}}},{key:"layerFill",value:function(e,t,n){var i=this.layerCanvasArr[e].getContext("2d");i.save(),n&&(i.globalCompositeOperation=n),i.fillStyle="rgba("+t.r+","+t.g+","+t.b+",1)",i.fillRect(0,0,this.layerCanvasArr[e].width,this.layerCanvasArr[e].height),i.restore(),i.save(),i.fillStyle="rgba(0,0,0,0.01)",i.fillRect(-.9999999,-.9999999,1,1),i.restore(),this.history.push({tool:["canvas"],action:"layerFill",params:[e,t,n]})}},{key:"floodFill",value:function(e,t,n,i,r,a,l,c,u){if(!(t<0||n<0||t>=this.width||n>=this.height||0===r)){if(a=Math.round(a),!["above","current","all"].includes(l))throw new Error("invalid sampleStr");var h,d,p,g,f,m,v;if("all"===l){var y=1===this.layerCanvasArr.length?this.layerCanvasArr[0]:this.getCompleteCanvas(1);g=(p=(d=y.getContext("2d")).getImageData(0,0,this.width,this.height)).data,h=(0,s.floodFillBits)(g,this.width,this.height,t,n,a,Math.round(c),u),y=null,d=null,p=null,g=null,m=(f=this.layerCanvasArr[e].getContext("2d")).getImageData(0,0,this.width,this.height)}else{var x="above"===l?e+1:e;if(x>=this.layerCanvasArr.length)return;g=(p=(d=this.layerCanvasArr[x].getContext("2d")).getImageData(0,0,this.width,this.height)).data,h=(0,s.floodFillBits)(g,this.width,this.height,t,n,a,Math.round(c),u),e!==x&&(d=null,p=null,g=null),f=e===x?d:this.layerCanvasArr[e].getContext("2d"),m=e===x?p:f.getImageData(0,0,this.width,this.height)}if(v=m.data,i)if(1===r)for(var b=0;b<this.width*this.height;b++)255===h.data[b]&&(v[4*b]=i.r,v[4*b+1]=i.g,v[4*b+2]=i.b,v[4*b+3]=255);else for(var B=0;B<this.width*this.height;B++)255===h.data[B]&&(v[4*B]=o.BB.mix(v[4*B],i.r,r),v[4*B+1]=o.BB.mix(v[4*B+1],i.g,r),v[4*B+2]=o.BB.mix(v[4*B+2],i.b,r),v[4*B+3]=o.BB.mix(v[4*B+3],255,r));else if(1===r)for(var w=0;w<this.width*this.height;w++)255===h.data[w]&&(v[4*w+3]=0);else for(var C=0;C<this.width*this.height;C++)255===h.data[C]&&(v[4*C+3]=o.BB.mix(v[4*C+3],0,r));f.putImageData(m,0,0),this.history.push({tool:["canvas"],action:"replaceLayer",params:[e,m]})}}},{key:"drawShape",value:function(e,t){t.x1===t.x2&&t.y1===t.y2||((0,l.drawShape)(this.layerCanvasArr[e].getContext("2d"),t),this.history.push({tool:["canvas"],action:"drawShape",params:[e,o.BB.copyObj(t)]}))}},{key:"drawGradient",value:function(e,t){(0,p.drawGradient)(this.layerCanvasArr[e].getContext("2d"),t),this.history.push({tool:["canvas"],action:"drawGradient",params:[e,o.BB.copyObj(t)]})}},{key:"text",value:function(e,t){(0,c.renderText)(this.layerCanvasArr[e],o.BB.copyObj(t)),this.history.push({tool:["canvas"],action:"text",params:[e,o.BB.copyObj(t)]})}},{key:"replaceLayer",value:function(e,t){this.layerCanvasArr[e].getContext("2d").putImageData(t,0,0),this.history.push({tool:["canvas"],action:"replaceLayer",params:[e,t]})}},{key:"clearLayer",value:function(e){var t=this.layerCanvasArr[e].getContext("2d");t.save(),t.clearRect(0,0,this.layerCanvasArr[e].width,this.layerCanvasArr[e].height),t.restore(),this.history.push({tool:["canvas"],action:"clearLayer",params:[e]})}},{key:"getLayers",value:function(){return this.layerCanvasArr.map((function(e){return{context:e.getContext("2d"),opacity:e.opacity,name:e.name,mixModeStr:e.mixModeStr}}))}},{key:"getLayersFast",value:function(){return this.layerCanvasArr.map((function(e){return{canvas:e,opacity:e.opacity,name:e.name,mixModeStr:e.mixModeStr}}))}},{key:"getLayerIndex",value:function(e,t){for(var n=0;n<this.layerCanvasArr.length;n++)if(this.layerCanvasArr[n]===e)return n;if(!t)throw new Error("layer not found (in "+this.layerCanvasArr.length+" layers)");return null}},{key:"getLayer",value:function(e,t){if(this.layerCanvasArr[e])return{context:this.layerCanvasArr[e].getContext("2d"),opacity:this.layerCanvasArr[e].opacity,name:this.layerCanvasArr[e].name,id:e};if(!t)throw new Error("layer of index "+e+" not found (in "+this.layerCanvasArr.length+" layers)");return null}},{key:"getColorAt",value:function(e,t){e=Math.floor(e),t=Math.floor(t);var n=this.pickCanvas.getContext("2d");n.save(),n.imageSmoothingEnabled=!1,n.clearRect(0,0,1,1);for(var i=0;i<this.layerCanvasArr.length;i++)n.globalAlpha=this.layerCanvasArr[i].opacity,n.globalCompositeOperation=this.layerCanvasArr[i].mixModeStr,n.drawImage(this.layerCanvasArr[i],-e,-t);n.restore();var r=n.getImageData(0,0,1,1);return new o.BB.RGB(r.data[0],r.data[1],r.data[2])}},{key:"getCompleteCanvas",value:function(e){return(0,h.drawProject)(this.getProject(),e)}},{key:"getProject",value:function(){return{width:this.width,height:this.height,layers:this.layerCanvasArr.map((function(e){return{name:e.name,opacity:e.opacity,mixModeStr:e.mixModeStr,image:e}}))}}},{key:"addChangeListener",value:function(e){this.changeListenerArr.includes(e)||this.changeListenerArr.push(e)}},{key:"removeChangeListener",value:function(e){for(var t=0;t<this.changeListenerArr.length;t++)if(this.changeListenerArr[t]===e)return void this.changeListenerArr.splice(t,1)}},{key:"setMixMode",value:function(e,t){if(!this.layerCanvasArr[e])throw new Error("invalid layer");this.layerCanvasArr[e].mixModeStr=t,this.history.push({tool:["canvas"],action:"setMixMode",params:[e,""+t]})}},{key:"setComposite",value:function(e,t){if(!this.layerCanvasArr[e])throw new Error("invalid layer");this.layerCanvasArr[e].compositeObj=t}},{key:"destroy",value:function(){null!==this.layerCanvasArr&&(this.layerCanvasArr.forEach((function(e){o.BB.freeCanvas(e)})),this.layerCanvasArr=null)}}]),e}()})),i.register("30Cml",(function(e,n){function i(e,t,n,i,r,a){for(var o=n;o<=r;o++)for(var s=i;s<=a;s++)255!==e[s*t+o]&&(e[s*t+o]=254)}var r,a;function o(e,t,n,i,o){return r=n%e+i,a=Math.floor(n/e)+o,r<0||a<0||r>=e||a>=t?null:a*e+r}function s(e,t,n,i,r,a,o){return null!==o&&255!==t[o]&&((e[4*o]===r[0]&&e[4*o+1]===r[1]&&e[4*o+2]===r[2]&&e[4*o+3]===r[3]||a>0&&Math.abs(e[4*o]-r[0])<=a&&Math.abs(e[4*o+1]-r[1])<=a&&Math.abs(e[4*o+2]-r[2])<=a&&Math.abs(e[4*o+3]-r[3])<=a)&&(t[o]=255,!0))}function l(e,t,n,r,a,l,c,u){r=Math.round(r),a=Math.round(a);var h=new Uint8Array(new ArrayBuffer(t*n));return function(e,t,n,r,a,l,c,u,h){var d=[e[4*(l*n+a)],e[4*(l*n+a)+1],e[4*(l*n+a)+2],e[4*(l*n+a)+3]];if(h){var p,g,f=[];for(f.push(l*n+a),t[l*n+a]=255;f.length;)s(e,t,0,0,d,c,g=o(n,r,p=f.pop(),-1,0))&&f.push(g),s(e,t,0,0,d,c,g=o(n,r,p,1,0))&&f.push(g),s(e,t,0,0,d,c,g=o(n,r,p,0,-1))&&f.push(g),s(e,t,0,0,d,c,g=o(n,r,p,0,1))&&f.push(g)}else for(var m=0;m<n*r;m++)s(e,t,0,0,d,c,m);if(0!==u){for(var v,y,x,b,B,w,C,S,k,L,M,E,A=0;A<n;A++)for(var T=0;T<r;T++)255===t[T*n+A]&&(v=A,y=A,x=T,b=T,B=255!==t[T*n+A-1],w=255!==t[(T-1)*n+A-1],C=255!==t[(T-1)*n+A],S=255!==t[(T-1)*n+A+1],k=255!==t[T*n+A+1],L=255!==t[(T+1)*n+A+1],M=255!==t[(T+1)*n+A],E=255!==t[(T+1)*n+A-1],B&&(v=A-u),B&&w&&C&&(v=A-u,x=T-u),C&&(x=Math.min(x,T-u)),C&&S&&k&&(x=Math.min(x,T-u),y=A+u),k&&(y=Math.max(y,A+1*u)),k&&L&&M&&(y=Math.max(y,A+1*u),b=Math.max(b,T+1*u)),M&&(b=Math.max(b,T+1*u)),M&&E&&B&&(v=Math.min(v,A-1*u),b=Math.max(b,T+1*u)),(B||w||C||S||k||L||M||E)&&i(t,n,Math.max(0,v),Math.max(0,x),Math.min(n-1,y),Math.min(r-1,b)));for(var I=0;I<n*r;I++)254===t[I]&&(t[I]=255)}}(e,h,t,n,r,a,l,c,u),{data:h}}t(e.exports,"floodFillBits",(function(){return l}))})),i.register("3ujzu",(function(e,n){t(e.exports,"ShapeTool",(function(){return a})),t(e.exports,"drawShape",(function(){return o}));var r=i("eWjiX");function a(e){var t,n,i;this.onDown=function(e,r,a){t=e,n=r,i=a},this.onMove=function(r,a){e.onShape(!1,t,n,r,a,i)},this.onUp=function(r,a){e.onShape(!0,t,n,r,a,i)}}function o(e,t){if(function(e,t){for(var n in t)n in e||(e[n]=t[n])}(t=r.BB.copyObj(t),{angleRad:0,isOutwards:!1,opacity:1,isEraser:!1,doLockAlpha:!1}),!["rect","ellipse","line"].includes(t.type))throw new Error("unknown shape");var n=Math.round(t.lineWidth),i=180*t.angleRad/Math.PI,a=t.isEraser?{r:255,g:255,b:255}:t.fillRgb?t.fillRgb:t.strokeRgb;e.save(),t.opacity&&(e.globalAlpha=t.opacity),t.isEraser&&(e.globalCompositeOperation="destination-out"),t.doLockAlpha&&(e.globalCompositeOperation="source-atop"),e.rotate(-t.angleRad),t.fillRgb?e.fillStyle=r.BB.ColorConverter.toRgbStr(a):t.strokeRgb&&(e.strokeStyle=r.BB.ColorConverter.toRgbStr(a),e.lineWidth=n);var o=t.x1,s=t.y1,l=t.x2,c=t.y2;if(t.isAngleSnap){var u=r.BB.rotate(o,s,t.angleRad/Math.PI*180),h=r.BB.rotate(l,c,t.angleRad/Math.PI*180),d=r.BB.pointsToAngleDeg(u,h)+90,p=45*Math.round(d/45),g=r.BB.rotateAround({x:o,y:s},{x:l,y:c},p-d);l=g.x,c=g.y,(i+p)%90==0&&(Math.round((i-p)/90)%2==0?l=o:c=s)}var f,m,v=o,y=s,x=l-o,b=c-s;if("line"!==t.type&&t.isFixedRatio){var B=r.BB.rotate(t.x1,t.y1,t.angleRad/Math.PI*180),w=r.BB.rotate(t.x2,t.y2,t.angleRad/Math.PI*180),C=B.x,S=B.y,k=w.x-B.x,L=w.y-B.y;Math.abs(k)<Math.abs(L)?L=Math.abs(k)*(L<0?-1:1):k=Math.abs(L)*(k<0?-1:1),w.x=C+k,w.y=S+L,B=r.BB.rotate(B.x,B.y,-t.angleRad/Math.PI*180),w=r.BB.rotate(w.x,w.y,-t.angleRad/Math.PI*180),v=o=B.x,y=s=B.y,x=(l=w.x)-o,b=(c=w.y)-s}if(t.isOutwards&&(o=v-=x,s=y-=b,l=v+(x*=2),c=y+(b*=2)),"line"===t.type){var M=Math.round(o),E=Math.round(s),A=Math.round(l),T=Math.round(c),I=Math.floor(o),R=Math.floor(s),P=Math.floor(l),O=Math.floor(c);n%2==0?E===T?(f={x:I,y:E},m={x:P,y:T},I<P?m.x+=1:f.x+=1):M===A?(f={x:M,y:R},m={x:A,y:O},R<O?m.y+=1:f.y+=1):(f={x:o,y:s},m={x:l,y:c}):(f={x:I,y:R},m={x:P,y:O},R===O?(I<P?m.x+=1:f.x+=1,f.y+=.5,m.y+=.5):I===P?(R<O?m.y+=1:f.y+=1,f.x+=.5,m.x+=.5):(f.x=o,f.y=s,m.x=l,m.y=c)),f=r.BB.rotate(f.x,f.y,t.angleRad/Math.PI*180),m=r.BB.rotate(m.x,m.y,t.angleRad/Math.PI*180),e.beginPath(),e.moveTo(f.x,f.y),e.lineTo(m.x,m.y),e.stroke()}else if("rect"===t.type){var D=Math.floor(o),N=Math.floor(s),z=Math.floor(l),G=Math.floor(c);i%90==0?t.fillRgb?(o%1==0&&(o+=1),s%1==0&&(s+=1),l%1==0&&(l+=1),c%1==0&&(c+=1),f={x:o<l?D:z,y:s<c?N:G},(m={x:Math.ceil((o<l?l:o)-f.x),y:Math.ceil((s<c?c:s)-f.y)}).x=f.x+m.x,m.y=f.y+m.y):n%2==0?(f={x:D,y:N},m={x:z,y:G}):(f={x:D+.5,y:N+.5},m={x:z+.5,y:G+.5}):(f={x:o,y:s},m={x:l,y:c}),f=r.BB.rotate(f.x,f.y,t.angleRad/Math.PI*180),(m=r.BB.rotate(m.x,m.y,t.angleRad/Math.PI*180)).x=m.x-f.x,m.y=m.y-f.y,t.fillRgb?e.fillRect(f.x,f.y,m.x,m.y):e.strokeRect(f.x,f.y,m.x,m.y)}else f=r.BB.rotate(o,s,t.angleRad/Math.PI*180),m=r.BB.rotate(l,c,t.angleRad/Math.PI*180),v=f.x,y=f.y,x=m.x-f.x,b=m.y-f.y,e.beginPath(),e.ellipse(v+x/2,y+b/2,Math.abs(x/2),Math.abs(b/2),0,0,2*Math.PI),t.fillRgb?e.fill():e.stroke();e.restore()}})),i.register("h20yl",(function(e,n){t(e.exports,"renderText",(function(){return a}));var r=i("eWjiX");function a(e,t){for(var n=""===t.textStr?" ":t.textStr,i=r.BB.el({css:{position:"fixed",left:"0",top:"0",width:"100000px",fontSize:t.size+"px",lineHeight:t.lineHeight?t.lineHeight+"px":"default"}}),a=r.BB.el({parent:i,css:{display:"inline-block",textAlign:t.align?t.align:"left",fontFamily:t.font?t.font:"sans-serif",fontSize:t.size+"px",fontWeight:t.isBold?"bold":"normal",fontStyle:t.isItalic?"italic":"normal",lineHeight:t.lineHeight?t.lineHeight+"px":"default",opacity:"0",pointerEvents:"none"}}),o="",s=0;s<n.length;s++)"\n"!==n[s]?o+=n[s].replace("\t","    "):(a.appendChild(r.BB.el({tagName:"span",textContent:o,css:{whiteSpace:"pre"}})),o="",a.appendChild(r.BB.el({tagName:"br"})));a.appendChild(r.BB.el({tagName:"span",textContent:o,css:{whiteSpace:"pre"}})),document.body.appendChild(i);for(var l={x0:99999999,y0:99999999,x1:0,y1:0},c=0;c<a.children.length;c++){var u=a.children[c];l.x0=Math.min(l.x0,u.offsetLeft),l.y0=Math.min(l.y0,u.offsetTop),l.x1=Math.max(l.x1,u.offsetLeft+u.offsetWidth),l.y1=Math.max(l.y1,u.offsetTop+u.offsetHeight)}var h=e.getContext("2d");h.save();var d=[];t.isItalic&&d.push("italic"),t.isBold&&d.push("bold"),d.push(t.size+"px "+(t.font?t.font:"sans-serif")),h.font=d.join(" "),h.fillStyle=t.color?t.color:"#000";var p=t.x,g=t.y;"right"===t.align&&(p+=-l.x1+l.x0),"center"===t.align&&(p+=(-l.x1+l.x0)/2),h.translate(t.x,t.y),h.rotate(t.angleRad?-t.angleRad:0),h.translate(-t.x,-t.y),h.translate(p,g);for(var f=0;f<a.children.length;f++){var m=a.children[f];h.fillText(m.innerText,m.offsetLeft,m.offsetTop)}return t.isDebug?(h.lineWidth=1,h.strokeRect(0,.85*-t.size,l.x1,l.y1),h.restore(),h.fillRect(t.x-1,t.y-1,2,2)):h.restore(),document.body.removeChild(i),{x:p-t.x,y:g-t.y-.85*t.size,width:l.x1-l.x0,height:l.y1-l.y0}}})),i.register("aSJRf",(function(e,n){t(e.exports,"drawProject",(function(){return a}));var r=i("eWjiX");function a(e,t){var n=r.BB.canvas(Math.max(1,Math.round(e.width*t)),Math.max(1,Math.round(e.height*t))),i=n.getContext("2d");i.save(),t>1&&(i.imageSmoothingEnabled=!1);for(var a=0;a<e.layers.length;a++)0!==e.layers[a].opacity&&(i.globalAlpha=e.layers[a].opacity,i.globalCompositeOperation=e.layers[a].mixModeStr?e.layers[a].mixModeStr:"source-over",i.drawImage(e.layers[a].image,0,0,n.width,n.height));return i.restore(),n}})),i.register("7EG77",(function(e,n){t(e.exports,"GradientTool",(function(){return s})),t(e.exports,"drawGradient",(function(){return l}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("eWjiX"),s=function(){"use strict";function e(t){(0,r.default)(this,e),this.onGradient=t.onGradient}return(0,a.default)(e,[{key:"onDown",value:function(e,t,n){this.downX=e,this.downY=t,this.downAngleRad=n}},{key:"onMove",value:function(e,t){this.onGradient(!1,this.downX,this.downY,e,t,this.downAngleRad)}},{key:"onUp",value:function(e,t){this.onGradient(!0,this.downX,this.downY,e,t,this.downAngleRad)}}]),e}();function l(e,t){e.save();var n=t.x1,i=t.y1,r=t.x2,a=t.y2;if(t.doSnap){var s=180*t.angleRad/Math.PI,l=o.BB.rotate(n,i,t.angleRad/Math.PI*180),c=o.BB.rotate(r,a,t.angleRad/Math.PI*180),u=o.BB.pointsToAngleDeg(l,c)+90,h=45*Math.round(u/45),d=o.BB.rotateAround({x:n,y:i},{x:r,y:a},h-u);r=d.x,a=d.y,(s+h)%90==0&&(Math.round((s-h)/90)%2==0?r=n:a=i)}var p=t.color1;t.isEraser&&t.doLockAlpha&&(p={r:255,g:255,b:255});var g=o.BB.copyObj(p);g.a=t.opacity;var f,m=o.BB.copyObj(p);if(m.a=0,t.isReversed){var v=g;g=m,m=v}if("linear"===t.type)(f=e.createLinearGradient(n,i,r,a)).addColorStop(0,o.BB.ColorConverter.toRgbaStr(g)),f.addColorStop(1,o.BB.ColorConverter.toRgbaStr(m));else if("linear-mirror"===t.type){var y={x:r-n,y:a-i};(f=e.createLinearGradient(n-y.x,i-y.y,r,a)).addColorStop(0,o.BB.ColorConverter.toRgbaStr(m)),f.addColorStop(.5,o.BB.ColorConverter.toRgbaStr(g)),f.addColorStop(1,o.BB.ColorConverter.toRgbaStr(m))}else if("radial"===t.type){var x=o.BB.Vec2.dist({x:n,y:i},{x:r,y:a});(f=e.createRadialGradient(n,i,0,n,i,x)).addColorStop(0,o.BB.ColorConverter.toRgbaStr(g)),f.addColorStop(1,o.BB.ColorConverter.toRgbaStr(m))}e.fillStyle=f,t.isEraser&&(e.globalCompositeOperation="destination-out"),t.doLockAlpha&&(e.globalCompositeOperation="source-atop"),e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore()}})),i.register("bBcC4",(function(e,n){t(e.exports,"translateBlending",(function(){return a}));var r=i("1mH1z");function a(e){if(!e)return(0,r.LANG)("layers-blend-normal");var t={"source-over":"layers-blend-normal",darken:"layers-blend-darken",multiply:"layers-blend-multiply","color-burn":"layers-blend-color-burn",lighten:"layers-blend-lighten",screen:"layers-blend-screen","color-dodge":"layers-blend-color-dodge",overlay:"layers-blend-overlay","soft-light":"layers-blend-soft-light","hard-light":"layers-blend-hard-light",difference:"layers-blend-difference",exclusion:"layers-blend-exclusion",hue:"layers-blend-hue",saturation:"layers-blend-saturation",color:"layers-blend-color",luminosity:"layers-blend-luminosity"};if(!(e in t))throw new Error("unknown blend mode");return(0,r.LANG)(t[e])}})),i.register("7bo3M",(function(e,n){t(e.exports,"WorkspaceSvgOverlay",(function(){return s}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("eWjiX"),s=function(){"use strict";function e(t){(0,r.default)(this,e),this.rootElement=o.BB.createSvg({elementType:"svg",width:""+t.width,height:""+t.height}),o.BB.css(this.rootElement,{position:"absolute",left:"0",top:"0",pointerEvents:"none",userSelect:"none"}),this.brushCircleOuter=o.BB.createSvg({elementType:"circle",r:"10",stroke:"rgba(0,0,0,0.7)","stroke-width":"1",fill:"none"}),this.brushCircleInner=o.BB.createSvg({elementType:"circle",r:"9",stroke:"rgba(255,255,255,0.7)","stroke-width":"1",fill:"none"}),this.rootElement.append(this.brushCircleOuter,this.brushCircleInner),this.pickerPreviewBorder=o.BB.createSvg({elementType:"circle",r:"47",stroke:"black","stroke-width":"22",fill:"none"}),this.pickerPreviewBorder.style.opacity="0",this.pickerPreviewCol=o.BB.createSvg({elementType:"circle",r:"47",stroke:"black","stroke-width":"20",fill:"none"}),this.pickerPreviewCol.style.opacity="0",this.rootElement.append(this.pickerPreviewBorder,this.pickerPreviewCol),this.compassSize=30,this.compass=o.BB.createSvg({elementType:"g",transform:"translate("+t.width/2+", "+t.height/2+")"}),o.BB.css(this.compass,{transition:"opacity 0.25s ease-in-out",opacity:"0"}),this.compassInner=o.BB.createSvg({elementType:"g",transform:"rotate(45)"}),this.compassBaseCircle=o.BB.createSvg({elementType:"circle",fill:"rgba(0,0,0,0.9)",stroke:"none",cx:"0",cy:"0",r:""+this.compassSize}),this.compassLineCircle=o.BB.createSvg({elementType:"circle",fill:"none",stroke:"rgba(255,255,255,0.75)","stroke-width":"1",cx:"0",cy:"0",r:""+.9*this.compassSize}),this.compassUpperTriangle=o.BB.createSvg({elementType:"path",fill:"#f00",stroke:"none",d:"M -"+.25*this.compassSize+",0 "+.25*this.compassSize+",0 0,-"+.9*this.compassSize+" z"}),this.compassLowerTriangle=o.BB.createSvg({elementType:"path",fill:"#fff",stroke:"none",d:"M -"+.25*this.compassSize+",0 "+.25*this.compassSize+",0 0,"+.9*this.compassSize+" z"}),this.compassInner.append(this.compassBaseCircle,this.compassLineCircle,this.compassUpperTriangle,this.compassLowerTriangle),this.compass.append(this.compassInner),this.rootElement.append(this.compass)}return(0,a.default)(e,[{key:"getElement",value:function(){return this.rootElement}},{key:"setSize",value:function(e,t){this.rootElement.setAttribute("width",""+e),this.rootElement.setAttribute("height",""+t),this.compass.setAttribute("transform","translate("+e/2+", "+t/2+")")}},{key:"updateCursor",value:function(e){"x"in e&&(this.brushCircleOuter.setAttribute("cx",""+e.x),this.brushCircleInner.setAttribute("cx",""+e.x)),"y"in e&&(this.brushCircleOuter.setAttribute("cy",""+e.y),this.brushCircleInner.setAttribute("cy",""+e.y)),"radius"in e&&(this.brushCircleOuter.setAttribute("r",""+Math.max(0,e.radius)),this.brushCircleInner.setAttribute("r",""+Math.max(0,e.radius-1))),"isVisible"in e&&(this.brushCircleOuter.style.opacity=e.isVisible?"1":"0",this.brushCircleInner.style.opacity=e.isVisible?"1":"0")}},{key:"updateColorPreview",value:function(e){if("x"in e&&(this.pickerPreviewCol.setAttribute("cx",""+e.x),this.pickerPreviewBorder.setAttribute("cx",""+e.x)),"y"in e&&(this.pickerPreviewCol.setAttribute("cy",""+e.y),this.pickerPreviewBorder.setAttribute("cy",""+e.y)),"color"in e){this.pickerPreviewCol.setAttribute("stroke",o.BB.ColorConverter.toRgbStr(e.color));var t=o.BB.testIsWhiteBestContrast(e.color)?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)";this.pickerPreviewBorder.setAttribute("stroke",t)}"isVisible"in e&&(this.pickerPreviewCol.style.opacity=e.isVisible?"1":"0",this.pickerPreviewBorder.style.opacity=e.isVisible?"1":"0")}},{key:"updateCompass",value:function(e){"angleDeg"in e&&(this.compassInner.setAttribute("transform","rotate("+e.angleDeg+")"),this.compassLineCircle.style.opacity=e.angleDeg%90==0?"1":"0"),"isVisible"in e&&(this.compass.style.opacity=e.isVisible?"1":"0")}}]),e}()})),i.register("lV6Vy",(function(n,r){t(n.exports,"KlCanvasWorkspace",(function(){return y}));var a,o,s=i("gFgFC"),l=i("kiQ5H"),c=i("eWjiX"),u=i("7bo3M"),h=i("gWfkn"),d=i("hNEwm"),p=i("iOLNv"),g=i("3zTyb"),f=i("kFdtJ"),m=i("hrnUX"),v=.0625;(o=a||(a={}))[o.Draw=0]="Draw",o[o.Hand=1]="Hand",o[o.HandGrabbing=2]="HandGrabbing",o[o.Pick=3]="Pick",o[o.Zoom=4]="Zoom",o[o.Rotate=5]="Rotate",o[o.Rotating=6]="Rotating",o[o.Fill=7]="Fill",o[o.Gradient=8]="Gradient",o[o.Text=9]="Text",o[o.Shape=10]="Shape";var y=function(){"use strict";function t(e){var n=this;(0,s.default)(this,t);var i=this;this.rootEl=c.BB.el({css:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0",cursor:"crosshair",userSelect:"none",colorScheme:"only light"}}),this.klCanvas=e.klCanvas,this.onViewChange=e.onViewChange,this.renderTargetCanvas=c.BB.canvas(e.width,e.height),this.renderTargetCtx=this.renderTargetCanvas.getContext("2d"),this.renderWidth=e.width,this.renderHeight=e.height,this.compositeCanvas=c.BB.canvas(1,1),this.compositeCtx=this.compositeCanvas.getContext("2d"),this.doResizeCanvas=!1,this.oldTransformObj=null,this.targetTransformObj={x:0,y:0,scale:1,angle:0},this.highResTransformObj={x:0,y:0,scale:1,angle:0},this.renderedTransformObj={x:null,y:null,scale:null,angle:null},this.cursorPos={x:0,y:0},this.usesCssCursor=!1,this.bgVisible=!0,this.transformIsDirty=!0,this.doAnimateTranslate=!0,this.svgOverlay=new(0,u.WorkspaceSvgOverlay)({width:e.width,height:e.height}),c.BB.css(this.renderTargetCanvas,{userSelect:"none",pointerEvents:"none"}),c.BB.createCheckerDataUrl(8,(function(e){n.renderTargetCanvas.style.background="url("+e+")"})),this.rootEl.appendChild(this.renderTargetCanvas),this.rootEl.appendChild(this.svgOverlay.getElement()),c.BB.addEventListener(this.rootEl,"touchend",(function(e){return e.preventDefault(),!1})),c.BB.addEventListener(this.rootEl,"contextmenu",(function(e){return e.preventDefault(),!1})),c.BB.addEventListener(this.rootEl,"dragstart",(function(e){return e.preventDefault(),!1})),this.emptyCanvas=c.BB.canvas(1,1),this.emptyCanvas.getContext("2d").fillRect(0,0,1,1),this.keyListener=new c.BB.KeyListener({onDown:function(e,t,i,r){if(!(m.KL.dialogCounter.get()>0||c.BB.isInputFocused(!0)||("alt"===e&&t.preventDefault(),r)))if(n.currentInputProcessor)n.currentInputProcessor.onKeyDown(e,t,i,r);else{if([a.Draw,a.Pick,a.Fill,a.Gradient,a.Text,a.Shape].includes(n.globalMode)&&"space"===i)return n.currentInputProcessor=n.inputProcessorObj.spaceHand,void n.currentInputProcessor.onKeyDown(e,t,i,r);if([a.Draw,a.Hand,a.Fill,a.Gradient,a.Text,a.Shape].includes(n.globalMode)&&"alt"===i)return n.currentInputProcessor=n.inputProcessorObj.altPicker,void n.currentInputProcessor.onKeyDown(e,t,i,r);if(["r","shift+r"].includes(i))return n.currentInputProcessor=n.inputProcessorObj.rotate,void n.currentInputProcessor.onKeyDown(e,t,i,r);if("z"===i)return n.currentInputProcessor=n.inputProcessorObj.zoom,void n.currentInputProcessor.onKeyDown(e,t,i,r)}},onUp:function(e,t,i){"alt"===e&&t.preventDefault(),n.currentInputProcessor&&n.currentInputProcessor.onKeyUp(e,t,i)}}),this.updateChangeListener(),this.currentMode=a.Draw,this.globalMode=a.Draw,this.renderTime=0,this.lastDrawEvent=null,this.linetoolProcessor=new c.BB.EventChain.LinetoolProcessor({onDraw:function(t){var i=function(){var e=n.getRenderedTransform(),t=c.BB.Matrix.getIdentity();return t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createScaleMatrix(1/e.scale)),t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createRotationMatrix(-e.angle)),t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createTranslationMatrix(-e.x,-e.y))};if("line"===t.type&&!n.lastDrawEvent){var r=i(),a=[t.x1,t.y1,0,1];return a=c.BB.Matrix.multiplyMatrixAndPoint(r,a),void(n.lastDrawEvent={x:a[0],y:a[1],pressure:t.pressure1})}if("x"in t||"x0"in t){var o=i();if("x"in t){var s=[t.x,t.y,0,1];s=c.BB.Matrix.multiplyMatrixAndPoint(o,s),t.x=s[0],t.y=s[1]}if("x0"in t){t.x0=n.lastDrawEvent.x,t.y0=n.lastDrawEvent.y,t.pressure0=n.lastDrawEvent.pressure;var l=[t.x1,t.y1,0,1];l=c.BB.Matrix.multiplyMatrixAndPoint(o,l),t.x1=l[0],t.y1=l[1],n.lastDrawEvent={x:t.x1,y:t.y1,pressure:t.pressure1}}}["down","move"].includes(t.type)&&(n.lastDrawEvent=t),e.onDraw(t)}}),this.pointer=null,this.isDrawing=!1,this.inputProcessorObj={draw:{onPointer:function(e){n.reqFrame(),n.updateCursor(a.Draw);var t=n.keyListener.getComboStr(),i={scale:n.highResTransformObj.scale};if(i.shiftIsPressed="shift"===t,i.pressure=e.pressure,i.isCoalesced=!!e.isCoalesced,"pointerdown"===e.type)n.isDrawing=!0,i.type="down";else{if(!e.button)return"pointerup"===e.type?(n.isDrawing=!1,i.type="up",n.linetoolProcessor.process(i),void n.resetInputProcessor()):void 0;i.type="move"}i.x=e.relX,i.y=e.relY,n.linetoolProcessor.process(i)},onKeyDown:function(e,t,n,i){},onKeyUp:function(e,t,n){}},fill:{onPointer:function(t){if(n.reqFrame(),n.updateCursor(a.Fill),"pointerdown"===t.type){var i=n.workspaceToCanvasCoord({x:t.relX,y:t.relY});e.onFill(Math.floor(i.x),Math.floor(i.y))}else if("pointerup"===t.type)return void n.resetInputProcessor()},onKeyDown:function(e,t,n,i){},onKeyUp:function(e,t,n){}},gradient:{onPointer:function(t){n.reqFrame(),n.updateCursor(a.Gradient);var i=n.workspaceToCanvasCoord({x:t.relX,y:t.relY});"pointerdown"===t.type?(n.isDrawing=!0,e.onGradient("down",i.x,i.y,n.renderedTransformObj.angle)):"pointermove"===t.type?e.onGradient("move",i.x,i.y,n.renderedTransformObj.angle):"pointerup"===t.type&&(n.isDrawing=!1,e.onGradient("up",i.x,i.y,n.renderedTransformObj.angle),n.resetInputProcessor())},onKeyDown:function(e,t,n,i){},onKeyUp:function(e,t,n){}},text:{onPointer:function(t){if(n.reqFrame(),n.updateCursor(a.Text),"pointerdown"===t.type){var i=n.workspaceToCanvasCoord({x:t.relX,y:t.relY});e.onText(Math.floor(i.x),Math.floor(i.y),n.renderedTransformObj.angle)}else if("pointerup"===t.type)return void n.resetInputProcessor()},onKeyDown:function(e,t,n,i){},onKeyUp:function(e,t,n){}},shape:{onPointer:function(t){n.reqFrame(),n.updateCursor(a.Shape);var i=n.workspaceToCanvasCoord({x:t.relX,y:t.relY});"pointerdown"===t.type?(n.isDrawing=!0,e.onShape("down",i.x,i.y,n.renderedTransformObj.angle)):"pointermove"===t.type?e.onShape("move",i.x,i.y,n.renderedTransformObj.angle):"pointerup"===t.type&&(n.isDrawing=!1,e.onShape("up",i.x,i.y,n.renderedTransformObj.angle),n.resetInputProcessor())},onKeyDown:function(e,t,n,i){},onKeyUp:function(e,t,n){}},hand:{onPointer:function(e){n.updateCursor(a.Hand),["left","middle"].includes(e.button)?(n.updateCursor(a.HandGrabbing),n.targetTransformObj.x+=e.dX,n.targetTransformObj.y+=e.dY,n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.doAnimateTranslate=!1,n.transformIsDirty=!0,n.reqFrame(!0)):"pointerup"===e.type&&n.resetInputProcessor()},onKeyDown:function(e,t,n,i){},onKeyUp:function(e,t,n){}},spaceHand:{onPointer:function(e){n.updateCursor(a.Hand),["left","middle"].includes(e.button)&&(n.updateCursor(a.HandGrabbing),n.targetTransformObj.x+=e.dX,n.targetTransformObj.y+=e.dY,n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.doAnimateTranslate=!1,n.transformIsDirty=!0,n.reqFrame(!0))},onKeyDown:function(e,t,i,r){"space"!==i?n.resetInputProcessor():n.updateCursor(a.Hand)},onKeyUp:function(e,t,i){n.resetInputProcessor()}},zoom:{onPointer:function(e){if(n.updateCursor(a.Zoom),"left"===e.button&&!e.isCoalesced&&0!=e.dX){var t=e.pageX-e.relX,i=e.pageY-e.relY;n.internalZoomByStep(e.dX/175,e.downPageX-t,e.downPageY-i),n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.lastRenderedState=-1,n.reqFrame(),n.onViewChange({changed:["scale"],angle:n.targetTransformObj.angle,scale:n.targetTransformObj.scale})}},onKeyDown:function(e,t,i,r){"z"!==i?n.resetInputProcessor():n.updateCursor(a.Zoom)},onKeyUp:function(e,t,i){n.resetInputProcessor()}},picker:{onPointer:function(t){if(n.updateCursor(a.Pick),["left","right"].includes(t.button)&&!t.isCoalesced||"pointerup"===t.type){var i=n.workspaceToCanvasCoord({x:t.relX,y:t.relY}),r=n.klCanvas.getColorAt(i.x,i.y);e.onPick(r,"pointerup"===t.type),n.svgOverlay.updateColorPreview({x:t.relX,y:t.relY,color:r,isVisible:"pointerup"!==t.type}),"pointerup"===t.type&&n.resetInputProcessor()}},onKeyDown:function(e,t,n,i){},onKeyUp:function(e,t,n){}},altPicker:{onPointer:function(t){if(n.updateCursor(a.Pick),["left","right"].includes(t.button)&&!t.isCoalesced||"pointerup"===t.type){var i=n.workspaceToCanvasCoord({x:t.relX,y:t.relY}),r=n.klCanvas.getColorAt(i.x,i.y);e.onPick(r,"pointerup"===t.type),n.svgOverlay.updateColorPreview({x:t.relX,y:t.relY,color:r,isVisible:"pointerup"!==t.type})}},onKeyDown:function(e,t,i,r){"alt"!==i?n.resetInputProcessor():n.updateCursor(a.Pick)},onKeyUp:function(e,t,i){n.resetInputProcessor()}},rotate:{onPointer:function(e){if(n.updateCursor("left"===e.button?a.Rotating:a.Rotate),"pointerdown"===e.type&&"left"===e.button)n.oldTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj));else if("left"===e.button&&!e.isCoalesced&&n.oldTransformObj){var t=e.pageX-e.relX,i=e.pageY-e.relY,r={x:n.renderWidth/2,y:n.renderHeight/2},o=c.BB.Vec2.angle(r,{x:e.downPageX-t,y:e.downPageY-i}),s=c.BB.Vec2.angle(r,{x:e.pageX-t,y:e.pageY-i})-o;n.targetTransformObj=JSON.parse(JSON.stringify(n.oldTransformObj)),n.targetTransformObj.angle+=s,n.keyListener.isPressed("shift")&&(n.targetTransformObj.angle=Math.round(n.targetTransformObj.angle/Math.PI*8)*Math.PI/8,s=n.targetTransformObj.angle-n.oldTransformObj.angle),n.targetTransformObj.angle=n.minimizeAngleRad(n.targetTransformObj.angle);var l=c.BB.Matrix.getIdentity();l=c.BB.Matrix.multiplyMatrices(l,c.BB.Matrix.createTranslationMatrix(r.x,r.y)),l=c.BB.Matrix.multiplyMatrices(l,c.BB.Matrix.createRotationMatrix(s)),l=c.BB.Matrix.multiplyMatrices(l,c.BB.Matrix.createTranslationMatrix(-r.x,-r.y));var u=[n.targetTransformObj.x,n.targetTransformObj.y,0,1];u=c.BB.Matrix.multiplyMatrixAndPoint(l,u),n.targetTransformObj.x=u[0],n.targetTransformObj.y=u[1],n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.transformIsDirty=!0,n.lastRenderedState=-1,n.reqFrame(),n.onViewChange({changed:["angle"],scale:n.targetTransformObj.scale,angle:n.targetTransformObj.angle})}},onKeyDown:function(e,t,i,r){["r","r+shift","shift+r","r+left","r+right","r+left+right","r+right+left","r+up"].includes(i)?n.updateCursor(a.Rotate):n.resetInputProcessor()},onKeyUp:function(e,t,i){var r=n.keyListener.getComboStr();["r","r+shift","shift+r","r+left","r+right","r+left+right","r+right+left","r+up"].includes(r)?n.updateCursor(a.Rotate):n.resetInputProcessor()}}},this.currentInputProcessor=null,this.angleIsExtraSticky=!1,this.pinchZoomer=new c.BB.EventChain.PinchZoomer({onPinch:function(e){if("move"===e.type){n.oldTransformObj||(n.oldTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.angleIsExtraSticky=n.targetTransformObj.angle%(Math.PI/2)==0),n.targetTransformObj=JSON.parse(JSON.stringify(n.oldTransformObj)),e.scale=Math.max(v,Math.min(64,n.targetTransformObj.scale*e.scale))/n.targetTransformObj.scale,n.targetTransformObj.scale*=e.scale,n.targetTransformObj.angle+=e.angleRad,n.targetTransformObj.angle=n.minimizeAngleRad(n.snapAngleRad(n.targetTransformObj.angle,90,n.angleIsExtraSticky?12:4)),n.targetTransformObj.angle%(Math.PI/2)!=0&&(n.angleIsExtraSticky=!1),e.angleRad=n.targetTransformObj.angle-n.oldTransformObj.angle;var t=c.BB.Matrix.getIdentity();t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createTranslationMatrix(e.relX,e.relY)),t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createScaleMatrix(e.scale)),t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createRotationMatrix(e.angleRad)),t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createTranslationMatrix(-e.relX,-e.relY)),t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createTranslationMatrix(e.relX-e.downRelX,e.relY-e.downRelY));var i=[n.targetTransformObj.x,n.targetTransformObj.y,0,1];i=c.BB.Matrix.multiplyMatrixAndPoint(t,i),n.targetTransformObj.x=i[0],n.targetTransformObj.y=i[1],n.highResTransformObj=c.BB.copyObj(n.targetTransformObj),n.onViewChange({changed:["scale","angle"],scale:n.targetTransformObj.scale,angle:n.targetTransformObj.angle}),n.reqFrame(),n.transformIsDirty=!0,n.lastRenderedState=-1}else"end"===e.type&&(n.oldTransformObj=null)}});var r=function(e){i.fitView()?(n.lastRenderedState=-1,n.reqFrame()):(n.internalZoomByStep(2,e.relX,e.relY)&&n.onViewChange({changed:["scale"],angle:n.targetTransformObj.angle,scale:n.targetTransformObj.scale}),n.lastRenderedState=-1)};this.mainDoubleTapper=new c.BB.EventChain.DoubleTapper({onDoubleTap:r}),this.middleDoubleTapper=new c.BB.EventChain.DoubleTapper({onDoubleTap:r}),this.middleDoubleTapper.setAllowedButtonArr(["middle"]),this.twoFingerTap=new c.BB.EventChain.NFingerTapper({fingers:2,onTap:function(){e.onUndo()}}),this.threeFingerTap=new c.BB.EventChain.NFingerTapper({fingers:3,onTap:function(){e.onRedo()}}),this.pointerEventChain=new c.BB.EventChain.EventChain({chainArr:[this.twoFingerTap,this.threeFingerTap,this.mainDoubleTapper,this.middleDoubleTapper,this.pinchZoomer,new c.BB.EventChain.OnePointerLimiter,new c.BB.EventChain.CoalescedExploder]}),this.pointerEventChain.setChainOut((function(e){if(n.cursorPos.x=e.relX,n.cursorPos.y=e.relY,"pointerup"===e.type&&"touch"===e.pointerType?(n.pointer=null,n.lastRenderedState=-1,n.reqFrame()):(n.pointer||(n.pointer={x:0,y:0}),n.pointer.x=e.relX,n.pointer.y=e.relY),n.currentInputProcessor)n.currentInputProcessor.onPointer(e);else{var t=n.keyListener.getComboStr();n.globalMode===a.Draw?["","shift","ctrl"].includes(t)&&"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.draw,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(a.Draw),n.reqFrame()):n.globalMode===a.Hand?"pointerdown"===e.type&&["left","middle"].includes(e.button)?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):n.updateCursor(a.Hand):n.globalMode===a.Pick?"pointerdown"===e.type&&["left","right"].includes(e.button)?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):n.updateCursor(a.Pick):n.globalMode===a.Fill?"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.fill,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(a.Fill),n.reqFrame()):n.globalMode===a.Gradient?["","shift","ctrl"].includes(t)&&"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.gradient,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(a.Gradient),n.reqFrame()):n.globalMode===a.Text?"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.text,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(a.Text),n.reqFrame()):n.globalMode===a.Shape&&(["","shift","ctrl"].includes(t)&&"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.shape,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(a.Shape),n.reqFrame()))}})),c.BB.addEventListener(this.rootEl,"wheel",(function(e){e.preventDefault()})),setTimeout((function(){n.pointerListener=new c.BB.PointerListener({target:n.rootEl,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&"middle"===e.button)try{e.eventPreventDefault()}catch(e){}"pointerdown"===e.type&&c.BB.unfocusAnyInput(),n.pointerEventChain.chainIn(e)},onWheel:function(e){n.isDrawing||(n.reqFrame(),n.internalZoomByStep(-e.deltaY/(n.keyListener.isPressed("shift")?8:2),e.relX,e.relY)&&n.onViewChange({changed:["scale"],angle:n.targetTransformObj.angle,scale:n.targetTransformObj.scale}),n.lastRenderedState=-1)},onEnterLeave:function(e){e||n.isDrawing||(n.pointer=null,n.lastRenderedState=-1)},maxPointers:4})}),1),this.brushRadius=1,this.animationFrameRequested=!1,this.lastRenderedState=-2,this.lastRenderTime=performance.now(),window.requestAnimationFrame((function(){return n.updateLoop()})),this.resetView()}return(0,l.default)(t,[{key:"getRenderedTransform",value:function(){var e=this.renderedTransformObj;return e.x=this.highResTransformObj.x,e.y=this.highResTransformObj.y,e.scale=this.highResTransformObj.scale,e.angle=this.highResTransformObj.angle,e.angle%(Math.PI/2)==0&&e.scale%1==0&&(e.x=Math.round(e.x),e.y=Math.round(e.y)),e}},{key:"updateChangeListener",value:function(){var e=this;this.klCanvas.addChangeListener((function(){e.lastRenderedState=-1,e.reqFrame()}))}},{key:"updateCursor",value:function(t,n){if(t!==this.currentMode||n){var i=this.currentMode;if(this.currentMode=t,this.lastRenderedState=-1,this.currentMode===a.Draw?this.rootEl.style.cursor="crosshair":this.currentMode===a.Hand?this.rootEl.style.cursor="grab":this.currentMode===a.HandGrabbing?this.rootEl.style.cursor="grabbing":this.currentMode===a.Pick?this.rootEl.style.cursor="url('"+e(d)+"') 0 15, crosshair":this.currentMode===a.Zoom?this.rootEl.style.cursor="url('"+e(p)+"') 7 7, zoom-in":this.currentMode===a.Rotate?this.rootEl.style.cursor="grab":this.currentMode===a.Rotating?this.rootEl.style.cursor="grabbing":this.currentMode===a.Fill?this.rootEl.style.cursor="url('"+e(g)+"') 1 12, crosshair":this.currentMode===a.Gradient?this.rootEl.style.cursor="crosshair":this.currentMode===a.Text?this.rootEl.style.cursor="url('"+e(f)+"') 1 12, crosshair":this.currentMode===a.Shape&&(this.rootEl.style.cursor="crosshair"),[a.Draw,a.Pick,a.Fill,a.Text,a.Shape].includes(this.globalMode)){var r=[a.Hand,a.HandGrabbing].includes(i),o=[a.Hand,a.HandGrabbing].includes(this.currentMode);!r&&o&&this.mainDoubleTapper.setAllowedPointerTypeArr(["mouse","pen","touch"]),r&&!o&&this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])}this.currentMode!==a.Pick&&this.svgOverlay.updateColorPreview({isVisible:!1})}}},{key:"internalZoomByStep",value:function(e,t,n){var i=Math.log2(this.targetTransformObj.scale)/Math.abs(e);i+=e>0?1:-1,i=Math.round(i),i*=Math.abs(e);var r=Math.max(v,Math.min(64,Math.pow(2,i)));if(r===this.targetTransformObj.scale)return!1;var a=r/this.targetTransformObj.scale;this.targetTransformObj.scale=r;var o=c.BB.Matrix.getIdentity();o=c.BB.Matrix.multiplyMatrices(o,c.BB.Matrix.createTranslationMatrix(t,n)),o=c.BB.Matrix.multiplyMatrices(o,c.BB.Matrix.createScaleMatrix(a)),o=c.BB.Matrix.multiplyMatrices(o,c.BB.Matrix.createTranslationMatrix(-t,-n));var s=[this.targetTransformObj.x,this.targetTransformObj.y,0,1];return s=c.BB.Matrix.multiplyMatrixAndPoint(o,s),this.targetTransformObj.x=s[0],this.targetTransformObj.y=s[1],this.transformIsDirty=!0,!0}},{key:"mixTransformObj",value:function(e,t,n){if(e.angle===t.angle)return e.scale=c.BB.mix(e.scale,t.scale,n),e.x=c.BB.mix(e.x,t.x,n),e.y=c.BB.mix(e.y,t.y,n),void(e.angle=c.BB.mix(e.angle,t.angle,n));var i=this.klCanvas.getWidth(),r=this.klCanvas.getHeight(),a=this.canvasToWorkspaceCoord({x:i/2,y:r/2},e),o=this.canvasToWorkspaceCoord({x:i/2,y:r/2},t);e.x=c.BB.mix(a.x,o.x,n),e.y=c.BB.mix(a.y,o.y,n),e.scale=c.BB.mix(e.scale,t.scale,n),e.angle=c.BB.mix(e.angle,t.angle,n);var s=this.canvasToWorkspaceCoord({x:-i/2,y:-r/2},e);e.x=s.x,e.y=s.y}},{key:"render",value:function(){this.doResizeCanvas&&(this.doResizeCanvas=!1,this.renderTargetCanvas.width=this.renderWidth,this.renderTargetCanvas.height=this.renderHeight),this.renderContext(this.renderTargetCtx)}},{key:"testBgVisible",value:function(){var e=[[0,0],[this.renderWidth,0],[this.renderWidth,this.renderHeight],[0,this.renderHeight]],t=this.getRenderedTransform(),n=c.BB.Matrix.getIdentity();n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createScaleMatrix(1/t.scale)),n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createRotationMatrix(-t.angle)),n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createTranslationMatrix(-t.x,-t.y));for(var i=0;i<e.length;i++){var r=[e[i][0],e[i][1],0,1];if(!(0<=(r=c.BB.Matrix.multiplyMatrixAndPoint(n,r))[0]&&r[0]<=this.klCanvas.getWidth()&&0<=r[1]&&r[1]<=this.klCanvas.getHeight()))return!0}return!1}},{key:"renderContext",value:function(e){var t=this.klCanvas.getWidth(),n=this.klCanvas.getHeight(),i=this.getRenderedTransform();if(i.scale>=4||1===i.scale&&0===i.angle?e.imageSmoothingEnabled=!1:(e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="low"),e.save(),this.bgVisible?(e.fillStyle="rgb(158,158,158)",e.fillRect(0,0,this.renderWidth,this.renderHeight)):e.clearRect(0,0,this.renderWidth,this.renderHeight),this.bgVisible){e.save(),e.translate(i.x,i.y),e.scale(i.scale,i.scale),e.rotate(i.angle),e.imageSmoothingEnabled=!1;e.globalAlpha=.2,e.drawImage(this.emptyCanvas,-1/i.scale,-1/i.scale,t+2/i.scale,n+2/i.scale),e.globalAlpha=1,e.globalCompositeOperation="destination-out",e.drawImage(this.emptyCanvas,0,0,t,n),e.restore()}e.translate(i.x,i.y),e.scale(i.scale,i.scale),e.rotate(i.angle);for(var r=this.klCanvas.getLayersFast(),o=0;o<r.length;o++)r[o].opacity>0&&(e.globalAlpha=r[o].opacity,e.globalCompositeOperation=r[o].mixModeStr,r[o].canvas.compositeObj?(this.compositeCanvas.width!==r[o].canvas.width||this.compositeCanvas.height!==r[o].canvas.height?(this.compositeCanvas.width=r[o].canvas.width,this.compositeCanvas.height=r[o].canvas.height):this.compositeCtx.clearRect(0,0,this.compositeCanvas.width,this.compositeCanvas.height),this.compositeCtx.drawImage(r[o].canvas,0,0),r[o].canvas.compositeObj.draw(this.compositeCtx),e.drawImage(this.compositeCanvas,0,0,t,n)):e.drawImage(r[o].canvas,0,0,t,n));e.globalAlpha=1,e.restore(),a.Rotate===this.currentMode||a.Rotating===this.currentMode?this.svgOverlay.updateCompass({isVisible:!0,angleDeg:i.angle/Math.PI*180}):this.svgOverlay.updateCompass({isVisible:!1})}},{key:"workspaceToCanvasCoord",value:function(e){var t=this.getRenderedTransform(),n=c.BB.Matrix.getIdentity();n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createScaleMatrix(1/t.scale)),n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createRotationMatrix(-t.angle)),n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createTranslationMatrix(-t.x,-t.y));var i=[e.x,e.y,0,1];return{x:(i=c.BB.Matrix.multiplyMatrixAndPoint(n,i))[0],y:i[1]}}},{key:"canvasToWorkspaceCoord",value:function(e,t){var n=c.BB.Matrix.getIdentity();n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createTranslationMatrix(t.x,t.y)),n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createRotationMatrix(t.angle)),n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createScaleMatrix(t.scale));var i=[e.x,e.y,0,1];return{x:(i=c.BB.Matrix.multiplyMatrixAndPoint(n,i))[0],y:i[1]}}},{key:"snapAngleRad",value:function(e,t,n){var i=180*e/Math.PI,r=Math.abs(i%t);return Math.min(r,t-r)<=n&&(i=Math.round(i/t)*t),i/180*Math.PI}},{key:"minimizeAngleRad",value:function(e){return(e%=2*Math.PI)>Math.PI?e-=2*Math.PI:e<-Math.PI&&(e+=2*Math.PI),e}},{key:"resetInputProcessor",value:function(){this.currentInputProcessor=null,this.updateCursor(this.globalMode),this.reqFrame(!0)}},{key:"reqFrame",value:function(e){this.animationFrameRequested=!0,e&&(this.lastRenderedState=-1)}},{key:"updateLoop",value:function(){var e=this;window.requestAnimationFrame((function(){return e.updateLoop()}));var t=h.klHistory.getState(),n=this.lastRenderedState<t,i=performance.now(),r=60*(i-this.lastRenderTime)/1e3;this.lastRenderTime=i,(this.animationFrameRequested||n)&&(this.animationFrameRequested=!1,this.checkChange(r))}},{key:"checkChange",value:function(e){var t=h.klHistory.getState(),n=this.lastRenderedState<t||this.highResTransformObj.scale!==this.targetTransformObj.scale||this.highResTransformObj.x!==this.targetTransformObj.x||this.highResTransformObj.y!==this.targetTransformObj.y;if(!this.doAnimateTranslate&&(this.highResTransformObj.scale===this.targetTransformObj.scale||Math.abs(this.highResTransformObj.scale-this.targetTransformObj.scale)<.008*this.targetTransformObj.scale))this.highResTransformObj.scale=this.targetTransformObj.scale,this.highResTransformObj.x=this.targetTransformObj.x,this.highResTransformObj.y=this.targetTransformObj.y,this.highResTransformObj.angle=this.targetTransformObj.angle,this.transformIsDirty&&(this.transformIsDirty=!1,this.bgVisible=this.testBgVisible()),this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale});else if((this.highResTransformObj.x===this.targetTransformObj.x||Math.abs(this.highResTransformObj.x-this.targetTransformObj.x)<.5)&&(this.highResTransformObj.y===this.targetTransformObj.y||Math.abs(this.highResTransformObj.y-this.targetTransformObj.y)<.5)&&(this.highResTransformObj.scale===this.targetTransformObj.scale||Math.abs(this.highResTransformObj.scale-this.targetTransformObj.scale)<.008*this.targetTransformObj.scale))this.highResTransformObj.scale=this.targetTransformObj.scale,this.highResTransformObj.x=this.targetTransformObj.x,this.highResTransformObj.y=this.targetTransformObj.y,this.highResTransformObj.angle=this.targetTransformObj.angle,this.doAnimateTranslate=!1,this.transformIsDirty&&(this.transformIsDirty=!1,this.bgVisible=this.testBgVisible()),this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale});else{this.reqFrame();var i=Math.min(1,.3*e);this.mixTransformObj(this.highResTransformObj,this.targetTransformObj,i),this.bgVisible=!0,this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale})}if(this.pointer&&this.currentMode==a.Draw&&!this.usesCssCursor?this.svgOverlay.updateCursor({x:this.pointer.x,y:this.pointer.y,isVisible:!0}):this.svgOverlay.updateCursor({isVisible:!1}),n){this.lastRenderedState=t;var r=performance.now();this.render(),this.renderTime=c.BB.mix(this.renderTime,performance.now()-r,.05)}}},{key:"getElement",value:function(){return this.rootEl}},{key:"setCanvas",value:function(e){this.klCanvas=e,this.lastDrawEvent=null,this.resetView(),this.updateChangeListener(),this.lastRenderedState=-1,this.reqFrame()}},{key:"setSize",value:function(e,t){var n=this.renderWidth,i=this.renderHeight;e===n&&t===i||(this.doResizeCanvas=!0,this.renderWidth=e,this.renderHeight=t,this.svgOverlay.setSize(e,t),this.targetTransformObj.x+=(e-n)/2,this.targetTransformObj.y+=(t-i)/2,this.highResTransformObj.x=this.targetTransformObj.x,this.highResTransformObj.y=this.targetTransformObj.y,this.bgVisible=this.testBgVisible(),this.lastRenderedState=-1,this.reqFrame())}},{key:"setMode",value:function(e){"draw"===e&&(this.globalMode=a.Draw,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"fill"===e&&(this.globalMode=a.Fill,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"gradient"===e&&(this.globalMode=a.Gradient,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"text"===e&&(this.globalMode=a.Text,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"shape"===e&&(this.globalMode=a.Shape,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"hand"===e&&(this.globalMode=a.Hand,this.mainDoubleTapper.setAllowedPointerTypeArr(["mouse","pen","touch"])),"pick"===e&&(this.globalMode=a.Pick,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"]))}},{key:"getMode",value:function(){return this.globalMode===a.Draw?"draw":this.globalMode===a.Fill?"fill":this.globalMode===a.Gradient?"gradient":this.globalMode===a.Text?"text":this.globalMode===a.Shape?"shape":this.globalMode===a.Hand?"hand":this.globalMode===a.Pick?"pick":void 0}},{key:"setEnabled",value:function(e){}},{key:"setCursorSize",value:function(e){var t=this;this.brushRadius=e/2,this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale}),null===this.pointer&&(clearTimeout(this.hideBrushCursorTimeout),this.svgOverlay.updateCursor({x:this.renderWidth/2,y:this.renderHeight/2,isVisible:!0}),this.hideBrushCursorTimeout=setTimeout((function(){null===t.pointer&&t.svgOverlay.updateCursor({isVisible:!1})}),500))}},{key:"zoomByStep",value:function(e){this.internalZoomByStep(e,this.renderWidth/2,this.renderHeight/2)&&(this.lastRenderedState=-1,this.reqFrame(),this.onViewChange({changed:["scale"],angle:this.targetTransformObj.angle,scale:this.targetTransformObj.scale}))}},{key:"resetView",value:function(e){this.targetTransformObj.scale=1,this.targetTransformObj.angle=0,this.targetTransformObj.x=(this.renderWidth-this.klCanvas.getWidth())/2,this.targetTransformObj.y=(this.renderHeight-this.klCanvas.getHeight())/2,e?(this.doAnimateTranslate=!0,this.transformIsDirty=!0):this.highResTransformObj=JSON.parse(JSON.stringify(this.targetTransformObj)),this.bgVisible=this.testBgVisible(),this.reqFrame(),e&&this.onViewChange({changed:["scale","angle"],scale:this.targetTransformObj.scale,angle:this.targetTransformObj.angle})}},{key:"fitView",value:function(){var e=this.snapAngleRad(this.targetTransformObj.angle,90,90),t=[[0,0],[this.klCanvas.getWidth(),0],[this.klCanvas.getWidth(),this.klCanvas.getHeight()],[0,this.klCanvas.getHeight()],[this.klCanvas.getWidth()/2,this.klCanvas.getHeight()/2]],n=c.BB.Matrix.getIdentity();n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createRotationMatrix(e));for(var i=0;i<t.length;i++){var r=[t[i][0],t[i][1],0,1];r=c.BB.Matrix.multiplyMatrixAndPoint(n,r),t[i][0]=r[0],t[i][1]=r[1]}for(var a={x0:null,y0:null,x1:null,y1:null},o=0;o<t.length;o++)(null===a.x0||t[o][0]<a.x0)&&(a.x0=t[o][0]),(null===a.y0||t[o][1]<a.y0)&&(a.y0=t[o][1]),(null===a.x1||t[o][0]>a.x1)&&(a.x1=t[o][0]),(null===a.y1||t[o][1]>a.y1)&&(a.y1=t[o][1]);var s=a.x1-a.x0,l=a.y1-a.y0,u=c.BB.fitInto(s,l,this.renderWidth-0,this.renderHeight-0,1).width/s,h={angle:e,x:this.renderWidth/2-(t[4][0]-t[0][0])*u,y:this.renderHeight/2-(t[4][1]-t[0][1])*u,scale:u};return!(h.angle===this.targetTransformObj.angle&&Math.abs(h.x-this.targetTransformObj.x)<1e-10&&Math.abs(h.y-this.targetTransformObj.y)<1e-10&&h.scale===this.targetTransformObj.scale)&&(this.targetTransformObj=h,this.doAnimateTranslate=!0,this.transformIsDirty=!0,this.reqFrame(),this.onViewChange({changed:["scale","angle"],scale:this.targetTransformObj.scale,angle:this.targetTransformObj.angle}),!0)}},{key:"setAngle",value:function(e,t){var n={x:this.renderWidth/2,y:this.renderHeight/2},i=this.targetTransformObj.angle,r=e/180*Math.PI;t?this.targetTransformObj.angle+=r:this.targetTransformObj.angle=r,this.targetTransformObj.angle=this.minimizeAngleRad(this.snapAngleRad(this.targetTransformObj.angle,90,4));var a=c.BB.Matrix.getIdentity();a=c.BB.Matrix.multiplyMatrices(a,c.BB.Matrix.createTranslationMatrix(n.x,n.y)),a=c.BB.Matrix.multiplyMatrices(a,c.BB.Matrix.createRotationMatrix(this.targetTransformObj.angle-i)),a=c.BB.Matrix.multiplyMatrices(a,c.BB.Matrix.createTranslationMatrix(-n.x,-n.y));var o=[this.targetTransformObj.x,this.targetTransformObj.y,0,1];o=c.BB.Matrix.multiplyMatrixAndPoint(a,o),this.targetTransformObj.x=o[0],this.targetTransformObj.y=o[1],this.highResTransformObj=JSON.parse(JSON.stringify(this.targetTransformObj)),this.transformIsDirty=!0,this.reqFrame(!0)}},{key:"translateView",value:function(e,t){this.targetTransformObj.x+=40*e,this.targetTransformObj.y+=40*t,this.transformIsDirty=!0,this.doAnimateTranslate=!0,this.reqFrame(!0)}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"getScale",value:function(){return this.targetTransformObj.scale}},{key:"getAngleDeg",value:function(){return 180*this.targetTransformObj.angle/Math.PI}},{key:"getMaxScale",value:function(){return 64}},{key:"getMinScale",value:function(){return v}},{key:"requestFrame",value:function(){this.lastRenderedState=-1,this.reqFrame()}},{key:"setLastDrawEvent",value:function(e,t,n){null!==e?(this.lastDrawEvent||(this.lastDrawEvent={x:0,y:0,pressure:0}),this.lastDrawEvent.x=e,this.lastDrawEvent.y=t,this.lastDrawEvent.pressure=n):this.lastDrawEvent=null}}]),t}()})),i.register("hNEwm",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("1dLwT")})),i.register("iOLNv",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("9wZxU")})),i.register("3zTyb",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("hQSEH")})),i.register("kFdtJ",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("916ZI")})),i.register("i5nyl",(function(e,n){t(e.exports,"KlCanvasPreview",(function(){return a}));var r=i("eWjiX");function a(e){var t=function(){s.save(),s.clearRect(0,0,o.width,o.height);for(var t=0;t<e.layers.length;t++)s.globalAlpha=e.layers[t].opacity,s.globalCompositeOperation=e.layers[t].mixModeStr,o.width>e.layers[t].image.width&&(s.imageSmoothingEnabled=!1),s.drawImage(e.layers[t].image,0,0,o.width,o.height);s.restore()},n=e.width/e.layers[0].image.width,i=n>1?e.layers[0].image.width:e.width,a=n>1?e.layers[0].image.height:e.height,o=r.BB.canvas(i,a);o.style.backgroundImage="url("+r.BB.createCheckerDataUrl(8)+")";var s=o.getContext("2d");r.BB.css(o,{width:"100%",height:"100%",imageRendering:n>1?"pixelated":null}),setTimeout(t,0),this.getElement=function(){return o},this.render=function(){t()}}})),i.register("cNhNm",(function(n,r){t(n.exports,"FreeTransform",(function(){return g}));var a=i("gFgFC"),o=i("kiQ5H"),s=i("7U0Ew"),l=i("eWjiX"),c=i("lQMok");function u(e){if(Math.abs(e.angleDeg)%90==0){e.width=Math.round(e.width),e.height=Math.round(e.height);var t=Math.abs(e.angleDeg-90)%180==0;e.x=(t?e.height:e.width)%2==0?Math.round(e.x):Math.round(e.x-.5)+.5,e.y=(t?e.width:e.height)%2==0?Math.round(e.y):Math.round(e.y-.5)+.5}}function h(e){return{x:e.x,y:e.y,width:e.width,height:e.height,angleDeg:e.angleDeg}}function d(e,t,n){var i,r;i=e-n.x,r=t-n.y;var a=l.BB.rotateAround({x:0,y:0},{x:i,y:r},-n.angleDeg);return{x:i=a.x,y:r=a.y}}function p(e,t,n){var i=l.BB.rotateAround({x:0,y:0},{x:e,y:t},n.angleDeg);return{x:i.x+n.x,y:i.y+n.y}}var g=function(){"use strict";function t(n){var i=this;(0,a.default)(this,t);(0,s.default)(this,"scaled",{x:0,y:0,width:0,height:0,corners:[{x:0,y:0}]}),(0,s.default)(this,"minSnapDist",7),(0,s.default)(this,"cornerCursors",["nw","n","ne","e","se","s","sw","w"]),(0,s.default)(this,"gripSize",14),(0,s.default)(this,"edgeSize",10),(0,s.default)(this,"corners",[]),(0,s.default)(this,"edges",[]),this.transform={x:n.x,y:n.y,width:n.width,height:n.height,angleDeg:n.angleDeg},this.isConstrained=!!n.isConstrained,this.snapX=n.snapX,this.snapY=n.snapY,this.callback=n.callback,this.scale=n.scale,this.snappingEnabled=!0,this.ratio=this.transform.width/this.transform.height,this.rootEl=l.BB.el({className:"kl-free-transform",css:{userSelect:"none"}}),this.transEl=l.BB.el({parent:this.rootEl,css:{position:"absolute"}}),this.boundsEl=l.BB.el({css:{position:"absolute",cursor:"move",boxShadow:"rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px"}});var r={x:0,y:0};this.keyListener=new l.BB.KeyListener({});var o,h={x:0,y:0};this.boundsPointerListener=new l.BB.PointerListener({target:this.boundsEl,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointerdown"===e.type&&(h={x:i.transform.x,y:i.transform.y}),"pointermove"===e.type&&"left"===e.button){var t;i.transform.x=h.x+(e.pageX-e.downPageX)/i.scale,i.transform.y=h.y+(e.pageY-e.downPageY)/i.scale;var n={};if(i.snappingEnabled){var r,a;for(r=0;r<i.snapX.length;r++)(t=Math.abs(i.transform.x-i.snapX[r]))<i.minSnapDist/i.scale&&(!n.x||t<n.distX)&&(n.x=i.snapX[r],n.distX=t);for(r=0;r<i.snapY.length;r++)(t=Math.abs(i.transform.y-i.snapY[r]))<i.minSnapDist/i.scale&&(!n.y||t<n.distY)&&(n.y=i.snapY[r],n.distY=t);for(r=0;r<4;r++){a=p(i.corners[r].x,i.corners[r].y,i.transform);var o=void 0;for(o=0;o<i.snapX.length;o++)(t=Math.abs(a.x-i.snapX[o]))<i.minSnapDist/i.scale&&(!n.x||t<n.distX)&&(n.x=i.snapX[o]-(a.x-i.transform.x),n.distX=t);for(o=0;o<i.snapY.length;o++)(t=Math.abs(a.y-i.snapY[o]))<i.minSnapDist/i.scale&&(!n.y||t<n.distY)&&(n.y=i.snapY[o]-(a.y-i.transform.y),n.distY=t)}}if("shift"===i.keyListener.getComboStr()){var s=l.BB.projectPointOnLine({x:0,y:h.y},{x:10,y:h.y},{x:i.transform.x,y:i.transform.y}),c=l.BB.dist(s.x,s.y,i.transform.x,i.transform.y);(n={}).x=s.x,n.y=s.y,n.distX=c,n.distY=c,s=l.BB.projectPointOnLine({x:h.x,y:0},{x:h.x,y:10},{x:i.transform.x,y:i.transform.y}),(c=l.BB.dist(s.x,s.y,i.transform.x,i.transform.y))<n.distX&&(n.x=s.x,n.y=s.y,n.distX=c,n.distY=c),s=l.BB.projectPointOnLine({x:h.x,y:h.y},{x:h.x+1,y:h.y+1},{x:i.transform.x,y:i.transform.y}),(c=l.BB.dist(s.x,s.y,i.transform.x,i.transform.y))<n.distX&&(n.x=s.x,n.y=s.y,n.distX=c,n.distY=c),s=l.BB.projectPointOnLine({x:h.x,y:h.y},{x:h.x+1,y:h.y-1},{x:i.transform.x,y:i.transform.y}),(c=l.BB.dist(s.x,s.y,i.transform.x,i.transform.y))<n.distX&&(n.x=s.x,n.y=s.y,n.distX=c,n.distY=c)}null!=n.x&&(i.transform.x=n.x),null!=n.y&&(i.transform.y=n.y),Math.abs(i.transform.angleDeg)%90==0&&(u(i.transform),i.updateCornerPositions()),i.updateDOM()}}});for(var g=0;g<4;g++)!function(e){var t=i.corners[e]={i:e,el:l.BB.el({css:{width:i.gripSize+"px",height:i.gripSize+"px",background:"#fff",borderRadius:i.gripSize+"px",position:"absolute",boxShadow:"inset 0 0 0 2px #000"}}),x:0,y:0,virtualPos:{x:0,y:0},updateDOM:null,pointerListener:null};t.updateDOM=function(){var n=[[-1,-1],[1,-1],[1,1],[-1,1]].map((function(e){return e[0]*=i.transform.width>0?1:-1,e[1]*=i.transform.height>0?1:-1,e})),r=Math.abs(i.scaled.width)<20||Math.abs(i.scaled.height)<20?10:0;l.BB.css(t.el,{left:i.scaled.corners[t.i].x-i.gripSize/2+n[e][0]*r+"px",top:i.scaled.corners[t.i].y-i.gripSize/2+n[e][1]*r+"px"});for(var a=l.BB.pointsToAngleDeg({x:i.transform.x,y:i.transform.y},p(t.x,t.y,i.transform))+135;a<0;)a+=360;var o=Math.round(a/45)%i.cornerCursors.length;l.BB.css(t.el,{cursor:i.cornerCursors[o]+"-resize"})},t.pointerListener=new l.BB.PointerListener({target:i.corners[e].el,fixScribble:!0,onPointer:function(t){if(t.eventPreventDefault(),"pointerdown"===t.type&&"left"===t.button)i.corners[e].virtualPos=p(i.corners[e].x,i.corners[e].y,i.transform);else if("pointermove"===t.type&&"left"===t.button){i.corners[e].virtualPos.x+=t.dX/i.scale,i.corners[e].virtualPos.y+=t.dY/i.scale;var n={x:i.corners[e].virtualPos.x,y:i.corners[e].virtualPos.y};n=i.constrainCorner(e,n.x,n.y),i.isConstrained||(n=i.snapCorner(n.x,n.y)),Math.abs(i.transform.angleDeg)%90==0&&(n.x=Math.round(n.x),n.y=Math.round(n.y));var r=d(n.x,n.y,i.transform),a=r.x-i.corners[e].x,o=r.y-i.corners[e].y;i.corners[e].x=r.x,i.corners[e].y=r.y;var s=[];0===e?s=[3,1,2]:1===e?s=[2,0,3]:2===e?s=[1,3,0]:3===e&&(s=[0,2,1]),i.corners[s[0]].x=i.corners[e].x,i.corners[s[1]].y=i.corners[e].y,i.keyListener.isPressed("shift")&&(i.corners[s[2]].x-=a,i.corners[s[2]].y-=o,i.corners[s[1]].x=i.corners[s[2]].x,i.corners[s[0]].y=i.corners[s[2]].y),i.updateTransformViaCorners()}}})}(g);this.updateCornerPositions(),this.updateScaled();for(var f=0;f<4;f++)!function(e){i.edges[e]={el:l.BB.el({css:{width:i.edgeSize+"px",height:i.edgeSize+"px",position:"absolute"}}),updateDOM:null,pointerListener:null};var t=i.edges[e];t.updateDOM=function(){0===e?l.BB.css(t.el,{left:Math.min(i.scaled.corners[0].x,i.scaled.corners[1].x)+"px",top:Math.min(i.scaled.corners[0].y,i.scaled.corners[3].y)-i.edgeSize+"px",width:Math.abs(i.scaled.width)+"px",height:i.edgeSize+"px"}):1===e?l.BB.css(t.el,{left:Math.max(i.scaled.corners[0].x,i.scaled.corners[1].x)+"px",top:Math.min(i.scaled.corners[1].y,i.scaled.corners[2].y)+"px",width:i.edgeSize+"px",height:Math.abs(i.scaled.height)+"px"}):2===e?l.BB.css(t.el,{left:Math.min(i.scaled.corners[3].x,i.scaled.corners[2].x)+"px",top:Math.max(i.scaled.corners[0].y,i.scaled.corners[3].y)+"px",width:Math.abs(i.scaled.width)+"px",height:i.edgeSize+"px"}):3===e&&l.BB.css(t.el,{left:Math.min(i.scaled.corners[0].x,i.scaled.corners[1].x)-i.edgeSize+"px",top:Math.min(i.scaled.corners[0].y,i.scaled.corners[3].y)+"px",width:i.edgeSize+"px",height:Math.abs(i.scaled.height)+"px"});for(var n=Math.round(i.transform.angleDeg/45);n<0;)n+=8;n=(2*e+1+n)%i.cornerCursors.length,t.el.style.cursor=i.cornerCursors[n]+"-resize"};var n=[0,2].includes(e);t.pointerListener=new l.BB.PointerListener({target:i.edges[e].el,fixScribble:!0,onPointer:function(t){if(t.eventPreventDefault(),"pointerdown"===t.type&&"left"===t.button&&(o=n?i.corners[0].y>=i.corners[3].y:i.corners[0].x>=i.corners[1].x,r.x=0,r.y=0),"pointermove"===t.type&&"left"===t.button){var a=l.BB.rotateAround({x:0,y:0},{x:t.dX/i.scale,y:t.dY/i.scale},-i.transform.angleDeg),s={dX:a.x,dY:a.y};Math.abs(i.transform.angleDeg)%90==0&&(s=l.BB.intDxy(r,a.x,a.y));var c=[];0===e?c=[2,3,0,1]:1===e?c=[0,3,1,2]:2===e?c=[0,1,2,3]:3===e&&(c=[1,2,0,3]);var u=n?"y":"x",h=n?s.dY:s.dX;o?(i.corners[c[0]][u]+=h,i.corners[c[1]][u]+=h):(i.corners[c[2]][u]+=h,i.corners[c[3]][u]+=h),i.keyListener.isPressed("shift")&&(o?(i.corners[c[2]][u]-=h,i.corners[c[3]][u]-=h):(i.corners[c[0]][u]-=h,i.corners[c[1]][u]-=h)),n?i.restoreRatio(!1,!0):i.restoreRatio(!0,!1),i.updateTransformViaCorners()}}})}(f);this.angleGrip={el:l.BB.el({css:{cursor:"url("+e(c)+") 10 10, move",width:this.gripSize+"px",height:this.gripSize+"px",background:"#0ff",borderRadius:this.gripSize+"px",position:"absolute",boxShadow:"inset 0 0 0 2px #000"}}),x:0,y:0,snap:!1,updateDOM:function(){l.BB.css(i.angleGrip.el,{left:i.angleGrip.x-i.gripSize/2+"px",top:i.angleGrip.y-i.gripSize/2+"px"})}},l.BB.el({parent:this.angleGrip.el,css:{width:"2px",height:"13px",left:this.gripSize/2-1+"px",top:this.gripSize+"px",background:"#0ff",position:"absolute"}}),this.anglePointerListener=new l.BB.PointerListener({target:this.angleGrip.el,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=i.rootEl.getBoundingClientRect(),n={x:t.left-i.rootEl.scrollLeft,y:t.top-i.rootEl.scrollTop},r={x:(e.clientX-n.x)/i.scale,y:(e.clientY-n.y)/i.scale},a=l.BB.pointsToAngleDeg({x:i.transform.x,y:i.transform.y},r)+90;i.transform.angleDeg=a;var o=45*Math.round(a/360*8);("shift"===i.keyListener.getComboStr()||i.snappingEnabled&&Math.abs(o-a)<8)&&(i.transform.angleDeg=o),i.updateDOM()}"pointerup"===e.type&&Math.abs(i.transform.angleDeg)%90==0&&(u(i.transform),i.updateCornerPositions(),i.updateDOM())}}),u(this.transform),this.updateDOM(!0),l.BB.append(this.transEl,[this.boundsEl,this.edges[0].el,this.edges[1].el,this.edges[2].el,this.edges[3].el,this.corners[0].el,this.corners[1].el,this.corners[2].el,this.corners[3].el,this.angleGrip.el])}return(0,o.default)(t,[{key:"updateScaled",value:function(){var e=this;this.scaled.x=this.transform.x*this.scale,this.scaled.y=this.transform.y*this.scale,this.scaled.width=this.transform.width*this.scale,this.scaled.height=this.transform.height*this.scale,this.scaled.corners=this.corners.map((function(t){return{x:t.x*e.scale,y:t.y*e.scale}}))}},{key:"snapCorner",value:function(e,t){if(!this.snappingEnabled)return{x:e,y:t};for(var n,i,r,a={x:null,y:null,dist:{x:null,y:null}},o=0;o<this.snapX.length;o++)(n=Math.abs(e-this.snapX[o]))<this.minSnapDist/this.scale&&(null===a.x||n<a.dist.x)&&(a.x=this.snapX[o],a.dist.x=n);for(var s=0;s<this.snapY.length;s++)(n=Math.abs(t-this.snapY[s]))<this.minSnapDist/this.scale&&(null===a.y||n<a.dist.y)&&(a.y=this.snapY[s],a.dist.y=n);return null===a.x&&null===a.y?{x:e,y:t}:{x:null!==(i=a.x)&&void 0!==i?i:e,y:null!==(r=a.y)&&void 0!==r?r:t}}},{key:"constrainCorner",value:function(e,t,n){if(!this.isConstrained)return{x:t,y:n};var i=this.transform.width*this.transform.height<0?-1:1;return l.BB.projectPointOnLine({x:this.transform.x,y:this.transform.y},p(this.ratio,i*([0,2].includes(e)?1:-1),this.transform),{x:t,y:n})}},{key:"updateCornerPositions",value:function(){this.corners[0].x=-this.transform.width/2,this.corners[0].y=-this.transform.height/2,this.corners[1].x=this.transform.width/2,this.corners[1].y=-this.transform.height/2,this.corners[2].x=this.transform.width/2,this.corners[2].y=this.transform.height/2,this.corners[3].x=-this.transform.width/2,this.corners[3].y=this.transform.height/2}},{key:"restoreRatio",value:function(e,t){if(this.isConstrained){var n=Math.abs(this.transform.angleDeg)%90==0,i=Math.abs(this.transform.angleDeg-90)%180==0;if(t&&!e){var r=Math.abs(this.corners[3].y-this.corners[0].y),a=this.ratio*r;n&&(a=0==(i?this.transform.y%1:this.transform.x%1)?l.BB.roundEven(a):l.BB.roundUneven(a)),this.corners[1].x-this.corners[0].x<0&&(a*=-1),this.corners[0].x=-a/2,this.corners[3].x=-a/2,this.corners[1].x=a/2,this.corners[2].x=a/2}if(!t&&e){var o=Math.abs(this.corners[0].x-this.corners[1].x)/this.ratio;n&&(o=0==(i?this.transform.x%1:this.transform.y%1)?l.BB.roundEven(o):l.BB.roundUneven(o)),this.corners[3].y-this.corners[0].y<0&&(o*=-1),this.corners[0].y=-o/2,this.corners[1].y=-o/2,this.corners[2].y=o/2,this.corners[3].y=o/2}}}},{key:"updateTransformViaCorners",value:function(){var e=l.BB.rotateAround({x:0,y:0},{x:(this.corners[0].x+this.corners[1].x)/2,y:(this.corners[0].y+this.corners[3].y)/2},this.transform.angleDeg);this.transform.x=e.x+this.transform.x,this.transform.y=e.y+this.transform.y,this.transform.width=this.corners[1].x-this.corners[0].x,this.transform.height=this.corners[3].y-this.corners[0].y,this.updateCornerPositions(),this.updateDOM()}},{key:"updateDOM",value:function(e){this.updateScaled(),l.BB.css(this.transEl,{left:this.scaled.x+"px",top:this.scaled.y+"px",transformOrigin:"0 0",transform:"rotate("+this.transform.angleDeg+"deg)"}),l.BB.css(this.boundsEl,{width:Math.abs(this.scaled.width)+"px",height:Math.abs(this.scaled.height)+"px",left:Math.min(this.scaled.corners[0].x,this.scaled.corners[1].x)+"px",top:Math.min(this.scaled.corners[0].y,this.scaled.corners[3].y)+"px"}),this.corners[0].updateDOM(),this.corners[1].updateDOM(),this.corners[2].updateDOM(),this.corners[3].updateDOM(),this.edges[0].updateDOM(),this.edges[1].updateDOM(),this.edges[2].updateDOM(),this.edges[3].updateDOM(),this.angleGrip.x=0,this.angleGrip.y=-Math.abs(this.transform.height*this.scale)/2-20,this.angleGrip.updateDOM(),e||this.callback&&this.callback(h(this.transform))}},{key:"getTransform",value:function(){return h(this.transform)}},{key:"setConstrained",value:function(e){this.isConstrained=!!e,e&&0!==this.transform.width&&0!==this.transform.height&&(this.ratio=Math.abs(this.transform.width/this.transform.height))}},{key:"setSnapping",value:function(e){this.snappingEnabled=!!e}},{key:"setPos",value:function(e){this.transform.x=e.x,this.transform.y=e.y,this.updateDOM(!0)}},{key:"move",value:function(e,t){this.transform.x+=e,this.transform.y+=t,this.updateDOM(!1)}},{key:"setSize",value:function(e,t){this.transform.width=e,this.transform.height=t,Math.abs(this.transform.angleDeg)%90==0&&u(this.transform),this.updateCornerPositions(),this.updateDOM(!1)}},{key:"setAngleDeg",value:function(e){this.transform.angleDeg=e,Math.abs(this.transform.angleDeg)%90==0&&(u(this.transform),this.updateCornerPositions()),this.updateDOM(!0)}},{key:"getElement",value:function(){return this.rootEl}},{key:"getRatio",value:function(){return this.ratio}},{key:"destroy",value:function(){this.keyListener.destroy(),this.boundsPointerListener.destroy(),this.corners[0].pointerListener.destroy(),this.corners[1].pointerListener.destroy(),this.corners[2].pointerListener.destroy(),this.corners[3].pointerListener.destroy(),this.edges[0].pointerListener.destroy(),this.edges[1].pointerListener.destroy(),this.edges[2].pointerListener.destroy(),this.edges[3].pointerListener.destroy(),this.anglePointerListener.destroy()}}]),t}()})),i.register("lQMok",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("045N6")})),i.register("kEeSq",(function(e,n){t(e.exports,"FreeTransformCanvas",(function(){return s}));var r=i("eWjiX"),a=i("i5nyl"),o=i("cNhNm");function s(e){var t=function(){if(u){var t=u.getTransform();i<1&&(t.x*=i,t.y*=i,t.width*=i,t.height*=i);var n=c[e.transformIndex].image,a=n.getContext("2d");a.save(),a.clearRect(0,0,n.width,n.height),r.BB.drawTransformedImageWithBounds(a,e.layers[e.transformIndex].image,t,null,r.BB.testShouldPixelate(t,t.width/h.width,t.height/h.height)),a.restore(),d.render()}},n=r.BB.fitInto(e.imageWidth,e.imageHeight,e.elementWidth-20,e.elementHeight-60,1),i=n.width/e.imageWidth,s=r.BB.el({css:{width:e.elementWidth+"px",height:e.elementHeight+"px",backgroundColor:"#9e9e9e",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",userSelect:"none",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"}});s.oncontextmenu=function(){return!1};var l=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:n.width+"px",height:n.height+"px"}});s.appendChild(l);var c=e.layers.map((function(e){return{image:e.image,mixModeStr:e.mixModeStr,opacity:e.opacity}}));c[c.length-1].image=r.BB.canvas(i>1?e.imageWidth:n.width,i>1?e.imageHeight:n.height);var u,h,d=new(0,a.KlCanvasPreview)({width:n.width,height:n.height,layers:c});l.appendChild(d.getElement());var p={width:e.layers[e.transformIndex].image.width*i,height:e.layers[e.transformIndex].image.height*i};(p.width>n.width||p.height>n.height)&&(p=r.BB.fitInto(e.layers[e.transformIndex].image.width,e.layers[e.transformIndex].image.height,n.width,n.height,1)),h={x:e.imageWidth/2,y:e.imageHeight/2,width:e.layers[e.transformIndex].image.width,height:e.layers[e.transformIndex].image.height},u=new(0,o.FreeTransform)({x:h.x,y:h.y,width:h.width,height:h.height,angleDeg:0,isConstrained:!0,snapX:[0,e.imageWidth],snapY:[0,e.imageHeight],scale:i,callback:function(e){t()}}),r.BB.css(u.getElement(),{position:"absolute",left:"0",top:"0"}),l.appendChild(u.getElement()),setTimeout(t,0),this.move=function(e,t){u.move(e,t)},this.reset=function(){var n=e.layers[e.transformIndex].image.width,i=e.layers[e.transformIndex].image.height;u.setSize(n,i),u.setPos({x:n/2,y:i/2}),u.setAngleDeg(0),t()},this.setTransformFit=function(){var n=r.BB.fitInto(e.layers[e.transformIndex].image.width,e.layers[e.transformIndex].image.height,e.imageWidth,e.imageHeight,1);u.setSize(n.width,n.height),u.setPos({x:n.width/2,y:n.height/2}),u.setAngleDeg(0),t()},this.setTransformCenter=function(){u.setPos({x:e.imageWidth/2,y:e.imageHeight/2}),u.setAngleDeg(0),t()},this.getTransformation=function(){return!!u&&u.getTransform()},this.getIsPixelated=function(){var e=u.getTransform();return r.BB.testShouldPixelate(e,e.width/h.width,e.height/h.height)},this.getElement=function(){return s},this.destroy=function(){u.destroy()}}})),i.register("32CBv",(function(e,n){t(e.exports,"Cropper",(function(){return a}));var r=i("eWjiX");function a(e){var t=function(e){L[0].y+=e,L[0].y=Math.max(L[3].y-m,Math.min(L[3].y-1,L[0].y)),L[1].y=L[0].y},n=function(e){L[1].x+=e,L[1].x=Math.min(L[0].x+f,Math.max(L[0].x+1,L[1].x)),L[2].x=L[1].x},i=function(e){L[2].y+=e,L[2].y=Math.min(L[1].y+m,Math.max(L[1].y+1,L[2].y)),L[3].y=L[2].y},a=function(e){L[0].x+=e,L[0].x=Math.max(L[1].x-f,Math.min(L[1].x-1,L[0].x)),L[3].x=L[0].x},o=function(){B.x=0,B.y=0,g(s())},s=function(){return L[1].x-=L[0].x,L[1].y-=L[0].y,L[2].x-=L[0].x,L[2].y-=L[0].y,L[3].x-=L[0].x,L[3].y-=L[0].y,c+=L[0].x,u+=L[0].y,L[0].x=0,L[0].y=0,{x:c,y:u,width:L[1].x,height:L[2].y}},l=function(){M[0].update(),M[1].update(),M[2].update(),M[3].update(),D[0].update(),D[1].update(),D[2].update(),D[3].update(),A[0].update(),A[1].update(),A[2].update(),A[3].update(),b.update(),C.update(),S.update()},c=e.x,u=e.y,h=e.width,d=e.height,p=e.scale,g=e.callback,f=e.maxW,m=e.maxH,v=document.createElement("div"),y=["nw","n","ne","e","se","s","sw","w"],x=new r.BB.KeyListener({});r.BB.css(v,{position:"absolute",left:c*p+"px",top:u*p+"px"});var b=document.createElement("div");r.BB.css(b,{position:"absolute",border:"1px dashed #fff",cursor:"move"}),b.update=function(){r.BB.css(b,{left:L[0].x*p-1+"px",top:L[0].y*p-1+"px",width:(L[2].x-L[0].x)*p+"px",height:(L[2].y-L[0].y)*p+"px"})};var B={x:0,y:0},w=new r.BB.PointerListener({target:b,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=r.BB.intDxy(B,e.dX/p,e.dY/p),n=t.dX,i=t.dY;L[0].x+=n,L[0].y+=i,L[1].x+=n,L[1].y+=i,L[2].x+=n,L[2].y+=i,L[3].x+=n,L[3].y+=i,l()}"pointerup"===e.type&&o()}}),C=document.createElement("div");r.BB.css(C,{position:"absolute",borderTop:"1px solid #0ff",borderBottom:"1px solid #0ff"}),C.update=function(){r.BB.css(C,{left:L[0].x*p+"px",top:(L[0].y+(L[2].y-L[0].y)/3)*p+"px",width:(L[2].x-L[0].x)*p+"px",height:(L[2].y-L[0].y)/3*p+"px"})};var S=document.createElement("div");r.BB.css(S,{position:"absolute",borderLeft:"1px solid #0ff",borderRight:"1px solid #0ff"}),S.update=function(){r.BB.css(S,{left:(L[0].x+(L[2].x-L[0].x)/3)*p+"px",top:L[0].y*p+"px",width:(L[2].x-L[0].x)/3*p+"px",height:(L[2].y-L[0].y)*p+"px"})};for(var k=10,L=[{x:0,y:0},{x:h,y:0},{x:h,y:d},{x:0,y:d}],M=[],E=0;E<4;E++)!function(e){M[e]=document.createElement("div");var t=M[e];t.style.width="40px",t.style.height="40px",t.style.position="absolute",t.update=function(){0===e?(t.style.left=L[0].x*p+k+"px",t.style.top=L[0].y*p-80+k+"px",t.style.width=(L[1].x-L[0].x)*p-20+"px",t.style.height="80px"):1===e?(t.style.left=L[1].x*p-k+"px",t.style.top=L[1].y*p+k+"px",t.style.width="80px",t.style.height=(L[2].y-L[1].y)*p-20+"px"):2===e?(t.style.left=L[3].x*p+k+"px",t.style.top=L[3].y*p-k+"px",t.style.width=(L[2].x-L[3].x)*p-20+"px",t.style.height="80px"):3===e&&(t.style.left=L[0].x*p-80+k+"px",t.style.top=L[0].y*p+k+"px",t.style.width="80px",t.style.height=(L[3].y-L[0].y)*p-20+"px");var n=2*e+1;t.style.cursor=y[n]+"-resize"}}(E);for(var A=[],T=0;T<4;T++)!function(e){A[e]=document.createElement("div");var t=A[e];t.style.position="absolute",t.style.background="#000",t.style.opacity="0.5",t.update=function(){0===e?(t.style.left=L[0].x*p+"px",t.style.top=L[0].y*p-8e3+"px",t.style.width=(L[1].x-L[0].x)*p+"px",t.style.height="8000px"):1===e?(t.style.left=L[1].x*p+"px",t.style.top=L[1].y*p-8e3+"px",t.style.width="8000px",t.style.height="16000px"):2===e?(t.style.left=L[3].x*p+"px",t.style.top=L[3].y*p+"px",t.style.width=(L[2].x-L[3].x)*p+"px",t.style.height="8000px"):3===e&&(t.style.left=L[0].x*p-8e3+"px",t.style.top=L[0].y*p-8e3+"px",t.style.width="8000px",t.style.height="16000px")}}(T);var I=new r.BB.PointerListener({target:M[0],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var n=r.BB.intDxy(B,e.dX/p,e.dY/p),a=(n.dX,n.dY);t(a),x.isPressed("shift")&&i(-a),l()}"pointerup"===e.type&&o()}}),R=new r.BB.PointerListener({target:M[1],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=r.BB.intDxy(B,e.dX/p,e.dY/p),i=t.dX;t.dY;n(i),x.isPressed("shift")&&a(-i),l()}"pointerup"===e.type&&o()}}),P=new r.BB.PointerListener({target:M[2],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var n=r.BB.intDxy(B,e.dX/p,e.dY/p),a=(n.dX,n.dY);i(a),x.isPressed("shift")&&t(-a),l()}"pointerup"===e.type&&o()}}),O=new r.BB.PointerListener({target:M[3],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=r.BB.intDxy(B,e.dX/p,e.dY/p),i=t.dX;t.dY;a(i),x.isPressed("shift")&&n(-i),l()}"pointerup"===e.type&&o()}}),D=[];!function(){for(var e=0;e<4;e++)!function(e){D[e]=document.createElement("div");var t=D[e];r.BB.css(t,{width:"80px",height:"80px",position:"absolute"}),t.style.cursor=["nwse-resize","nesw-resize"][e%2],t.update=function(){0===e?r.BB.css(t,{left:L[0].x*p-80+k+"px",top:L[0].y*p-80+k+"px"}):1===e?r.BB.css(t,{left:L[1].x*p-k+"px",top:L[1].y*p-80+k+"px"}):2===e?r.BB.css(t,{left:L[1].x*p-k+"px",top:L[2].y*p-k+"px"}):3===e&&r.BB.css(t,{left:L[0].x*p-80+k+"px",top:L[2].y*p-k+"px"})}}(e)}();var N=new r.BB.PointerListener({target:D[0],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var s=r.BB.intDxy(B,e.dX/p,e.dY/p),c=s.dX,u=s.dY;a(c),t(u),x.isPressed("shift")&&(n(-c),i(-u)),l()}"pointerup"===e.type&&o()}}),z=new r.BB.PointerListener({target:D[1],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var s=r.BB.intDxy(B,e.dX/p,e.dY/p),c=s.dX,u=s.dY;n(c),t(u),x.isPressed("shift")&&(a(-c),i(-u)),l()}"pointerup"===e.type&&o()}}),G=new r.BB.PointerListener({target:D[2],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var s=r.BB.intDxy(B,e.dX/p,e.dY/p),c=s.dX,u=s.dY;n(c),i(u),x.isPressed("shift")&&(a(-c),t(-u)),l()}"pointerup"===e.type&&o()}}),j=new r.BB.PointerListener({target:D[3],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var s=r.BB.intDxy(B,e.dX/p,e.dY/p),c=s.dX,u=s.dY;a(c),i(u),x.isPressed("shift")&&(n(-c),t(-u)),l()}"pointerup"===e.type&&o()}});v.append(A[1],A[0],A[2],A[3],C,S,b,M[1],M[0],M[2],M[3],D[0],D[1],D[2],D[3]),l(),this.getTransform=s,this.setTransform=function(e){c=e.x,u=e.y,h=e.width,d=e.height,r.BB.css(v,{left:c*p+"px",top:u*p+"px"}),L[0].x=0,L[0].y=0,L[1].x=h,L[1].y=0,L[2].x=h,L[2].y=d,L[3].x=0,L[3].y=d,l(),o()},this.setScale=function(e){p=e,r.BB.css(v,{left:c*p+"px",top:u*p+"px"}),l()},this.showThirds=function(e){e?(C.style.display="block",S.style.display="block"):(C.style.display="none",S.style.display="none")},this.getElement=function(){return v},this.destroy=function(){x.destroy(),w.destroy(),N.destroy(),z.destroy(),G.destroy(),j.destroy(),I.destroy(),R.destroy(),P.destroy(),O.destroy()}}})),i.register("kqmpc",(function(e,n){t(e.exports,"LayerPreview",(function(){return s}));var r=i("eWjiX"),a=i("gWfkn"),o=i("1mH1z");function s(e){var t,n,i=function(e){if(h){E.textContent=t.name,I.innerHTML=(0,o.LANG)("opacity")+"<br>"+Math.round(100*t.opacity)+"%";var n=t.context.canvas;if(n.width!==m.width||n.height!==m.height){var i=r.BB.fitInto(n.width,n.height,p,p,1);k.width=Math.round(i.width),k.height=Math.round(i.height),e=!0}v.width=k.width,v.height=k.height,y.save(),y.imageSmoothingEnabled=!1,y.fillStyle=D,y.fillRect(0,0,v.width,v.height),y.drawImage(n,0,0,v.width,v.height),y.restore(),e?(b=0,L.save(),L.drawImage(v,0,0),L.restore()):(b=x,z()),l(),f=a.klHistory.getState(),m.width=n.width,m.height=n.height}},s=function(){i(!0)},l=function(){if(B&&t){var e=t.context.canvas,n=r.BB.fitInto(e.width,e.height,g,g,1);P.width=Math.round(n.width),P.height=Math.round(n.height),O.save(),P.width>e.width?O.imageSmoothingEnabled=!1:(O.imageSmoothingEnabled=!0,O.imageSmoothingQuality="high"),O.fillStyle=N,O.fillRect(0,0,P.width,P.height),O.drawImage(e,0,0,P.width,P.height),O.restore();var i=u.getBoundingClientRect();r.BB.css(R,{top:Math.max(10,i.top+d/2-P.height/2)+"px"})}},c=function(){try{e.klRootEl.removeChild(R)}catch(e){}},u=r.BB.el({}),h=!0,d=40,p=d-10,g=300,f=-2,m={width:0,height:0},v=r.BB.canvas(),y=v.getContext("2d"),x=30,b=0,B=!1,w=300,C=r.BB.el({css:{display:"flex",alignItems:"center",height:d+"px",color:"#666"}}),S=r.BB.el({css:{minWidth:d+"px",height:d+"px",display:"flex",justifyContent:"center",alignItems:"center"}}),k=r.BB.canvas(p,p),L=k.getContext("2d");k.title=(0,o.LANG)("layers-active-layer"),r.BB.css(k,{boxShadow:"0 0 0 1px #9e9e9e",colorScheme:"only light"});var M=r.BB.el({css:{flexGrow:"1",paddingLeft:"10px",fontSize:"13px",overflow:"hidden",position:"relative"}}),E=r.BB.el({content:"",css:{cssFloat:"left",whiteSpace:"nowrap"}}),A=r.BB.el({css:{backgroundImage:"linear-gradient(to right, rgba(221,221,221,0) 0%, rgba(221,221,221,0.8) 100%)",position:"absolute",right:"0",top:"0",width:"50px",height:"100%"}}),T=r.BB.el({css:{position:"absolute",left:"10px",top:"0",width:"90px",height:"100%"}});e.onClick&&(r.BB.addEventListener(T,"click",(function(){e.onClick()})),r.BB.addEventListener(k,"click",(function(){e.onClick()})));var I=r.BB.el({content:(0,o.LANG)("opacity")+"<br>100%",css:{minWidth:"60px",fontSize:"12px",textAlign:"center",background:"#dddddd",color:"#555"}}),R=r.BB.el({onClick:r.BB.handleClick,css:{pointerEvents:"none",background:"#fff",position:"absolute",right:"280px",top:"10px",border:"1px solid #aaa",boxShadow:"1px 1px 3px rgba(0,0,0,0.3)",transition:"opacity "+w+"ms ease-in-out",userSelect:"none",display:"block",webkitTouchCallout:"none",colorScheme:"only light"}}),P=r.BB.canvas(g,g);R.append(P);var O=P.getContext("2d");r.BB.css(P,{display:"block"}),u.appendChild(C),C.appendChild(S),S.appendChild(k),C.appendChild(M),M.appendChild(E),M.appendChild(A),M.appendChild(T),C.appendChild(I);var D=y.createPattern(r.BB.createCheckerCanvas(4),"repeat"),N=L.createPattern(r.BB.createCheckerCanvas(4),"repeat");function z(){0!==b&&(b--,L.save(),L.globalAlpha=Math.pow((x-b)/x,2),L.drawImage(v,0,0),L.restore(),b>0&&requestAnimationFrame(z))}setInterval((function(){t&&(a.klHistory.getState()!==f&&(t.opacity=t.context.canvas.opacity,i(!1)))}),2e3);new r.BB.PointerListener({target:k,onEnterLeave:function(t){!function(t){B!==t&&(clearTimeout(n),B=t,t?n=setTimeout((function(){l(),R.style.opacity="0",e.klRootEl.appendChild(R),setTimeout((function(){R.style.opacity="1"}),20)}),250):(R.style.opacity="0",n=setTimeout(c,w+20)))}(t)}});this.getElement=function(){return u},this.setIsVisible=function(e){if(h!==e){h=e,C.style.display=h?"flex":"none",u.style.marginBottom=h?"":"10px";var t=a.klHistory.getState();e&&f!==t&&s()}},this.setLayer=function(e){t=e,s()},this.setUiState=function(e){"left"===""+e?r.BB.css(R,{left:"280px",right:""}):r.BB.css(R,{left:"",right:"280px"})}}})),i.register("j1kEL",(function(e,n){t(e.exports,"FittedImage",(function(){return a}));var r=i("eWjiX");function a(e){var t=r.BB.fitInto(e.image.width,e.image.height,e.width,e.height,1),n=parseInt(""+t.width),i=parseInt(""+t.height),a=r.BB.canvas(n,i);a.getContext("2d").drawImage(e.image,0,0,n,i),r.BB.css(a,{display:"block",boxShadow:"0 0 0 1px #aaa"}),this.getElement=function(){return a}}})),i.register("8ebuX",(function(e,n){t(e.exports,"showImportAsLayerDialog",(function(){return l}));var r=i("eWjiX"),a=i("kEeSq"),o=i("ekHRj"),s=i("1mH1z");function l(e){var t=function(e,t){m.move(e,t)},n=document.createElement("div");if(r.BB.appendTextDiv(n,(0,s.LANG)("import-as-layer-description")),e.klCanvas.isLayerLimitReached()){var i=r.BB.el({content:(0,s.LANG)("import-as-layer-limit-reached"),css:{background:"#ff0",padding:"10px",marginTop:"5px",marginBottom:"5px",border:"1px solid #e7d321",borderRadius:"5px"}});n.appendChild(i)}var l=window.innerWidth<550,c=r.BB.el({css:{display:"flex"}}),u=r.BB.el({tagName:"button",content:"1:1",css:{marginRight:"10px"},onClick:function(){m.reset()}}),h=r.BB.el({tagName:"button",content:(0,s.LANG)("import-as-layer-fit"),css:{marginRight:"10px"},onClick:function(){m.setTransformFit()}}),d=r.BB.el({tagName:"button",content:(0,s.LANG)("center"),css:{marginRight:"10px"},onClick:function(){m.setTransformCenter()}});c.appendChild(u),c.appendChild(h),c.appendChild(d),n.appendChild(c);for(var p=[],g=e.klCanvas.getLayers(),f=0;f<g.length;f++)p.push({image:g[f].context.canvas,opacity:g[f].opacity,mixModeStr:g[f].mixModeStr});p.push({image:e.importImage,opacity:1,mixModeStr:"source-over"});var m=new(0,a.FreeTransformCanvas)({elementWidth:l?340:540,elementHeight:l?280:350,imageWidth:e.klCanvas.getLayerContext(0).canvas.width,imageHeight:e.klCanvas.getLayerContext(0).canvas.height,layers:p,transformIndex:p.length-1});r.BB.css(m.getElement(),{marginTop:"10px",marginLeft:"-20px"}),n.appendChild(m.getElement());var v=new r.BB.KeyListener({onDown:function(e){"left"===e&&t(-1,0),"right"===e&&t(1,0),"up"===e&&t(0,-1),"down"===e&&t(0,1)}});(0,o.popup)({target:e.target,message:"<b>".concat((0,s.LANG)("import-as-layer-title"),"</b>"),div:n,style:l?null:{width:"500px"},buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(t){v.destroy(),m.destroy(),r.BB.destroyEl(u),r.BB.destroyEl(h),r.BB.destroyEl(d),"Ok"===t?e.callback(m.getTransformation(),m.getIsPixelated()):e.callback()}})}})),i.register("13r5y",(function(e,n){t(e.exports,"KlImageDropper",(function(){return a}));var r=i("eWjiX");function a(e){var t=function(){u=0,h=0,d=0;try{e.target.removeChild(a)}catch(e){}},n=function(e){try{return!e.dataTransfer.types.includes("text/plain")}catch(e){}return!1},i=function(){var e="0 0 20px 4px #fff";h>0?(l.style.boxShadow=e,c.style.boxShadow=""):d>0?(l.style.boxShadow="",c.style.boxShadow=e):(l.style.boxShadow="",c.style.boxShadow="")},a=r.BB.el({content:"Drop to import",css:{paddingTop:"100px",position:"fixed",left:"0",top:"0",width:"100%",height:"100%",background:"rgba(50, 50, 50, 0.7)",color:"#fff",textShadow:"2px 2px #000",textAlign:"center",fontSize:"25px"}}),o=r.BB.el({css:{marginTop:"50px",display:"flex",justifyContent:"center"}}),s={width:"200px",padding:"50px",margin:"10px",borderRadius:"20px",border:"1px dashed #fff",background:"#00aefe",fontWeight:"bold"},l=r.BB.el({content:"As Layer",css:s}),c=r.BB.el({content:"As New Image",css:s});a.appendChild(o),o.appendChild(l),o.appendChild(c);var u=0,h=0,d=0;r.BB.addEventListener(l,"dragenter",(function(){h++,i()})),r.BB.addEventListener(l,"dragleave",(function(){h--,i()})),r.BB.addEventListener(c,"dragenter",(function(){d++,i()})),r.BB.addEventListener(c,"dragleave",(function(){d--,i()})),r.BB.addEventListener(window,"dragover",(function(e){n(e)&&(e.stopPropagation(),e.preventDefault())}),!1),r.BB.addEventListener(window,"dragenter",(function(t){e.enabledTest()&&n(t)&&(0===u&&e.target.appendChild(a),u++)}),!1),r.BB.addEventListener(window,"dragleave",(function(t){n(t)&&0!==u&&0===(u=Math.max(0,u-1))&&e.target.removeChild(a)}),!1),r.BB.addEventListener(window,"drop",(function(r){if(n(r)&&0!==r.dataTransfer.files.length){r.stopPropagation(),r.preventDefault();var o="default";h>0?o="layer":d>0&&(o="image"),e.onDrop(r.dataTransfer.files,o),u>0&&e.target.removeChild(a),u=0,h=0,d=0,i()}else t()}),!1),r.BB.addEventListener(a,"pointerdown",(function(){t()}));new r.BB.KeyListener({onDown:function(e){u>0&&"esc"===e&&t()}})}})),i.register("9p4Zp",(function(e,n){t(e.exports,"OverlayToolspace",(function(){return l}));var r=i("eWjiX"),a=i("kzhsD"),o=i("llzZ0"),s=i("1mH1z");function l(e){var t=function(e){h.setColor(e),d.style.backgroundColor="rgb("+e.r+","+e.g+","+e.b+")"},n=function(){r.BB.unfocusAnyInput(),c.style.display=l?"block":"none",l&&y&&(c.style.left=y.x-Math.round(i.width/2)+"px",c.style.top=y.y-Math.round(i.svHeight+3*i.hHeight/2)+"px")},i={width:150,svHeight:90,hHeight:20,sliderHeight:25},l=!1,c=r.BB.el({css:{position:"absolute",left:"500px",top:"500px",background:"rgb(221, 221, 221)",display:"none",border:"1px solid #fff",boxShadow:"0 0 10px rgba(0,0,0,0.5)",colorScheme:"only light"}}),u={color:null,size:null,opacity:null},h=new(0,a.KlSmallColorSlider)({width:i.width,heightSV:i.svHeight,heightH:i.hHeight,color:e.brushSettingService.getColor(),callback:function(t){d.style.backgroundColor="rgb("+t.r+","+t.g+","+t.b+")",e.brushSettingService.setColor(t,m)}}),d=r.BB.el({css:{width:i.width+"px",height:i.hHeight+"px",pointerEvents:"none"}}),p=e.brushSettingService.getColor();d.style.backgroundColor="rgb("+p.r+","+p.g+","+p.b+")",c.appendChild(d),c.appendChild(h.getElement());var g=new(0,o.KlSlider)({label:(0,s.LANG)("brush-size"),width:i.width,height:i.sliderHeight,min:0,max:500,value:50,resolution:225,eventResMs:1e3/30,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){e.brushSettingService.setSize(t)},formatFunc:function(e){return e<10?r.BB.round(e,1):Math.round(e)}});r.BB.css(g.getElement(),{marginTop:"2px"}),c.appendChild(g.getElement());var f=new(0,o.KlSlider)({label:(0,s.LANG)("opacity"),width:i.width,height:i.sliderHeight,min:0,max:1,value:1,resolution:225,eventResMs:1e3/30,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){e.brushSettingService.setOpacity(t)}});r.BB.css(f.getElement(),{margin:"2px 0"}),c.appendChild(f.getElement());var m=function(e){"color"===e.type&&(l?t(e.value):u.color=e.value),"size"===e.type&&(l?g.setValue(e.value):u.size=e.value),"opacity"===e.type&&(l?f.setValue(e.value):u.opacity=e.value),"sliderConfig"===e.type&&(g.update(e.value.sizeSlider),f.update(e.value.opacitySlider))};e.brushSettingService.subscribe(m);var v=e.brushSettingService.getSliderConfig();g.update(v.sizeSlider),f.update(v.opacitySlider),g.setValue(e.brushSettingService.getSize()),f.setValue(e.brushSettingService.getOpacity());var y=null;r.BB.addEventListener(document,"pointermove",(function(e){y={x:e.pageX,y:e.pageY}}));new r.BB.KeyListener({onDown:function(i,r,a,o){if(!o)return l?(l=!1,void n()):void(e.enabledTest()&&y&&["ctrl+alt","cmd+alt","alt+ctrl","alt+cmd"].includes(a)&&(r.preventDefault(),l=!0,null!==u.color&&(t(u.color),u.color=null),null!==u.size&&(g.setValue(u.size),u.size=null),null!==u.opacity&&(f.setValue(u.opacity),u.opacity=null),n()))},onUp:function(e,t,i){["ctrl+alt","cmd+alt","alt+ctrl","alt+cmd"].includes(i)&&l&&(l=!1,h.end(),n())},onBlur:function(){l&&(l=!1,h.end(),n())}});this.getElement=function(){return c}}})),i.register("8jqzp",(function(n,r){t(n.exports,"ToolspaceTopRow",(function(){return p}));var a=i("eWjiX"),o=i("8oUiM"),s=i("1gUFn"),l=i("gswMe"),c=i("lLh5u"),u=i("5xpQb"),h=i("kS5uZ"),d=i("1mH1z");function p(t){var n=function(e){var t=6+(e.extraPadding?e.extraPadding:0),n=a.BB.el({className:"toolspace-row-button nohighlight",title:e.title,onClick:e.onClick,css:{padding:e.contain?t+"px 0":""}}),i=a.BB.el({css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%"}});return i.style.pointerEvents="none",n.appendChild(i),n.pointerListener=new a.BB.PointerListener({target:n,onEnterLeave:function(e){n.classList.toggle("toolspace-row-button-hover",e)}}),n},i=document.createElement("div");a.BB.css(i,{height:"36px",display:"flex",backgroundImage:"linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)"});var r=n({onClick:t.onLogo,title:(0,d.LANG)("home"),image:t.logoImg?t.logoImg:e(o),contain:!0});r.style.width="45px",r.style.borderRight="1px solid rgb(212, 212, 212)";var p=n({onClick:t.onNew,title:(0,d.LANG)("file-new"),image:e(s),extraPadding:1,contain:!0}),g=n({onClick:t.onImport,title:(0,d.LANG)("file-import"),image:e(l),extraPadding:1,contain:!0}),f=n({onClick:t.onSave,title:(0,d.LANG)("file-save"),image:e(c),extraPadding:1,contain:!0}),m=null;a.BB.canShareFiles()&&(m=n({onClick:t.onShare,title:(0,d.LANG)("file-share"),image:e(u),contain:!0}));var v=n({onClick:t.onHelp,title:(0,d.LANG)("help"),image:e(h),contain:!0});i.appendChild(r),i.appendChild(p),i.appendChild(g),i.appendChild(f),m&&i.appendChild(m),i.appendChild(v),this.getElement=function(){return i}}})),i.register("8oUiM",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("eHdqz")})),i.register("1gUFn",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("3x5dR")})),i.register("gswMe",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("hbDTd")})),i.register("lLh5u",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("16iGk")})),i.register("5xpQb",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("2ME3z")})),i.register("kS5uZ",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("hZnSk")})),i.register("84zxV",(function(n,r){t(n.exports,"ToolDropdown",(function(){return g}));var a=i("eWjiX"),o=i("i8UFO"),s=i("fxAg2"),l=i("fuF9j"),c=i("3N9oF"),u=i("adBnR"),h=i("cafM1"),d=i("gzZrf"),p=i("1mH1z");function g(t){var n=function(e){var t={},n=a.BB.el({parent:R,className:"tool-dropdown-button",title:e.title,css:{padding:"10px 0",height:100/(m.length-1)+"%",boxSizing:"border-box"},onClick:function(t){t.preventDefault(),t.stopPropagation(),e.onClick(e.index,e.id)}});t.wrapper=n;a.BB.el({parent:n,css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain",height:"100%",pointerEvents:"none",opacity:"0.75"}});return t.show=function(e){n.style.display=e?"block":"none"},t.setIsSmall=function(e){n.style.padding=e?k:"10px 0"},t},i=function(e,n){g(),b=!0,x=e,f(),t.onChange(m[x])},r=function(){o.dialogCounter.increase(.5),B=!0;for(var e=0;e<m.length;e++)P[e].show(x!==e);T.style.display="none",L.style.zIndex="1",document.body.appendChild(I),L.appendChild(R)},g=function(){o.dialogCounter.decrease(.5),B=!1,T.style.removeProperty("display"),L.style.removeProperty("z-index"),document.body.removeChild(I),L.removeChild(R)},f=function(){E.title=y[x],A.style.backgroundImage="url('"+v[x]+"')"},m=["draw","fill","gradient","text","shape"],v=[e(s),e(l),e(c),e(u),e(h)],y=["".concat((0,p.LANG)("tool-brush")," [B]"),"".concat((0,p.LANG)("tool-paint-bucket")," [G]"),"".concat((0,p.LANG)("tool-gradient")," [G]"),"".concat((0,p.LANG)("tool-text")," [T]"),"".concat((0,p.LANG)("tool-shape")," [U]")],x=0,b=!0,B=!1;setTimeout((function(){for(var e=1;e<v.length;e++){(new Image).src=v[e]}}),100);var w,C,S,k="6px 0",L=a.BB.el({css:{position:"relative",flexGrow:"1"}}),M=!1;a.BB.hasPointerEvents&&new a.BB.PointerListener({target:L,maxPointers:1,onPointer:function(e){if("pointerdown"===e.type){if(B)return;w=setTimeout((function(){r()}),400),M=!0,C=e.pageX,S=e.pageY}else if("pointermove"===e.type)M&&!B&&a.BB.dist(C,S,e.pageX,e.pageY)>5&&(clearTimeout(w),r());else if("pointerup"===e.type){if(clearTimeout(w),B&&M)for(var n=document.elementFromPoint(e.pageX,e.pageY),i=0;i<P.length;i++)if(n===P[i].wrapper){g(),b=!0,x=i,f(),t.onChange(m[x]);break}M=!1}}});for(var E=a.BB.el({parent:L,className:"toolspace-row-button nohighlight toolspace-row-button-activated",title:y[x],onClick:function(e){if(b&&!B)return e.preventDefault(),e.stopPropagation(),void r();b=!0,t.onChange(m[x]),B&&g()},css:{padding:"10px 0",pointerEvents:"auto",height:"100%",boxSizing:"border-box"}}),A=a.BB.el({parent:E,css:{backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain",width:"calc(100% - 7px)",height:"100%",pointerEvents:"none",opacity:"0.75"}}),T=a.BB.el({parent:E,css:{position:"absolute",right:"1px",bottom:"1px",width:"18px",height:"18px",cursor:"pointer",backgroundImage:"url('"+e(d)+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"60%"},title:"More Tools",onClick:function(e){e.preventDefault(),e.stopPropagation(),r()}}),I=a.BB.el({css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0"}}),R=(new a.BB.PointerListener({target:I,pointers:1,onPointer:function(e){"pointerdown"===e.type&&(e.eventPreventDefault(),g())}}),a.BB.el({className:"tool-dropdown-wrapper",css:{position:"absolute",width:"100%",height:100*(m.length-1)+"%",top:"100%",left:"0",zIndex:"1",boxSizing:"border-box",cursor:"pointer",transition:"height 0.1s ease-in-out, opacity 0.1s ease-in-out",borderBottomLeftRadius:"5px",borderBottomRightRadius:"5px",overflow:"hidden"}})),P=[],O=0;O<m.length;O++)P.push(n({index:O,id:m[O],image:v[O],title:y[O],onClick:i}));f(),this.setIsSmall=function(e){E.style.padding=e?k:"10px 0";for(var t=0;t<m.length;t++)P[t].setIsSmall(e);e?(T.style.width="14px",T.style.height="14px"):(T.style.width="18px",T.style.height="18px")},this.setActive=function(e){if(m.includes(e)){b=!0;for(var t=0;t<m.length;t++)if(m[t]===e){x=t;break}E.classList.add("toolspace-row-button-activated"),f()}else b=!1,E.classList.remove("toolspace-row-button-activated")},this.getActive=function(){return m[x]},this.getElement=function(){return L}}})),i.register("fxAg2",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("6mHrC")})),i.register("fuF9j",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("hS5Hj")})),i.register("3N9oF",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("4KGfM")})),i.register("adBnR",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("doX4v")})),i.register("cafM1",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("7NqHO")})),i.register("gzZrf",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("dz3mY")})),i.register("9Kxky",(function(n,r){t(n.exports,"ToolspaceToolRow",(function(){return d}));var a=i("eWjiX"),o=i("84zxV"),s=i("2dTGs"),l=i("3KoFh"),c=i("eWf2I"),u=i("fc34V"),h=i("1mH1z");function d(t){var n=function(e,n){p!==e&&(p=e,g.setActive(p),f.classList.toggle("toolspace-row-button-activated","hand"===p),n&&t.onActivate(p))},i=function(e){var t=e.doLighten?"6px 0":"8px 0",n=a.BB.el({className:"toolspace-row-button nohighlight",onClick:e.onClick,css:{padding:e.contain?"10px 0":""}}),i=a.BB.el({css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%",transform:e.doMirror?"scale(-1, 1)":"",pointerEvents:"none",opacity:e.doLighten?"0.75":"1"}});return n.appendChild(i),n.pointerListener=new a.BB.PointerListener({target:n,onEnterLeave:function(e){n.classList.toggle("toolspace-row-button-hover",e)}}),n.setIsSmall=function(i){n.style.padding=e.contain?i?t:"10px 0":""},n},r=function(e){var t=document.createElement("div");a.BB.css(t,{flexGrow:"1",position:"relative"});var n=a.BB.createSvg({elementType:"svg",width:"67px",height:"54px",viewBox:"0 0 100 100",preserveAspectRatio:"none"});a.BB.css(n,{position:"absolute",left:"0",top:"0"});var i=a.BB.createSvg({elementType:"defs",childrenArr:[{elementType:"filter",id:"innershadow",x0:"-50%",y0:"-50%",width:"200%",height:"200%",childrenArr:[{elementType:"feGaussianBlur",in:"SourceAlpha",stdDeviation:"10",result:"blur"},{elementType:"feOffset",dx:"2",dy:"2"},{elementType:"feComposite",in2:"SourceAlpha",operator:"arithmetic",k2:"-1",k3:"1",result:"shadowDiff"},{elementType:"feFlood","flood-color":"#000","flood-opacity":"0.2"},{elementType:"feComposite",in2:"shadowDiff",operator:"in"},{elementType:"feComposite",in2:"SourceGraphic",operator:"over",result:"firstfilter"},{elementType:"feGaussianBlur",in:"firstfilter",stdDeviation:"10",result:"blur2"},{elementType:"feOffset",dx:"2",dy:"2"},{elementType:"feComposite",in2:"firstfilter",operator:"arithmetic",k2:"-1",k3:"1",result:"shadowDiff"},{elementType:"feFlood","flood-color":"#000","flood-opacity":"0.2"},{elementType:"feComposite",in2:"shadowDiff",operator:"in"},{elementType:"feComposite",in2:"firstfilter",operator:"over"}]}]}),r=a.BB.createSvg({elementType:"path","vector-effect":"non-scaling-stroke",d:"M0,0 L 100,0 0,100 z",fill:"rgba(0,0,0,0)",class:"toolspace-svg-triangle-button"});r.onclick=function(){e.onLeft(),r.classList.remove("toolspace-svg-triangle-button-hover")};var o=a.BB.createSvg({elementType:"path","vector-effect":"non-scaling-stroke",d:"M100,100 L 100,0 0,100 z",fill:"rgba(0,0,0,0)",class:"toolspace-svg-triangle-button"});o.onclick=function(){e.onRight(),o.classList.remove("toolspace-svg-triangle-button-hover")},t.leftPointerListener=new a.BB.PointerListener({target:r,onEnterLeave:function(e){r.classList.toggle("toolspace-svg-triangle-button-hover",e)}}),t.rightPointerListener=new a.BB.PointerListener({target:o,onEnterLeave:function(e){o.classList.toggle("toolspace-svg-triangle-button-hover",e)}}),n.appendChild(i),n.appendChild(r),n.appendChild(o),t.appendChild(n);var s=a.BB.el({css:{backgroundImage:"url('"+e.leftImage+"')",backgroundRepeat:"no-repeat",backgroundSize:"contain",width:"20px",height:"20px",position:"absolute",left:"10px",top:"8px",pointerEvents:"none"}});t.appendChild(s);var l=a.BB.el({css:{backgroundImage:"url('"+(e.rightImage?e.rightImage:e.leftImage)+"')",backgroundRepeat:"no-repeat",backgroundSize:"contain",width:"20px",height:"20px",position:"absolute",right:"10px",bottom:"8px",transform:e.rightImage?"":"scale(-1, 1)",pointerEvents:"none"}});return t.appendChild(l),t.setIsEnabledLeft=function(e){r.classList.toggle("toolspace-row-button-disabled",!e),s.classList.toggle("toolspace-row-button-disabled",!e)},t.setIsEnabledRight=function(e){o.classList.toggle("toolspace-row-button-disabled",!e),l.classList.toggle("toolspace-row-button-disabled",!e)},t},d=document.createElement("div");a.BB.css(d,{height:"54px",display:"flex",backgroundImage:"linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)"});var p="draw",g=new(0,o.ToolDropdown)({onChange:function(e){n(e,!0)}});d.appendChild(g.getElement());var f=i({onClick:function(){n("hand",!0)},image:e(s),contain:!0,doLighten:!0});f.style.borderRight="1px solid rgb(212, 212, 212)",f.title=(0,h.LANG)("tool-hand"),d.appendChild(f);var m=r({onLeft:t.onZoomIn,onRight:t.onZoomOut,leftImage:e(l),rightImage:e(c)});m.title=(0,h.LANG)("tool-zoom"),d.appendChild(m);var v=i({onClick:t.onZoomIn,image:e(l),contain:!0});v.title=(0,h.LANG)("zoom-in"),d.appendChild(v);var y=i({onClick:t.onZoomOut,image:e(c),contain:!0});y.title=(0,h.LANG)("zoom-out"),d.appendChild(y);var x=r({onLeft:t.onUndo,onRight:t.onRedo,leftImage:e(u),rightImage:null});x.title=(0,h.LANG)("tool-undo-redo"),x.setIsEnabledLeft(!1),x.setIsEnabledRight(!1),d.appendChild(x);var b=i({onClick:t.onUndo,image:e(u),contain:!0});b.title=(0,h.LANG)("undo"),b.classList.add("toolspace-row-button-disabled"),d.appendChild(b);var B=i({onClick:t.onRedo,image:e(u),contain:!0,doMirror:!0});B.title=(0,h.LANG)("redo"),B.classList.add("toolspace-row-button-disabled"),d.appendChild(B),v.style.display="none",y.style.display="none",b.style.display="none",B.style.display="none",this.getElement=function(){return d},this.setIsSmall=function(e){a.BB.css(d,{height:e?"36px":"54px"}),g.setIsSmall(e),f.setIsSmall(e),v.setIsSmall(e),y.setIsSmall(e),b.setIsSmall(e),B.setIsSmall(e),e?(m.style.display="none",x.style.display="none",v.style.display="block",y.style.display="block",b.style.display="block",B.style.display="block"):(m.style.display="block",x.style.display="block",v.style.display="none",y.style.display="none",b.style.display="none",B.style.display="none")},this.setEnableZoomIn=function(e){v.classList.toggle("toolspace-row-button-disabled",!e),m.setIsEnabledLeft(e)},this.setEnableZoomOut=function(e){y.classList.toggle("toolspace-row-button-disabled",!e),m.setIsEnabledRight(e)},this.setEnableUndo=function(e){b.classList.toggle("toolspace-row-button-disabled",!e),x.setIsEnabledLeft(e)},this.setEnableRedo=function(e){B.classList.toggle("toolspace-row-button-disabled",!e),x.setIsEnabledRight(e)},this.setActive=function(e){n(e)},this.getActive=function(){return p}}})),i.register("2dTGs",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("2gZH2")})),i.register("3KoFh",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("04ZZm")})),i.register("eWf2I",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("j9xio")})),i.register("fc34V",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("AnO0a")})),i.register("1Ax5m",(function(e,n){t(e.exports,"ToolspaceStabilizerRow",(function(){return s}));var r=i("eWjiX"),a=i("21VAD"),o=i("1mH1z");function s(e){var t=r.BB.el({tagName:"label",content:(0,o.LANG)("stabilizer")+"&nbsp;",title:(0,o.LANG)("stabilizer-title"),css:{display:"flex",alignItems:"center",fontSize:"13px",color:"rgba(0,0,0,0.6)"}}),n=new(0,a.Select)({optionArr:[["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"]],initValue:e.smoothing,onChange:function(t){e.onSelect(parseInt(t))}});t.appendChild(n.getElement());new r.BB.PointerListener({target:t,onWheel:function(e){n.setDeltaValue(e.deltaY)}});this.getElement=function(){return t}}})),i.register("e4sAN",(function(n,r){t(n.exports,"TabRow",(function(){return s}));var a=i("eWjiX"),o=i("4m0AU");function s(t){for(var n=function(e,t,n){var i={id:e.id,isVisible:!("isVisible"in e)||e.isVisible,onOpen:e.onOpen,onClose:e.onClose,update:function(e){o.className=e===i?n?"tabrow-tab tabrow-tab-opened-accented":"tabrow-tab tabrow-tab-opened":"tabrow-tab",o.style.display=i.isVisible?"block":"none"}},o=a.BB.el({content:"label"in e?e.label:"",title:"title"in e?e.title:void 0,className:t===i.id?n?"tabrow-tab tabrow-tab-opened-accented":"tabrow-tab tabrow-tab-opened":"tabrow-tab",css:{lineHeight:s+"px",display:i.isVisible?"block":"none",zIndex:"0"},onClick:function(){u!==i&&r.open(i.id)}});i.div=o,"image"in e&&a.BB.css(o,{backgroundImage:"url('"+e.image+"')",backgroundSize:s-7+"px"}),"css"in e&&a.BB.css(o,e.css),l.appendChild(o);new a.BB.PointerListener({target:o,onEnterLeave:function(e){o.classList.toggle("tabrow-tab-hover",e)}});return t===i.id?(i.onOpen(),i.div.appendChild(h),i.div.appendChild(d)):i.onClose(),i},i=function(){for(var e=0;e<c.length;e++)c[e].update(u)},r=this,s=35,l=a.BB.el({className:"tabrow",css:{height:s+"px"}}),c=[],u=null,h=a.BB.el({css:{width:"10px",height:"10px",backgroundImage:"url('".concat(e(o),"')"),backgroundSize:"cover",position:"absolute",right:"-10px",bottom:"0",pointerEvents:"none"}}),d=a.BB.el({css:{width:"10px",height:"10px",backgroundImage:"url('".concat(e(o),"')"),backgroundSize:"cover",position:"absolute",left:"-10px",bottom:"0",transform:"scale(-1,1)",pointerEvents:"none"}}),p=0;p<t.tabArr.length;p++)c.push(n(t.tabArr[p],t.initialId,t.useAccent));for(var g=0;g<c.length;g++)c[g].id===t.initialId&&(u=c[g]);if(null===u)throw"invalid initialId";this.getElement=function(){return l},this.open=function(e){for(var t=0;t<c.length;t++)if(c[t].id===e){if(u===c[t])return;return u.onClose(),(u=c[t]).onOpen(),u.div.appendChild(h),u.div.appendChild(d),void i()}throw"TabRow.open - invalid tabId"},this.getOpenedTabId=function(){return""+u.id},this.setIsVisible=function(e,t){for(var n=0;n<c.length;n++)if(c[n].id===e)return c[n].isVisible=!!t,void i();throw"TabRow.setIsVisible - invalid tabId"}}})),i.register("4m0AU",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("nTvP2")})),i.register("khi8I",(function(n,r){t(n.exports,"HandUi",(function(){return c}));var a=i("eWjiX"),o=i("bv5Zj"),s=i("2n4Fs"),l=i("1mH1z");function c(t){var n=function(){g.innerHTML=Math.round(100*c)+"%",m.innerHTML=Math.round(u)+"°",f.style.transform="rotate("+u+"deg)",f.style.boxShadow=u%90==0?"inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)":""},i=a.BB.el({css:{margin:"10px"}}),r=!0,c=t.scale,u=t.angleDeg,h=a.BB.el({css:{marginBottom:"10px",display:"flex"}}),d=a.BB.el({css:{display:"flex",marginBottom:"10px"}}),p=a.BB.el({css:{display:"flex"}});i.append(h,d,p);var g=a.BB.el({css:{width:"55px",userSelect:"none"}});h.appendChild(g);var f=new Image;f.src=e(o),a.BB.css(f,{verticalAlign:"bottom",width:"20px",height:"20px",marginRight:"5px",borderRadius:"10px",background:"rgba(0,0,0,0.2)",userSelect:"none"}),h.appendChild(f);var m=a.BB.el({css:{userSelect:"none"}});h.appendChild(m),n();var v=a.BB.el({tagName:"button",content:(0,l.LANG)("hand-reset"),onClick:t.onReset});a.BB.makeUnfocusable(v);var y=a.BB.el({tagName:"button",content:(0,l.LANG)("hand-fit"),css:{marginLeft:"10px"},onClick:t.onFit});a.BB.makeUnfocusable(y),d.append(v,y);var x=a.BB.el({tagName:"button",content:'<img height="20" src="'+e(s)+'" alt="Rotate" style="transform: scale(-1, 1)"/>',onClick:function(){t.onAngleChange(-15,!0)}});a.BB.makeUnfocusable(x);var b=a.BB.el({tagName:"button",content:"0°",css:{marginLeft:"10px"},onClick:function(){t.onAngleChange(0)}});a.BB.makeUnfocusable(b);var B=a.BB.el({tagName:"button",content:'<img height="20" src="'+e(s)+'" alt="Rotate"/>',css:{marginLeft:"10px"},onClick:function(){t.onAngleChange(15,!0)}});a.BB.makeUnfocusable(B),p.append(x,b,B),this.getElement=function(){return i},this.setIsVisible=function(e){r=!!e,i.style.display=r?"block":"none",r&&n()},this.update=function(e,t){c=e,u=t,r&&n()}}})),i.register("2n4Fs",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("6toXQ")})),i.register("dJXmR",(function(e,n){t(e.exports,"FillUi",(function(){return c}));var r=i("eWjiX"),a=i("llzZ0"),o=i("21VAD"),s=i("lXqiv"),l=i("1mH1z");function c(e){var t=r.BB.el({css:{margin:"10px"}}),n=!0,i=r.BB.el({parent:t,css:{marginBottom:"10px"}}),c=new(0,a.KlSlider)({label:(0,l.LANG)("opacity"),width:250,height:30,min:.01,max:1,value:1,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e}});t.appendChild(c.getElement());var u=new(0,a.KlSlider)({label:(0,l.LANG)("bucket-tolerance"),width:250,height:30,min:0,max:255,value:51,toValue:function(e){return 2.55*e},toDisplayValue:function(e){return e/2.55}});r.BB.css(u.getElement(),{marginTop:"10px"}),t.appendChild(u.getElement());var h,d,p=r.BB.el({parent:t,css:{display:"flex",marginTop:"10px"}});h=r.BB.el({content:(0,l.LANG)("bucket-sample")+"&nbsp;",title:(0,l.LANG)("bucket-sample-title"),css:{fontSize:"15px"}}),d=new(0,o.Select)({optionArr:[["all",(0,l.LANG)("bucket-sample-all")],["current",(0,l.LANG)("bucket-sample-active")],["above",(0,l.LANG)("bucket-sample-above")]],initValue:"all",onChange:function(e){}});var g,f;new r.BB.PointerListener({target:d.getElement(),onWheel:function(e){d.setDeltaValue(e.deltaY)}});h.appendChild(d.getElement()),p.appendChild(h),g=r.BB.el({content:(0,l.LANG)("bucket-grow")+"&nbsp;",title:(0,l.LANG)("bucket-grow-title"),css:{fontSize:"15px",marginLeft:"10px"}}),f=new(0,o.Select)({optionArr:[["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"]],initValue:"0",onChange:function(e){}});new r.BB.PointerListener({target:f.getElement(),onWheel:function(e){f.setDeltaValue(e.deltaY)}});g.appendChild(f.getElement()),p.appendChild(g);var m=!0,v=new(0,s.Checkbox)({init:!0,label:(0,l.LANG)("bucket-contiguous"),title:(0,l.LANG)("bucket-contiguous-title"),callback:function(e){m=e},css:{paddingRight:"5px",display:"inline-block",width:"50%"}}),y=new(0,s.Checkbox)({init:!1,label:(0,l.LANG)("eraser"),callback:function(e){},css:{paddingRight:"5px",display:"inline-block",width:"50%"}});t.append(r.BB.el({content:[v.getElement(),y.getElement()],css:{display:"flex",marginTop:"10px"}})),this.getElement=function(){return t},this.setIsVisible=function(r){n=!!r,t.style.display=n?"block":"none",n&&(i.appendChild(e.colorSlider.getElement()),i.appendChild(e.colorSlider.getOutputElement()))},this.getTolerance=function(){return u.getValue()},this.getOpacity=function(){return c.getValue()},this.getSample=function(){return d.getValue()},this.getGrow=function(){return parseInt(f.getValue(),10)},this.getContiguous=function(){return m},this.getIsEraser=function(){return y.getValue()}}})),i.register("iS9xS",(function(e,n){t(e.exports,"TextUi",(function(){return o}));var r=i("eWjiX"),a=i("1mH1z");function o(e){var t=r.BB.el({css:{margin:"10px"}}),n=!0,i=r.BB.el({parent:t,css:{marginBottom:"10px"}});r.BB.el({parent:t,content:(0,a.LANG)("text-instruction")});this.getElement=function(){return t},this.setIsVisible=function(r){n=!!r,t.style.display=n?"block":"none",n&&(i.appendChild(e.colorSlider.getElement()),i.appendChild(e.colorSlider.getOutputElement()))}}})),i.register("9J17G",(function(e,n){t(e.exports,"ShapeUi",(function(){return c}));var r=i("eWjiX"),a=i("iskOY"),o=i("lXqiv"),s=i("llzZ0"),l=i("1mH1z");function c(e){var t,n,i=function(){var e=r.BB.clamp(Math.round(E.getValue()/10),1,10)+"px",t=1.35;r.BB.css(g,{fill:"none",stroke:"black",strokeWidth:e}),r.BB.css(m,{fill:"black",stroke:"none"}),r.BB.css(y,{fill:"none",stroke:"black",strokeWidth:e}),r.BB.css(b,{fill:"black",stroke:"none"}),r.BB.css(w,{fill:"none",stroke:"black",strokeWidth:e}),R.getValue()?(g.setAttribute("y",""+p),g.setAttribute("height",""+(d-2*p)),m.setAttribute("y",""+p),m.setAttribute("height",""+(d-2*p)),y.setAttribute("ry",""+(d/2-p)),b.setAttribute("ry",""+(d/2-p))):(g.setAttribute("y",""+p*t),g.setAttribute("height",""+(d-p*t*2)),m.setAttribute("y",""+p*t),m.setAttribute("height",""+(d-p*t*2)),y.setAttribute("ry",""+(d/2-p*t)),b.setAttribute("ry",""+(d/2-p*t))),P.getValue()?(w.setAttribute("y1",""+(d-p)),w.setAttribute("y2",""+p)):(w.setAttribute("y1",""+(d-p*t)),w.setAttribute("y2",""+p*t))},c=r.BB.el({css:{margin:"10px"}}),u=!0,h=r.BB.el({parent:c,css:{marginBottom:"10px"}}),d=35,p=8,g=r.BB.createSvg({elementType:"rect",x:""+p,width:""+(d-2*p)}),f=r.BB.createSvg({elementType:"svg",width:""+d,height:""+d});f.appendChild(g),r.BB.css(f,{display:"block"});var m=r.BB.createSvg({elementType:"rect",x:""+p,width:""+(d-2*p)}),v=r.BB.createSvg({elementType:"svg",width:""+d,height:""+d});v.appendChild(m),r.BB.css(v,{display:"block"});var y=r.BB.createSvg({elementType:"ellipse",cx:""+d/2,cy:""+d/2,rx:""+(d/2-p)}),x=r.BB.createSvg({elementType:"svg",width:""+d,height:""+d});x.appendChild(y),r.BB.css(x,{display:"block"});var b=r.BB.createSvg({elementType:"ellipse",cx:""+d/2,cy:""+d/2,rx:""+(d/2-p)}),B=r.BB.createSvg({elementType:"svg",width:""+d,height:""+d});B.appendChild(b),r.BB.css(B,{display:"block"});var w=r.BB.createSvg({elementType:"line",x1:""+p,x2:""+(d-p)}),C=r.BB.createSvg({elementType:"svg",width:""+d,height:""+d});C.appendChild(w),r.BB.css(C,{display:"block"});var S=r.BB.el({parent:c,css:{display:"flex",justifyContent:"space-between",alignItems:"start"}}),k=new(0,a.Options)({optionArr:[{id:"rect-stroke",label:f,title:(0,l.LANG)("shape-rect")+" "+(0,l.LANG)("shape-stroke")},{id:"ellipse-stroke",label:x,title:(0,l.LANG)("shape-ellipse")+" "+(0,l.LANG)("shape-stroke")},{id:"line",label:C,title:(0,l.LANG)("shape-line")},{id:"rect-fill",label:v,title:(0,l.LANG)("shape-rect")+" "+(0,l.LANG)("shape-fill")},{id:"ellipse-fill",label:B,title:(0,l.LANG)("shape-ellipse")+" "+(0,l.LANG)("shape-fill")}],initId:"rect",onChange:function(e){var i=e.split("-");t=i[0],n=i[1],r.BB.css(R.getElement(),{display:"line"===t?"none":null}),r.BB.css(P.getElement(),{display:"line"===t?null:"none"}),r.BB.css(E.getElement(),{display:"line"!==t&&"fill"===n?"none":null})},changeOnInit:!0});k.getElement().style.width="120px",S.appendChild(k.getElement());var L=new(0,o.Checkbox)({init:!1,label:(0,l.LANG)("eraser"),callback:function(e){i()}}),M=new(0,o.Checkbox)({init:!1,label:(0,l.LANG)("lock-alpha"),title:(0,l.LANG)("lock-alpha-title"),callback:function(e){},doHighlight:!0});M.getElement().style.marginTop="10px",S.append(r.BB.el({content:[L.getElement(),M.getElement()]}));var E=new(0,s.KlSlider)({label:(0,l.LANG)("shape-line-width"),width:250,height:30,min:1,max:200,value:4,curve:"quadratic",onChange:function(e){i()}});r.BB.css(E.getElement(),{marginTop:"10px"}),c.appendChild(E.getElement());var A=new(0,s.KlSlider)({label:(0,l.LANG)("opacity"),width:250,height:30,min:.01,max:1,value:1,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e}});r.BB.css(A.getElement(),{marginTop:"10px"}),c.appendChild(A.getElement());var T=r.BB.el({parent:c,css:{display:"flex",alignItems:"center",marginTop:"10px"}}),I=new(0,o.Checkbox)({init:!1,label:(0,l.LANG)("shape-outwards"),callback:function(e){},css:{width:"50%",marginRight:"10px"}});T.appendChild(I.getElement());var R=new(0,o.Checkbox)({init:!1,label:(0,l.LANG)("shape-fixed"),callback:function(e){i()},css:{flexGrow:"1"}});T.appendChild(R.getElement());var P=new(0,o.Checkbox)({init:!1,label:(0,l.LANG)("angle-snap"),title:(0,l.LANG)("angle-snap-title"),callback:function(e){i()},css:{flexGrow:"1"}});T.appendChild(P.getElement()),i(),this.getElement=function(){return c},this.setIsVisible=function(t){u=!!t,c.style.display=u?"block":"none",u&&(h.appendChild(e.colorSlider.getElement()),h.appendChild(e.colorSlider.getOutputElement()))},this.getShape=function(){return t},this.getMode=function(){return n},this.getIsEraser=function(){return L.getValue()},this.getOpacity=function(){return A.getValue()},this.getLineWidth=function(){return E.getValue()},this.getIsOutwards=function(){return I.getValue()},this.getIsFixed=function(){return R.getValue()},this.getIsSnap=function(){return P.getValue()},this.getDoLockAlpha=function(){return M.getValue()}}})),i.register("76Qvv",(function(e,n){t(e.exports,"newImageDialog",(function(){return c}));var r=i("eWjiX"),a=i("21VAD"),o=i("9A7OD"),s=i("ekHRj"),l=i("1mH1z");function c(e){var t=function(e,t,n,i,a){return r.BB.fitInto(e,t,Math.min(u,n-a),Math.min(u,i-a),1)},n=function(){b.value=""+Math.min(u,parseInt(b.value)),w.value=""+Math.min(u,parseInt(w.value));var e=parseInt(b.value),t=parseInt(w.value);(e<1||e>u||t<1||t>u)&&(e>u?e=u:t>u&&(t=u),b.value=""+e,w.value=""+t);for(var n=[[1,2],[2,1],[2,3],[3,2],[3,4],[4,3],[4,5],[5,4],[16,9],[9,16],[3,2],[2,3],[5,3],[3,5],[2,1],[1,2],[1.414,1],[1,1.414]],i=r.BB.reduce(e,t),a=null,o=null,s=0;s<n.length;s++)(0===s||Math.abs(n[s][0]/n[s][1]-i[0]/i[1])<o)&&(a=n[s],o=Math.abs(n[s][0]/n[s][1]-i[0]/i[1]));S.innerText=o>0&&o<.005?(0,l.LANG)("new-ratio")+": ~"+a[0]+":"+a[1]:(0,l.LANG)("new-ratio")+": "+i[0]+":"+i[1],e,t;var c=e,h=function(e,t){for(var n=e,i=t;;){if(!(n%=i))return i;if(!(i%=n))return n}}(e,t);e/=h,t/=h,t*=260,(e*=260)>260&&(t*=260/e,e=260),t>100&&(e*=100/t,t=100),z.style.width=e+"px",z.style.height=t+"px",r.BB.createCheckerDataUrl(parseInt(""+e/c*30),(function(e){N.style.background="url("+e+")"}))},i=e.currentColor,c=e.secondaryColor,u=e.maxCanvasSize,h=e.canvasWidth,d=e.canvasHeight,p=e.workspaceWidth,g=e.workspaceHeight,f=e.onConfirm,m=e.onCancel,v=document.createElement("div"),y=document.createElement("div"),x=document.createElement("div"),b=document.createElement("input"),B=document.createElement("div"),w=document.createElement("input"),C=document.createElement("div");y.style.position="relative",y.style.width="145px",y.style.height="35px",y.style.lineHeight="30px",x.style.width="145px",x.style.height="35px",x.style.lineHeight="30px",B.innerText=(0,l.LANG)("new-px"),B.style.color="#888",B.style.fontSize="12px",B.style.marginLeft="5px",B.style.cssFloat="right",C.innerText=(0,l.LANG)("new-px"),C.style.color="#888",C.style.fontSize="12px",C.style.marginLeft="5px",C.style.cssFloat="right",b.setAttribute("data-ignore-focus","true"),w.setAttribute("data-ignore-focus","true"),b.type="number",b.min="1",b.max=u,b.style.cssFloat="right",b.style.width="70px",w.type="number",w.min="1",w.max=u,w.style.cssFloat="right",w.style.width="70px",b.value=h,w.value=d,b.onclick=function(){this.focus(),n()},w.onclick=function(){this.focus(),n()},y.appendChild(B),y.appendChild(b),r.BB.appendTextDiv(y,(0,l.LANG)("width")+": "),x.appendChild(C),x.appendChild(w),r.BB.appendTextDiv(x,(0,l.LANG)("height")+": ");var S=document.createElement("div");S.style.marginTop="5px",S.style.color="#888";var k=document.createElement("div"),L=document.createElement("button");k.style.marginBottom="10px";var M=document.createElement("button"),E=document.createElement("button"),A=document.createElement("button"),T=document.createElement("button"),I=document.createElement("button");M.textContent=(0,l.LANG)("new-current"),L.textContent=(0,l.LANG)("new-fit"),I.textContent=(0,l.LANG)("new-oversize"),A.textContent=(0,l.LANG)("new-landscape"),T.textContent=(0,l.LANG)("new-portrait"),E.textContent=(0,l.LANG)("new-square"),M.style.marginRight="5px",L.style.marginRight="5px",I.style.marginRight="5px",A.style.marginTop="5px",A.style.marginRight="5px",T.style.marginTop="5px",T.style.marginRight="5px",k.appendChild(M),k.appendChild(L),k.appendChild(I),k.appendChild(E),k.appendChild(A),k.appendChild(T);M.onclick=function(){b.value=h,w.value=d,n()},L.onclick=function(){b.value=p,w.value=g,n()},I.onclick=function(){b.value=p+500,w.value=g+500,n()},E.onclick=function(){var e=t(1,1,p,g,0);b.value=""+Math.round(e.width),w.value=""+Math.round(e.height),n()},A.onclick=function(){var e=t(4,3,p,g,0);b.value=""+Math.round(e.width),w.value=""+Math.round(e.height),n()},T.onclick=function(){var e=t(3,4,p,g,0);b.value=""+Math.round(e.width),w.value=""+Math.round(e.height),n()};var R=new(0,a.Select)({isFocusable:!0,optionArr:[["screen",(0,l.LANG)("new-screen")],["16 9",(0,l.LANG)("new-video")+" 16:9"],["3 2","3:2"],["5 3","5:3"],["2 1","2:1"],["paper",(0,l.LANG)("new-din-paper")+" √2:1"],["9 16","9:16"],["2 3","2:3"],["3 5","3:5"],["1 2","1:2"],["1 1.4142135623730951","1:√2"]],onChange:function(e){if("screen"===e)b.value=""+window.screen.width,w.value=""+window.screen.height;else if("paper"===e){var i=t(Math.sqrt(2),1,p,g,0);b.value=""+Math.round(i.width),w.value=""+Math.round(i.height)}else{var r=e.split(" "),a=t(parseFloat(r[0]),parseFloat(r[1]),p,g,0);b.value=""+Math.round(a.width),w.value=""+Math.round(a.height)}n(),R.setValue(null)}});setTimeout((function(){R.setValue(null)}),0),r.BB.css(R.getElement(),{width:"80px"}),k.appendChild(R.getElement());var P={r:255,g:255,b:255,a:1},O=[{r:255,g:255,b:255,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:0}];O.push({r:i.r,g:i.g,b:i.b,a:1}),O.push({r:c.r,g:c.g,b:c.b,a:1});var D=new(0,o.ColorOptions)({colorArr:O,onChange:function(e){P=e,z.style.backgroundColor="rgba("+e.r+","+e.g+","+e.b+", "+e.a+")"}}),N=document.createElement("div");r.BB.css(N,{boxSizing:"border-box",width:"340px",height:"140px",display:"table",backgroundColor:"#9e9e9e",padding:"10px",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",marginLeft:"-20px",colorScheme:"only light"});var z=document.createElement("div");r.BB.css(z,{width:"200px",height:"100px",backgroundColor:"#fff",marginLeft:"auto",marginRight:"auto",color:"#aaa",fontSize:"16px",fontWeight:"bold",textAlign:"center",verticalAlign:"center",display:"table",overflow:"hidden",boxShadow:"0px 0px 3px rgba(0,0,0,0.5)"});var G=document.createElement("div");G.style.display="table-cell",G.style.verticalAlign="middle",G.appendChild(z),N.appendChild(G);var j=r.BB.appendTextDiv(z,"");j.style.display="table-cell",j.style.verticalAlign="middle";parseInt(b.value),parseInt(w.value);b.onchange=function(){(""===b.value||parseInt(b.value)<0)&&(b.value="1"),n()},b.onkeyup=function(){n()},w.onchange=function(){(""===w.value||parseFloat(w.value)<0)&&(w.value="1"),n()},w.onkeyup=function(){n()},n(),v.appendChild(k);var H=r.BB.el({parent:v,css:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"}}),X=r.BB.el({parent:H});X.appendChild(y),X.appendChild(x),X.appendChild(S),H.appendChild(D.getElement()),v.appendChild(N),(0,s.popup)({target:document.body,message:"<b>".concat((0,l.LANG)("new-title"),"</b>"),div:v,buttons:["Ok","Cancel"],callback:function(e){b.onclick=null,w.onclick=null,M.onclick=null,L.onclick=null,I.onclick=null,E.onclick=null,A.onclick=null,T.onclick=null,b.onchange=null,b.onkeyup=null,w.onchange=null,w.onkeyup=null,R.destroy(),D.destroy(),"Cancel"===e||parseInt(b.value)<=0||parseInt(w.value)<=0||isNaN(parseInt(b.value))||isNaN(parseInt(w.value))?m():f(parseInt(b.value),parseInt(w.value),P)},clickOnEnter:"Ok"})}})),i.register("1uc3b",(function(n,r){t(n.exports,"ToolspaceCollapser",(function(){return l}));var a=i("eWjiX"),o=i("jiQkU"),s=i("1mH1z");function l(t){var n=function(){c.style.transform="left"===r?i?"rotate(180deg)":"":i?"":"rotate(180deg)"},i=!0,r="right",l=a.BB.el({css:{width:"36px",height:"36px",background:"rgba(100, 100, 100, 0.9)",color:"#fff",position:"absolute",top:"0",textAlign:"center",lineHeight:"36px",cursor:"pointer",userSelect:"none",padding:"6px",boxSizing:"border-box"},title:(0,s.LANG)("toggle-show-tools"),onClick:function(e){e.preventDefault(),i=!i,n(),t.onChange()}}),c=a.BB.el({parent:l,css:{backgroundImage:"url(".concat(e(o),")"),width:"100%",height:"100%",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",userSelect:"none"}});l.oncontextmenu=function(){return!1},this.isOpen=function(){return i},this.setDirection=function(e){r=e,n()},this.getElement=function(){return l}}})),i.register("jiQkU",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("b1UMP")})),i.register("keKW3",(function(n,r){t(n.exports,"textToolDialog",(function(){return C}));var a=i("3Rl3W"),o=i("a7ch7"),s=i("eWjiX"),l=i("h20yl"),c=i("9A7OD"),u=i("21VAD"),h=i("gmlbk"),d=i("jKOQl"),p=i("llzZ0"),g=i("ekHRj"),f=i("2dqOY"),m=i("rk4vM"),v=i("hucjG"),y=i("cZa2s"),x=i("03Zd8"),b=i("3KoFh"),B=i("eWf2I"),w=i("1mH1z");function C(t){var n=function(){P.clearRect(0,0,R.width,R.height);var e=(0,o.default)((0,a.default)({},t.color),{a:ce.getValue()}),n=(0,l.renderText)(R,{x:t.x,y:t.y,textStr:ue.value,align:oe.getValue(),isItalic:se.getValue(),isBold:le.getValue(),size:parseFloat(re.value),font:Z.getValue(),color:s.BB.ColorConverter.toRgbaStr(e),angleRad:t.angleRad});n.width=Math.max(n.width,1),n.height=Math.max(n.height,1);var i=s.BB.rotate(n.x,n.y,-t.angleRad/Math.PI*180),r=s.BB.rotate(n.width,n.height,-t.angleRad/Math.PI*180),c=t.x+i.x+r.x/2,u=t.y+i.y+r.y/2,h=s.BB.fitInto(n.width,n.height,E-100,A-100);T=Math.min(1,h.width/n.width),T=Math.min(4,T*Math.pow(2,ee)),D.save(),T>=4?D.imageSmoothingEnabled=!1:(D.imageSmoothingEnabled=!0,D.imageSmoothingQuality=T>=1?"low":"medium"),D.clearRect(0,0,G.width,G.height),D.translate(E/2,A/2),D.scale(T,T),D.rotate(t.angleRad),D.drawImage(I[t.layerIndex].canvas,-c,-u),D.drawImage(R,-c,-u),D.restore(),z.save(),z.fillStyle="rgb(158,158,158)",z.fillRect(0,0,E,A),z.save(),z.translate(E/2,A/2),z.scale(T,T),z.rotate(t.angleRad),z.imageSmoothingEnabled=!1;var d=1/T;z.globalAlpha=.2,z.drawImage(F,-c-d,-u-d,R.width+2*d,R.height+2*d),z.globalAlpha=1,z.globalCompositeOperation="destination-out",z.drawImage(F,-c,-u,R.width,R.height),z.restore(),T>=4?z.imageSmoothingEnabled=!1:(z.imageSmoothingEnabled=!0,z.imageSmoothingQuality=T>=1?"low":"medium"),z.save(),z.translate(E/2,A/2),z.scale(T,T),z.rotate(t.angleRad);for(var p=0;p<t.layerIndex;p++)I[p].opacity>0&&(z.globalAlpha=I[p].opacity,z.globalCompositeOperation=I[p].mixModeStr,z.drawImage(I[p].canvas,-c,-u));z.restore(),z.globalAlpha=I[t.layerIndex].opacity,z.globalCompositeOperation=I[t.layerIndex].mixModeStr,z.drawImage(O,0,0),z.save(),z.translate(E/2,A/2),z.scale(T,T),z.rotate(t.angleRad);for(var g=t.layerIndex+1;g<I.length;g++)I[g].opacity>0&&(z.globalAlpha=I[g].opacity,z.globalCompositeOperation=I[g].mixModeStr,z.drawImage(I[g].canvas,-c,-u));z.restore(),z.restore(),j.save(),j.fillStyle=X,j.fillRect(0,0,G.width,G.height),j.drawImage(N,0,0),j.restore(),j.save(),j.globalCompositeOperation="difference",j.strokeStyle="#fff",j.lineWidth=1,j.strokeRect(Math.round(E/2-n.width/2*T),Math.round(A/2-n.height/2*T),Math.round(n.width*T),Math.round(n.height*T)),j.restore()},i=function(e,i){var r=s.BB.rotate(e,i,-t.angleRad/Math.PI*180);t.x+=r.x/T,t.y+=r.y/T,n()},r=function(e){ee=Math.min(2,Math.max(-2,ee+e)),n(),ne.disabled=!C(1),ie.disabled=!C(-1)},C=function(e){return ee!==Math.min(2,Math.max(-2,ee+e))},S=function(){window.scrollTo(0,0)},k=s.BB.el({}),L=window.innerWidth<550,M=window.innerHeight<630,E=L?340:540,A=L?M?210:260:M?230:350,T=1,I=t.klCanvas.getLayersFast(),R=s.BB.canvas(t.klCanvas.getWidth(),t.klCanvas.getHeight()),P=R.getContext("2d"),O=s.BB.canvas(E,A),D=O.getContext("2d"),N=s.BB.canvas(E,A),z=N.getContext("2d"),G=s.BB.canvas(E,A),j=G.getContext("2d");s.BB.css(G,{display:"block"});var H=s.BB.el({parent:k,css:{position:"relative",width:E+"px",marginLeft:"-20px",cursor:"move",colorScheme:"only light",touchAction:"none"},onClick:function(){ue.focus()}});s.BB.el({parent:H,css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",pointerEvents:"none"}}),H.appendChild(G);var X=j.createPattern(s.BB.createCheckerCanvas(8),"repeat"),F=s.BB.canvas(1,1);F.getContext("2d").fillRect(0,0,1,1);var U=new s.BB.PointerListener({target:G,pointers:1,onPointer:function(e){"pointermove"===e.type&&e.button&&(e.eventPreventDefault(),i(-e.dX,-e.dY))},onWheel:function(e){r(-e.deltaY)}}),V=function(e){e.preventDefault()};s.BB.addEventListener(G,"wheel",V);var Y=s.BB.el({parent:k,css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"10px"}}),K=s.BB.el({parent:k,css:L?{}:{display:"flex",alignItems:"center",justifyContent:"space-between"}}),W=s.BB.el({parent:K,css:{display:"flex",alignItems:"center",marginTop:"5px"}}),_=s.BB.el({parent:K,css:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:"5px",width:L?"":"300px"}}),q=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];q.unshift({r:t.secondaryColor.r,g:t.secondaryColor.g,b:t.secondaryColor.b,a:1}),q.unshift({r:t.color.r,g:t.color.g,b:t.color.b,a:1});var Q=new(0,c.ColorOptions)({colorArr:q,initialIndex:0,onChange:function(e){t.color=e,n()}});Q.getElement().title=(0,w.LANG)("text-color"),Q.getElement().style.marginLeft="-5px",Y.appendChild(Q.getElement());var J,Z,$,ee=0,te=s.BB.el({parent:Y,css:{}}),ne=s.BB.el({parent:te,content:'<img height="20" src="'.concat(e(b),'">'),title:(0,w.LANG)("zoom-in"),tagName:"button",onClick:function(){r(1)},css:{fontWeight:"bold"}}),ie=s.BB.el({parent:te,content:'<img height="20" src="'.concat(e(B),'">'),title:(0,w.LANG)("zoom-out"),tagName:"button",onClick:function(){r(-1)},css:{fontWeight:"bold",marginLeft:"5px"}}),re=s.BB.el({parent:W,tagName:"input",title:(0,w.LANG)("text-size"),custom:{type:"number",min:1,max:1e4,value:t.size},css:{width:"60px"},onChange:function(){re.value=""+Math.max(1,Math.min(1e4,parseInt(re.value))),n()}}),ae=new s.BB.PointerListener({target:re,onWheel:function(e){re.value=""+Math.max(1,Math.min(1e3,parseInt(re.value)-e.deltaY)),n()}});J=s.BB.el({css:{fontSize:"15px",marginLeft:"10px"}}),Z=new(0,u.Select)({isFocusable:!0,optionArr:[["sans-serif","Sans-serif"],["serif","Serif"],["monospace","Monospace"],["cursive","Cursive"],["fantasy","Fantasy"]],initValue:t.font,onChange:function(e){n()}}),J.appendChild(Z.getElement()),W.appendChild(J),$=new s.BB.PointerListener({target:Z.getElement(),onWheel:function(e){Z.setDeltaValue(e.deltaY)}});var oe=new(0,h.ImageRadioList)({optionArr:[{id:"left",title:(0,w.LANG)("text-left"),image:e(f)},{id:"center",title:(0,w.LANG)("text-center"),image:e(m)},{id:"right",title:(0,w.LANG)("text-right"),image:e(v)}],initId:t.align,onChange:function(e){n()}});_.appendChild(oe.getElement());var se=new(0,d.ImageToggle)({image:e(y),title:(0,w.LANG)("text-italic"),initValue:t.isItalic,onChange:function(e){n()}});_.appendChild(se.getElement());var le=new(0,d.ImageToggle)({image:e(x),title:(0,w.LANG)("text-bold"),initValue:t.isBold,onChange:function(e){n()}});_.appendChild(le.getElement());var ce=new(0,p.KlSlider)({label:(0,w.LANG)("opacity"),width:150,height:30,min:.01,max:1,value:t.opacity,resolution:225,eventResMs:1e3/30,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e},onChange:function(e){n()}});_.appendChild(ce.getElement());var ue=s.BB.el({parent:k,tagName:"textarea",custom:{placeholder:(0,w.LANG)("text-placeholder"),"data-ignore-focus":"true"},css:{whiteSpace:"pre",overflow:"auto",width:"100%",height:"70px",resize:"vertical",marginTop:"10px"},onChange:function(){n()}});ue.addEventListener("input",n),setTimeout((function(){ue.focus(),ue.select()}));var he=new s.BB.KeyListener({onDown:function(e,t,n){s.BB.isInputFocused(!0)||("left"===e&&i(-1,0),"right"===e&&i(1,0),"up"===e&&i(0,-1),"down"===e&&i(0,1))}});window.addEventListener("scroll",S),(0,g.popup)({target:document.body,message:"<b>".concat((0,w.LANG)("text-title"),"</b>"),div:k,buttons:["Ok","Cancel"],style:L?{}:{width:"500px"},callback:function(e){var i={x:t.x,y:t.y,textStr:ue.value,align:oe.getValue(),isItalic:se.getValue(),isBold:le.getValue(),color:t.color,size:re.value,font:Z.getValue(),opacity:ce.getValue()};window.removeEventListener("scroll",S),ue.removeEventListener("input",n),s.BB.destroyEl(ue),U.destroy(),ae.destroy(),$.destroy(),s.BB.removeEventListener(G,"wheel",V),s.BB.destroyEl(H),s.BB.destroyEl(ne),s.BB.destroyEl(ie),s.BB.destroyEl(re),Q.destroy(),Z.destroy(),he.destroy(),oe.destroy(),se.destroy(),le.destroy(),ce.destroy(),"Ok"===e&&t.onConfirm(i)},autoFocus:!1,clickOnEnter:"Ok",ignoreBackground:!0,closefunc:function(e){e}}),n()}})),i.register("2dqOY",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("lvwQ5")})),i.register("rk4vM",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("imAvm")})),i.register("hucjG",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("dC0sF")})),i.register("cZa2s",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("h3hPo")})),i.register("03Zd8",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("1pAeY")})),i.register("kDGzx",(function(e,n){t(e.exports,"showImportImageDialog",(function(){return c}));var r=i("eWjiX"),a=i("hRdOL"),o=i("lXqiv"),s=i("ekHRj"),l=i("1mH1z");function c(e){var t,n=function(n,i){var a=r.BB.fitInto(n,i,e.maxSize,e.maxSize);a.width<n?(t.innerHTML='<span style="color:#f00">'.concat(n," X ").concat(i,"</span> ⟶ ").concat(Math.round(a.width)," X ").concat(Math.round(a.height)),t.title=(0,l.LANG)("import-too-large")):(t.innerHTML="".concat(n," X ").concat(i),t.title="")},i=r.BB.el({}),c=window.innerWidth<550||window.innerHeight<550,u=c?{}:{width:"500px"},h=new(0,a.CropCopy)({width:c?340:540,height:c?300:400,canvas:e.image.canvas,isNotCopy:!0,onChange:function(e,i){t&&n(e,i)}});r.BB.css(h.getEl(),{marginLeft:"-20px",borderTop:"1px solid #bbb",borderBottom:"1px solid #bbb"}),h.getEl().title=(0,l.LANG)("crop-drag-to-crop"),i.appendChild(h.getEl()),t=r.BB.el({parent:i,css:{marginTop:"10px",textAlign:"center",color:"#888",lineHeight:"20px"}}),n(e.image.width,e.image.height);var d,p=!1;if("psd"===e.image.type){var g={background:"rgba(255,255,0,0.5)",padding:"10px",marginTop:"5px",marginBottom:"5px",border:"1px solid #e7d321",borderRadius:"5px"};if(e.image.layers){if(d=new(0,o.Checkbox)({init:p,label:(0,l.LANG)("import-flatten"),callback:function(e){p=e}}),i.appendChild(d.getElement()),e.image.warningArr){var f=r.BB.el({content:(0,l.LANG)("import-psd-limited-support"),css:g});f.appendChild(r.BB.el({tagName:"a",content:"Details",onClick:function(){!function(e){for(var t=[],n={mask:"Masks not supported. Mask was applied.",clipping:"Clipping not supported. Clipping layers were merged.",group:"Groups not supported. Layers were ungrouped.",adjustment:"Adjustment layers not supported.","layer-effect":"Layer effects not supported.","smart-object":"Smart objects not supported.","blend-mode":"Unsupported layer blend mode.","bits-per-channel":"Unsupported color depth. Only 8bit per channel supported."},i=0;i<e.length;i++)t.push("- "+n[e[i]]);alert(t.join("\n"))}(e.image.warningArr)}})),i.appendChild(f)}}else{var m=r.BB.el({content:(0,l.LANG)("import-psd-unsupported"),css:g});i.appendChild(m)}}(0,s.popup)({target:e.target,message:"<b>".concat((0,l.LANG)("import-title"),"</b>"),div:i,style:u,buttons:[(0,l.LANG)("import-btn-as-layer"),(0,l.LANG)("import-btn-as-image"),"Cancel"],primaries:[(0,l.LANG)("import-btn-as-layer"),(0,l.LANG)("import-btn-as-image")],callback:function(t){var n=h.getCroppedImage(),i=h.getRect(),r=e.image.width!==i.width&&e.image.height!==i.height;h.destroy(),d&&d.destroy(),t===(0,l.LANG)("import-btn-as-layer")?e.callback({type:"as-layer",image:r?n:e.image.canvas}):t===(0,l.LANG)("import-btn-as-image")?"psd"===e.image.type?(p&&(e.image.layers=null),e.callback({type:"as-image-psd",image:e.image,cropObj:i})):"image"===e.image.type&&e.callback({type:"as-image",image:n}):e.callback({type:"cancel"})},autoFocus:"As Image"})}})),i.register("941rU",(function(e,n){t(e.exports,"blendPsdToKl",(function(){return u})),t(e.exports,"blendKlToPsd",(function(){return h})),t(e.exports,"readPsd",(function(){return d})),t(e.exports,"klPsdToKlProject",(function(){return p}));var r,a,o=i("eelgW"),s=i("1mH1z"),l=i("705qg");function c(){if(!r){r={"source-over":"normal",darken:"darken",multiply:"multiply","color-burn":"color burn",lighten:"lighten",screen:"screen","color-dodge":"color dodge",overlay:"overlay","soft-light":"soft light","hard-light":"hard light",difference:"difference",exclusion:"exclusion",hue:"hue",saturation:"saturation",color:"color",luminosity:"luminosity"},a={};for(var e=Object.keys(r),t=0;t<e.length;t++)a[r[e[t]]]=e[t]}}function u(e){return c(),a[e]}function h(e){return c(),r[e]}function d(e){var t=function(e){r.warningArr||(r.warningArr=[]),r.warningArr.includes(e)||r.warningArr.push(e)},n=function(e){var n=u(e);return n||(t("blend-mode"),n="source-over"),n},i=function(e,t){var n=e.getContext("2d"),i=n.getImageData(0,0,e.width,e.height);if(0===t)for(var r=0;r<i.data.length;r+=4)i.data[r+3]=i.data[r];else for(var a=0;a<i.data.length;a+=4)i.data[a+3]=255-i.data[a];n.putImageData(i,0,0)},r={type:"psd",canvas:e.canvas,width:e.width,height:e.height};if(8!==e.bitsPerChannel&&t("bits-per-channel"),!e.children)return r.error=!0,r;var a=l.MAX_LAYERS,s=0;if(s+=function e(n){var i=0;if(n.blendMode){var r=u(n.blendMode);if(r&&"source-over"!==r)return 1}for(var a=0;a<n.children.length;a++){var o=n.children[a];o.clipping||o.adjustment||(o.children?(t("group"),i+=e(o)):i++)}return i}(e),s>a)return r.error=!0,r;return r.layers=[],r.layers=function e(a){var s,l,c=[],u=a.hidden?0:a.opacity,h=n(a.blendMode);"source-over"!==h&&(l=(s=(0,o.createCanvas)(r.width,r.height)).getContext("2d")),a.mask&&(t("mask"),i(a.mask.canvas,a.mask.defaultColor));for(var d=0;d<a.children.length;d++){var p=a.children[d];if(!p.clipping)if(p.adjustment)t("adjustment");else{var g=(p.children||p.canvas)&&a.children[d+1]&&a.children[d+1].clipping;if(g&&t("clipping"),p.children)for(var f=e(p),m=0;m<f.length;m++){var v=f[m],y=v.image.getContext("2d");if(g){var x=(0,o.createCanvas)(r.width,r.height),b=x.getContext("2d");b.drawImage(v.image,0,0);for(var B=d+1;B<a.children.length&&a.children[B].clipping;B++){var w=a.children[B];0===w.opacity||w.hidden||(b.globalCompositeOperation=n(w.blendMode),b.globalAlpha=w.opacity,b.drawImage(w.canvas,w.left,w.top))}y.globalCompositeOperation="source-atop",y.drawImage(x,0,0)}a.mask&&(y.globalCompositeOperation=0===a.mask.defaultColor?"destination-in":"destination-out",y.drawImage(a.mask.canvas,a.mask.left,a.mask.top)),s?(l.globalCompositeOperation=v.mixModeStr,l.globalAlpha=v.opacity,l.drawImage(v.image,0,0)):(v.opacity=v.opacity*u,c.push(v))}else{var C=(0,o.createCanvas)(r.width,r.height),S=C.getContext("2d");if(p.canvas&&S.drawImage(p.canvas,p.left,p.top),p.effects&&t("layer-effect"),p.mask&&(t("mask"),i(p.mask.canvas,p.mask.defaultColor),S.globalCompositeOperation=0===p.mask.defaultColor?"destination-in":"destination-out",S.drawImage(p.mask.canvas,p.mask.left,p.mask.top)),g){var k=(0,o.createCanvas)(p.right-p.left,p.bottom-p.top),L=k.getContext("2d");L.drawImage(p.canvas,0,0);for(var M=d+1;M<a.children.length&&a.children[M].clipping;M++){var E=a.children[M];0===E.opacity||E.hidden||(L.globalCompositeOperation=n(E.blendMode),L.globalAlpha=E.opacity,L.drawImage(E.canvas,E.left-p.left,E.top-p.top))}S.globalCompositeOperation="source-atop",S.drawImage(k,p.left,p.top)}a.mask&&(S.globalCompositeOperation=0===a.mask.defaultColor?"destination-in":"destination-out",S.drawImage(a.mask.canvas,a.mask.left,a.mask.top)),s?u>0&&(l.globalCompositeOperation=n(p.blendMode),l.globalAlpha=p.hidden?0:p.opacity,l.drawImage(C,0,0)):c.push({name:p.name,opacity:(p.hidden?0:p.opacity)*u,mixModeStr:n(p.blendMode),image:C})}}}return s&&(c=[{name:a.name,opacity:u,mixModeStr:h,image:s}]),c}({name:"root",opacity:1,blendMode:"normal",children:e.children}),r}function p(e){var t={width:e.width,height:e.height,layers:[]};return e.layers?t.layers=t.layers.concat(e.layers.map((function(e){return{name:e.name,opacity:e.opacity,mixModeStr:e.mixModeStr,image:e.image}}))):t.layers.push({name:(0,s.LANG)("background"),opacity:1,mixModeStr:"source-over",image:e.canvas}),t}})),i.register("9BlwZ",(function(e,n){t(e.exports,"setDbName",(function(){return o})),t(e.exports,"getKlProjectObj",(function(){return l})),t(e.exports,"storeKlProjectObj",(function(){return c})),t(e.exports,"clear",(function(){return u}));var i=!!window.indexedDB,r="Klecks",a="ProjectStore";function o(e){r=""+e}function s(e,t,n){var o=function(e){s||(s=!0,n(e))},s=!1;if(i){var l;try{l=window.indexedDB.open(r,1)}catch(e){return void o(e.message)}l.onupgradeneeded=function(e){try{l.result.createObjectStore(a,{keyPath:"id"}).createIndex("id","id",{unique:!0})}catch(e){o(e.message)}},l.onerror=function(e){o("indexedDB.open failed, "+l.error)},l.onsuccess=function(n){var i,c,u;try{if(!(i=l.result).objectStoreNames.contains(a))return window.indexedDB.deleteDatabase(r),void o("object store ProjectStore missing. destroying db");(u=(c=i.transaction(a,"readwrite")).objectStore(a)).index("id")}catch(e){return void o(e.message)}i.onerror=function(e){o("database error, "+i.error)};try{e(u)}catch(e){return void o(e.message)}c.oncomplete=function(){s||(s=!0,t()),i.close()},c.onerror=function(){o("transaction error, "+c.error)}}}else setTimeout((function(){o("no indexed db available")}),0)}function l(e,t){var n;i?s((function(e){n=e.get(1)}),(function(){e(n.result)}),(function(e){t("execIndexedDBTransaction error, "+e)})):e(null)}function c(e,t,n){s((function(t){t.put(e)}),(function(){t()}),(function(e){n(e)}))}function u(e,t){s((function(e){e.delete(1)}),(function(){e()}),(function(e){t(e)}))}})),i.register("kyVjY",(function(n,r){t(n.exports,"filterLibStatus",(function(){return S})),t(n.exports,"filterLib",(function(){return k}));var a=i("8k5kH"),o=i("4UkHZ"),s=i("e7LnL"),l=i("iI5sC"),c=i("eySuj"),u=i("iPRwU"),h=i("krmR4"),d=i("92iBR"),p=i("2n4Fs"),g=i("bFASM"),f=i("9m6gZ"),m=i("4fkq2"),v=i("dPWA8"),y=i("cQHFd"),x=i("9vOYE"),b=i("as29q"),B=i("mMv4g"),w=i("5UWr6"),C=i("bt9IQ"),S={isLoaded:!1},k={brightnessContrast:{lang:{name:"filter-bright-contrast-title",button:"filter-bright-contrast"},icon:e(a),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},cropExtend:{lang:{name:"filter-crop-title",button:"filter-crop-extend"},icon:e(o),updatePos:!0,getDialog:null,apply:null,inEmbed:!1},curves:{lang:{name:"filter-curves-title",button:"filter-curves"},icon:e(s),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},distort:{lang:{name:"filter-distort",button:"filter-distort"},icon:e(C),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},flip:{lang:{name:"filter-flip-title",button:"filter-flip"},icon:e(l),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},hueSaturation:{lang:{name:"filter-hue-sat-title",button:"filter-hue-sat"},icon:e(c),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},invert:{lang:{name:"filter-invert",button:"filter-invert"},icon:e(u),updatePos:!1,isInstant:!0,getDialog:null,apply:null,inEmbed:!0},perspective:{lang:{name:"filter-perspective-title",button:"filter-perspective"},icon:e(h),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},resize:{lang:{name:"filter-resize-title",button:"filter-resize"},icon:e(d),updatePos:!0,getDialog:null,apply:null,inEmbed:!1},rotate:{lang:{name:"filter-rotate-title",button:"filter-rotate"},icon:e(p),updatePos:!0,getDialog:null,apply:null,inEmbed:!1},tiltShift:{lang:{name:"filter-tilt-shift-title",button:"filter-tilt-shift"},icon:e(g),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},toAlpha:{lang:{name:"filter-to-alpha-title",button:"filter-to-alpha"},icon:e(f),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},transform:{lang:{name:"filter-transform-title",button:"filter-transform"},icon:e(m),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},blur:{lang:{name:"filter-triangle-blur-title",button:"filter-triangle-blur"},icon:e(v),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},unsharpMask:{lang:{name:"filter-unsharp-mask-title",button:"filter-unsharp-mask"},icon:e(y),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},grid:{lang:{name:"filter-grid",button:"filter-grid"},icon:e(x),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},noise:{lang:{name:"filter-noise",button:"filter-noise"},icon:e(b),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},pattern:{lang:{name:"filter-pattern",button:"filter-pattern"},icon:e(B),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},vanishPoint:{lang:{name:"filter-vanish-point-title",button:"filter-vanish-point"},icon:e(w),updatePos:!1,getDialog:null,apply:null,inEmbed:!0}}})),i.register("8k5kH",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("5tPq3")})),i.register("4UkHZ",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("cazOx")})),i.register("e7LnL",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("245NA")})),i.register("iI5sC",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("1hkCG")})),i.register("eySuj",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("k2eFf")})),i.register("iPRwU",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("krKGd")})),i.register("krmR4",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("ehfxY")})),i.register("92iBR",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("beOjS")})),i.register("bFASM",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("Gk9bV")})),i.register("9m6gZ",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("csed7")})),i.register("4fkq2",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("equSE")})),i.register("dPWA8",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("h1dN3")})),i.register("cQHFd",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("LfAXI")})),i.register("9vOYE",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("cB6q6")})),i.register("as29q",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("S9ano")})),i.register("mMv4g",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("4eqRj")})),i.register("5UWr6",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("8mvSV")})),i.register("bt9IQ",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("kbc0v")})),i.register("dAXbp",(function(e,n){t(e.exports,"brushes",(function(){return h}));var r=i("68QTJ"),a=i("5PSXS"),o=i("ewgr9"),s=i("kic4a"),l=i("7cUpm"),c=i("ltaBP"),u=i("6Nq1H"),h={PenBrush:r.PenBrush,BlendBrush:a.BlendBrush,SketchyBrush:o.SketchyBrush,PixelBrush:s.PixelBrush,ChemyBrush:u.ChemyBrush,SmudgeBrush:c.SmudgeBrush,EraserBrush:l.EraserBrush}})),i.register("68QTJ",(function(e,n){t(e.exports,"PenBrush",(function(){return s}));var r=i("eWjiX"),a=i("5CF7D"),o=i("hrnUX");function s(){var e,t,n,i,s,l,c=function(e){return m*(y?e*e:1)},u=function(){if(C!==b&&C!==w)for(var e,t=[[E,128],[A,64],[T,32]],i=0;i<t.length;i++)(e=t[i][0].getContext("2d")).save(),e.clearRect(0,0,t[i][1],t[i][1]),e.fillStyle="rgba("+n.r+", "+n.g+", "+n.b+", "+M[C]+")",e.fillRect(0,0,t[i][1],t[i][1]),e.globalCompositeOperation="destination-in",e.imageSmoothingQuality="high",e.drawImage(a.alphaImArr[C],0,0,t[i][1],t[i][1]),e.restore()},h=function(t,n,r,a,o,s){if(!(r<=0))if(x&&(e.globalCompositeOperation="source-atop"),s&&s[3]===a||(e.globalAlpha=a),s||C!==b&&C!==w||(e.fillStyle=i),C===b)e.beginPath(),e.arc(t,n,r,0,R),e.closePath(),e.fill(),P=!0;else if(C===w)void 0!==o&&(e.save(),e.translate(t,n),e.rotate(o/180*Math.PI),e.fillRect(-r,-r,2*r,2*r),e.restore(),P=!0);else{e.save(),e.translate(t,n);var l=E;r<=32&&r>16?l=A:r<=16&&(l=T),e.scale(r,r),C===B&&e.rotate(53123*(t+n)%R),e.drawImage(l,-1,-1,2,2),e.restore(),P=!0}},d=function(t,n,i,a){null===I&&(I=new r.BB.BezierLine).add(S.x,S.y,0,(function(){}));var o=[];function s(e){var t=r.BB.mix(k.pressure,a,e.t),n=c(t),i=Math.max(.1,g*(v?t:1));o.push([e.x,e.y,i,n,e.angle])}var l,u=i*f;null===t?I.addFinal(u,s):I.add(t,n,u,s),e.save();for(var d=0;d<o.length;d++){var p=o[d];h(p[0],p[1],p[2],p[3],p[4],l),l=p}e.restore()},p=new o.KL.DecoyKlHistory,g=2,f=.8489,m=1,v=!0,y=!1,x=!1,b=0,B=1,w=3,C=b,S={x:0,y:0,pressure:0},k={x:0,y:0,pressure:0},L=!1,M=[1,.9,1,1],E=r.BB.canvas(128,128),A=r.BB.canvas(64,64),T=r.BB.canvas(32,32),I=null,R=2*Math.PI,P=!1;this.startLine=function(i,a,o){(t={tool:["brush","PenBrush"],actions:[]}).actions.push({action:"opacityPressure",params:[y]}),t.actions.push({action:"sizePressure",params:[v]}),t.actions.push({action:"setSize",params:[g]}),t.actions.push({action:"setSpacing",params:[f]}),t.actions.push({action:"setOpacity",params:[m]}),t.actions.push({action:"setColor",params:[n]}),t.actions.push({action:"setAlpha",params:[C]}),t.actions.push({action:"setLockAlpha",params:[x]}),o=r.BB.clamp(o,0,1);var u=c(o),d=v?Math.max(.1,o*g):Math.max(.1,g);P=!1,L=!0,e.save(),h(i,a,d,u),e.restore(),s=d*f,S.x=i,S.y=a,S.pressure=o,k.pressure=o,l=[{x:i,y:a,pressure:o}],t.actions.push({action:"startLine",params:[i,a,o]})},this.goLine=function(n,i,a){if(L){t.actions.push({action:"goLine",params:[n,i,a]});var o=r.BB.clamp(a,0,1),s=v?Math.max(.1,S.pressure*g):Math.max(.1,g);e.save(),d(n,i,s,S.pressure),e.restore(),S.x=n,S.y=i,k.pressure=S.pressure,S.pressure=o,l.push({x:n,y:i,pressure:a})}},this.endLine=function(n,i){var a=v?Math.max(.1,S.pressure*g):Math.max(.1,g);if(e.save(),d(null,null,a,S.pressure),e.restore(),L=!1,C===w&&!P){var o=l[0];l.forEach((function(e){e.pressure>o.pressure&&(o=e)})),e.save();var s=r.BB.clamp(o.pressure,0,1),u=c(s);h(o.x,o.y,a,u,0),e.restore()}I=null,t&&(t.actions.push({action:"endLine",params:[n,i]}),p.push(t),t=void 0),P=!1,l=[]},this.drawLineSegment=function(t,i,a,o){if(S.x=a,S.y=o,S.pressure=1,!L&&void 0!==t){var l,c=r.BB.pointsToAngleDeg({x:t,y:i},{x:a,y:o}),u=Math.sqrt(Math.pow(a-t,2)+Math.pow(o-i,2)),d=(a-t)/u,b=(o-i)/u,B=g*f;for(s=g*f,e.save(),l=s;l<=u;l+=B)h(t+d*l,i+b*l,g,m,c);e.restore();var w={tool:["brush","PenBrush"],actions:[]};w.actions.push({action:"opacityPressure",params:[y]}),w.actions.push({action:"sizePressure",params:[v]}),w.actions.push({action:"setSize",params:[g]}),w.actions.push({action:"setSpacing",params:[f]}),w.actions.push({action:"setOpacity",params:[m]}),w.actions.push({action:"setColor",params:[n]}),w.actions.push({action:"setAlpha",params:[C]}),w.actions.push({action:"setLockAlpha",params:[x]}),w.actions.push({action:"drawLineSegment",params:[t,i,a,o]}),p.push(w)}},this.isDrawing=function(){return L},this.setAlpha=function(e){C!==e&&(C=e,u())},this.setColor=function(e){n!==e&&(n={r:e.r,g:e.g,b:e.b},i="rgb("+n.r+","+n.g+","+n.b+")",u())},this.setContext=function(t){e=t},this.setHistory=function(e){p=e},this.setSize=function(e){g=e},this.setOpacity=function(e){m=e},this.setSpacing=function(e){f=e},this.sizePressure=function(e){v=e},this.opacityPressure=function(e){y=e},this.setLockAlpha=function(e){x=e},this.getSpacing=function(){return f},this.getSize=function(){return g},this.getOpacity=function(){return m},this.getLockAlpha=function(e){return x}}})),i.register("5CF7D",(function(e,n){t(e.exports,"alphaImArr",(function(){return a}));var r=i("74D3O"),a=[];a[1]=(0,r.genBrushAlpha01)(128),a[2]=(0,r.genBrushAlpha02)(128)})),i.register("74D3O",(function(e,n){t(e.exports,"genBrushAlpha01",(function(){return o})),t(e.exports,"genBrushAlpha02",(function(){return l}));var r=i("eWjiX"),a=i("gZSR2");function o(e){for(var t=e/500,n=e,i=r.BB.canvas(e,n),o=i.getContext("2d"),s=o.createImageData(e,n),l=0;l<e;l++)for(var c=0;c<n;c++){var u=4*(c*e+l),h=t+.04*a.noise.simplex2(l/50/t,c/50/t),d=100+(a.noise.simplex2(l/50/h,c/50/h)+1)/2*100;d-=(a.noise.simplex2(l/10/t,c/10/t)+1)/2*100;var p=r.BB.dist(e/2,n/2,l,c);d*=r.BB.clamp(1-((p-e/2.5)/(e/14)+a.noise.simplex2(l/22/h,c/22/h)),0,1),d*=2*r.BB.clamp(1-p/e,0,1),s.data[u]=0,s.data[u+1]=0,s.data[u+2]=0,s.data[u+3]=r.BB.clamp(d,0,255)}return o.putImageData(s,0,0),i}function s(e,t,n){var i=r.BB.Vec2.sub(n,t),a=r.BB.Vec2.sub(e,t),o=r.BB.clamp(r.BB.Vec2.dot(a,i)/r.BB.Vec2.dot(i,i),0,1);return r.BB.Vec2.len(r.BB.Vec2.sub(a,r.BB.Vec2.mul(i,o)))}function l(e){var t=.25;for(var n={x:t*e,y:e-e*t},i={x:e-e*t,y:t*e},a=e,o=r.BB.canvas(e,a),l=o.getContext("2d"),c=l.createImageData(e,a),u=0;u<e;u++)for(var h=0;h<a;h++){var d=4*(h*e+u),p=s({x:u,y:h},n,i);p=r.BB.clamp(255-(p-.16666666666666666*e)/(.08333333333333333*e)*255,0,255),c.data[d]=0,c.data[d+1]=0,c.data[d+2]=0,c.data[d+3]=p}return l.putImageData(c,0,0),o}})),i.register("gZSR2",(function(e,n){t(e.exports,"noise",(function(){return h}));var i={};function r(e,t,n){this.x=e,this.y=t,this.z=n}r.prototype.dot2=function(e,t){return this.x*e+this.y*t};var a=[new r(1,1,0),new r(-1,1,0),new r(1,-1,0),new r(-1,-1,0),new r(1,0,1),new r(-1,0,1),new r(1,0,-1),new r(-1,0,-1),new r(0,1,1),new r(0,-1,1),new r(0,1,-1),new r(0,-1,-1)],o=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],s=new Array(512),l=new Array(512);i.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n=void 0;n=1&t?o[t]^255&e:o[t]^e>>8&255,s[t]=s[t+256]=n,l[t]=l[t+256]=a[n%12]}},i.seed(0);var c=.5*(Math.sqrt(3)-1),u=(3-Math.sqrt(3))/6;i.simplex2=function(e,t){var n,i,r=(e+t)*c,a=Math.floor(e+r),o=Math.floor(t+r),h=(a+o)*u,d=e-a+h,p=t-o+h;d>p?(n=1,i=0):(n=0,i=1);var g=d-n+u,f=p-i+u,m=d-1+2*u,v=p-1+2*u,y=l[(a&=255)+s[o&=255]],x=l[a+n+s[o+i]],b=l[a+1+s[o+1]],B=.5-d*d-p*p,w=.5-g*g-f*f,C=.5-m*m-v*v;return 70*((B<0?0:(B*=B)*B*y.dot2(d,p))+(w<0?0:(w*=w)*w*x.dot2(g,f))+(C<0?0:(C*=C)*C*b.dot2(m,v)))};var h=i})),i.register("5PSXS",(function(e,n){t(e.exports,"BlendBrush",(function(){return u}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("7U0Ew"),s=i("eWjiX"),l=256;function c(e,t,n){return e<=t?t:e>=n?n:e}var u=function(){"use strict";function e(){(0,r.default)(this,e),(0,o.default)(this,"isTesting",!1),(0,o.default)(this,"size",29),(0,o.default)(this,"opacity",.6),(0,o.default)(this,"blending",.65),(0,o.default)(this,"settingLockLayerAlpha",!1),(0,o.default)(this,"settingSizePressure",!0),(0,o.default)(this,"settingOpacityPressure",!1),(0,o.default)(this,"blendCol",{r:0,g:0,b:0,a:1}),(0,o.default)(this,"blendMix",.45),(0,o.default)(this,"isDrawing",!1),(0,o.default)(this,"lastInput",{x:0,y:0,pressure:0}),(0,o.default)(this,"lastInput2",{x:0,y:0,pressure:0})}return(0,a.default)(e,[{key:"updateRedrawBounds",value:function(e){this.redrawBounds=s.BB.updateBounds(this.redrawBounds,e)}},{key:"getCellsWidth",value:function(){return Math.ceil(this.context.canvas.width/l)}},{key:"drawChangedCells",value:function(){var e=this,t=this.cells.map((function(e){return null}));this.getTouchedCells(this.redrawBounds).forEach((function(n,i){n&&(t[i]=e.cells[i])})),this.drawCells(t),this.redrawBounds=null}},{key:"getTouchedCells",value:function(e){for(var t=this.cells.map((function(e){return!1})),n=this.getCellsWidth(),i=(e={x1:Math.floor(e.x1/l),y1:Math.floor(e.y1/l),x2:Math.floor(e.x2/l),y2:Math.floor(e.y2/l)}).x1;i<=e.x2;i++)for(var r=e.y1;r<=e.y2;r++)t[r*n+i]=!0;return t}},{key:"sliceBounds",value:function(e){var t=this,n=this.getCellsWidth(),i=[];return this.getTouchedCells(e).forEach((function(r,a){if(r){var o=a%n*l,s=Math.floor(a/n)*l,c=t.cells[a].width,u=t.cells[a].height,h={x1:Math.max(0,e.x1-o),y1:Math.max(0,e.y1-s),x2:Math.min(c-1,e.x2-o),y2:Math.min(u-1,e.y2-s)};h.x1>h.x2||h.y1>h.y2||i.push({index:a,bounds:h})}})),i}},{key:"copyFromCanvas",value:function(e){var t=this;if(e){var n=this.getTouchedCells(e),i=this.getCellsWidth();n.forEach((function(e,n){if(e&&!t.cells[n]){var r=n%i,a=Math.floor(n/i),o=(Math.min(r*l+l,t.context.canvas.width)-1)%l+1,c=(Math.min(a*l+l,t.context.canvas.height)-1)%l+1,u=s.BB.canvas(o,c).getContext("2d");u.drawImage(t.context.canvas,-r*l,-a*l),t.cells[n]=u.getImageData(0,0,o,c)}}))}}},{key:"getAverage",value:function(e,t,n){var i=this;n=Math.max(.5,.75*n);var r=Math.max(0,Math.floor(e-n)),a=Math.max(0,Math.floor(t-n)),o=Math.min(this.context.canvas.width-1,Math.ceil(e+n)),s=Math.min(this.context.canvas.height-1,Math.ceil(t+n));if(r>o||a>s)return{r:0,g:0,b:0,a:0};var l,c=0,u=0,h=0,d=0;return this.sliceBounds({x1:r,y1:a,x2:o,y2:s}).forEach((function(e){for(var t=i.cells[e.index].width,n=i.cells[e.index].data,r=e.bounds,a=r.y1;a<=r.y2;a+=4)for(var o=r.x1,s=a*t*4+4*r.x1;o<=r.x2;o+=4,s+=16)l=n[s+3],c+=n[s]*l,u+=n[s+1]*l,h+=n[s+2]*l,d+=l})),0!==d&&(c/=d,u/=d,h/=d,d=Math.min(1,d)),{r:c,g:u,b:h,a:d}}},{key:"prepDot",value:function(e,t,n){n=Math.max(.5,n);var i=Math.max(0,Math.floor(e-n)),r=Math.max(0,Math.floor(t-n)),a=Math.min(this.context.canvas.width-1,Math.ceil(e+n)),o=Math.min(this.context.canvas.height-1,Math.ceil(t+n));return i>a||r>o?null:{x1:i,y1:r,x2:a,y2:o}}},{key:"drawDot",value:function(e){for(var t=this,n=0,i=e.size>30?1024:512,r=[],a=0;a<i;a++)r[a]=(Math.random()-.5)/1.001+.5;var o=[8,4,4,4,2,2,2,2,2,2][Math.floor(2*e.size)],u=o?o*o:0,h=[];if(o)for(var d=0,p=0;p<o;p++)for(var g=0;g<o;g++,d+=2)h[d]=(p+1)/o,h[d+1]=(g+1)/o;var f=.8*Math.pow(e.opacity,2),m=1-f,v=f/m,y=e.size*e.size,x=y*m/e.opacity,b=(1+v)*e.opacity,B=this.sliceBounds({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}),w=this.getCellsWidth();B.forEach((function(a){for(var o=a.index%w*l,d=Math.floor(a.index/w)*l,p=t.cells[a.index].width,g=t.cells[a.index].data,f=a.bounds.y1,m=f+d-e.y;f<=a.bounds.y2;f++,m++)for(var v=a.bounds.x1,B=f*p*4+4*a.bounds.x1,C=v+o-e.x;v<=a.bounds.x2;v++,B+=4,C++){var S=0;if(u){for(var k=0;k<h.length;k+=2){var L=s.BB.lenSquared(C+h[k],m+h[k+1]);L>=y||(S+=c(b-L/x,0,e.opacity))}if(!S)continue;S/=u}else{var M=Math.pow(C,2)+Math.pow(m,2);if(M>=y)continue;S=c(b-M/x,0,e.opacity)}var E=1-S,A=g[B+3]/255;if(t.settingLockLayerAlpha){var T=e.r*S+g[B]*E,I=e.g*S+g[B+1]*E,R=e.b*S+g[B+2]*E;A&&(g[B]=Math.floor(T+r[n]),g[B+1]=Math.floor(I+r[n]),g[B+2]=Math.floor(R+r[n]))}else{var P=e.r*S+g[B]*A*E,O=e.g*S+g[B+1]*A*E,D=e.b*S+g[B+2]*A*E,N=1-E*(1-A);g[B+3]=Math.floor(Math.min(255,255*N)+.5),N&&(g[B]=Math.floor(P/N+r[n]),g[B+1]=Math.floor(O/N+r[n]),g[B+2]=Math.floor(D/N+r[n]))}n=(n+1)%i}}))}},{key:"calcSpacing",value:function(e){return s.BB.mix(2*e/2,2*e/9,s.BB.clamp((e-2.7)/9.3,0,1))}},{key:"continueLine",value:function(e,t,n,i){var r,a,o=this;this.drawBuffer=[];var l,c=this.settingSizePressure?Math.max(1,n*this.size):Math.max(1,this.size),u=this.calcSpacing(c),h=e,d=t;if(null===e&&(h=this.lastInput.x,d=this.lastInput.y),0===this.blending)this.mixr=this.color.r,this.mixg=this.color.g,this.mixb=this.color.b;else{var p;if(i)p={r:this.localColOld.r,g:this.localColOld.g,b:this.localColOld.b,a:0};else{var g=[h,d,this.settingSizePressure?Math.max(.5,n*this.size):Math.max(.5,this.size)],f=this.prepDot(g[0],g[1],g[2]);this.copyFromCanvas(f),p=this.getAverage(g[0],g[1],g[2])}l={r:0,g:0,b:0,a:0},p.a>0&&0===this.blendCol.a?(this.blendCol.r=p.r,this.blendCol.g=p.g,this.blendCol.b=p.b,this.blendCol.a=p.a,l.r=this.blendCol.r,l.g=this.blendCol.g,l.b=this.blendCol.b,l.a=this.blendCol.a):(0===p.a&&(p.r=this.color.r,p.g=this.color.g,p.b=this.color.b,p.a=1-this.blending),this.blendCol.r=s.BB.mix(this.blendCol.r,s.BB.mix(this.blendCol.r,p.r,this.blendMix),p.a),this.blendCol.g=s.BB.mix(this.blendCol.g,s.BB.mix(this.blendCol.g,p.g,this.blendMix),p.a),this.blendCol.b=s.BB.mix(this.blendCol.b,s.BB.mix(this.blendCol.b,p.b,this.blendMix),p.a),this.blendCol.a=Math.min(1,this.blendCol.a+p.a),l.r=this.blendCol.r,l.g=this.blendCol.g,l.b=this.blendCol.b,l.a=this.blendCol.a)}var m=function(e){if(!(o.blending>=1&&o.blendCol.a<=0)){var t=e.t;r=o.lastInput2.pressure*(1-t)+n*t,a=o.settingOpacityPressure?o.opacity*r*r:o.opacity,c=o.settingSizePressure?Math.max(.1,r*o.size):Math.max(.1,o.size),0!=o.blending&&(o.mixr=s.BB.mix(o.localColOld.r,l.r,t),o.mixg=s.BB.mix(o.localColOld.g,l.g,t),o.mixb=s.BB.mix(o.localColOld.b,l.b,t)),1===o.blending&&0===o.localColOld.a&&(o.mixr=l.r,o.mixg=l.g,o.mixb=l.b);var i=o.prepDot(e.x,e.y,c);i&&(o.updateRedrawBounds(i),o.drawBuffer.push({x:e.x,y:e.y,size:c,opacity:a,x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,r:s.BB.mix(o.color.r,o.mixr,o.blending),g:s.BB.mix(o.color.g,o.mixg,o.blending),b:s.BB.mix(o.color.b,o.mixb,o.blending)}))}};null===e?this.bezierLine.addFinal(u,m):this.bezierLine.add(e,t,u,m),this.copyFromCanvas(this.redrawBounds),this.drawBuffer.forEach((function(e){o.drawDot(e)})),this.drawBuffer=[],this.localColOld=l}},{key:"setHistory",value:function(e){this.history=e}},{key:"getSize",value:function(){return this.size}},{key:"setSize",value:function(e){this.size=e}},{key:"getOpacity",value:function(){return this.opacity}},{key:"setOpacity",value:function(e){this.opacity=e}},{key:"getBlending",value:function(){return this.blending}},{key:"setBlending",value:function(e){this.blending=e}},{key:"setColor",value:function(e){this.color=s.BB.copyObj(e)}},{key:"setContext",value:function(e){this.context=e}},{key:"setSizePressure",value:function(e){this.settingSizePressure=!!e}},{key:"setOpacityPressure",value:function(e){this.settingOpacityPressure=!!e}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=!!e}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"setIsTesting",value:function(e){this.isTesting=!!e}},{key:"startLine",value:function(e,t,n){var i=this;this.historyEntry={tool:["brush","BlendBrush"],actions:[]};var r=Math.ceil(this.context.canvas.width/l)*Math.ceil(this.context.canvas.height/l);this.cells="0".repeat(r).split("").map((function(e){return null})),this.isDrawing=!0,n=Math.max(0,Math.min(1,n));var a=this.settingOpacityPressure?this.opacity*n*n:this.opacity,o=this.settingSizePressure?Math.max(.1,n*this.size):Math.max(.1,this.size);if(0===this.blending)this.mixr=this.color.r,this.mixg=this.color.g,this.mixb=this.color.b;else{this.copyFromCanvas(this.prepDot(e,t,o));var c=this.getAverage(e,t,this.settingSizePressure?Math.max(.1,n*this.size):Math.max(.1,this.size));0===c.a?this.blendCol={r:this.color.r,g:this.color.g,b:this.color.b,a:1-this.blending}:this.blendCol={r:c.r,g:c.g,b:c.b,a:c.a},this.mixr=this.blendCol.r,this.mixg=this.blendCol.g,this.mixb=this.blendCol.b}if(this.localColOld={r:this.mixr,g:this.mixg,b:this.mixb,a:this.blendCol.a},this.redrawBounds=null,this.drawBuffer=[],this.blending<1||this.blendCol.a>0){var u=this.prepDot(e,t,o);u&&(this.updateRedrawBounds(u),this.drawBuffer.push({x:e,y:t,size:o,opacity:a,x1:u.x1,y1:u.y1,x2:u.x2,y2:u.y2,r:s.BB.mix(this.color.r,this.mixr,this.blending),g:s.BB.mix(this.color.g,this.mixg,this.blending),b:s.BB.mix(this.color.b,this.mixb,this.blending)}))}this.copyFromCanvas(this.redrawBounds),this.drawBuffer.forEach((function(e){i.drawDot(e)})),this.drawBuffer=[],this.bezierLine=new s.BB.BezierLine,this.bezierLine.add(e,t,0,(function(){})),this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=n,this.lastInput2=s.BB.copyObj(this.lastInput),this.redrawBounds&&!this.isTesting&&this.drawChangedCells()}},{key:"goLine",value:function(e,t,n,i){this.isDrawing&&(this.continueLine(e,t,this.lastInput.pressure,i),this.lastInput2=s.BB.copyObj(this.lastInput),this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=n,this.redrawBounds&&!this.isTesting&&this.drawChangedCells())}},{key:"endLine",value:function(){this.bezierLine&&this.continueLine(null,null,this.lastInput.pressure,!1),this.isDrawing=!1,this.bezierLine=null,this.redrawBounds&&this.drawChangedCells(),this.historyEntry&&this.history&&this.cells.find((function(e){return!!e}))&&(this.historyEntry.actions.push({action:"drawCells",params:[this.cells]}),this.history.push(this.historyEntry),this.historyEntry=null),this.cells=null}},{key:"drawCells",value:function(e){var t=this,n=this.getCellsWidth();e.forEach((function(e,i){if(e){var r=i%n*l,a=Math.floor(i/n)*l;t.context.putImageData(e,r,a)}}))}},{key:"drawLineSegment",value:function(e,t,n,i){var r=this;if(this.lastInput.x=n,this.lastInput.y=i,!this.isDrawing&&void 0!==e){var a=Math.ceil(this.context.canvas.width/l)*Math.ceil(this.context.canvas.height/l);this.cells="0".repeat(a).split("").map((function(e){return null})),this.redrawBounds=null,this.drawBuffer=[],this.copyFromCanvas(this.prepDot(e,t,Math.max(.1,this.size)));var o=this.getAverage(e,t,Math.max(.1,this.size));0===o.a?this.blendCol={r:this.color.r,g:this.color.g,b:this.color.b,a:1-this.blending}:this.blendCol={r:o.r,g:o.g,b:o.b,a:o.a},this.mixr=this.color.r*(1-this.blendCol.a)+(this.blending*this.blendCol.r+this.color.r*(1-this.blending))*this.blendCol.a,this.mixg=this.color.g*(1-this.blendCol.a)+(this.blending*this.blendCol.g+this.color.g*(1-this.blending))*this.blendCol.a,this.mixb=this.color.b*(1-this.blendCol.a)+(this.blending*this.blendCol.b+this.color.b*(1-this.blending))*this.blendCol.a;for(var c=this.settingOpacityPressure?1*this.opacity*1:this.opacity,u=this.settingSizePressure?Math.max(.1,1*this.size):Math.max(.1,this.size),h=Math.sqrt(Math.pow(n-e,2)+Math.pow(i-t,2)),d=(n-e)/h,p=(i-t)/h,g=this.calcSpacing(u),f=0;f<=h;f+=g){var m=this.prepDot(e+d*f,t+p*f,u);m&&(this.copyFromCanvas(m),this.drawBuffer.push({x:e+d*f,y:t+p*f,size:u,opacity:c,x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,r:s.BB.mix(this.color.r,this.mixr,this.blending),g:s.BB.mix(this.color.g,this.mixg,this.blending),b:s.BB.mix(this.color.b,this.mixb,this.blending)}))}this.drawBuffer.forEach((function(e){r.drawDot(e)})),this.drawBuffer=[],this.history&&this.cells.find((function(e){return!!e}))&&(this.drawCells(this.cells),this.historyEntry={tool:["brush","BlendBrush"],actions:[{action:"drawCells",params:[this.cells]}]},this.history.push(this.historyEntry),this.historyEntry=null),this.cells=null}}}]),e}()})),i.register("ewgr9",(function(e,n){t(e.exports,"SketchyBrush",(function(){return l}));var r=i("eWjiX"),a=i("hrnUX"),o=r.BB.canvas(32,32),s=o.getContext("2d");function l(){var e,t,n,i,l,c=1,u=.2,h=.5,d=1,p=!1,g={x:0,y:0,pressure:0},f=new a.KL.DecoyKlHistory,m=0;this.setHistory=function(e){f=e},this.setSeed=function(e){m=parseInt(e)},this.getSeed=function(){return parseInt(""+m)};var v=[],y=0,x=[function(e,t){return e},function(e,t){var n=new r.BB.RGB(e.r,e.g,e.b);return n.r*=t.r/255,n.g*=t.g/255,n.b*=t.b/255,n},function(e,t){var n=new r.BB.RGB(e.r,e.g,e.b);return n.r*=t.r/255,n.g*=t.g/255,n.b*=t.b/255,n}];this.getSize=function(){return c/2},this.setColor=function(e){t=e},this.getOpacity=function(){return u},this.setOpacity=function(e){u=e},this.getBlending=function(){return h},this.setBlending=function(e){h=e},this.setSize=function(e){c=2*e},this.getScale=function(){return d},this.setScale=function(e){d=e},this.setContext=function(t){e=t},this.startLine=function(e,r,a,o){if(o&&g.x){g.x,g.y;p=!0,this.endLine()}else p=!0,n=e,i=r,g.x=e,g.y=r,(l={tool:["brush","SketchyBrush"],actions:[]}).actions.push({action:"setScale",params:[d]}),l.actions.push({action:"setSize",params:[c/2]}),l.actions.push({action:"setOpacity",params:[u]}),l.actions.push({action:"setColor",params:[t]}),l.actions.push({action:"setBlending",params:[h]}),l.actions.push({action:"startLine",params:[e,r,a]})},this.goLine=function(a,o,s,f){if(p&&(a!==g.x||o!==g.y)){var b,B,w,C,S=parseInt(a),k=parseInt(o);v.push([S,k]);var L=t.r,M=t.g,E=t.b;if(null!==f)L=f.r,M=f.g,E=f.b;else if(0!==h&&S+5>=0&&k+5>=0&&S-5<e.canvas.width-1&&k-5<e.canvas.height-1){L=0,M=0,E=0;var A=Math.min(e.canvas.width-1,Math.max(0,S-5)),T=Math.min(e.canvas.height-1,Math.max(0,k-5)),I=Math.min(e.canvas.width-1,Math.max(0,S+5)),R=Math.min(e.canvas.height-1,Math.max(0,k+5));if(R-=T,(I-=A)>0&&R>0){for(var P=e.getImageData(A,T,I,R),O=0,D=0;D<P.data.length;D+=4)L+=P.data[D+0],M+=P.data[D+1],E+=P.data[D+2],O++;L/=O,M/=O,E/=O}var N=x[0](new r.BB.RGB(L,M,E),t);L=parseInt(""+r.BB.mix(t.r,N.r,h)),M=parseInt(""+r.BB.mix(t.g,N.g,h)),E=parseInt(""+r.BB.mix(t.b,N.b,h))}for(e.save(),e.strokeStyle="rgba("+L+", "+M+", "+E+", "+u+")",e.lineWidth=c,e.beginPath(),e.moveTo(n,i),e.lineTo(S,k),b=0;b<v.length;b++)(C=(B=v[b][0]-v[y][0])*B+(w=v[b][1]-v[y][1])*w)<4e3*d*d&&(m++,.5*Math.sin(6324634.2345*Math.cos(5342.3423*m))+.5>C/2e3/d/d)&&(e.moveTo(v[y][0]+.3*B,v[y][1]+.3*w),e.lineTo(v[b][0]-.3*B,v[b][1]-.3*w));e.stroke(),e.restore(),y++,n=S,i=k,g.x=S,g.y=k,l.actions.push({action:"goLine",params:[a,o,s,{r:L,g:M,b:E}]})}},this.endLine=function(){p=!1,y=0,v=[],l&&(l.actions.push({action:"endLine",params:[]}),f.push(l),l=void 0)},this.drawLineSegment=function(n,i,a,l){if(g.x=a,g.y=l,!p&&void 0!==n){e.save(),e.lineWidth=c;var m=t.r,v=t.g,y=t.b;if(n+5>=0&&i+5>=0&&n-5<e.canvas.width-1&&i-5<e.canvas.height-1){m=0,v=0,y=0;var b=Math.min(e.canvas.width-1,Math.max(0,n-5)),B=Math.min(e.canvas.height-1,Math.max(0,i-5)),w=Math.min(e.canvas.width-1,Math.max(0,n+5)),C=Math.min(e.canvas.height-1,Math.max(0,i+5));if(C-=B,(w-=b)>0&&C>0){var S=Math.min(o.width,w),k=Math.min(o.height,C);s.save(),s.globalCompositeOperation="copy",s.drawImage(e.canvas,b,B,w,C,0,0,S,k),s.restore();for(var L=s.getImageData(b,B,w,C),M=0,E=0;E<L.data.length;E+=4)m+=L.data[E+0],v+=L.data[E+1],y+=L.data[E+2],M++;m/=M,v/=M,y/=M}}var A=x[0](new r.BB.RGB(m,v,y),t);m=parseInt(""+(h*A.r+t.r*(1-h))),v=parseInt(""+(h*A.g+t.g*(1-h))),y=parseInt(""+(h*A.b+t.b*(1-h))),e.strokeStyle="rgba("+m+", "+v+", "+y+", "+u+")",e.beginPath(),e.moveTo(n,i),e.lineTo(a,l),e.stroke(),e.strokeStyle="rgba("+m+", "+v+", "+y+", "+u+")",e.restore();var T={tool:["brush","SketchyBrush"],actions:[]};T.actions.push({action:"setScale",params:[d]}),T.actions.push({action:"setSize",params:[c/2]}),T.actions.push({action:"setOpacity",params:[u]}),T.actions.push({action:"setColor",params:[t]}),T.actions.push({action:"setBlending",params:[h]}),T.actions.push({action:"drawLineSegment",params:[n,i,a,l]}),f.push(T)}},this.isDrawing=function(){return p}}})),i.register("kic4a",(function(e,n){t(e.exports,"PixelBrush",(function(){return o}));var r=i("eWjiX"),a=i("hrnUX");function o(){var e,t,n,i,o,s=function(){L.clearRect(0,0,4,4),L.fillStyle=x?"#fff":i;for(var t=0;t<Math.max(1,Math.round(f*M.length));t++)L.fillRect(M[t][0],M[t][1],1,1);o=e.createPattern(k,"repeat")},l=function(t,n,r,a,s){e.save(),x?(e.fillStyle=b?o:"#fff",e.globalCompositeOperation=y?"source-atop":"destination-out"):(e.fillStyle=b?o:i,y&&(e.globalCompositeOperation="source-atop")),e.globalAlpha=b?1:f,t=Math.floor(t),n=Math.floor(n),r=Math.floor(r),a=Math.floor(a);for(var l=Math.abs(r-t),c=t<r?1:-1,u=-Math.abs(a-n),h=n<a?1:-1,d=l+u;s?s=!1:e.fillRect(t,n,1,1),t!==r||n!==a;){var p=2*d;p>=u&&(d+=u,t+=c),p<=l&&(d+=l,n+=h)}e.restore()},c=function(e,t,n,i){var a=function(e,t,n,i,a){var o=r.BB.Vec2.nor({x:i.x-e.x,y:i.y-e.y}),s=r.BB.Vec2.nor({x:t.x-e.x,y:t.y-e.y}),l=r.BB.Vec2.nor({x:i.x-n.x,y:i.y-n.y});return Math.abs(r.BB.Vec2.angle(o,s)%Math.PI),Math.PI,Math.abs(r.BB.Vec2.angle(o,l)%Math.PI),Math.PI,Math.max(r.BB.Vec2.dist(o,s),r.BB.Vec2.dist(o,l))>a}(e,t,n,i,.1);e.x=Math.floor(e.x),e.y=Math.floor(e.y),i.x=Math.floor(i.x),i.y=Math.floor(i.y);var o=r.BB.dist(e.x,e.y,i.x,i.y);if(!a||o<7)l(e.x,e.y,i.x,i.y,!0);else{for(var s=Math.max(2,Math.round(o/4)),c=[],u=0;u<=s;u++){var h=u/s,d=Math.pow(1-h,3),p=3*h*Math.pow(1-h,2),g=3*Math.pow(h,2)*(1-h),f=Math.pow(h,3);c.push({x:d*e.x+p*t.x+g*n.x+f*i.x,y:d*e.y+p*t.y+g*n.y+f*i.y})}for(var m=0;m<s;m++)l(Math.round(c[m].x),Math.round(c[m].y),Math.round(c[m+1].x),Math.round(c[m+1].y),!0)}},u=function(t,n,r,a,s){e.save(),x?(e.fillStyle=b?o:"#fff",e.globalCompositeOperation=y?"source-atop":"destination-out"):(e.fillStyle=b?o:i,y&&(e.globalCompositeOperation="source-atop")),e.globalAlpha=b?1:a,e.fillRect(Math.round(t+-r),Math.round(n+-r),Math.round(2*r),Math.round(2*r)),e.restore()},h=function(t,n,i,a){function o(e){var t=r.BB.mix(w.pressure,a,e.t),n=f*(v?t*t:1),i=Math.max(.5,p*(m?t:1));u(e.x,e.y,i,n,e.angle)}function s(e){c(e.p1,e.p2,e.p3,e.p4)}if(null===S&&(S=new r.BB.BezierLine).add(B.x,B.y,0,(function(){})),e.save(),1===Math.round(2*p))null===t?S.addFinal(4,null,s):S.add(t,n,4,null,s);else{var l=i*g;null===t?S.addFinal(l,o):S.add(t,n,l,o)}e.restore()},d=new a.KL.DecoyKlHistory,p=.5,g=.9,f=1,m=!0,v=!1,y=!1,x=!1,b=!0,B={x:0,y:0,pressure:0},w={x:0,y:0,pressure:0},C=!1,S=null,k=(Math.PI,r.BB.canvas(4,4)),L=k.getContext("2d"),M=[[3,2],[1,0],[3,0],[1,2],[2,1],[0,3],[0,1],[2,3],[2,0],[0,2],[0,0],[2,2],[1,1],[3,3],[3,1],[1,3]];this.startLine=function(e,i,a){(t={tool:["brush","PixelBrush"],actions:[]}).actions.push({action:"sizePressure",params:[m]}),t.actions.push({action:"setSize",params:[p]}),t.actions.push({action:"setSpacing",params:[g]}),t.actions.push({action:"setOpacity",params:[f]}),t.actions.push({action:"setColor",params:[n]}),t.actions.push({action:"setLockAlpha",params:[y]}),t.actions.push({action:"setIsEraser",params:[x]}),t.actions.push({action:"setUseDither",params:[b]}),b&&s(),a=Math.max(0,Math.min(1,a));var o=v?f*a*a:f,l=m?Math.max(.5,a*p):Math.max(.5,p);C=!0,u(e,i,l,o),l*g,B.x=e,B.y=i,B.pressure=a,w=r.BB.copyObj(B),t.actions.push({action:"startLine",params:[e,i,a]})},this.goLine=function(e,n,i){if(C){t.actions.push({action:"goLine",params:[e,n,i]});var a=r.BB.clamp(i,0,1),o=m?Math.max(.1,B.pressure*p):Math.max(.1,p);h(e,n,o,B.pressure),w=r.BB.copyObj(B),B.x=e,B.y=n,B.pressure=a}},this.endLine=function(e,n){var i=m?Math.max(.1,B.pressure*p):Math.max(.1,p);h(null,null,i,B.pressure),C=!1,S=null,t&&(t.actions.push({action:"endLine",params:[e,n]}),d.push(t),t=void 0)},this.drawLineSegment=function(e,t,i,a){if(B.x=i,B.y=a,B.pressure=1,!C&&void 0!==e){if(b&&s(),1===Math.round(2*p))l(e,t,i,a,!0);else{r.BB.pointsToAngleDeg({x:e,y:t},{x:i,y:a});var o,c=Math.sqrt(Math.pow(i-e,2)+Math.pow(a-t,2)),h=(i-e)/c,v=(a-t)/c,w=p*g;for(o=p*g;o<=c;o+=w)u(e+h*o,t+v*o,p,f)}var S={tool:["brush","PixelBrush"],actions:[]};S.actions.push({action:"sizePressure",params:[m]}),S.actions.push({action:"setSize",params:[p]}),S.actions.push({action:"setSpacing",params:[g]}),S.actions.push({action:"setOpacity",params:[f]}),S.actions.push({action:"setColor",params:[n]}),S.actions.push({action:"setLockAlpha",params:[y]}),S.actions.push({action:"setIsEraser",params:[x]}),S.actions.push({action:"setUseDither",params:[b]}),S.actions.push({action:"drawLineSegment",params:[e,t,i,a]}),d.push(S)}},this.isDrawing=function(){return C},this.setColor=function(e){n!==e&&(i="rgb("+(n=e).r+","+n.g+","+n.b+")")},this.setContext=function(t){e=t},this.setHistory=function(e){d=e},this.setSize=function(e){p=Math.round(2*e)/2},this.setOpacity=function(e){f=e},this.setSpacing=function(e){g=e},this.sizePressure=function(e){m=e},this.opacityPressure=function(e){v=e},this.setLockAlpha=function(e){y=e},this.setIsEraser=function(e){x=!!e},this.setUseDither=function(e){b=!!e},this.getSpacing=function(){return g},this.getSize=function(){return p},this.getOpacity=function(){return f},this.getLockAlpha=function(){return y},this.getIsEraser=function(){return x},this.getUseDither=function(){return b}}})),i.register("7cUpm",(function(e,n){t(e.exports,"EraserBrush",(function(){return o}));var r=i("eWjiX"),a=i("hrnUX");function o(){var e,t,n,i=function(t,n,i,r){e.save(),e.globalCompositeOperation=m?v?"destination-out":"source-atop":"destination-out";var a=e.createRadialGradient(i,i,0,i,i,i),o=Math.pow(r,2);o=Math.max(0,Math.min((i-1)/i,o));var s=Math.max(0,Math.min(1,r)),l=2*s-s*s;a.addColorStop(o,"rgba(255, 255, 255, "+l+")"),a.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=a,e.translate(t-i,n-i),e.fillRect(0,0,2*i,2*i),e.restore()},o=function(e,t,r){var a,o;r=Math.max(0,Math.min(1,r));var s=h?Math.max(.1,r*l):Math.max(.1,l),p=Math.max(1,Math.max(.5,1-u)*s*c);function f(e){var t=e.t;a=g.pressure*(1-t)+r*t,o=d?u*a*a:u,s=h?Math.max(.1,a*l):Math.max(.1,l),i(e.x,e.y,s,o)}null===e?n.addFinal(p,f):n.add(e,t,p,f)},s=new a.KL.DecoyKlHistory,l=30,c=.4,u=1,h=!0,d=!1,p={x:0,y:0,pressure:0},g={x:0,y:0,pressure:0},f=!1,m=!1,v=!1;this.startLine=function(a,o,s){(t={tool:["brush","EraserBrush"],actions:[]}).actions.push({action:"opacityPressure",params:[d]}),t.actions.push({action:"sizePressure",params:[h]}),t.actions.push({action:"setSize",params:[l]}),t.actions.push({action:"setOpacity",params:[u]}),t.actions.push({action:"setTransparentBG",params:[v]}),m=0===e.canvas.index,s=Math.max(0,Math.min(1,s));var y=d?u*s*s:u,x=h?Math.max(.1,s*l):Math.max(.1,l);f=!0,x>1&&i(a,o,x,y),x*c,p.x=a,p.y=o,p.pressure=s,g=r.BB.copyObj(p),(n=new r.BB.BezierLine).add(a,o,0,(function(){})),t.actions.push({action:"startLine",params:[a,o,s]})},this.goLine=function(e,n,i){f&&(t.actions.push({action:"goLine",params:[e,n,i]}),o(e,n,p.pressure),g=r.BB.copyObj(p),p.x=e,p.y=n,p.pressure=i)},this.endLine=function(){n&&o(null,null,p.pressure),f=!1,n=void 0,t&&(t.actions.push({action:"endLine",params:[]}),s.push(t),t=void 0)},this.drawLineSegment=function(t,n,r,a){if(m=0===e.canvas.index,p.x=r,p.y=a,!f&&void 0!==t){var o,g=Math.sqrt(Math.pow(r-t,2)+Math.pow(a-n,2)),y=(r-t)/g,x=(a-n)/g,b=Math.max(1,Math.max(.5,1-u)*l*c);for(o=0;o<=g;o+=b)i(t+y*o,n+x*o,l,u);var B={tool:["brush","EraserBrush"],actions:[]};B.actions.push({action:"opacityPressure",params:[d]}),B.actions.push({action:"sizePressure",params:[h]}),B.actions.push({action:"setSize",params:[l]}),B.actions.push({action:"setOpacity",params:[u]}),B.actions.push({action:"setTransparentBG",params:[v]}),B.actions.push({action:"drawLineSegment",params:[t,n,r,a]}),s.push(B)}},this.isDrawing=function(){return f},this.setContext=function(t){e=t},this.setHistory=function(e){s=e},this.setSize=function(e){l=e},this.setOpacity=function(e){u=e},this.sizePressure=function(e){h=e},this.opacityPressure=function(e){d=e},this.setTransparentBG=function(e){v=1==e},this.getSize=function(){return l},this.getOpacity=function(){return u}}})),i.register("ltaBP",(function(e,n){t(e.exports,"SmudgeBrush",(function(){return h}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("7U0Ew"),s=i("eWjiX"),l=i("hrnUX"),c=256;function u(e,t){for(var n=(t=s.BB.copyObj(t)).brush.size,i=t.brush.center.x,r=t.brush.center.y,a=t.aP.y*e.width+t.aP.x,o=4*(t.bP.y*e.width+t.bP.x-a),l=0,c=n>30?1024:512,u=[],h=0;h<c;h++)u[h]=(Math.random()-.5)/1.001+.5;var d=Math.max(3,Math.min(8,t.brush.size-8)),p=function(a,o,h,p){var g,f,m,v=s.BB.dist(i,r,h,p),y=1-t.brush.opacity*(1-(m=1,(g=(v-(n-d))/d)<=(f=0)?f:g>=m?m:g));if(1!==y){if(e.data[a+3])if(e.data[o+3]){var x;x=e.data[a+3]<e.data[o+3]?1-e.data[a+3]/e.data[o+3]*(1-y):e.data[o+3]/e.data[a+3]*y,e.data[o]=Math.floor(s.BB.mix(e.data[a],e.data[o+0],x)+u[l]),e.data[o+1]=Math.floor(s.BB.mix(e.data[a+1],e.data[o+1],x)+u[l]),e.data[o+2]=Math.floor(s.BB.mix(e.data[a+2],e.data[o+2],x)+u[l]),l=(l+1)%c}else e.data[o]=e.data[a+0],e.data[o+1]=e.data[a+1],e.data[o+2]=e.data[a+2];else;t.brush.alphaLock||(e.data[o+3]=Math.floor(s.BB.mix(e.data[a+3],e.data[o+3],y)+.5))}},g=4*t.bP.x,f=g+4*(t.size.w-1);if(t.aP.y<t.bP.y)for(var m=t.size.h-1,v=t.bP.y+t.size.h-1;m>=0;m--,v--)for(var y=(m+t.bP.y)*e.width*4,x=f+y,b=f+y-o,B=t.bP.x+t.size.w-1;x>=g+y;x-=4,b-=4,B--)p(b,x,B,v);else if(t.aP.y>t.bP.y)for(var w=0,C=t.bP.y;w<t.size.h;w++,C++)for(var S=(w+t.bP.y)*e.width*4,k=f+S,L=f+S-o,M=t.bP.x+t.size.w-1;k>=g+S;k-=4,L-=4,M--)p(L,k,M,C);else if(t.aP.x<t.bP.x)for(var E=t.size.h-1,A=t.bP.y+t.size.h-1;E>=0;E--,A--)for(var T=(E+t.bP.y)*e.width*4,I=f+T,R=f+T-o,P=t.bP.x+t.size.w-1;I>=g+T;I-=4,R-=4,P--)p(R,I,P,A);else for(var O=0,D=t.bP.y;O<t.size.h;O++,D++)for(var N=(O+t.bP.y)*e.width*4,z=g+N,G=g+N-o,j=t.bP.x;z<f+N;z+=4,G+=4,j++)p(G,z,j,D)}var h=function(){"use strict";function e(){(0,r.default)(this,e),(0,o.default)(this,"history",new l.KL.DecoyKlHistory),(0,o.default)(this,"settingColor",{r:0,g:0,b:0}),(0,o.default)(this,"settingSize",35),(0,o.default)(this,"settingSpacing",.20446882736951905),(0,o.default)(this,"settingOpacity",.8),(0,o.default)(this,"settingHasSizePressure",!1),(0,o.default)(this,"settingHasOpacityPressure",!1),(0,o.default)(this,"settingLockLayerAlpha",!1),(0,o.default)(this,"lastInput",{x:0,y:0,pressure:0}),(0,o.default)(this,"lastInput2",{x:0,y:0,pressure:0}),(0,o.default)(this,"isDrawing",!1),(0,o.default)(this,"bezierLine",null),(0,o.default)(this,"drawBuffer",[])}return(0,a.default)(e,[{key:"updateRedrawBounds",value:function(e){this.redrawBounds=s.BB.updateBounds(this.redrawBounds,e)}},{key:"updateCompleteRedrawBounds",value:function(e,t,n,i){this.completeRedrawBounds=s.BB.updateBounds(this.completeRedrawBounds,{x1:e,y1:t,x2:n,y2:i})}},{key:"copyFromCanvas",value:function(){var e=this,t=this.copiedCells.map((function(e){return!1})),n=[],i=Math.ceil(this.copyImageData.width/c);this.redrawBounds&&(n.push({x1:Math.floor(this.redrawBounds.x1/c),y1:Math.floor(this.redrawBounds.y1/c),x2:Math.floor(this.redrawBounds.x2/c),y2:Math.floor(this.redrawBounds.y2/c)}),n.forEach((function(e){for(var n=e.x1;n<=e.x2;n++)for(var r=e.y1;r<=e.y2;r++)t[r*i+n]=!0})),t.forEach((function(t,n){if(t&&!e.copiedCells[n]){e.copiedCells[n]=!0;var r=n%i,a=Math.floor(n/i),o=(Math.min(r*c+c,e.copyImageData.width)-1)%c+1,l=(Math.min(a*c+c,e.copyImageData.height)-1)%c+1,u=s.BB.canvas(o,l).getContext("2d");u.drawImage(e.context.canvas,-r*c,-a*c);for(var h=u.getImageData(0,0,o,l),d=0;d<l;d++)for(var p=0,g=d*o*4,f=4*((a*c+d)*e.copyImageData.width+r*c);p<o;p++,g+=4,f+=4)e.copyImageData.data[f]=h.data[g],e.copyImageData.data[f+1]=h.data[g+1],e.copyImageData.data[f+2]=h.data[g+2],e.copyImageData.data[f+3]=h.data[g+3]}})))}},{key:"prepDot",value:function(e,t,n,i){if(this.lastDot){n=Math.round(n);var r=Math.round(2*n),a=Math.round(2*n),o=function(e,t,n,i,r){if(n.x===i.x&&n.y===i.y)return null;n=s.BB.copyObj(n),i=s.BB.copyObj(i),r=s.BB.copyObj(r);var a=0,o=0,l=0,c=0;return n.x<0&&(c=-n.x),n.y<0&&(a=-n.y),i.x<0&&(c=Math.max(c,-i.x)),i.y<0&&(a=Math.max(a,-i.y)),n.x+r.w>e&&(o=n.x+r.w-e),n.y+r.h>t&&(l=n.y+r.h-t),i.x+r.w>e&&(o=Math.max(o,i.x+r.w-e)),i.y+r.h>t&&(l=Math.max(l,i.y+r.h-t)),n.x+=c,i.x+=c,n.y+=a,i.y+=a,r.w=r.w-c-o,r.h=r.h-a-l,r.w<=0||r.h<=0?null:{aP:{x:n.x,y:n.y},bP:{x:i.x,y:i.y},size:{w:r.w,h:r.h}}}(this.copyImageData.width,this.copyImageData.height,{x:Math.round(this.lastDot.x-n),y:Math.round(this.lastDot.y-n)},{x:Math.round(e-n),y:Math.round(t-n)},{w:r,h:a});if(o){var l={aP:o.aP,bP:o.bP,size:o.size,brush:{center:{x:e,y:t},size:n,opacity:i,alphaLock:this.settingLockLayerAlpha}};this.updateRedrawBounds({x1:l.bP.x,y1:l.bP.y,x2:l.bP.x+2*l.brush.size,y2:l.bP.y+2*l.brush.size}),this.drawBuffer.push(l)}this.lastDot={x:e,y:t}}else this.lastDot={x:e,y:t}}},{key:"continueLine",value:function(e,t,n,i){var r=this;this.drawBuffer=[],null===this.bezierLine&&(this.bezierLine=new s.BB.BezierLine,this.bezierLine.add(this.lastInput.x,this.lastInput.y,0,(function(){})));var a=[],o=function(e){var t=s.BB.mix(r.lastInput2.pressure,i,e.t),n=r.settingOpacity*(r.settingHasOpacityPressure?t*t:1),o=Math.max(.1,r.settingSize*(r.settingHasSizePressure?t:1));a.push([e.x,e.y,o,n,e.angle])},l=n*this.settingSpacing/3;null===e?this.bezierLine.addFinal(l,o):this.bezierLine.add(e,t,l,o);for(var c=0;c<a.length;c++){var h=a[c];this.prepDot(h[0],h[1],h[2],h[3]),h}this.copyFromCanvas();for(var d=0;d<this.drawBuffer.length;d++)u(this.copyImageData,this.drawBuffer[d])}},{key:"startLine",value:function(e,t,n){this.historyEntry={tool:["brush","SmudgeBrush"],actions:[]},n=s.BB.clamp(n,0,1);var i=this.settingHasOpacityPressure?this.settingOpacity*n*n:this.settingOpacity,r=this.settingHasSizePressure?Math.max(.1,n*this.settingSize):Math.max(.1,this.settingSize);this.lastDot=null,this.isDrawing=!0,this.copyImageData=new ImageData(this.context.canvas.width,this.context.canvas.height);var a=Math.ceil(this.context.canvas.width/c)*Math.ceil(this.context.canvas.height/c);this.copiedCells="0".repeat(a).split("").map((function(e){return!1})),this.prepDot(e,t,r,i),this.lineToolLastDot=r*this.settingSpacing,this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=n,this.lastInput2.pressure=n,this.completeRedrawBounds=null}},{key:"goLine",value:function(e,t,n){if(this.isDrawing){this.redrawBounds=null;var i=s.BB.clamp(n,0,1),r=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);this.continueLine(e,t,r,this.lastInput.pressure),this.redrawBounds&&(this.context.putImageData(this.copyImageData,0,0,this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2-this.redrawBounds.x1-1,this.redrawBounds.y2-this.redrawBounds.y1-1),this.updateCompleteRedrawBounds(this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2,this.redrawBounds.y2)),this.lastInput.x=e,this.lastInput.y=t,this.lastInput2.pressure=this.lastInput.pressure,this.lastInput.pressure=i}}},{key:"endLine",value:function(){this.redrawBounds=null;var e=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);if(this.context.save(),this.continueLine(null,null,e,this.lastInput.pressure),this.context.restore(),this.isDrawing=!1,this.bezierLine=null,this.redrawBounds&&(this.context.putImageData(this.copyImageData,0,0,this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2-this.redrawBounds.x1-1,this.redrawBounds.y2-this.redrawBounds.y1-1),this.updateCompleteRedrawBounds(this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2,this.redrawBounds.y2)),this.historyEntry&&this.completeRedrawBounds){var t=this.copyImageData;if(!(0===this.completeRedrawBounds.x1&&0===this.completeRedrawBounds.y1&&this.completeRedrawBounds.x2>=this.context.canvas.width-1&&this.completeRedrawBounds.y2>=this.context.canvas.height-1)){var n=s.BB.canvas(this.completeRedrawBounds.x2-this.completeRedrawBounds.x1+1,this.completeRedrawBounds.y2-this.completeRedrawBounds.y1+1);n.getContext("2d").drawImage(this.context.canvas,-this.completeRedrawBounds.x1,-this.completeRedrawBounds.y1),t=n}this.historyEntry.actions.push({action:"drawImage",params:[t,this.completeRedrawBounds.x1,this.completeRedrawBounds.y1]}),this.history.push(this.historyEntry),this.historyEntry=void 0}this.copyImageData=null}},{key:"drawImage",value:function(e,t,n){e instanceof ImageData?this.context.putImageData(e,t,n):(this.context.clearRect(t,n,e.width,e.height),this.context.drawImage(e,t,n))}},{key:"drawLineSegment",value:function(e,t,n,i){}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"setColor",value:function(e){this.settingColor.r===e.r&&this.settingColor.g===e.g&&this.settingColor.b===e.b||(this.settingColor={r:e.r,g:e.g,b:e.b},this.settingColorStr=s.BB.ColorConverter.toRgbStr(this.settingColor))}},{key:"setContext",value:function(e){this.context=e}},{key:"setHistory",value:function(e){this.history=e}},{key:"setSize",value:function(e){this.settingSize=e}},{key:"setOpacity",value:function(e){this.settingOpacity=e}},{key:"setSpacing",value:function(e){this.settingSpacing=e}},{key:"sizePressure",value:function(e){this.settingHasSizePressure=!!e}},{key:"opacityPressure",value:function(e){this.settingHasOpacityPressure=!!e}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=!!e}},{key:"getSpacing",value:function(){return this.settingSpacing}},{key:"getSize",value:function(){return this.settingSize}},{key:"getOpacity",value:function(){return this.settingOpacity}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}}]),e}()})),i.register("6Nq1H",(function(e,n){t(e.exports,"ChemyBrush",(function(){return c}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("7U0Ew"),s=i("3Rl3W"),l=i("eWjiX"),c=function(){"use strict";function e(){(0,r.default)(this,e),(0,o.default)(this,"settingSize",.25),(0,o.default)(this,"settingOpacity",1),(0,o.default)(this,"settingLockLayerAlpha",!1),(0,o.default)(this,"settingIsEraser",!1),(0,o.default)(this,"settingMode","fill"),(0,o.default)(this,"settingDistort",0),(0,o.default)(this,"settingXSymmetry",!1),(0,o.default)(this,"settingYSymmetry",!1),(0,o.default)(this,"settingGradient",!1),(0,o.default)(this,"isDrawing",!1)}return(0,a.default)(e,[{key:"updateCompleteRedrawBounds",value:function(e,t){var n={x1:e,y1:t,x2:e,y2:t};this.settingXSymmetry&&(n=l.BB.updateBounds(n,{x1:-e+this.copyCanvas.width,y1:t,x2:-e+this.copyCanvas.width,y2:t})),this.settingYSymmetry&&(n=l.BB.updateBounds(n,{x1:e,y1:-t+this.copyCanvas.height,x2:e,y2:-t+this.copyCanvas.height}));var i="stroke"===this.settingMode?this.settingSize+1:1;n.x1=Math.floor(n.x1-i),n.y1=Math.floor(n.y1-i),n.x2=Math.ceil(n.x2+i),n.y2=Math.ceil(n.y2+i),this.completeRedrawBounds=l.BB.updateBounds(this.completeRedrawBounds,n)}},{key:"drawShape",value:function(){var e=this;this.context.save(),this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),this.context.drawImage(this.copyCanvas,0,0);var t=(0,s.default)({},this.settingColor);if(this.settingIsEraser?(t.r=255,t.g=255,t.b=255,this.settingLockLayerAlpha?this.context.globalCompositeOperation="source-atop":this.context.globalCompositeOperation="destination-out"):this.settingLockLayerAlpha&&(this.context.globalCompositeOperation="source-atop"),this.path){var n=new Path2D;this.path.forEach((function(e,t){0===t?n.moveTo(e.x,e.y):n.lineTo(e.x,e.y)}));var i=l.BB.ColorConverter.toRgbaStr({r:t.r,g:t.g,b:t.b,a:this.settingOpacity});if(this.settingGradient){var r=this.path[0].x>this.path[this.path.length-1].x,a=this.context.createLinearGradient(0,r?this.minY:this.maxY,0,r?this.maxY:this.minY);a.addColorStop(0,l.BB.ColorConverter.toRgbaStr({r:t.r,g:t.g,b:t.b,a:this.settingOpacity})),a.addColorStop(1,l.BB.ColorConverter.toRgbaStr({r:t.r,g:t.g,b:t.b,a:0})),i=a}"fill"===this.settingMode?this.context.fillStyle=i:(this.context.lineWidth=2*this.settingSize,this.context.lineJoin="bevel",this.context.strokeStyle=i);var o=function(){"fill"===e.settingMode?e.context.fill(n):e.context.stroke(n)};o(),this.settingXSymmetry&&(this.context.save(),this.context.translate(this.context.canvas.width/2,0),this.context.scale(-1,1),this.context.translate(-this.context.canvas.width/2,0),o(),this.context.restore()),this.settingYSymmetry&&(this.context.save(),this.context.translate(0,this.context.canvas.height/2),this.context.scale(1,-1),this.context.translate(0,-this.context.canvas.height/2),o(),this.context.restore(),this.settingXSymmetry&&(this.context.save(),this.context.translate(this.context.canvas.width/2,this.context.canvas.height/2),this.context.scale(-1,-1),this.context.translate(-this.context.canvas.width/2,-this.context.canvas.height/2),o(),this.context.restore()))}this.context.restore()}},{key:"setHistory",value:function(e){this.history=e}},{key:"getSize",value:function(){return"stroke"===this.settingMode?this.settingSize:0}},{key:"setSize",value:function(e){this.settingSize=e}},{key:"getOpacity",value:function(){return this.settingOpacity}},{key:"setOpacity",value:function(e){this.settingOpacity=e}},{key:"setColor",value:function(e){this.settingColor=l.BB.copyObj(e)}},{key:"setContext",value:function(e){this.context=e}},{key:"setMode",value:function(e){this.settingMode=e}},{key:"getMode",value:function(){return this.settingMode}},{key:"setDistort",value:function(e){this.settingDistort=l.BB.clamp(e,0,1)}},{key:"getDistort",value:function(){return this.settingDistort}},{key:"setXSymmetry",value:function(e){this.settingXSymmetry=!!e}},{key:"getXSymmetry",value:function(){return this.settingXSymmetry}},{key:"setYSymmetry",value:function(e){this.settingYSymmetry=!!e}},{key:"getYSymmetry",value:function(){return this.settingYSymmetry}},{key:"setGradient",value:function(e){this.settingGradient=!!e}},{key:"getGradient",value:function(){return this.settingGradient}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=!!e}},{key:"getIsEraser",value:function(){return this.settingIsEraser}},{key:"setIsEraser",value:function(e){this.settingIsEraser=!!e}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"startLine",value:function(e,t){this.isDrawing=!0,this.path=[{x:e,y:t}],this.minY=t,this.maxY=t,this.copyCanvas=l.BB.canvas(this.context.canvas.width,this.context.canvas.height),this.copyCanvas.getContext("2d").drawImage(this.context.canvas,0,0),this.completeRedrawBounds=null,this.updateCompleteRedrawBounds(e,t)}},{key:"goLine",value:function(e,t){if(this.isDrawing){var n={x:e,y:t};this.settingDistort>0&&(n.x+=(Math.random()-.5)*this.settingDistort*80,n.y+=(Math.random()-.5)*this.settingDistort*80),this.minY=Math.min(this.minY,n.y),this.maxY=Math.max(this.maxY,n.y),this.path.push(n),this.updateCompleteRedrawBounds(e,t),this.drawShape()}}},{key:"endLine",value:function(){if(this.isDrawing=!1,this.completeRedrawBounds=l.BB.boundsInArea(this.completeRedrawBounds,this.copyCanvas.width,this.copyCanvas.height),this.path.length>1&&this.completeRedrawBounds){var e=l.BB.canvas(this.completeRedrawBounds.x2-this.completeRedrawBounds.x1+1,this.completeRedrawBounds.y2-this.completeRedrawBounds.y1+1);e.getContext("2d").drawImage(this.context.canvas,-this.completeRedrawBounds.x1,-this.completeRedrawBounds.y1),this.history.push({tool:["brush","ChemyBrush"],actions:[{action:"drawImage",params:[e,this.completeRedrawBounds.x1,this.completeRedrawBounds.y1]}]})}this.path=null,this.copyCanvas=null}},{key:"drawImage",value:function(e,t,n){this.context.save(),this.context.clearRect(t,n,e.width,e.height),this.context.drawImage(e,t,n),this.context.restore()}},{key:"drawLineSegment",value:function(e,t,n,i){}}]),e}()})),i.register("3P46L",(function(e,n){t(e.exports,"brushesUI",(function(){return h}));var r=i("cVFne"),a=i("9mjXI"),o=i("iYbUv"),s=i("brjBD"),l=i("9rc5F"),c=i("dS2qM"),u=i("vCnsd"),h={penBrush:r.penBrushUi,blendBrush:a.blendBrushUi,sketchyBrush:o.sketchyBrushUi,pixelBrush:s.pixelBrushUi,chemyBrush:u.chemyBrushUi,smudgeBrush:c.smudgeBrushUi,eraserBrush:l.eraserBrushUi}})),i.register("cVFne",(function(n,r){t(n.exports,"penBrushUi",(function(){return v}));var a,o,s=i("eWjiX"),l=i("dAXbp"),c=i("7NTKy"),u=i("gWfkn"),h=i("lXqiv"),d=i("llzZ0"),p=i("fCJWy"),g=i("7gVvp"),f=i("74D3O"),m=i("1mH1z"),v=(a={image:e(g),tooltip:(0,m.LANG)("brush-pen"),sizeSlider:{min:.5,max:100,curve:s.BB.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1,curve:[[0,.01],[.5,.3],[1,1]]},Ui:null},o=[(0,m.LANG)("brush-pen-circle"),(0,m.LANG)("brush-pen-chalk"),(0,m.LANG)("brush-pen-calligraphy"),(0,m.LANG)("brush-pen-square")],m.languageStrings.subscribe((function(){a.tooltip=(0,m.LANG)("brush-pen"),o=[(0,m.LANG)("brush-pen-circle"),(0,m.LANG)("brush-pen-chalk"),(0,m.LANG)("brush-pen-calligraphy"),(0,m.LANG)("brush-pen-square")]})),a.Ui=function(e){var t,n,i=function(){for(var e=0;e<y.length;e++)y[e].className=e===x?"brush-alpha-selected":"brush-alpha"},r=function(e){v.setSize(e),v.setSpacing(Math.max(2,w.interpolate(e))/15)},g=document.createElement("div"),v=new l.brushes.PenBrush;v.setHistory(u.klHistory),e.onSizeChange(v.getSize());for(var y=[],x=0,b=0;b<4;b++)!function(e){var t=s.BB.el({title:o[e],onClick:function(){var t;x=t=e,v.setAlpha(t),i()}}),n=s.BB.canvas(70,70),r=n.getContext("2d");0===e||3===e?0===e?(r.beginPath(),r.arc(35,35,30,0,2*Math.PI),r.closePath(),r.fill()):r.fillRect(5,5,60,60):1===e?r.drawImage((0,f.genBrushAlpha01)(60),5,5):2===e&&r.drawImage((0,f.genBrushAlpha02)(60),5,5),t.style.backgroundImage="url("+n.toDataURL("image/png")+")",y.push(t)}(b);i();var B=new(0,h.Checkbox)({init:v.getLockAlpha(),label:(0,m.LANG)("lock-alpha"),callback:function(e){v.setLockAlpha(e)},doHighlight:!0,title:(0,m.LANG)("lock-alpha-title"),css:{cssFloat:"right",textAlign:"right"}}),w=new s.BB.SplineInterpolator([[0,15],[8,7],[14,4],[30,3],[50,2.7],[100,2]]);!function(){t=new(0,d.KlSlider)({label:(0,m.LANG)("brush-size"),width:225,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:v.getSize(),curve:a.sizeSlider.curve,eventResMs:c.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){r(t),e.onSizeChange(t)},formatFunc:function(e){return e<10?s.BB.round(e,1):Math.round(e)},manualInputRoundDigits:1}),n=new(0,d.KlSlider)({label:(0,m.LANG)("opacity"),width:225,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:a.opacitySlider.max,curve:a.opacitySlider.curve,eventResMs:c.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){v.setOpacity(t),e.onOpacityChange(t)}});var i=(0,p.penPressureToggle)(!0,(function(e){v.sizePressure(e)})),o=(0,p.penPressureToggle)(!1,(function(e){v.opacityPressure(e)}));g.append(s.BB.el({content:[t.getElement(),i],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),s.BB.el({content:[n.getElement(),o],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}));for(var l=document.createElement("div"),u=0;u<y.length;u++)l.appendChild(y[u]);l.style.marginTop="10px",g.appendChild(l),l.appendChild(B.getElement())}(),this.increaseSize=function(e){v.isDrawing()||t.changeSliderValue(e)},this.decreaseSize=function(e){v.isDrawing()||t.changeSliderValue(-e)},this.getSize=function(){return v.getSize()},this.setSize=function(e){r(e),t.setValue(e)},this.getOpacity=function(){return v.getOpacity()},this.setOpacity=function(e){v.setOpacity(e),n.setValue(e)},this.setColor=function(e){v.setColor(e)},this.setContext=function(e){v.setContext(e)},this.startLine=function(e,t,n){v.startLine(e,t,n)},this.goLine=function(e,t,n){v.goLine(e,t,n)},this.endLine=function(e,t){v.endLine(e,t)},this.getBrush=function(){return v},this.isDrawing=function(){return v.isDrawing()},this.getElement=function(){return g}},a)})),i.register("7NTKy",(function(e,n){t(e.exports,"eventResMs",(function(){return i}));var i=20})),i.register("7gVvp",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("iiCd6")})),i.register("9mjXI",(function(n,r){t(n.exports,"blendBrushUi",(function(){return f}));var a,o=i("eWjiX"),s=i("fCJWy"),l=i("7NTKy"),c=i("lXqiv"),u=i("dAXbp"),h=i("gWfkn"),d=i("llzZ0"),p=i("cQSIC"),g=i("1mH1z"),f=(a={image:e(p),tooltip:(0,g.LANG)("brush-blend"),sizeSlider:{min:.5,max:100,curve:o.BB.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1},Ui:null},g.languageStrings.subscribe((function(){a.tooltip=(0,g.LANG)("brush-blend")})),a.Ui=function(e){var t,n,i=function(e){p.setSize(e)},r=document.createElement("div"),p=new u.brushes.BlendBrush;p.setHistory(h.klHistory),e.onSizeChange(p.getSize()),function(){t=new(0,d.KlSlider)({label:(0,g.LANG)("brush-size"),width:225,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:58,curve:a.sizeSlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){i(t),e.onSizeChange(t)}}),n=new(0,d.KlSlider)({label:(0,g.LANG)("opacity"),width:225,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:p.getOpacity(),curve:a.opacitySlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){p.setOpacity(t),e.onOpacityChange(t)}});var u=new(0,d.KlSlider)({label:(0,g.LANG)("brush-blending"),width:225,height:30,min:0,max:1,value:p.getBlending(),eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(e){p.setBlending(e)}});u.getElement().style.marginTop="10px";var h=(0,s.penPressureToggle)(!0,(function(e){p.setSizePressure(e)})),f=(0,s.penPressureToggle)(!1,(function(e){p.setOpacityPressure(e)})),m=new(0,c.Checkbox)({init:p.getLockAlpha(),label:(0,g.LANG)("lock-alpha"),callback:function(e){p.setLockAlpha(e)},doHighlight:!0,title:(0,g.LANG)("lock-alpha-title"),css:{marginTop:"10px",display:"inline-block"}});r.append(o.BB.el({content:[t.getElement(),h],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),o.BB.el({content:[n.getElement(),f],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}),u.getElement(),m.getElement())}(),this.increaseSize=function(e){p.getIsDrawing()||t.changeSliderValue(e)},this.decreaseSize=function(e){p.getIsDrawing()||t.changeSliderValue(-e)},this.getSize=function(){return p.getSize()},this.setSize=function(e){i(e),t.setValue(e)},this.getOpacity=function(){return p.getOpacity()},this.setOpacity=function(e){p.setOpacity(e),n.setValue(e)},this.setColor=function(e){p.setColor(e)},this.setContext=function(e){p.setContext(e)},this.startLine=function(e,t,n){p.startLine(e,t,n)},this.goLine=function(e,t,n,i){p.goLine(e,t,n,i)},this.endLine=function(){p.endLine()},this.getBrush=function(){return p},this.isDrawing=function(){return p.getIsDrawing()},this.getElement=function(){return r}},a)})),i.register("cQSIC",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("6fRlX")})),i.register("iYbUv",(function(n,r){t(n.exports,"sketchyBrushUi",(function(){return p}));var a,o=i("dAXbp"),s=i("7NTKy"),l=i("gWfkn"),c=i("llzZ0"),u=i("bteky"),h=i("1mH1z"),d=i("eWjiX"),p=(a={image:e(u),tooltip:(0,h.LANG)("brush-sketchy"),sizeSlider:{min:.5,max:10},opacitySlider:{min:.01,max:1},Ui:null},h.languageStrings.subscribe((function(){a.tooltip=(0,h.LANG)("brush-sketchy")})),a.Ui=function(e){var t,n,i=document.createElement("div"),r=new o.brushes.SketchyBrush;r.setHistory(l.klHistory),e.onSizeChange(r.getSize()),function(){t=new(0,c.KlSlider)({label:(0,h.LANG)("brush-size"),width:250,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:2*r.getSize(),eventResMs:s.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){r.setSize(t),e.onSizeChange(t)},formatFunc:function(e){return e<10?d.BB.round(e,1):Math.round(e)},manualInputRoundDigits:1}),n=new(0,c.KlSlider)({label:(0,h.LANG)("opacity"),width:250,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:r.getOpacity(),eventResMs:s.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){r.setOpacity(t),e.onOpacityChange(t)}});var o=new(0,c.KlSlider)({label:(0,h.LANG)("brush-blending"),width:250,height:30,min:0,max:1,value:r.getBlending(),eventResMs:s.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(e){r.setBlending(e)}}),l=new(0,c.KlSlider)({label:(0,h.LANG)("brush-sketchy-scale"),width:250,height:30,min:1,max:20,value:r.getScale(),eventResMs:s.eventResMs,onChange:function(e){r.setScale(e)}});n.getElement().style.marginTop="10px",o.getElement().style.marginTop="10px",l.getElement().style.marginTop="10px",i.appendChild(t.getElement()),i.appendChild(n.getElement()),i.appendChild(o.getElement()),i.appendChild(l.getElement())}(),this.increaseSize=function(e){r.isDrawing()||t.changeSliderValue(e)},this.decreaseSize=function(e){r.isDrawing()||t.changeSliderValue(-e)},this.getSize=function(){return r.getSize()},this.setSize=function(e){!function(e){r.setSize(e)}(e),t.setValue(e)},this.getOpacity=function(){return r.getOpacity()},this.setOpacity=function(e){r.setOpacity(e),n.setValue(e)},this.setColor=function(e){r.setColor(e)},this.setContext=function(e){r.setContext(e)},this.startLine=function(e,t,n){r.startLine(e,t,n)},this.goLine=function(e,t,n){r.goLine(e,t,n,null)},this.endLine=function(){r.endLine()},this.getSeed=function(){return parseInt(r.getSeed())},this.setSeed=function(e){r.setSeed(parseInt(e))},this.getBrush=function(){return r},this.isDrawing=function(){return r.isDrawing()},this.getElement=function(){return i}},a)})),i.register("bteky",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("hC7PC")})),i.register("brjBD",(function(n,r){t(n.exports,"pixelBrushUi",(function(){return f}));var a,o=i("eWjiX"),s=i("dAXbp"),l=i("7NTKy"),c=i("gWfkn"),u=i("lXqiv"),h=i("llzZ0"),d=i("fCJWy"),p=i("4PDnu"),g=i("1mH1z"),f=(a={image:e(p),tooltip:(0,g.LANG)("brush-pixel"),sizeSlider:{min:.5,max:100,curve:o.BB.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1,curve:[[0,.01],[.5,.3],[1,1]]},Ui:null},g.languageStrings.subscribe((function(){a.tooltip=(0,g.LANG)("brush-pixel")})),a.Ui=function(e){var t,n,i=function(e){p.setSize(e),p.setSpacing(y.interpolate(e)/e)},r=document.createElement("div"),p=new s.brushes.PixelBrush;p.setHistory(c.klHistory),e.onSizeChange(p.getSize());var f=new(0,u.Checkbox)({init:p.getLockAlpha(),label:(0,g.LANG)("lock-alpha"),callback:function(e){p.setLockAlpha(e)},doHighlight:!0,title:(0,g.LANG)("lock-alpha-title"),css:{marginRight:"10px"}}),m=new(0,u.Checkbox)({init:p.getIsEraser(),label:(0,g.LANG)("eraser"),callback:function(e){p.setIsEraser(e)},css:{marginRight:"10px"}}),v=new(0,u.Checkbox)({init:p.getUseDither(),label:(0,g.LANG)("brush-pixel-dither"),callback:function(e){p.setUseDither(e)}}),y=new o.BB.SplineInterpolator([[.5,.45],[100,4]]);!function(){t=new(0,h.KlSlider)({label:(0,g.LANG)("brush-size"),width:225,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:p.getSize(),curve:a.sizeSlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){i(t),e.onSizeChange(t)}}),n=new(0,h.KlSlider)({label:(0,g.LANG)("opacity"),width:225,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:a.opacitySlider.max,eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){p.setOpacity(t),e.onOpacityChange(t)}});var s=(0,d.penPressureToggle)(!0,(function(e){p.sizePressure(e)}));r.append(o.BB.el({content:[t.getElement(),s],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),n.getElement());var c=o.BB.el({parent:r,css:{display:"flex",marginTop:"10px"}});c.appendChild(f.getElement()),c.appendChild(m.getElement()),c.appendChild(v.getElement())}(),this.increaseSize=function(e){p.isDrawing()||t.changeSliderValue(e)},this.decreaseSize=function(e){p.isDrawing()||t.changeSliderValue(-e)},this.getSize=function(){return p.getSize()},this.setSize=function(e){i(e),t.setValue(2*e)},this.getOpacity=function(){return p.getOpacity()},this.setOpacity=function(e){p.setOpacity(e),n.setValue(100*e)},this.setColor=function(e){p.setColor(e)},this.setContext=function(e){p.setContext(e)},this.startLine=function(e,t,n){p.startLine(e,t,n)},this.goLine=function(e,t,n){p.goLine(e,t,n)},this.endLine=function(e,t){p.endLine(e,t)},this.getBrush=function(){return p},this.isDrawing=function(){return p.isDrawing()},this.getElement=function(){return r}},a)})),i.register("4PDnu",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("eZgVv")})),i.register("9rc5F",(function(n,r){t(n.exports,"eraserBrushUi",(function(){return f}));var a,o=i("eWjiX"),s=i("dAXbp"),l=i("7NTKy"),c=i("gWfkn"),u=i("llzZ0"),h=i("fCJWy"),d=i("lXqiv"),p=i("984eq"),g=i("1mH1z"),f=(a={image:e(p),tooltip:(0,g.LANG)("eraser")+" [E]",sizeSlider:{min:.5,max:200,curve:o.BB.quadraticSplineInput(.5,200,.1)},opacitySlider:{min:.01,max:1},Ui:null},g.languageStrings.subscribe((function(){a.tooltip=(0,g.LANG)("eraser")+" [E]"})),a.Ui=function(e){var t,n,i=function(e){p.setSize(e)},r=document.createElement("div"),p=new s.brushes.EraserBrush;p.setHistory(c.klHistory),e.onSizeChange(p.getSize());var f=!1;!function(){t=new(0,u.KlSlider)({label:(0,g.LANG)("brush-size"),width:225,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:30,curve:a.sizeSlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){i(t),e.onSizeChange(t)},formatFunc:function(e){return e<10?o.BB.round(e,1):Math.round(e)},manualInputRoundDigits:1}),n=new(0,u.KlSlider)({label:(0,g.LANG)("opacity"),width:225,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:a.opacitySlider.max,eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){p.setOpacity(t),e.onOpacityChange(t)}});var s=(0,h.penPressureToggle)(!0,(function(e){p.sizePressure(e)})),c=(0,h.penPressureToggle)(!1,(function(e){p.opacityPressure(e)}));r.append(o.BB.el({content:[t.getElement(),s],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),o.BB.el({content:[n.getElement(),c],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}));var m=new(0,d.Checkbox)({init:!1,label:(0,g.LANG)("brush-eraser-transparent-bg"),callback:function(e){f=e,p.setTransparentBG(e)},css:{marginTop:"10px"}});r.appendChild(m.getElement())}(),this.increaseSize=function(e){p.isDrawing()||t.changeSliderValue(e)},this.decreaseSize=function(e){p.isDrawing()||t.changeSliderValue(-e)},this.getSize=function(){return p.getSize()},this.setSize=function(e){i(e),t.setValue(e)},this.getOpacity=function(){return p.getOpacity()},this.setOpacity=function(e){p.setOpacity(e),n.setValue(e)},this.setColor=function(e){},this.setContext=function(e){p.setContext(e)},this.startLine=function(e,t,n){p.startLine(e,t,n)},this.goLine=function(e,t,n){p.goLine(e,t,n)},this.endLine=function(){p.endLine()},this.getBrush=function(){return p},this.getIsTransparentBg=function(){return f},this.isDrawing=function(){return p.isDrawing()},this.getElement=function(){return r}},a)})),i.register("984eq",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("fPZin")})),i.register("dS2qM",(function(n,r){t(n.exports,"smudgeBrushUi",(function(){return f}));var a,o=i("eWjiX"),s=i("dAXbp"),l=i("7NTKy"),c=i("gWfkn"),u=i("lXqiv"),h=i("llzZ0"),d=i("fCJWy"),p=i("3QgTy"),g=i("1mH1z"),f=(a={image:e(p),tooltip:(0,g.LANG)("brush-smudge"),sizeSlider:{min:.5,max:100,curve:o.BB.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1,curve:[[0,.01],[.5,.3],[1,1]]},Ui:null},g.languageStrings.subscribe((function(){a.tooltip=(0,g.LANG)("brush-smudge")})),a.Ui=function(e){var t,n,i=function(e){p.setSize(e),p.setSpacing(Math.max(2,m.interpolate(e))/15)},r=document.createElement("div"),p=new s.brushes.SmudgeBrush;p.setHistory(c.klHistory),e.onSizeChange(p.getSize());var f=new(0,u.Checkbox)({init:p.getLockAlpha(),label:(0,g.LANG)("lock-alpha"),callback:function(e){p.setLockAlpha(e)},doHighlight:!0,title:(0,g.LANG)("lock-alpha-title")}),m=new o.BB.SplineInterpolator([[0,15],[8,7],[14,4],[30,3],[50,2.7],[100,2]]);!function(){t=new(0,h.KlSlider)({label:(0,g.LANG)("brush-size"),width:225,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:p.getSize(),curve:a.sizeSlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){i(t),e.onSizeChange(t)},formatFunc:function(e){return e<10?o.BB.round(e,1):Math.round(e)},manualInputRoundDigits:1}),n=new(0,h.KlSlider)({label:(0,g.LANG)("opacity"),width:225,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:p.getOpacity(),curve:a.opacitySlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){p.setOpacity(t),e.onOpacityChange(t)}});var s=(0,d.penPressureToggle)(!1,(function(e){p.sizePressure(e)})),c=(0,d.penPressureToggle)(!1,(function(e){p.opacityPressure(e)}));r.append(o.BB.el({content:[t.getElement(),s],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),o.BB.el({content:[n.getElement(),c],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}})),o.BB.el({parent:r,css:{marginTop:"10px"}}).append(f.getElement())}(),this.increaseSize=function(e){p.getIsDrawing()||t.changeSliderValue(e)},this.decreaseSize=function(e){p.getIsDrawing()||t.changeSliderValue(-e)},this.getSize=function(){return p.getSize()},this.setSize=function(e){i(e),t.setValue(e)},this.getOpacity=function(){return p.getOpacity()},this.setOpacity=function(e){p.setOpacity(e),n.setValue(e)},this.setColor=function(e){p.setColor(e)},this.setContext=function(e){p.setContext(e)},this.startLine=function(e,t,n){p.startLine(e,t,n)},this.goLine=function(e,t,n){p.goLine(e,t,n)},this.endLine=function(e,t){p.endLine()},this.getBrush=function(){return p},this.isDrawing=function(){return p.getIsDrawing()},this.getElement=function(){return r}},a)})),i.register("3QgTy",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("fp7H1")})),i.register("vCnsd",(function(n,r){t(n.exports,"chemyBrushUi",(function(){return m}));var a,o=i("eWjiX"),s=i("7NTKy"),l=i("lXqiv"),c=i("dAXbp"),u=i("gWfkn"),h=i("llzZ0"),d=i("18kre"),p=i("iskOY"),g=i("iDHln"),f=i("1mH1z"),m=(a={image:e(d),tooltip:(0,f.LANG)("brush-chemy"),sizeSlider:{min:.25,max:25,curve:o.BB.quadraticSplineInput(.25,25,.1),isDisabled:!0},opacitySlider:{min:.01,max:1},Ui:null},f.languageStrings.subscribe((function(){a.tooltip=(0,f.LANG)("brush-chemy")})),a.Ui=function(e){var t,n,i=function(e){d.setSize(e)},r=document.createElement("div"),d=new c.brushes.ChemyBrush;d.setHistory(u.klHistory),e.onSizeChange(d.getSize()),function(){t=new(0,h.KlSlider)({label:(0,f.LANG)("brush-size"),width:250,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:d.getSize(),curve:a.sizeSlider.curve,eventResMs:s.eventResMs,isEnabled:"stroke"===d.getMode(),toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){i(t),e.onSizeChange(t)},formatFunc:function(e){return e<5?o.BB.round(e,1):Math.round(e)},manualInputRoundDigits:1}),n=new(0,h.KlSlider)({label:(0,f.LANG)("opacity"),width:250,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:d.getOpacity(),eventResMs:s.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){d.setOpacity(t),e.onOpacityChange(t)}}),o.BB.css(n.getElement(),{marginTop:"10px"});var c=new(0,l.Checkbox)({init:d.getIsEraser(),label:(0,f.LANG)("eraser"),callback:function(e){d.setIsEraser(e)},css:{marginTop:"10px",marginLeft:"10px"}}),u=new(0,l.Checkbox)({init:d.getLockAlpha(),label:(0,f.LANG)("lock-alpha"),callback:function(e){d.setLockAlpha(e)},doHighlight:!0,title:(0,f.LANG)("lock-alpha-title"),css:{marginTop:"10px"}}),m=o.BB.el({css:{display:"flex",marginTop:"10px"}}),v=19,y=new(0,p.Options)({optionArr:[{id:"fill",label:o.BB.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"#000",style:"transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(".concat(v,", ").concat(v,") translate(0.5px, 0.5px)"),d:"M 0,0 C 1.5,0 -0.5,1 1,1"}]}),title:(0,f.LANG)("brush-chemy-fill")},{id:"stroke",label:o.BB.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(".concat(v,", ").concat(v,") translate(0.5px, 0.5px)"),d:"M 0,0 C 1.5,0 -0.5,1 1,1"}]}),title:(0,f.LANG)("brush-chemy-stroke")}],initId:d.getMode(),onChange:function(n){d.setMode(n),a.sizeSlider.isDisabled="fill"===d.getMode(),t.setIsEnabled(!a.sizeSlider.isDisabled);var i=d.getSize();t.setValue(i),e.onSizeChange(i),e.onConfigChange()}}),x=new(0,g.BoxToggle)({label:o.BB.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 1px",d:"M ".concat(17.5,",").concat(8," ").concat(17.5,",").concat(27)}]}),title:(0,f.LANG)("brush-chemy-mirror-x"),init:d.getXSymmetry(),onChange:function(e){d.setXSymmetry(e)}}),b=new(0,g.BoxToggle)({label:o.BB.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 1px",d:"M ".concat(8,",").concat(17.5," ").concat(27,",").concat(17.5)}]}),title:(0,f.LANG)("brush-chemy-mirror-y"),init:d.getYSymmetry(),onChange:function(e){d.setYSymmetry(e)}}),B=new(0,g.BoxToggle)({label:o.BB.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"defs",childrenArr:[{elementType:"linearGradient",id:"gradient",x1:"0",y1:"0",x2:"0",y2:"1",childrenArr:[{elementType:"stop",offset:"0%","stop-color":"rgba(0,0,0,0)"},{elementType:"stop",offset:"100%","stop-color":"rgba(0,0,0,1)"}]}]},{elementType:"rect",fill:"url('#gradient')",x:"8",y:"8",width:"19",height:"19"}]}),title:(0,f.LANG)("brush-chemy-gradient"),init:d.getGradient(),onChange:function(e){d.setGradient(e)}});o.BB.css(x.getElement(),{marginLeft:"10px"});var w={marginLeft:"4px"};o.BB.css(b.getElement(),w),o.BB.css(B.getElement(),w),m.append(y.getElement(),x.getElement(),b.getElement(),B.getElement()),r.append(t.getElement(),n.getElement(),m,o.BB.el({content:[u.getElement(),c.getElement()],css:{display:"flex"}}))}(),this.increaseSize=function(e){d.getIsDrawing()||"stroke"!==d.getMode()||t.changeSliderValue(e)},this.decreaseSize=function(e){d.getIsDrawing()||"stroke"!==d.getMode()||t.changeSliderValue(-e)},this.getSize=function(){return d.getSize()},this.setSize=function(e){i(e),t.setValue(e)},this.getOpacity=function(){return d.getOpacity()},this.setOpacity=function(e){d.setOpacity(e),n.setValue(e)},this.setColor=function(e){d.setColor(e)},this.setContext=function(e){d.setContext(e)},this.startLine=function(e,t,n){d.startLine(e,t)},this.goLine=function(e,t,n,i){d.goLine(e,t)},this.endLine=function(){d.endLine()},this.getBrush=function(){return d},this.isDrawing=function(){return d.getIsDrawing()},this.getElement=function(){return r}},a)})),i.register("18kre",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("eX098")})),i.register("iDHln",(function(e,n){t(e.exports,"BoxToggle",(function(){return s}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("eWjiX"),s=function(){"use strict";function e(t){var n=this;(0,r.default)(this,e),this.value=!!t.init,this.el=o.BB.el({content:t.label,title:t.title,className:"string"==typeof t.label?"kl-box-toggle":"kl-box-toggle kl-box-toggle--custom-el",onClick:function(){n.value=!n.value,n.update(),t.onChange(n.value)},css:{cursor:"pointer"}}),"string"!=typeof t.label&&o.BB.css(t.label,{display:"block",pointerEvents:"none"}),this.update()}return(0,a.default)(e,[{key:"update",value:function(){this.el.classList.toggle("kl-box-toggle--active",this.value)}},{key:"getValue",value:function(){return this.value}},{key:"setValue",value:function(e){this.value=!!e,this.update()}},{key:"getElement",value:function(){return this.el}},{key:"destroy",value:function(){o.BB.destroyEl(this.el)}}]),e}()})),i.register("5ebUJ",(function(e,n){t(e.exports,"showIframePopup",(function(){return s}));var r=i("eWjiX"),a=i("ekHRj"),o=i("1mH1z");function s(e,t){if(t||!(window.innerHeight<500||window.innerWidth<700)){var n,i=r.BB.el({tagName:"iframe",custom:{src:e},css:{width:"100%",height:"100%"}}),s=r.BB.el({});t||(n=r.BB.el({tagName:"a",parent:s,content:(0,o.LANG)("modal-new-tab"),custom:{href:"help",target:"_blank"},onClick:function(){l.close()}}),i.onload=function(){r.BB.setAttributes(n,{href:""+i.contentWindow.location})});var l=new(0,a.Popup)({title:s,content:i,width:880,isMaxHeight:!0,onClose:function(){n&&r.BB.destroyEl(n)}})}else window.open(e)}})),i.register("bHZQg",(function(e,n){t(e.exports,"RadioList",(function(){return l}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("7U0Ew"),s=i("eWjiX"),l=function(){"use strict";function e(t){var n=t.name,i=t.init,a=t.items,l=t.ignoreFocus,c=this;(0,r.default)(this,e),(0,o.default)(this,"inputs",[]),this.el=s.BB.el({className:"kl-radio"}),a.forEach((function(e){var t=s.BB.el({tagName:"label"}),r=s.BB.el({tagName:"input",parent:t,custom:{name:n,value:e.value,type:"radio"}});l&&r.setAttribute("data-ignore-focus","true"),i===e.value&&(r.checked=!0),t.append(e.label),c.el.append(t),c.inputs.push(r)}))}return(0,a.default)(e,[{key:"getValue",value:function(){for(var e=0;e<this.inputs.length;e++)if(this.inputs[e].checked)return this.inputs[e].value;return null}},{key:"getElement",value:function(){return this.el}}]),e}()})),i.register("9pcu9",(function(n,r){t(n.exports,"BrowserStorageUi",(function(){return g}));var a=i("3kC7t"),o=i("gFgFC"),s=i("kiQ5H"),l=i("cijLd"),c=i("eWjiX"),u=i("8yL1I"),h=i("5ebUJ"),d=i("hrnUX"),p=i("1mH1z"),g=function(){"use strict";function t(n,i,r,s,d){var g,f=this;(0,o.default)(this,t),this.projectStore=n,this.getProject=i,this.saveReminder=r,this.klRootEl=s,this.options=d,this.element=c.BB.el({css:{display:"grid",gridTemplateColumns:"1fr 0fr",gridTemplateRows:"0fr 0fr 0fr",gap:"0 0",gridTemplateAreas:'"title title" "preview store" "preview clear"'}});var m=c.BB.el({parent:this.element,content:(0,p.LANG)("file-storage"),css:{gridArea:"title",display:"flex",margin:"-5px 0"}});if(this.infoEl=c.BB.el({parent:m,content:"?",title:(0,p.LANG)("file-storage-about"),css:{cursor:"pointer",marginLeft:"5px",width:"19px",height:"19px",borderRadius:"100%",textAlign:"center",lineHeight:"19px",fontWeight:"bold",boxShadow:"inset 0 0 0 1px #000"},onClick:function(){(0,h.showIframePopup)("./help/#help-browser-storage",!1)}}),this.projectStore.isBroken())c.BB.el({parent:this.element,content:"🔴 "+(0,p.LANG)("file-storage-cant-access"),css:{marginTop:"10px"}});else{this.previewEl=c.BB.el({parent:this.element,title:(0,p.LANG)("file-storage-thumb-title"),css:{gridArea:"preview",display:"flex",alignItems:"center",justifyContent:"center",marginTop:"10px",position:"relative",boxShadow:"inset 0 0 0 1px #aaa",background:"#cdcdcd",color:"#545454",colorScheme:"only light",minHeight:"67px"}}),this.ageEl=c.BB.el({css:{position:"absolute",right:"0",bottom:"0",width:"100%",textAlign:"center",background:"rgba(0,0,0,0.7)",color:"#fff",textSize:"13px"}});var v=(null==d?void 0:d.isFocusable)?{}:{tabIndex:-1};this.storeButtonEl=c.BB.el({parent:this.element,tagName:"button",className:"gridButton",content:(0,p.LANG)("file-storage-store"),css:{gridArea:"store"},custom:v,onClick:function(){return f.store()}}),this.clearButtonEl=c.BB.el({parent:this.element,tagName:"button",className:"gridButton",content:'<img src="'+e(u)+'" height="20"/> '+(0,p.LANG)("file-storage-clear"),css:{gridArea:"clear"},custom:v,onClick:function(){return f.clear()}}),(null===(g=this.options)||void 0===g?void 0:g.hideClearButton)&&(this.clearButtonEl.style.visibility="hidden"),this.storeListener={onUpdate:function(e,t){f.updateThumb(e,t)}},this.projectStore.subscribe(this.storeListener),setInterval((function(){return f.updateAge()}),6e4);var y=this;(0,a.default)(e(l).mark((function t(){var n;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.projectStore.read();case 3:(n=e.sent)?y.updateThumb(n.timestamp,n.thumbnail):y.updateThumb(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),setTimeout((function(){throw new Error("storage-ui: failed initial read browser storage, "+e.t0)}),0);case 10:case"end":return e.stop()}}),t,null,[[0,7]])})))()}}return(0,s.default)(t,[{key:"updateAge",value:function(){if(this.timestamp){var e,t=(new Date).getTime()-this.timestamp;t=Math.floor(t/1e3/60),e=(0,p.LANG)("file-storage-min-ago").replace("{x}",""+t),t>60&&(t=Math.floor(t/60),e=(0,p.LANG)("file-storage-hours-ago").replace("{x}",""+t),t>24&&(t=Math.floor(t/24),e=(0,p.LANG)("file-storage-days-ago").replace("{x}",""+t),t>31&&(e=(0,p.LANG)("file-storage-month-ago")))),this.ageEl.textContent=e}}},{key:"resetButtons",value:function(){this.timestamp?(this.storeButtonEl.textContent=(0,p.LANG)("file-storage-overwrite"),this.storeButtonEl.disabled=!1,this.clearButtonEl.disabled=!1):(this.storeButtonEl.textContent=(0,p.LANG)("file-storage-store"),this.storeButtonEl.disabled=!1,this.clearButtonEl.disabled=!0)}},{key:"updateThumb",value:function(e,t){this.timestamp=e,this.timestamp?(c.BB.css(t,{display:"block",maxWidth:"calc(100% - 2px)",maxHeight:"calc(100% - 2px)",margin:"0 auto",background:"url('"+c.BB.createCheckerCanvas(4).toDataURL("image/png")+"')",boxShadow:"0 0 0 1px #aaa",pointerEvents:"none"}),this.previewEl.innerHTML="",this.updateAge(),this.previewEl.append(t,this.ageEl)):this.previewEl.innerHTML=(0,p.LANG)("file-storage-empty"),this.resetButtons()}},{key:"store",value:function(){var t=this;return(0,a.default)(e(l).mark((function n(){return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storeButtonEl.textContent=(0,p.LANG)("file-storage-storing"),t.storeButtonEl.disabled=!0,t.clearButtonEl.disabled=!0,e.next=5,new Promise((function(e){setTimeout((function(){return e(null)}),20)}));case 5:return e.prev=5,e.next=8,t.projectStore.store(t.getProject());case 8:t.saveReminder.reset(),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(5),t.resetButtons(),d.KL.popup({target:t.klRootEl,type:"error",message:["".concat((0,p.LANG)("file-storage-failed-1"),"<ul>"),"<li>".concat((0,p.LANG)("file-storage-failed-2"),"</li>"),"<li>".concat((0,p.LANG)("file-storage-failed-3"),"</li>"),"<li>".concat((0,p.LANG)("file-storage-failed-4"),"</li>"),"</ul>"].join(""),buttons:["Ok"]}),setTimeout((function(){throw new Error("storage-ui: failed to store browser storage, "+e.t0)}),0);case 16:case"end":return e.stop()}}),n,null,[[5,11]])})))()}},{key:"clear",value:function(){var t=this;return(0,a.default)(e(l).mark((function n(){return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storeButtonEl.disabled=!0,t.clearButtonEl.disabled=!0,e.prev=2,e.next=5,t.projectStore.clear();case 5:e.next=12;break;case 7:e.prev=7,e.t0=e.catch(2),t.resetButtons(),d.KL.popup({target:t.klRootEl,type:"error",message:(0,p.LANG)("file-storage-failed-clear"),buttons:["Ok"]}),setTimeout((function(){throw new Error("storage-ui: failed to clear browser storage, "+e.t0)}),0);case 12:case"end":return e.stop()}}),n,null,[[2,7]])})))()}},{key:"getElement",value:function(){return this.element}},{key:"show",value:function(){}},{key:"hide",value:function(){}},{key:"destroy",value:function(){c.BB.destroyEl(this.infoEl),c.BB.destroyEl(this.storeButtonEl),c.BB.destroyEl(this.clearButtonEl),this.projectStore.unsubscribe(this.storeListener)}}]),t}()})),i.register("6mTnI",(function(n,r){t(n.exports,"ProjectStore",(function(){return g}));var a=i("3kC7t"),o=i("gFgFC"),s=i("kiQ5H"),l=i("7U0Ew"),c=i("cijLd"),u=i("3hwQ7"),h=i("9BlwZ"),d=i("6l0gQ");function p(e){return new Promise((function(t,n){e(t,n)}))}var g=function(){"use strict";function t(){var n=this;(0,o.default)(this,t),(0,l.default)(this,"listeners",[]),(0,l.default)(this,"accessHasFailed",!1),window.addEventListener("storage",(function(t){if("indexedDbUpdatedAt"===t.key&&0!==n.listeners.length)try{var i=n;(0,a.default)(e(c).mark((function t(){var n;return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.read();case 2:(n=e.sent)?i.emit(n.timestamp,n.thumbnail):i.emit();case 4:case"end":return e.stop()}}),t)})))()}catch(e){0===e.message.indexOf("db-error")&&(n.accessHasFailed=!0)}}))}return(0,s.default)(t,[{key:"lowLevelStore",value:function(t){return(0,a.default)(e(c).mark((function n(){return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){(0,h.storeKlProjectObj)(t,e,n)}));case 2:case"end":return e.stop()}}),n)})))()}},{key:"lowLevelRead",value:function(){return(0,a.default)(e(c).mark((function t(){return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(h.getKlProjectObj);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),t)})))()}},{key:"lowLevelClear",value:function(){return(0,a.default)(e(c).mark((function t(){return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(h.clear);case 2:case"end":return e.stop()}}),t)})))()}},{key:"emit",value:function(e,t){this.listeners.forEach((function(n){n.onUpdate(e,t)}))}},{key:"updateTimestamp",value:function(){d.LocalStorage.setItem("indexedDbUpdatedAt",""+(new Date).getTime())}},{key:"read",value:function(){var t=this;return(0,a.default)(e(c).mark((function n(){var i,r;return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,t.lowLevelRead();case 4:i=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),t.accessHasFailed=!0,new Error("db-error: "+e.t0);case 11:if(i){e.next=13;break}return e.abrupt("return",null);case 13:return e.prev=14,e.next=17,u.ProjectConverter.readStorageProject(i);case 17:r=e.sent,e.next=23;break;case 20:throw e.prev=20,e.t1=e.catch(14),new Error("format-error: "+e.t1);case 23:return e.abrupt("return",r);case 24:case"end":return e.stop()}}),n,null,[[1,7],[14,20]])})))()}},{key:"store",value:function(t){var n=this;return(0,a.default)(e(c).mark((function i(){var r,a,o;return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=u.ProjectConverter.createStorageProject(t),e.next=4,n.lowLevelStore(r);case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),n.accessHasFailed=!0,new Error("db-error: "+e.t0);case 10:return e.next=12,n.lowLevelRead();case 12:return a=e.sent,o=null,e.prev=14,e.next=17,u.ProjectConverter.readStorageProject(a);case 17:o=e.sent,e.next=27;break;case 20:return e.prev=20,e.t1=e.catch(14),e.next=24,n.lowLevelClear();case 24:throw n.updateTimestamp(),setTimeout((function(){return n.emit()}),0),new Error("format-error: "+e.t1);case 27:n.updateTimestamp(),setTimeout((function(){return n.emit(o.timestamp,o.thumbnail)}),0);case 29:case"end":return e.stop()}}),i,null,[[0,6],[14,20]])})))()}},{key:"clear",value:function(){var t=this;return(0,a.default)(e(c).mark((function n(){return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.lowLevelClear();case 2:t.updateTimestamp(),setTimeout((function(){return t.emit()}),0);case 4:case"end":return e.stop()}}),n)})))()}},{key:"subscribe",value:function(e){this.listeners.includes(e)||this.listeners.push(e)}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.listeners.length;t++)if(e===this.listeners[t])return void this.listeners.splice(t,1)}},{key:"isBroken",value:function(){return this.accessHasFailed}}]),t}()})),i.register("3hwQ7",(function(n,r){t(n.exports,"ProjectConverter",(function(){return p}));var a=i("3kC7t"),o=i("gFgFC"),s=i("kiQ5H"),l=i("cijLd"),c=i("eWjiX"),u=i("aSJRf"),h=i("2wCWz");function d(e){return new Promise((function(t,n){var i=new Image;try{i.src=c.BB.imageBlobToUrl(e)}catch(e){return void n("imageBlobToUrl, "+e.message)}i.onload=function(){URL.revokeObjectURL(i.src),t(i)},i.onabort=function(){n("layer image failed loading")},i.onerror=function(){n("layer image failed loading")}}))}var p=function(){"use strict";function t(){(0,o.default)(this,t)}return(0,s.default)(t,null,[{key:"createThumbnail",value:function(e){var t=c.BB.fitInto(e.width,e.height,240,240).width/e.width;return(0,u.drawProject)(e,t)}},{key:"createStorageProject",value:function(e){return{id:1,timestamp:(new Date).getTime(),thumbnail:(0,h.base64ToBlob)(t.createThumbnail(e).toDataURL("image/png")),width:e.width,height:e.height,layers:e.layers.map((function(e){var t;if(!(e.image instanceof HTMLCanvasElement))throw new Error("Not implemented");return t=(0,h.base64ToBlob)(e.image.toDataURL("image/png")),{name:e.name,opacity:e.opacity,mixModeStr:e.mixModeStr,blob:t}}))}}},{key:"readStorageProject",value:function(n){return(0,a.default)(e(l).mark((function i(){var r,a;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!n.width||!n.height||isNaN(n.width)||isNaN(n.height)||n.width<1||n.height<1)){e.next=2;break}throw new Error("readStorageProject invalid canvas size: "+n.width+", "+n.height);case 2:return e.t0=n.width,e.t1=n.height,e.next=6,Promise.all(n.layers.map((function(e){return d(e.blob)})));case 6:if(e.t2=e.sent.map((function(e,t){return{name:n.layers[t].name,opacity:n.layers[t].opacity,mixModeStr:n.layers[t].mixModeStr,image:e}})),r={width:e.t0,height:e.t1,layers:e.t2},!n.thumbnail){e.next=15;break}return e.next=12,d(n.thumbnail);case 12:a=e.sent,e.next=16;break;case 15:a=t.createThumbnail(r);case 16:return e.abrupt("return",{project:r,timestamp:n.timestamp,thumbnail:a});case 17:case"end":return e.stop()}}),i)})))()}}]),t}()})),i.register("2wCWz",(function(e,n){function i(e){for(var t=e.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/),n=atob(t[3]),i=new ArrayBuffer(n.length),r=new Uint8Array(i),a=0;a<r.length;a++)r[a]=n.charCodeAt(a);return new Blob([r],{type:t[1]})}t(e.exports,"base64ToBlob",(function(){return i}))})),i.register("eK8ID",(function(n,r){t(n.exports,"FileTab",(function(){return v}));var a=i("gFgFC"),o=i("kiQ5H"),s=i("eWjiX"),l=i("hrnUX"),c=i("1gUFn"),u=i("lLh5u"),h=i("5xpQb"),d=i("4xKQD"),p=i("gswMe"),g=i("fcsnL"),f=i("9pcu9"),m=i("1mH1z"),v=function(){"use strict";function t(n,i,r,o,v,y,x,b,B,w,C,S){var k=this;(0,a.default)(this,t),this.exportType=o;var L=this;this.div=document.createElement("div");setTimeout((function(){var t=function(){var e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div");return e.appendChild(t),e.appendChild(n),s.BB.css(t,{clear:"both"}),s.BB.css(n,{marginLeft:"10px",marginRight:"10px",marginTop:"10px",borderBottom:"1px solid rgba(0,0,0,0.2)",clear:"both"}),e},a=document.createElement("div"),M=document.createElement("button"),E=document.createElement("button"),A=document.createElement("button"),T=document.createElement("button"),I=document.createElement("button");M.style.cssFloat="left",s.BB.css(E,{cssFloat:"left",clear:"both"}),s.BB.css(I,{cssFloat:"left",clear:"both"}),M.tabIndex=-1,E.tabIndex=-1,A.tabIndex=-1,T.tabIndex=-1,I.tabIndex=-1,M.innerHTML="<img src='".concat(e(c),"' alt='icon' height='20'/>").concat((0,m.LANG)("file-new")),E.innerHTML="<img src='".concat(e(u),"' alt='icon' height='20'/>").concat((0,m.LANG)("file-save")),A.innerHTML="<img src='".concat(e(h),"' alt='icon' height='20'/>").concat((0,m.LANG)("file-share")),T.innerHTML="<img style='float:left' src='".concat(e(d),"' height='20' alt='icon'/>").concat((0,m.LANG)("file-upload")),I.innerHTML="<img src='".concat(e(g),"' alt='icon' height='20'/>").concat((0,m.LANG)("file-copy")),I.title=(0,m.LANG)("file-copy-title"),M.className="gridButton",E.className="gridButton",A.className="gridButton",T.className="gridButton",I.className="gridButton",k.importButton=document.createElement("input"),k.importButton.tabIndex=-1,k.importButton.type="file",k.importButton.multiple=!0,k.importButton.accept="image",k.importButton.size="71",k.importButton.textContent="Import";var R,P,O=k.importButton;!function(){(O=document.createElement("div")).className="gridButton",O.style.position="relative",O.style.cursor="pointer",O.style.cssFloat="left";var t=document.createElement("div");t.style.width="120px",t.style.height="28px",t.style.overflow="hidden",t.style.cursor="pointer",t.style.position="relative",O.appendChild(t),t.appendChild(L.importButton);var n=document.createElement("button");n.innerHTML="<img style='float:left' height='20' src='"+e(p)+"' alt='icon'/>"+(0,m.LANG)("file-import"),n.tabIndex=-1,s.BB.css(n,{width:"120px",display:"box",position:"absolute",left:"0",top:"0",cursor:"pointer"}),s.BB.css(L.importButton,{display:"none"}),O.appendChild(n),n.onclick=function(){L.importButton.click()}}(),k.importButton.onchange=function(e){y(L.importButton.files,"default"),L.importButton.value=""},R=s.BB.el({css:{fontSize:"15px",marginLeft:"10px",marginTop:"10px",cssFloat:"left",width:"calc(50% - 15px)",height:"30px"}}),P=new l.KL.Select({optionArr:[["png",(0,m.LANG)("file-save-png")],["psd",(0,m.LANG)("file-save-psd")],["layers",(0,m.LANG)("file-save-layers")]],initValue:o,onChange:function(e){v(o=e),x()}}),s.BB.css(P.getElement(),{width:"120px",height:"30px"}),R.appendChild(P.getElement()),M.onclick=b,E.onclick=function(){x()},A.onclick=function(){A.disabled=!0,B((function(){A.disabled=!1}))},T.onclick=function(){w()},I.onclick=function(){I.blur(),C()};var D=document.createElement("div");D.textContent="⚠️ "+(0,m.LANG)("file-no-autosave"),s.BB.css(D,{textAlign:"center",marginTop:"10px",background:"rgb(243, 243, 161)",padding:"5px 0px",color:"rgba(0,0,0,0.65)",fontSize:"15px"}),L.fileBrowserStorage=new(0,f.BrowserStorageUi)(i,r,S,n),s.BB.css(L.fileBrowserStorage.getElement(),{margin:"10px"}),s.BB.append(a,[D,M,O,s.BB.el({css:{clear:"both"}}),E,R,s.BB.el({css:{clear:"both"}}),I,s.BB.canShareFiles()?A:null,s.BB.el({css:{clear:"both"}}),t(),L.fileBrowserStorage.getElement(),t(),T]),k.div.appendChild(a)}),1)}return(0,o.default)(t,[{key:"refresh",value:function(){}},{key:"getElement",value:function(){return this.div}},{key:"setIsVisible",value:function(e){e&&this.refresh()}},{key:"triggerImport",value:function(){this.importButton.click()}}]),t}()})),i.register("4xKQD",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("2oHM2")})),i.register("2umOB",(function(e,n){t(e.exports,"FilterTab",(function(){return u}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("eWjiX"),s=i("hrnUX"),l=i("gWfkn"),c=i("1mH1z"),u=function(){"use strict";function e(t,n,i,a,o,s,l,c,u,h,d){(0,r.default)(this,e),this.klRootEl=t,this.klColorSlider=n,this.layerManager=i,this.klCanvasWorkspace=a,this.handUi=o,this.getCurrentColor=s,this.getKlMaxCanvasSize=l,this.getKlCanvas=c,this.getCurrentLayerCtx=u,this.isEmbed=h,this.statusOverlay=d,this.isInit=!1,this.div=document.createElement("div")}return(0,a.default)(e,[{key:"init",value:function(){var e=function(e,t){var i=document.createElement("button"),a=(0,c.LANG)(t[e].lang.button),u='<img height="20" width="18" src="'+t[e].icon+'" alt="icon" />';i.innerHTML=u+a,i.className="gridButton",o.BB.css(i,{lineHeight:"20px",fontSize:"12px"}),i.tabIndex=-1;var h=(0,c.LANG)(t[e].lang.name);return i.onclick=function(){if("apply"in t[e])if(t[e].isInstant)i.blur(),d(null),n.statusOverlay.out('"'+h+'" '+(0,c.LANG)("filter-applied"),!0);else{var r,a=n.klColorSlider.getSecondaryRGB(),o=t[e].getDialog({context:n.getCurrentLayerCtx(),klCanvas:n.getKlCanvas(),maxWidth:n.getKlMaxCanvasSize(),maxHeight:n.getKlMaxCanvasSize(),currentColorRgb:{r:n.getCurrentColor().r,g:n.getCurrentColor().g,b:n.getCurrentColor().b},secondaryColorRgb:{r:a.r,g:a.g,b:a.b}});if(!o)return;o.errorCallback=function(e){setTimeout((function(){throw alert("Error: could not perform action"),e}),0),r()};var u={};"width"in o&&(u.width=o.width+"px"),s.KL.popup({target:n.klRootEl,message:"<b>"+h+"</b>",div:o.element,style:u,buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(e){!function(e,t){if("Cancel"!=e){var n;try{n=t.getInput()}catch(e){throw-1!==e.message.indexOf(".getInput is not a function")?"filterDialog.getInput is not a function, filter: "+h:e}d(n)}else t.destroy&&t.destroy()}(e,o)},closefunc:function(e){r=e}})}else alert("Application not fully loaded");function d(i){!1===t[e].apply({context:n.getCurrentLayerCtx(),klCanvas:n.getKlCanvas(),history:l.klHistory,input:i})&&alert("Couldn't apply the edit action"),!0===t[e].updatePos&&(n.klCanvasWorkspace.resetView(),n.handUi.update(n.klCanvasWorkspace.getScale(),n.klCanvasWorkspace.getAngleDeg())),n.layerManager.update()}},r[r.length]=i,i},t=function(t,i,r){for(var a in i)!i.hasOwnProperty[a]&&t.includes(a)&&(n.isEmbed&&!i[a].inEmbed||r.appendChild(e(a,i)))},n=this,i=s.KL.filterLib,r=[];if(o.BB.BbLog.emit({type:"init-filters"}),!s.KL.filterLibStatus.isLoaded)throw new Error("filters not loaded");t(["cropExtend","flip","perspective","resize","rotate","transform"],i,n.div),n.div.appendChild(o.BB.el({className:"gridHr"})),t(["brightnessContrast","curves","distort","hueSaturation","invert","tiltShift","toAlpha","blur","unsharpMask"],i,n.div),n.div.appendChild(o.BB.el({className:"gridHr"})),t(["grid","noise","pattern","vanishPoint"],i,n.div),this.isInit=!0}},{key:"getElement",value:function(){return this.div}},{key:"show",value:function(){this.isInit||this.init(),this.div.style.display="block"}},{key:"hide",value:function(){this.div.style.display="none"}}]),e}()})),i.register("5ENro",(function(n,r){t(n.exports,"imgurUpload",(function(){return g}));var a=i("3kC7t"),o=i("cijLd"),s=i("eWjiX"),l=i("hrnUX"),c=i("j8sUl"),u=i("2wCWz"),h=i("1mH1z");function d(e,t,n,i,r){return p.apply(this,arguments)}function p(){return(p=(0,a.default)(e(o).mark((function t(n,i,r,a,l){var d,p,g,f,m,v,y,x;return e(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return d=(0,u.base64ToBlob)(n.toDataURL("image/"+a)),p=window.open(),g=p.document.createElement("div"),(f=p.document.createElement("img")).src=e(c),g.appendChild(f),s.BB.css(f,{filter:"invert(1)"}),p.document.body.style.backgroundColor="#121211",p.document.body.style.backgroundImage="linear-gradient(#2b2b2b 0%, #121211 50%)",p.document.body.style.backgroundRepeat="no-repeat",(m=p.document.createElement("div")).style.marginTop="10px",g.appendChild(m),m.textContent=(0,h.LANG)("upload-uploading"),p.document.body.appendChild(g),s.BB.css(g,{marginLeft:"auto",marginRight:"auto",marginTop:"100px",fontFamily:"Arial, sans-serif",fontSize:"20px",textAlign:"center",transition:"opacity 0.3s ease-in-out",opacity:"0",color:"#ccc"}),setTimeout((function(){g.style.opacity="1"}),20),t.prev=18,(y=new FormData).append("title",i),y.append("description",r),y.append("image",d),t.next=25,fetch("https://api.imgur.com/3/image",{method:"POST",headers:{Authorization:"Client-ID "+l},body:y});case 25:v=t.sent,t.next=32;break;case 28:throw t.prev=28,t.t0=t.catch(18),p.close(),new Error(t.t0);case 32:if(v.ok){t.next=35;break}throw p.close(),new Error;case 35:return t.next=37,v.json();case 37:return x=t.sent.data,p.location.href=x.link.replace(/\.(jpg|png)/,""),t.abrupt("return",x);case 40:case"end":return t.stop()}}),t,null,[[18,28]])})))).apply(this,arguments)}function g(t,n,i,r){if(!r)throw new Error("imgur key missing");var c=document.createElement("input");c.type="text",c.value=(0,h.LANG)("upload-title-untitled");var u=s.BB.el({tagName:"textarea",custom:{rows:2},css:{width:"100%",maxWidth:"100%"}}),p=document.createElement("div");p.textContent=(0,h.LANG)("upload-name")+":";var g=s.BB.el({content:(0,h.LANG)("upload-caption")+":",css:{marginTop:"10px"}}),f=document.createElement("div");f.innerHTML='<br/><a href="https://imgur.com/tos" target="_blank" rel="noopener noreferrer">'.concat((0,h.LANG)("upload-tos"),"</a> ").concat((0,h.LANG)("upload-tos-2"));var m=new l.KL.RadioList({name:"filetype",init:"jpeg",items:[{label:"JPG",value:"jpeg"},{label:"PNG",value:"png"}],ignoreFocus:!0});s.BB.css(m.getElement(),{marginBottom:"10px"});var v,y=document.createElement("div"),x=document.createElement("div");x.className="info-hint",x.textContent=(0,h.LANG)("upload-link-notice"),y.append(x,m.getElement(),p,c,g,u,f),l.KL.popup({target:n,message:"<b>".concat((0,h.LANG)("upload-title"),"</b>"),type:"upload",div:y,buttons:[(0,h.LANG)("upload-submit"),"Cancel"],clickOnEnter:(0,h.LANG)("upload-submit"),primaries:[(0,h.LANG)("upload-submit")],autoFocus:(0,h.LANG)("upload-submit"),callback:(v=(0,a.default)(e(o).mark((function a(s){var p;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s!==(0,h.LANG)("upload-submit")&&"Yes"!==s&&"Ok"!==s){e.next=12;break}return e.prev=1,e.next=4,d(t.getCompleteCanvas(1),c.value,u.value,m.getValue(),r);case 4:p=e.sent,l.KL.popup({target:n,type:"ok",message:"<h3>".concat((0,h.LANG)("upload-success"),"</h3><br>").concat((0,h.LANG)("upload-delete"),"<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/").concat(p.deletehash,"'>imgur.com/delete/").concat(p.deletehash,"</a><br><br>"),buttons:["Ok"]}),i.reset(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),l.KL.popup({target:n,type:"error",message:(0,h.LANG)("upload-failed"),buttons:["Ok"]});case 12:case"end":return e.stop()}}),a,null,[[1,9]])}))),function(e){return v.apply(this,arguments)})})}})),i.register("j8sUl",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("iGeXe")})),i.register("lkluh",(function(n,r){t(n.exports,"loadAgPsd",(function(){return c}));var a,o=i("3kC7t"),s=i("cijLd"),l=i("eWjiX");function c(){return u.apply(this,arguments)}function u(){return(u=(0,o.default)(e(s).mark((function t(){return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=5;break}return e.next=3,i("bxnoy");case 3:a=e.sent,l.BB.BbLog.emit({type:"loaded-agpsd"});case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),t)})))).apply(this,arguments)}})),i.register("bxnoy",(function(e,t){e.exports=i("ih7W4")(i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("kNYzr")).then((function(){return i("2m2jt")}))})),i.register("5ngYX",(function(e,n){t(e.exports,"SaveReminder",(function(){return u}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("hrnUX"),s=i("eWjiX"),l=i("1mH1z"),c=i("9pcu9"),u=function(){"use strict";function e(t,n,i,a,o,s,l){var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"Klecks";(0,r.default)(this,e),this.history=t,this.showReminder=n,this.changeTitle=i,this.onSaveAsPsd=a,this.isDrawing=o,this.projectStore=s,this.getProject=l,this.title=c,this.lastSavedActionNumber=null}return(0,a.default)(e,[{key:"showPopup",value:function(){var e=this;if(!this.projectStore||!this.getProject)throw new Error("projectStore and getProject need to be set");var t=Math.round((performance.now()-this.lastSavedAt)/1e3/60),n=s.BB.el({});n.append(s.BB.el({content:(0,l.LANG)("save-reminder-text",{a:"<strong>"+t,b:"</strong>"}),css:{marginBottom:"20px"}}));var i=s.BB.el({css:{borderTop:"1px solid #aaa",margin:"0 -20px",padding:"20px"}}),r=s.BB.el({css:{borderTop:"1px solid #aaa",margin:"0 -20px",padding:"20px",paddingBottom:"0"}});n.append(i,r);var a=s.BB.el({tagName:"button",className:"kl-button",content:(0,l.LANG)("save-reminder-save-psd"),onClick:function(){return e.onSaveAsPsd()}});i.append(a,s.BB.el({content:(0,l.LANG)("save-reminder-psd-layers"),css:{marginTop:"10px"}}));var u=new(0,c.BrowserStorageUi)(this.projectStore,this.getProject,this,document.body,{hideClearButton:!0,isFocusable:!0});r.append(u.getElement()),o.KL.popup({target:document.body,message:"<b>".concat((0,l.LANG)("save-reminder-title"),"</b>"),div:n,ignoreBackground:!0,callback:function(){u.destroy(),s.BB.destroyEl(a),e.closeFunc=null,e.lastReminderShownAt=performance.now()},closefunc:function(t){e.closeFunc=t}}),setTimeout((function(){a.focus()}),40)}},{key:"init",value:function(){var e=this,t=function(e){e.preventDefault(),e.returnValue=""};null===this.lastSavedActionNumber&&(this.lastSavedActionNumber=this.history.getActionNumber(),this.lastReminderShownAt=performance.now(),this.lastSavedAt=performance.now(),this.showReminder&&setInterval((function(){if("visible"===document.visibilityState){var t=Math.abs(e.history.getActionNumber()-e.lastSavedActionNumber);0===o.KL.dialogCounter.get()&&!e.isDrawing()&&e.lastReminderShownAt+12e5<performance.now()&&t>=100&&e.showPopup()}}),5e3),this.history.addListener((function(){var n=e.history.getActionNumber();e.lastSavedActionNumber!==n?s.BB.setEventListener(window,"onbeforeunload",t):s.BB.setEventListener(window,"onbeforeunload",null)})),this.changeTitle&&document.addEventListener("visibilitychange",(function(){if("visible"===document.visibilityState)document.title=e.title,clearInterval(e.unsavedInterval);else{var t=e.history.getActionNumber();if(e.lastSavedActionNumber!==t){document.title=(0,l.LANG)("unsaved")+" - "+e.title;var n=0;e.unsavedInterval=setInterval((function(){n=(n+1)%2,document.title=1===n?(0,l.LANG)("unsaved")+" · "+e.title:(0,l.LANG)("unsaved")+" - "+e.title}),18e4)}}})))}},{key:"reset",value:function(){null!==this.lastSavedActionNumber&&(this.lastSavedActionNumber=this.history.getActionNumber(),this.lastReminderShownAt=performance.now(),this.lastSavedAt=performance.now(),s.BB.setEventListener(window,"onbeforeunload",null),this.closeFunc&&this.closeFunc())}}]),e}()})),i.register("eyygR",(function(e,n){t(e.exports,"SaveToComputer",(function(){return c}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("eWjiX"),s=i("hrnUX"),l=i("98ax7"),c=function(){"use strict";function e(t,n,i,a,o){(0,r.default)(this,e),this.saveReminder=t,this.klRootEl=n,this.getExportType=i,this.getKlCanvas=a,this.filenameBase=o}return(0,a.default)(e,[{key:"save",value:function(e){var t=this,n=function(e,t,n){for(var i=e.toDataURL(n).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/),r=atob(i[3]),a=new ArrayBuffer(r.length),o=new Uint8Array(a),s=0;s<o.length;s++)o[s]=r.charCodeAt(s);var c=new Blob([o],{type:i[1]});(0,l.saveAs)(c,t)},i=this;if(i.saveReminder.reset(),e||(e=i.getExportType()),"png"===e){var r="image/png",a=o.BB.getDate()+this.filenameBase+".png",c=i.getKlCanvas().getCompleteCanvas(1);try{n(c,a,r)}catch(e){var u=new Image;u.width=i.getKlCanvas().getWidth(),u.height=i.getKlCanvas().getHeight(),u.src=c.toDataURL(r),s.KL.exportDialog(i.klRootEl,u)}}else if("layers"===e)for(var h=o.BB.getDate()+this.filenameBase,d=i.getKlCanvas().getLayersFast(),p=0;p<d.length;p++){var g=d[p],f=[h,"_",(""+(p+1)).padStart(2,"0"),"_",g.name,".","png"];n(g.canvas,f.join(""),"image/png")}else if("psd"===e){for(var m=i.getKlCanvas().getLayersFast(),v={width:i.getKlCanvas().getWidth(),height:i.getKlCanvas().getHeight(),children:[],canvas:i.getKlCanvas().getCompleteCanvas(1)},y=0;y<m.length;y++){var x=m[y];v.children.push({name:x.name,opacity:x.opacity,canvas:x.canvas,blendMode:s.KL.PSD.blendKlToPsd(x.mixModeStr),left:0,top:0})}s.KL.loadAgPsd().then((function(e){var n=e.writePsdBuffer(v),i=new Blob([n],{type:"application/octet-stream"});(0,l.saveAs)(i,o.BB.getDate()+t.filenameBase+".psd")})).catch((function(){alert("Error: failed to load PSD library")}))}}}]),e}()})),i.register("98ax7",(function(e,t){var i;e.exports,i=function(){"use strict";var t=function(e,t,n){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){s(i.response,t,n)},i.onerror=function(){console.error("could not download file")},i.send()},i=function(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status},r=function(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}},a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,o=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(e,n,o){var s=a.URL||a.webkitURL,l=document.createElement("a");n=n||e.name||"download",l.download=n,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?r(l):i(l.href)?t(e,n,o):r(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){r(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,n,a){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,a),n);else if(i(e))t(e,n,a);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout((function(){r(o)}))}}:function(e,n,i,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,i);var s="application/octet-stream"===e.type,l=/constructor/i.test(a.HTMLElement)||a.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&l||o)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},u.readAsDataURL(e)}else{var h=a.URL||a.webkitURL,d=h.createObjectURL(e);r?r.location=d:location.href=d,r=null,setTimeout((function(){h.revokeObjectURL(d)}),4e4)}});a.saveAs=s.saveAs=s,e.exports=s},"function"==typeof define&&define.amd?define([],i):i()})),i.register("6rdi0",(function(e,n){t(e.exports,"UndoRedoCatchup",(function(){return l}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("hrnUX"),s=i("gWfkn"),l=function(){"use strict";function e(t,n,i,a,o,s,l,c,u,h){(0,r.default)(this,e),this.brushUiObj=t,this.layerPreview=n,this.layerManager=i,this.handUi=a,this.klCanvasWorkspace=o,this.getInitState=s,this.getKlCanvas=l,this.getCurrentLayerCtx=c,this.setCurrentLayerCtx=u,this.getCurrentBrush=h,this.doIgnore=!1}return(0,a.default)(e,[{key:"ignoreTest",value:function(){var e=this;return!this.doIgnore&&(this.doIgnore=!0,setTimeout((function(){e.doIgnore=!1}),0),!0)}},{key:"undo",value:function(){var e=this;if(!this.ignoreTest())return!1;if(!s.klHistory.canUndo())return!1;var t=s.klHistory.undo(),n=this.getKlCanvas();s.klHistory.pause(!0);var i=this.getInitState(),r=n.getWidth(),a=n.getHeight();n.copy(i.canvas);var l=i.focus;this.setCurrentLayerCtx(n.getLayerContext(l));var c={};for(var u in o.KL.brushes)o.KL.brushes.hasOwnProperty(u)&&(c[u]=new o.KL.brushes[u],c[u].setContext(this.getCurrentLayerCtx()));c.SketchyBrush.setSeed(i.brushes.SketchyBrush.getSeed());for(var h=0;h<t.length;h++)!function(i){if("brush"===t[i].tool[0]){var r=c[t[i].tool[1]];if(t[i].actions)for(var a=0;a<t[i].actions.length;a++){var s=t[i].actions[a].params;r[t[i].actions[a].action].apply(r,s)}else{var u=t[i].params;r[t[i].action].apply(r,u)}}else if("canvas"===t[i].tool[0]){var h=t[i].params,d=n[t[i].action].apply(n,h);if("number"==typeof d)for(var p in l=d,e.setCurrentLayerCtx(n.getLayerContext(l)),c)c.hasOwnProperty(p)&&c[p].setContext(e.getCurrentLayerCtx())}else if("filter"===t[i].tool[0]){var g=[{context:e.getCurrentLayerCtx(),klCanvas:n,input:t[i].params[0].input,history:new o.KL.DecoyKlHistory}];o.KL.filterLib[t[i].tool[1]][t[i].action].apply(null,g)}else if("misc"===t[i].tool[0]&&"focusLayer"===t[i].action)for(var f in l=t[i].params[0],e.setCurrentLayerCtx(n.getLayerContext(t[i].params[0])),c)c.hasOwnProperty(f)&&c[f].setContext(e.getCurrentLayerCtx());else if("misc"===t[i].tool[0]&&"importImage"===t[i].action){var m=n.addLayer();if("number"==typeof m)for(var v in l=m,t[i].params[1]&&n.renameLayer(l,t[i].params[1]),e.setCurrentLayerCtx(n.getLayerContext(l)),c)c.hasOwnProperty(v)&&c[v].setContext(e.getCurrentLayerCtx());e.getCurrentLayerCtx().drawImage(t[i].params[0],0,0)}}(h);return r===n.getWidth()&&a===n.getHeight()||(this.klCanvasWorkspace.resetView(),this.handUi.update(this.klCanvasWorkspace.getScale(),this.klCanvasWorkspace.getAngleDeg())),this.layerManager.update(l),this.layerPreview.setLayer(n.getLayer(l)),this.brushUiObj.sketchyBrush.setSeed(c.SketchyBrush.getSeed()),this.getCurrentBrush().setContext(this.getCurrentLayerCtx()),this.klCanvasWorkspace.setLastDrawEvent(null),s.klHistory.pause(!1),!0}},{key:"redo",value:function(){var e=this;if(!this.ignoreTest())return!1;if(!s.klHistory.canRedo())return!1;var t=s.klHistory.redo(),n=this.getKlCanvas();s.klHistory.pause(!0);var i,r=n.getWidth(),a=n.getHeight(),l={};for(var c in o.KL.brushes)o.KL.brushes.hasOwnProperty(c)&&(l[c]=new o.KL.brushes[c],l[c].setContext(this.getCurrentLayerCtx()));l.SketchyBrush.setSeed(this.brushUiObj.sketchyBrush.getSeed());for(var u=0;u<t.length;u++)!function(r){if("brush"===t[r].tool[0]){var a=l[t[r].tool[1]];if(t[r].actions)for(var s=0;s<t[r].actions.length;s++){var c=t[r].actions[s].params;a[t[r].actions[s].action].apply(a,c)}else{var u=t[r].params;a[t[r].action].apply(a,u)}}else if("canvas"===t[r].tool[0]){var h=t[r].params,d=n[t[r].action].apply(n,h);if("number"==typeof d)for(var p in i=d,e.setCurrentLayerCtx(n.getLayerContext(i)),l)l.hasOwnProperty(p)&&l[p].setContext(e.getCurrentLayerCtx())}else if("filter"===t[r].tool[0]){var g=[{context:e.getCurrentLayerCtx(),klCanvas:n,input:t[r].params[0].input,history:new o.KL.DecoyKlHistory}];o.KL.filterLib[t[r].tool[1]][t[r].action].apply(null,g)}else if("misc"===t[r].tool[0]&&"focusLayer"===t[r].action)for(var f in i=t[r].params[0],e.setCurrentLayerCtx(n.getLayerContext(t[r].params[0])),l)l.hasOwnProperty(f)&&l[f].setContext(e.getCurrentLayerCtx());else if("misc"===t[r].tool[0]&&"importImage"===t[r].action){var m=n.addLayer();if("number"==typeof m)for(var v in i=m,t[r].params[1]&&n.renameLayer(i,t[r].params[1]),e.setCurrentLayerCtx(n.getLayerContext(i)),l)l.hasOwnProperty(v)&&l[v].setContext(e.getCurrentLayerCtx());e.getCurrentLayerCtx().drawImage(t[r].params[0],0,0)}}(u);r===n.getWidth()&&a===n.getHeight()||(this.klCanvasWorkspace.resetView(),this.handUi.update(this.klCanvasWorkspace.getScale(),this.klCanvasWorkspace.getAngleDeg()));var h=n.getLayerIndex(this.getCurrentLayerCtx().canvas);return this.layerManager.update(h),this.layerPreview.setLayer(n.getLayer(h)),this.brushUiObj.sketchyBrush.setSeed(l.SketchyBrush.getSeed()),this.getCurrentBrush().setContext(this.getCurrentLayerCtx()),this.klCanvasWorkspace.setLastDrawEvent(null),s.klHistory.pause(!1),!0}},{key:"catchup",value:function(e){if(e&&e.bufferUpdate){var t=this.getInitState(),n=t.brushes,i=[e.bufferUpdate],r=t.canvas.getLayerContext(t.focus),a=t.canvas,s=t.focus;!function(e){if("brush"===i[0].tool[0]){var t=n[i[0].tool[1]];if(i[0].actions)for(var l=0;l<i[0].actions.length;l++){var c=i[0].actions[l].params;t[i[0].actions[l].action].apply(t,c)}else{var u=i[0].params;t[i[0].action].apply(t,u)}}else if("canvas"===i[0].tool[0]){var h=i[0].params,d=a[i[0].action].apply(a,h);if("number"==typeof d)for(var p in s=d,r=a.getLayerContext(s),n)n.hasOwnProperty(p)&&n[p].setContext(r)}else if("filter"===i[0].tool[0]){var g=[{context:r,klCanvas:a,input:i[0].params[0].input,history:new o.KL.DecoyKlHistory}];o.KL.filterLib[i[0].tool[1]][i[0].action].apply(null,g)}else if("misc"===i[0].tool[0]&&"focusLayer"===i[0].action)for(var f in s=i[0].params[0],r=a.getLayerContext(i[0].params[0]),n)n.hasOwnProperty(f)&&n[f].setContext(r);else if("misc"===i[0].tool[0]&&"importImage"===i[0].action){var m=a.addLayer();if("number"==typeof m)for(var v in s=m,i[0].params[1]&&a.renameLayer(s,i[0].params[1]),r=a.getLayerContext(s),n)n.hasOwnProperty(v)&&n[v].setContext(r);r.drawImage(i[0].params[0],0,0)}}(),t.focus=s}}}]),e}()})),i.register("7pyBK",(function(e,n){t(e.exports,"BrushSettingService",(function(){return o}));var r=i("gFgFC"),a=i("kiQ5H"),o=function(){"use strict";function e(t,n,i,a,o,s,l){if((0,r.default)(this,e),this.onSetColor=t,this.onSetSize=n,this.onSetOpacity=i,this.onGetColor=a,this.onGetSize=o,this.onGetOpacity=s,this.onGetSliderConfig=l,this.subscriberArr=[],e.instance)throw new Error("BrushSettingService already instantiated");e.instance=this}return(0,a.default)(e,[{key:"emit",value:function(e,t){for(var n=0;n<this.subscriberArr.length;n++)this.subscriberArr[n]!==t&&this.subscriberArr[n](e)}},{key:"emitColor",value:function(e,t){this.emit({type:"color",value:e},t)}},{key:"emitSize",value:function(e,t){this.emit({type:"size",value:e},t)}},{key:"emitOpacity",value:function(e,t){this.emit({type:"opacity",value:e},t)}},{key:"emitSliderConfig",value:function(e,t){this.emit({type:"sliderConfig",value:e},t)}},{key:"setColor",value:function(e,t){this.onSetColor(e),this.emitColor(e,t)}},{key:"setSize",value:function(e,t){this.onSetSize(e)}},{key:"setOpacity",value:function(e,t){this.onSetOpacity(e)}},{key:"getColor",value:function(){return this.onGetColor()}},{key:"getSize",value:function(){return this.onGetSize()}},{key:"getOpacity",value:function(){return this.onGetOpacity()}},{key:"getSliderConfig",value:function(){return this.onGetSliderConfig()}},{key:"subscribe",value:function(e){this.subscriberArr.includes(e)||this.subscriberArr.push(e)}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.subscriberArr.length;t++)e===this.subscriberArr[t]&&(this.subscriberArr.splice(t,1),t--)}}]),e}()})),i.register("bIgqE",(function(n,r){t(n.exports,"SettingsTab",(function(){return m}));var a=i("gFgFC"),o=i("kiQ5H"),s=i("eWjiX"),l=i("1mH1z"),c=i("hrnUX"),u=i("fgfvl"),h=i("ekHRj"),d=i("6qSiv"),p=i("8oUiM"),g=i("7OLuX"),f=i("6l0gQ"),m=function(){"use strict";function t(n,r){(0,a.default)(this,t);var o=function(){return s.BB.el({tagName:"a",content:(0,l.LANG)("licenses"),onClick:function(){i("eSypg").then((function(e){new(0,h.Popup)({title:s.BB.el({content:(0,l.LANG)("licenses")}),content:s.BB.el({content:s.BB.el({content:e.licenses.replace(/\n/g,"<br>"),css:{padding:"20px"}}),css:{height:"100%",overflowY:"scroll"}}),width:800,isMaxHeight:!0})}))}})},m=l.languageStrings.getLanguage();this.el=s.BB.el({content:"\n".concat((0,l.LANG)("settings-language"),": ").concat(m.name," (").concat(m.code,")\n            "),css:{margin:"10px"}});var v=s.BB.el({content:(0,l.LANG)("settings-preferred-language")+":<br>",css:{marginTop:"10px"}}),y=[["auto",(0,l.LANG)("auto")]].concat(u.languages.map((function(e){return[e.code,e.name+" (".concat(e.code,")")]}))),x=new c.KL.Select({initValue:f.LocalStorage.getItem(l.LS_LANGUAGE_KEY)?f.LocalStorage.getItem(l.LS_LANGUAGE_KEY):"auto",optionArr:y,onChange:function(e){"auto"===e?f.LocalStorage.removeItem(l.LS_LANGUAGE_KEY):f.LocalStorage.setItem(l.LS_LANGUAGE_KEY,e),b.style.display="block"}}),b=s.BB.el({content:(0,l.LANG)("settings-language-reload"),css:{display:"none",marginTop:"5px"}});(v.append(x.getElement(),b),this.el.append(v),s.BB.el({tagName:"button",parent:this.el,content:'<img height="20" width="18" src="'+e(g)+'" alt="icon" style="margin-right: 5px"/>'+(0,l.LANG)("switch-ui-left-right"),onClick:function(){return n()},css:{marginTop:"20px"},custom:{tabIndex:"-1"}}),this.el.append(s.BB.el({className:"gridHr",css:{margin:"10px 0"}})),r)?(this.el.append(r),r.innerHTML||s.BB.el({parent:r,css:{textAlign:"center"}}).append(s.BB.el({content:'<img alt="icon" height="20" style="vertical-align:middle" src="'.concat(e(d),'"> <a href="https://bitbof.com" target="_blank" tabIndex="-1">bitbof</a> © 2022<br>')}),o())):s.BB.el({parent:this.el,css:{textAlign:"center"},content:'\n<img alt="Klecks" height="25" src="'.concat(e(p),'"><br>\n<img alt="icon" height="20" style="vertical-align:middle" src="').concat(e(d),'"> <a href="https://bitbof.com" target="_blank" tabIndex="-1">bitbof</a> © 2022<br>')}).append(o(),document.createTextNode(" | "),s.BB.el({tagName:"a",content:(0,l.LANG)("donate"),custom:{href:"https://kleki.com/donate/",target:"_blank"}}),document.createTextNode(" | "),s.BB.el({tagName:"a",content:(0,l.LANG)("source-code"),custom:{href:"https://klecks.org",target:"_blank"}}));window.addEventListener("storage",(function(e){e.key===l.LS_LANGUAGE_KEY&&x.setValue(f.LocalStorage.getItem(l.LS_LANGUAGE_KEY)?f.LocalStorage.getItem(l.LS_LANGUAGE_KEY):"auto")}))}return(0,o.default)(t,[{key:"getElement",value:function(){return this.el}}]),t}()})),i.register("6qSiv",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("kSWIa")})),i.register("7OLuX",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("4FMUg")})),i.register("eSypg",(function(e,t){e.exports=i("ih7W4")(i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("79hnx")).then((function(){return i("jNQF2")}))})),i.register("iVHpg",(function(e,n){t(e.exports,"ToolspaceScroller",(function(){return c}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("eWjiX"),s=i("1mH1z"),l=i("i8UFO"),c=function(){"use strict";function e(t){var n=this;(0,r.default)(this,e),this.toolspace=t.toolspace,this.upBtn=o.BB.el({parent:this.toolspace,title:(0,s.LANG)("scroll"),className:"kl-scroller",css:{top:"0",transform:"rotate(180deg)"}}),this.downBtn=o.BB.el({parent:this.toolspace,title:(0,s.LANG)("scroll"),className:"kl-scroller",css:{bottom:"0"}}),this.updateUiState(t.uiState);new o.BB.PointerListener({target:this.upBtn,onPointer:function(e){"pointerdown"===e.type&&(n.upInterval=setInterval((function(){n.toolspace.scrollBy(0,-13),n.update()}),20)),"pointerup"===e.type&&(clearInterval(n.upInterval),setTimeout((function(){n.upInterval=null,n.update()}),50))}}),new o.BB.PointerListener({target:this.downBtn,onPointer:function(e){"pointerdown"===e.type&&(n.downInterval=setInterval((function(){n.toolspace.scrollBy(0,13),n.update()}),20)),"pointerup"===e.type&&(clearInterval(n.downInterval),setTimeout((function(){n.downInterval=null,n.update()}),50))}});var i=function(e){n.toolspace.scrollBy(0,Math.round(.7*e.deltaY)),n.update()};this.upBtn.addEventListener("wheel",i),this.downBtn.addEventListener("wheel",i),this.update(),new MutationObserver((function(){return n.update()})).observe(this.toolspace,{attributes:!0,childList:!0,subtree:!0}),window.addEventListener("resize",(function(){return n.update()})),l.dialogCounter.subscribe((function(e){n.upBtn.style.opacity=e>=1?"0":"",n.downBtn.style.opacity=e>=1?"0":""}))}return(0,a.default)(e,[{key:"update",value:function(){this.toolspace.scrollHeight>this.toolspace.offsetHeight+3?(this.upInterval||(this.upBtn.style.display=0===this.toolspace.scrollTop?"none":"block"),this.downInterval||(this.downBtn.style.display=this.toolspace.scrollTop+this.toolspace.offsetHeight+1>=this.toolspace.scrollHeight?"none":"block")):(this.upBtn.style.display="none",this.downBtn.style.display="none")}},{key:"updateUiState",value:function(e){o.BB.css(this.upBtn,{left:"left"===e?"0":null,right:"right"===e?"0":null}),o.BB.css(this.downBtn,{left:"left"===e?"0":null,right:"right"===e?"0":null})}}]),e}()})),i.register("5Gc7M",(function(e,n){t(e.exports,"GradientUi",(function(){return d}));var r=i("gFgFC"),a=i("kiQ5H"),o=i("7U0Ew"),s=i("eWjiX"),l=i("llzZ0"),c=i("1mH1z"),u=i("lXqiv"),h=i("iskOY"),d=function(){"use strict";function e(t){var n=this;(0,r.default)(this,e),(0,o.default)(this,"settings",{opacity:1,type:"linear",doLockAlpha:!1,doSnap:!1,isReversed:!1,isEraser:!1}),this.colorSlider=t.colorSlider,this.rootEl=s.BB.el({css:{margin:"10px"}}),this.isVisible=!0,this.colorDiv=s.BB.el({parent:this.rootEl,css:{marginBottom:"10px"}}),this.iconArr=[];[0,1,2].forEach((function(e){var t=s.BB.el({css:{width:"33px",height:"33px",borderRadius:"3px",margin:"1px"}});n.iconArr.push(t)})),this.updateIcons();var i=new(0,h.Options)({optionArr:[{id:"linear",label:this.iconArr[0],title:(0,c.LANG)("gradient-linear")},{id:"linear-mirror",label:this.iconArr[1],title:(0,c.LANG)("gradient-linear-mirror")},{id:"radial",label:this.iconArr[2],title:(0,c.LANG)("gradient-radial")}],initId:"linear",onChange:function(e){n.settings.type=e}});this.rootEl.append(i.getElement());var a=new(0,l.KlSlider)({label:(0,c.LANG)("opacity"),width:250,height:30,min:.01,max:1,value:this.settings.opacity,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e},onChange:function(e){n.settings.opacity=e}});s.BB.css(a.getElement(),{marginTop:"10px"}),this.rootEl.append(a.getElement());var d=s.BB.el({parent:this.rootEl,css:{display:"flex",alignItems:"center",marginTop:"10px"}}),p=new(0,u.Checkbox)({init:!1,label:(0,c.LANG)("reverse"),callback:function(e){n.settings.isReversed=e,n.updateIcons()},css:{width:"50%"}}),g=new(0,u.Checkbox)({init:!1,label:(0,c.LANG)("angle-snap"),title:(0,c.LANG)("angle-snap-title"),callback:function(e){n.settings.doSnap=e},css:{width:"50%"}});d.append(p.getElement(),g.getElement());var f=s.BB.el({parent:this.rootEl,css:{display:"flex",alignItems:"center",marginTop:"10px"}}),m=new(0,u.Checkbox)({init:this.settings.isEraser,label:(0,c.LANG)("eraser"),callback:function(e){n.settings.isEraser=e},css:{width:"50%"}}),v=new(0,u.Checkbox)({init:!1,label:(0,c.LANG)("lock-alpha"),title:(0,c.LANG)("lock-alpha-title"),callback:function(e){n.settings.doLockAlpha=e},doHighlight:!0,css:{width:"50%"}});f.append(m.getElement(),v.getElement())}return(0,a.default)(e,[{key:"updateIcons",value:function(){var e=this.settings.isReversed?"#0000":"#000",t=this.settings.isReversed?"#000":"#0000";this.iconArr[0].style.background="linear-gradient(".concat(e,", ").concat(t,")"),this.iconArr[1].style.background="linear-gradient(".concat(t,", ").concat(e,", ").concat(t,")"),this.iconArr[2].style.background="radial-gradient(".concat(e,", ").concat(t,")")}},{key:"getElement",value:function(){return this.rootEl}},{key:"setIsVisible",value:function(e){this.isVisible=!!e,this.rootEl.style.display=e?"block":"none",e&&(this.colorDiv.appendChild(this.colorSlider.getElement()),this.colorDiv.appendChild(this.colorSlider.getOutputElement()))}},{key:"getSettings",value:function(){return s.BB.copyObj(this.settings)}}]),e}()})),i.register("85H3x",(function(n,r){t(n.exports,"ToolspaceTopRow",(function(){return h}));var a=i("gFgFC"),o=i("kiQ5H"),s=i("eWjiX"),l=i("7OLuX"),c=i("kS5uZ"),u=i("1mH1z"),h=function(){"use strict";function t(n){(0,a.default)(this,t);var i=function(e){var t=6+(e.extraPadding?e.extraPadding:0),n=s.BB.el({className:"toolspace-row-button nohighlight",title:e.title,onClick:e.onClick,css:{padding:e.content?"":e.contain?t+"px 0":""}});if(e.content)n.appendChild(e.content);else{var i=s.BB.el({css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%"}});i.style.pointerEvents="none",n.appendChild(i)}return n.pointerListener=new s.BB.PointerListener({target:n,onEnterLeave:function(e){n.classList.toggle("toolspace-row-button-hover",e)}}),n},r=document.createElement("div");this.el=r,s.BB.css(r,{height:"36px",display:"flex",backgroundImage:"linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)"});var o=i({onClick:n.onSubmit,title:(0,u.LANG)("submit-title"),content:s.BB.el({content:(0,u.LANG)("submit"),className:"toolspace-row-button__submit",css:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%"}}),contain:!0});o.style.width="45px";var h=i({onClick:n.onHelp,title:(0,u.LANG)("help"),image:e(c),contain:!0}),d=i({onClick:n.onLeftRight,title:(0,u.LANG)("switch-ui-left-right"),image:e(l),contain:!0});r.appendChild(o),r.appendChild(d),r.appendChild(h)}return(0,o.default)(t,[{key:"getElement",value:function(){return this.el}}]),t}()})),i.register("iUR3L",(function(e,n){t(e.exports,"importFilters",(function(){return k}));var r=i("kyVjY"),a=i("iiVKq"),o=i("lorQQ"),s=i("8Ri8I"),l=i("fADXF"),c=i("bIns5"),u=i("30jcG"),h=i("cCks8"),d=i("huXOx"),p=i("dsRff"),g=i("lhchB"),f=i("lXpcU"),m=i("1CjeM"),v=i("dNWKZ"),y=i("94Tq7"),x=i("d8Fqy"),b=i("gtdB1"),B=i("lQzx7"),w=i("10iZP"),C=i("dteOZ");function S(e,t){t.getDialog&&(e.getDialog=t.getDialog),e.apply=t.apply}function k(e){r.filterLibStatus.isLoaded||(e,S(r.filterLib.brightnessContrast,a.filterBrightnessContrast),S(r.filterLib.cropExtend,o.filterCropExtend),S(r.filterLib.curves,s.filterCurves),S(r.filterLib.flip,l.filterFlip),S(r.filterLib.hueSaturation,c.filterHueSaturation),S(r.filterLib.invert,u.filterInvert),S(r.filterLib.perspective,h.filterPerspective),S(r.filterLib.resize,d.filterResize),S(r.filterLib.rotate,p.filterRotate),S(r.filterLib.tiltShift,g.filterTiltShift),S(r.filterLib.transform,f.filterTransform),S(r.filterLib.blur,m.filterBlur),S(r.filterLib.unsharpMask,v.filterUnsharpMask),S(r.filterLib.toAlpha,y.filterToAlpha),S(r.filterLib.grid,x.filterGrid),S(r.filterLib.noise,b.filterNoise),S(r.filterLib.pattern,B.filterPattern),S(r.filterLib.distort,w.filterDistort),S(r.filterLib.vanishPoint,C.filterVanishPoint),r.filterLibStatus.isLoaded=!0)}})),i.register("iiVKq",(function(e,n){t(e.exports,"filterBrightnessContrast",(function(){return u}));var r=i("eWjiX"),a=i("llzZ0"),o=i("cH2YE"),s=i("i5nyl"),l=i("5RaQo"),c=i("1mH1z"),u={getDialog:function(e){var t=document.createElement("div"),n={element:t},i=e.context,u=e.klCanvas;if(!i||!u)return!1;var h=u.getLayers(),d=u.getLayerIndex(i.canvas),p=r.BB.fitInto(i.canvas.width,i.canvas.height,280,200,1),g=parseInt(""+p.width),f=parseInt(""+p.height),m=r.BB.canvas(g,f),v=m.getContext("2d");return v.save(),m.width>i.canvas.width&&(v.imageSmoothingEnabled=!1),v.drawImage(i.canvas,0,0,g,f),v.restore(),setTimeout((function(){var e=0,i=0;t.innerHTML=(0,c.LANG)("filter-bright-contrast-description")+"<br/><br/>";var u=(0,l.getSharedFx)();if(u){var p=u.texture(m);u.draw(p).update();var v=new(0,a.KlSlider)({label:(0,c.LANG)("filter-bright-contrast-brightness"),width:300,height:30,min:0,max:100,value:50*(e+1),eventResMs:o.eventResMs,onChange:function(t){e=t/50-1,u.draw(p).brightnessContrast(e,i).update(),w.render()}}),y=new(0,a.KlSlider)({label:(0,c.LANG)("filter-bright-contrast-contrast"),width:300,height:30,min:0,max:100,value:50*(i+1),eventResMs:o.eventResMs,onChange:function(t){i=t/50-1,u.draw(p).brightnessContrast(e,i).update(),w.render()}});v.getElement().style.marginBottom="10px",t.appendChild(v.getElement()),t.appendChild(y.getElement());var x=document.createElement("div");r.BB.css(x,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var b=[],B=0;B<h.length;B++)b.push({image:B===d?u:h[B].context.canvas,opacity:h[B].opacity,mixModeStr:h[B].mixModeStr});var w=new(0,s.KlCanvasPreview)({width:parseInt(""+g),height:parseInt(""+f),layers:b}),C=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+g)+"px",height:parseInt(""+f)+"px"}});C.appendChild(w.getElement()),x.appendChild(C),t.appendChild(x);try{u.draw(p).brightnessContrast(e,i).update(),w.render()}catch(e){t.errorCallback(e)}n.destroy=function(){v.destroy(),y.destroy(),p.destroy()},n.getInput=function(){return n.destroy(),{brightness:e,contrast:i}}}}),1),n},apply:function(e){var t=e.context,n=e.input.brightness,i=e.input.contrast,r=e.history;if(!t||null===n||null===i||!r)return!1;r.pause(!0);var a=(0,l.getSharedFx)();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).brightnessContrast(n,i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),r.pause(!1),r.push({tool:["filter","brightnessContrast"],action:"apply",params:[{input:e.input}]}),!0}}})),i.register("cH2YE",(function(e,n){t(e.exports,"eventResMs",(function(){return i}));var i=60})),i.register("5RaQo",(function(e,n){t(e.exports,"getSharedFx",(function(){return o}));var r=i("TEtAx"),a=null;try{a=r.fx.canvas()}catch(e){}function o(){if(!a||a._.gl.isContextLost())try{a=r.fx.canvas()}catch(e){}return a}})),i.register("TEtAx",(function(n,r){t(n.exports,"fx",(function(){return o}));var a=i("dVkJn"),o=function(){var t,n=function(e,t,n){return Math.max(e,Math.min(t,n))},i=function(e){return{_:e,loadContentsOf:function(e){t=this._.gl,this._.loadContentsOf(e)},destroy:function(){t=this._.gl,this._.destroy()}}},r=function(e){return i(_.fromElement(e))},o=function(e,n){var i=t.UNSIGNED_BYTE;if(t.getExtension("OES_texture_float")&&t.getExtension("OES_texture_float_linear")){var r=new _(100,100,t.RGBA,t.FLOAT);try{r.drawTo((function(){i=t.FLOAT}))}catch(e){}r.destroy()}this._.texture&&this._.texture.destroy(),this._.spareTexture&&this._.spareTexture.destroy(),this.width=e,this.height=n,this._.texture=new _(e,n,t.RGBA,i),this._.spareTexture=new _(e,n,t.RGBA,i),this._.extraTexture=this._.extraTexture||new _(0,0,t.RGBA,i),this._.flippedShader=this._.flippedShader||new W(null,"        uniform sampler2D texture;        varying vec2 texCoord;        void main() {            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));        }    ","flippedShader"),this._.isInitialized=!0},s=function(e,t,n){return this._.isInitialized&&e._.width==this.width&&e._.height==this.height||o.call(this,t||e._.width,n||e._.height),e._.use(),this._.texture.drawTo((function(){W.getDefaultShader().drawRect()})),this},l=function(){return this._.texture.use(),this._.flippedShader.drawRect(),this},c=function(e,t,n,i){(n||this._.texture).use(),this._.spareTexture.drawTo((function(){e.uniforms(t).drawRect()})),this._.spareTexture.swapWith(i||this._.texture)},u=function(e){return e.parentNode.insertBefore(this,e),e.parentNode.removeChild(e),this},h=function(){var e=new _(this._.texture.width,this._.texture.height,t.RGBA,t.UNSIGNED_BYTE);return this._.texture.use(),e.drawTo((function(){W.getDefaultShader().drawRect()})),i(e)},d=function(){var e=this._.texture.width,n=this._.texture.height,i=new Uint8Array(e*n*4);return this._.texture.drawTo((function(){t.readPixels(0,0,e,n,t.RGBA,t.UNSIGNED_BYTE,i)})),i},p=function(e){return function(){return t=this._.gl,e.apply(this,arguments)}},g=function(e,t,n,i,r,a,o,s){var l=n-r,c=i-a,u=o-r,h=s-a,d=e-n+r-o,p=t-i+a-s,g=l*h-u*c,f=(d*h-u*p)/g,m=(l*p-d*c)/g;return[n-e+f*n,i-t+f*i,f,o-e+m*o,s-t+m*s,m,e,t,1]},f=function(e){var t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=t*a*c-t*o*l-n*r*c+n*o*s+i*r*l-i*a*s;return[(a*c-o*l)/u,(i*l-n*c)/u,(n*o-i*a)/u,(o*s-r*c)/u,(t*c-i*s)/u,(i*r-t*o)/u,(r*l-a*s)/u,(n*s-t*l)/u,(t*a-n*r)/u]},m=function(e){var t=e.length;this.xa=[],this.ya=[],this.u=[],this.y2=[],e.sort((function(e,t){return e[0]-t[0]}));for(var n=0;n<t;n++)this.xa.push(e[n][0]),this.ya.push(e[n][1]);this.u[0]=0,this.y2[0]=0;for(n=1;n<t-1;++n){var i=this.xa[n+1]-this.xa[n-1],r=(this.xa[n]-this.xa[n-1])/i,a=r*this.y2[n-1]+2;this.y2[n]=(r-1)/a;var o=(this.ya[n+1]-this.ya[n])/(this.xa[n+1]-this.xa[n])-(this.ya[n]-this.ya[n-1])/(this.xa[n]-this.xa[n-1]);this.u[n]=(6*o/i-r*this.u[n-1])/a}this.y2[t-1]=0;for(n=t-2;n>=0;--n)this.y2[n]=this.y2[n]*this.y2[n+1]+this.u[n]},v=function(e,t){return new W(null,e+"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;    void main() {        vec2 coord = texCoord * texSize;        "+t+"        gl_FragColor = texture2D(texture, coord / texSize);        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);        if (coord != clampedCoord) {            /* fade to transparent if we are outside the image */            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));        }    }","warp")},y=function(e,i){return t.brightnessContrast=t.brightnessContrast||new W(null,"        uniform sampler2D texture;        uniform float brightness;        uniform float contrast;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.rgb += brightness;            if (contrast > 0.0) {                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;            } else {                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;            }            gl_FragColor = color;        }    ","brightnessContrast"),c.call(this,t.brightnessContrast,{brightness:n(-1,e,1),contrast:n(-1,i,1)}),this},x=function(e){for(var t=new m(e),i=[],r=0;r<256;r++)i.push(n(0,Math.floor(256*t.interpolate(r/255)),255));return i},b=function(e,n,i){e=x(e),1==arguments.length?n=i=e:(n=x(n),i=x(i));for(var r=[],a=0;a<256;a++)r.splice(r.length,0,e[a],n[a],i[a],255);return this._.extraTexture.initFromBytes(256,1,r),this._.extraTexture.use(1),t.curves=t.curves||new W(null,"        uniform sampler2D texture;        uniform sampler2D map;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.r = texture2D(map, vec2(color.r)).r;            color.g = texture2D(map, vec2(color.g)).g;            color.b = texture2D(map, vec2(color.b)).b;            gl_FragColor = color;        }    ","curves"),t.curves.textures({map:1}),c.call(this,t.curves,{}),this},B=function(e){t.denoise=t.denoise||new W(null,"        uniform sampler2D texture;        uniform float exponent;        uniform float strength;        uniform vec2 texSize;        varying vec2 texCoord;        void main() {            vec4 center = texture2D(texture, texCoord);            vec4 color = vec4(0.0);            float total = 0.0;            for (float x = -4.0; x <= 4.0; x += 1.0) {                for (float y = -4.0; y <= 4.0; y += 1.0) {                    vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);                    float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));                    weight = pow(weight, exponent);                    color += sample * weight;                    total += weight;                }            }            gl_FragColor = color / total;        }    ","denoise");for(var n=0;n<2;n++)c.call(this,t.denoise,{exponent:Math.max(0,e),texSize:[this.width,this.height]});return this},w=function(e,i){return t.hueSaturation=t.hueSaturation||new W(null,"        uniform sampler2D texture;        uniform float hue;        uniform float saturation;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);                        /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */            float angle = hue * 3.14159265;            float s = sin(angle), c = cos(angle);            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;            float len = length(color.rgb);            color.rgb = vec3(                dot(color.rgb, weights.xyz),                dot(color.rgb, weights.zxy),                dot(color.rgb, weights.yzx)            );                        /* saturation adjustment */            float average = (color.r + color.g + color.b) / 3.0;            if (saturation > 0.0) {                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));            } else {                color.rgb += (average - color.rgb) * (-saturation);            }                        gl_FragColor = color;        }    ","hueSaturation"),c.call(this,t.hueSaturation,{hue:n(-1,e,1),saturation:n(-1,i,1)}),this},C=function(n,i,r,o,s,l,u,h,d,p,g,f,m){return t.noise=t.noise||new W(null,e(a).replace(/#define.*/,""),"noise"),c.call(this,t.noise,{seed:n,type:i,scale:[r[0],r[1]],offset:o,octaves:s,samples:l,texSize:[this.width,this.height],peaks:u,brightness:h,contrast:d,isReversed:p?1:0,colA:g?[g.r/255,g.g/255,g.b/255]:[0,0,0],colB:f?[f.r/255,f.g/255,f.b/255]:[1,1,1],channels:"rgb"===m?0:1}),this},S=function(e){return t.sepia=t.sepia||new W(null,"        uniform sampler2D texture;        uniform float amount;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            float r = color.r;            float g = color.g;            float b = color.b;                        color.r = min(1.0, (r * (1.0 - (0.607 * amount))) + (g * (0.769 * amount)) + (b * (0.189 * amount)));            color.g = min(1.0, (r * 0.349 * amount) + (g * (1.0 - (0.314 * amount))) + (b * 0.168 * amount));            color.b = min(1.0, (r * 0.272 * amount) + (g * 0.534 * amount) + (b * (1.0 - (0.869 * amount))));                        gl_FragColor = color;        }    ","sepia"),c.call(this,t.sepia,{amount:n(0,e,1)}),this},k=function(e,n){return t.unsharpMask=t.unsharpMask||new W(null,"        uniform sampler2D blurredTexture;        uniform sampler2D originalTexture;        uniform float strength;        uniform float threshold;        varying vec2 texCoord;        void main() {            vec4 blurred = texture2D(blurredTexture, texCoord);            vec4 original = texture2D(originalTexture, texCoord);            gl_FragColor = mix(blurred, original, 1.0 + strength);        }    ","unsharpMask"),this._.extraTexture.ensureFormat(this._.texture),this._.texture.use(),this._.extraTexture.drawTo((function(){W.getDefaultShader().drawRect()})),this._.extraTexture.use(1),this.triangleBlur(e),t.unsharpMask.textures({originalTexture:1}),c.call(this,t.unsharpMask,{strength:n}),this._.extraTexture.unuse(1),this},L=function(e){return t.vibrance=t.vibrance||new W(null,"        uniform sampler2D texture;        uniform float amount;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            float average = (color.r + color.g + color.b) / 3.0;            float mx = max(color.r, max(color.g, color.b));            float amt = (mx - average) * (-amount * 3.0);            color.rgb = mix(color.rgb, vec3(mx), amt);            gl_FragColor = color;        }    ","vibrance"),c.call(this,t.vibrance,{amount:n(-1,e,1)}),this},M=function(e,i){return t.vignette=t.vignette||new W(null,"        uniform sampler2D texture;        uniform float size;        uniform float amount;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);                        float dist = distance(texCoord, vec2(0.5, 0.5));            color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount + size));                        gl_FragColor = color;        }    ","vignette"),c.call(this,t.vignette,{size:n(0,e,1),amount:n(0,i,1)}),this},E=function(e,i,r){t.lensBlurPrePass=t.lensBlurPrePass||new W(null,"        uniform sampler2D texture;        uniform float power;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color = pow(color, vec4(power));            gl_FragColor = vec4(color);        }    ","lensBlurPrePass");var a="        uniform sampler2D texture0;        uniform sampler2D texture1;        uniform vec2 delta0;        uniform vec2 delta1;        uniform float power;        varying vec2 texCoord;        "+q+"        vec4 sample(vec2 delta) {            /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(delta, 151.7182), 0.0);                        vec4 color = vec4(0.0);            float total = 0.0;            for (float t = 0.0; t <= 30.0; t++) {                float percent = (t + offset) / 30.0;                color += texture2D(texture0, texCoord + delta * percent);                total += 1.0;            }            return color / total;        }    ";t.lensBlur0=t.lensBlur0||new W(null,a+"        void main() {            gl_FragColor = sample(delta0);        }    ","lensBlur0"),t.lensBlur1=t.lensBlur1||new W(null,a+"        void main() {            gl_FragColor = (sample(delta0) + sample(delta1)) * 0.5;        }    ","lensBlur1"),t.lensBlur2=t.lensBlur2||new W(null,a+"        void main() {            vec4 color = (sample(delta0) + 2.0 * texture2D(texture1, texCoord)) / 3.0;            gl_FragColor = pow(color, vec4(power));        }    ","lensBlur2").textures({texture1:1});for(var o=[],s=0;s<3;s++){var l=r+s*Math.PI*2/3;o.push([e*Math.sin(l)/this.width,e*Math.cos(l)/this.height])}var u=Math.pow(10,n(-1,i,1));return c.call(this,t.lensBlurPrePass,{power:u}),this._.extraTexture.ensureFormat(this._.texture),c.call(this,t.lensBlur0,{delta0:o[0]},this._.texture,this._.extraTexture),c.call(this,t.lensBlur1,{delta0:o[1],delta1:o[2]},this._.extraTexture,this._.extraTexture),c.call(this,t.lensBlur0,{delta0:o[1]}),this._.extraTexture.use(1),c.call(this,t.lensBlur2,{power:1/u,delta0:o[2]}),this},A=function(e,n,i,r,a,o){t.tiltShift=t.tiltShift||new W(null,"        uniform sampler2D texture;        uniform float blurRadius;        uniform float gradientRadius;        uniform vec2 start;        uniform vec2 end;        uniform vec2 delta;        uniform vec2 texSize;        varying vec2 texCoord;        "+q+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;            for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    ","tiltShift");var s=i-e,l=r-n,u=Math.sqrt(s*s+l*l);return c.call(this,t.tiltShift,{blurRadius:a,gradientRadius:o,start:[e,n],end:[i,r],delta:[s/u,l/u],texSize:[this.width,this.height]}),c.call(this,t.tiltShift,{blurRadius:a,gradientRadius:o,start:[e,n],end:[i,r],delta:[-l/u,s/u],texSize:[this.width,this.height]}),this},T=function(e){return t.triangleBlur=t.triangleBlur||new W(null,"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        "+q+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta * percent);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    ","triangleBlur"),c.call(this,t.triangleBlur,{delta:[e/this.width,0]}),c.call(this,t.triangleBlur,{delta:[0,e/this.height]}),this},I=function(e,n,i){return t.zoomBlur=t.zoomBlur||new W(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float strength;        uniform vec2 texSize;        varying vec2 texCoord;        "+q+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;            vec2 toCenter = center - texCoord * texSize;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = 0.0; t <= 40.0; t++) {                float percent = (t + offset) / 40.0;                float weight = 4.0 * (percent - percent * percent);                vec4 sample = texture2D(texture, texCoord + toCenter * percent * strength / texSize);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    ","zoomBlur"),c.call(this,t.zoomBlur,{center:[e,n],strength:i,texSize:[this.width,this.height]}),this},R=function(e,n,i,r){return t.colorHalftone=t.colorHalftone||new W(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float angle;        uniform float scale;        uniform vec2 texSize;        varying vec2 texCoord;                float pattern(float angle) {            float s = sin(angle), c = cos(angle);            vec2 tex = texCoord * texSize - center;            vec2 point = vec2(                c * tex.x - s * tex.y,                s * tex.x + c * tex.y            ) * scale;            return (sin(point.x) * sin(point.y)) * 4.0;        }                void main() {            vec4 color = texture2D(texture, texCoord);            vec3 cmy = 1.0 - color.rgb;            float k = min(cmy.x, min(cmy.y, cmy.z));            cmy = (cmy - k) / (1.0 - k);            cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(angle + 0.26179), pattern(angle + 1.30899), pattern(angle)), 0.0, 1.0);            k = clamp(k * 10.0 - 5.0 + pattern(angle + 0.78539), 0.0, 1.0);            gl_FragColor = vec4(1.0 - cmy - k, color.a);        }    ","colorHalftone"),c.call(this,t.colorHalftone,{center:[e,n],angle:i,scale:Math.PI/r,texSize:[this.width,this.height]}),this},P=function(e,n,i,r){return t.dotScreen=t.dotScreen||new W(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float angle;        uniform float scale;        uniform vec2 texSize;        varying vec2 texCoord;                float pattern() {            float s = sin(angle), c = cos(angle);            vec2 tex = texCoord * texSize - center;            vec2 point = vec2(                c * tex.x - s * tex.y,                s * tex.x + c * tex.y            ) * scale;            return (sin(point.x) * sin(point.y)) * 4.0;        }                void main() {            vec4 color = texture2D(texture, texCoord);            float average = (color.r + color.g + color.b) / 3.0;            gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);        }    ","dotScreen"),c.call(this,t.dotScreen,{center:[e,n],angle:i,scale:Math.PI/r,texSize:[this.width,this.height]}),this},O=function(e){return t.edgeWork1=t.edgeWork1||new W(null,"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        "+q+"        void main() {            vec2 color = vec2(0.0);            vec2 total = vec2(0.0);                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec3 sample = texture2D(texture, texCoord + delta * percent).rgb;                float average = (sample.r + sample.g + sample.b) / 3.0;                color.x += average * weight;                total.x += weight;                if (abs(t) < 15.0) {                    weight = weight * 2.0 - 1.0;                    color.y += average * weight;                    total.y += weight;                }            }            gl_FragColor = vec4(color / total, 0.0, 1.0);        }    ","edgeWork1"),t.edgeWork2=t.edgeWork2||new W(null,"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        "+q+"        void main() {            vec2 color = vec2(0.0);            vec2 total = vec2(0.0);                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec2 sample = texture2D(texture, texCoord + delta * percent).xy;                color.x += sample.x * weight;                total.x += weight;                if (abs(t) < 15.0) {                    weight = weight * 2.0 - 1.0;                    color.y += sample.y * weight;                    total.y += weight;                }            }            float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);            gl_FragColor = vec4(c, c, c, 1.0);        }    ","edgeWork2"),c.call(this,t.edgeWork1,{delta:[e/this.width,0]}),c.call(this,t.edgeWork2,{delta:[0,e/this.height]}),this},D=function(e,n,i){return t.hexagonalPixelate=t.hexagonalPixelate||new W(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float scale;        uniform vec2 texSize;        varying vec2 texCoord;        void main() {            vec2 tex = (texCoord * texSize - center) / scale;            tex.y /= 0.866025404;            tex.x -= tex.y * 0.5;                        vec2 a;            if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) a = vec2(floor(tex.x), floor(tex.y));            else a = vec2(ceil(tex.x), ceil(tex.y));            vec2 b = vec2(ceil(tex.x), floor(tex.y));            vec2 c = vec2(floor(tex.x), ceil(tex.y));                        vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);            vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);            vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);            vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);                        float alen = length(TEX - A);            float blen = length(TEX - B);            float clen = length(TEX - C);                        vec2 choice;            if (alen < blen) {                if (alen < clen) choice = a;                else choice = c;            } else {                if (blen < clen) choice = b;                else choice = c;            }                        choice.x += choice.y * 0.5;            choice.y *= 0.866025404;            choice *= scale / texSize;            gl_FragColor = texture2D(texture, choice + center / texSize);        }    ","hexagonalPixelate"),c.call(this,t.hexagonalPixelate,{center:[e,n],scale:i,texSize:[this.width,this.height]}),this},N=function(e){return t.ink=t.ink||new W(null,"        uniform sampler2D texture;        uniform float strength;        uniform vec2 texSize;        varying vec2 texCoord;        void main() {            vec2 dx = vec2(1.0 / texSize.x, 0.0);            vec2 dy = vec2(0.0, 1.0 / texSize.y);            vec4 color = texture2D(texture, texCoord);            float bigTotal = 0.0;            float smallTotal = 0.0;            vec3 bigAverage = vec3(0.0);            vec3 smallAverage = vec3(0.0);            for (float x = -2.0; x <= 2.0; x += 1.0) {                for (float y = -2.0; y <= 2.0; y += 1.0) {                    vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;                    bigAverage += sample;                    bigTotal += 1.0;                    if (abs(x) + abs(y) < 2.0) {                        smallAverage += sample;                        smallTotal += 1.0;                    }                }            }            vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);            gl_FragColor = vec4(color.rgb - dot(edge, edge) * strength * 100000.0, color.a);        }    ","ink"),c.call(this,t.ink,{strength:e*e*e*e*e,texSize:[this.width,this.height]}),this},z=function(e,i,r,a){return t.bulgePinch=t.bulgePinch||v("        uniform float radius;        uniform float strength;        uniform vec2 center;    ","        coord -= center;        float distance = length(coord);        if (distance < radius) {            float percent = distance / radius;            if (strength > 0.0) {                coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);            } else {                coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);            }        }        coord += center;    "),c.call(this,t.bulgePinch,{radius:r,strength:n(-1,a,1),center:[e,i],texSize:[this.width,this.height]}),this},G=function(e,n,i){if(t.matrixWarp=t.matrixWarp||v("        uniform mat3 matrix;        uniform bool useTextureSpace;    ","        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;        vec3 warp = matrix * vec3(coord, 1.0);        coord = warp.xy / warp.z;        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;    "),4==(e=Array.prototype.concat.apply([],e)).length)e=[e[0],e[1],0,e[2],e[3],0,0,0,1];else if(9!=e.length)throw"can only warp with 2x2 or 3x3 matrix";return c.call(this,t.matrixWarp,{matrix:n?f(e):e,texSize:[this.width,this.height],useTextureSpace:0|i}),this},j=function(e,t){var n=g.apply(null,t),i=g.apply(null,e),r=function(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}(f(n),i);return this.matrixWarp(r)},H=function(e,n,i,r){return t.swirl=t.swirl||v("        uniform float radius;        uniform float angle;        uniform vec2 center;    ","        coord -= center;        float distance = length(coord);        if (distance < radius) {            float percent = (radius - distance) / radius;            float theta = percent * percent * angle;            float s = sin(theta);            float c = cos(theta);            coord = vec2(                coord.x * c - coord.y * s,                coord.x * s + coord.y * c            );        }        coord += center;    "),c.call(this,t.swirl,{radius:i,center:[e,n],angle:r,texSize:[this.width,this.height]}),this},X=function(){return t.invert=t.invert||new W(null,"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        color.rgb = 1.0 - color.rgb;        gl_FragColor = color;    }","invert"),c.call(this,t.invert,{texSize:[this.width,this.height]}),this},F=function(){return t.multiplyAlpha=t.multiplyAlpha||new W(null,"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        color.rgb *= color.a;        gl_FragColor = color;    }","multiplyAlpha"),c.call(this,t.multiplyAlpha,{texSize:[this.width,this.height]}),this},U=function(){return t.unmultiplyAlpha=t.unmultiplyAlpha||new W(null,"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        if(color.a > 0.0) {            color.rgb /= color.a;        }        gl_FragColor = color;    }","unmultiplyAlpha"),c.call(this,t.unmultiplyAlpha,{texSize:[this.width,this.height]}),this},V=function(e,n){return t.toAlpha=t.toAlpha||new W(null,"    uniform bool isInverted;    uniform vec4 replace;    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        float alpha = (color.r + color.g + color.b) / 3.0;        if (isInverted) alpha = 1.0 - alpha;        alpha = min(color.a, alpha);        if (replace.a > 0.0) color = replace;        gl_FragColor = vec4(color.r, color.g, color.b, alpha);    }","toAlpha"),c.call(this,t.toAlpha,{isInverted:e?1:0,replace:n?[n.r/255,n.g/255,n.b/255,n.a]:[0,0,0,0],texSize:[this.width,this.height]}),this},Y=function(e){return t.distort=t.distort||v("        uniform float stepSize;        uniform vec2 scale;        uniform vec2 strength;        uniform vec2 phase;        uniform float type;        ","        const float PI = 3.14159265;        float x = coord.x;        float y = coord.y;        if (stepSize > 1.0) {            x = floor(x / stepSize) * stepSize;            y = floor(y / stepSize) * stepSize;        }        float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;        float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;        if (type == 0.0) {            coord.y += distortX;            coord.x += distortY;        } else if (type == 1.0) {            coord.x += distortX;            coord.y += distortY;        } else if (type == 2.0) {            gl_FragColor = texture2D(texture, vec2(x, y) / texSize);            coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;            coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;        }        coord.x = mod(coord.x, texSize.x);        coord.y = mod(coord.y, texSize.y);                "),c.call(this,t.distort,{stepSize:e.stepSize,type:e.distortType,scale:[e.scale.x,e.scale.y],strength:[e.strength.x,e.strength.y],phase:[e.phase.x,e.phase.y],texSize:[this.width,this.height]}),this},K={};!function(){var e,n,i=function(){};try{document.createElement("canvas").getContext("experimental-webgl")}catch(e){}t&&-1===t.getSupportedExtensions().indexOf("OES_texture_float_linear")&&(function(e){if(!e.getExtension("OES_texture_float"))return!1;var t=e.createFramebuffer(),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2,2,0,e.RGBA,e.FLOAT,new Float32Array([2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));var r=e.createProgram(),a=e.createShader(e.VERTEX_SHADER),o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,"      attribute vec2 vertex;      void main() {        gl_Position = vec4(vertex, 0.0, 1.0);      }    "),e.shaderSource(o,"      uniform sampler2D texture;      void main() {        gl_FragColor = texture2D(texture, vec2(0.5));      }    "),e.compileShader(a),e.compileShader(o),e.attachShader(r,a),e.attachShader(r,o),e.linkProgram(r);var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0]),e.STREAM_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0);var l=new Uint8Array(4);return e.useProgram(r),e.viewport(0,0,1,1),e.bindTexture(e.TEXTURE_2D,i),e.drawArrays(e.POINTS,0,1),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,l),127===l[0]||128===l[0]}(t)&&(e=WebGLRenderingContext.prototype.getExtension,n=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getExtension=function(t){return"OES_texture_float_linear"===t?function(e){return void 0===e.$OES_texture_float_linear$&&Object.defineProperty(e,"$OES_texture_float_linear$",{enumerable:!1,configurable:!1,writable:!1,value:new i}),e.$OES_texture_float_linear$}(this):e.call(this,t)},WebGLRenderingContext.prototype.getSupportedExtensions=function(){var e=n.call(this);return-1===e.indexOf("OES_texture_float_linear")&&e.push("OES_texture_float_linear"),e}))}(),K.canvas=function(){var e=document.createElement("canvas");try{t=e.getContext("experimental-webgl",{premultipliedAlpha:!1})}catch(e){t=null}if(!t)throw"This browser does not support WebGL";return e._={gl:t,isInitialized:!1,texture:null,spareTexture:null,flippedShader:null},e.texture=p(r),e.draw=p(s),e.update=p(l),e.replace=p(u),e.contents=p(h),e.getPixelArray=p(d),e.brightnessContrast=p(y),e.hexagonalPixelate=p(D),e.hueSaturation=p(w),e.colorHalftone=p(R),e.triangleBlur=p(T),e.unsharpMask=p(k),e.perspective=p(j),e.matrixWarp=p(G),e.bulgePinch=p(z),e.tiltShift=p(A),e.dotScreen=p(P),e.edgeWork=p(O),e.lensBlur=p(E),e.zoomBlur=p(I),e.noise=p(C),e.denoise=p(B),e.curves=p(b),e.swirl=p(H),e.ink=p(N),e.vignette=p(M),e.vibrance=p(L),e.sepia=p(S),e.invert=p(X),e.multiplyAlpha=p(F),e.unmultiplyAlpha=p(U),e.toAlpha=p(V),e.distort=p(Y),e},K.splineInterpolate=x;var W=function(){var e=function(e){return"[object Number]"==Object.prototype.toString.call(e)},n=function(e,n,i){var r=t.createShader(e);if(t.shaderSource(r,n.replace(/#define.*/,"")),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw"compile error: "+i+" - "+t.getShaderInfoLog(r);return r},i=function(e){var n=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,e);return null!==n&&0!==n.precision},r=function(e,r,l){if(this.vertexAttribute=null,this.texCoordAttribute=null,this.program=t.createProgram(),e=e||a,r=r||o,null===s&&(s=i(t.HIGH_FLOAT)?"highp":i(t.MEDIUM_FLOAT)?"mediump":"lowp"),r="precision "+s+" float;"+r,t.attachShader(this.program,n(t.VERTEX_SHADER,e,l+"(vertex)")),t.attachShader(this.program,n(t.FRAGMENT_SHADER,r,l+"(fragment)")),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))throw"link error: "+t.getProgramInfoLog(this.program)},a="    attribute vec2 vertex;    attribute vec2 _texCoord;    varying vec2 texCoord;    void main() {        texCoord = _texCoord;        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);    }",o="    uniform sampler2D texture;    varying vec2 texCoord;    void main() {        gl_FragColor = texture2D(texture, texCoord);    }",s=null;return r.prototype.destroy=function(){t.deleteProgram(this.program),this.program=null},r.prototype.uniforms=function(n){for(var i in t.useProgram(this.program),n)if(n.hasOwnProperty(i)){var r=t.getUniformLocation(this.program,i);if(null!==r){var a=n[i];if(o=a,"[object Array]"==Object.prototype.toString.call(o))switch(a.length){case 1:t.uniform1fv(r,new Float32Array(a));break;case 2:t.uniform2fv(r,new Float32Array(a));break;case 3:t.uniform3fv(r,new Float32Array(a));break;case 4:t.uniform4fv(r,new Float32Array(a));break;case 9:t.uniformMatrix3fv(r,!1,new Float32Array(a));break;case 16:t.uniformMatrix4fv(r,!1,new Float32Array(a));break;default:throw"dont't know how to load uniform \""+i+'" of length '+a.length}else{if(!e(a))throw'attempted to set uniform "'+i+'" to invalid value '+(a||"undefined").toString();t.uniform1f(r,a)}}}var o;return this},r.prototype.textures=function(e){for(var n in t.useProgram(this.program),e)e.hasOwnProperty(n)&&t.uniform1i(t.getUniformLocation(this.program,n),e[n]);return this},r.prototype.drawRect=function(e,n,i,r){var a,o=t.getParameter(t.VIEWPORT);n=n!==a?(n-o[1])/o[3]:0,e=e!==a?(e-o[0])/o[2]:0,i=i!==a?(i-o[0])/o[2]:1,r=r!==a?(r-o[1])/o[3]:1,null==t.vertexBuffer&&(t.vertexBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,t.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([e,n,e,r,i,n,i,r]),t.STATIC_DRAW),null==t.texCoordBuffer&&(t.texCoordBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,t.texCoordBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW)),null==this.vertexAttribute&&(this.vertexAttribute=t.getAttribLocation(this.program,"vertex"),t.enableVertexAttribArray(this.vertexAttribute)),null==this.texCoordAttribute&&(this.texCoordAttribute=t.getAttribLocation(this.program,"_texCoord"),t.enableVertexAttribArray(this.texCoordAttribute)),t.useProgram(this.program),t.bindBuffer(t.ARRAY_BUFFER,t.vertexBuffer),t.vertexAttribPointer(this.vertexAttribute,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,t.texCoordBuffer),t.vertexAttribPointer(this.texCoordAttribute,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4)},r.getDefaultShader=function(){return t.defaultShader=t.defaultShader||new r,t.defaultShader},r}();m.prototype.interpolate=function(e){for(var t=0,n=this.ya.length-1;n-t>1;){var i=n+t>>1;this.xa[i]>e?n=i:t=i}var r=this.xa[n]-this.xa[t],a=(this.xa[n]-e)/r,o=(e-this.xa[t])/r;return a*this.ya[t]+o*this.ya[n]+((a*a*a-a)*this.y2[t]+(o*o*o-o)*this.y2[n])*(r*r)/6};var _=function(){var e=function(e,n,i,r){this.gl=t,this.id=t.createTexture(),this.width=e,this.height=n,this.format=i,this.type=r,t.bindTexture(t.TEXTURE_2D,this.id),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e&&n&&t.texImage2D(t.TEXTURE_2D,0,this.format,e,n,0,this.format,this.type,null)},n=function(e){null==i&&(i=document.createElement("canvas")),i.width=e.width,i.height=e.height;var t=i.getContext("2d");return t.clearRect(0,0,i.width,i.height),t};e.fromElement=function(n){var i=new e(0,0,t.RGBA,t.UNSIGNED_BYTE);return i.loadContentsOf(n),i},e.prototype.loadContentsOf=function(e){this.width=e.width||e.videoWidth,this.height=e.height||e.videoHeight,t.bindTexture(t.TEXTURE_2D,this.id),t.texImage2D(t.TEXTURE_2D,0,this.format,this.format,this.type,e)},e.prototype.initFromBytes=function(e,n,i){this.width=e,this.height=n,this.format=t.RGBA,this.type=t.UNSIGNED_BYTE,t.bindTexture(t.TEXTURE_2D,this.id),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,this.type,new Uint8Array(i))},e.prototype.destroy=function(){t.deleteTexture(this.id),this.id=null},e.prototype.use=function(e){t.activeTexture(t.TEXTURE0+(e||0)),t.bindTexture(t.TEXTURE_2D,this.id)},e.prototype.unuse=function(e){t.activeTexture(t.TEXTURE0+(e||0)),t.bindTexture(t.TEXTURE_2D,null)},e.prototype.ensureFormat=function(e,n,i,r){if(1==arguments.length){var a=arguments[0];e=a.width,n=a.height,i=a.format,r=a.type}e==this.width&&n==this.height&&i==this.format&&r==this.type||(this.width=e,this.height=n,this.format=i,this.type=r,t.bindTexture(t.TEXTURE_2D,this.id),t.texImage2D(t.TEXTURE_2D,0,this.format,e,n,0,this.format,this.type,null))},e.prototype.drawTo=function(e){if(t.framebuffer=t.framebuffer||t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,t.framebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.id,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw new Error("incomplete framebuffer");t.viewport(0,0,this.width,this.height),e(),t.bindFramebuffer(t.FRAMEBUFFER,null)};var i=null;return e.prototype.fillUsingCanvas=function(e){return e(n(this)),this.format=t.RGBA,this.type=t.UNSIGNED_BYTE,t.bindTexture(t.TEXTURE_2D,this.id),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),this},e.prototype.toImage=function(e){this.use(),W.getDefaultShader().drawRect();var r=this.width*this.height*4,a=new Uint8Array(r),o=n(this),s=o.createImageData(this.width,this.height);t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,a);for(var l=0;l<r;l++)s.data[l]=a[l];o.putImageData(s,0,0),e.src=i.toDataURL()},e.prototype.swapWith=function(e){var t;t=e.id,e.id=this.id,this.id=t,t=e.width,e.width=this.width,this.width=t,t=e.height,e.height=this.height,this.height=t,t=e.format,e.format=this.format,this.format=t},e}(),q="    float random(vec3 scale, float seed) {        /* use the fragment position for a different seed per-pixel */        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);    }";return K}()})),i.register("dVkJn",(function(e,t){e.exports="#define GLSLIFY 1\nuniform sampler2D texture;\nvarying vec2 texCoord;\nuniform vec2 texSize;\n\nuniform float seed;\nuniform float type;\nuniform vec2 scale;\nuniform vec2 offset;\nuniform float octaves;\nuniform float samples;\n\nuniform float peaks;\nuniform float contrast;\nuniform float brightness;\nuniform float isReversed;\n\nuniform vec3 colA;\nuniform vec3 colB;\n\nuniform float channels; // 0 - rgb, 1 - alpha\n\n// fbm, cellular_noise based on\n// https://github.com/Gonkee/Gonkees-Shaders\n// MIT, Copyright © Gonkee\n\n// hash & simplex based on\n// https://www.shadertoy.com/view/Msf3WH\n// MIT, Copyright © 2013 Inigo Quilez\n// https://www.youtube.com/c/InigoQuilez\n// https://iquilezles.org\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nfloat value_noise(vec2 coord){\n    return rand(floor(coord) / 100.0);\n}\n\nfloat cellular_noise(vec2 coord) {\n    vec2 i = floor(coord);\n    vec2 f = fract(coord);\n\n    float min_dist = 99999.0;\n    for (float x = -1.0; x <= 1.0; x++) {\n        for (float y = -1.0; y <= 1.0; y++) {\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\n            min_dist = min(min_dist, dist);\n        }\n    }\n    return min_dist;\n}\n\n// ---------- Simplex Alternative _--------------------\n\nvec3 hash(vec3 p)\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\n, dot(p, vec3(269.5, 183.3, 246.1))\n, dot(p, vec3(113.5, 271.9, 124.6)))\n;return fract(sin(p)*43758.5453123)*2.-1.; }\n\nmat3 hash(mat3 p)\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\n\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\n\n//return noiseGra13dx as .x, and its derivatives as .yzw\n// https://www.shadertoy.com/view/llByD1\nvec3 noiseGra13dx(in vec3 x) {\n    vec3 p=floor(x), w=fract(x)\n    #if 1\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\n    #else\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\n    #endif\n    //gradients\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\n    //projections\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\n    //interpolations\n    float g=dot(G, w), f=dot(F, w-vec3(1));\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\n    mat3 S=D-mat3(G, G, G), W=D-E;\n    a.x=(a.x+a.y+a.z)+f-g;\n    ;float b=u.x*u.y*u.z;\n\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\n    return 0.5 + 0.5 * result.xxx;\n}\n\nfloat fbm(vec2 coord) {\n    float normalize_factor = 0.0;\n    float value = 0.0;\n    float scale = 0.5;\n\n    for (float i = 0.0; i < 7.0; i++){\n        if (i < octaves) {\n            if (type == 0.0) {\n                value += value_noise(coord) * scale;\n            } else if (type == 1.0) {\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\n            } else if (type == 2.0) {\n                value += cellular_noise(coord) * scale;\n            }\n            normalize_factor += scale;\n            coord *= 2.0;\n            scale *= 0.5;\n        }\n    }\n    return value / normalize_factor;\n}\n\nfloat render (vec2 pos) {\n    float result = fbm(pos);\n    //\n\n    if (peaks > 0.0) {\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\n    }\n\n    result += brightness;\n    if (contrast > 0.0) {\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\n    } else if (contrast < 0.0) {\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\n    }\n\n    if (isReversed == 1.0) {\n        result = 1.0 - result;\n    }\n    return result;\n}\n\nvoid main() {\n    vec4 color;\n\n    vec2 seedOffset;\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\n\n    float val = 0.0;\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\n\n    if (samples == 1.0) {\n        val = render(basePos);\n\n    }/* else if (samples == 4.0) {\n        for (float i = 0.0; i < 2.0; i++) {\n            for (float e = 0.0; e < 2.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\n            }\n        }\n        val /= 4.0;\n\n    }*/ else if (samples == 16.0) {\n        for (float i = 0.0; i < 4.0; i++) {\n            for (float e = 0.0; e < 4.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\n            }\n        }\n        val /= 16.0;\n    }\n\n    if (channels == 0.0) {\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\n    } else {\n        gl_FragColor = vec4(vec3(1.0), val);\n    }\n}"})),i.register("lorQQ",(function(e,n){t(e.exports,"filterCropExtend",(function(){return u}));var r=i("eWjiX"),a=i("c4LUw"),o=i("lXqiv"),s=i("9A7OD"),l=i("32CBv"),c=i("1mH1z"),u={getDialog:function(e){var t=function(){y=parseInt(T.value),x=parseInt(I.value),b=parseInt(R.value),B=parseInt(P.value);var e=i.getWidth()+y+x,t=i.getHeight()+b+B;e<=0&&(w&&(y=-i.getWidth()-x+1,T.value=""+y),C&&(x=-i.getWidth()-y+1,I.value=""+x),e=1),e>L&&(w&&(y=-i.getWidth()-x+L,T.value=""+y),C&&(x=-i.getWidth()-y+L,I.value=""+x),e=L),t<=0&&(S&&(b=-i.getHeight()-B+1,R.value=""+b),k&&(B=-i.getHeight()-b+1,P.value=""+B),t=1),t>M&&(S&&(b=-i.getHeight()-B+M,R.value=""+b),k&&(B=-i.getHeight()-b+M,P.value=""+B),t=M),V.setTransform({x:-y,y:-b,width:e,height:t}),w=!1,C=!1,S=!1,k=!1},n=function(e){var t=r.BB.fitInto(e.width,e.height,260,180,1);v=t.width/e.width;var n=r.BB.centerWithin(340,220,t.width,t.height);u.style.width=i.getWidth()*v+"px",u.style.height=i.getHeight()*v+"px",U.style.left=n.x-e.x*v+"px",U.style.top=n.y-e.y*v+"px",y=parseInt(""+-e.x),b=parseInt(""+-e.y),x=parseInt(""+(e.x+e.width-i.getWidth())),B=parseInt(""+(e.y+e.height-i.getHeight())),T.value=""+y,R.value=""+b,I.value=""+x,P.value=""+B,r.BB.createCheckerDataUrl(parseInt(""+50*v),(function(e){X.style.background="url("+e+")",0!==z.a&&(u.style.background="url("+e+")")})),X.style.backgroundPosition=n.x+"px "+n.y+"px",V.setScale(v)},i=e.klCanvas;if(!i)return!1;var u=r.BB.canvas(),h=r.BB.fitInto(i.getWidth(),i.getHeight(),560,400,1),d=parseInt(""+h.width),p=parseInt(""+h.height),g=d/i.getWidth();u.width=d,u.height=p,u.style.display="block",u.getContext("2d").drawImage(i.getCompleteCanvas(g),0,0,d,p);var f=document.createElement("div"),m={element:f};f.innerHTML=(0,c.LANG)("filter-crop-description")+"<br/><br/>";var v,y=0,x=0,b=0,B=0,w=!1,C=!1,S=!1,k=!1,L=e.maxWidth,M=e.maxHeight,E=r.BB.el({css:{lineHeight:"30px",height:"35px"}}),A=r.BB.el({css:{lineHeight:"30px",height:"35px"}});f.appendChild(E),f.appendChild(A);var T=(0,a.input)({init:0,type:"number",min:-i.getWidth(),max:L,css:{width:"75px",marginRight:"20px"},callback:function(e){w=!0,t()}}),I=(0,a.input)({init:0,type:"number",min:-i.getWidth(),max:L,css:{width:"75px"},callback:function(e){C=!0,t()}}),R=(0,a.input)({init:0,type:"number",min:-i.getHeight(),max:M,css:{width:"75px",marginRight:"20px"},callback:function(e){S=!0,t()}}),P=(0,a.input)({init:0,type:"number",min:-i.getHeight(),max:M,css:{width:"75px"},callback:function(e){k=!0,t()}}),O={display:"inline-block",width:"60px"};E.append(r.BB.el({content:(0,c.LANG)("filter-crop-left")+":",css:O}),T,r.BB.el({content:(0,c.LANG)("filter-crop-right")+":",css:O}),I),A.append(r.BB.el({content:(0,c.LANG)("filter-crop-top")+":",css:O}),R,r.BB.el({content:(0,c.LANG)("filter-crop-bottom")+":",css:O}),P);var D=!0,N=new(0,o.Checkbox)({init:!0,label:(0,c.LANG)("filter-crop-rule-thirds"),allowTab:!0,callback:function(e){D=e,V.showThirds(D)}});f.appendChild(r.BB.el({css:{clear:"both"}}));var z={r:0,g:0,b:0,a:0},G=[{r:0,g:0,b:0,a:0},{r:255,g:255,b:255,a:1},{r:0,g:0,b:0,a:1}];G.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),G.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1});var j=new(0,s.ColorOptions)({label:(0,c.LANG)("filter-crop-fill"),colorArr:G,onChange:function(e){z=e,function(e){var t;0===e.a?(t="rgba(0,0,0,0.5)",F.style.background="",u.style.background=""):(t=e.r+e.g+e.b<382.5?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)",F.style.background=r.BB.ColorConverter.toRgbStr(e),r.BB.createCheckerDataUrl(parseInt(""+50*v),(function(e){u.style.background="url("+e+")"}))),u.style.boxShadow="0 0 3px 1px "+t}(e)}}),H=r.BB.el({css:{display:"flex",justifyContent:"space-between"}});f.appendChild(H),H.appendChild(N.getElement()),H.appendChild(j.getElement());var X=r.BB.el({css:{width:"340px",marginTop:"10px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",position:"relative",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",userSelect:"none",colorScheme:"only light",touchAction:"none"}});X.oncontextmenu=function(){return!1};var F=r.BB.el({css:{position:"absolute",left:"0",top:"0",bottom:"0",right:"0"}});X.appendChild(F);var U=document.createElement("div");U.style.position="absolute",U.style.left="0px",U.style.top="0px",X.appendChild(U),r.BB.appendTextDiv(U,"").appendChild(u),u.style.boxShadow="0 0 3px 1px rgba(0,0,0,0.5)",u.style.position="absolute",u.style.left="0px",u.style.top="0px",f.appendChild(X);var V=new(0,l.Cropper)({x:0,y:0,width:i.getWidth(),height:i.getHeight(),scale:v,callback:n,maxW:L,maxH:M});return n(V.getTransform()),U.appendChild(V.getElement()),m.destroy=function(){V.destroy(),N.destroy()},m.getInput=function(){return m.destroy(),{left:y,right:x,top:b,bottom:B,fillColor:0===z.a?null:z}},m},apply:function(e){var t=e.klCanvas,n=e.history;return!(!t||!n||isNaN(e.input.left)||isNaN(e.input.right)||isNaN(e.input.top)||isNaN(e.input.bottom))&&(n.pause(!0),t.resizeCanvas(e.input),n.pause(!1),n.push({tool:["filter","cropExtend"],action:"apply",params:[{input:JSON.parse(JSON.stringify(e.input))}]}),!0)}}})),i.register("8Ri8I",(function(e,n){t(e.exports,"filterCurves",(function(){return c}));var r=i("eWjiX"),a=i("iskOY"),o=i("i5nyl"),s=i("5RaQo"),l=i("1mH1z"),c={getDialog:function(e){var t=e.context,n=e.klCanvas;if(!t||!n)return!1;var i=n.getLayers(),c=n.getLayerIndex(t.canvas),u=r.BB.fitInto(t.canvas.width,t.canvas.height,280,200,1),h=parseInt(""+u.width),d=parseInt(""+u.height),p=r.BB.canvas(h,d),g=p.getContext("2d");g.save(),p.width>t.canvas.width&&(g.imageSmoothingEnabled=!1),g.drawImage(t.canvas,0,0,h,d),g.restore();var f,m=document.createElement("div"),v={element:m};return setTimeout((function(){t.canvas.width;m.innerHTML=(0,l.LANG)("filter-curves-description")+"<br/><br/>";var e={r:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],g:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],b:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]]},n=(0,s.getSharedFx)();if(n){var u,g=n.texture(p);n.draw(g).update();var y=new function(e){var t=document.createElement("div");t.oncontextmenu=function(){return!1},t.style.position="relative",t.style.marginBottom="10px";var n="All",i=e.curves;u=new(0,a.Options)({optionArr:[{id:"All",label:(0,l.LANG)("filter-curves-all")},{id:"Red",label:(0,l.LANG)("red")},{id:"Green",label:(0,l.LANG)("green")},{id:"Blue",label:(0,l.LANG)("blue")}],initialId:"All",onChange:function(e){"All"===(n=e)&&(i={r:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],g:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],b:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]]});var t=i.r;"Green"===n&&(t=i.g),"Blue"===n&&(t=i.b),m.setPos(0,c-t[0][1]*c),v.setPos(t[1][0]*s,c-t[1][1]*c),y.setPos(t[2][0]*s,c-t[2][1]*c),x.setPos(s,c-t[3][1]*c),b()}}),t.appendChild(u.getElement());var o=document.createElement("div");r.BB.css(o,{position:"relative",marginTop:"10px",colorScheme:"only light"}),t.appendChild(o);var s=300,c=100,h=r.BB.canvas(s,c);r.BB.css(h,{background:"#c6c6c6",boxShadow:"0 0 0 1px rgba(0,0,0,0.3)"});var d=h.getContext("2d");function p(e){return Math.max(0,Math.min(1,e))}function g(e,t,n,i){var a=t,l=e,u=document.createElement("div");return r.BB.css(u,{position:"absolute",left:e-7+"px",top:t-7+"px",width:"14px",height:"14px",background:"#fff",cursor:"move",borderRadius:"14px",boxShadow:"inset 0 0 0 2px #000",userSelect:"none",touchAction:"none"}),u.pointerListener=new r.BB.PointerListener({target:u,maxPointers:1,onPointer:function(o){o.eventPreventDefault(),"pointerdown"===o.type&&(l=e,a=t),"left"===o.button&&"pointermove"===o.type&&(i||(l+=o.dX),e=Math.max(0,Math.min(s,l)),a+=o.dY,t=Math.max(0,Math.min(c,a)),r.BB.css(u,{left:e-7+"px",top:t-7+"px"}),n({x:e,y:t}))}}),o.appendChild(u),u.setPos=function(n,i){a=t=i,l=e=n,r.BB.css(u,{left:e-7+"px",top:t-7+"px"})},u}function f(e,t,r){"All"===n&&(i.r[e]=[p(t/s),p(1-r/c)],i.g[e]=[p(t/s),p(1-r/c)],i.b[e]=[p(t/s),p(1-r/c)]),"Red"===n&&(i.r[e]=[p(t/s),p(1-r/c)]),"Green"===n&&(i.g[e]=[p(t/s),p(1-r/c)]),"Blue"===n&&(i.b[e]=[p(t/s),p(1-r/c)])}o.appendChild(h);var m=g(0,c,(function(e){f(0,e.x,e.y),b()}),!0),v=g(s/3,c/3*2,(function(e){f(1,e.x,e.y),b()})),y=g(s/3*2,c/3,(function(e){f(2,e.x,e.y),b()})),x=g(s,0,(function(e){f(3,e.x,e.y),b()}),!0);function b(){h.width=h.width,d=h.getContext("2d");for(var t={r:[],g:[],b:[]},a=0;a<i.r.length;a++)t.r.push(i.r[a]),t.g.push(i.g[a]),t.b.push(i.b[a]);function o(e){d.beginPath();for(var t=new r.BB.SplineInterpolator(e),n=0;n<100;n++){var i=t.interpolate(n/100);i=Math.max(0,Math.min(1,i)),0===n?d.moveTo(n/100*s,c-i*c):d.lineTo(n/100*s,c-i*c)}d.stroke()}d.save(),"All"===n?(d.strokeStyle="black",o(t.r)):(d.globalAlpha=.5,d.strokeStyle="red",o(t.r),d.strokeStyle="green",o(t.g),d.strokeStyle="blue",o(t.b)),d.restore(),e.callback(t)}b(),this.getDiv=function(){return t},this.destroy=function(){m.pointerListener.destroy(),v.pointerListener.destroy(),y.pointerListener.destroy(),x.pointerListener.destroy()}}({curves:e,callback:function(t){e=t,function(){try{n.draw(g).curves(e.r,e.g,e.b).update(),f&&f.render()}catch(e){m.errorCallback(e)}}()}});m.appendChild(y.getDiv());var x=document.createElement("div");r.BB.css(x,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var b=[],B=0;B<i.length;B++)b.push({image:B===c?n:i[B].context.canvas,opacity:i[B].opacity,mixModeStr:i[B].mixModeStr});f=new(0,o.KlCanvasPreview)({width:parseInt(""+h),height:parseInt(""+d),layers:b});var w=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+h)+"px",height:parseInt(""+d)+"px"}});w.appendChild(f.getElement()),x.appendChild(w),m.appendChild(x),v.destroy=function(){y.destroy(),g.destroy(),u.destroy()},v.getInput=function(){return v.destroy(),{curves:e}}}}),1),v},apply:function(e){var t=e.context,n=e.input.curves,i=e.history;if(!t||null===n||!i)return!1;i.pause(!0);var r=(0,s.getSharedFx)();if(!r)return!1;var a=r.texture(t.canvas);return r.draw(a).curves(n.r,n.g,n.b).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(r,0,0),a.destroy(),i.pause(!1),i.push({tool:["filter","curves"],action:"apply",params:[{input:e.input}]}),!0}}})),i.register("fADXF",(function(n,r){t(n.exports,"filterFlip",(function(){return u}));var a=i("eWjiX"),o=i("lXqiv"),s=i("i5nyl"),l=i("1RI49"),c=i("1mH1z"),u={getDialog:function(t){var n=function(){var e=L.image.getContext("2d");e.save(),e.clearRect(0,0,L.image.width,L.image.height),x&&(v&&(e.translate(L.image.width,0),e.scale(-1,1)),y&&(e.translate(0,L.image.height),e.scale(1,-1)));for(var t=0;t<u.length;t++)e.save(),x||h!==t||(v&&(e.translate(L.image.width,0),e.scale(-1,1)),y&&(e.translate(0,L.image.height),e.scale(1,-1))),e.canvas.width>u[t].context.canvas.width&&(e.imageSmoothingEnabled=!1),e.globalAlpha=u[t].opacity,e.globalCompositeOperation=u[t].mixModeStr,e.drawImage(u[t].context.canvas,0,0,L.image.width,L.image.height),e.restore();M.render(),e.restore()},i=t.context,r=t.klCanvas;if(!i||!r)return!1;var u=r.getLayers(),h=r.getLayerIndex(i.canvas),d=a.BB.fitInto(i.canvas.width,i.canvas.height,280,200,1),p=parseInt(""+d.width),g=parseInt(""+d.height),f=document.createElement("div"),m={element:f},v=!0,y=!1,x=!0;f.innerHTML=(0,c.LANG)("filter-flip-description")+"<br/><br/>";var b=new(0,o.Checkbox)({init:v,label:(0,c.LANG)("filter-flip-horizontal")+" ⟷",allowTab:!0,callback:function(e){v=e,n()},css:{marginBottom:"10px"}}),B=new(0,o.Checkbox)({init:y,label:(0,c.LANG)("filter-flip-vertical")+" ↕",allowTab:!0,callback:function(e){y=e,n()},css:{marginBottom:"10px"}});f.appendChild(b.getElement()),f.appendChild(B.getElement());var w=document.createElement("div");a.BB.setEventListener(w,"onpointerdown",(function(){return!1})),w.textContent=(0,c.LANG)("filter-flip-image"),w.style.width="150px",w.style.height="30px",w.style.paddingTop="10px",w.style.textAlign="center",w.style.cssFloat="left",w.style.paddingBottom="0px",w.style.borderTopLeftRadius="10px",w.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",w.style.background="url("+e(l)+") no-repeat 12px 16px",w.style.backgroundSize="8%",w.style.backgroundColor="#9e9e9e";var C=document.createElement("div");a.BB.setEventListener(C,"onpointerdown",(function(){return!1})),C.textContent=(0,c.LANG)("filter-flip-layer"),C.style.width="150px",C.style.height="30px",C.style.paddingTop="10px",C.style.textAlign="center",C.style.cssFloat="left",C.style.paddingBottom="0px",C.style.borderTopRightRadius="10px",C.style.cursor="pointer",C.style.backgroundColor="rgba(0, 0, 0, 0.1)",C.style.backgroundSize="8%",a.BB.setEventListener(w,"onpointerover",(function(){!1===x&&(w.style.backgroundColor="#ccc")})),a.BB.setEventListener(w,"onpointerout",(function(){!1===x&&(w.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),a.BB.setEventListener(C,"onpointerover",(function(){!0===x&&(C.style.backgroundColor="#ccc")})),a.BB.setEventListener(C,"onpointerout",(function(){!0===x&&(C.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),w.onclick=function(){x=!0,C.style.background="",C.style.backgroundColor="rgba(0, 0, 0, 0.1)",C.style.boxShadow="",C.style.cursor="pointer",w.style.background="url("+e(l)+") no-repeat 12px 16px",w.style.backgroundSize="8%",w.style.backgroundColor="#9e9e9e",w.style.cursor="default",w.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",n()},C.onclick=function(){x=!1,w.style.background="",w.style.backgroundColor="rgba(0, 0, 0, 0.1)",w.style.boxShadow="",w.style.cursor="pointer",C.style.background="url("+e(l)+") no-repeat 12px 16px",C.style.backgroundSize="8%",C.style.backgroundColor="#9e9e9e",C.style.cursor="default",C.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",n()};var S=document.createElement("div");S.appendChild(w),S.appendChild(C),f.appendChild(S);var k=document.createElement("div");a.BB.css(k,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});var L={image:a.BB.canvas(Math.round(p),Math.round(g)),opacity:1,mixModeStr:"source-over"},M=new(0,s.KlCanvasPreview)({width:Math.round(p),height:Math.round(g),layers:[L]}),E=a.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+p)+"px",height:parseInt(""+g)+"px"}});return E.appendChild(M.getElement()),k.appendChild(E),setTimeout(n,0),f.appendChild(k),m.destroy=function(){b.destroy(),B.destroy()},m.getInput=function(){return m.destroy(),{horizontal:v,vertical:y,flipCanvas:x}},m},apply:function(e){var t=e.context,n=e.klCanvas,i=e.history,r=e.input.horizontal,a=e.input.vertical,o=e.input.flipCanvas;return!!(t&&n&&i)&&(i.pause(!0),n.flip(r,a,o?null:n.getLayerIndex(t.canvas)),i.pause(!1),i.push({tool:["filter","flip"],action:"apply",params:[{input:e.input}]}),!0)}}})),i.register("1RI49",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("eFiVD")})),i.register("bIns5",(function(e,n){t(e.exports,"filterHueSaturation",(function(){return u}));var r=i("eWjiX"),a=i("cH2YE"),o=i("llzZ0"),s=i("i5nyl"),l=i("5RaQo"),c=i("1mH1z"),u={getDialog:function(e){var t=e.context,n=e.klCanvas;if(!t||!n)return!1;var i=n.getLayers(),u=n.getLayerIndex(t.canvas),h=r.BB.fitInto(t.canvas.width,t.canvas.height,280,200,1),d=parseInt(""+h.width),p=parseInt(""+h.height),g=r.BB.canvas(d,p),f=g.getContext("2d");f.save(),g.width>t.canvas.width&&(f.imageSmoothingEnabled=!1),f.drawImage(t.canvas,0,0,d,p),f.restore();var m=document.createElement("div"),v={element:m};return setTimeout((function(){var e=0,t=0;m.innerHTML=(0,c.LANG)("filter-hue-sat-description")+"<br/><br/>";var n=(0,l.getSharedFx)();if(n){var h=n.texture(g);n.draw(h).update();var f=new(0,o.KlSlider)({label:(0,c.LANG)("filter-hue-sat-hue"),width:300,height:30,min:-100,max:100,value:100*e,eventResMs:a.eventResMs,onChange:function(i){e=i/100,n.draw(h).hueSaturation(e,t).update(),w.render()}}),y=new(0,o.KlSlider)({label:(0,c.LANG)("filter-hue-sat-saturation"),width:300,height:30,min:0,max:100,value:50*(t+1),eventResMs:a.eventResMs,onChange:function(i){t=i/50-1,n.draw(h).hueSaturation(e,t).update(),w.render()}});f.getElement().style.marginBottom="10px",m.appendChild(f.getElement()),m.appendChild(y.getElement());var x=document.createElement("div");r.BB.css(x,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var b=[],B=0;B<i.length;B++)b.push({image:B===u?n:i[B].context.canvas,opacity:i[B].opacity,mixModeStr:i[B].mixModeStr});var w=new(0,s.KlCanvasPreview)({width:parseInt(""+d),height:parseInt(""+p),layers:b}),C=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+d)+"px",height:parseInt(""+p)+"px"}});C.appendChild(w.getElement()),x.appendChild(C),m.appendChild(x);try{n.draw(h).hueSaturation(e,t).update(),w.render()}catch(e){m.errorCallback(e)}v.destroy=function(){f.destroy(),y.destroy(),h.destroy()},v.getInput=function(){return v.destroy(),{hue:e,Saturation:t}}}}),1),v},apply:function(e){var t=e.context,n=e.input.hue,i=e.history,r=e.input.Saturation;if(!t||null===n||null===r||!i)return!1;i.pause(!0);var a=(0,l.getSharedFx)();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).hueSaturation(n,r).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),i.pause(!1),i.push({tool:["filter","hueSaturation"],action:"apply",params:[{input:e.input}]}),!0}}})),i.register("30jcG",(function(e,n){t(e.exports,"filterInvert",(function(){return a}));var r=i("5RaQo"),a={apply:function(e){var t=e.context,n=e.history;if(!t||!n)return!1;n.pause(!0);var i=(0,r.getSharedFx)();if(!i)return!1;var a=i.texture(t.canvas);return i.draw(a).invert().update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(i,0,0),a.destroy(),n.pause(!1),n.push({tool:["filter","invert"],action:"apply",params:[{input:e.input}]}),!0}}})),i.register("cCks8",(function(e,n){t(e.exports,"filterPerspective",(function(){return c}));var r=i("eWjiX"),a=i("i5nyl"),o=i("5RaQo"),s=i("1mH1z"),l=i("5vheV"),c={getDialog:function(e){var t=e.context,n=e.klCanvas;if(!t||!n)return!1;var i=window.innerWidth<550,c=n.getLayers(),u=n.getLayerIndex(t.canvas),h=r.BB.fitInto(t.canvas.width,t.canvas.height,i?280:490,i?200:240,1),d=parseInt(""+h.width),p=parseInt(""+h.height),g=Math.min(d,t.canvas.width),f=Math.min(p,t.canvas.height),m=r.BB.canvas(g,f),v=m.getContext("2d");v.save(),g>t.canvas.width&&(v.imageSmoothingEnabled=!1),v.drawImage(t.canvas,0,0,g,f),v.restore();var y=d/t.canvas.width,x=document.createElement("div"),b={element:x};i||(b.width=500);var B=[];return setTimeout((function(){x.innerHTML=(0,s.LANG)("filter-perspective-description")+"<br/><br/>";var e=(0,o.getSharedFx)();if(e){var t,n,h,v,w,C,S,k,L=e.texture(m);e.draw(L).update(),t=D(0,0,N),n=D(d,0,N),h=D(d,p,N),v=D(0,p,N),w=D(0,0),C=D(d,0),S=D(d,p),k=D(0,p);var M=new(0,l.TwoTabs)({left:(0,s.LANG)("compare-before"),right:(0,s.LANG)("compare-after"),init:1,onChange:function(e){0===e?(w.style.display="none",C.style.display="none",S.style.display="none",k.style.display="none",t.style.display="block",n.style.display="block",h.style.display="block",v.style.display="block",t.copy(w),n.copy(C),h.copy(S),v.copy(k)):(t.style.display="none",n.style.display="none",h.style.display="none",v.style.display="none",w.style.display="block",C.style.display="block",S.style.display="block",k.style.display="block",w.copy(t),C.copy(n),S.copy(h),k.copy(v)),O()}});x.append(M.getElement());var E=document.createElement("div");E.oncontextmenu=function(){return!1},r.BB.css(E,{width:i?"340px":"540px",marginLeft:"-20px",height:i?"260px":"300px",backgroundColor:"#9e9e9e",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var A=[],T=0;T<c.length;T++){var I=T===u?e:c[T].context.canvas;A.push({image:I,opacity:c[T].opacity,mixModeStr:c[T].mixModeStr})}var R=new(0,a.KlCanvasPreview)({width:parseInt(""+d),height:parseInt(""+p),layers:A}),P=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+d)+"px",height:parseInt(""+p)+"px"}});P.appendChild(R.getElement()),E.appendChild(P),P.appendChild(w),P.appendChild(C),P.appendChild(S),P.appendChild(k),t.style.display="none",n.style.display="none",h.style.display="none",v.style.display="none",P.appendChild(t),P.appendChild(n),P.appendChild(h),P.appendChild(v),x.appendChild(E),O(),b.destroy=function(){for(var e=0;e<B.length;e++)B[e].destroy();L.destroy()},b.getInput=function(){return b.destroy(),{before:[t.x/y,t.y/y,n.x/y,n.y/y,h.x/y,h.y/y,v.x/y,v.y/y],after:[w.x/y,w.y/y,C.x/y,C.y/y,S.x/y,S.y/y,k.x/y,k.y/y]}}}function O(){try{e.draw(L).multiplyAlpha().perspective([t.x,t.y,n.x,n.y,h.x,h.y,v.x,v.y].map((function(e,t){return t%2==0?e/d*g:e/p*f})),[w.x,w.y,C.x,C.y,S.x,S.y,k.x,k.y].map((function(e,t){return t%2==0?e/d*g:e/p*f}))).unmultiplyAlpha().update(),R.render()}catch(e){x.errorCallback(e)}}function D(e,t,n){var i=document.createElement("div");i.x=e,i.y=t,r.BB.css(i,{width:"14px",height:"14px",backgroundColor:"#fff",boxShadow:"inset 0 0 0 2px #000",borderRadius:"14px",position:"absolute",cursor:"move",left:i.x-7+"px",top:i.y-7+"px",userSelect:"none",touchAction:"none"});var a=new r.BB.PointerListener({target:i,maxPointers:1,onPointer:function(e){e.eventPreventDefault(),"left"===e.button&&"pointermove"===e.type&&(i.x+=e.dX,i.y+=e.dY,i.style.left=i.x-7+"px",i.style.top=i.y-7+"px",n&&n(),O())}});return i.copy=function(e){i.x=e.x,i.y=e.y,i.style.left=i.x-7+"px",i.style.top=i.y-7+"px"},B.push(a),i}function N(){w.copy(t),C.copy(n),S.copy(h),k.copy(v)}}),1),b},apply:function(e){var t=e.context,n=e.history,i=e.input.before,r=e.input.after;if(!(t&&i&&r&&n))return!1;n.pause(!0);var a=(0,o.getSharedFx)();if(!a)return!1;var s=a.texture(t.canvas);return a.draw(s).multiplyAlpha().perspective(i,r).unmultiplyAlpha().update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),s.destroy(),n.pause(!1),n.push({tool:["filter","perspective"],action:"apply",params:[{input:e.input}]}),!0}}})),i.register("5vheV",(function(n,r){t(n.exports,"TwoTabs",(function(){return d}));var a=i("gFgFC"),o=i("kiQ5H"),s=i("eWjiX"),l=i("1RI49"),c="#9e9e9e",u="rgba(0,0,0,0.1)",h="#ccc",d=function(){"use strict";function t(e){var n=this;(0,a.default)(this,t),this.value=e.init,this.rootEl=s.BB.el({css:{display:"flex",justifyContent:"center"}}),this.leftTab=s.BB.el({parent:this.rootEl,content:e.left,css:{width:"150px",height:"30px",paddingTop:"10px",textAlign:"center",paddingBottom:"0",borderTopLeftRadius:"10px",backgroundSize:"8%"}}),s.BB.setEventListener(this.leftTab,"onpointerdown",(function(){return!1})),this.rightTab=s.BB.el({parent:this.rootEl,content:e.right,css:{width:"150px",height:"30px",paddingTop:"10px",textAlign:"center",paddingBottom:"0",borderTopRightRadius:"10px",backgroundSize:"8%"}}),s.BB.setEventListener(this.rightTab,"onpointerdown",(function(){return!1})),this.update(),s.BB.setEventListener(this.leftTab,"onpointerover",(function(){0!==n.value&&(n.leftTab.style.backgroundColor=h)})),s.BB.setEventListener(this.leftTab,"onpointerout",(function(){0!==n.value&&(n.leftTab.style.backgroundColor=u)})),s.BB.setEventListener(this.rightTab,"onpointerover",(function(){1!==n.value&&(n.rightTab.style.backgroundColor=h)})),s.BB.setEventListener(this.rightTab,"onpointerout",(function(){1!==n.value&&(n.rightTab.style.backgroundColor=u)})),this.leftTab.onclick=function(){0!==n.value&&(n.value=0,n.update(),e.onChange(n.value))},this.rightTab.onclick=function(){1!==n.value&&(n.value=1,n.update(),e.onChange(n.value))}}return(0,o.default)(t,[{key:"update",value:function(){0===this.value?(s.BB.css(this.leftTab,{background:"url("+e(l)+") no-repeat 12px 16px",backgroundColor:c,backgroundSize:"8%",boxShadow:"inset 0px 5px 10px rgba(0,0,0,0.5)",cursor:"default"}),s.BB.css(this.rightTab,{background:"",backgroundColor:u,backgroundSize:"8%",boxShadow:"",cursor:"pointer"})):(s.BB.css(this.rightTab,{background:"url("+e(l)+") no-repeat 12px 16px",backgroundColor:c,backgroundSize:"8%",boxShadow:"inset 0px 5px 10px rgba(0,0,0,0.5)",cursor:"default"}),s.BB.css(this.leftTab,{background:"",backgroundColor:u,backgroundSize:"8%",boxShadow:"",cursor:"pointer"}))}},{key:"getElement",value:function(){return this.rootEl}}]),t}()})),i.register("huXOx",(function(n,r){t(n.exports,"filterResize",(function(){return u}));var a=i("eWjiX"),o=i("lXqiv"),s=i("21VAD"),l=i("jfTWC"),c=i("1mH1z"),u={getDialog:function(t){var n=function(){if(0===w.value.length&&L||0===C.value.length&&k)return k=!1,void(L=!1);if(w.value=""+Math.max(1,parseInt(w.value)),C.value=""+Math.max(1,parseInt(C.value)),E&&(k&&(w.value=""+parseInt(""+parseInt(C.value)*M)),L&&(C.value=""+parseInt(""+parseInt(w.value)/M)),parseInt(w.value)>y||parseInt(C.value)>x)){var e=a.BB.fitInto(parseInt(w.value),parseInt(C.value),y,x,1);w.value=""+parseInt(""+e.width),C.value=""+parseInt(""+e.height)}parseInt(w.value)>y&&(w.value=""+y),parseInt(C.value)>x&&(C.value=""+x),k=!1,L=!1,m=parseInt(w.value),v=parseInt(C.value);var t=a.BB.fitInto(m,v,280,200,1),n=parseInt(""+t.width),r=parseInt(""+t.height);d=n/m;var o=a.BB.centerWithin(340,220,n,r);"smooth"===T.getValue()?(R.style.imageRendering=d>1?"pixelated":"",R.width=i.getWidth(),R.height=i.getHeight(),P.save(),P.imageSmoothingQuality="high",P.drawImage(p,0,0),a.BB.resizeCanvas(R,m,v),P.restore()):(R.style.imageRendering="pixelated",R.width=m,R.height=v,P.save(),P.imageSmoothingEnabled=!1,P.drawImage(p,0,0,R.width,R.height),P.restore()),R.style.width=Math.max(1,n)+"px",R.style.height=Math.max(1,r)+"px",D.style.left=o.x+"px",D.style.top=o.y+"px",D.style.width=Math.max(1,n)+"px",D.style.height=Math.max(1,r)+"px"},i=t.klCanvas;if(!i)return!1;var r=a.BB.fitInto(i.getWidth(),i.getHeight(),280,200,1),u=parseInt(""+r.width),h=parseInt(""+r.height),d=u/i.getWidth(),p=i.getCompleteCanvas(1),g=document.createElement("div"),f={element:g},m=i.getWidth(),v=i.getHeight();g.innerHTML=(0,c.LANG)("filter-resize-description")+"<br/><br/>";var y=t.maxWidth,x=t.maxHeight,b=a.BB.el({css:{width:"150px",height:"35px",lineHeight:"30px"}}),B=a.BB.el({css:{width:"150px",height:"35px",lineHeight:"30px"}}),w=a.BB.el({tagName:"input",css:{cssFloat:"right",width:"90px"},custom:{type:"number",min:"1",max:""+y,value:""+i.getWidth()}}),C=a.BB.el({tagName:"input",css:{cssFloat:"right",width:"90px"},custom:{type:"number",min:"1",max:""+x,value:""+i.getHeight()}});w.onclick=function(){this.focus(),L=!0,n()},C.onclick=function(){this.focus(),k=!0,n()},w.onchange=function(){L=!0,n()},C.onchange=function(){k=!0,n()},b.append((0,c.LANG)("width")+": ",w),B.append((0,c.LANG)("height")+": ",C);var S=a.BB.el({css:{background:"url("+e(l)+") no-repeat 140px 5px",backgroundSize:"50px 52px"}});S.append(b,B),g.appendChild(S);var k=!1,L=!1,M=i.getWidth()/i.getHeight(),E=!0,A=new(0,o.Checkbox)({init:!0,label:(0,c.LANG)("constrain-proportions"),allowTab:!0,callback:function(t){(E=t)?(w.value=""+i.getWidth(),C.value=""+i.getHeight(),S.style.background="url("+e(l)+") no-repeat 140px 5px",S.style.backgroundSize="50px 52px",n()):S.style.background=""}});g.appendChild(a.BB.el({css:{clear:"both"}}));var T=new(0,s.Select)({isFocusable:!0,optionArr:[["smooth",(0,c.LANG)("algorithm-smooth")],["pixelated",(0,c.LANG)("algorithm-pixelated")]],title:(0,c.LANG)("scaling-algorithm"),initValue:"smooth",onChange:function(){n()}}),I=a.BB.el({parent:g,css:{display:"flex",justifyContent:"space-between"}});I.appendChild(A.getElement()),I.appendChild(T.getElement());var R=a.BB.canvas(u,h);R.style.imageRendering="pixelated";var P=R.getContext("2d"),O=document.createElement("div");a.BB.css(O,{width:"340px",marginLeft:"-20px",height:"220px",display:"table",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",position:"relative",userSelect:"none",colorScheme:"only light"});var D=a.BB.appendTextDiv(O,"");return D.appendChild(R),D.style.width=u+"px",D.style.height=h+"px",D.style.position="absolute",D.style.overflow="hidden",D.style.boxShadow="0 0 5px rgba(0,0,0,0.8)",D.style.overflow="hidden",a.BB.createCheckerDataUrl(8,(function(e){O.style.background="url("+e+")"})),g.appendChild(O),n(),f.destroy=function(){A.destroy()},f.getInput=function(){return f.destroy(),{width:m,height:v,algorithm:T.getValue()}},f},apply:function(e){var t=e.klCanvas,n=e.history,i=e.input.width,r=e.input.height,a=e.input.algorithm;return!(!t||!n)&&(n.pause(!0),t.resize(i,r,a),n.pause(!1),n.push({tool:["filter","resize"],action:"apply",params:[{input:e.input}]}),!0)}}})),i.register("jfTWC",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("2BZYe")})),i.register("dsRff",(function(e,n){t(e.exports,"filterRotate",(function(){return o}));var r=i("eWjiX"),a=i("1mH1z"),o={getDialog:function(e){var t=function(){if(v.style.WebkitTransform="rotate("+d+"deg)",v.style.MozTransform="rotate("+d+"deg)",v.style.OTransform="rotate("+d+"deg)",v.style.msTransform="rotate("+d+"deg)",90===Math.abs(d%180)){var e=r.BB.fitInto(s,o,280,200,1),t=parseInt(""+e.height)/o;v.style.WebkitTransform="rotate("+d+"deg) scale("+t+")",v.style.MozTransform="rotate("+d+"deg) scale("+t+")",v.style.OTransform="rotate("+d+"deg) scale("+t+")",v.style.msTransform="rotate("+d+"deg) scale("+t+")"}},n=e.klCanvas;if(!n)return!1;var i=r.BB.fitInto(n.getWidth(),n.getHeight(),280,200,1),o=parseInt(""+i.width),s=parseInt(""+i.height),l=o/n.getWidth(),c=r.BB.canvas(o,s);c.style.display="block",c.getContext("2d").drawImage(n.getCompleteCanvas(l),0,0,o,s);var u=document.createElement("div"),h={element:u},d=0;u.innerHTML=(0,a.LANG)("filter-rotate-description")+"<br/><br/>";var p=document.createElement("button");p.innerHTML="<span style='font-size: 1.3em'>⟳</span> 90°";var g=document.createElement("button");g.innerHTML="<span style='font-size: 1.3em'>⟲</span> 90°",g.style.marginRight="5px",p.onclick=function(){d+=90,t()},g.onclick=function(){d-=90,t()},u.appendChild(g),u.appendChild(p);var f=document.createElement("div");r.BB.css(f,{width:"340px",marginLeft:"-20px",height:"220px",display:"table",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",colorScheme:"only light"});var m=document.createElement("div");m.style.display="table-cell",m.style.verticalAlign="middle";var v=r.BB.appendTextDiv(m,"");return v.appendChild(c),f.appendChild(m),v.style.width=o+"px",v.style.height=s+"px",v.style.marginLeft="auto",v.style.marginRight="auto",v.style.boxShadow="0 0 5px rgba(0,0,0,0.8)",v.style.overflow="hidden",r.BB.createCheckerDataUrl(4,(function(e){v.style.background="url("+e+")"})),v.style.transition="all 0.2s ease-out",u.appendChild(f),t(),h.getInput=function(){return{deg:d}},h},apply:function(e){var t=e.klCanvas,n=e.history,i=e.input.deg;return!(!t||!n)&&(n.pause(!0),t.rotate(i),n.pause(!1),n.push({tool:["filter","rotate"],action:"apply",params:[{input:e.input}]}),!0)}}})),i.register("lhchB",(function(e,n){t(e.exports,"filterTiltShift",(function(){return u}));var r=i("eWjiX"),a=i("cH2YE"),o=i("llzZ0"),s=i("i5nyl"),l=i("5RaQo"),c=i("1mH1z"),u={getDialog:function(e){var t=e.context,n=e.klCanvas;if(!t||!n)return!1;var i=n.getLayers(),u=n.getLayerIndex(t.canvas),h=r.BB.fitInto(t.canvas.width,t.canvas.height,280,200,1),d=parseInt(""+h.width),p=parseInt(""+h.height),g=Math.min(d,t.canvas.width),f=Math.min(p,t.canvas.height),m=r.BB.canvas(g,f),v=m.getContext("2d");v.save(),g>t.canvas.width&&(v.imageSmoothingEnabled=!1),v.drawImage(t.canvas,0,0,g,f),v.restore();var y=g/t.canvas.width,x=d/t.canvas.width,b=document.createElement("div"),B={element:b},w=[];return setTimeout((function(){var e=20,t=200;b.innerHTML=(0,c.LANG)("filter-tilt-shift-description")+"<br/><br/>";var n=(0,l.getSharedFx)();if(n){var h,g,f=n.texture(m);n.draw(f).update(),h=T(parseInt(""+d/6),parseInt(""+p/2)),g=T(parseInt(""+(d-d/6)),parseInt(""+(p-p/3)));var v=new(0,o.KlSlider)({label:(0,c.LANG)("filter-tilt-shift-blur"),width:300,height:30,min:0,max:200,value:e,eventResMs:a.eventResMs,onChange:function(t){e=t,A()}});v.getElement().style.marginBottom="10px",b.appendChild(v.getElement());var C=new(0,o.KlSlider)({label:(0,c.LANG)("filter-tilt-shift-gradient"),width:300,height:30,min:0,max:1e3,value:t,eventResMs:a.eventResMs,onChange:function(e){t=e,A()}});b.appendChild(C.getElement());var S=document.createElement("div");S.oncontextmenu=function(){return!1},r.BB.css(S,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var k=[],L=0;L<i.length;L++)k.push({image:L===u?n:i[L].context.canvas,opacity:i[L].opacity,mixModeStr:i[L].mixModeStr});var M=new(0,s.KlCanvasPreview)({width:parseInt(""+d),height:parseInt(""+p),layers:k}),E=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+d)+"px",height:parseInt(""+p)+"px"}});E.appendChild(M.getElement()),S.appendChild(E),E.appendChild(h),E.appendChild(g),b.appendChild(S),A(),B.destroy=function(){for(var e=0;e<w.length;e++)w[e].destroy();v.destroy(),C.destroy(),f.destroy()},B.getInput=function(){return B.destroy(),{a:{x:h.x/x,y:h.y/x},b:{x:g.x/x,y:g.y/x},blur:e,gradient:t}}}function A(){try{n.draw(f).tiltShift(h.x/x*y,h.y/x*y,g.x/x*y,g.y/x*y,e*y,t*y).update(),M.render()}catch(e){b.errorCallback(e)}}function T(e,t){var n=r.BB.el({css:{width:"14px",height:"14px",backgroundColor:"#fff",boxShadow:"inset 0 0 0 2px #000",borderRadius:"14px",position:"absolute",cursor:"move",left:e-7+"px",top:t-7+"px",userSelect:"none",touchAction:"none"}});n.x=e,n.y=t;var i=new r.BB.PointerListener({target:n,maxPointers:1,onPointer:function(e){e.eventPreventDefault(),"left"===e.button&&"pointermove"===e.type&&(n.x+=e.dX,n.y+=e.dY,n.style.left=n.x-7+"px",n.style.top=n.y-7+"px",A())}});return w.push(i),n}}),1),B},apply:function(e){var t=e.context,n=e.history,i=e.input.a,r=e.input.b,a=e.input.blur,o=e.input.gradient;if(!t||!n)return!1;n.pause(!0);var s=(0,l.getSharedFx)();if(!s)return!1;var c=s.texture(t.canvas);return s.draw(c).tiltShift(i.x,i.y,r.x,r.y,a,o).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(s,0,0),c.destroy(),n.pause(!1),n.push({tool:["filter","tiltShift"],action:"apply",params:[{input:e.input}]}),!0}}})),i.register("lXpcU",(function(e,n){t(e.exports,"filterTransform",(function(){return u}));var r=i("eWjiX"),a=i("lXqiv"),o=i("i5nyl"),s=i("cNhNm"),l=i("21VAD"),c=i("1mH1z"),u={getDialog:function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(h){var t=h.getTransform();if(JSON.stringify(t)!==Z||e){Z=JSON.stringify(t),b<1&&(t.x*=b,t.y*=b,t.width*=b,t.height*=b);var n=q[g].image,i=n.getContext("2d");i.save(),i.clearRect(0,0,n.width,n.height),r.BB.drawTransformedImageWithBounds(i,p[g].context.canvas,t,B,"pixelated"===W.getValue()||r.BB.testShouldPixelate(t,t.width/w.width,t.height/w.height)),i.restore(),$.render()}}},n=function(){h.setPos({x:parseInt(T.value)+w.x,y:parseInt(A.value)+w.y}),h.setAngleDeg(parseInt(I.value)),t()},i=e.context,u=e.klCanvas;if(!i||!u)return!1;var h,d=window.innerWidth<550,p=u.getLayers(),g=u.getLayerIndex(i.canvas),f=r.BB.fitInto(i.canvas.width,i.canvas.height,d?280:490,d?200:240,1),m=parseInt(""+f.width),v=parseInt(""+f.height),y=Math.min(m,i.canvas.width),x=Math.min(v,i.canvas.height),b=m/i.canvas.width,B=r.BB.canvasBounds(i);if(null===B)return alert((0,c.LANG)("filter-transform-empty")),!1;var w={x:B.x+B.width/2,y:B.y+B.height/2,width:B.width,height:B.height,angleDeg:0},C=document.createElement("div"),S={element:C};d||(S.width=500),C.innerHTML=(0,c.LANG)("filter-transform-description");var k=new r.BB.KeyListener({onDown:function(e){r.BB.isInputFocused(!0)||("left"===e&&(T.value=""+(parseFloat(T.value)-1),n()),"right"===e&&(T.value=""+(parseFloat(T.value)+1),n()),"up"===e&&(A.value=""+(parseFloat(A.value)-1),n()),"down"===e&&(A.value=""+(parseFloat(A.value)+1),n()))}}),L=document.createElement("div"),M=document.createElement("div"),E=document.createElement("div"),A=document.createElement("input"),T=document.createElement("input"),I=document.createElement("input");(L.style.width="100px",L.style.height="30px",M.style.width="100px",M.style.height="30px",M.style.display="inline-block",L.style.display="inline-block",E.style.display="inline-block",E.style.width="150px",E.style.height="30px",A.type="number",T.type="number",I.type="number",T.style.width="70px",A.style.width="70px",I.style.width="70px",A.value="0",T.value="0",I.value="0",A.onclick=function(){this.focus(),n()},T.onclick=function(){this.focus(),n()},I.onclick=function(){this.focus(),n()},A.onchange=function(){n()},T.onchange=function(){n()},I.onchange=function(){n()},A.onkeyup=function(){n()},T.onkeyup=function(){n()},I.onkeyup=function(){n()},L.append("X: ",T),M.append("Y: ",A),E.append((0,c.LANG)("filter-transform-rotation")+": ",I),d)||r.BB.el({parent:C,css:{marginTop:"10px"}}).append(L,M,E);var R={marginLeft:"10px",marginTop:"10px"},P=r.BB.el({parent:C,css:{display:"flex",flexWrap:"wrap",marginLeft:"-10px"}}),O=r.BB.el({parent:P,tagName:"button",content:(0,c.LANG)("filter-transform-flip")+" X",onClick:function(){var e=h.getTransform();h.setSize(-e.width,e.height)},css:R}),D=r.BB.el({parent:P,tagName:"button",content:(0,c.LANG)("filter-transform-flip")+" Y",onClick:function(){var e=h.getTransform();h.setSize(e.width,-e.height)},css:R}),N=r.BB.el({parent:P,tagName:"button",content:"-90°",onClick:function(){var e=h.getTransform();e.angleDeg-=90,e.angleDeg%=360,h.setAngleDeg(e.angleDeg),I.value=""+Math.round(e.angleDeg),t()},css:R}),z=r.BB.el({parent:P,tagName:"button",content:"+90°",onClick:function(){var e=h.getTransform();e.angleDeg+=90,e.angleDeg%=360,h.setAngleDeg(e.angleDeg),I.value=""+Math.round(e.angleDeg),t()},css:R}),G=r.BB.el({parent:P,tagName:"button",content:"2x",onClick:function(){var e=h.getTransform();F.getValue()?h.setSize(h.getRatio()*e.height*2,2*e.height):h.setSize(2*e.width,2*e.height)},css:R}),j=r.BB.el({parent:P,tagName:"button",content:"1/2x",onClick:function(){var e=h.getTransform();h.setSize(Math.round(e.width/2),Math.round(e.height/2))},css:R}),H=r.BB.el({parent:P,tagName:"button",content:(0,c.LANG)("center"),onClick:function(){var e=h.getTransform();h.setPos({x:i.canvas.width/2,y:i.canvas.height/2}),h.setAngleDeg(e.angleDeg),t()},css:R}),X=!0,F=new(0,a.Checkbox)({init:!0,label:(0,c.LANG)("filter-transform-constrain"),title:(0,c.LANG)("constrain-proportions"),allowTab:!0,callback:function(e){X=e,h.setConstrained(X)},css:{display:"inline-block"}}),U=!1,V=new(0,a.Checkbox)({init:!0,label:(0,c.LANG)("filter-transform-snap"),title:(0,c.LANG)("filter-transform-snap-title"),allowTab:!0,callback:function(e){U=e,h.setSnapping(U)},css:{display:"inline-block",marginLeft:"10px"}}),Y=r.BB.el({});Y.append(F.getElement(),V.getElement()),C.appendChild(r.BB.el({css:{clear:"both",height:"10px"}}));var K=r.BB.el({parent:C,css:{display:"flex",justifyContent:"space-between"}}),W=new(0,l.Select)({isFocusable:!0,optionArr:[["smooth",(0,c.LANG)("algorithm-smooth")],["pixelated",(0,c.LANG)("algorithm-pixelated")]],initValue:"smooth",title:(0,c.LANG)("scaling-algorithm"),onChange:function(){t(!0)}});K.append(Y,W.getElement());var _=document.createElement("div");_.oncontextmenu=function(){return!1},r.BB.css(_,{width:d?"340px":"540px",marginLeft:"-20px",height:d?"260px":"300px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var q=[],Q=0;Q<p.length;Q++){var J=void 0;if(Q===g)(J=r.BB.canvas(parseInt(""+y),parseInt(""+x))).getContext("2d").drawImage(p[Q].context.canvas,0,0,J.width,J.height);else J=p[Q].context.canvas;q.push({image:J,opacity:p[Q].opacity,mixModeStr:p[Q].mixModeStr})}var Z,$=new(0,o.KlCanvasPreview)({width:parseInt(""+m),height:parseInt(""+v),layers:q}),ee=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+m)+"px",height:parseInt(""+v)+"px"}});return ee.appendChild($.getElement()),_.appendChild(ee),h=new(0,s.FreeTransform)({x:w.x,y:w.y,width:w.width,height:w.height,angleDeg:w.angleDeg,isConstrained:!0,snapX:[0,i.canvas.width],snapY:[0,i.canvas.height],callback:function(e){T.value=""+Math.round(e.x-w.x),A.value=""+Math.round(e.y-w.y),I.value=""+Math.round(e.angleDeg),t()},scale:b}),r.BB.css(h.getElement(),{position:"absolute",left:"0",top:"0"}),ee.appendChild(h.getElement()),t(),C.appendChild(_),S.destroy=function(){k.destroy(),h.destroy(),F.destroy(),V.destroy(),r.BB.destroyEl(O),r.BB.destroyEl(D),r.BB.destroyEl(N),r.BB.destroyEl(z),r.BB.destroyEl(G),r.BB.destroyEl(j),r.BB.destroyEl(H)},S.getInput=function(){var e=h.getTransform(),t={transform:e,bounds:B,isPixelated:"pixelated"===W.getValue()||r.BB.testShouldPixelate(e,e.width/w.width,e.height/w.height)};return S.destroy(),JSON.parse(JSON.stringify(t))},S},apply:function(e){var t=e.context,n=e.history;if(!t||!n)return!1;n.pause(!0);var i=e.input,a=r.BB.copyCanvas(t.canvas);return t.clearRect(0,0,t.canvas.width,t.canvas.height),r.BB.drawTransformedImageWithBounds(t,a,i.transform,i.bounds,i.isPixelated),n.pause(!1),n.push({tool:["filter","transform"],action:"apply",params:[{input:i}]}),!0}}})),i.register("1CjeM",(function(e,n){t(e.exports,"filterBlur",(function(){return u}));var r=i("eWjiX"),a=i("llzZ0"),o=i("cH2YE"),s=i("i5nyl"),l=i("5RaQo"),c=i("1mH1z"),u={getDialog:function(e){var t=e.klCanvas,n=e.context;if(!t||!n)return!1;var i=t.getLayers(),u=t.getLayerIndex(n.canvas),h=r.BB.fitInto(n.canvas.width,n.canvas.height,280,200,1),d=parseInt(""+h.width),p=parseInt(""+h.height),g=Math.min(d,n.canvas.width),f=Math.min(p,n.canvas.height),m=r.BB.canvas(g,f),v=m.getContext("2d");v.save(),g>n.canvas.width&&(v.imageSmoothingEnabled=!1),v.drawImage(n.canvas,0,0,g,f),v.restore();var y=g/n.canvas.width,x=document.createElement("div"),b={element:x};return setTimeout((function(){var e=10;x.innerHTML=(0,c.LANG)("filter-triangle-blur-description")+"<br/><br/>";var t=(0,l.getSharedFx)();if(t){var n=t.texture(m);t.draw(n).update();var h=new(0,a.KlSlider)({label:(0,c.LANG)("radius"),width:300,height:30,min:1,max:200,value:e,eventResMs:o.eventResMs,onChange:function(i){e=i,t.draw(n).triangleBlur(e*y).update(),B.render()}});x.appendChild(h.getElement());var g=document.createElement("div");r.BB.css(g,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var f=[],v=0;v<i.length;v++)f.push({image:v===u?t:i[v].context.canvas,opacity:i[v].opacity,mixModeStr:i[v].mixModeStr});var B=new(0,s.KlCanvasPreview)({width:parseInt(""+d),height:parseInt(""+p),layers:f}),w=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+d)+"px",height:parseInt(""+p)+"px"}});w.appendChild(B.getElement()),g.appendChild(w),x.appendChild(g);try{t.draw(n).triangleBlur(e*y).update(),B.render()}catch(e){x.errorCallback(e)}b.destroy=function(){n.destroy(),h.destroy()},b.getInput=function(){return b.destroy(),{radius:e}}}}),1),b},apply:function(e){var t=e.context,n=e.history,i=e.input.radius;if(!t||!i||!n)return!1;n.pause(!0);var r=(0,l.getSharedFx)();if(!r)return!1;var a=r.texture(t.canvas);return r.draw(a).triangleBlur(i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(r,0,0),a.destroy(),n.pause(!1),n.push({tool:["filter","blur"],action:"apply",params:[{input:e.input}]}),!0}}})),i.register("dNWKZ",(function(e,n){t(e.exports,"filterUnsharpMask",(function(){return u}));var r=i("eWjiX"),a=i("cH2YE"),o=i("llzZ0"),s=i("i5nyl"),l=i("5RaQo"),c=i("1mH1z"),u={getDialog:function(e){var t=e.context,n=e.klCanvas;if(!t||!n)return!1;var i=n.getLayers(),u=n.getLayerIndex(t.canvas),h=r.BB.fitInto(t.canvas.width,t.canvas.height,280,200,1),d=parseInt(""+h.width),p=parseInt(""+h.height),g=Math.min(d,t.canvas.width),f=Math.min(p,t.canvas.height),m=r.BB.canvas(g,f),v=m.getContext("2d");v.save(),g>t.canvas.width&&(v.imageSmoothingEnabled=!1),v.drawImage(t.canvas,0,0,g,f),v.restore();var y=g/t.canvas.width,x=document.createElement("div"),b={element:x};return setTimeout((function(){var e=2,t=.51;x.innerHTML=(0,c.LANG)("filter-unsharp-mask-description")+"<br/><br/>";var n=(0,l.getSharedFx)();if(n){var h=n.texture(m);n.draw(h).update();var g=new(0,o.KlSlider)({label:(0,c.LANG)("radius"),width:300,height:30,min:0,max:200,value:2,eventResMs:a.eventResMs,onChange:function(i){e=i,n.draw(h).unsharpMask(e*y,t).update(),C.render()},curve:[[0,0],[.1,2],[.5,50],[1,200]]}),f=new(0,o.KlSlider)({label:(0,c.LANG)("filter-unsharp-mask-strength"),width:300,height:30,min:0,max:50,value:5.1,eventResMs:a.eventResMs,onChange:function(i){t=i/10,n.draw(h).unsharpMask(e*y,t).update(),C.render()},curve:[[0,0],[.1,2],[.5,10],[1,50]]});g.getElement().style.marginBottom="10px",x.appendChild(g.getElement()),x.appendChild(f.getElement());var v=document.createElement("div");r.BB.css(v,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var B=[],w=0;w<i.length;w++)B.push({image:w===u?n:i[w].context.canvas,opacity:i[w].opacity,mixModeStr:i[w].mixModeStr});var C=new(0,s.KlCanvasPreview)({width:parseInt(""+d),height:parseInt(""+p),layers:B}),S=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+d)+"px",height:parseInt(""+p)+"px"}});S.appendChild(C.getElement()),v.appendChild(S),x.appendChild(v);try{n.draw(h).unsharpMask(e*y,t).update(),C.render()}catch(e){x.errorCallback(e)}b.destroy=function(){g.destroy(),f.destroy(),h.destroy()},b.getInput=function(){return b.destroy(),{radius:e,strength:t}}}}),1),b},apply:function(e){var t=e.context,n=e.history,i=e.input.radius,r=e.input.strength;if(!t||null===i||null===r||!n)return!1;n.pause(!0);var a=(0,l.getSharedFx)();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).unsharpMask(i,r).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),n.pause(!1),n.push({tool:["filter","unsharpMask"],action:"apply",params:[{input:e.input}]}),!0}}})),i.register("94Tq7",(function(e,n){t(e.exports,"filterToAlpha",(function(){return u}));var r=i("eWjiX"),a=i("iskOY"),o=i("9A7OD"),s=i("i5nyl"),l=i("5RaQo"),c=i("1mH1z"),u={getDialog:function(e){var t=e.context,n=e.klCanvas;if(!t||!n)return!1;var i=n.getLayers(),u=n.getLayerIndex(t.canvas),h=r.BB.fitInto(t.canvas.width,t.canvas.height,280,200,1),d=parseInt(""+h.width),p=parseInt(""+h.height),g=r.BB.canvas(d,p),f=g.getContext("2d");f.save(),g.width>t.canvas.width&&(f.imageSmoothingEnabled=!1),f.drawImage(t.canvas,0,0,d,p),f.restore();var m=document.createElement("div"),v={element:m};return setTimeout((function(){m.appendChild(r.BB.el({content:(0,c.LANG)("filter-to-alpha-description"),css:{marginBottom:"5px"}}));var t=(0,l.getSharedFx)();if(t){var n=t.texture(g);t.draw(n).update();var h="inverted-luminance",f=new(0,a.Options)({optionArr:[{id:"inverted-luminance",label:(0,c.LANG)("filter-to-alpha-inverted-lum")},{id:"luminance",label:(0,c.LANG)("filter-to-alpha-lum")}],initialId:h,onChange:function(e){h=e,L()}});m.appendChild(f.getElement());var y={r:0,g:0,b:0,a:1},x=[null,{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];x.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),x.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1});var b=new(0,o.ColorOptions)({label:(0,c.LANG)("filter-to-alpha-replace"),colorArr:x,initialIndex:1,onChange:function(e){y=e,L()}});b.getElement().style.marginTop="10px",m.appendChild(b.getElement());var B=document.createElement("div");r.BB.css(B,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var w=[],C=0;C<i.length;C++)w.push({image:C===u?t:i[C].context.canvas,opacity:i[C].opacity,mixModeStr:i[C].mixModeStr});var S=new(0,s.KlCanvasPreview)({width:parseInt(""+d),height:parseInt(""+p),layers:w}),k=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+d)+"px",height:parseInt(""+p)+"px"}});k.appendChild(S.getElement()),B.appendChild(k),m.appendChild(B),setTimeout((function(){try{L()}catch(e){m.errorCallback(e)}}),1),v.destroy=function(){n.destroy(),f.destroy()},v.getInput=function(){return v.destroy(),{sourceId:h,selectedRgbaObj:y}}}function L(){t.draw(n).toAlpha("inverted-luminance"===h,y).update(),S.render()}}),1),v},apply:function(e){var t=e.context,n=e.history,i=e.input.sourceId,r=e.input.selectedRgbaObj;if(!t||!i||!n)return!1;n.pause(!0);var a=(0,l.getSharedFx)();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).toAlpha("inverted-luminance"===i,r).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),n.pause(!1),n.push({tool:["filter","toAlpha"],action:"apply",params:[{input:e.input}]}),!0}}})),i.register("d8Fqy",(function(e,n){t(e.exports,"filterGrid",(function(){return u}));var r=i("eWjiX"),a=i("i5nyl"),o=i("1mH1z"),s=i("c4LUw"),l=i("9A7OD"),c=i("1xi6g"),u={getDialog:function(e){var t=function(){var e=I.image.getContext("2d");e.save(),e.clearRect(0,0,f,m),e.drawImage(n.canvas,0,0,f,m),(0,c.drawGrid)(e,b.x,b.y,Math.max(b.thickness*v,1),b.color,b.opacity),e.restore(),R.render()},n=e.context,i=e.klCanvas;if(!n||!i)return!1;var u=i.getLayers(),h=i.getLayerIndex(n.canvas),d=r.BB.fitInto(n.canvas.width,n.canvas.height,280,200,1),p=parseInt(""+d.width),g=parseInt(""+d.height),f=Math.min(p,n.canvas.width),m=Math.min(g,n.canvas.height),v=f/n.canvas.width,y=document.createElement("div"),x={element:y};y.innerHTML=(0,o.LANG)("filter-grid-description")+"<br/><br/>";var b={x:2,y:2,thickness:2,color:"#000",opacity:1},B=r.BB.el({parent:y,css:{display:"flex",alignItems:"center"}}),w=r.BB.el({parent:y,css:{display:"flex",alignItems:"center",marginTop:"10px"}}),C=(0,s.input)({init:2,type:"number",min:1,css:{width:"75px",marginRight:"20px"},callback:function(e){b.x=parseFloat(e),t()}}),S=(0,s.input)({init:2,type:"number",min:1,css:{width:"75px",marginRight:"20px"},callback:function(e){b.y=parseFloat(e),t()}}),k=(0,s.input)({init:2,type:"number",min:1,css:{width:"75px",marginRight:"20px"},callback:function(e){b.thickness=parseFloat(e),t()}}),L={r:0,g:0,b:0,a:1},M=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];M.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),M.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1}),b.color=r.BB.ColorConverter.toRgbStr(L);var E=new(0,l.ColorOptions)({label:(0,o.LANG)("shape-stroke"),colorArr:M,onChange:function(e){L=e,b.color=r.BB.ColorConverter.toRgbStr(L),t()}}),A={display:"inline-block",marginRight:"5px"};B.append(r.BB.el({content:"X:",css:A}),C,r.BB.el({content:"Y:",css:A}),S),w.append(r.BB.el({content:(0,o.LANG)("shape-line-width")+":",css:A}),k,r.BB.el({css:{flexGrow:"1"}}),E.getElement());var T=document.createElement("div");r.BB.css(T,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});var I={image:r.BB.canvas(f,m),opacity:u[h].opacity,mixModeStr:u[h].mixModeStr},R=new(0,a.KlCanvasPreview)({width:Math.round(p),height:Math.round(g),layers:u.map((function(e,t){return t===h?I:{image:e.context.canvas,opacity:e.opacity,mixModeStr:e.mixModeStr}}))}),P=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+p)+"px",height:parseInt(""+g)+"px"}});return P.appendChild(R.getElement()),T.appendChild(P),setTimeout(t,0),y.appendChild(T),x.destroy=function(){},x.getInput=function(){return x.destroy(),r.BB.copyObj(b)},x},apply:function(e){var t=e.context,n=e.klCanvas,i=e.history;return!!(t&&n&&i)&&(i.pause(!0),(0,c.drawGrid)(t,e.input.x,e.input.y,e.input.thickness,e.input.color,e.input.opacity),i.pause(!1),i.push({tool:["filter","grid"],action:"apply",params:[{input:e.input}]}),!0)}}})),i.register("1xi6g",(function(e,n){function i(e,t,n,i,r,a){e.save();var o=e.canvas.width,s=e.canvas.height,l=(i=Math.round(i))%2==0;e.beginPath(),e.lineWidth=i,e.strokeStyle=r,e.globalAlpha=a;for(var c=0;c<t-1;c++){var u=o/t*(c+1);u=l?Math.round(u):Math.round(u+.5)-.5,e.moveTo(u,0),e.lineTo(u,s)}for(var h=0;h<n-1;h++){var d=s/n*(h+1);d=l?Math.round(d):Math.round(d+.5)-.5,e.moveTo(0,d),e.lineTo(o,d)}e.stroke(),e.restore()}t(e.exports,"drawGrid",(function(){return i}))})),i.register("gtdB1",(function(e,n){t(e.exports,"filterNoise",(function(){return y}));var r=i("eWjiX"),a=i("i5nyl"),o=i("1mH1z"),s=i("llzZ0"),l=i("5RaQo"),c=i("iskOY"),u=i("cH2YE"),h=i("21VAD"),d=i("bBcC4"),p=i("hrnUX"),g=i("dJ1E2"),f=i("lXqiv"),m=[{type:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0,octaves:1,samples:1,peaks:0,brightness:0,contrast:0,isReversed:!0},{type:1,scaleX:166,scaleY:164,offsetX:105,offsetY:30,octaves:6,samples:1,peaks:0,brightness:.055,contrast:.23,isReversed:!0},{type:1,scaleX:235,scaleY:190,offsetX:3227,offsetY:2156,octaves:4,samples:16,peaks:22,brightness:-.375,contrast:1,isReversed:!1},{type:1,scaleX:40,scaleY:40,offsetX:0,offsetY:0,octaves:1,samples:1,peaks:0,brightness:0,contrast:0,isReversed:!1},{type:0,scaleX:26,scaleY:26,offsetX:557,offsetY:365,octaves:1,samples:1,peaks:0,brightness:.02,contrast:1,isReversed:!0},{type:1,scaleX:1500,scaleY:1500,offsetX:745,offsetY:2871,octaves:5,samples:16,peaks:156.02,brightness:.03,contrast:1,isReversed:!0},{type:1,scaleX:11,scaleY:11,offsetX:2940,offsetY:2045,octaves:1,samples:16,peaks:1,brightness:-.045,contrast:1,isReversed:!0},{type:2,scaleX:74,scaleY:74,offsetX:4816,offsetY:1304,octaves:3,samples:1,peaks:2.78,brightness:0,contrast:0,isReversed:!1}];function v(e,t){e.noise(t.seed?t.seed:0,t.type,[t.scaleX,t.scaleY],[e.width/2,e.height/2],t.octaves,t.samples,t.peaks,t.brightness,t.contrast,t.isReversed,t.colA,t.colB,t.channels?t.channels:"rgb").update()}var y={getDialog:function(e){var t=function(){var e=_.image.getContext("2d");e.save(),e.clearRect(0,0,C,S),e.drawImage(n.canvas,0,0,C,S),e.globalAlpha=O.opacity;var t=r.BB.copyObj(m[O.presetIndex]);t.seed=O.seed,t.scaleX=t.scaleX*O.scale/50*k,t.scaleY=t.scaleY*O.scale/50*k,t.colA=O.colA,t.colB=O.colB,t.isReversed=O.isReversed?!t.isReversed:t.isReversed,t.channels=O.channels,v(L,t),"alpha"===O.channels?e.globalCompositeOperation="destination-out":e.globalCompositeOperation=O.mixModeStr,e.drawImage(L,0,0),e.restore(),q.render()},n=e.context,i=e.klCanvas;if(!n||!i)return!1;var y=i.getLayers(),x=i.getLayerIndex(n.canvas),b=r.BB.fitInto(n.canvas.width,n.canvas.height,280,200,1),B=parseInt(""+b.width),w=parseInt(""+b.height),C=Math.min(B,n.canvas.width),S=Math.min(w,n.canvas.height),k=C/n.canvas.width,L=(0,l.getSharedFx)();if(L){var M,E=[],A=r.BB.canvas(32,32),T=A.getContext("2d");M=L.texture(A),L.draw(M).update(),M.destroy(),m.forEach((function(e,t){var n=new Image,i=r.BB.copyObj(e);i.scaleX/=10,i.scaleY/=10,v(L,i),T.drawImage(L,0,0),n.src=A.toDataURL("image/png"),E.push(n)}));var I=r.BB.canvas(C,S);M=L.texture(I),L.draw(M).update(),I=null;var R=document.createElement("div"),P={element:R};R.innerHTML=(0,o.LANG)("filter-noise-description")+"<br/><br/>";var O={seed:300*Math.random(),presetIndex:0,scale:50,opacity:.5,isReversed:!1,channels:"rgb",mixModeStr:"source-over",colA:{r:0,g:0,b:0},colB:{r:255,g:255,b:255}},D=new(0,c.Options)({optionArr:E.map((function(e,t){return r.BB.css(e,{margin:"1px",borderRadius:"3px",transition:"all 0.1s ease-in-out"}),{id:""+t,label:e}})),initialId:"0",onChange:function(e){O.presetIndex=Number(e),t()}});D.getElement().style.marginBottom="10px",R.append(D.getElement());var N=new(0,s.KlSlider)({label:(0,o.LANG)("filter-noise-scale"),width:300,height:30,min:1,max:1e3,value:O.scale,eventResMs:u.eventResMs,curve:r.BB.quadraticSplineInput(1,1e3,.1),onChange:function(e){O.scale=e,t()}});N.getElement().style.marginBottom="10px";var z=new(0,s.KlSlider)({label:(0,o.LANG)("opacity"),width:300,height:30,min:.01,max:1,value:O.opacity,eventResMs:u.eventResMs,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e},onChange:function(e){O.opacity=e,t()}});z.getElement().style.marginBottom="10px";var G=r.BB.el({css:{display:"flex",alignItems:"center",marginBottom:"10px"}}),j=r.BB.el({css:{display:"flex"}}),H=new(0,c.Options)({optionArr:[{id:"rgb",label:"RGB"},{id:"alpha",label:(0,o.LANG)("filter-noise-alpha")}],initialId:"rgb",onChange:function(e){O.channels=e,j.style.visibility="rgb"===e?"":"hidden",t()}}),X=new(0,f.Checkbox)({label:(0,o.LANG)("reverse"),callback:function(e){O.isReversed=e,t()},allowTab:!0}),F=new(0,h.Select)({isFocusable:!0,optionArr:["source-over",null,"darken","multiply","color-burn",null,"lighten","screen","color-dodge",null,"overlay","soft-light","hard-light",null,"difference","exclusion",null,"hue","saturation","color","luminosity"].map((function(e){return e?[e,(0,d.translateBlending)(e)]:null})),initValue:O.mixModeStr,onChange:function(e){O.mixModeStr=e,t()}});F.getElement().title=(0,o.LANG)("layers-blending");var U=r.BB.el({css:{display:"flex"}}),V={width:"34px",height:"34px",marginRight:"5px"},Y=p.KL.input({type:"color",init:"#"+g.ColorConverter.toHexString(O.colA),callback:function(e){O.colA=g.ColorConverter.hexToRGB(e),t()},css:V}),K=p.KL.input({type:"color",init:"#"+g.ColorConverter.toHexString(O.colB),callback:function(e){O.colB=g.ColorConverter.hexToRGB(e),t()},css:V});U.append(Y,K),G.append(H.getElement(),r.BB.el({css:{flexGrow:"1"}}),X.getElement()),j.append(F.getElement(),r.BB.el({css:{flexGrow:"1"}}),U),R.append(N.getElement(),z.getElement(),G,j);var W=document.createElement("div");r.BB.css(W,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});var _={image:r.BB.canvas(C,S),opacity:y[x].opacity,mixModeStr:y[x].mixModeStr},q=new(0,a.KlCanvasPreview)({width:Math.round(B),height:Math.round(w),layers:y.map((function(e,t){return t===x?_:{image:e.context.canvas,opacity:e.opacity,mixModeStr:e.mixModeStr}}))}),Q=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+B)+"px",height:parseInt(""+w)+"px"}});return Q.appendChild(q.getElement()),W.appendChild(Q),setTimeout(t,0),R.appendChild(W),P.destroy=function(){D.destroy(),N.destroy(),z.destroy(),X.destroy(),H.destroy(),M.destroy(),F.destroy()},P.getInput=function(){return P.destroy(),r.BB.copyObj(O)},P}},apply:function(e){var t=e.context,n=e.klCanvas,i=e.history;if(!t||!n||!i)return!1;i.pause(!0);var a=(0,l.getSharedFx)();if(!a)return!1;var o=a.texture(t.canvas);a.draw(o).update(),o.destroy();var s=e.input,c=r.BB.copyObj(m[s.presetIndex]);return c.seed=s.seed,c.scaleX=c.scaleX*s.scale/50,c.scaleY=c.scaleY*s.scale/50,c.colA=s.colA,c.colB=s.colB,c.isReversed=s.isReversed?!c.isReversed:c.isReversed,c.channels=s.channels,v(a,c),t.save(),t.globalAlpha=s.opacity,"alpha"===s.channels?t.globalCompositeOperation="destination-out":t.globalCompositeOperation=s.mixModeStr,t.drawImage(a,0,0),t.restore(),i.pause(!1),i.push({tool:["canvas"],action:"replaceLayer",params:[n.getLayerIndex(t.canvas),t.getImageData(0,0,t.canvas.width,t.canvas.height)]}),!0}}})),i.register("lQzx7",(function(e,n){t(e.exports,"filterPattern",(function(){return d}));var r=i("eWjiX"),a=i("c4LUw"),o=i("llzZ0"),s=i("1mH1z"),l=i("cH2YE"),c=i("i5nyl"),u=i("5vheV");function h(e,t){var n=t.blend?Math.round(t.blend*t.width/2):0,i=t.blend?Math.round(t.blend*t.height/2):0,a=r.BB.canvas(t.width,t.height);if(t.blend){var o=r.BB.canvas(2*t.width,2*t.height),s=o.getContext("2d"),l="#0000",c="#000";s.drawImage(e.canvas,-t.x+n,-t.y+i),s.save();var u=s.createLinearGradient(0,t.height,0,2*t.height);u.addColorStop(0,c),u.addColorStop(t.blend,l),s.globalCompositeOperation="destination-in",s.fillStyle=u,s.fillRect(0,0,o.width,o.height),s.restore(),s.save(),(u=s.createLinearGradient(0,0,0,t.height)).addColorStop(0,l),u.addColorStop(t.blend,c),s.globalCompositeOperation="destination-in",s.fillStyle=u,s.fillRect(0,0,2*t.width,2*t.height),s.restore(),s.save(),s.globalCompositeOperation="lighter",s.drawImage(o,0,-t.height),s.restore(),s.save(),(u=s.createLinearGradient(t.width,0,2*t.width,0)).addColorStop(0,c),u.addColorStop(t.blend,l),s.globalCompositeOperation="destination-in",s.fillStyle=u,s.fillRect(0,0,o.width,o.height),s.restore(),s.save(),(u=s.createLinearGradient(0,0,t.width,0)).addColorStop(0,l),u.addColorStop(t.blend,c),s.globalCompositeOperation="destination-in",s.fillStyle=u,s.fillRect(0,0,2*t.width,2*t.height),s.restore(),s.save(),s.globalCompositeOperation="lighter",s.drawImage(o,-t.width,0),s.restore(),a.getContext("2d").drawImage(o,0,0)}else a.getContext("2d").drawImage(e.canvas,-t.x,-t.y);e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.translate(t.offsetX-n,t.offsetY-i),e.fillStyle=e.createPattern(a,"repeat"),e.fillRect(-t.offsetX+n,-t.offsetY+i,e.canvas.width,e.canvas.height),e.restore()}var d={getDialog:function(e){var t=function(){B.value=""+y.x,w.value=""+y.y,C.value=""+y.width,S.value=""+y.height},n=function(e,t,n,i,r){var a=Math.round(t+.5)-.5,o=Math.round(n+.5)-.5,s=Math.round(t+i-a),l=Math.round(n+r-o);e.strokeRect(a,o,s,l)},i=function(e){if(e||!x||JSON.stringify(x)!==JSON.stringify(y)){if(0===M){_.clearRect(0,0,m,v),_.drawImage(f.canvas,0,0);var t=j.image.getContext("2d");t.save(),t.clearRect(0,0,D,N),t.drawImage(W,0,0,D,N),t.restore();var i=y.width*z,a=y.height*z,o=F.getContext("2d");o.save(),o.clearRect(0,0,P,O),o.strokeStyle="#fff",n(o,y.x*z,y.y*z,i,a),y.blend>.05&&(o.strokeStyle="#f0f",n(o,y.x*z-i/2*y.blend,y.y*z-a/2*y.blend,i*(1+y.blend),a*(1+y.blend))),o.restore()}else{_.clearRect(0,0,m,v),_.drawImage(f.canvas,0,0),h(_,y);var s=j.image.getContext("2d");s.clearRect(0,0,D,N),s.drawImage(W,0,0,D,N)}X.render(),x=r.BB.copyObj(y)}},d=window.innerWidth<550,p=1024,g=r.BB.el({content:(0,s.LANG)("filter-pattern-description")+"<br><br>"}),f=e.context,m=f.canvas.width,v=f.canvas.height,y={x:0,y:0,width:m<=250?Math.round(m/4):200,height:v<=250?Math.round(v/4):200,blend:0,offsetX:0,offsetY:0},x=null,b=r.BB.canvasBounds(f);b&&b.width<=p&&b.height<=p&&(b.width<.75*m||b.height<.75*v)?(y.x=b.x,y.y=b.y,y.width=b.width,y.height=b.height):(y.x=Math.round(m/2-y.width/2),y.y=Math.round(v/2-y.height/2));var B=(0,a.input)({init:y.x,type:"number",min:0,max:m,css:{width:"100%"},callback:function(e){y.x=Number(e),i()}}),w=(0,a.input)({init:y.y,type:"number",min:0,max:v,css:{width:"100%"},callback:function(e){y.y=Number(e),i()}}),C=(0,a.input)({init:y.width,type:"number",min:1,max:Math.min(p,m),css:{width:"100%"},callback:function(e){y.width=Number(e),i()}}),S=(0,a.input)({init:y.height,type:"number",min:1,max:Math.min(p,v),css:{width:"100%"},callback:function(e){y.height=Number(e),i()}}),k={marginLeft:"5px",flex:"1"};g.append(r.BB.el({content:[r.BB.el({tagName:"label",content:["X:",B],css:k}),r.BB.el({tagName:"label",content:["Y:",w],css:k}),r.BB.el({tagName:"label",content:[(0,s.LANG)("width")+":",C],css:k}),r.BB.el({tagName:"label",content:[(0,s.LANG)("height")+":",S],css:k})],css:{display:"flex",marginLeft:"-5px"}}));var L=new(0,o.KlSlider)({label:(0,s.LANG)("brush-blending"),width:300,height:30,min:0,max:1,value:y.blend,eventResMs:l.eventResMs,onChange:function(e){y.blend=e,i()},formatFunc:function(e){return r.BB.round(e,2)},manualInputRoundDigits:2});r.BB.css(L.getElement(),{margin:"10px 0"}),g.append(L.getElement());var M=1,E=new(0,u.TwoTabs)({left:(0,s.LANG)("compare-before"),right:(0,s.LANG)("compare-after"),init:M,onChange:function(e){M=e,F.style.display=0===e?"block":"none",i(!0)}});g.append(E.getElement());var A=e.klCanvas,T=A.getLayers(),I=A.getLayerIndex(f.canvas),R=r.BB.fitInto(f.canvas.width,f.canvas.height,d?280:490,d?200:240,1),P=parseInt(""+R.width),O=parseInt(""+R.height),D=Math.min(P,f.canvas.width),N=Math.min(O,f.canvas.height),z=(f.canvas.width,P/f.canvas.width),G=r.BB.el({css:{width:d?"340px":"540px",marginLeft:"-20px",height:d?"260px":"300px",backgroundColor:"#9e9e9e",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"}}),j={image:r.BB.canvas(D,N),opacity:T[I].opacity,mixModeStr:T[I].mixModeStr},H=T.map((function(e,t){return t===I?j:{image:e.context.canvas,opacity:e.opacity,mixModeStr:e.mixModeStr}})),X=new(0,c.KlCanvasPreview)({width:Math.round(P),height:Math.round(O),layers:H}),F=r.BB.canvas(P,O);r.BB.css(F,{position:"absolute",left:"0",top:"0",mixBlendMode:"difference",imageRendering:"pixelated"});var U=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+P)+"px",height:parseInt(""+O)+"px"}});U.append(X.getElement(),F),G.append(U),g.append(G);var V={start:null,end:null,oldSettings:null,state:null},Y=new r.BB.KeyListener({});G.oncontextmenu=function(){return!1},U.style.touchAction="none";var K=new r.BB.PointerListener({target:U,onPointer:function(e){if(0===M)if("pointerdown"===e.type){if(!V.state){V.oldSettings=r.BB.copyObj(y);var n=e.relX/z,a=e.relY/z;r.BB.isInsideRect({x:n,y:a},{x:y.x,y:y.y,width:y.width,height:y.height})?V.state="move":V.state="select",V.start={x:n,y:a}}}else if("pointermove"===e.type){var o=e.relX/z,s=e.relY/z;if("select"===V.state){V.end={x:o,y:s};var l=Math.max(0,Math.min(V.start.x,V.end.x)),c=Math.max(0,Math.min(V.start.y,V.end.y)),u=Math.min(m,Math.max(V.start.x,V.end.x)),h=Math.min(v,Math.max(V.start.y,V.end.y));y.x=Math.floor(l),y.y=Math.floor(c),y.width=Math.min(p,Math.ceil(u-y.x)),y.height=Math.min(p,Math.ceil(h-y.y)),Y.isPressed("shift")&&(y.width=Math.min(y.width,y.height),y.height=Math.min(y.width,y.height)),0!==y.width&&0!==y.height||(y=r.BB.copyObj(V.oldSettings)),t(),i()}else if("move"===V.state){var d=Math.round(o-V.start.x),g=Math.round(s-V.start.y);y.x=r.BB.clamp(V.oldSettings.x+d,0,m-y.width),y.y=r.BB.clamp(V.oldSettings.y+g,0,v-y.height),t(),i()}}else"pointerup"===e.type&&V.state&&(V.state=null);else"pointerdown"===e.type?V.state||(V.state="move",V.oldSettings=r.BB.copyObj(y),V.start={x:e.relX/z,y:e.relY/z},V.end=null):"pointermove"===e.type?V.state&&(V.end={x:e.relX/z,y:e.relY/z},y.offsetX=Math.round(V.end.x-V.start.x)+V.oldSettings.offsetX,y.offsetY=Math.round(V.end.y-V.start.y)+V.oldSettings.offsetY,i()):"pointerup"===e.type&&V.state&&(V.end||(y.offsetX=0,y.offsetY=0,i()),V.state=null)}}),W=r.BB.canvas(m,v),_=W.getContext("2d");i();var q={element:g,destroy:function(){L.destroy(),Y.destroy(),K.destroy()},getInput:function(){return r.BB.copyObj(y)}};return d||(q.width=500),q},apply:function(e){var t=e.klCanvas,n=e.context,i=e.history;return!(!t||!i)&&(i.pause(!0),h(n,e.input),i.pause(!1),i.push({tool:["filter","pattern"],action:"apply",params:[{input:e.input}]}),!0)}}})),i.register("10iZP",(function(e,n){t(e.exports,"filterDistort",(function(){return d}));var r=i("eWjiX"),a=i("llzZ0"),o=i("1mH1z"),s=i("cH2YE"),l=i("i5nyl"),c=i("5RaQo"),u=i("iskOY"),h=i("lXqiv"),d={getDialog:function(e){var t=function(e){"x"===e?(f.scale.y=f.scale.x,f.strength.y=f.strength.x,f.phase.y=f.phase.x,T[3].setValue(f.scale.y),T[4].setValue(f.strength.y),T[5].setValue(f.phase.y)):(f.scale.x=f.scale.y,f.strength.x=f.strength.y,f.phase.x=f.phase.y,T[0].setValue(f.scale.x),T[1].setValue(f.strength.x),T[2].setValue(f.phase.x)),n()},n=function(){H.draw(X).multiplyAlpha().distort(f).unmultiplyAlpha().update(),V.render()},i=window.innerWidth<550,d=r.BB.el({content:(0,o.LANG)("filter-distort-description")+"<br><br>"}),p=e.context,g=(p.canvas.width,p.canvas.height,!0),f={distortType:0,scale:{x:100,y:100},strength:{x:20,y:20},phase:{x:0,y:0},stepSize:1},m=[],v=32,y=r.BB.canvas(v,v),x=y.getContext("2d");x.beginPath(),x.arc(16,16,12.8,0,2*Math.PI),x.fill();var b=x.createLinearGradient(0,0,v,v);b.addColorStop(0,"#00f"),b.addColorStop(.5,"#f00"),b.addColorStop(1,"#fff"),x.fillStyle=b,x.globalCompositeOperation="source-atop",x.fillRect(0,0,v,v),(b=x.createLinearGradient(v,0,0,v)).addColorStop(0,"#000"),b.addColorStop(1,"#000"),x.fillStyle=b,x.globalCompositeOperation="destination-atop",x.fillRect(0,0,v,v);var B=(0,c.getSharedFx)(),w=B.texture(y);B.draw(w).update();[0,1,2].forEach((function(e){var t=new Image,n=r.BB.copyObj(f);n.distortType=e,n.scale.x/=20,n.scale.y/=20,n.strength.x/=20,n.strength.y/=20,B.draw(w).multiplyAlpha().distort(n).unmultiplyAlpha().update(),x.clearRect(0,0,v,v),x.drawImage(B,0,0),t.src=y.toDataURL("image/png"),m.push(t)})),w.destroy();var C=r.BB.el({parent:d,css:{display:"flex",alignItems:"center"}}),S=new(0,u.Options)({optionArr:m.map((function(e,t){return r.BB.css(e,{margin:"1px",borderRadius:"3px",transition:"all 0.1s ease-in-out"}),{id:""+t,label:e}})),initialId:"0",onChange:function(e){f.distortType=Number(e),n()}}),k=new(0,h.Checkbox)({init:!0,label:(0,o.LANG)("filter-distort-sync-xy"),callback:function(e){(g=e)&&t("x")}});C.append(S.getElement(),r.BB.el({css:{flexGrow:"1"}}),k.getElement());var L=r.BB.el({parent:d,css:{display:"flex",flexWrap:"wrap"}}),M=r.BB.el({parent:L,css:{marginRight:"10px"}}),E=r.BB.el({parent:L}),A=i?300:245,T=[];["x","y"].forEach((function(e,i){var l=0===i?M:E,c=new(0,a.KlSlider)({label:(0,o.LANG)("filter-noise-scale")+" "+e.toUpperCase(),width:A,height:30,min:1,max:1e3,curve:"quadratic",value:f.scale[e],eventResMs:s.eventResMs,onChange:function(i){f.scale[e]=i,g?t(e):n()}});c.getElement().style.marginTop="20px",l.append(c.getElement());var u=new(0,a.KlSlider)({label:(0,o.LANG)("filter-unsharp-mask-strength")+" "+e.toUpperCase(),width:A,height:30,min:0,max:200,curve:"quadratic",value:f.strength[e],eventResMs:s.eventResMs,onChange:function(i){f.strength[e]=i,g?t(e):n()}});u.getElement().style.marginTop="10px",l.append(u.getElement());var h=new(0,a.KlSlider)({label:(0,o.LANG)("filter-distort-phase")+" "+e.toUpperCase(),width:A,height:30,min:0,max:1,value:f.phase[e],manualInputRoundDigits:2,eventResMs:s.eventResMs,formatFunc:function(e){return r.BB.round(e,2)},onChange:function(i){f.phase[e]=i,g?t(e):n()}});h.getElement().style.marginTop="10px",l.append(h.getElement()),T.push(c),T.push(u),T.push(h)}));var I=new(0,a.KlSlider)({label:(0,o.LANG)("filter-distort-stepsize"),width:300,height:30,min:1,max:300,curve:"quadratic",value:f.stepSize,eventResMs:s.eventResMs,onChange:function(e){f.stepSize=Math.round(e),n()}});I.getElement().style.marginTop="20px",d.append(I.getElement());var R=e.klCanvas,P=R.getLayers(),O=R.getLayerIndex(p.canvas),D=r.BB.fitInto(p.canvas.width,p.canvas.height,i?280:490,i?200:240,1),N=parseInt(""+D.width),z=parseInt(""+D.height),G=Math.min(N,p.canvas.width),j=(Math.min(z,p.canvas.height),p.canvas.width,p.canvas.width,r.BB.el({css:{width:i?"340px":"540px",marginLeft:"-20px",height:i?"260px":"300px",backgroundColor:"#9e9e9e",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light",marginTop:"10px"}})),H=(0,c.getSharedFx)();if(H){var X=H.texture(p.canvas);H.draw(X).update();var F={image:H,opacity:P[O].opacity,mixModeStr:P[O].mixModeStr},U=P.map((function(e,t){return t===O?F:{image:e.context.canvas,opacity:e.opacity,mixModeStr:e.mixModeStr}})),V=new(0,l.KlCanvasPreview)({width:Math.round(N),height:Math.round(z),layers:U}),Y=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+N)+"px",height:parseInt(""+z)+"px"}});Y.append(V.getElement()),j.append(Y),d.append(j),n();var K={element:d,destroy:function(){S.destroy(),T.forEach((function(e){return e.destroy()})),I.destroy(),k.destroy(),X.destroy()},getInput:function(){return r.BB.copyObj(f)}};return i||(K.width=500),K}},apply:function(e){var t=e.klCanvas,n=e.context,i=e.history;if(!t||!i)return!1;i.pause(!0);var r=(0,c.getSharedFx)();if(!r)return!1;var a=r.texture(n.canvas);return r.draw(a).multiplyAlpha().distort(e.input).unmultiplyAlpha().update(),n.clearRect(0,0,n.canvas.width,n.canvas.height),n.drawImage(r,0,0),a.destroy(),i.pause(!1),i.push({tool:["filter","distort"],action:"apply",params:[{input:e.input}]}),!0}}})),i.register("dteOZ",(function(e,n){t(e.exports,"filterVanishPoint",(function(){return d}));var r=i("eWjiX"),a=i("i5nyl"),o=i("1mH1z"),s=i("c4LUw"),l=i("9A7OD"),c=i("jsIPR"),u=i("llzZ0"),h=i("cH2YE"),d={getDialog:function(e){var t=function(){var e=D.image.getContext("2d");e.save(),e.clearRect(0,0,v,y),e.drawImage(n.canvas,0,0,v,y),(0,c.drawVanishPoint)(e,C.x*x,C.y*x,C.lines,Math.max(C.thickness*x,1),C.color,C.opacity),e.restore(),N.render()},n=e.context,i=e.klCanvas;if(!n||!i)return!1;var d=i.getLayers(),p=i.getLayerIndex(n.canvas),g=r.BB.fitInto(n.canvas.width,n.canvas.height,280,200,1),f=parseInt(""+g.width),m=parseInt(""+g.height),v=Math.min(f,n.canvas.width),y=Math.min(m,n.canvas.height),x=v/n.canvas.width,b=f/n.canvas.width,B=document.createElement("div"),w={element:B};B.innerHTML=(0,o.LANG)("filter-vanish-point-description")+"<br/><br/>";var C={x:n.canvas.width/2,y:n.canvas.height/2,lines:8,thickness:2,color:{r:0,g:0,b:0},opacity:1},S=new(0,u.KlSlider)({label:(0,o.LANG)("filter-vanish-point-lines"),width:300,height:30,min:2,max:20,value:C.lines,curve:"quadratic",eventResMs:h.eventResMs,onChange:function(e){C.lines=Math.round(e),t()}});S.getElement().style.marginBottom="10px",B.append(S.getElement());var k=r.BB.el({parent:B,css:{display:"flex",alignItems:"center"}}),L=r.BB.el({parent:B,css:{display:"flex",alignItems:"center",marginTop:"10px"}}),M=(0,s.input)({init:C.x,type:"number",css:{width:"75px",marginRight:"20px"},callback:function(e){C.x=parseFloat(e),t()}}),E=(0,s.input)({init:C.y,type:"number",css:{width:"75px",marginRight:"20px"},callback:function(e){C.y=parseFloat(e),t()}}),A=(0,s.input)({init:2,type:"number",min:1,css:{width:"75px",marginRight:"20px"},callback:function(e){C.thickness=parseFloat(e),t()}}),T={r:0,g:0,b:0,a:1},I=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];I.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),I.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1}),C.color=r.BB.copyObj(T);var R=new(0,l.ColorOptions)({label:(0,o.LANG)("shape-stroke"),colorArr:I,onChange:function(e){T=e,C.color=r.BB.copyObj(T),t()}}),P={display:"inline-block",marginRight:"5px"};k.append(r.BB.el({content:"X:",css:P}),M,r.BB.el({content:"Y:",css:P}),E),L.append(r.BB.el({content:(0,o.LANG)("shape-line-width")+":",css:P}),A,r.BB.el({css:{flexGrow:"1"}}),R.getElement());var O=document.createElement("div");r.BB.css(O,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});var D={image:r.BB.canvas(v,y),opacity:d[p].opacity,mixModeStr:d[p].mixModeStr},N=new(0,a.KlCanvasPreview)({width:Math.round(f),height:Math.round(m),layers:d.map((function(e,t){return t===p?D:{image:e.context.canvas,opacity:e.opacity,mixModeStr:e.mixModeStr}}))}),z=r.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+f)+"px",height:parseInt(""+m)+"px",cursor:"move"}});z.appendChild(N.getElement()),O.appendChild(z);var G={start:null,end:null,state:null,oldSettings:null};O.oncontextmenu=function(){return!1},z.style.touchAction="none";var j=new r.BB.PointerListener({target:z,onPointer:function(e){"pointerdown"===e.type?G.state||(G.state="move",G.oldSettings=r.BB.copyObj(C),G.start={x:e.relX/b,y:e.relY/b},G.end=null):"pointermove"===e.type?G.state&&(G.end={x:e.relX/b,y:e.relY/b},C.x=Math.round(G.end.x-G.start.x+G.oldSettings.x),C.y=Math.round(G.end.y-G.start.y+G.oldSettings.y),M.value=""+C.x,E.value=""+C.y,t()):"pointerup"===e.type&&G.state&&(G.state=null)}});return setTimeout(t,0),B.appendChild(O),w.destroy=function(){S.destroy(),j.destroy()},w.getInput=function(){return w.destroy(),r.BB.copyObj(C)},w},apply:function(e){var t=e.context,n=e.klCanvas,i=e.history;return!!(t&&n&&i)&&(i.pause(!0),(0,c.drawVanishPoint)(t,e.input.x,e.input.y,e.input.lines,e.input.thickness,e.input.color,e.input.opacity),i.pause(!1),i.push({tool:["filter","vanishPoint"],action:"apply",params:[{input:e.input}]}),!0)}}})),i.register("jsIPR",(function(e,n){t(e.exports,"drawVanishPoint",(function(){return o}));var r=i("3ujzu"),a=i("eWjiX");function o(e,t,n,i,o,s,l){e.save();for(var c=180/i,u=0;u<180;u+=c){var h=a.BB.rotateAround({x:t,y:n},{x:t+9999,y:n},u);(0,r.drawShape)(e,{type:"line",x1:t,y1:n,x2:h.x,y2:h.y,isOutwards:!0,opacity:l,strokeRgb:s,lineWidth:o})}e.restore()}})),i.register("3WOmu",(function(n,r){t(n.exports,"klCanvasToPsdBlob",(function(){return l}));var a=i("3kC7t"),o=i("cijLd"),s=i("hrnUX");function l(e){return c.apply(this,arguments)}function c(){return(c=(0,a.default)(e(o).mark((function t(n){var r,a,l,c,u,h;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=n.getLayersFast(),a={width:n.getWidth(),height:n.getHeight(),children:[]},l=0;l<r.length;l++)c=r[l],a.children.push({name:c.name,opacity:c.opacity,canvas:c.canvas,blendMode:s.KL.PSD.blendKlToPsd(c.mixModeStr),left:0,top:0});return e.next=5,i("bxnoy");case 5:return u=e.sent,h=u.writePsdBuffer(a),e.abrupt("return",new Blob([h],{type:"application/octet-stream"}));case 8:case"end":return e.stop()}}),t)})))).apply(this,arguments)}})),i.register("eIlXd",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("k9Nks")})),i.register("23J3k",(function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+i("2evKT").resolve("bBxqy")}))}();
//# sourceMappingURL=main-embed.bb21c954.js.map

!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r=n.parcelRequire94c2;r.register("6NgYC",(function(n,i){t(n.exports,"Embed",(function(){return d}));var a=r("3kC7t"),o=r("cijLd");r("jyMxU");var s=r("3C7jC"),l=r("5ngYX"),c=r("gWfkn"),u=r("941rU"),h=r("1mH1z");function d(t){var n,i,d=function(e){try{if(p)throw new Error("Already called openProject");p=!0;var r=new(0,l.SaveReminder)(c.klHistory,!1,!1,(function(){}),(function(){return!!n&&n.isDrawing()}),null,null);n=new(0,s.KlApp)(e,{saveReminder:r,bottomBar:t.bottomBar,aboutEl:t.aboutEl,embed:{url:t.embedUrl,onSubmit:t.onSubmit}}),r.init(),f&&f.parentNode&&f.parentNode.removeChild(f),f=null,m=null,document.body.appendChild(n.getEl())}catch(e){m&&(m.textContent="❌ "+e),f&&(f.className+="loading-screen-error"),console.error(e)}},p=!1,g=[],f=document.getElementById("loading-screen"),m=document.getElementById("loading-screen-text");m&&(m.textContent=(0,h.LANG)("embed-init-waiting")),t.project&&d(t.project),this.openProject=d,this.initError=function(e){m&&(m.textContent="❌ "+e),f&&(f.className+="loading-screen-error")},this.getPNG=function(){if(!n)throw new Error("App not initialized");return n.getPNG()},this.getPSD=(0,a.default)(e(o).mark((function t(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new Error("App not initialized");case 2:return e.next=4,n.getPSD();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),t)}))),this.readPSDs=function(t){if(0!==t.length){var n=function(e){try{var t=i.readPsd(e.blob),n=(0,u.klPsdToKlProject)((0,u.readPsd)(t));e.callback(n)}catch(t){console.error("failed to read psd",t),e.callback(null)}};i?t.forEach(n):(0===g.length&&(0,a.default)(e(o).mark((function t(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r("bxnoy");case 3:i=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),i="error";case 9:for(;g.length;)n(g.shift());case 10:case"end":return e.stop()}}),t,null,[[0,6]])})))(),t.forEach((function(e){g.push(e)})))}}}})),r.register("jyMxU",(function(e,t){if(r("5dg4B"),r("izcMZ"),r("iD0Yt"),"scrollTo"in Element.prototype||Object.defineProperty(Element.prototype,"scrollTo",{value:function(e,t){this.scrollLeft=e,this.scrollTop=t}}),"scrollBy"in Element.prototype||Object.defineProperty(Element.prototype,"scrollBy",{value:function(e,t){this.scrollLeft+=e,this.scrollTop+=t}}),!("localStorage"in window))try{window.localStorage={getItem:function(){return null},setItem:function(){},removeItem:function(){}}}catch(e){}})),r.register("5dg4B",(function(e,t){var n;n=function(){var e=Array.prototype.slice.call(arguments),t=document.createDocumentFragment();e.forEach((function(e){var n=e instanceof Node;t.appendChild(n?e:document.createTextNode(String(e)))})),this.appendChild(t)},[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach((function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:n})}))})),r.register("izcMZ",(function(e,t){var n;n=function(){var e=Array.prototype.slice.call(arguments),t=document.createDocumentFragment();e.forEach((function(e){var n=e instanceof Node;t.appendChild(n?e:document.createTextNode(String(e)))})),this.insertBefore(t,this.firstChild)},[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach((function(e){e.hasOwnProperty("prepend")||Object.defineProperty(e,"prepend",{configurable:!0,enumerable:!0,writable:!0,value:n})}))})),r.register("iD0Yt",(function(e,t){String.prototype.padStart||(String.prototype.padStart=function(e,t){return e>>=0,t=String(t||" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),t.slice(0,e)+String(this))})})),r.register("3C7jC",(function(n,i){t(n.exports,"KlApp",(function(){return S}));var a=r("3kC7t"),o=r("cijLd"),s=r("hrnUX"),l=r("gWfkn"),c=r("eWjiX"),u=r("5ebUJ");r("eK8ID");var h=r("85H3x"),d=r("iUR3L"),p=r("2wCWz"),g=r("3WOmu"),f=r("1mH1z"),m=r("fxAg2"),v=r("2dTGs"),y=r("fuF9j"),x=r("adBnR"),b=r("cafM1"),B=r("eIlXd"),w=r("23J3k"),C=r("6l0gQ");function S(t,n){var r,i=this,d=function(e){return 1==e?.5:2==e?.84:3==e?.965:4==e?.9825:5==e?.99125:e},S=function(e){ee.emitSize(e),ae&&ae.setCursorSize(2*e)},k=function(e,t,n){function r(e,t){var n=parseInt(e),r=parseInt(t);return n>D&&(r*=D/n,n=D),r>D&&(n*=D/r,r=D),{width:n=parseInt(""+n),height:r=parseInt(""+r)}}function i(e){var n=r(e.width,e.height),i=c.BB.canvas(e.width,e.height);i.getContext("2d").drawImage(e,0,0),c.BB.resizeCanvas(i,n.width,n.height),V.reset({width:n.width,height:n.height,image:i,layerName:t}),Ee.update(0),M(V.getLayer(0)),ae.resetView(),Ce.update(ae.getScale(),ae.getAngleDeg()),!1}function a(e,t){function n(e,t,n){t.width=t.width,t.getContext("2d").drawImage(e,-n.x,-n.y),e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(t,0,0)}if(t&&(t.width!==e.width||t.height!==e.height)){var i=c.BB.canvas(t.width,t.height);if(e.width=t.width,e.height=t.height,e.layers||n(e.canvas,i,t),e.layers)for(var a=0;a<e.layers.length;a++){n(e.layers[a].image,i,t)}}var o,s=r(e.width,e.height);if(e.width=s.width,e.height=s.height,e.layers||c.BB.resizeCanvas(e.canvas,e.width,e.height),e.layers)for(var l=0;l<e.layers.length;l++){var u=e.layers[l];c.BB.resizeCanvas(u.image,e.width,e.height)}o=e.layers?V.reset({width:e.width,height:e.height,layers:e.layers}):V.reset({width:e.width,height:e.height,image:e.canvas}),Ee.update(o),M(V.getLayer(o)),ae.resetView(),Ce.update(ae.getScale(),ae.getAngleDeg()),!1}function o(e){s.KL.showImportAsLayerDialog({target:H,klCanvas:V,importImage:e,callback:function(n,r){if(n){l.klHistory.pause(!0),V.addLayer();var i=V.getLayers().length-1;t&&V.renameLayer(i,t);var a=V.getLayerContext(i);c.BB.drawTransformedImageWithBounds(a,e,n,null,r),M(V.getLayer(i)),Ee.update(i),l.klHistory.pause(!1),l.klHistory.push({tool:["misc"],action:"importImage",params:[c.BB.copyCanvas(a.canvas),t]})}}})}!e||isNaN(e.width)||isNaN(e.height)||e.width<=0||e.height<=0?s.KL.popup({target:H,type:"error",message:(0,f.LANG)("import-broken-file"),buttons:["Ok"]}):("default"!==n&&n||s.KL.showImportImageDialog({image:e,target:H,maxSize:D,callback:function(e){"as-image"===e.type?i(e.image):"as-image-psd"===e.type?a(e.image,e.cropObj):"as-layer"===e.type?o(e.image):e.type}}),"layer"===n&&o(e.canvas),"image"===n&&("psd"===e.type?a(e):i(e.canvas)))},L=function(e,t){function n(){s.KL.popup({target:H,type:"warning",message:(0,f.LANG)("import-psd-unsupported")+"<br /><br />",buttons:["Ok"]})}for(var r,i=!1,a=0;r=e[a];a++){var o=r.name.split(".");"psd"===(o=o[o.length-1].toLowerCase())?function(r){var i=4096;if(r.size>=1073741824)s.KL.popup({target:H,type:"error",message:"File too big. Unable to import.<br /><br />",buttons:["Ok"]});else{var a,o=1===e.length&&r.size>=26214400,l=!0;o&&s.KL.popup({target:H,message:(0,f.LANG)("import-opening"),callback:function(e){l=!1,a=null},closefunc:function(e){a=e}});var c=new FileReader;c.onload=function(e){s.KL.loadAgPsd().then((function(c){if(!o||l)try{var u;if((u=c.readPsd(e.target.result,{skipLayerImageData:!0,skipThumbnail:!0,skipCompositeImageData:!0})).width>i||u.height>i)return a&&a(),void s.KL.popup({target:H,type:"error",message:(0,f.LANG)("import-psd-too-large").replace(/{x}/g,"4096")+"<br /><br />"+(0,f.LANG)("import-psd-size")+": "+u.width+" x "+u.height+" pixels<br /><br />",buttons:["Ok"]});u=null;try{u=c.readPsd(e.target.result)}catch(e){}if(u){var h=s.KL.PSD.readPsd(u);"image"===t&&h.error&&n(),a&&a(),k(h,r.name,t)}else u=c.readPsd(e.target.result,{skipLayerImageData:!0,skipThumbnail:!0}),"image"===t&&n(),a&&a(),k({type:"psd",width:u.width,height:u.height,canvas:u.canvas,error:!0},r.name,t)}catch(e){a&&a(),s.KL.popup({target:H,type:"error",message:"Failed to load PSD.<br /><br />",buttons:["Ok"]})}})).catch((function(){a(),alert("Error: failed to load PSD library")}))},c.readAsArrayBuffer(r)}}(r):r.type.match("image.*")?function(e){window.URL=window.URL||window.webkitURL;var n=window.URL.createObjectURL(e),r=new Image;r.src=n,c.BB.loadImage(r,(function(){k({type:"image",width:r.width,height:r.height,canvas:r},e.name,t)}))}(r):i=!0}i&&s.KL.popup({target:H,message:(0,f.LANG)("import-unsupported-file"),type:"error",buttons:["OK"]})},T=function(){X<N?(fe.getElement().style.display="block",fe.setDirection(z),fe.isOpen()?("left"===z?(c.BB.css(fe.getElement(),{left:"271px",right:""}),c.BB.css(ae.getElement(),{left:"271px"})):(c.BB.css(fe.getElement(),{left:"",right:"271px"}),c.BB.css(ae.getElement(),{left:"0"})),he.style.display="block",ae.setSize(Math.max(0,X-U),F),ue.setWide(!1)):("left"===z?(c.BB.css(fe.getElement(),{left:"0",right:""}),c.BB.css(ae.getElement(),{left:"0"})):(c.BB.css(fe.getElement(),{left:"",right:"0"}),c.BB.css(ae.getElement(),{left:"0"})),he.style.display="none",ae.setSize(Math.max(0,X),F),ue.setWide(!0))):(fe.getElement().style.display="none","left"===z?c.BB.css(ae.getElement(),{left:"271px"}):c.BB.css(ae.getElement(),{left:"0"}),he.style.display="block",ae.setSize(Math.max(0,X-U),F),ue.setWide(!1))},E=function(){"left"===z?(c.BB.css(he,{left:"0",right:"",borderLeft:"none",borderRight:"1px solid rgb(135, 135, 135)"}),c.BB.css(ae.getElement(),{left:"271px"})):(c.BB.css(he,{left:"",right:"0",borderLeft:"1px solid rgb(135, 135, 135)",borderRight:"none"}),c.BB.css(ae.getElement(),{left:"0"})),ue.setUiState(z),Me.setUiState(""+z),Ee.setUiState(""+z),T(),Ne.updateUiState(z)},M=function(e){$=e.context,q.setContext(e.context),Me.setLayer(e)},I=function(){s.KL.newImageDialog({currentColor:J,secondaryColor:me.getSecondaryRGB(),maxCanvasSize:D,canvasWidth:V.getWidth(),canvasHeight:V.getHeight(),workspaceWidth:window.innerWidth<N?X:X-U,workspaceHeight:F,onConfirm:function(e,t,n){V.reset({width:e,height:t,color:1===n.a?n:null}),Ee.update(0),M(V.getLayer(0)),ae.resetView(),Ce.update(ae.getScale(),ae.getAngleDeg()),!1},onCancel:function(){}})},A=function(e){c.BB.shareCanvas({canvas:V.getCompleteCanvas(1),fileName:c.BB.getDate()+G+".png",title:c.BB.getDate()+G+".png",callback:e||function(){}})},R=function(){if(W)for(var e=ve.getActive(),t=W.getOpenedTabId(),n=Object.keys({draw:{},hand:{},fill:{},text:{},shape:{}}),r=0;r<n.length;r++)e===n[r]?W.setIsVisible(n[r],!0):(W.setIsVisible(n[r],!1),t===n[r]&&W.open(e))},P=function(e){s.KL.clipboardDialog(H,V.getCompleteCanvas(1),(function(e){0===e.left&&0===e.right&&0===e.top&&0===e.bottom||(s.KL.filterLib.cropExtend.apply({context:$,klCanvas:V,input:e,history:l.klHistory}),Ee.update(),ae.resetView(),Ce.update(ae.getScale(),ae.getAngleDeg()))}),ue,e)},O=function(){if(n.bottomBar){var e=617<window.innerHeight&&de.scrollHeight+50<window.innerHeight;De.style.display=e?"":"none"}},D=Math.min(4096,Math.max(2048,Math.max(window.screen.width,window.screen.height))),N=820,z=n.embed?"left":C.LocalStorage.getItem("uiState")?C.LocalStorage.getItem("uiState"):"right",G=(null===(r=n.app)||void 0===r?void 0:r.filenameBase)?n.app.filenameBase:"Klecks",j=n.projectStore,H=document.createElement("div");H.className="g-root";var X=Math.max(0,window.innerWidth),F=Math.max(0,window.innerHeight),U=271,K="png",V=new s.KL.KlCanvas(t?{projectObj:t}:{width:Math.max(10,Math.min(D,window.innerWidth<N?X:X-U)),height:Math.max(10,Math.min(D,F))},n.embed?-1:0);V.setHistory(l.klHistory);var W,Y=null;n.saveReminder||(n.saveReminder={init:function(){},reset:function(){}});t?(t.layers.forEach((function(e){e.image=null})),t=null):(l.klHistory.pause(!0),V.addLayer(),V.layerFill(0,{r:255,g:255,b:255}),l.klHistory.pause(!1));try{Y={canvas:new s.KL.KlCanvas({copy:V},n.embed?-1:0),focus:V.getLayerCount()-1,brushes:{}}}catch(e){throw"kl-create-canvas-error"===e.message&&V.destroy(),e}for(var _ in s.KL.brushes)s.KL.brushes.hasOwnProperty(_)&&(Y.brushes[_]=new s.KL.brushes[_],Y.canvas&&Y.brushes[_].setContext(Y.canvas.getLayerContext(Y.focus)));var q,Q,J=new c.BB.RGB(0,0,0),Z=0,$=V.getLayerContext(V.getLayerCount()-1),ee=new s.KL.BrushSettingService((function(e){me.setColor(e),q.setColor(e),J=c.BB.copyObj(e)}),(function(e){q.setSize(e),ae.setCursorSize(2*e)}),(function(e){q.setOpacity(e)}),(function(){return me.getColor()}),(function(){return se[Q].getSize()}),(function(){return se[Q].getOpacity()}),(function(){return{sizeSlider:s.KL.brushesUI[Q].sizeSlider,opacitySlider:s.KL.brushesUI[Q].opacitySlider}})),te=new c.BB.EventChain.LineSmoothing({smoothing:d(1)}),ne=new c.BB.EventChain.LineSanitizer,re=new c.BB.EventChain.EventChain({chainArr:[ne,te]});re.setChainOut((function(e){"down"===e.type&&(he.style.pointerEvents="none",q.startLine(e.x,e.y,e.pressure),ae.requestFrame()),"move"===e.type&&(q.goLine(e.x,e.y,e.pressure,!1,e.isCoalesced),ae.setLastDrawEvent(e.x,e.y,e.pressure),ae.requestFrame()),"up"===e.type&&(he.style.pointerEvents="",q.endLine(),ae.requestFrame()),"line"===e.type&&(q.getBrush().drawLineSegment(e.x0,e.y0,e.x1,e.y1),ae.requestFrame())}));var ie={size:20,align:"left",isBold:!1,isItalic:!1,font:"sans-serif",opacity:1},ae=new s.KL.KlCanvasWorkspace({klCanvas:V,width:Math.max(0,X-U),height:F,onDraw:re.chainIn,onPick:function(e,t){ee.setColor(e),t&&(me.pickingDone(),ae.setMode(ve.getActive()))},onFill:function(e,t){var n=V.getLayerIndex($.canvas);V.floodFill(n,e,t,me.getColor(),Se.getOpacity(),Se.getTolerance(),Se.getSample(),Se.getGrow(),Se.getContiguous()),ae.requestFrame()},onText:function(e,t,n){s.KL.dialogCounter.get()>0||s.KL.textToolDialog({klCanvas:V,layerIndex:V.getLayerIndex($.canvas),x:e,y:t,angleRad:n,color:me.getColor(),secondaryColor:me.getSecondaryRGB(),size:ie.size,align:ie.align,isBold:ie.isBold,isItalic:ie.isItalic,font:ie.font,opacity:ie.opacity,onConfirm:function(e){var t=e.color;t.a=e.opacity,ie.size=e.size,ie.align=e.align,ie.isBold=e.isBold,ie.isItalic=e.isItalic,ie.font=e.font,ie.opacity=e.opacity;var r=V.getLayerIndex($.canvas);V.text(r,{textStr:e.textStr,x:e.x,y:e.y,size:e.size,font:e.font,align:e.align,isBold:e.isBold,isItalic:e.isItalic,angleRad:n,color:c.BB.ColorConverter.toRgbaStr(t)}),ae.requestFrame()}})},onShape:function(e,t,n,r){"down"===e&&Te.onDown(t,n,r),"move"===e&&Te.onMove(t,n),"up"===e&&Te.onUp(t,n)},onViewChange:function(e){e.changed.includes("scale")&&ue.out({type:"transform",scale:e.scale,angleDeg:180*e.angle/Math.PI}),ve.setEnableZoomIn(e.scale!==ae.getMaxScale()),ve.setEnableZoomOut(e.scale!==ae.getMinScale()),Ce.update(e.scale,180*e.angle/Math.PI)},onUndo:function(){l.klHistory.canUndo()&&Ae.undo()&&ue.out((0,f.LANG)("undo"),!0)},onRedo:function(){l.klHistory.canRedo()&&Ae.redo()&&ue.out((0,f.LANG)("redo"),!0)}}),oe=new c.BB.KeyListener({onDown:function(t,r,i){if(!(s.KL.dialogCounter.get()>0||c.BB.isInputFocused(!0))&&!(ne.getIsDrawing()||ae.getIsDrawing())){if("plus"===i&&ae.zoomByStep(oe.isPressed("shift")?1/8:.5),"minus"===i&&ae.zoomByStep(oe.isPressed("shift")?-1/8:-.5),"home"===i&&ae.fitView(),"end"===i&&ae.resetView(!0),["ctrl+z","cmd+z"].includes(i)&&(r.preventDefault(),Ae.undo()),(["ctrl+y","cmd+y"].includes(i)||(c.BB.sameKeys("ctrl+shift+z",i)||c.BB.sameKeys("cmd+shift+z",i))&&"z"===t)&&(r.preventDefault(),Ae.redo()),n.embed||(["ctrl+s","cmd+s"].includes(i)&&(r.preventDefault(),Re.save()),["ctrl+shift+s","cmd+shift+s"].includes(i)&&(r.preventDefault(),(0,a.default)(e(o).mark((function t(){var r;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!0,e.prev=1,e.next=4,j.store(V.getProject());case 4:e.next=11;break;case 6:e.prev=6,e.t0=e.catch(1),r=!1,setTimeout((function(){throw new Error("keyboard-shortcut: failed to store browser storage, "+e.t0)}),0),ue.out("❌ "+(0,f.LANG)("file-storage-failed"),!0);case 11:r&&(n.saveReminder.reset(),ue.out((0,f.LANG)("file-storage-stored"),!0));case 12:case"end":return e.stop()}}),t,null,[[1,6]])})))()),["ctrl+c","cmd+c"].includes(i)&&(r.preventDefault(),P(!0))),["ctrl+a","cmd+a"].includes(i)&&r.preventDefault(),oe.comboOnlyContains(["left","right","up","down"])&&("left"===t&&ae.translateView(1,0),"right"===t&&ae.translateView(-1,0),"up"===t&&ae.translateView(0,1),"down"===t&&ae.translateView(0,-1)),["r+left","r+right"].includes(i)&&("left"===t&&(ae.setAngle(-15,!0),Ce.update(ae.getScale(),ae.getAngleDeg())),"right"===t&&(ae.setAngle(15,!0),Ce.update(ae.getScale(),ae.getAngleDeg()))),["r+up"].includes(i)&&(ae.setAngle(0),Ce.update(ae.getScale(),ae.getAngleDeg())),"sqbr_open"===i&&q.decreaseSize(.03/ae.getScale()),"sqbr_close"===i&&q.increaseSize(.03/ae.getScale()),"enter"===i&&(V.layerFill(V.getLayerIndex($.canvas),me.getColor()),ue.out((0,f.LANG)("filled"),!0)),["delete","backspace"].includes(i)){var l=V.getLayerIndex($.canvas);0!==l||se.eraserBrush.getIsTransparentBg()?V.clearLayer(l):V.layerFill(l,{r:255,g:255,b:255},"source-in"),ue.out((0,f.LANG)("cleared-layer"),!0)}"e"===i&&(r.preventDefault(),ae.setMode("draw"),ve.setActive("draw"),W.open("draw"),R(),Be.open("eraserBrush")),"b"===i&&(r.preventDefault(),ae.setMode("draw"),ve.setActive("draw"),W.open("draw"),R(),Be.open(Z)),"g"===i&&(r.preventDefault(),ae.setMode("fill"),ve.setActive("fill"),W.open("fill"),R()),"t"===i&&(r.preventDefault(),ae.setMode("text"),ve.setActive("text"),W.open("text"),R()),"u"===i&&(r.preventDefault(),ae.setMode("shape"),ve.setActive("shape"),W.open("shape"),R()),"x"===i&&(r.preventDefault(),me.swapColors())}},onUp:function(e,t){}});n.embed||(new s.KL.KlImageDropper({target:document.body,onDrop:function(e,t){s.KL.dialogCounter.get()>0||L(e,t)},enabledTest:function(){return 0===s.KL.dialogCounter.get()}}),c.BB.addEventListener(window,"paste",(function(e){s.KL.dialogCounter.get()>0||(e.stopPropagation(),e.preventDefault(),e.clipboardData.files[0]?function(e,t){0==e.clipboardData&&"function"==typeof t&&t(void 0);var n=e.clipboardData.items;if(null==n)"function"==typeof t&&t(void 0);else for(var r=0;r<n.length;r++)if(-1!=n[r].type.indexOf("image")){var i=n[r].getAsFile();"function"==typeof t&&t(i)}}(e,(function(e){if(e){var t=new Image;t.onload=function(){URL.revokeObjectURL(t.src),k({type:"image",width:t.width,height:t.height,canvas:t},null,"default")};var n=window.URL||window.webkitURL;t.src=n.createObjectURL(e)}})):e.clipboardData.items[0]&&e.clipboardData.items[0].getAsString((function(e){if((e=e.trim()).match(/^https?/)){var t=new Image;t.onload=function(){k({type:"image",width:t.width,height:t.height,canvas:t},null,"default")},t.onerror=function(e){console.log("error loading",e)},t.crossOrigin="Anonymous",t.src=e}else if(e.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)){var n=c.BB.ColorConverter.hexToRGB(e.replace("#",""));ee.setColor(n)}})))}),!1));var se={};for(var le in s.KL.brushesUI)if(s.KL.brushesUI.hasOwnProperty(le)){var ce=new s.KL.brushesUI[le].Ui({onSizeChange:S,onOpacityChange:function(e){ee.emitOpacity(e)},onConfigChange:function(){ee.emitSliderConfig({sizeSlider:s.KL.brushesUI[Q].sizeSlider,opacitySlider:s.KL.brushesUI[Q].opacitySlider})}});se[le]=ce,ce.getElement().style.padding="10px"}c.BB.css(H,{position:"absolute",left:"0",top:"0",right:"0",bottom:"0"});var ue=new s.KL.StatusOverlay,he=c.BB.el({}),de=c.BB.el({parent:he});he.oncontextmenu=function(){return!1},he.onclick=c.BB.handleClick;var pe,ge,fe=new s.KL.ToolspaceCollapser({onChange:function(){T()}});T(),setTimeout((function(){pe=new s.KL.OverlayToolspace({enabledTest:function(){return 0===s.KL.dialogCounter.get()&&!ne.getIsDrawing()},brushSettingService:ee}),H.appendChild(pe.getElement())}),0),c.BB.append(H,[ae.getElement(),he,fe.getElement()]),c.BB.css(he,{position:"absolute",right:"0",top:"0",bottom:"0",width:U-1+"px",overflow:"hidden",backgroundColor:"#ddd",borderLeft:"1px solid rgb(135, 135, 135)",userSelect:"none",touchAction:"none"}),ge=n.embed?new(0,h.ToolspaceTopRow)({onHelp:function(){(0,u.showIframePopup)(n.embed.url+"/help.html",!!n.embed)},onSubmit:function(){var t;s.KL.popup({target:H,message:(0,f.LANG)("submit-prompt"),buttons:[(0,f.LANG)("submit"),"Cancel"],callback:(t=(0,a.default)(e(o).mark((function t(r){var i;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r===(0,f.LANG)("submit")){e.next=2;break}return e.abrupt("return");case 2:i=c.BB.el({parent:H,className:"upload-overlay",content:'<div class="spinner"></div> '+(0,f.LANG)("submit-submitting")}),n.embed.onSubmit((function(){n.saveReminder.reset(),H.removeChild(i)}),(function(){H.removeChild(i)}));case 4:case"end":return e.stop()}}),t)}))),function(e){return t.apply(this,arguments)})})},onLeftRight:function(){z="left"===z?"right":"left",E()}}):new s.KL.ToolspaceTopRow({logoImg:n.logoImg,onLogo:function(){(0,u.showIframePopup)("./home/",!!n.embed)},onNew:function(){I()},onImport:function(){Pe.triggerImport()},onSave:function(){Re.save()},onShare:function(){A()},onHelp:function(){(0,u.showIframePopup)("./help/",!!n.embed)}}),ge.getElement().classList.add("toolspace-row-shadow"),ge.getElement().style.marginBottom="10px",de.appendChild(ge.getElement());var me,ve=new s.KL.ToolspaceToolRow({onActivate:function(e){if("draw"===e)ae.setMode("draw");else if("hand"===e)ae.setMode("hand");else if("fill"===e)ae.setMode("fill");else if("text"===e)ae.setMode("text");else{if("shape"!==e)throw new Error("unknown activeStr");ae.setMode("shape")}W.open(e),R(),me.pickingDone()},onZoomIn:function(){ae.zoomByStep(oe.isPressed("shift")?1/8:.5)},onZoomOut:function(){ae.zoomByStep(oe.isPressed("shift")?-1/8:-.5)},onUndo:function(){Ae.undo()},onRedo:function(){Ae.redo()}});ve.setIsSmall(F<540),l.klHistory.addListener((function(){ve.setEnableUndo(l.klHistory.canUndo()),ve.setEnableRedo(l.klHistory.canRedo())})),ve.getElement().classList.add("toolspace-row-shadow"),de.appendChild(ve.getElement()),(me=new s.KL.KlColorSlider({width:250,height:30,svHeight:100,startValue:new c.BB.RGB(0,0,0),onPick:function(e){J=e,q.setColor(e),ee.emitColor(e),me.pickingDone()}})).setHeight(Math.max(163,Math.min(400,F-505))),me.setPickCallback((function(e){e?ae.setMode("pick"):(ae.setMode(ve.getActive()),R())}));var ye=document.createElement("div"),xe=document.createElement("div");c.BB.css(xe,{margin:"10px",display:"flex",flexWrap:"wrap",justifyContent:"space-between",alignItems:"flex-end"});var be=new s.KL.ToolspaceStabilizerRow({smoothing:1,onSelect:function(e){te.setSmoothing(d(e))}});ye.appendChild(xe),c.BB.append(xe,[me.getElement(),me.getOutputElement(),be.getElement()]);var Be=new s.KL.TabRow({initialId:"penBrush",useAccent:!0,tabArr:function(){for(var e=function(e){return{id:e,image:s.KL.brushesUI[e].image,title:s.KL.brushesUI[e].tooltip,onOpen:function(){var t;se[e].getElement().style.display="block","eraserBrush"!==(t=e)&&(Z=t),me&&("eraserBrush"===t?me.enable(!1):me.enable(!0)),Q=t,(q=se[t]).setColor(J),q.setContext($),ae.setMode("draw"),ve.setActive("draw"),R(),me.pickingDone(),ee.emitSliderConfig({sizeSlider:s.KL.brushesUI[e].sizeSlider,opacitySlider:s.KL.brushesUI[e].opacitySlider}),S(se[e].getSize()),ee.emitOpacity(se[e].getOpacity())},onClose:function(){se[e].getElement().style.display="none"}}},t=[],n=Object.keys(se),r=0;r<n.length;r++)t.push(e(n[r]));return t}()});for(var we in ye.appendChild(Be.getElement()),s.KL.brushesUI)s.KL.brushesUI.hasOwnProperty(we)&&ye.appendChild(se[we].getElement());var Ce=new s.KL.HandUi({scale:1,angleDeg:0,onReset:function(){ae.resetView(!0),Ce.update(ae.getScale(),ae.getAngleDeg())},onFit:function(){ae.fitView(),Ce.update(ae.getScale(),ae.getAngleDeg())},onAngleChange:function(e,t){ae.setAngle(e,t),Ce.update(ae.getScale(),ae.getAngleDeg())}}),Se=new s.KL.FillUi({colorSlider:me}),ke=new s.KL.TextUi({colorSlider:me}),Le=new s.KL.ShapeUi({colorSlider:me}),Te=new s.KL.ShapeTool({onShape:function(e,t,n,r,i,a){var o=V.getLayerIndex($.canvas),l={type:Le.getShape(),x1:t,y1:n,x2:r,y2:i,angleRad:a,isOutwards:Le.getIsOutwards(),opacity:Le.getOpacity(),isEraser:Le.getIsEraser()};"line"===Le.getShape()?(l.strokeRgb=me.getColor(),l.lineWidth=Le.getLineWidth(),l.isAngleSnap=Le.getIsSnap()||oe.isPressed("shift")):(l.isFixedRatio=Le.getIsFixed()||oe.isPressed("shift"),"stroke"===Le.getMode()?(l.strokeRgb=me.getColor(),l.lineWidth=Le.getLineWidth()):l.fillRgb=me.getColor()),e?(V.setComposite(o,null),V.drawShape(o,l)):V.setComposite(o,{draw:function(e){s.KL.drawShape(e,l)}}),ae.requestFrame()}}),Ee=s.KL.klLayerManager(V,(function(e){M(V.getLayer(e)),l.klHistory.push({tool:["misc"],action:"focusLayer",params:[e]})}),H),Me=new s.KL.LayerPreview({klRootEl:H,onClick:function(){W.open("layers")}});Me.setIsVisible(F>=579),Me.setLayer(V.getLayer(V.getLayerIndex($.canvas)));var Ie=new s.KL.FilterTab(H,me,Ee,ae,Ce,(function(){return J}),(function(){return D}),(function(){return V}),(function(){return $}),!!n.embed,ue),Ae=new s.KL.UndoRedoCatchup(se,Me,Ee,Ce,ae,(function(){if(!Y)throw new Error("initState not initialized");return Y}),(function(){return V}),(function(){return $}),(function(e){$=e}),(function(){return q}));l.klHistory.addListener((function(e){Ae.catchup(e)}));var Re=new s.KL.SaveToComputer(n.saveReminder,H,(function(){return K}),(function(){return V}),G),Pe=n.embed?null:new s.KL.FileTab(H,j,(function(){return V.getProject()}),K,(function(e){K=e}),L,(function(){Re.save()}),I,A,(function(){s.KL.imgurUpload(V,H,n.saveReminder,n.app&&n.app.imgurKey?n.app.imgurKey:null)}),P,n.saveReminder),Oe=new s.KL.SettingsTab((function(){z="left"===z?"right":"left",E(),n.embed||C.LocalStorage.setItem("uiState",z)}),n.aboutEl);W=new s.KL.TabRow({initialId:"draw",tabArr:[{id:"draw",title:(0,f.LANG)("tool-brush"),image:e(m),onOpen:function(){"eraserBrush"===Q&&me.enable(!1),c.BB.append(xe,[me.getElement(),me.getOutputElement(),be.getElement()]),ye.style.display="block"},onClose:function(){ye.style.display="none"},css:{minWidth:"45px"}},{id:"hand",title:(0,f.LANG)("tool-hand"),image:e(v),isVisible:!1,onOpen:function(){Ce.setIsVisible(!0)},onClose:function(){Ce.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"fill",title:(0,f.LANG)("tool-paint-bucket"),image:e(y),isVisible:!1,onOpen:function(){me.enable(!0),Se.setIsVisible(!0)},onClose:function(){Se.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"text",title:(0,f.LANG)("tool-text"),image:e(x),isVisible:!1,onOpen:function(){me.enable(!0),ke.setIsVisible(!0)},onClose:function(){ke.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"shape",title:(0,f.LANG)("tool-shape"),image:e(b),isVisible:!1,onOpen:function(){me.enable(!0),Le.setIsVisible(!0)},onClose:function(){Le.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"layers",title:(0,f.LANG)("tab-layers"),image:e(w),onOpen:function(){Ee.update(),Ee.style.display="block"},onClose:function(){Ee.style.display="none"},css:{minWidth:"45px"}},{id:"edit",label:(0,f.LANG)("tab-edit"),onOpen:function(){Ie.show()},onClose:function(){Ie.hide()},css:{padding:"0 7px"}},{id:"file",label:(0,f.LANG)("tab-file"),isVisible:!!Pe,onOpen:function(){Pe&&(Pe.getElement().style.display="block",Pe.setIsVisible(!0))},onClose:function(){Pe&&(Pe.getElement().style.display="none",Pe.setIsVisible(!1))},css:{padding:"0 7px"}},{id:"settings",title:(0,f.LANG)("tab-settings"),image:e(B),onOpen:function(){Oe.getElement().style.display="block"},onClose:function(){Oe.getElement().style.display="none"},css:{minWidth:"45px"}}]});var De=c.BB.el({css:{width:"270px",position:"absolute",bottom:"0",left:"0"}});n.bottomBar&&(De.append(n.bottomBar),new MutationObserver((function(){return O()})).observe(de,{attributes:!0,childList:!0,subtree:!0}));c.BB.append(de,[Me.getElement(),W.getElement(),ye,Ce.getElement(),Se.getElement(),ke.getElement(),Le.getElement(),Ee,Ie.getElement(),Pe?Pe.getElement():null,Oe.getElement(),c.BB.el({css:{height:"10px"}}),De||null]);var Ne=new s.KL.ToolspaceScroller({toolspace:he,uiState:z});this.getEl=function(){return H},this.resize=function(e,t){window.scrollY>0&&window.scrollTo(0,0),X===Math.max(0,e)&&F===Math.max(0,t)||(X=Math.max(0,e),F=Math.max(0,t),T(),O(),Me.setIsVisible(F>=579),me.setHeight(Math.max(163,Math.min(400,F-505))),ve.setIsSmall(F<540))},this.out=function(e){ue.out(e)},this.getPNG=function(){return(0,p.base64ToBlob)(V.getCompleteCanvas(1).toDataURL("image/png"))},this.getPSD=(0,a.default)(e(o).mark((function t(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,g.klCanvasToPsdBlob)(V);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),t)}))),this.getProject=function(){return V.getProject()},this.swapUiLeftRight=function(){z="left"===z?"right":"left",n.embed||C.LocalStorage.setItem("uiState",z),E()},this.saveAsPsd=function(){Re.save("psd")},this.isDrawing=function(){return ne.getIsDrawing()||ae.getIsDrawing()},this.resize(X,F),E(),c.BB.addEventListener(window,"resize",(function(){i.resize(window.innerWidth,window.innerHeight)})),c.BB.addEventListener(window,"orientationchange",(function(){i.resize(window.innerWidth,window.innerHeight)}));var ze=c.BB.el({parent:document.body,css:{position:"fixed",left:"0",top:"0",right:"0",bottom:"0",pointerEvents:"none",zIndex:"-1",userSelect:"none"}});try{new ResizeObserver((function(){return i.resize(window.innerWidth,window.innerHeight)})).observe(ze)}catch(e){ze.parentNode.removeChild(ze)}c.BB.addEventListener(H,"wheel",(function(e){oe.isPressed("ctrl")&&e.preventDefault()}));var Ge=function(e){e.preventDefault()};window.addEventListener("gesturestart",Ge),window.addEventListener("gesturechange",Ge),window.addEventListener("gestureend",Ge)}(0,d.importFilters)()})),r.register("hrnUX",(function(e,n){t(e.exports,"KL",(function(){return Be}));var i=r("gWfkn"),a=r("ekHRj"),o=r("i8UFO"),s=r("lXqiv"),l=r("c4LUw"),c=r("21VAD"),u=r("jKOQl"),h=r("gmlbk"),d=r("fCJWy"),p=r("llzZ0"),g=r("l4PqG"),f=r("lfHl9"),m=r("h7i9r"),v=r("kzhsD"),y=r("bd9hB"),x=r("9A7OD"),b=r("iskOY"),B=r("bmB93"),w=r("auloj"),C=r("hRdOL"),S=r("isYih"),k=r("5rdL4"),L=r("7bo3M"),T=r("lV6Vy"),E=r("i5nyl"),M=r("cNhNm"),I=r("kEeSq"),A=r("32CBv"),R=r("kqmpc"),P=r("j1kEL"),O=r("8ebuX"),D=r("13r5y"),N=r("9p4Zp"),z=r("8jqzp"),G=r("84zxV"),j=r("9Kxky"),H=r("1Ax5m"),X=r("e4sAN"),F=r("khi8I"),U=r("dJXmR"),K=r("iS9xS"),V=r("9J17G"),W=r("76Qvv"),Y=r("1uc3b"),_=r("h20yl"),q=r("keKW3"),Q=r("kDGzx"),J=r("30Cml"),Z=r("941rU"),$=r("3ujzu"),ee=r("705qg"),te=r("9BlwZ"),ne=r("kyVjY"),re=r("dAXbp"),ie=r("3P46L"),ae=r("5ebUJ"),oe=r("bHZQg"),se=r("9pcu9"),le=r("aSJRf"),ce=r("6mTnI"),ue=r("eK8ID"),he=r("2umOB"),de=r("5ENro"),pe=r("lkluh"),ge=r("5ngYX"),fe=r("eyygR"),me=r("6rdi0"),ve=(te=r("9BlwZ"),r("7pyBK")),ye=r("iDHln"),xe=r("bIgqE"),be=r("iVHpg"),Be={brushes:re.brushes,brushesUI:ie.brushesUI,BrushSettingService:ve.BrushSettingService,KlCanvas:ee.KlCanvas,drawProject:le.drawProject,WorkspaceSvgOverlay:L.WorkspaceSvgOverlay,KlCanvasWorkspace:T.KlCanvasWorkspace,KlCanvasPreview:E.KlCanvasPreview,filterLibStatus:ne.filterLibStatus,filterLib:ne.filterLib,UndoRedoCatchup:me.UndoRedoCatchup,renderText:_.renderText,floodFillBits:J.floodFillBits,ShapeTool:$.ShapeTool,drawShape:$.drawShape,PSD:Z,setDbName:te.setDbName,indexedDb:te,ProjectStore:ce.ProjectStore,loadAgPsd:pe.loadAgPsd,SaveToComputer:fe.SaveToComputer,calcSliderFalloffFactor:g.calcSliderFalloffFactor,Checkbox:s.Checkbox,input:l.input,Select:c.Select,ImageToggle:u.ImageToggle,ImageRadioList:h.ImageRadioList,RadioList:oe.RadioList,penPressureToggle:d.penPressureToggle,KlSlider:p.KlSlider,HexColorDialog:f.HexColorDialog,KlColorSlider:m.KlColorSlider,KlSmallColorSlider:v.KlSmallColorSlider,PointSlider:y.PointSlider,ColorOptions:x.ColorOptions,Options:b.Options,BoxToggle:ye.BoxToggle,StatusOverlay:B.StatusOverlay,CropCopy:C.CropCopy,FreeTransform:M.FreeTransform,FreeTransformCanvas:I.FreeTransformCanvas,Cropper:A.Cropper,LayerPreview:R.LayerPreview,FittedImage:P.FittedImage,KlImageDropper:D.KlImageDropper,OverlayToolspace:N.OverlayToolspace,ToolspaceTopRow:z.ToolspaceTopRow,ToolDropdown:G.ToolDropdown,ToolspaceToolRow:j.ToolspaceToolRow,ToolspaceStabilizerRow:H.ToolspaceStabilizerRow,TabRow:X.TabRow,ToolspaceCollapser:Y.ToolspaceCollapser,BrowserStorageUi:se.BrowserStorageUi,SaveReminder:ge.SaveReminder,ToolspaceScroller:be.ToolspaceScroller,dialogCounter:o.dialogCounter,popup:a.popup,Popup:a.Popup,exportDialog:w.exportDialog,clipboardDialog:S.clipboardDialog,showImportAsLayerDialog:O.showImportAsLayerDialog,newImageDialog:W.newImageDialog,textToolDialog:q.textToolDialog,showImportImageDialog:Q.showImportImageDialog,showIframePopup:ae.showIframePopup,imgurUpload:de.imgurUpload,HandUi:F.HandUi,FillUi:U.FillUi,TextUi:K.TextUi,ShapeUi:V.ShapeUi,FileTab:ue.FileTab,FilterTab:he.FilterTab,SettingsTab:xe.SettingsTab,klLayerManager:k.klLayerManager,klHistory:i.klHistory,DecoyKlHistory:i.DecoyKlHistory}})),r.register("gWfkn",(function(e,n){t(e.exports,"DecoyKlHistory",(function(){return l})),t(e.exports,"klHistory",(function(){return c}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("7U0Ew"),s=!1,l=function(){"use strict";function e(){(0,i.default)(this,e)}return(0,a.default)(e,[{key:"pause",value:function(e){}},{key:"addListener",value:function(e){}},{key:"push",value:function(e){}},{key:"undo",value:function(){return[]}},{key:"redo",value:function(){return[]}},{key:"getAll",value:function(){return[]}},{key:"canRedo",value:function(){return!1}},{key:"canUndo",value:function(){return!1}},{key:"getState",value:function(){return 0}},{key:"getActionNumber",value:function(){return 0}}]),e}(),c=new(function(){"use strict";function e(){if((0,i.default)(this,e),(0,o.default)(this,"max",20),s)throw new Error("klHistory already instantiated");s=!0,this.state=0,this.dataArr=[],this.listeners=[],this.pauseStack=0,this.maxState=-1,this.actionNumber=-1}return(0,a.default)(e,[{key:"broadcast",value:function(e){var t=this;setTimeout((function(){for(var n=0;n<t.listeners.length;n++)t.listeners[n](e);t.state++}),1)}},{key:"pause",value:function(e){!1===e?this.pauseStack=Math.max(0,this.pauseStack-1):this.pauseStack++}},{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"push",value:function(e){if(!(this.pauseStack>0)){for(;this.actionNumber<this.dataArr.length-1;)this.dataArr.pop();var t=this.dataArr[this.dataArr.length-1];if("layerOpacity"===e.action&&t&&"layerOpacity"===t.action&&t.params[0]===e.params[0])return this.dataArr[this.dataArr.length-1]=e,void this.state++;if("focusLayer"===e.action&&t&&"focusLayer"===t.action)return this.dataArr[this.dataArr.length-1]=e,void this.state++;this.dataArr[this.dataArr.length]=e,this.actionNumber=this.dataArr.length-1;var n=this.maxState;this.maxState=Math.max(this.maxState,this.actionNumber-this.max),n<this.maxState?this.broadcast({bufferUpdate:this.dataArr[this.maxState]}):this.broadcast(null),this.maxState>=0&&(this.dataArr[this.maxState]=null)}}},{key:"undo",value:function(){var e;if(this.canUndo()){e=[];for(var t=this.maxState+1;t<this.actionNumber;t++)e.push(this.dataArr[t]);this.actionNumber--,this.broadcast(null)}return e}},{key:"redo",value:function(){var e=[];return this.canRedo()&&(this.actionNumber++,e.push(this.dataArr[this.actionNumber]),this.broadcast(null)),e}},{key:"getAll",value:function(){return[].concat(this.dataArr)}},{key:"canRedo",value:function(){return this.actionNumber<this.dataArr.length-1}},{key:"canUndo",value:function(){return this.actionNumber>this.maxState}},{key:"getState",value:function(){return this.state}},{key:"getActionNumber",value:function(){return this.actionNumber+1}}]),e}())})),r.register("ekHRj",(function(n,i){t(n.exports,"popup",(function(){return u})),t(n.exports,"Popup",(function(){return h}));var a=r("i8UFO"),o=r("eWjiX"),s=r("c0kqC"),l=r("fh18w"),c=r("1mH1z");function u(t){var n=function(e){r||(r=!0,o.BB.clearSelection(),o.BB.unfocusAnyInput(),document.body.removeChild(i),a.dialogCounter.decrease(),o.BB.destroyEl(p),o.BB.destroyEl(d),m.destroy(),o.BB.removeEventListener(u,"wheel",v),u.onclick=null,B.forEach((function(e){o.BB.destroyEl(e)})),B.splice(0,B.length),t.callback&&t.callback(e))};a.dialogCounter.increase();var r=!1,i=o.BB.el({parent:document.body,css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",overflow:"hidden"}}),u=o.BB.el({parent:i,className:"kl-popup"}),h=o.BB.el({parent:u,css:{width:"100%",minHeight:"100%",position:"relative",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}}),d=o.BB.el({parent:h,onClick:function(){t.ignoreBackground||n("Cancel")},css:{position:"absolute",left:"0",top:"0",zIndex:"0",width:"100%",height:"100%"}}),p=o.BB.el({tagName:"button",className:"popup-x",content:'<img alt="'.concat((0,c.LANG)("modal-close"),'" height="20" src="').concat(e(l),'">'),title:(0,c.LANG)("modal-close"),onClick:function(){n("Cancel")},css:{width:"40px",height:"40px",lineHeight:"40px",position:"absolute",right:"0",top:"0",background:"none",boxShadow:"none"}}),g=["kl-popup-box"];g.push("kl-popup-box--sm");var f=o.BB.el({content:[p,o.BB.el({content:t.message,css:{marginBottom:t.div?"10px":null,marginRight:"15px"}}),t.div],className:g.join(" "),css:t.style?t.style:null});h.append(o.BB.el({css:{flex:"0.5"}}),f,o.BB.el({css:{flex:"1"}})),"error"===t.type&&f.classList.add("poperror"),"ok"===t.type&&f.classList.add("popok"),"warning"===t.type&&f.classList.add("popwarning"),"upload"===t.type&&f.classList.add("popupload");var m=new o.BB.KeyListener({onDown:function(e,t,i){r||(x&&"enter"===i&&!o.BB.isInputFocused()&&(t.stopPropagation(),setTimeout((function(){x.click()}),10)),"esc"===i&&(t.stopPropagation(),n("Cancel")))}}),v=function(e){m.isPressed("ctrl")&&e.preventDefault()};o.BB.addEventListener(u,"wheel",v),u.onclick=o.BB.handleClick;var y=null;y=t.autoFocus?t.autoFocus:!1===t.autoFocus?null:"Ok";var x,b=t.buttons&&t.buttons.length>0?o.BB.el({parent:f,css:{display:"flex",flexWrap:"wrap",justifyContent:"flex-end",marginTop:"12px",marginLeft:"-8px"}}):null,B=[];t.buttons&&t.buttons.forEach((function(r){var i,a=["kl-popup__btn"];("Ok"===r||t.primaries&&t.primaries.includes(r))&&a.push("kl-button-primary");var h=r;"Ok"===r&&(h=(0,c.LANG)("modal-ok"),i=e(s)),"Cancel"===r&&(h=(0,c.LANG)("modal-cancel"),i=e(l));var d=null;i&&(d=o.BB.el({tagName:"img",custom:{src:i,height:"17"}}));var p=o.BB.el({parent:b,tagName:"button",className:a.join(" "),content:[d,h],onClick:function(){n(r)}});B.push(p),y===r&&(setTimeout((function(){p.focus(),u.scrollTo(0,0)}),10),setTimeout((function(){u.scrollTo(0,0)}),20)),r===t.clickOnEnter&&(x=p)})),t.closefunc&&t.closefunc((function(){n("Cancel")}))}window.onscroll=function(e){e.preventDefault()};var h=function(t){var n=function(){a.dialogCounter.decrease(),s.onclick=null,i.removeChild(s),clearInterval(undefined),window.removeEventListener("resize",r),f.destroy(),o.BB.destroyEl(p),o.BB.destroyEl(u),t.onClose&&t.onClose()},r=function(){var e=h.offsetWidth,t=h.offsetHeight;o.BB.css(h,{left:Math.max(0,(window.innerWidth-e)/2)+"px",top:Math.max(20,(window.innerHeight-t)/2-.2*t)+"px"})};a.dialogCounter.increase();var i=document.body,s=o.BB.el({parent:i,className:"g-root",css:{position:"fixed",left:"0",top:"0",bottom:"0",right:"0",background:"rgba(0, 0, 0, 0.45)",overflow:"auto",animationName:"consoleIn",animationDuration:"0.3s",animationTimingFunction:"ease-out"}});s.onclick=o.BB.handleClick;var u=o.BB.el({parent:s,css:{position:"absolute",left:"0",top:"0",bottom:"0",right:"0"},onClick:n}),h=o.BB.el({parent:s,css:{position:"absolute",width:o.BB.isCssMinMaxSupported()?"min(calc(100% - 40px), "+(t.width?t.width:400)+"px)":(t.width?t.width:400)+"px",height:"calc(100% - 40px)",background:"#eee",borderRadius:"10px",overflow:"hidden",boxShadow:"rgba(0, 0, 0, 0.25) 0px 5px 60px"}});r(),window.addEventListener("resize",r);var d=o.BB.el({parent:h,css:{height:"40px",display:"flex",justifyContent:"space-between",alignItems:"center",paddingLeft:"20px"}});t.title&&d.appendChild(t.title);var p=o.BB.el({parent:d,tagName:"button",className:"popup-x",content:'<img alt="'.concat((0,c.LANG)("modal-close"),'" height="20" src="').concat(e(l),'">'),title:(0,c.LANG)("modal-close"),onClick:n,css:{width:"40px",height:"40px",lineHeight:"40px",background:"none",boxShadow:"none"},custom:{tabindex:"0"}}),g=o.BB.el({parent:h,css:{height:"calc(100% - 40px)"}});t.content&&g.appendChild(t.content);var f=new o.BB.KeyListener({onDown:function(e,t){"esc"===e&&(t.stopPropagation(),n())}});this.close=function(){n()}}})),r.register("i8UFO",(function(e,n){t(e.exports,"dialogCounter",(function(){return s}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("7U0Ew"),s=new(function(){"use strict";function e(){(0,i.default)(this,e),(0,o.default)(this,"listeners",[]),(0,o.default)(this,"count",0)}return(0,a.default)(e,[{key:"emit",value:function(){var e=this;this.listeners.forEach((function(t){t(e.count)}))}},{key:"increase",value:function(e){void 0!==e?this.count+=e:this.count++,this.emit()}},{key:"decrease",value:function(e){void 0!==e?this.count-=e:this.count--,this.emit()}},{key:"get",value:function(){return this.count}},{key:"subscribe",value:function(e){this.listeners.push(e)}}]),e}())})),r.register("eWjiX",(function(e,n){t(e.exports,"BB",(function(){return b}));var i=r("h4olN"),a=r("7jh4K"),o=r("6J2My"),s=r("idV3L"),l=r("04lDo"),c=r("exufe"),u=r("eIcQa"),h=r("kVHNC"),d=r("4toIY"),p=r("af1iA"),g=r("dJ1E2"),f=r("72Jv0"),m=r("eg83P"),v=r("eelgW"),y=r("i0uIf"),x=r("6l0gQ"),b={eventUsesHighResTimeStamp:o.eventUsesHighResTimeStamp,mouseEventHasMovement:o.mouseEventHasMovement,hasPointerEvents:o.hasPointerEvents,hasWebGl:o.hasWebGl,getVisitor:o.getVisitor,isCssMinMaxSupported:o.isCssMinMaxSupported,canShareFiles:o.canShareFiles,insertAfter:a.insertAfter,loadImage:a.loadImage,css:a.css,setAttributes:a.setAttributes,append:a.append,fitInto:a.fitInto,centerWithin:a.centerWithin,getDate:a.getDate,gcd:a.gcd,reduce:a.reduce,decToFraction:a.decToFraction,imageBlobToUrl:a.imageBlobToUrl,dateDayDifference:a.dateDayDifference,copyObj:a.copyObj,shareCanvas:a.shareCanvas,handleClick:a.handleClick,createSvg:a.createSvg,BbLog:y.BbLog,LocalStorage:x.LocalStorage,mix:m.mix,dist:m.dist,distSquared:m.distSquared,lenSquared:m.lenSquared,pointsToAngleRad:m.pointsToAngleRad,pointsToAngleDeg:m.pointsToAngleDeg,clamp:m.clamp,rotate:m.rotate,rotateAround:m.rotateAround,Matrix:h.Matrix,Vec2:d.Vec2,intDxy:m.intDxy,roundEven:m.roundEven,roundUneven:m.roundUneven,round:m.round,updateBounds:m.updateBounds,boundsInArea:m.boundsInArea,projectPointOnLine:p.projectPointOnLine,PointLine:p.PointLine,BezierLine:p.BezierLine,SplineInterpolator:p.SplineInterpolator,quadraticSplineInput:p.quadraticSplineInput,canvas:v.createCanvas,copyCanvas:u.copyCanvas,testShouldPixelate:u.testShouldPixelate,drawTransformedImageWithBounds:u.drawTransformedImageWithBounds,drawTransformedImageOnCanvas:u.drawTransformedImageOnCanvas,createCheckerCanvas:u.createCheckerCanvas,createCheckerDataUrl:u.createCheckerDataUrl,resizeCanvas:u.resizeCanvas,convertToAlphaChannelCanvas:u.convertToAlphaChannelCanvas,freeCanvas:u.freeCanvas,HSV:g.HSV,RGB:g.RGB,CMYK:g.CMYK,ColorConverter:g.ColorConverter,testIsWhiteBestContrast:g.testIsWhiteBestContrast,appendTextDiv:f.appendTextDiv,clearSelection:f.clearSelection,makeUnfocusable:f.makeUnfocusable,el:f.el,destroyEl:f.destroyEl,isInputFocused:f.isInputFocused,unfocusAnyInput:f.unfocusAnyInput,addEventListener:i.addEventListener,removeEventListener:i.removeEventListener,setEventListener:i.setEventListener,KeyListener:s.KeyListener,PointerListener:l.PointerListener,sameKeys:s.sameKeys,EventChain:c}})),r.register("h4olN",(function(e,n){t(e.exports,"setEventListener",(function(){return a})),t(e.exports,"addEventListener",(function(){return o})),t(e.exports,"removeEventListener",(function(){return s}));var i=r("6J2My"),a=function(e,t,n){i.hasPointerEvents||(t=t.replace("pointer","mouse")),e[t]=n},o=function(e,t,n,r){i.hasPointerEvents||(t=t.replace("pointer","mouse")),e.addEventListener(t,n,r)},s=function(e,t,n,r){i.hasPointerEvents||(t=t.replace("pointer","mouse")),e.removeEventListener(t,n,r)}})),r.register("6J2My",(function(e,n){t(e.exports,"isFirefox",(function(){return h})),t(e.exports,"eventUsesHighResTimeStamp",(function(){return d})),t(e.exports,"mouseEventHasMovement",(function(){return p})),t(e.exports,"hasPointerEvents",(function(){return g})),t(e.exports,"hasWebGl",(function(){return f})),t(e.exports,"getVisitor",(function(){return m})),t(e.exports,"isCssMinMaxSupported",(function(){return v})),t(e.exports,"canShareFiles",(function(){return y}));var i,a,o,s,l,c,u=r("eelgW"),h=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,d=(a=null,document.body?(i=new Event(""),a=i.timeStamp<36e5):window.addEventListener("DOMContentLoaded",(function(e){a=e.timeStamp<36e5})),function(){if(null===a)throw"eventUsesHighResTimeStamp not initialized";return a}),p=function(){if(!("MouseEvent"in window))return!1;var e;try{e=new MouseEvent("mousemove")}catch(e){return!1}return"movementX"in e&&!h}(),g=!!window.PointerEvent,f=(o=function(){var e=(0,u.createCanvas)();try{return e.getContext("experimental-webgl",{premultipliedAlpha:!1}),!0}catch(e){return!1}}(),function(){return o}),m=(s={chrome:!1,gl:!1},window.chrome&&window.chrome.app&&(s.chrome=!0),s.gl=f(),function(){return JSON.parse(JSON.stringify(s))}),v=(l=function(){var e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.left="max(0px, 25px)",document.body.appendChild(e),setTimeout((function(){c=25===e.offsetLeft,document.body.removeChild(e)}),25)},c=null,document.body?l():window.addEventListener("DOMContentLoaded",(function(){l()})),function(){if(null===c)throw new Error("isCssMinMaxSupported not initialized");return c}),y=function(){return"share"in navigator&&"canShare"in navigator}})),r.register("eelgW",(function(e,n){function r(e,t){var n=document.createElement("canvas");return e&&t&&(n.width=e,n.height=t),n}t(e.exports,"createCanvas",(function(){return r}))})),r.register("7jh4K",(function(e,n){function r(e,t){e.parentNode&&e.parentNode.insertBefore(t,e.nextSibling)}function i(e,t){var n=0;!function r(){1e3!==n?e.complete?(n++,t()):setTimeout(r,1):alert("couldn't load")}()}function a(e,t){for(var n,r=Object.keys(t),i=e.style,a=0;a<r.length;a++)i[n=r[a]]=t[n],i.alignContent="true","userSelect"===n&&(i.webkitUserSelect=t[n])}function o(e,t){for(var n,r=Object.keys(t),i=0;i<r.length;i++)n=r[i],e.setAttribute(n,t[n])}function s(e,t){var n=document.createDocumentFragment();t.forEach((function(e){return e?n.append(e):null})),e.append(n)}function l(e,t,n,r,i){var a=e*n,o=t*n;return a>n&&(o*=n/a,a=n),o>r&&(a*=r/o,o=r),i&&(a=Math.max(i,a),o=Math.max(i,o)),{width:a,height:o}}function c(e,t,n,r){return{x:e/2-n/2,y:t/2-r/2}}function u(){var e=new Date;return e.getFullYear()+"_"+(e.getMonth()+1).toString().padStart(2,"0")+"_"+e.getDate().toString().padStart(2,"0")+"_"+(60*e.getHours()+e.getMinutes()).toString(36).padStart(3,"0")+"_"}function h(e,t){return t?h(t,e%t):e}function d(e,t){var n=h(e,t);return[e/n,t/n]}function p(e){var t=e.toString().length-2,n=Math.pow(10,t);return d(e*n,n)}function g(e){if(!e)throw new Error("blobObj is undefined or null");if(window.Blob&&e instanceof Blob)return URL.createObjectURL(e);if("Object"===e.constructor.name){var t=e;return"data:"+t.type+";"+t.encoding+","+t.data}throw new Error("unknown blob format")}function f(e,t){return e=new Date(e),t=new Date(t),e.setHours(0,0,0,0),t.setHours(0,0,0,0),(t.getTime()-e.getTime())/864e5}function m(e){return JSON.parse(JSON.stringify(e))}function v(e){var t="image/png",n=function(){return alert("sharing not supported")};e.canvas.toBlob((function(r){if(null===r)return n(),void e.callback();try{var i=[new File([r],e.fileName,{type:t})];navigator.share({title:e.title,files:i}).then((function(e){})).catch((function(e){n()}))}catch(e){n()}e.callback()}),t)}function y(e){var t=e.target;return!!t&&(!(!["A","LABEL","INPUT"].includes(t.tagName)&&!t.allowClick)||(e.preventDefault(),!1))}function x(e){for(var t,n=document.createElementNS("http://www.w3.org/2000/svg",e.elementType),r=Object.keys(e),i=0;i<r.length;i++)if("childrenArr"===(t=r[i]))for(var a=0;a<e.childrenArr.length;a++)n.appendChild(x(e.childrenArr[a]));else"elementType"!==t&&n.setAttribute(t,e[t]);return n}t(e.exports,"insertAfter",(function(){return r})),t(e.exports,"loadImage",(function(){return i})),t(e.exports,"css",(function(){return a})),t(e.exports,"setAttributes",(function(){return o})),t(e.exports,"append",(function(){return s})),t(e.exports,"fitInto",(function(){return l})),t(e.exports,"centerWithin",(function(){return c})),t(e.exports,"getDate",(function(){return u})),t(e.exports,"gcd",(function(){return h})),t(e.exports,"reduce",(function(){return d})),t(e.exports,"decToFraction",(function(){return p})),t(e.exports,"imageBlobToUrl",(function(){return g})),t(e.exports,"dateDayDifference",(function(){return f})),t(e.exports,"copyObj",(function(){return m})),t(e.exports,"shareCanvas",(function(){return v})),t(e.exports,"handleClick",(function(){return y})),t(e.exports,"createSvg",(function(){return x}))})),r.register("idV3L",(function(e,n){t(e.exports,"KeyListener",(function(){return l})),t(e.exports,"sameKeys",(function(){return c}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("h4olN"),s=function(){for(var e=function(e,t,n,r){d.forEach((function(i){i[0]&&i[0](e,t,n,r)}))},t=function(e,t,n){d.forEach((function(r){r[1]&&r[1](e,t,n)}))},n=function(t){var n=t.key,r="code"in t?t.code:t.keyCode;if(n in c){var i=c[n];if(l[i])return void e(i,t,u.join("+"),!0);l[i]=!0,h[r]=i,u.push(i),e(i,t,u.join("+"))}},r=function(e){e.key;var n="code"in e?e.code:e.keyCode,r=u.join("+");if(["Meta","MetaLeft","MetaRight","OSLeft","OSRight"].includes(n))i(null);else if(n in h&&null!==h[n]){var a=h[n];l[a]=!1,h[n]=null;for(var o=0;o<u.length;o++)u[o]==a&&(u.splice(o,1),o--);t(a,e,r)}},i=function(e){var n=u.join("+");u=[],h={};for(var r=[],i=0;i<s.length;i++)l[s[i]]&&(l[s[i]]=!1,r.push(s[i]));for(var a=0;a<r.length;a++)t(r[a],{preventDefault:function(){},stopPropagation:function(){}},n);d.forEach((function(e){e[2]&&e[2]()}))},a={space:[" ","Spacebar"],alt:["Alt","AltGraph"],shift:"Shift",ctrl:"Control",cmd:["Meta","MetaLeft","MetaRight"],enter:"Enter",esc:"Escape",backspace:"Backspace",delete:"Delete",sqbr_open:"[",sqbr_close:"]",a:["a","A"],b:["b","B"],c:["c","C"],e:["e","E"],f:["f","F"],g:["g","G"],r:["r","R"],s:["s","S"],t:["t","T"],u:["u","U"],x:["x","X"],y:["y","Y"],z:["z","Z"],plus:"+",minus:"-",left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown",home:"Home",end:"End"},s=Object.keys(a),l={},c={},u=[],h={},d=[],p=0;p<s.length;p++){l[s[p]]=!1;var g=a[s[p]];if("string"==typeof g)c[a[s[p]]]=s[p];else for(var f=0;f<g.length;f++)c[g[f]]=s[p]}return{add:function(e){if(!d.includes(e)){var t=0===d.length;d.push(e),t&&((0,o.addEventListener)(document,"keydown",n),(0,o.addEventListener)(document,"keyup",r),(0,o.addEventListener)(window,"blur",i))}},remove:function(e){if(d.includes(e)){for(var t=1===d.length,a=0;a<d.length;a++)if(d[a]===e){d.splice(a,1);break}t&&((0,o.removeEventListener)(document,"keydown",n),(0,o.removeEventListener)(document,"keyup",r),(0,o.removeEventListener)(window,"blur",i))}},getIsDown:function(){return l},getCombo:function(){return u}}}(),l=function(){"use strict";function e(t){(0,i.default)(this,e),this.onDown=t.onDown,this.onUp=t.onUp,this.onBlur=t.onBlur,this.ref=[this.onDown,this.onUp,this.onBlur],s.add(this.ref)}return(0,a.default)(e,[{key:"isPressed",value:function(e){if(!(e in s.getIsDown()))throw'key "'+e+'" not found';return s.getIsDown()[e]}},{key:"getComboStr",value:function(){return s.getCombo().join("+")}},{key:"comboOnlyContains",value:function(e){for(var t=0;t<s.getCombo().length;t++)if(!e.includes(s.getCombo()[t]))return!1;return!0}},{key:"destroy",value:function(){s.remove(this.ref)}}]),e}();function c(e,t){return e.split("+").sort().join("+")===t.split("+").sort().join("+")}})),r.register("04lDo",(function(e,n){t(e.exports,"PointerListener",(function(){return p}));var i,a,o,s,l,c=r("h4olN"),u=r("6J2My"),h=r("eg83P"),d=function(e){var t,n=function(t){e({deltaY:Math.round(t/o),pageX:l.pageX,pageY:l.pageY,clientX:l.clientX,clientY:l.clientY})},r=function(){null!==s&&(n(s),s=null),null===o||i.includes(o)||i.push(o),a=0,o=null},i=[100],a=0,o=null,s=null,l=null;this.process=function(e){l={pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY},clearTimeout(t),t=setTimeout(r,200);var c=e.deltaY;"deltaMode"in e&&1===e.deltaMode&&(c*=100/3);var u=Math.abs(c);if(a>0&&null===o)s=null;else{if(0===a){if(a++,u<50)return;return o=u,void(i.includes(o)?n(c):s=c)}if(0!==u){if(u===o||u/o%1<1e-4);else if(o/u%1<1e-4)o=u;else if(u!==o)return o=null,void(s=null);null!==s&&(n(s),s=null),n(c)}}}},p=(i=[],a=0,o=null,s=!1,l=1,function(e){var t,n,r,p=function(e){for(var t=0;t<H.length;t++)if(e===H[t].pointerId)return H[t];return null},g=function(e){for(var t=null,n=0;n<X.length;n++)X[n]===e&&(t=H[n],H.splice(n,1),X.splice(n,1),n--);return t},f=function(e,t){return 0===e||1===e?e:(a<60?(o=0===a?e:(0,h.mix)(e,o,.95),a++):s||(s=!0,o<.13&&(l=2.3)),Math.pow(e,1/l))},m=function(e){if(e.corrected)return e.corrected;var t={pointerId:e.pointerId,pointerType:e.pointerType,pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY,movementX:e.movementX,movementY:e.movementY,timeStamp:e.timeStamp+z,pressure:f(e.pressure,e.type),buttons:e.buttons,button:e.button,coalescedArr:[],eventPreventDefault:function(){e.preventDefault()},eventStopPropagation:function(){e.stopPropagation()}};e.corrected=t;var n=null;"pointerId"in e?"pressure"in e&&0!==e.buttons&&(["mouse"].includes(e.pointerType)||"touch"===e.pointerType&&0===e.pressure)&&(t.pressure=1,n=1):(t.pointerId=0,t.pointerType="mouse",t.pressure=0!==e.buttons?1:0,n=t.pressure),u.isFirefox&&"mouse"!=e.pointerType&&"pointermove"===e.type&&0===e.buttons&&(t.buttons=1);var r=[];"getCoalescedEvents"in e&&(r=e.getCoalescedEvents());var a=function(e){for(var t=i.length-1;t>=0;t--)if(e.pointerId===i[t].pointerId)return i[t];return null}(t);null===a&&(a=function(e){var t={pointerId:e.pointerId,lastPageX:null,lastPageY:null};return i.push(t),i.length>15&&i.shift(),t}(t));for(var o=a.lastPageX,s=a.lastPageY,l=0;l<r.length;l++){var c=r[l];t.coalescedArr.push({pageX:c.pageX,pageY:c.pageY,clientX:c.clientX,clientY:c.clientY,movementX:null===a.lastPageX?0:c.pageX-a.lastPageX,movementY:null===a.lastPageY?0:c.pageY-a.lastPageY,timeStamp:0===c.timeStamp?t.timeStamp:c.timeStamp+z,pressure:null===n?f(c.pressure):n}),a.lastPageX=c.pageX,a.lastPageY=c.pageY}return a.lastPageX=t.pageX,a.lastPageY=t.pageY,t.movementX=null===o?0:a.lastPageX-o,t.movementY=null===s?0:a.lastPageY-s,t},v=function(e,t,n){var r=M.getBoundingClientRect(),i={type:e,pointerId:t.pointerId,pointerType:t.pointerType,pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY,relX:t.clientX-r.left+M.scrollLeft,relY:t.clientY-r.top+M.scrollTop,dX:t.movementX,dY:t.movementY,time:t.timeStamp,eventPreventDefault:t.eventPreventDefault,eventStopPropagation:t.eventStopPropagation};if("pointermove"===e&&(i.coalescedArr=[],t.coalescedArr.length>1))for(var a,o=0;o<t.coalescedArr.length;o++)a=t.coalescedArr[o],i.coalescedArr.push({pageX:a.pageX,pageY:a.pageY,clientX:a.clientX,clientY:a.clientY,relX:a.clientX-r.left+M.scrollLeft,relY:a.clientY-r.top+M.scrollTop,dX:a.movementX,dY:a.movementY,time:a.timeStamp});if(n)for(var s=Object.keys(n),l=0;l<s.length;l++)i[s[l]]=n[s[l]];return i},y=function(e,t,n,r){var i=M.getBoundingClientRect(),a={type:e,pointerId:t.identifier,pointerType:"touch",pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY,relX:t.pageX-i.left+M.scrollLeft,relY:t.pageY-i.top+M.scrollTop,time:n.timeStamp+z,eventPreventDefault:function(){n.preventDefault()},eventStopPropagation:function(){n.stopPropagation()}};"pointermove"===e&&(a.coalescedArr=[]);for(var o=Object.keys(r),s=0;s<o.length;s++)a[o[s]]=r[o[s]];return a},x=function(){(0,c.removeEventListener)(document,"pointermove",S),(0,c.removeEventListener)(document,"pointerup",k),(0,c.removeEventListener)(document,"pointerleave",L)},b=function(){F++,R&&R(!0)},B=function(){F--,R&&R(!1)},w=function(e){e=m(e);var t=G;if(G=e.pointerType,X.includes(e.pointerId)||X.length===P||"touch"===e.pointerType)j=!1;else if(j||"mouse"!==e.pointerType||"pen"!==t){j=!1;var n=v("pointermove",e);I(n)}else j=!0},C=function(e){if(e=m(e),!X.includes(e.pointerId)&&X.length!==P&&[1,2,4].includes(e.buttons)){0===H.length&&((0,c.addEventListener)(document,"pointermove",S),(0,c.addEventListener)(document,"pointerup",k),(0,c.addEventListener)(document,"pointerleave",L));var t={pointerId:e.pointerId,pointerType:e.pointerType,downPageX:e.pageX,downPageY:e.pageY,buttons:e.buttons,lastPageX:e.pageX,lastPageY:e.pageY,lastTimeStamp:e.timeStamp};H.push(t),T(t),X.push(e.pointerId);var n=v("pointerdown",e,{downPageX:e.pageX,downPageY:e.pageY,button:O[e.buttons],pressure:e.pressure});I(n)}},S=function(e){if(e=m(e),X.includes(e.pointerId)){var t=p(e.pointerId);if(E(t),e.buttons===t.buttons){if(T(t),"pen"!==e.pointerType||e.pageX!==t.lastPageX||e.pageY!==t.lastPageY||e.timeStamp!==t.lastTimeStamp){var n=v("pointermove",e,{downPageX:t.downPageX,downPageY:t.downPageY,button:O[e.buttons],pressure:e.pressure});t.lastPageX=e.pageX,t.lastPageY=e.pageY,t.lastTimeStamp=e.timeStamp,I(n)}}else{1===H.length&&x(),g(e.pointerId);var r=v("pointerup",e,{downPageX:t.downPageX,downPageY:t.downPageY});I(r)}}},k=function(e){if(e=m(e),X.includes(e.pointerId)){1===H.length&&x();var t=g(e.pointerId);E(t);var n=v("pointerup",e,{downPageX:t.downPageX,downPageY:t.downPageY});I(n)}},L=function(e){if(e=m(e),X.includes(e.pointerId)){1===H.length&&x();var t=g(e.pointerId);E(t);var n=v("pointerup",e,{downPageX:t.downPageX,downPageY:t.downPageY});I(n)}},T=function(e){"touch"===e.pointerType&&(e.touchTimeout=setTimeout((function(){!function(e){var t={pointerId:e.pointerId,pointerType:e.pointerType,type:"pointerup",timeStamp:performance.now(),pageX:0,pageY:0,clientX:0,clientY:0,preventDefault:function(){},stopPropagation:function(){}};k(t)}(e)}),2500))},E=function(e){e.touchTimeout&&(clearTimeout(e.touchTimeout),e.touchTimeout=null)},M=e.target,I=e.onPointer,A=e.onWheel,R=e.onEnterLeave,P="maxPointers"in e?e.maxPointers:1,O={1:"left",2:"right",4:"middle"},D=new d((function(e){if(!N&&A){var t=M.getBoundingClientRect();e.relX=e.clientX-t.left+M.scrollLeft,e.relY=e.clientY-t.top+M.scrollTop,A(e)}})),N=!1,z=(0,u.eventUsesHighResTimeStamp)()?0:-performance.timing.navigationStart,G="",j=!1,H=[],X=[],F=0;R&&((0,c.addEventListener)(M,"pointerenter",b),(0,c.addEventListener)(M,"pointerleave",B)),I&&((0,c.addEventListener)(M,"pointermove",w),(0,c.addEventListener)(M,"pointerdown",C)),A&&(0,c.addEventListener)(M,"wheel",D.process),u.hasPointerEvents?e.fixScribble&&(n=function(e){e.preventDefault()},(0,c.addEventListener)(M,"touchmove",n)):(t=function(e){e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length&&H.length<P;i++){var a=t[i];0===H.length&&((0,c.addEventListener)(document,"touchmove",n),(0,c.addEventListener)(document,"touchend",r),(0,c.addEventListener)(document,"touchcancel",r)),H.push({pointerId:a.identifier,downPageX:a.pageX,downPageY:a.pageY,buttons:1,lastPageX:a.pageX,lastPageY:a.pageY}),X.push(a.identifier);var o=y("pointerdown",a,e,{dX:0,dY:0,downPageX:a.downPageX,downPageY:a.downPageY,button:"left",pressure:1});I(o)}},n=function(e){e.preventDefault();for(var t=e.changedTouches,n=0;n<t.length;n++){var r=t[n];if(X.includes(r.identifier)){var i=p(r.identifier),a=y("pointermove",r,e,{dX:r.pageX-i.lastPageX,dY:r.pageY-i.lastPageY,downPageX:i.downPageX,downPageY:i.downPageY,button:"left",isCoalesced:!1,pressure:1});i.lastPageX=r.pageX,i.lastPageY=r.pageY,I(a)}}},r=function(e){"touchcancel"!==e.type&&e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length;i++){var a=t[i];if(X.includes(a.identifier)){1===H.length&&((0,c.removeEventListener)(document,"touchmove",n),(0,c.removeEventListener)(document,"touchend",r),(0,c.removeEventListener)(document,"touchcancel",r));var o=g(a.identifier),s=y("pointerup",a,e,{dX:a.pageX-o.lastPageX,dY:a.pageY-o.lastPageY,downPageX:o.downPageX,downPageY:o.downPageY});I(s)}}},I&&(0,c.addEventListener)(M,"touchstart",t)),this.isOver=function(){return F>0},this.destroy=function(){N||(N=!0,(0,c.removeEventListener)(M,"pointerenter",b),(0,c.removeEventListener)(M,"pointerleave",B),(0,c.removeEventListener)(M,"pointermove",w),(0,c.removeEventListener)(M,"pointerdown",C),(0,c.removeEventListener)(M,"wheel",D.process),H.length>0&&x(),u.hasPointerEvents?(0,c.removeEventListener)(M,"touchmove",n):((0,c.removeEventListener)(M,"touchstart",t),H.length>0&&((0,c.removeEventListener)(document,"touchmove",n),(0,c.removeEventListener)(document,"touchend",r),(0,c.removeEventListener)(document,"touchcancel",r))))}})})),r.register("eg83P",(function(e,n){function r(e,t,n){return e*(1-n)+t*n}function i(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))}function a(e,t,n,r){return Math.pow(e-n,2)+Math.pow(t-r,2)}function o(e,t){return e*e+t*t}function s(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function l(e,t){return 180*s(e,t)/Math.PI}function c(e,t,n){return e<=t?t:e>=n?n:e}function u(e,t,n){var r=n*(Math.PI/180),i=Math.cos(r),a=Math.sin(r);return{x:e*i-t*a,y:e*a+t*i}}function h(e,t,n){var r=u(t.x-e.x,t.y-e.y,n);return r.x+=e.x,r.y+=e.y,r}function d(e,t,n){e.x+=t,e.y+=n;var r=Math.round(e.x),i=Math.round(e.y);return e.x-=r,e.y-=i,{dX:r,dY:i}}function p(e){if(e%1==0)return e%2==0?e:e+1;var t=Math.ceil(e),n=Math.floor(e);return t%2==0?t:n}function g(e){if(e%1==0)return e%2==0?e+1:e;var t=Math.ceil(e),n=Math.floor(e);return t%2==1?t:n}function f(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}function m(e,t){return t?(e?(e.x1=Math.min(e.x1,t.x1),e.y1=Math.min(e.y1,t.y1),e.x2=Math.max(e.x2,t.x2),e.y2=Math.max(e.y2,t.y2)):e={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2},e):e}function v(e,t,n){var r=Math.max(0,e.x1),i=Math.max(0,e.y1),a=Math.min(t-1,e.x2),o=Math.min(n-1,e.y2);return r>a||i>o?null:{x1:r,y1:i,x2:a,y2:o}}t(e.exports,"mix",(function(){return r})),t(e.exports,"dist",(function(){return i})),t(e.exports,"distSquared",(function(){return a})),t(e.exports,"lenSquared",(function(){return o})),t(e.exports,"pointsToAngleRad",(function(){return s})),t(e.exports,"pointsToAngleDeg",(function(){return l})),t(e.exports,"clamp",(function(){return c})),t(e.exports,"rotate",(function(){return u})),t(e.exports,"rotateAround",(function(){return h})),t(e.exports,"intDxy",(function(){return d})),t(e.exports,"roundEven",(function(){return p})),t(e.exports,"roundUneven",(function(){return g})),t(e.exports,"round",(function(){return f})),t(e.exports,"updateBounds",(function(){return m})),t(e.exports,"boundsInArea",(function(){return v}))})),r.register("exufe",(function(e,n){t(e.exports,"EventChain",(function(){return a})),t(e.exports,"DoubleTapper",(function(){return o})),t(e.exports,"NFingerTapper",(function(){return s})),t(e.exports,"PinchZoomer",(function(){return l})),t(e.exports,"CoalescedExploder",(function(){return c})),t(e.exports,"OnePointerLimiter",(function(){return u})),t(e.exports,"LinetoolProcessor",(function(){return h})),t(e.exports,"LineSanitizer",(function(){return d})),t(e.exports,"LineSmoothing",(function(){return p}));var i=r("eg83P"),a=function(e){for(var t=function(e,t){for(;e<n.length;e++)if(null===(t=n[e].chainIn(t)))return null;return r(t),null},n=e.chainArr,r=function(){},i=0;i<n.length;i++)!function(e){n[e].setChainOut((function(n){t(e+1,n)}))}(i);this.chainIn=function(e){return t(0,e)},this.setChainOut=function(e){r=e}},o=function(e){var t=function(){if(0!==f.length){clearTimeout(b.fail),clearTimeout(b.maxUntilSecondDown),clearTimeout(b.success),b.fail=null,b.maxUntilSecondDown=null,b.success=null;for(var e=0;e<x.length;e++)a(x[e]);x=[],f=[]}},n=function(){b.fail=null,b.success=null,x=[];var t=f[f.length-1];f=[],e.onDoubleTap({pageX:t.pageX,pageY:t.pageY})},r=function(e,t,n){var r=n-y;return!(r<=0)&&(b[e]=setTimeout(t,r),!0)},a=function(){},o=400,s=300,l=10,c=19,u=500,h=300,d=250,p=["touch","mouse","pen"],g=["left"],f=[],m=[],v=0,y=0,x=[],b={fail:null,maxUntilSecondDown:null,success:null};this.chainIn=function(e){return function(e){if("pointerdown"===e.type)m.push(e.pointerId);else if("pointerup"===e.type)for(var a=0;a<m.length;a++)if(m[a]===e.pointerId){m.splice(a,1);break}if(p.includes(e.pointerType)){y=performance.now();var x=f.length>0?f[f.length-1]:null;if("pointerup"===e.type&&(v=e.time),"pointerdown"===e.type){if(m.length>1)return void t();if(null!==b.success)return void t();if(0===f.length&&y-v<o)return void t();if(!g.includes(e.button))return void t();if(x&&x.isDown||f.length>2)return void t();if(x&&(0,i.dist)(x.position[0],x.position[1],e.pageX,e.pageY)>c&&(t(),y-x.time<o))return;if(f.push({isDown:!0,time:y,position:[e.pageX,e.pageY],pointerId:e.pointerId}),f.length>1)clearTimeout(b.maxUntilSecondDown);else if(!r("maxUntilSecondDown",t,e.time+h))return void t();if(clearTimeout(b.fail),!r("fail",t,e.time+s))return void t()}if(x&&"pointermove"===e.type&&x.pointerId===e.pointerId&&(0,i.dist)(x.position[0],x.position[1],e.pageX,e.pageY)>l)return void t();if(x&&"pointerup"===e.type){if(x.pointerId!==e.pointerId)return void t();if(y>=x.time+s)return void t();if(clearTimeout(b.fail),f.length<3)return r("fail",t,e.time+u)?void(f=[x,{isUp:!0,time:y,position:[e.pageX,e.pageY]}]):void t();y<f[1].time+u?(f.push({pageX:e.pageX,pageY:e.pageY}),r("success",n,e.time+d)||t()):t()}}else t()}(e),0===f.length?(t(),e):(x.push(e),null)},this.setChainOut=function(e){a=e},this.setAllowedPointerTypeArr=function(e){p=e},this.setAllowedButtonArr=function(e){g=e}},s=function(e){var t,n,r=function(){if(0!==g.length){clearTimeout(v.firstLastDownTimeout),clearTimeout(v.tapTimeout);for(var e=0;e<g.length;e++)l(g[e]);g=[],p=[]}},a=function(e,t){var i=t-n;return!(i<=0)&&(v[e]=setTimeout(r,i),!0)},o=function(o){var l=f;if(f=o.time,"pointerdown"===o.type)m.push(o.pointerId);else if("pointerup"===o.type)for(var y=0;y<m.length;y++)if(m[y]===o.pointerId){m.splice(y,1);break}if("touch"===o.pointerType){if(n=performance.now(),"pointerdown"===o.type)return p.length+1!==m.length||p.length===s||p.length>0&&o.time-h>p[0].downTime||0===p.length&&o.time-c<l?void r():0!==p.length||(t=o.time,a("firstLastDownTimeout",o.time+h)&&a("tapTimeout",o.time+u))?void p.push({pointerId:o.pointerId,downTime:o.time,downPageX:o.pageX,downPageY:o.pageY}):void r();if("pointermove"===o.type){if(0===p.length)return;for(var x=null,b=0;b<p.length;b++)if(p[b].pointerId===o.pointerId){x=p[b];break}if(null===x)return void r();if(o.time-u>t)return void r();if((0,i.dist)(o.pageX,o.pageY,x.downPageX,x.downPageY)>d)return void r()}if("pointerup"===o.type){if(0===p.length)return;if(p.length!==s)return void r();for(var B=null,w=0;w<p.length;w++)if(p[w].pointerId===o.pointerId){B=p[w];break}if(null===B)return;if(o.time-u>t)return void r();if((0,i.dist)(o.pageX,o.pageY,B.downPageX,B.downPageY)>d)return void r();B.isUp=!0;for(var C=!0,S=0;S<p.length;S++)if(!p[S].isUp){C=!1;break}if(C)return clearTimeout(v.firstLastDownTimeout),clearTimeout(v.tapTimeout),g=[],p=[],e.onTap(),!0}}else p.length>0&&r()},s=e.fingers,l=function(){},c=50,u=500,h=250,d=12,p=[],g=[],f=0,m=[],v={firstLastDownTimeout:null,tapTimeout:null};this.chainIn=function(e){return!0===o(e)?null:0===p.length?e:(g.push(e),null)},this.setChainOut=function(e){l=e}},l=function(e){var t,n=function(){p=null,g=[]},r=function(e){if(p){if(clearTimeout(f.secondFingerTimeout),!e)for(var t=0;t<g.length;t++)h(g[t]);n()}},a=function(e){if("pointerdown"===e.type)d.push(e.pointerId);else if("pointerup"===e.type)for(var a=0;a<d.length;a++)if(d[a]===e.pointerId){d.splice(a,1);break}if(p||!("touch"!==e.pointerType||"pointermove"===e.type&&d.length>0||d.length>1||"pointerup"===e.type)){if(t=performance.now(),"pointerdown"===e.type)return p?"touch"===e.pointerType?(p.touchPointerArr.push({pointerId:e.pointerId,relX:e.relX,relY:e.relY}),void(p.isInProgress?s(p,{type:"down",index:p.touchPointerArr.length-1}):(clearTimeout(f.secondFingerTimeout),p.isInProgress=!0,o(p)))):void(p.isInProgress?p.otherPointerIdArr.push(e.pointerId):r()):(p={touchPointerArr:[{pointerId:e.pointerId,relX:e.relX,relY:e.relY,downRelX:e.relX,downRelY:e.relY}],otherPointerIdArr:[],isInProgress:!1},h="secondFingerTimeout",g=function(){r()},m=e.time+u,(v=m-t)<=0||(f[h]=setTimeout(g,v),0)?void r():void 0);var h,g,m,v;if("pointermove"!==e.type||"touch"!==e.pointerType){if("pointerup"===e.type){if("touch"===e.pointerType){for(var y=0;y<p.touchPointerArr.length;y++)if(p.touchPointerArr[y].pointerId===e.pointerId){p.touchPointerArr.splice(y,1);break}p.touchPointerArr.length>0&&s(p,{type:"up",index:y})}else for(var x=0;x<p.otherPointerIdArr.length;x++)if(p.otherPointerIdArr[x]===e.pointerId){p.otherPointerIdArr.splice(x,1);break}if(0===p.touchPointerArr.length&&0===p.otherPointerIdArr.length)return void(p.isInProgress?(n(),l()):r())}}else{for(var b=null,B=0;B<p.touchPointerArr.length;B++)if(e.pointerId===p.touchPointerArr[B].pointerId){b=p.touchPointerArr[B];break}if(b.relX=e.relX,b.relY=e.relY,p.isInProgress)B<2&&s(p,{type:"move",index:B});else if((0,i.dist)(b.downRelX,b.downRelY,b.relX,b.relY)>c)return void r()}}},o=function(t){for(var n=0;n<t.touchPointerArr.length;n++){var r=t.touchPointerArr[n];m.push({pointerId:r.pointerId,relX:r.relX,relY:r.relY,downRelX:r.relX,downRelY:r.relY})}var i={type:"move",angleRad:0,scale:1};1===m.length?(i.relX=m[0].downRelX,i.relY=m[0].downRelY):(i.relX=.5*(m[0].downRelX+m[1].downRelX),i.relY=.5*(m[0].downRelY+m[1].downRelY)),i.downRelX=i.relX,i.downRelY=i.relY,e.onPinch(i)},s=function(t,n){if(!(n.index>1))if("move"===n.type){var r;if(m[n.index].relX=t.touchPointerArr[n.index].relX,m[n.index].relY=t.touchPointerArr[n.index].relY,1===m.length)r={type:"move",downRelX:m[0].downRelX,downRelY:m[0].downRelY,relX:m[0].relX,relY:m[0].relY,angleRad:0,scale:1};else{var a=(0,i.dist)(m[0].downRelX,m[0].downRelY,m[1].downRelX,m[1].downRelY),s=(0,i.dist)(m[0].relX,m[0].relY,m[1].relX,m[1].relY),c=(0,i.pointsToAngleRad)({x:m[0].downRelX,y:m[0].downRelY},{x:m[1].downRelX,y:m[1].downRelY}),u=(0,i.pointsToAngleRad)({x:m[0].relX,y:m[0].relY},{x:m[1].relX,y:m[1].relY});r={type:"move",downRelX:.5*(m[0].downRelX+m[1].downRelX),downRelY:.5*(m[0].downRelY+m[1].downRelY),relX:.5*(m[0].relX+m[1].relX),relY:.5*(m[0].relY+m[1].relY),angleRad:u-c,scale:s/a}}e.onPinch(r)}else"down"!==n.type&&"up"!==n.type||(l(),o(t))},l=function(){m=[],e.onPinch({type:"end"})},c=10,u=250,h=function(){},d=[],p=null,g=[],f={secondFingerTimeout:null},m=[];this.chainIn=function(e){return a(e),p?(p.isInProgress||g.push(e),null):e},this.setChainOut=function(e){h=e}},c=function(){var e=function(){};this.chainIn=function(t){if("pointermove"!==t.type)return t;if(!(t.coalescedArr.length>0))return t;var n,r=JSON.parse(JSON.stringify(t));r.coalescedArr=[];for(var i=0;i<t.coalescedArr.length;i++)i>0&&(r=JSON.parse(JSON.stringify(t))),n=t.coalescedArr[i],r.pageX=n.pageX,r.pageY=n.pageY,r.relX=n.relX,r.relY=n.relY,r.dX=n.dX,r.dY=n.dY,r.time=n.time,i<t.coalescedArr.length-1&&(r.isCoalesced=!0),e(r);return null},this.setChainOut=function(t){e=t}},u=function(e){var t=null,n=[];this.chainIn=function(e){if(n.includes(e.pointerId)){if("pointerup"===e.type)for(var r=0;r<n.length;r++)if(n[r]===e.pointerId){n.splice(r,1);break}return null}return null===t?("pointerdown"===e.type&&(t=e.pointerId),e):e.pointerId!==t?("pointerdown"===e.type&&n.push(e.pointerId),null):("pointerup"===e.type&&(t=null),e)},this.setChainOut=function(e){e}},h=function(e){var t=null,n=[],r=null;this.process=function(i){if("down"===i.type&&(t=i,r=null,i.shiftIsPressed))return e.onDraw({type:"line",x0:null,y0:null,pressure0:null,x1:i.x,y1:i.y,pressure1:i.pressure}),void n.push(i);if("move"===i.type)if(i.shiftIsPressed){if(null===r){var a=Math.abs(i.x-t.x),o=Math.abs(i.y-t.y);if(a>5||o>5){r=a>o?0:1;for(var s=0;s<n.length;s++){var l=n[s];0===r?l.y=t.y:l.x=t.x,e.onDraw(JSON.parse(JSON.stringify(l)))}n=[]}}if(null===r)return void n.push(i);0===r?i.y=t.y:i.x=t.x}else if(n.length>0){for(var c=0;c<n.length;c++)e.onDraw(JSON.parse(JSON.stringify(n[c])));n=[]}"up"===i.type&&(n=[]),e.onDraw(JSON.parse(JSON.stringify(i)))}},d=function(){var e=function(){},t=!1;this.chainIn=function(n){return"down"===n.type&&(t?e({type:"up",scale:n.scale,shiftIsPressed:n.shiftIsPressed,isCoalesced:!1}):t=!0),t||"move"!==n.type&&"up"!==n.type?("up"===n.type&&t&&(t=!1),n):null},this.setChainOut=function(t){e=t},this.getIsDrawing=function(){return t}},p=function(e){var t,n,r,a=function(){},o=(0,i.clamp)(e.smoothing,0,1);this.chainIn=function(e){if(e=JSON.parse(JSON.stringify(e)),clearTimeout(r),clearInterval(n),"down"===e.type&&(t={x:e.x,y:e.y,pressure:e.pressure}),"move"===e.type){var s=e.x,l=e.y,c=e.pressure;e.x=(0,i.mix)(e.x,t.x,o),e.y=(0,i.mix)(e.y,t.y,o),e.pressure=(0,i.mix)(e.pressure,t.pressure,o),t={x:e.x,y:e.y,pressure:e.pressure},o>0&&(r=setTimeout((function(){n=setInterval((function(){(e=JSON.parse(JSON.stringify(e))).x=(0,i.mix)(s,t.x,o),e.y=(0,i.mix)(l,t.y,o),e.pressure=(0,i.mix)(c,t.pressure,o),t={x:e.x,y:e.y,pressure:e.pressure},a(e)}),35)}),80))}return e},this.setChainOut=function(e){a=e},this.setSmoothing=function(e){o=(0,i.clamp)(e,0,1)}}})),r.register("eIcQa",(function(e,n){t(e.exports,"copyCanvas",(function(){return a})),t(e.exports,"testShouldPixelate",(function(){return o})),t(e.exports,"drawTransformedImageWithBounds",(function(){return s})),t(e.exports,"drawTransformedImageOnCanvas",(function(){return l})),t(e.exports,"createCheckerCanvas",(function(){return u})),t(e.exports,"createCheckerDataUrl",(function(){return h})),t(e.exports,"resizeCanvas",(function(){return d})),t(e.exports,"convertToAlphaChannelCanvas",(function(){return p})),t(e.exports,"freeCanvas",(function(){return g}));var i=r("eelgW");function a(e){var t=(0,i.createCanvas)(e.width,e.height),n=t.getContext("2d");if(!n)throw new Error("2d context not supported or canvas already initialized");return n.drawImage(e,0,0),t}function o(e,t,n){if(![1,-1].includes(t)||![1,-1].includes(n)||e.width%1!=0||e.height%1!=0||Math.abs(e.angleDeg)%90!=0)return!1;var r=Math.abs(e.angleDeg-90)%180==0,i=r?e.height:e.width,a=r?e.width:e.height;return(Math.abs(i)%2==0&&e.x%1==0||Math.abs(i)%2==1&&e.x%1==.5)&&(Math.abs(a)%2==0&&e.y%1==0||Math.abs(a)%2==1&&e.y%1==.5)}function s(e,t,n,r,i){r||(r={x:0,y:0,width:t.width,height:t.height}),e.save(),i?e.imageSmoothingEnabled=!1:(e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high"),e.translate(n.x,n.y),e.rotate(n.angleDeg/180*Math.PI),e.scale(n.width>0?1:-1,n.height>0?1:-1),e.drawImage(t,r.x,r.y,r.width,r.height,-Math.abs(n.width)/2,-Math.abs(n.height)/2,Math.abs(n.width),Math.abs(n.height)),e.restore()}function l(e,t,n){(n=JSON.parse(JSON.stringify(n))).center||(n.center={x:t.width/2,y:t.height/2}),n.scale||(n.scale={x:1,y:1}),n.angleDegree||(n.angleDegree=0),n.translate||(n.translate={x:0,y:0});var r=e.getContext("2d");if(!r)throw new Error("2d context not supported or canvas already initialized");r.save(),Math.abs(n.scale.x-1)>1e-6||Math.abs(n.scale.y-1)>1e-6||Math.abs(n.angleDegree%90)>1e-6?(r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high"):r.imageSmoothingEnabled=!1,r.translate(n.translate.x,n.translate.y),r.translate(n.center.x,n.center.y),r.rotate(n.angleDegree/180*Math.PI),r.scale(n.scale.x,n.scale.y),r.translate(-n.center.x,-n.center.y),r.drawImage(t,0,0,t.width,t.height),r.restore()}var c,u=function(e){var t,n=(0,i.createCanvas)();if(e<1){if(n.width=1,n.height=1,!(t=n.getContext("2d")))throw new Error("2d context not supported or canvas already initialized");t.fillStyle="rgb(128, 128, 128)",t.fillRect(0,0,1,1)}else if(e>200)n.width=401,n.height=401;else{if(n.width=2*e,n.height=2*e,!(t=n.getContext("2d")))throw new Error("2d context not supported or canvas already initialized");t.fillStyle="rgb(255, 255, 255)",t.fillRect(0,0,2*e,2*e),t.fillStyle="rgb(200, 200, 200)",t.fillRect(0,0,e,e),t.fillRect(e,e,2*e,2*e)}return n},h=(c={8:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC",4:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC"},function(e,t){var n=function(e){if(e=parseInt(""+e),c[""+e])return c[""+e];var t=u(e).toDataURL("image/png");return c[""+e]=t,t};if(!t)return n(e);setTimeout((function(){t(n(e))}),1)});function d(e,t,n,r,a){var o,s,l,c,u;if(t&&n&&(t!==e.width||n!==e.height))if(t=Math.max(t,1),n=Math.max(n,1),t<=e.width&&n<=e.height){r=r||(0,i.createCanvas)(),a=a||(0,i.createCanvas)();var h,p,g=(o=e.width,s=e.height,l=t,c=n,(u={oldWidthEx:Math.round(Math.log2(o)),oldHeightEx:Math.round(Math.log2(s)),newWidthEx:Math.ceil(Math.log2(l)),newHeightEx:Math.ceil(Math.log2(c))}).oldWidthEx=Math.max(u.oldWidthEx,u.newWidthEx),u.oldHeightEx=Math.max(u.oldHeightEx,u.newHeightEx),u);a.width=g.oldWidthEx>g.newWidthEx?Math.pow(2,g.oldWidthEx):t,a.height=g.oldHeightEx>g.newHeightEx?Math.pow(2,g.oldHeightEx):n,r.getContext("2d").save(),a.getContext("2d").save();var f=r,m=a;h=g.oldWidthEx,p=g.oldHeightEx;var v=m.getContext("2d");v.imageSmoothingEnabled=!0,v.imageSmoothingQuality="high",v.globalCompositeOperation="copy",v.drawImage(e,0,0,m.width,m.height);for(var y=m.width,x=m.height;h>g.newWidthEx||p>g.newHeightEx;h--,p--){(v=f.getContext("2d")).imageSmoothingEnabled=!0,v.imageSmoothingQuality="high",v.globalCompositeOperation="copy";var b=h>g.newWidthEx?y/2:y,B=p>g.newHeightEx?x/2:x;f.width=b,f.height=B,v.drawImage(m,0,0,y,x,0,0,b,B),y=b,x=B;var w=f;f=m,m=w}e.width=t,e.height=n;var C=e.getContext("2d");C.save(),C.imageSmoothingEnabled=!0,C.imageSmoothingQuality="high",C.drawImage(m,0,0,y,x,0,0,t,n),C.restore(),r.getContext("2d").restore(),a.getContext("2d").restore()}else if(t>=e.width&&n>=e.height){(r=r||(0,i.createCanvas)()).width=t,r.height=n;var S=r.getContext("2d");S.save(),S.imageSmoothingEnabled=!0,S.imageSmoothingQuality="high",S.drawImage(e,0,0,t,n),S.restore(),e.width=t,e.height=n,e.getContext("2d").drawImage(r,0,0)}else d(e,t,e.height,r,a),d(e,t,n,r,a)}function p(e){for(var t=e.getContext("2d").getImageData(0,0,e.width,e.height),n=0;n<t.data.length;n+=4)0!==t.data[n+3]&&(t.data[n+3]=(t.data[n]+t.data[n+1]+t.data[n+2])/3*(t.data[n+3]/255));e.getContext("2d").putImageData(t,0,0)}function g(e){e.width=1,e.height=1;var t=e.getContext("2d");t&&t.clearRect(0,0,1,1)}})),r.register("kVHNC",(function(e,n){t(e.exports,"Matrix",(function(){return i}));var r,i={getIdentity:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},multiplyMatrixAndPoint:r=function(e,t){return[t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15]]},multiplyMatrices:function(e,t){var n=[t[0],t[1],t[2],t[3]],i=[t[4],t[5],t[6],t[7]],a=[t[8],t[9],t[10],t[11]],o=[t[12],t[13],t[14],t[15]],s=r(e,n),l=r(e,i),c=r(e,a),u=r(e,o);return[s[0],s[1],s[2],s[3],l[0],l[1],l[2],l[3],c[0],c[1],c[2],c[3],u[0],u[1],u[2],u[3]]},createTranslationMatrix:function(e,t){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]},createRotationMatrix:function(e){return[Math.cos(-e),-Math.sin(-e),0,0,Math.sin(-e),Math.cos(-e),0,0,0,0,1,0,0,0,0,1]},createScaleMatrix:function(e){return[e,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]}}})),r.register("4toIY",(function(e,n){t(e.exports,"Vec2",(function(){return r}));var r={add:function(e,t){return{x:e.x+t.x,y:e.y+t.y}},sub:function(e,t){return{x:e.x-t.x,y:e.y-t.y}},nor:function(e){var t=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2));return{x:e.x/t,y:e.y/t}},len:function(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))},dist:function(e,t){return r.len(r.sub(e,t))},mul:function(e,t){return{x:e.x*t,y:e.y*t}},angle:function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},dot:function(e,t){var n=[e.x,e.y],r=[t.x,t.y];return n.map((function(e,t){return n[t]*r[t]})).reduce((function(e,t){return e+t}))}}})),r.register("af1iA",(function(e,n){t(e.exports,"projectPointOnLine",(function(){return o})),t(e.exports,"PointLine",(function(){return s})),t(e.exports,"BezierLine",(function(){return l})),t(e.exports,"SplineInterpolator",(function(){return c})),t(e.exports,"quadraticSplineInput",(function(){return u}));var i=r("4toIY"),a=r("eg83P"),o=function(e,t,n){if(e.x===t.x)return{x:e.x,y:n.y};var r=(t.y-e.y)/(t.x-e.x),i=e.y-r*e.x;return{x:(r*n.y+n.x-r*i)/(r*r+1),y:(r*r*n.y+r*n.x+i)/(r*r+1)}},s=function(e){for(var t=[],n=this,r=0;r<e.points.length;r++)!function(n){var r=void 0;n<e.points.length-1&&(r=(0,a.dist)(e.points[n].x,e.points[n].y,e.points[n+1].x,e.points[n+1].y)),t[n]={x:e.points[n].x,y:e.points[n].y,length:r}}(r);this.getAtDist=function(e){for(var r=Math.min(n.getLength(),e),i=0;r>t[i].length&&i<t.length-2;i++)r-=t[i].length;var a=Math.min(1,Math.max(0,r/t[i].length));return{x:t[i].x*(1-a)+t[i+1].x*a,y:t[i].y*(1-a)+t[i+1].y*a}},this.getLength=function(){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].length;return e}},l=function(){var e,t,n,r=this,o=[],l=0,c=null;this.add=function(r,u,h,d,p){if(!e||r!==e.x||u!==e.y)if(e={x:r,y:u},o[o.length]={x:r,y:u,spacing:h},1!==o.length){if(2===o.length)return o[0].dir=i.Vec2.nor(i.Vec2.sub(o[1],o[0])),l=h,void(c=h);var g=o[o.length-1],f=o[o.length-2],m=o[o.length-3];f.dir=i.Vec2.nor(i.Vec2.sub(g,m)),(isNaN(f.dir.x)||isNaN(f.dir.y))&&(f.dir=JSON.parse(JSON.stringify(m.dir)));var v,y,x=o[o.length-3],b=o[o.length-2],B=x,w=i.Vec2.add(x,i.Vec2.mul(x.dir,i.Vec2.dist(x,b)/4)),C=i.Vec2.sub(b,i.Vec2.mul(b.dir,i.Vec2.dist(x,b)/4)),S=b;if(d)y=function(e,t,n,r,i){for(var a,o,s=[],l=0;l<=i;l++)a=l/i,(o={}).x=Math.pow(1-a,3)*e.x+3*Math.pow(1-a,2)*a*t.x+3*(1-a)*Math.pow(a,2)*n.x+Math.pow(a,3)*r.x,o.y=Math.pow(1-a,3)*e.y+3*Math.pow(1-a,2)*a*t.y+3*(1-a)*Math.pow(a,2)*n.y+Math.pow(a,3)*r.y,s[s.length]=o;return s}(B,w,C,S,20),v=new s({points:y});else v=new s({points:[B,S]});for(var k=v.getLength(),L=(0,a.mix)(c,h,(0,a.clamp)(l/k,0,1)),T=l;T<=k;T+=L){L=(0,a.mix)(c,h,(0,a.clamp)(T/k,0,1));var E=v.getAtDist(T),M=t?(0,a.pointsToAngleDeg)(t,E):void 0;d&&d({x:E.x,y:E.y,t:T/k,angle:M,dAngle:t?M-n:0}),t=E,n=M}d?l=T-k:(l=0,p({p1:B,p2:w,p3:C,p4:S})),c=h}else c=h},this.addFinal=function(e,t,n){if(!(o.length<2)){var a=o[o.length-2],s=o[o.length-1],l=i.Vec2.add(s,i.Vec2.sub(s,a));r.add(l.x,l.y,e,t,n)}}},c=function(e){var t,n=e.length;this.xa=[],this.ya=[],this.u=[],this.y2=[];var r=e[0][0],i=e[e.length-1][0];for(e.sort((function(e,t){return e[0]-t[0]})),t=0;t<n;t++)this.xa.push(e[t][0]),this.ya.push(e[t][1]);for(this.u[0]=0,this.y2[0]=0,t=1;t<n-1;++t){var a=this.xa[t+1]-this.xa[t-1],o=(this.xa[t]-this.xa[t-1])/a,s=o*this.y2[t-1]+2;this.y2[t]=(o-1)/s;var l=(this.ya[t+1]-this.ya[t])/(this.xa[t+1]-this.xa[t])-(this.ya[t]-this.ya[t-1])/(this.xa[t]-this.xa[t-1]);this.u[t]=(6*l/a-o*this.u[t-1])/s}for(this.y2[n-1]=0,t=n-2;t>=0;--t)this.y2[t]=this.y2[t]*this.y2[t+1]+this.u[t];this.getFirstX=function(){return r},this.getLastX=function(){return i}};c.prototype.interpolate=function(e){for(var t=0,n=this.ya.length-1;n-t>1;){var r=n+t>>1;this.xa[r]>e?n=r:t=r}var i=this.xa[n]-this.xa[t],a=(this.xa[n]-e)/i,o=(e-this.xa[t])/i;return a*this.ya[t]+o*this.ya[n]+((a*a*a-a)*this.y2[t]+(o*o*o-o)*this.y2[n])*(i*i)/6},c.prototype.findX=function(e,t){for(var n=null,r=null,i=0;i<=t;i++){var a=i/t,o=this.interpolate(a);if(null!==n){var s=Math.abs(o-e);if(!(s<r))break;n=a,r=s}else n=a,r=Math.abs(o-e)}return n};var u=function(e,t,n){for(var r=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},i=[],a=0;a<=1;a+=n)i.push([r(a,4),r(e+Math.pow(a,2)*(t-e),4)]);return i}})),r.register("dJ1E2",(function(e,n){t(e.exports,"HSV",(function(){return a})),t(e.exports,"RGB",(function(){return o})),t(e.exports,"CMYK",(function(){return s})),t(e.exports,"ColorConverter",(function(){return l})),t(e.exports,"testIsWhiteBestContrast",(function(){return c}));var i=r("gFgFC"),a=function e(t,n,r){"use strict";(0,i.default)(this,e),this.h=Math.max(0,Math.min(360,t)),this.s=Math.max(.001,Math.min(100,n)),this.v=Math.max(0,Math.min(100,r))},o=function e(t,n,r){"use strict";(0,i.default)(this,e),this.r=Math.max(0,Math.min(255,t)),this.g=Math.max(0,Math.min(255,n)),this.b=Math.max(0,Math.min(255,r))},s=function e(t,n,r,a){"use strict";(0,i.default)(this,e),this.c=Math.max(0,Math.min(100,t)),this.m=Math.max(0,Math.min(100,n)),this.y=Math.max(0,Math.min(100,r)),this.k=Math.max(0,Math.min(100,a))},l={_RGBtoHSV:function(e){var t=new a(0,0,0),n=e.r/255,r=e.g/255,i=e.b/255,o=Math.min(n,r,i),s=Math.max(n,r,i),l=s-o;if(t.v=s,0==l)t.h=0,t.s=0;else{t.s=l/s;var c=((s-n)/6+l/2)/l,u=((s-r)/6+l/2)/l,h=((s-i)/6+l/2)/l;n==s?t.h=h-u:r==s?t.h=1/3+c-h:i==s&&(t.h=2/3+u-c),t.h<0&&(t.h+=1),t.h>1&&(t.h-=1)}return t.h=Math.round(360*t.h),t.s=Math.round(100*t.s),t.v=Math.round(100*t.v),t},_HSVtoRGB:function(e){var t,n,r,i,a,s,l,c,u=new o(0,0,0),h=e.h/360%1,d=e.s/100,p=e.v/100;return 0==d?(u.r=255*p,u.g=255*p,u.b=255*p):(r=p*(1-d),i=p*(1-d*((t=6*h)-(n=Math.floor(t)))),a=p*(1-d*(1-(t-n))),0==n?(s=p,l=a,c=r):1==n?(s=i,l=p,c=r):2==n?(s=r,l=p,c=a):3==n?(s=r,l=i,c=p):4==n?(s=a,l=r,c=p):(s=p,l=r,c=i),u.r=255*s,u.g=255*l,u.b=255*c,u.r=Math.round(u.r),u.g=Math.round(u.g),u.b=Math.round(u.b)),u},_CMYKtoRGB:function(e){var t=new o(0,0,0),n=e.c/100,r=e.m/100,i=e.y/100,a=e.k/100;return t.r=1-Math.min(1,n*(1-a)+a),t.g=1-Math.min(1,r*(1-a)+a),t.b=1-Math.min(1,i*(1-a)+a),t.r=Math.round(255*t.r),t.g=Math.round(255*t.g),t.b=Math.round(255*t.b),t},_RGBtoCMYK:function(e){var t=new s(0,0,0,0),n=e.r/255,r=e.g/255,i=e.b/255;return t.k=Math.min(1-n,1-r,1-i),t.c=(1-n-t.k)/(1-t.k),t.m=(1-r-t.k)/(1-t.k),t.y=(1-i-t.k)/(1-t.k),t.c=Math.round(100*t.c),t.m=Math.round(100*t.m),t.y=Math.round(100*t.y),t.k=Math.round(100*t.k),t},toRGB:function(e){return e instanceof o?e:e instanceof a?this._HSVtoRGB(e):e instanceof s?this._CMYKtoRGB(e):void 0},toHSV:function(e){return e instanceof a?e:e instanceof o?this._RGBtoHSV(e):e instanceof s?this._RGBtoHSV(this._CMYKtoRGB(e)):void 0},toCMYK:function(e){return e instanceof s?e:e instanceof o?this._RGBtoCMYK(e):e instanceof a?this._RGBtoCMYK(this._HSVtoRGB(e)):void 0},toHexString:function(e){if(e instanceof o||"r"in e&&"g"in e&&"b"in e){var t=parseInt(""+e.r).toString(16),n=parseInt(""+e.g).toString(16),r=parseInt(""+e.b).toString(16);return 1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),1==r.length&&(r="0"+r),t+n+r}},toRgbStr:function(e){return"rgb("+Math.round(e.r)+", "+Math.round(e.g)+", "+Math.round(e.b)+")"},toRgbaStr:function(e){return"rgba("+Math.round(e.r)+", "+Math.round(e.g)+", "+Math.round(e.b)+", "+e.a+")"},hexToRGB:function(e){e=(e=e.trim()).replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,r){return t+t+n+n+r+r}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?new o(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)):null}};function c(e){return.299*e.r+.587*e.g+.114*e.b<125}})),r.register("72Jv0",(function(e,n){t(e.exports,"appendTextDiv",(function(){return s})),t(e.exports,"isInputFocused",(function(){return l})),t(e.exports,"unfocusAnyInput",(function(){return c})),t(e.exports,"clearSelection",(function(){return u})),t(e.exports,"makeUnfocusable",(function(){return d})),t(e.exports,"el",(function(){return g})),t(e.exports,"destroyEl",(function(){return f}));var i=r("h4olN"),a=r("7jh4K"),o=r("eWjiX");function s(e,t){var n=document.createElement("div");return n.innerHTML=t,e.appendChild(n),n}function l(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.tagName);return e?t:t&&!document.activeElement.getAttribute("data-ignore-focus")}function c(){if(l(!0)){var e=o.BB.el({parent:document.body,tagName:"input",css:{opacity:"0",width:"0",height:"0"}});setTimeout((function(){e.select(),e.focus(),e.parentNode.removeChild(e)}),10)}}function u(){if(window.getSelection){var e=window.getSelection();e&&(e.empty?e.empty():e.removeAllRanges&&e.removeAllRanges())}else"selection"in document&&document.selection.empty()}var h,d=(h=function(e){e.preventDefault();var t=!1;if(e.relatedTarget)try{e.relatedTarget.focus(),t=!0}catch(e){console.error("failed to focus")}t||e.currentTarget.blur()},function(e){e.setAttribute("tabindex","-1"),(0,i.addEventListener)(e,"focus",h)}),p=[];function g(e){var t=document.createElement(e.tagName?e.tagName:"div");e.css&&(0,a.css)(t,e.css),e.content&&("string"==typeof e.content?t.innerHTML=e.content:Array.isArray(e.content)?o.BB.append(t,e.content):t.appendChild(e.content)),e.textContent&&(t.textContent=e.textContent),e.className&&(t.className=e.className),e.id&&(t.id=e.id),e.parent&&e.parent.appendChild(t),"title"in e&&void 0!==e.title&&(t.title=e.title);var n=[];if("onClick"in e&&((0,i.addEventListener)(t,"click",e.onClick),n.push(["click",e.onClick])),"onChange"in e&&((0,i.addEventListener)(t,"change",e.onChange),n.push(["change",e.onChange])),n.length>0&&p.push({el:t,listeners:n}),"custom"in e)for(var r=Object.keys(e.custom),s=0;s<r.length;s++)t.setAttribute(r[s],e.custom[r[s]]);return t}function f(e){for(var t=0;t<p.length;t++){var n=p[t];if(n.el===e)return n.listeners.forEach((function(t){e.removeEventListener(t[0],t[1])})),void p.splice(t,1)}}})),r.register("i0uIf",(function(e,n){t(e.exports,"BbLog",(function(){return s}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("7U0Ew"),s=function(){"use strict";function e(){(0,i.default)(this,e)}return(0,a.default)(e,null,[{key:"subscribe",value:function(t){e.listeners.includes(t)||e.listeners.push(t)}},{key:"unsubscribe",value:function(t){for(var n=0;n<e.listeners.length;n++)if(t===e.listeners[n])return void e.listeners.splice(n,1)}},{key:"emit",value:function(t){e.listeners.forEach((function(e){e(t)}))}}]),e}();(0,o.default)(s,"listeners",[])})),r.register("6l0gQ",(function(e,n){t(e.exports,"LocalStorage",(function(){return o}));var i=r("gFgFC"),a=r("kiQ5H"),o=function(){"use strict";function e(){(0,i.default)(this,e)}return(0,a.default)(e,null,[{key:"getItem",value:function(e){var t=null;try{t=localStorage.getItem(e)}catch(e){this.error=e}return t}},{key:"setItem",value:function(e,t){try{localStorage.setItem(e,t)}catch(e){this.error=e}}},{key:"removeItem",value:function(e){try{localStorage.removeItem(e)}catch(e){this.error=e}}},{key:"getError",value:function(){return this.error}}]),e}()})),r.register("c0kqC",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("l7FYj")})),r.register("fh18w",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("kbyFQ")})),r.register("lXqiv",(function(e,n){t(e.exports,"Checkbox",(function(){return s}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("eWjiX"),s=function(){"use strict";function e(t){var n=this;(0,i.default)(this,e),this.doHighlight=t.doHighlight,this.element=o.BB.el({className:"kl-checkbox"});var r=o.BB.el({parent:this.element,tagName:"label",className:"kl-checkbox__inner"});this.check=o.BB.el({parent:r,tagName:"input",css:{marginLeft:"0",display:"inline-block"},custom:{type:"checkbox"}}),this.check.checked=t.init,this.doHighlight&&this.check.checked&&this.element.classList.add("kl-checkbox--highlight"),t.allowTab||(this.check.tabIndex=-1),t.title&&(r.title=t.title);var a=document.createElement("div");a.style.display="inline-block",a.innerHTML=t.label,a.allowClick=!0,r.appendChild(a),this.check.onchange=function(){n.doHighlight&&n.element.classList.toggle("kl-checkbox--highlight",n.check.checked),t.callback(n.check.checked),setTimeout((function(){n.check.blur()}),0)},t.css&&o.BB.css(this.element,t.css)}return(0,a.default)(e,[{key:"getValue",value:function(){return this.check.checked}},{key:"setValue",value:function(e){this.check.checked=!!e,this.doHighlight&&this.element.classList.toggle("kl-checkbox--highlight",this.check.checked)}},{key:"getElement",value:function(){return this.element}},{key:"destroy",value:function(){this.check.onchange=null}}]),e}()})),r.register("c4LUw",(function(e,n){t(e.exports,"input",(function(){return a}));var i=r("eWjiX"),a=function(e){var t=document.createElement("input");if(e.type)try{t.type=e.type}catch(e){}else t.type="text";return void 0!==e.min&&(t.min=""+e.min),void 0!==e.max&&(t.max=""+e.max),t.value=""+e.init,e.callback&&(t.onchange=function(){e.callback(t.value)}),e.css&&i.BB.css(t,e.css),t}})),r.register("21VAD",(function(e,n){t(e.exports,"Select",(function(){return l}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("7U0Ew"),s=r("eWjiX"),l=function(){"use strict";function e(t){var n=this;(0,i.default)(this,e),(0,o.default)(this,"destroy",(function(){n.selectEl.removeEventListener("change",n.changeListener)})),this.selectEl=s.BB.el({tagName:"select",title:t.title,css:{cursor:"pointer",fontSize:"15px",padding:"3px",background:"#fff",colorScheme:"only light"}}),t.css&&s.BB.css(this.selectEl,t.css);var r=t.isFocusable;r||(this.selectEl.tabIndex=-1),this.optionArr=t.optionArr;for(var a=0;a<this.optionArr.length;a++)if(null!==this.optionArr[a]){var l=document.createElement("option");l.value=this.optionArr[a][0],l.textContent=this.optionArr[a][1],this.selectEl.append(l)}this.onChange=t.onChange,this.changeListener=function(e){r||n.selectEl.blur(),n.onChange(n.selectEl.value)},this.selectEl.addEventListener("change",this.changeListener),this.selectEl.value="initValue"in t?t.initValue:null}return(0,a.default)(e,[{key:"setValue",value:function(e){this.selectEl.value=e}},{key:"getValue",value:function(){return this.selectEl.value}},{key:"setDeltaValue",value:function(e){for(var t=0,n=0;n<this.optionArr.length;n++)if(""+this.optionArr[n][0]===this.selectEl.value){t=n;break}t=Math.max(0,Math.min(this.optionArr.length-1,t+e)),this.selectEl.value=this.optionArr[t][0],this.onChange(this.selectEl.value)}},{key:"getElement",value:function(){return this.selectEl}}]),e}()})),r.register("jKOQl",(function(e,n){t(e.exports,"ImageToggle",(function(){return a}));var i=r("eWjiX"),a=function(e){var t=function(){r.classList.toggle("image-toggle-active",n)},n=!!e.initValue,r=i.BB.el({className:"image-toggle",title:e.title,css:{backgroundImage:"url('"+e.image+"')"},onClick:function(r){r.preventDefault(),e.isRadio&&n||(n=!n,t(),e.onChange(n))}});t(),this.setValue=function(e){n=!!e,t()},this.getElement=function(){return r},this.getValue=function(){return n},this.destroy=function(){i.BB.destroyEl(r)}}})),r.register("gmlbk",(function(e,n){t(e.exports,"ImageRadioList",(function(){return o}));var i=r("eWjiX"),a=r("jKOQl"),o=function(e){for(var t,n=function(n,i){i.id===e.initId&&(t=n);var s=new(0,a.ImageToggle)({image:i.image,title:i.title,initValue:i.id===e.initId,isRadio:!0,onChange:function(){!function(n,r){t=n;for(var i=0;i<o.length;i++)o[i].setValue(i===t);e.onChange(r)}(n,i.id)}});return r.appendChild(s.getElement()),s},r=i.BB.el({className:"image-radio-wrapper",css:{display:"flex"}}),o=[],s=0;s<e.optionArr.length;s++)o.push(n(s,e.optionArr[s]));this.getElement=function(){return r},this.getValue=function(){return e.optionArr[t].id},this.destroy=function(){o.forEach((function(e){e.destroy()}))}}})),r.register("fCJWy",(function(n,i){t(n.exports,"penPressureToggle",(function(){return l}));var a=r("eWjiX"),o=r("e1Rnq"),s=r("1mH1z"),l=function(t,n){var r=function(){t?a.BB.css(i,{backgroundColor:"#fff",opacity:"0.9",border:"1px solid var(--active-highlight-color)"}):a.BB.css(i,{backgroundColor:"transparent",opacity:"0.5",border:"1px solid #666"})},i=a.BB.el({css:{cssFloat:"right",borderRadius:"3px",width:"18px",height:"18px",backgroundImage:'url("'+e(o)+'")',backgroundSize:"contain",backgroundRepeat:"no-repeat",cursor:"pointer",boxSizing:"border-box",colorScheme:"only light"}});return a.BB.hasPointerEvents||(i.style.display="none"),i.title=(0,s.LANG)("brush-toggle-pressure"),i.onclick=function(){t=!t,r(),n(t)},r(),n(t),i}})),r.register("e1Rnq",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("5H9IS")})),r.register("llzZ0",(function(e,n){t(e.exports,"KlSlider",(function(){return d}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("7U0Ew"),s=r("eWjiX"),l=r("l4PqG"),c=r("1mH1z"),u=r("exufe"),h=r("348ou"),d=function(){"use strict";function e(t){var n=this;(0,i.default)(this,e),(0,o.default)(this,"emitValue",null);if(this.isEnabled=!1!==t.isEnabled,this.manualInputRoundDigits=t.manualInputRoundDigits,this.useSpline=!!t.curve,!t.label)throw new Error("KlSlider missing params");if(!(0==t.min||0==t.max||0==t.value||t.min&&t.max&&t.value))throw new Error("KlSlider broken params");if(t.min>=t.max)throw new Error("KlSlider broken params");if(this.min=t.min,this.max=t.max,this.value=s.BB.clamp(t.value,this.min,this.max),this.elementWidth=t.width,this.elementHeight=t.height,this.resolution=t.resolution?t.resolution:2*this.elementWidth,this.onChange=t.onChange?t.onChange:function(){},!this.displayValueToValue!=!this.valueToDisplayValue)throw new Error("both or neither have to be set, toValue and toDisplayValue");if(this.displayValueToValue=t.toValue?t.toValue:function(e){return e},this.valueToDisplayValue=t.toDisplayValue?t.toDisplayValue:function(e){return e},this.isChangeOnFinal=!!t.isChangeOnFinal,this.formatFunc=t.formatFunc,this.eventResMs=t.eventResMs,this.useSpline){var r="quadratic"===t.curve?s.BB.quadraticSplineInput(this.min,this.max,.1):t.curve;this.splineInterpolator=new s.BB.SplineInterpolator(r)}this.roolEl=s.BB.el({css:{display:"flex"}}),this.sliderWrapperEl=s.BB.el({parent:this.roolEl,className:"sliderWrapper",css:{overflow:"hidden",position:"relative",width:this.elementWidth+"px",height:this.elementHeight+"px",userSelect:"none"}}),this.roolEl.oncontextmenu=function(){return!1},this.label=t.label;var a=this.elementHeight-14;this.textEl=s.BB.el({content:this.label,css:{position:"absolute",left:"7px",top:this.elementHeight/2-a/2+1+"px",lineHeight:a+"px",fontSize:a+"px",pointerEvents:"none"}}),this.control=s.BB.el({className:"sliderInner",css:{position:"absolute",left:"0",top:"0",width:this.valueToSliderValue(this.value)*this.elementWidth+"px",height:this.elementHeight+"px"}});var c=document.createElement("div");this.sliderWrapperEl.append(this.control,this.textEl),this.control.append(c),this.updateEnable();var h=new(0,u.DoubleTapper)({onDoubleTap:function(){n.showManualInput()}});h.setAllowedButtonArr(["left","right"]);var d,p=new(0,u.EventChain)({chainArr:[h]});this.pointerListenerTimeout=setTimeout((function(){n.pointerListener=new s.BB.PointerListener({target:n.sliderWrapperEl,maxPointers:1,fixScribble:!0,onPointer:function(e){!function(e){if(e.eventPreventDefault(),n.isEnabled){if("pointerdown"===e.type){if(s.BB.unfocusAnyInput(),n.sliderWrapperEl.className="sliderWrapper sliderWrapperActive","left"===e.button){var t=e.relX/n.elementWidth;t=Math.max(0,Math.min(1,t)),n.value=n.sliderValuetoValue(t),n.updateLabel(),n.emit(!1)}d=n.valueToSliderValue(n.value)}if("pointermove"===e.type&&["left","right"].includes(e.button)){var r=e.dX,i=Math.abs(e.pageY-e.downPageY);r*=(0,l.calcSliderFalloffFactor)(i,"right"===e.button),r/=n.elementWidth,d+=r;var a=Math.max(0,Math.min(1,d));n.value=n.sliderValuetoValue(a),n.updateLabel(),n.emit(!1)}"pointerup"===e.type&&(n.sliderWrapperEl.className="sliderWrapper",n.emit(!0))}}(e),p.chainIn(e)},onWheel:function(e){var t=n.valueToSliderValue(n.value);t=s.BB.clamp(t-e.deltaY/40,0,1),n.value=n.sliderValuetoValue(t),n.updateLabel(),n.onChange(n.value)}}),n.updateLabel()}),1)}return(0,a.default)(e,[{key:"valueToSliderValue",value:function(e){return this.useSpline?this.splineInterpolator.findX(e,Math.floor(this.resolution)):(e-this.min)/(this.max-this.min)}},{key:"sliderValuetoValue",value:function(e){var t=this.min+e*(this.max-this.min);return this.useSpline&&(t=this.splineInterpolator.interpolate(e)),t}},{key:"updateLabel",value:function(){var e=this.valueToDisplayValue(this.value);e=(e=this.formatFunc?this.formatFunc(e):Math.round(e)).toLocaleString(c.languageStrings.getCode()),this.textEl.innerHTML=this.label+'&nbsp;&nbsp;<span style="font-weight:bold">'+e+"</span>";var t=this.valueToSliderValue(this.value);this.control.style.width=t*this.elementWidth+"px"}},{key:"emit",value:function(e){var t=this;if(e||!this.isChangeOnFinal)return e||!this.eventResMs?(this.onChange(this.value),void(this.emitInterval&&(clearInterval(this.emitInterval),this.emitInterval=null))):void(this.emitInterval?this.emitValue=this.value:(this.onChange(this.value),this.emitInterval=setInterval((function(){null===t.emitValue?(clearInterval(t.emitInterval),t.emitInterval=null):(t.onChange(t.emitValue),t.emitValue=null)}),this.eventResMs)))}},{key:"updateEnable",value:function(){s.BB.css(this.sliderWrapperEl,{opacity:this.isEnabled?null:"0.5",pointerEvents:this.isEnabled?null:"none"}),this.manualInput&&this.manualInput.setIsEnabled(this.isEnabled)}},{key:"showManualInput",value:function(){var e=this;this.manualInput=new(0,h.KlSliderManualInput)(this.valueToDisplayValue(this.value),this.valueToDisplayValue(this.min),this.valueToDisplayValue(this.max),this.sliderWrapperEl.getBoundingClientRect(),(function(t){t=e.displayValueToValue(t),e.setValue(s.BB.clamp(t,e.min,e.max)),e.onChange(e.value)}),(function(){s.BB.css(e.sliderWrapperEl,{display:null}),e.roolEl.removeChild(e.manualInput.getElement()),e.manualInput.destroy(),e.manualInput=null}),this.manualInputRoundDigits&&this.manualInputRoundDigits>0?this.manualInputRoundDigits:0),this.roolEl.append(this.manualInput.getElement()),setTimeout((function(){e.manualInput.focus()})),s.BB.css(this.sliderWrapperEl,{display:"none"})}},{key:"changeSliderValue",value:function(e){if(this.isEnabled){var t=this.valueToSliderValue(this.value);t=s.BB.clamp(t+e,0,1),this.value=this.sliderValuetoValue(t),this.updateLabel(),this.onChange(this.value)}}},{key:"setValue",value:function(e){this.value=s.BB.clamp(e,this.min,this.max),this.updateLabel()}},{key:"getValue",value:function(){return this.value}},{key:"update",value:function(e){if(this.min=e.min,this.max=e.max,this.useSpline=!!e.curve,this.useSpline){var t="quadratic"===e.curve?s.BB.quadraticSplineInput(this.min,this.max,.1):e.curve;this.splineInterpolator=new s.BB.SplineInterpolator(t)}else this.splineInterpolator=null;this.setIsEnabled(!e.isDisabled)}},{key:"setIsEnabled",value:function(e){this.isEnabled=!!e,this.updateEnable()}},{key:"destroy",value:function(){clearTimeout(this.pointerListenerTimeout),this.pointerListener&&this.pointerListener.destroy(),this.manualInput&&this.manualInput.destroy(),this.emitInterval&&clearInterval(this.emitInterval)}},{key:"getElement",value:function(){return this.roolEl}}]),e}()})),r.register("l4PqG",(function(e,n){t(e.exports,"calcSliderFalloffFactor",(function(){return r}));var r=function(e,t){var n=Math.min(10,1+Math.pow(Math.floor(e/50),2));return t&&(n*=2),1/n}})),r.register("348ou",(function(e,n){t(e.exports,"KlSliderManualInput",(function(){return l}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("eWjiX"),s=r("c4LUw"),l=function(){"use strict";function e(t,n,r,a,l,c,u){var h,d=this;(0,i.default)(this,e),this.onChange=l,this.onClose=c,this.isClosed=!1,this.input=(0,s.input)({type:"number",init:t,min:n,max:r,callback:function(e){d.emit()}}),0!==u&&this.input.setAttribute("step","any"),this.input.onblur=function(){d.privateOnClose()},this.input.addEventListener("keyup",(function(e){["Enter","Escape"].includes(e.key)?d.privateOnClose():d.emit()})),this.input.addEventListener("wheel",(function(){return d.emit()})),this.scrollBefore={x:window.scrollX,y:window.scrollY},h=u||0===u?o.BB.round(t,u):t,this.lastValue=h,this.input.value=""+h,o.BB.css(this.input,{width:a.width+"px",height:a.height+"px"})}return(0,a.default)(e,[{key:"emit",value:function(){this.lastValue!==Number(this.input.value)&&(this.onChange(Number(this.input.value)),this.lastValue=Number(this.input.value))}},{key:"privateOnClose",value:function(){var e=this;this.isClosed||(this.isClosed=!0,this.emit(),this.onClose(),setTimeout((function(){window.scrollTo(e.scrollBefore.x,e.scrollBefore.y),e.scrollBefore=null})))}},{key:"getElement",value:function(){return this.input}},{key:"setIsEnabled",value:function(e){this.isEnabled=!!e}},{key:"focus",value:function(){this.input.focus(),this.input.select()}},{key:"destroy",value:function(){o.BB.destroyEl(this.input)}}]),e}()})),r.register("lfHl9",(function(n,i){t(n.exports,"HexColorDialog",(function(){return u}));var a=r("eWjiX"),o=r("c4LUw"),s=r("ekHRj"),l=r("1mH1z"),c=r("fcsnL"),u=function(t){var n=function(e,t){var n={},s=a.BB.el({css:{display:"flex",alignItems:"center",marginTop:"5px"}}),l=a.BB.el({content:e,css:{width:"60px"}}),c=(0,o.input)({init:r[t],min:0,max:255,type:"number",css:{width:"80px"},callback:function(){""===c.value||parseFloat(c.value)<0||parseFloat(c.value)>255?n.update():(c.value=""+Math.round(parseFloat(c.value)),r[t]=c.value,u.style.background="#"+a.BB.ColorConverter.toHexString(r),p.value="#"+a.BB.ColorConverter.toHexString(r))}});return s.appendChild(l),s.appendChild(c),i.appendChild(s),n.update=function(){c.value=r[t]},n.destroy=function(){c.onchange=null},n},r=new a.BB.RGB(t.color.r,t.color.g,t.color.b),i=a.BB.el({}),u=a.BB.el({css:{width:"20px",height:"20px",marginBottom:"10px",boxShadow:"inset 0 0 0 1px #fff, 0 0 0 1px #000",background:"#"+a.BB.ColorConverter.toHexString(r),colorScheme:"only light"}});i.appendChild(u);var h=a.BB.el({css:{display:"flex",alignItems:"center",marginBottom:"15px"}}),d=a.BB.el({content:(0,l.LANG)("mci-hex"),css:{width:"60px"}}),p=(0,o.input)({init:"#"+a.BB.ColorConverter.toHexString(r),css:{width:"80px"},callback:function(){var e=a.BB.ColorConverter.hexToRGB(p.value);null===e?(e=r,p.value="#"+a.BB.ColorConverter.toHexString(r)):r=e,u.style.background="#"+a.BB.ColorConverter.toHexString(e);for(var t=0;t<f.length;t++)f[t].update()}}),g=a.BB.el({tagName:"button",content:'<img src="'+e(c)+'" height="20"/>',title:(0,l.LANG)("mci-copy"),css:{marginLeft:"10px"},onClick:function(){p.select(),document.execCommand("copy")}});h.appendChild(d),h.appendChild(p),h.appendChild(g),i.appendChild(h),setTimeout((function(){p.focus(),p.select()}),0);var f=[];f.push(n((0,l.LANG)("red"),"r")),f.push(n((0,l.LANG)("green"),"g")),f.push(n((0,l.LANG)("blue"),"b")),(0,s.popup)({target:document.body,message:"<b>".concat((0,l.LANG)("manual-color-input"),"</b>"),div:i,autoFocus:!1,clickOnEnter:"Ok",buttons:["Ok","Cancel"],callback:function(e){a.BB.destroyEl(g),f.forEach((function(e){return e.destroy()})),f.splice(0,f.length),t.onClose("Ok"===e?a.BB.ColorConverter.hexToRGB(p.value):null)}})}})),r.register("fcsnL",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("la7yv")})),r.register("h7i9r",(function(n,i){t(n.exports,"KlColorSlider",(function(){return u}));var a=r("eWjiX"),o=r("lfHl9"),s=r("l4PqG"),l=r("1nsGS"),c=r("1mH1z"),u=function(t){var n=function(e){w=0===e.s?new a.BB.HSV(w.h,e.s,e.v):new a.BB.HSV(e.h,e.s,e.v)},r=function(){var e=a.BB.ColorConverter.toRGB(new a.BB.HSV(w.h,100,100));a.BB.setAttributes(T,{"stop-color":"#"+a.BB.ColorConverter.toHexString(e)})},i=function(){var e=w.s/100*v-7,t=(1-w.v/100)*y-6;a.BB.css(R,{left:e+"px",top:t+"px"})},u=function(){M.style.backgroundColor="rgb("+B.r+","+B.g+","+B.b+")",a.BB.testIsWhiteBestContrast(B)?(a.BB.css(O,{filter:"invert(1)"}),a.BB.css(N,{filter:"invert(1)"})):(a.BB.css(O,{filter:""}),a.BB.css(N,{filter:""}))},h=function(){z.style.backgroundColor=a.BB.ColorConverter.toRgbStr(C)},d=function(){var e=S;S=w,n(e),e=C,C=B,B=e,I.style.left=parseInt(""+(w.h/359*v-1))+"px",r(),i(),u(),h(),b(new a.BB.RGB(B.r,B.g,B.b))},p=this,g=function(e){},f=document.createElement("div");f.style.position="relative",f.className="colorSlider";var m=a.BB.el({css:{display:"flex",alignItems:"center"}}),v=t.width,y=t.svHeight,x=t.height,b=t.onPick,B={r:parseInt(t.startValue.r,10),g:parseInt(t.startValue.g,10),b:parseInt(t.startValue.b,10)},w=a.BB.ColorConverter.toHSV(t.startValue),C={r:255,g:255,b:255},S=a.BB.ColorConverter._RGBtoHSV(C),k=a.BB.el({}),L=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"> <defs> <linearGradient id="value" gradientTransform="rotate(90)"> <stop offset="0" stop-color="rgba(0,0,0,0)"/> <stop offset="100%" stop-color="rgba(0,0,0,1)"/> </linearGradient> <linearGradient id="hue" gradientTransform="rotate(0)"> <stop offset="0" stop-color="#fff"/> <stop id="hue-stop" offset="100%" stop-color="#f00"/> </linearGradient> </defs> <rect x="0" y="0" width="100" height="100" fill="url(\'#hue\')"/> <rect x="0" y="0" width="100" height="100" fill="url(\'#value\')"/></svg>',"image/svg+xml").documentElement,T=L.getElementById("hue-stop");a.BB.setAttributes(T,{"stop-color":"#f0f"}),a.BB.css(L,{width:v+"px",height:y+"px"}),k.appendChild(L);var E=document.createElement("div");a.BB.css(E,{position:"relative",height:x+"px"});var M=document.createElement("div"),I=document.createElement("div");r(),f.style.width=v+"px",f.oncontextmenu=function(){return!1};var A=document.createElement("div");a.BB.css(A,{width:v+"px",height:y+"px",overflow:"hidden",display:"block",position:"relative",cursor:"crosshair",boxShadow:"rgb(188, 188, 188) 0 0 0 1px"});var R=document.createElement("div");a.BB.css(R,{width:"12px",height:"12px",borderRadius:"6px",position:"absolute",pointerEvents:"none",boxShadow:"0px 0px 0 1px #000, inset 0px 0px 0 1px #fff"}),A.appendChild(k),A.appendChild(R),i(),f.appendChild(A),f.appendChild(E),m.appendChild(M),a.BB.css(M,{display:"flex",justifyContent:"space-between",width:2.5*x+"px",height:x+"px",boxShadow:"rgb(188, 188, 188) 0 0 0 1px",colorScheme:"only light"}),a.BB.css(E,{overflow:"hidden",position:"relative",width:v+"px",height:x+"px",cursor:"ew-resize",boxShadow:"rgb(188, 188, 188) 0 0 0 1px",marginTop:"1px",marginBottom:"1px"}),a.BB.css(I,{width:"1px",height:x+"px",background:"#000",borderLeft:"1px solid #fff",position:"absolute",top:"0",left:parseInt(""+(w.h/360*v-1))+"px"});var P={h:0,s:0,v:0},O=a.BB.el({title:(0,c.LANG)("eyedropper")+" [Alt]",className:"color-picker-preview-button",css:{width:"30px",height:"30px",backgroundImage:"url("+e(l)+")",backgroundRepeat:"no-repeat",backgroundSize:"70%",backgroundPosition:"center"}}),D=!1;O.onclick=function(){!1===D?(O.classList.remove("color-picker-preview-button-hover"),O.classList.add("color-picker-preview-button-active"),D=!0,g(!0)):(g(!1),p.pickingDone())};new a.BB.PointerListener({target:O,onEnterLeave:function(e){D||O.classList.toggle("color-picker-preview-button-hover",e)}});M.appendChild(O);var N=a.BB.el({content:"#",className:"color-picker-preview-button",title:(0,c.LANG)("manual-color-input"),css:{height:"100%",width:x+"px",lineHeight:x+"px",fontSize:.65*x+"px"},onClick:function(){(0,o.HexColorDialog)({color:new a.BB.RGB(B.r,B.g,B.b),onClose:function(e){e&&(p.setColor(e),b(new a.BB.RGB(B.r,B.g,B.b)))}})}});new a.BB.PointerListener({target:N,onEnterLeave:function(e){N.classList.toggle("color-picker-preview-button-hover",e)}});M.appendChild(N),u(),setTimeout((function(){!function(e){var t=new Image;a.BB.css(t,{position:"absolute",left:"0",top:"0",display:"none",pointerEvents:"none"});for(var n=a.BB.canvas(v,x),r=n.getContext("2d"),i=r.createLinearGradient(0,0,v,0),o=0;o<1;o+=.01){var s=a.BB.ColorConverter.toRGB(new a.BB.HSV(360*o,100,100)),l=parseInt(""+s.r).toString(16),c=parseInt(""+s.g).toString(16),u=parseInt(""+s.b).toString(16);1===l.length&&(l="0"+l),1===c.length&&(c="0"+c),1===u.length&&(u="0"+u),i.addColorStop(o,"#"+l+c+u)}r.fillStyle=i,r.fillRect(0,0,v,x),e.appendChild(t),t.alt="hue",t.src=n.toDataURL("image/png"),t.style.display="block"}(E),E.appendChild(I),new a.BB.PointerListener({target:k,maxPointers:1,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&(a.BB.unfocusAnyInput(),a.BB.css(A,{boxShadow:"0px 0px 0px 1px rgb(255,255,255)",zIndex:"1"}),"left"===e.button?(P.s=e.relX/v*100,P.v=100-e.relY/y*100,w=new a.BB.HSV(w.h,P.s,P.v),B=a.BB.ColorConverter.toRGB(w),i(),u(),b(a.BB.ColorConverter.toRGB(w))):(P.s=w.s,P.v=w.v)),"pointermove"===e.type&&["left","right"].includes(e.button)){var t=1;"right"===e.button&&(t=.5),P.s+=e.dX/v*100*t,P.v-=e.dY/y*100*t,w=new a.BB.HSV(w.h,P.s,P.v),B=a.BB.ColorConverter.toRGB(w),i(),u(),b(a.BB.ColorConverter.toRGB(w))}"pointerup"===e.type&&a.BB.css(A,{boxShadow:"0 0 0 1px rgb(188, 188, 188)",zIndex:"0"})}}),new a.BB.PointerListener({target:E,maxPointers:1,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&(a.BB.unfocusAnyInput(),a.BB.css(E,{boxShadow:"0px 0px 0px 1px rgba(255,255,255,1)"}),"left"===e.button?(P.h=e.relX/v*359.99,w=new a.BB.HSV(P.h,w.s,w.v),B=a.BB.ColorConverter.toRGB(w),I.style.left=Math.round(w.h/359.99*v)-1+"px",r(),u(),b(a.BB.ColorConverter.toRGB(w))):P.h=w.h),"pointermove"===e.type&&["left","right"].includes(e.button)){var t=Math.abs(e.pageY-e.downPageY),n=(0,s.calcSliderFalloffFactor)(t,"right"===e.button);P.h+=e.dX/v*359.99*n,"right"===e.button&&(P.h=P.h%359.99,P.h<0&&(P.h+=359.99)),P.h=Math.min(359.99,P.h),w=new a.BB.HSV(P.h,w.s,w.v),B=a.BB.ColorConverter.toRGB(w),I.style.left=Math.round(w.h/359.99*v)-1+"px",r(),u(),b(a.BB.ColorConverter.toRGB(w))}"pointerup"===e.type&&a.BB.css(E,{boxShadow:"rgb(188, 188, 188) 0 0 0 1px"})}})}),1);var z=a.BB.el({parent:m,title:(0,c.LANG)("secondary-color")+" [X]",css:{cursor:"pointer",marginLeft:"5px",width:"22px",height:"22px",boxShadow:"rgb(188, 188, 188) 0px 0px 0px 1px",colorScheme:"only light"},onClick:function(e){e.preventDefault(),d()}});h(),this.setColor=function(e){B={r:parseInt(e.r,10),g:parseInt(e.g,10),b:parseInt(e.b,10)},n(a.BB.ColorConverter.toHSV(e)),I.style.left=parseInt(""+(w.h/359*v-1))+"px",r(),i(),u()},this.getColor=function(){return new a.BB.RGB(B.r,B.g,B.b)},this.getSecondaryRGB=function(){return new a.BB.RGB(C.r,C.g,C.b)},this.setPickCallback=function(e){g=e},this.pickingDone=function(){D&&(D=!1,O.classList.remove("color-picker-preview-button-active"))},this.enable=function(e){e?(f.style.pointerEvents="",f.style.opacity="1",m.style.pointerEvents="",m.style.opacity="1"):(f.style.pointerEvents="none",f.style.opacity="0.5",m.style.pointerEvents="none",m.style.opacity="0.5")},this.setHeight=function(e){(e=parseInt(""+(e-2*x-3),10))!==y&&(y=e,a.BB.css(L,{width:v+"px",height:y+"px"}),A.style.height=y+"px",i())},this.swapColors=function(){d()},this.getElement=function(){return f},this.getOutputElement=function(){return m}}})),r.register("1nsGS",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("cTtMO")})),r.register("kzhsD",(function(e,n){t(e.exports,"KlSmallColorSlider",(function(){return o}));var i=r("eWjiX"),a=r("l4PqG"),o=function(e){var t=function(){for(var e=l.getContext("2d"),t=0;t<l.height;t+=1){var n=e.createLinearGradient(0,0,l.width,0),r=i.BB.ColorConverter.toRGB(new i.BB.HSV(s.h,1,100-t/l.height*100)),a=i.BB.ColorConverter.toRGB(new i.BB.HSV(s.h,100,100-t/l.height*100));n.addColorStop(0,"#"+i.BB.ColorConverter.toHexString(r)),n.addColorStop(1,"#"+i.BB.ColorConverter.toHexString(a)),e.fillStyle="#ff0000",e.fillStyle=n,e.fillRect(0,t,l.width,1)}},n=function(){var t=s.s/100*e.width-4,n=(1-s.v/100)*e.heightSV-4;i.BB.css(u,{left:t+"px",top:n+"px"})},r=function(){h.style.left=s.h/359.999*e.width-1+"px"},o=document.createElement("div");o.oncontextmenu=function(e){e.preventDefault()};var s=i.BB.ColorConverter.toHSV(new i.BB.RGB(e.color.r,e.color.g,e.color.b));i.BB.css(o,{width:e.width+"px",position:"relative",overflow:"hidden",userSelect:"none"});var l=i.BB.canvas(10,10);l.style.width=e.width+"px",l.style.height=e.heightSV+"px",l.style.cursor="crosshair",t();var c=i.BB.canvas(e.width,e.heightH);c.style.cursor="ew-resize",function(){for(var t=c.getContext("2d"),n=t.createLinearGradient(0,0,e.width,0),r=0;r<1;r+=.01){var a=i.BB.ColorConverter.toRGB(new i.BB.HSV(360*r,100,100));n.addColorStop(r,"rgba("+parseInt(""+a.r)+", "+parseInt(""+a.g)+", "+parseInt(""+a.b)+", 1)")}t.fillStyle=n,t.fillRect(0,0,e.width,e.heightH)}(),i.BB.css(l,{width:e.width+"px",height:e.heightSV+"px",overflow:"hidden",position:"relative"}),l.style.cssFloat="left",c.style.cssFloat="left",o.appendChild(l),o.appendChild(c);var u=document.createElement("div");i.BB.css(u,{width:"8px",height:"8px",borderRadius:"8px",position:"absolute",pointerEvents:"none",boxShadow:"0 0 0 1px #000, inset 0 0 0 1px #fff"}),o.appendChild(u);var h=document.createElement("div");i.BB.css(h,{width:"0",height:e.heightH+"px",borderLeft:"1px solid #fff",borderRight:"1px solid #000",position:"absolute",top:e.heightSV+"px",pointerEvents:"none"}),o.appendChild(h),n(),r();var d={h:0,s:0,v:0},p=null,g=new i.BB.PointerListener({target:l,maxPointers:1,fixScribble:!0,onPointer:function(t){if("pointerdown"===t.type&&(i.BB.unfocusAnyInput(),p=t.pointerId,"left"===t.button?(d.s=t.relX/e.width*100,d.v=100-t.relY/e.heightSV*100,s=new i.BB.HSV(s.h,d.s,d.v),n(),e.callback(i.BB.ColorConverter.toRGB(s))):(d.s=s.s,d.v=s.v)),"pointermove"===t.type&&["left","right"].includes(t.button)&&p===t.pointerId){var r=1;"right"===t.button&&(r=.5),d.s+=t.dX/e.width*100*r,d.v-=t.dY/e.heightSV*100*r,s=new i.BB.HSV(s.h,d.s,d.v),n(),e.callback(i.BB.ColorConverter.toRGB(s))}"pointerup"===t.type&&(p=null)}}),f=null,m=new i.BB.PointerListener({target:c,maxPointers:1,fixScribble:!0,onPointer:function(n){if("pointerdown"===n.type&&(f=n.pointerId,"left"===n.button?(d.h=n.relX/e.width*359.99,s=new i.BB.HSV(d.h,s.s,s.v),t(),r(),e.callback(i.BB.ColorConverter.toRGB(s))):d.h=s.h),"pointermove"===n.type&&["left","right"].includes(n.button)&&f===n.pointerId){var o=Math.abs(n.pageY-n.downPageY),l=(0,a.calcSliderFalloffFactor)(o,"right"===n.button);d.h+=n.dX/e.width*359.99*l,"right"===n.button&&(d.h=d.h%359.99,d.h<0&&(d.h+=359.99)),d.h=Math.min(359.99,d.h),s=new i.BB.HSV(d.h,s.s,s.v),t(),r(),e.callback(i.BB.ColorConverter.toRGB(s))}"pointerup"===n.type&&(f=null)}}),v=document.createElement("div");v.style.clear="both",o.appendChild(v),this.setColor=function(e){s=i.BB.ColorConverter.toHSV(new i.BB.RGB(e.r,e.g,e.b)),t(),n(),r()},this.getColor=function(){return i.BB.ColorConverter.toRGB(s)},this.getElement=function(){return o},this.destroy=function(){g.destroy(),m.destroy()},this.end=function(){p=null,f=null}}})),r.register("bd9hB",(function(e,n){t(e.exports,"PointSlider",(function(){return a}));var i=r("eWjiX"),a=function(e){var t=function(){s.style.left=a+"px",s.style.boxShadow=l?"0 0 6px rgba(0,0,0,1)":"0 0 3px rgba(0,0,0,0.8)"},n=function(){return a/(e.width-e.pointSize)},r=document.createElement("div");r.style.position="relative";var a,o=i.BB.el({}),s=i.BB.el({css:{colorScheme:"only light"}});r.appendChild(o),r.appendChild(s);var l=!1;i.BB.css(o,{marginTop:parseInt(""+(e.pointSize/2-1))+"px",height:"2px",background:"#aaa",width:e.width+"px"});var c,u,h;i.BB.el({parent:s,css:{margin:"-7px 0 0 -7px",width:"calc(100% + 14px)",height:"calc(100% + 7px)"}});a=i.BB.clamp(e.init*(e.width-e.pointSize),0,e.width-e.pointSize),i.BB.css(s,{position:"absolute",top:"0px",backgroundColor:"#eaeaea",boxShadow:"0 0 3px rgba(0,0,0,0.8)",width:e.pointSize+"px",height:e.pointSize+"px",borderRadius:e.pointSize+"px",cursor:"ew-resize",transition:"box-shadow 0.2s ease-in-out"}),t(),c=new i.BB.PointerListener({target:s,fixScribble:!0,onPointer:function(r){"pointerdown"===r.type&&"left"===r.button?(u=!0,l=!0,h=a,t(),r.eventStopPropagation()):"pointermove"===r.type&&"left"===r.button&&(r.eventStopPropagation(),h+=r.dX,a=parseInt(""+i.BB.clamp(h,0,e.width-e.pointSize)),t(),e.callback(n(),u,!1),u=!1),"pointerup"===r.type&&(r.eventStopPropagation(),l=!1,t(),e.callback(n(),!1,!0))}}),this.getEl=function(){return r},this.setActive=function(e){s.style.backgroundColor=e?"#fff":"#eaeaea"},this.destroy=function(){c.destroy()}}})),r.register("9A7OD",(function(e,n){t(e.exports,"ColorOptions",(function(){return a}));var i=r("eWjiX"),a=function(e){for(var t=function(){for(var e=0;e<o.length;e++)o[e].setIsSelected(e===r)},n=i.BB.el({content:e.label?e.label:"",css:{display:"flex",alignItems:"center",colorScheme:"only light"}}),r=0,a=[],o=[],s=i.BB.createCheckerDataUrl(5),l=0;l<e.colorArr.length;l++){for(var c=e.colorArr[l],u=!1,h=0;h<a.length;h++){var d=a[h];if(null!==d&&null!==c&&(d.r===c.r&&d.g===c.g&&d.b===c.b&&d.a===c.a)){u=!0;break}}u||(a.push(c),"initialIndex"in e&&e.initialIndex===l&&(r=a.length-1))}for(var p=0;p<a.length;p++)!function(l){var c=i.BB.el({content:a[l]?"":"X",css:{width:"22px",height:"22px",backgroundColor:a[l]?i.BB.ColorConverter.toRgbaStr(a[l]):"transparent",marginLeft:"7px",boxShadow:"0 0 0 1px #aaa",cursor:"pointer",userSelect:"none",textAlign:"center",lineHeight:"23px",color:"#aaa"}});a[l]&&0===a[l].a&&(c.style.backgroundImage="url("+s+")"),c.onclick=function(n){n.preventDefault(),r=l,t(),e.onChange(a[l])},c.setIsSelected=function(e){e?i.BB.css(c,{boxShadow:"0 0 0 2px var(--active-highlight-color), 0 0 5px 0 var(--active-highlight-color)",pointerEvents:"none"}):i.BB.css(c,{boxShadow:"0 0 0 1px #aaa",pointerEvents:""})},n.appendChild(c),o.push(c)}(p);t(),this.getElement=function(){return n},this.destroy=function(){o.forEach((function(e){e.onclick=null})),o.splice(0,o.length)}}})),r.register("iskOY",(function(e,n){t(e.exports,"Options",(function(){return a}));var i=r("eWjiX"),a=function(e){for(var t=function(t){var r={id:t.id,el:null},a=["kl-option"];e.isSmall&&a.push("kl-option--small"),"string"!=typeof t.label&&(a.push("kl-option--custom-el"),i.BB.css(t.label,{display:"block",pointerEvents:"none"})),r.el=i.BB.el({parent:o,content:t.label,className:a.join(" "),onClick:function(){l!==r.id&&(l=r.id,n(),e.onChange(l))}}),t.title&&(r.el.title=t.title),s.push(r)},n=function(){for(var e=0;e<s.length;e++)s[e].el.classList.toggle("kl-option-selected",s[e].id===l)},r=function(){for(var e=0;e<s.length;e++)if(s[e].id===l)return e},a=i.BB.el({}),o=i.BB.el({parent:a,className:"kl-option-wrapper",css:{display:"flex"}}),s=[],l=("initialId"in e?e.initialId:e.optionArr[0].id),c=0;c<e.optionArr.length;c++)t(e.optionArr[c]);n(),e.changeOnInit&&setTimeout((function(){e.onChange(l)}),0),this.getElement=function(){return a},this.getValue=function(){return l},this.next=function(){l=s[(r()+1)%s.length].id,n(),e.onChange(l)},this.previous=function(){l=s[(s.length+r()-1)%s.length].id,n(),e.onChange(l)},this.destroy=function(){s.forEach((function(e){i.BB.destroyEl(e.el)})),s.splice(0,s.length)}}})),r.register("bmB93",(function(n,i){t(n.exports,"StatusOverlay",(function(){return c}));var a=r("gFgFC"),o=r("kiQ5H"),s=r("eWjiX"),l=r("bv5Zj"),c=function(){"use strict";function t(){(0,a.default)(this,t),this.init()}return(0,o.default)(t,[{key:"updateUiState",value:function(){this.el&&(setTimeout((function(){}),100),"left"===this.uiState?this.el.style.left="271px":this.el.style.removeProperty("left"))}},{key:"init",value:function(){this.el=s.BB.el({className:"top-overlay g-root",onClick:s.BB.handleClick}),this.isWide&&(this.el.style.width="100%"),this.updateUiState(),this.innerEl=s.BB.el({className:"top-overlay-inner"}),this.angleIm=new Image,this.angleIm.src=e(l),s.BB.css(this.angleIm,{verticalAlign:"bottom",width:"20px",height:"20px",marginLeft:"5px",borderRadius:"10px"}),this.innerInnerEl=document.createElement("div"),this.innerInnerEl.style.display="inline-block",this.innerEl.appendChild(this.innerInnerEl),this.innerEl.appendChild(this.angleIm),this.el.appendChild(this.innerEl),document.body.appendChild(this.el),this.el.style.display="none"}},{key:"setWide",value:function(e){this.isWide=!!e,this.el&&(this.isWide?(this.el.style.width="100%",this.el.style.left=""):(this.el.style.removeProperty("width"),this.el.style.left="left"===this.uiState?"271px":""))}},{key:"setUiState",value:function(e){this.uiState=e,this.updateUiState()}},{key:"out",value:function(e,t){var n=this;e&&"object"==typeof e?"transform"===e.type?(this.angleIm.style.display="inline-block",this.angleIm.style.transform="rotate("+e.angleDeg+"deg)",e.angleDeg%90==0?this.angleIm.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.7)":this.angleIm.style.boxShadow="",this.innerInnerEl.innerHTML=Math.round(100*e.scale)+"%"):this.angleIm.style.display="none":"string"==typeof e&&(this.angleIm.style.display="none",this.innerInnerEl.innerHTML=e),t&&(this.innerEl.style.animation="",setTimeout((function(){return n.innerEl.style.animation="top-overlay-pulse 0.5s ease-out"}),20),this.timeout3&&clearTimeout(this.timeout3),this.timeout3=window.setTimeout((function(){return n.innerEl.style.animation=""}),520)),this.timeout&&clearTimeout(this.timeout),this.timeout2&&clearTimeout(this.timeout2),this.el.style.animationName=t?"consoleInFast":"consoleIn",this.el.style.opacity="1",this.timeout=window.setTimeout((function(){n.el.style.opacity="0",n.el.style.animationName="consoleOut",n.timeout2=window.setTimeout((function(){n.el.style.display="none",n.timeout2=0}),450),n.timeout=0}),1200),this.el.style.display="flex"}}]),t}()})),r.register("bv5Zj",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("iQ1f0")})),r.register("auloj",(function(e,n){t(e.exports,"exportDialog",(function(){return o}));var i=r("eWjiX"),a=r("ekHRj");function o(e,t){var n,r,o,s,l,c,u,h;r=!1,o=!1,n=document.createElement("div"),i.BB.css(n,{width:"308px"}),s=document.createElement("div"),(l=new Image).src=t.src,s.appendChild(l),s.appendChild(t),i.BB.css(s,{width:"264px",height:"176px",marginTop:"21px",marginLeft:"21px",position:"relative",overflow:"hidden",boxShadow:"0 0 10px 4px rgba(255,255,255, 0)",border:"1px solid rgba(255, 255, 255, 1)",transition:"box-shadow 0.7s linear"}),i.BB.css(t,{position:"absolute",left:"0",top:"0",width:"264px",height:"176px",opacity:"0"}),(c={width:264,height:264/t.width*t.height}).height<176&&(c.height=176,c.width=c.height/t.height*t.width),i.BB.css(l,{position:"absolute",top:"88px",left:"132px",width:c.width+"px",height:c.height+"px",marginLeft:-c.width/2+"px",marginTop:-c.height/2+"px"}),function e(){r||((o=!o)?i.BB.css(s,{border:"1px solid rgba(0, 0, 0, 1)"}):i.BB.css(s,{border:"1px solid rgba(200, 200, 200, 1)"}),setTimeout(e,510))}(),(u=document.createElement("div")).innerHTML="Right-Click or Press-Hold on the image, then save.",u.ontouchstart=function(){return!1},i.BB.css(u,{fontSize:"17.6px",color:"#666",padding:"10px",textAlign:"center"}),n.appendChild(s),n.appendChild(u),t.ontouchstart=function(){i.BB.css(s,{boxShadow:"0 0 10px 8px rgba(0,255,255, 1)"}),!0,h=setTimeout((function(){!1,i.BB.css(s,{boxShadow:"0 0 10px 4px rgba(0,255,255, 0)"})}),1500)},t.ontouchmove=function(){i.BB.css(s,{boxShadow:"0 0 10px 4px rgba(0,255,255, 0)"}),!1,clearTimeout(h)},t.ontouchend=function(){i.BB.css(s,{boxShadow:"0 0 10px 4px rgba(0,255,255, 0)"}),!1,clearTimeout(h)},(0,a.popup)({target:e,message:"<b>Save Image</b>",div:n,buttons:["Close"],callback:function(e){r=!0}})}})),r.register("hRdOL",(function(e,n){t(e.exports,"CropCopy",(function(){return a}));var i=r("eWjiX");function a(e){var t,n=function(){t={x:0,y:0,width:e.canvas.width,height:e.canvas.height}},r=function(){u.width=Math.round(t.width),u.height=Math.round(t.height),u.getContext("2d").drawImage(e.canvas,Math.round(-t.x),Math.round(-t.y)),d&&(d.src=u.toDataURL("image/png")),e.onChange&&e.onChange(u.width,u.height)},a=function(){i.BB.css(w,{left:x+t.x*m+"px",top:b+t.y*v+"px",width:t.width*m+"px",height:t.height*v+"px"}),e.onChange&&e.onChange(Math.round(t.width),Math.round(t.height))},o=function(t){return{x:i.BB.clamp((t.x-x)/m,0,e.canvas.width),y:i.BB.clamp((t.y-b)/v,0,e.canvas.height)}},s=function(e,t){var n={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)},r={x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)},i=o(n),a=o(r);return i.x=Math.floor(i.x),i.y=Math.floor(i.y),a.x=Math.ceil(a.x),a.y=Math.ceil(a.y),{x:i.x,y:i.y,width:a.x-i.x,height:a.y-i.y}},l=function(){return 0===t.x&&0===t.y&&t.width===e.canvas.width&&t.height===e.canvas.height},c=document.createElement("div");i.BB.css(c,{position:"relative",height:e.height+"px",width:e.width+"px",overflow:"hidden",colorScheme:"only light"}),c.style.position="relative",n();var u=i.BB.canvas(),h=u,d=null;e.isNotCopy||(d=new Image,h=d),i.BB.css(h,{height:e.height+"px",width:e.width+"px"}),c.appendChild(h),r();var p=i.BB.el({css:{width:e.width+"px",height:e.height+"px",position:"absolute",left:"0",top:"0",pointerEvents:"none"}});c.appendChild(p),i.BB.createCheckerDataUrl(4,(function(e){p.style.backgroundImage="url("+e+")"}));var g=i.BB.fitInto(e.canvas.width,e.canvas.height,e.width-40,e.height-40,1),f=i.BB.canvas(Math.round(g.width),Math.round(g.height));f.style.imageRendering="pixelated";var m=f.width/e.canvas.width,v=f.height/e.canvas.height,y=f.getContext("2d");y.imageSmoothingEnabled=!1,y.drawImage(e.canvas,0,0,f.width,f.height),p.appendChild(f);var x=parseInt(""+(e.width-f.width)/2),b=parseInt(""+(e.height-f.height)/2);i.BB.css(f,{position:"absolute",left:x+"px",top:b+"px"});var B,w=i.BB.el({css:{position:"absolute",boxShadow:"0 0 0 1px #fff, 0 0 0 2px #000, 0 0 40px 1px #000"}});p.appendChild(w),a();var C,S=null,k=!1,L=!1,T=new i.BB.PointerListener({target:h,fixScribble:!0,onPointer:function(o){var c,u,h,d,p;"pointerdown"===o.type&&"left"===o.button?(o.eventPreventDefault(),k=!0,B={x:o.relX,y:o.relY},!l()&&(c=B,u=Math.round(x+t.x*m),h=Math.round(b+t.y*v),d=Math.round(t.width*m),p=Math.round(t.height*v),u<=c.x&&c.x<=u+d&&h<=c.y&&c.y<=h+p)?S={x:t.x,y:t.y,width:t.width,height:t.height}:t=s(B,B)):"pointermove"===o.type&&"left"===o.button?(o.eventPreventDefault(),L=!0,S?(t.x=S.x+Math.round((o.relX-B.x)/m),t.y=S.y+Math.round((o.relY-B.y)/v),t.x=i.BB.clamp(t.x,0,e.canvas.width-t.width),t.y=i.BB.clamp(t.y,0,e.canvas.height-t.height)):t=s(B,{x:o.relX,y:o.relY}),a()):"pointerup"===o.type&&B&&(o.eventPreventDefault(),k=!1,S=null,B=null,0!==t.width&&0!==t.height&&L||(n(),a()),L=!1,C=setTimeout(r,1))}}),E=new i.BB.KeyListener({onDown:function(n,o,s){if(!k){var l=!1,c=Math.max(1,1/m),u=E.isPressed("shift");"left"===n&&(u?t.width=i.BB.clamp(t.width-c,1,e.canvas.width-t.x):t.x=i.BB.clamp(t.x-c,0,e.canvas.width-t.width),l=!0),"right"===n&&(u?t.width=i.BB.clamp(t.width+c,1,e.canvas.width-t.x):t.x=i.BB.clamp(t.x+c,0,e.canvas.width-t.width),l=!0),"up"===n&&(u?t.height=i.BB.clamp(t.height-c,1,e.canvas.height-t.y):t.y=i.BB.clamp(t.y-c,0,e.canvas.height-t.height),l=!0),"down"===n&&(u?t.height=i.BB.clamp(t.height+c,1,e.canvas.height-t.y):t.y=i.BB.clamp(t.y+c,0,e.canvas.height-t.height),l=!0),l&&(o.preventDefault(),a(),clearTimeout(C),C=setTimeout(r,100))}}});this.getEl=function(){return c},this.reset=function(){n(),r(),a()},this.destroy=function(){h.style.removeProperty("width"),h.style.removeProperty("height"),E.destroy(),T.destroy()},this.isReset=function(){return l()},this.getRect=function(){return JSON.parse(JSON.stringify(t))},this.getCroppedImage=function(){return u}}})),r.register("isYih",(function(n,i){t(n.exports,"clipboardDialog",(function(){return d}));var a=r("3kC7t"),o=r("7U0Ew"),s=r("cijLd"),l=r("eWjiX"),c=r("ekHRj"),u=r("hRdOL"),h=r("1mH1z");function d(t,n,r,i,d){var p=function(){var t=x.getCroppedImage().toDataURL("image/png");setTimeout((0,a.default)(e(s).mark((function n(){var r,a;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:return r=e.sent,e.next=6,r.blob();case 6:return a=e.sent,e.next=9,navigator.clipboard.write([new ClipboardItem((0,o.default)({},a.type,a))]);case 9:setTimeout((function(){i.out((0,h.LANG)("cropcopy-copied"),!0)}),200),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0.name,e.t0.message);case 15:case"end":return e.stop()}}),n,null,[[0,12]])}))),0)},g=function(){b()},f=!1;try{f=!!ClipboardItem}catch(e){}var m=document.createElement("div"),v=window.innerWidth<550||window.innerHeight<550,y=l.BB.el({content:(0,h.LANG)("crop-drag-to-crop")+(f?"":"<br>"+(0,h.LANG)("cropcopy-click-hold")),css:{textAlign:"center"}});m.appendChild(y);var x=new(0,u.CropCopy)({width:v?340:540,height:v?300:350,canvas:n,clipboardItemIsSupported:f});l.BB.css(x.getEl(),{marginTop:"10px",marginLeft:"-20px",borderTop:"1px solid #bbb",borderBottom:"1px solid #bbb"}),m.appendChild(x.getEl());var b,B=new l.BB.KeyListener({onDown:function(e,t,n){"ctrl+c"===n&&(p(),b())}});l.BB.addEventListener(window,"blur",g);var w=[];f&&w.push((0,h.LANG)("cropcopy-btn-copy")),d&&w.push((0,h.LANG)("cropcopy-btn-crop")),w.push("Cancel"),(0,c.popup)({target:t,message:"<b>"+(d?"".concat((0,h.LANG)("cropcopy-title-copy")," / ").concat((0,h.LANG)("cropcopy-title-crop")):"".concat((0,h.LANG)("cropcopy-title-copy")))+"</b>",div:m,style:v?{}:{width:"500px"},buttons:w,primaries:[(0,h.LANG)("cropcopy-btn-copy")],callback:function(e){if(e===(0,h.LANG)("cropcopy-btn-copy"))p();else if(e===(0,h.LANG)("cropcopy-btn-crop")){var t=x.getRect();r({left:Math.round(-t.x),right:Math.round(t.x+t.width-n.width),top:Math.round(-t.y),bottom:Math.round(t.y+t.height-n.height)})}l.BB.removeEventListener(window,"blur",g),x.destroy(),B.destroy()},clickOnEnter:(0,h.LANG)("cropcopy-btn-copy"),closefunc:function(e){b=e}})}})),r.register("5rdL4",(function(n,i){t(n.exports,"klLayerManager",(function(){return x}));var a=r("eWjiX"),o=r("ekHRj"),s=r("gWfkn"),l=r("iskOY"),c=r("21VAD"),u=r("bd9hB"),h=r("d42vI"),d=r("dKwR8"),p=r("3VpTB"),g=r("8yL1I"),f=r("g91IK"),m=r("705qg"),v=r("1mH1z"),y=r("bBcC4");function x(t,n,r){var i,x=function(t){var n=document.createElement("div"),i=a.BB.el({content:(0,v.LANG)("layers-rename-name")+":",css:{marginRight:"5px"}}),l=a.BB.el({css:{display:"flex"}}),c=document.createElement("input");c.value=k.getLayer(t).name,c.setAttribute("data-ignore-focus","true");var u=a.BB.el({tagName:"Button",content:'<img src="'+e(g)+'" height="20"/>',title:(0,v.LANG)("layers-rename-clear"),css:{marginLeft:"10px"},onClick:function(){c.value="",c.focus()}}),h=[(0,v.LANG)("layers-rename-sketch"),(0,v.LANG)("layers-rename-colors"),(0,v.LANG)("layers-rename-lines"),(0,v.LANG)("background"),(0,v.LANG)("layers-rename-foreground")],d=[],p=a.BB.el({css:{display:"flex",flexWrap:"wrap",marginTop:"5px",marginLeft:"-5px"}});h.forEach((function(e){var t=a.BB.el({parent:p,tagName:"Button",content:e,onClick:function(){c.value=t.textContent},css:{margin:"5px 0 0 5px"}});d.push(t)})),n.appendChild(i),i.append(l,p),l.append(c,u),setTimeout((function(){c.focus(),c.select()}),10),(0,o.popup)({target:r,message:"<b>".concat((0,v.LANG)("layers-rename-title"),"</b>"),div:n,buttons:[(0,v.LANG)("layers-rename"),"Cancel"],primaries:[(0,v.LANG)("layers-rename")],callback:function(e){if(a.BB.destroyEl(u),d.forEach((function(e){a.BB.destroyEl(e)})),d.splice(0,d.length),e===(0,v.LANG)("layers-rename")){if(c.value===k.getLayer(t).name)return;k.renameLayer(t,c.value),b(),s.klHistory.pause(!0),M(t),s.klHistory.pause(!1)}},clickOnEnter:(0,v.LANG)("layers-rename")})},b=function(){function e(e){var t=k.getLayer(e).name,n=D[e].opacity,r=D[e].context.canvas,i=document.createElement("div");i.className="layerBox",L[e]=i,i.posY=35*(D.length-1)-35*e,a.BB.css(i,{width:"250px",height:"34px",backgroundColor:"rgb( 220, 220, 220)",border:"1px solid #aaa",position:"absolute",left:"0 px",top:i.posY+"px",transition:"all 0.1s linear",borderRadius:"5px",boxSizing:"border-box"});var o=document.createElement("div");a.BB.css(o,{position:"relative"});var l=document.createElement("div");a.BB.css(l,{width:"250px",height:"34px"});var c=document.createElement("div");i.appendChild(o),o.appendChild(l),o.appendChild(c),i.spot=e;var h,d=a.BB.fitInto(r.width,r.height,30,30,1),p=i.thumb=a.BB.canvas(d.width,d.height),g=p.getContext("2d");g.save(),p.width>r.width&&(g.imageSmoothingEnabled=!1),g.drawImage(r,0,0,p.width,p.height),g.restore(),a.BB.css(i.thumb,{position:"absolute",left:(32-i.thumb.width)/2+"px",top:(32-i.thumb.height)/2+"px",colorScheme:"only light"}),a.BB.createCheckerDataUrl(4,(function(e){p.style.backgroundImage="url("+e+")"})),i.label=document.createElement("div"),i.lname=t,i.label.append(i.lname),a.BB.css(i.label,{position:"absolute",left:"38px",top:"1px",fontSize:"13px",width:"170px",height:"20px",overflow:"hidden",color:"#666",whiteSpace:"nowrap"}),i.label.ondblclick=function(){x(i.spot)},i.opacityLabel=document.createElement("div"),i.opacity=n,i.opacityLabel.append(parseInt(""+100*i.opacity)+"%"),a.BB.css(i.opacityLabel,{position:"absolute",left:"194px",top:"1px",fontSize:"13px",textAlign:"right",width:"50px",color:"#666",transition:"color 0.2s ease-in-out"});var f=new(0,u.PointSlider)({init:i.opacity,width:204,pointSize:14,callback:function(e,t,n){return t?(h=k.getLayer(i.spot).opacity,void s.klHistory.pause(!0)):n?(s.klHistory.pause(!1),void(h!==e&&k.layerOpacity(i.spot,e))):(i.opacityLabel.innerHTML=Math.round(100*e)+"%",void k.layerOpacity(i.spot,e))}});a.BB.css(f.getEl(),{position:"absolute",left:"39px",top:"17px"}),i.opacitySlider=f,a.BB.setEventListener(i.thumb,"onpointerover",(function(e){if(0===e.buttons||e.pointerType&&"touch"===e.pointerType){var t=a.BB.fitInto(r.width,r.height,250,250,1);P.width===t.width&&P.height===t.height||(P.width=t.width,P.height=t.height);var n=P.getContext("2d");n.save(),P.width>r.width&&(n.imageSmoothingEnabled=!1),n.imageSmoothingQuality="high",n.clearRect(0,0,P.width,P.height),n.drawImage(r,0,0,P.width,P.height),n.restore(),a.BB.css(I,{top:e.clientY-P.height/2+"px",opacity:"0"}),!1===O&&(document.body.appendChild(I),O=!0),clearTimeout(R),R=setTimeout((function(){a.BB.css(I,{opacity:"1"})}),20),clearTimeout(A)}})),a.BB.setEventListener(i.thumb,"onpointerout",(function(){clearTimeout(R),a.BB.css(I,{opacity:"0"}),clearTimeout(A),A=setTimeout((function(){O&&(document.body.removeChild(I),O=!1)}),300)})),l.appendChild(i.thumb),l.appendChild(i.label),l.appendChild(i.opacityLabel),l.appendChild(f.getEl());var m=!1,v=!1;i.pointerListener=new a.BB.PointerListener({target:l,maxPointers:1,onPointer:function(e){if("pointerdown"===e.type&&"left"===e.button)a.BB.css(i,{transition:"box-shadow 0.3s ease-in-out"}),i.style.zIndex="1",Y=i.spot,v=!1,i.isSelected||(v=!0,z.activateLayer(i.spot)),m=!0;else if("pointermove"===e.type&&"left"===e.button){m&&(m=!1,a.BB.css(i,{boxShadow:"1px 3px 5px rgba(0,0,0,0.4)"})),i.posY+=e.dY;var t=Math.max(0,Math.min(35*(D.length-1),i.posY));i.style.top=t+"px",w(i.spot,B(i.posY))}if("pointerup"===e.type){a.BB.css(i,{transition:"all 0.1s linear"}),setTimeout((function(){a.BB.css(i,{boxShadow:""})}),20),i.posY=Math.max(0,Math.min(35*(D.length-1),i.posY)),i.style.zIndex="";var n=B(i.posY),r=i.spot;C(i.spot,n),r!=n&&(s.klHistory.pause(!0),M(N),s.klHistory.pause(!1)),r===n&&v&&M(N),v=!1}}}),j.appendChild(i)}for(i=s.klHistory.getState(),L=[];j.firstChild;){var t=j.firstChild;t.pointerListener.destroy(),t.opacitySlider.destroy(),j.removeChild(t)}for(var n=0;n<D.length;n++)e(n);z.activateLayer(N),S()},B=function(e){var t=parseInt(""+(e/(T+E)+.5));return t=Math.min(D.length-1,Math.max(0,t)),t=D.length-t-1},w=function(e,t){if((t=Math.min(D.length-1,Math.max(0,t)))!==Y){for(var n=0;n<D.length;n++)if(L[n].spot!==e){var r=L[n].spot;L[n].spot>e&&r--,r>=t&&r++,L[n].posY=(T+E)*(D.length-r-1),L[n].style.top=L[n].posY+"px"}Y=t}},C=function(e,t){if(isNaN(e)||isNaN(t))throw"layermanager - invalid move";for(var n=0;n<D.length;n++)!function(n){var r=L[n].spot;L[n].spot===e?r=t:(L[n].spot>e&&r--,r>=t&&r++),L[n].spot=r,L[n].posY=(T+E)*(D.length-r-1),L[n].style.top=L[n].posY+"px"}(n);e!==t&&(k.moveLayer(N,t-e),D=k.getLayers(),N=t,K.disabled=0===N)},S=function(){j.style.height=35*L.length+"px"},k=t,L=[],T=35,E=0,M=n,I=a.BB.el({onClick:a.BB.handleClick,css:{position:"absolute",right:"280px",top:"500px",background:"#aaa",boxShadow:"1px 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none",padding:"0",border:"1px solid #aaa",transition:"opacity 0.3s ease-out",userSelect:"none",colorScheme:"only light"}});a.BB.createCheckerDataUrl(4,(function(e){I.style.backgroundImage="url("+e+")"}));var A,R,P=a.BB.canvas(200,200);P.style.display="block",I.appendChild(P);var O=!1,D=k.getLayers(),N=D.length-1,z=document.createElement("div");z.style.marginRight="10px",z.style.marginBottom="10px",z.style.marginLeft="10px",z.style.marginTop="10px",z.style.cursor="default";var G=document.createElement("div");a.BB.css(G,{width:"250px",position:"relative"});var j=a.BB.el({});z.disableButtons=function(){},z.enableButtons=function(){};var H,X,F=document.createElement("button"),U=document.createElement("button"),K=document.createElement("button"),V=document.createElement("button"),W=document.createElement("button");z.appendChild(function(){var t=document.createElement("div");return setTimeout((function(){a.BB.makeUnfocusable(F),a.BB.makeUnfocusable(U),a.BB.makeUnfocusable(K),a.BB.makeUnfocusable(V),a.BB.makeUnfocusable(W),F.style.cssFloat="left",U.style.cssFloat="left",K.style.cssFloat="left",V.style.cssFloat="left",W.style.cssFloat="left",F.title=(0,v.LANG)("layers-new"),U.title=(0,v.LANG)("layers-duplicate"),V.title=(0,v.LANG)("layers-remove"),K.title=(0,v.LANG)("layers-merge"),W.title=(0,v.LANG)("layers-rename-title"),F.style.paddingLeft="5px",F.style.paddingRight="3px",V.style.paddingLeft="5px",V.style.paddingRight="3px",U.style.paddingLeft="5px",U.style.paddingRight="3px",K.style.paddingLeft="5px",K.style.paddingRight="3px",W.style.height="30px",W.style.lineHeight="20px",F.innerHTML="<img src='"+e(h)+"' height='20'/>",U.innerHTML="<img src='"+e(d)+"' height='20'/>",K.innerHTML="<img src='"+e(p)+"' height='20'/>",V.innerHTML="<img src='"+e(g)+"' height='20'/>",W.innerHTML="<img src='"+e(f)+"' height='20'/>",F.style.marginRight="5px",V.style.marginRight="5px",U.style.marginRight="5px",K.style.marginRight="5px",t.appendChild(F),t.appendChild(V),t.appendChild(U),t.appendChild(K),t.appendChild(W),t.appendChild(a.BB.el({css:{clear:"both"}}));var n=document.createElement("div");n.style.clear="both",n.style.height="10px",t.appendChild(n),F.onclick=function(){!1!==k.addLayer(N)&&((D=k.getLayers()).length===m.MAX_LAYERS&&(F.disabled=!0,U.disabled=!0),V.disabled=!1,N+=1,b(),s.klHistory.pause(!0),M(N),s.klHistory.pause(!1))},U.onclick=function(){!1!==k.duplicateLayer(N)&&((D=k.getLayers()).length===m.MAX_LAYERS&&(F.disabled=!0,U.disabled=!0),V.disabled=!1,N++,b(),s.klHistory.pause(!0),M(N),s.klHistory.pause(!1))},V.onclick=function(){L.length<=1||(k.removeLayer(N),N>0&&N--,D=k.getLayers(),b(),s.klHistory.pause(!0),M(N),s.klHistory.pause(!1),1===D.length&&(V.disabled=!0),D.length<m.MAX_LAYERS&&(F.disabled=!1,U.disabled=!1))},K.onclick=function(){N<=0||function(e){var t=document.createElement("div");t.innerHTML=(0,v.LANG)("layers-merge-description");var n=new(0,l.Options)({optionArr:[{id:e.mixModeStr,label:(0,y.translateBlending)(e.mixModeStr)},{id:"source-in",label:"source-in"},{id:"source-out",label:"source-out"},{id:"source-atop",label:"source-atop"},{id:"destination-in",label:"destination-in"},{id:"destination-out",label:"destination-out"},{id:"destination-atop",label:"destination-atop"},{id:"xor",label:"xor"}],initId:e.mixModeStr,onChange:function(e){h()},isSmall:!0});n.getElement().style.marginTop="5px",t.appendChild(n.getElement());var i=a.BB.fitInto(e.topCanvas.width,e.topCanvas.height,200,200,1),s=a.BB.canvas(i.width,i.height);s.title=(0,v.LANG)("preview");var c=document.createElement("div");c.innerHTML="<br/>",c.style.clear="both",t.appendChild(c),t.appendChild(s),a.BB.css(s,{display:"block",marginLeft:"auto",marginRight:"auto",colorScheme:"only light"}),s.style.boxShadow="0 0 3px rgba(0,0,0,0.5)",a.BB.createCheckerDataUrl(4,(function(e){s.style.backgroundImage="url("+e+")"}));var u=a.BB.copyCanvas(s);function h(){var t=s.getContext("2d");t.save(),t.clearRect(0,0,s.width,s.height),s.width>e.topCanvas.width&&(t.imageSmoothingEnabled=!1),t.drawImage(e.bottomCanvas,0,0,s.width,s.height),"as-alpha"===n.getValue()?(t.globalCompositeOperation="destination-in",t.globalAlpha=e.topOpacity,t.drawImage(u,0,0,s.width,s.height)):(t.globalCompositeOperation=n.getValue(),t.globalAlpha=e.topOpacity,t.drawImage(e.topCanvas,0,0,s.width,s.height)),t.restore()}u.getContext("2d").drawImage(e.topCanvas,0,0,u.width,u.height),a.BB.convertToAlphaChannelCanvas(u),h();var d=new a.BB.KeyListener({onDown:function(e){"right"===e&&n.next(),"left"===e&&n.previous()}});(0,o.popup)({target:r,message:"<b>".concat((0,v.LANG)("layers-merge-modal-title"),"</b>"),div:t,buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(t){d.destroy(),n.destroy(),"Ok"===t&&e.callback(n.getValue())}})}({topCanvas:D[N].context.canvas,bottomCanvas:D[N-1].context.canvas,topOpacity:k.getLayer(N).opacity,mixModeStr:D[N].mixModeStr,callback:function(e){k.mergeLayers(N,N-1,e),D=k.getLayers(),N--,1===D.length&&(V.disabled=!0),D.length<m.MAX_LAYERS&&(F.disabled=!1,U.disabled=!1),b(),s.klHistory.pause(!0),M(N),s.klHistory.pause(!1)}})},W.onclick=function(){x(N)}}),1),t}()),H=a.BB.el({content:(0,v.LANG)("layers-blending")+"&nbsp;",css:{fontSize:"15px"}}),X=new(0,c.Select)({optionArr:["source-over",null,"darken","multiply","color-burn",null,"lighten","screen","color-dodge",null,"overlay","soft-light","hard-light",null,"difference","exclusion",null,"hue","saturation","color","luminosity"].map((function(e){return e?[e,(0,y.translateBlending)(e)]:null})),onChange:function(e){k.setMixMode(N,e),z.update(N)},css:{marginBottom:"10px"}}),H.appendChild(X.getElement()),z.appendChild(H),G.appendChild(j),z.appendChild(G);var Y=0;setInterval((function(){if("block"===z.style.display){var e=s.klHistory.getState();if(e!==i){i=e;for(var t=0;t<L.length;t++)if(N===L[t].spot&&D[L[t].spot]){var n=L[t].thumb.getContext("2d");n.save(),n.clearRect(0,0,n.canvas.width,n.canvas.height),D[L[t].spot].context.canvas.width<L[t].thumb.width&&(n.imageSmoothingEnabled=!1),n.drawImage(D[L[t].spot].context.canvas,0,0,L[t].thumb.width,L[t].thumb.height),n.restore()}}}}),1);return z.update=function(e){D=k.getLayers(),(e||0===e)&&(N=e),V.disabled=1===D.length,D.length===m.MAX_LAYERS?(F.disabled=!0,U.disabled=!0):(F.disabled=!1,U.disabled=!1),setTimeout((function(){b()}),1)},z.getSelected=function(){return N},z.activateLayer=function(e){if(e<0||e>L.length-1)throw"invalid spotIndex "+e+", layerElArr.length "+L.length;N=e,X.setValue(D[N].mixModeStr);for(var t=0;t<L.length;t++)N===L[t].spot?(L[t].style.backgroundColor="rgb( 250, 250, 250)",L[t].label.style.color="#000",L[t].style.boxShadow="",L[t].style.border="1px solid var(--active-highlight-color)",L[t].opacitySlider.setActive(!0),L[t].isSelected=!0):(L[t].style.backgroundColor="rgb( 220, 220, 220)",L[t].label.style.color="#666",L[t].style.boxShadow="",L[t].style.border="1px solid rgb(158, 158, 158)",L[t].opacitySlider.setActive(!1),L[t].isSelected=!1);K.disabled=0===N},z.setUiState=function(e){"left"===""+e?a.BB.css(I,{left:"280px",right:""}):a.BB.css(I,{left:"",right:"280px"})},b(),z}})),r.register("d42vI",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("1mb1v")})),r.register("dKwR8",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("11KJK")})),r.register("3VpTB",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("floUo")})),r.register("8yL1I",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("kino6")})),r.register("g91IK",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("hhQeq")})),r.register("705qg",(function(e,n){t(e.exports,"MAX_LAYERS",(function(){return g})),t(e.exports,"KlCanvas",(function(){return f}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("eWjiX"),s=r("30Cml"),l=r("3ujzu"),c=r("h20yl"),u=r("gWfkn"),h=r("aSJRf"),d=r("1mH1z"),p=["source-over","darken","multiply","color-burn","lighten","screen","color-dodge","overlay","soft-light","hard-light","difference","exclusion","hue","saturation","color","luminosity"],g=16,f=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((0,i.default)(this,e),this.layerNrOffset=n,this.layerCanvasArr=[],this.pickCanvas=o.BB.canvas(1,1),this.history=new(0,u.DecoyKlHistory),"copy"in t?(this.width=1,this.height=1):"width"in t&&"height"in t?(this.width=t.width,this.height=t.height):(this.width=1,this.height=1),this.init(this.width,this.height),this.changeListenerArr=[],"copy"in t)try{this.copy(t.copy)}catch(e){throw this.destroy(),e}else if("projectObj"in t){var r=[].concat(t.projectObj.layers);if(this.init(t.projectObj.width,t.projectObj.height),!r.length)throw new Error("project.layers needs at least 1 layer");for(var a=0;a<r.length;a++){if(r[a].mixModeStr&&!p.includes(r[a].mixModeStr))throw new Error("unknown mixModeStr "+r[a].mixModeStr);this.addLayer(),this.layerOpacity(a,r[a].opacity),this.layerCanvasArr[a].name=r[a].name,this.layerCanvasArr[a].mixModeStr=r[a].mixModeStr?r[a].mixModeStr:"source-over",this.layerCanvasArr[a].getContext("2d").drawImage(r[a].image,0,0)}}this.updateIndices()}return(0,a.default)(e,[{key:"init",value:function(e,t){if(!e||!t||isNaN(e)||isNaN(t)||e<1||t<1)throw new Error("init - invalid canvas size: "+e+", "+t);this.width=e,this.height=t}},{key:"emitChange",value:function(){this.changeListenerArr.forEach((function(e){return e()}))}},{key:"updateIndices",value:function(){this.layerCanvasArr.forEach((function(e,t){e.index=t}))}},{key:"setHistory",value:function(e){this.history=e}},{key:"reset",value:function(e){if(!e.width||!e.height||e.width<1||e.height<1||isNaN(e.width)||isNaN(e.height))throw new Error("invalid canvas size");if(this.history.pause(!0),this.width=e.width,this.height=e.height,this.layerCanvasArr.splice(1,Math.max(0,this.layerCanvasArr.length-1)),e.layers)for(var t=0;t<e.layers.length;t++){var n=e.layers[t];this.layerCanvasArr[t]||this.addLayer(),this.layerCanvasArr[t].name=n.name,this.layerCanvasArr[t].width=this.width,this.layerCanvasArr[t].height=this.height,this.layerCanvasArr[t].mixModeStr=n.mixModeStr?n.mixModeStr:"source-over",this.layerCanvasArr[t].getContext("2d").drawImage(n.image,0,0),this.layerOpacity(t,n.opacity)}else this.layerCanvasArr[0].name=e.layerName?e.layerName:(0,d.LANG)("layers-layer")+" 1",this.layerCanvasArr[0].width=this.width,this.layerCanvasArr[0].height=this.height,this.layerCanvasArr[0].mixModeStr="source-over",this.layerOpacity(0,1),e.color?this.layerFill(0,e.color):e.image&&this.layerCanvasArr[0].getContext("2d").drawImage(e.image,0,0);return this.updateIndices(),this.history.pause(!1),this.history.push({tool:["canvas"],action:"reset",params:[e]}),this.layerCanvasArr.length-1}},{key:"isLayerLimitReached",value:function(){return this.layerCanvasArr.length>=g}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"copy",value:function(e){if(e.getWidth()<1||e.getHeight()<1||isNaN(e.getWidth())||isNaN(e.getHeight()))throw new Error("invalid canvas size");for(var t=e.getLayers();this.layerCanvasArr.length>t.length;)this.removeLayer(this.layerCanvasArr.length-1);e.getWidth()==this.width&&e.getHeight()==this.height||this.init(e.getWidth(),e.getHeight());for(var n=0;n<t.length;n++)n>=this.layerCanvasArr.length?this.addLayer():(this.layerCanvasArr[n].width=this.width,this.layerCanvasArr[n].height=this.height),this.layerOpacity(n,t[n].opacity),this.layerCanvasArr[n].name=t[n].name,this.layerCanvasArr[n].mixModeStr=t[n].mixModeStr,this.layerCanvasArr[n].getContext("2d").drawImage(t[n].context.canvas,0,0);this.updateIndices()}},{key:"getLayerCount",value:function(){return this.layerCanvasArr.length}},{key:"resize",value:function(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"smooth";if(!e||!t||e===this.width&&t===this.height||isNaN(e)||isNaN(t)||e<1||t<1)return!1;if(e=Math.max(e,1),t=Math.max(t,1),"pixelated"===i){var a=(n=o.BB.canvas(e,t)).getContext("2d");a.imageSmoothingEnabled=!1;for(var s=0;s<this.layerCanvasArr.length;s++){s>0&&a.clearRect(0,0,e,t);var l=this.layerCanvasArr[s];a.drawImage(l,0,0,e,t),l.width=e,l.height=t;var c=l.getContext("2d");c.drawImage(n,0,0)}}else{if("smooth"!==i)throw new Error("unknown resize algorithm");n=o.BB.canvas(),r=o.BB.canvas();for(var u=0;u<this.layerCanvasArr.length;u++)o.BB.resizeCanvas(this.layerCanvasArr[u],e,t,n,r)}return this.width=e,this.height=t,!0}},{key:"resizeCanvas",value:function(e){var t=Math.round(e.left)+this.width+Math.round(e.right),n=Math.round(e.top)+this.height+Math.round(e.bottom),r=Math.round(e.left),i=Math.round(e.top);if(isNaN(t)||isNaN(n)||t<1||n<1)throw new Error("KlCanvas.resizeCanvas - invalid canvas size");for(var a=0;a<this.layerCanvasArr.length;a++){var s=o.BB.canvas(this.width,this.height),l=this.layerCanvasArr[a],c=this.layerCanvasArr[a].getContext("2d");s.getContext("2d").drawImage(l,0,0),this.layerCanvasArr[a].width=t,this.layerCanvasArr[a].height=n,c.save(),0===a&&e.fillColor&&(c.fillStyle=o.BB.ColorConverter.toRgbStr(e.fillColor),c.fillRect(0,0,t,n),c.clearRect(r,i,this.width,this.height)),c.drawImage(s,r,i),c.restore()}this.width=t,this.height=n}},{key:"addLayer",value:function(e){if(this.isLayerLimitReached())return!1;var t=o.BB.canvas(this.width,this.height);if(!t.getContext("2d"))throw new Error("kl-create-canvas-error");return t.mixModeStr="source-over",void 0===e?(this.layerCanvasArr[this.layerCanvasArr.length]=t,e=Math.max(0,this.layerCanvasArr.length-1)):(this.layerCanvasArr.splice(e+1,0,t),e++),t.name=(0,d.LANG)("layers-layer")+" "+(this.layerCanvasArr.length+this.layerNrOffset),this.history.pause(!0),this.layerOpacity(e,1),this.history.pause(!1),this.updateIndices(),this.history.push({tool:["canvas"],action:"addLayer",params:[e-1]}),e}},{key:"duplicateLayer",value:function(e){if(!this.layerCanvasArr[e]||this.isLayerLimitReached())return!1;var t=o.BB.canvas(this.width,this.height);return this.layerCanvasArr.splice(e+1,0,t),t.name=this.layerCanvasArr[e].name+" "+(0,d.LANG)("layers-copy"),t.mixModeStr=this.layerCanvasArr[e].mixModeStr,t.getContext("2d").drawImage(this.layerCanvasArr[e],0,0),this.history.pause(!0),this.layerOpacity(e+1,this.layerCanvasArr[e].opacity),this.history.pause(!1),this.updateIndices(),this.history.push({tool:["canvas"],action:"duplicateLayer",params:[e]}),e+1}},{key:"getLayerContext",value:function(e,t){if(this.layerCanvasArr[e])return this.layerCanvasArr[e].getContext("2d");if(t)return null;throw new Error("layer of index "+e+" not found (in "+this.layerCanvasArr.length+" layers)")}},{key:"removeLayer",value:function(e){return!!this.layerCanvasArr[e]&&(this.layerCanvasArr.splice(e,1),this.updateIndices(),this.history.push({tool:["canvas"],action:"removeLayer",params:[e]}),Math.max(0,e-1))}},{key:"renameLayer",value:function(e,t){return!!this.layerCanvasArr[e]&&(this.layerCanvasArr[e].name=t,this.history.push({tool:["canvas"],action:"renameLayer",params:[e,t]}),!0)}},{key:"layerOpacity",value:function(e,t){this.layerCanvasArr[e]&&(t=Math.max(0,Math.min(1,t)),this.layerCanvasArr[e].opacity=t,this.history.push({tool:["canvas"],action:"layerOpacity",params:[e,t]}),this.emitChange())}},{key:"moveLayer",value:function(e,t){if(0!==t&&this.layerCanvasArr[e]){var n=this.layerCanvasArr[e];this.layerCanvasArr.splice(e,1);var r=Math.max(0,Math.min(e+t,this.layerCanvasArr.length));return this.layerCanvasArr.splice(r,0,n),this.updateIndices(),this.history.push({tool:["canvas"],action:"moveLayer",params:[e,t]}),r}}},{key:"mergeLayers",value:function(e,t,n){if(this.layerCanvasArr[e]&&this.layerCanvasArr[t]&&e!==t){if(e>t){var r=e;e=t,t=r}var i=this.layerCanvasArr[t].opacity;if(0!==i&&i){var a=this.layerCanvasArr[e].getContext("2d");a.save(),"as-alpha"===n?(o.BB.convertToAlphaChannelCanvas(this.layerCanvasArr[t]),a.globalCompositeOperation="destination-in",a.globalAlpha=i,this.layerCanvasArr[e].getContext("2d").drawImage(this.layerCanvasArr[t],0,0)):(n&&(a.globalCompositeOperation=n),a.globalAlpha=i,this.layerCanvasArr[e].getContext("2d").drawImage(this.layerCanvasArr[t],0,0)),a.restore(),n&&(a.save(),a.fillStyle="rgba(0,0,0,0.01)",a.fillRect(-.9999999,-.9999999,1,1),a.restore())}return this.updateIndices(),this.history.pause(!0),this.removeLayer(t),this.history.pause(!1),this.history.push({tool:["canvas"],action:"mergeLayers",params:[e,t,n]}),e}}},{key:"rotate",value:function(e){for(;e<0;)e+=360;if((e%=360)%90==0&&0!==e){var t=o.BB.canvas();0===e||180===e?(t.width=this.width,t.height=this.height):90!==e&&270!==e||(t.width=this.height,t.height=this.width);for(var n=t.getContext("2d"),r=0;r<this.layerCanvasArr.length;r++)n.clearRect(0,0,t.width,t.height),n.save(),n.translate(t.width/2,t.height/2),n.rotate(e*Math.PI/180),180===e?n.drawImage(this.layerCanvasArr[r],-t.width/2,-t.height/2):90!==e&&270!==e||n.drawImage(this.layerCanvasArr[r],-t.height/2,-t.width/2),this.layerCanvasArr[r].width=t.width,this.layerCanvasArr[r].height=t.height,this.layerCanvasArr[r].getContext("2d").clearRect(0,0,this.layerCanvasArr[r].width,this.layerCanvasArr[r].height),this.layerCanvasArr[r].getContext("2d").drawImage(t,0,0),n.restore();this.width=t.width,this.height=t.height}}},{key:"flip",value:function(e,t,n){if(e||t){var r=o.BB.canvas(this.width,this.height);r.width=this.width,r.height=this.height;for(var i=r.getContext("2d"),a=0;a<this.layerCanvasArr.length;a++)(!n&&0!==n||a===n)&&(i.save(),i.clearRect(0,0,r.width,r.height),i.translate(r.width/2,r.height/2),i.scale(e?-1:1,t?-1:1),i.drawImage(this.layerCanvasArr[a],-r.width/2,-r.height/2),i.restore(),this.layerCanvasArr[a].getContext("2d").clearRect(0,0,this.layerCanvasArr[a].width,this.layerCanvasArr[a].height),this.layerCanvasArr[a].getContext("2d").drawImage(r,0,0))}}},{key:"layerFill",value:function(e,t,n){var r=this.layerCanvasArr[e].getContext("2d");r.save(),n&&(r.globalCompositeOperation=n),r.fillStyle="rgba("+t.r+","+t.g+","+t.b+",1)",r.fillRect(0,0,this.layerCanvasArr[e].width,this.layerCanvasArr[e].height),r.restore(),r.save(),r.fillStyle="rgba(0,0,0,0.01)",r.fillRect(-.9999999,-.9999999,1,1),r.restore(),this.history.push({tool:["canvas"],action:"layerFill",params:[e,t,n]})}},{key:"floodFill",value:function(e,t,n,r,i,a,l,c,u){if(!(t<0||n<0||t>=this.width||n>=this.height||0===i)){if(a=Math.round(a),!["above","current","all"].includes(l))throw new Error("invalid sampleStr");var h,d,p,g,f,m,v;if("all"===l){var y=1===this.layerCanvasArr.length?this.layerCanvasArr[0]:this.getCompleteCanvas(1);g=(p=(d=y.getContext("2d")).getImageData(0,0,this.width,this.height)).data,h=(0,s.floodFillBits)(g,this.width,this.height,t,n,a,Math.round(c),u),y=null,d=null,p=null,g=null,m=(f=this.layerCanvasArr[e].getContext("2d")).getImageData(0,0,this.width,this.height)}else{var x="above"===l?e+1:e;if(x>=this.layerCanvasArr.length)return;g=(p=(d=this.layerCanvasArr[x].getContext("2d")).getImageData(0,0,this.width,this.height)).data,h=(0,s.floodFillBits)(g,this.width,this.height,t,n,a,Math.round(c),u),e!==x&&(d=null,p=null,g=null),f=e===x?d:this.layerCanvasArr[e].getContext("2d"),m=e===x?p:f.getImageData(0,0,this.width,this.height)}if(v=m.data,1===i)for(var b=0;b<this.width*this.height;b++)255===h.data[b]&&(v[4*b]=r.r,v[4*b+1]=r.g,v[4*b+2]=r.b,v[4*b+3]=255);else for(var B=0;B<this.width*this.height;B++)255===h.data[B]&&(v[4*B]=o.BB.mix(v[4*B],r.r,i),v[4*B+1]=o.BB.mix(v[4*B+1],r.g,i),v[4*B+2]=o.BB.mix(v[4*B+2],r.b,i),v[4*B+3]=o.BB.mix(v[4*B+3],255,i));f.putImageData(m,0,0),this.history.push({tool:["canvas"],action:"replaceLayer",params:[e,m]})}}},{key:"drawShape",value:function(e,t){t.x1===t.x2&&t.y1===t.y2||((0,l.drawShape)(this.layerCanvasArr[e].getContext("2d"),t),this.history.push({tool:["canvas"],action:"drawShape",params:[e,o.BB.copyObj(t)]}))}},{key:"text",value:function(e,t){(0,c.renderText)(this.layerCanvasArr[e],o.BB.copyObj(t)),this.history.push({tool:["canvas"],action:"text",params:[e,o.BB.copyObj(t)]})}},{key:"replaceLayer",value:function(e,t){this.layerCanvasArr[e].getContext("2d").putImageData(t,0,0),this.history.push({tool:["canvas"],action:"replaceLayer",params:[e,t]})}},{key:"clearLayer",value:function(e){var t=this.layerCanvasArr[e].getContext("2d");t.save(),t.clearRect(0,0,this.layerCanvasArr[e].width,this.layerCanvasArr[e].height),t.restore(),this.history.push({tool:["canvas"],action:"clearLayer",params:[e]})}},{key:"getLayers",value:function(){return this.layerCanvasArr.map((function(e){return{context:e.getContext("2d"),opacity:e.opacity,name:e.name,mixModeStr:e.mixModeStr}}))}},{key:"getLayersFast",value:function(){return this.layerCanvasArr.map((function(e){return{canvas:e,opacity:e.opacity,name:e.name,mixModeStr:e.mixModeStr}}))}},{key:"getLayerIndex",value:function(e,t){for(var n=0;n<this.layerCanvasArr.length;n++)if(this.layerCanvasArr[n]===e)return n;if(!t)throw new Error("layer not found (in "+this.layerCanvasArr.length+" layers)");return null}},{key:"getLayer",value:function(e,t){if(this.layerCanvasArr[e])return{context:this.layerCanvasArr[e].getContext("2d"),opacity:this.layerCanvasArr[e].opacity,name:this.layerCanvasArr[e].name,id:e};if(!t)throw new Error("layer of index "+e+" not found (in "+this.layerCanvasArr.length+" layers)");return null}},{key:"getColorAt",value:function(e,t){e=Math.floor(e),t=Math.floor(t);var n=this.pickCanvas.getContext("2d");n.save(),n.imageSmoothingEnabled=!1,n.clearRect(0,0,1,1);for(var r=0;r<this.layerCanvasArr.length;r++)n.globalAlpha=this.layerCanvasArr[r].opacity,n.globalCompositeOperation=this.layerCanvasArr[r].mixModeStr,n.drawImage(this.layerCanvasArr[r],-e,-t);n.restore();var i=n.getImageData(0,0,1,1);return new o.BB.RGB(i.data[0],i.data[1],i.data[2])}},{key:"getCompleteCanvas",value:function(e){return(0,h.drawProject)(this.getProject(),e)}},{key:"getProject",value:function(){return{width:this.width,height:this.height,layers:this.layerCanvasArr.map((function(e){return{name:e.name,opacity:e.opacity,mixModeStr:e.mixModeStr,image:e}}))}}},{key:"addChangeListener",value:function(e){this.changeListenerArr.includes(e)||this.changeListenerArr.push(e)}},{key:"removeChangeListener",value:function(e){for(var t=0;t<this.changeListenerArr.length;t++)if(this.changeListenerArr[t]===e)return void this.changeListenerArr.splice(t,1)}},{key:"setMixMode",value:function(e,t){if(!this.layerCanvasArr[e])throw new Error("invalid layer");this.layerCanvasArr[e].mixModeStr=t,this.history.push({tool:["canvas"],action:"setMixMode",params:[e,""+t]})}},{key:"setComposite",value:function(e,t){if(!this.layerCanvasArr[e])throw new Error("invalid layer");this.layerCanvasArr[e].compositeObj=t}},{key:"destroy",value:function(){null!==this.layerCanvasArr&&(this.layerCanvasArr.forEach((function(e){o.BB.freeCanvas(e)})),this.layerCanvasArr=null)}}]),e}()})),r.register("30Cml",(function(e,n){function r(e,t,n,r,i,a){for(var o=n;o<=i;o++)for(var s=r;s<=a;s++)255!==e[s*t+o]&&(e[s*t+o]=254)}var i,a;function o(e,t,n,r,o){return i=n%e+r,a=Math.floor(n/e)+o,i<0||a<0||i>=e||a>=t?null:a*e+i}function s(e,t,n,r,i,a,o){return null!==o&&255!==t[o]&&((e[4*o]===i[0]&&e[4*o+1]===i[1]&&e[4*o+2]===i[2]&&e[4*o+3]===i[3]||a>0&&Math.abs(e[4*o]-i[0])<=a&&Math.abs(e[4*o+1]-i[1])<=a&&Math.abs(e[4*o+2]-i[2])<=a&&Math.abs(e[4*o+3]-i[3])<=a)&&(t[o]=255,!0))}function l(e,t,n,i,a,l,c,u){i=Math.round(i),a=Math.round(a);var h=new Uint8Array(new ArrayBuffer(t*n));return function(e,t,n,i,a,l,c,u,h){var d=[e[4*(l*n+a)],e[4*(l*n+a)+1],e[4*(l*n+a)+2],e[4*(l*n+a)+3]];if(h){var p,g,f=[];for(f.push(l*n+a),t[l*n+a]=255;f.length;)s(e,t,0,0,d,c,g=o(n,i,p=f.pop(),-1,0))&&f.push(g),s(e,t,0,0,d,c,g=o(n,i,p,1,0))&&f.push(g),s(e,t,0,0,d,c,g=o(n,i,p,0,-1))&&f.push(g),s(e,t,0,0,d,c,g=o(n,i,p,0,1))&&f.push(g)}else for(var m=0;m<n*i;m++)s(e,t,0,0,d,c,m);if(0!==u){for(var v,y,x,b,B,w,C,S,k,L,T,E,M=0;M<n;M++)for(var I=0;I<i;I++)255===t[I*n+M]&&(v=M,y=M,x=I,b=I,B=255!==t[I*n+M-1],w=255!==t[(I-1)*n+M-1],C=255!==t[(I-1)*n+M],S=255!==t[(I-1)*n+M+1],k=255!==t[I*n+M+1],L=255!==t[(I+1)*n+M+1],T=255!==t[(I+1)*n+M],E=255!==t[(I+1)*n+M-1],B&&(v=M-u),B&&w&&C&&(v=M-u,x=I-u),C&&(x=Math.min(x,I-u)),C&&S&&k&&(x=Math.min(x,I-u),y=M+u),k&&(y=Math.max(y,M+1*u)),k&&L&&T&&(y=Math.max(y,M+1*u),b=Math.max(b,I+1*u)),T&&(b=Math.max(b,I+1*u)),T&&E&&B&&(v=Math.min(v,M-1*u),b=Math.max(b,I+1*u)),(B||w||C||S||k||L||T||E)&&r(t,n,Math.max(0,v),Math.max(0,x),Math.min(n-1,y),Math.min(i-1,b)));for(var A=0;A<n*i;A++)254===t[A]&&(t[A]=255)}}(e,h,t,n,i,a,l,c,u),{data:h}}t(e.exports,"floodFillBits",(function(){return l}))})),r.register("3ujzu",(function(e,n){t(e.exports,"ShapeTool",(function(){return a})),t(e.exports,"drawShape",(function(){return o}));var i=r("eWjiX");function a(e){var t,n,r;this.onDown=function(e,i,a){t=e,n=i,r=a},this.onMove=function(i,a){e.onShape(!1,t,n,i,a,r)},this.onUp=function(i,a){e.onShape(!0,t,n,i,a,r)}}function o(e,t){if(!["rect","ellipse","line"].includes(t.type))throw new Error("unknown shape");var n=Math.round(t.lineWidth),r=180*t.angleRad/Math.PI;e.save(),t.opacity&&(e.globalAlpha=t.opacity),t.isEraser&&(e.globalCompositeOperation="destination-out"),e.rotate(-t.angleRad),t.fillRgb?e.fillStyle=i.BB.ColorConverter.toRgbStr(t.fillRgb):t.strokeRgb&&(e.strokeStyle=i.BB.ColorConverter.toRgbStr(t.strokeRgb),e.lineWidth=n);var a=t.x1,o=t.y1,s=t.x2,l=t.y2;if(t.isAngleSnap){var c=i.BB.rotate(a,o,t.angleRad/Math.PI*180),u=i.BB.rotate(s,l,t.angleRad/Math.PI*180),h=i.BB.pointsToAngleDeg(c,u)+90,d=45*Math.round(h/45),p=i.BB.rotateAround({x:a,y:o},{x:s,y:l},d-h);s=p.x,l=p.y,(r+d)%90==0&&(Math.round((r-d)/90)%2==0?s=a:l=o)}var g,f,m=a,v=o,y=s-a,x=l-o;if("line"!==t.type&&t.isFixedRatio){var b=i.BB.rotate(t.x1,t.y1,t.angleRad/Math.PI*180),B=i.BB.rotate(t.x2,t.y2,t.angleRad/Math.PI*180),w=b.x,C=b.y,S=B.x-b.x,k=B.y-b.y;Math.abs(S)<Math.abs(k)?k=Math.abs(S)*(k<0?-1:1):S=Math.abs(k)*(S<0?-1:1),B.x=w+S,B.y=C+k,b=i.BB.rotate(b.x,b.y,-t.angleRad/Math.PI*180),B=i.BB.rotate(B.x,B.y,-t.angleRad/Math.PI*180),m=a=b.x,v=o=b.y,y=(s=B.x)-a,x=(l=B.y)-o}if(t.isOutwards&&(a=m-=y,o=v-=x,s=m+(y*=2),l=v+(x*=2)),"line"===t.type){var L=Math.round(a),T=Math.round(o),E=Math.round(s),M=Math.round(l),I=Math.floor(a),A=Math.floor(o),R=Math.floor(s),P=Math.floor(l);n%2==0?T===M?(g={x:I,y:T},f={x:R,y:M},I<R?f.x+=1:g.x+=1):L===E?(g={x:L,y:A},f={x:E,y:P},A<P?f.y+=1:g.y+=1):(g={x:a,y:o},f={x:s,y:l}):(g={x:I,y:A},f={x:R,y:P},A===P?(I<R?f.x+=1:g.x+=1,g.y+=.5,f.y+=.5):I===R?(A<P?f.y+=1:g.y+=1,g.x+=.5,f.x+=.5):(g.x=a,g.y=o,f.x=s,f.y=l)),g=i.BB.rotate(g.x,g.y,t.angleRad/Math.PI*180),f=i.BB.rotate(f.x,f.y,t.angleRad/Math.PI*180),e.beginPath(),e.moveTo(g.x,g.y),e.lineTo(f.x,f.y),e.stroke()}else if("rect"===t.type){var O=Math.floor(a),D=Math.floor(o),N=Math.floor(s),z=Math.floor(l);r%90==0?t.fillRgb?(a%1==0&&(a+=1),o%1==0&&(o+=1),s%1==0&&(s+=1),l%1==0&&(l+=1),g={x:a<s?O:N,y:o<l?D:z},(f={x:Math.ceil((a<s?s:a)-g.x),y:Math.ceil((o<l?l:o)-g.y)}).x=g.x+f.x,f.y=g.y+f.y):n%2==0?(g={x:O,y:D},f={x:N,y:z}):(g={x:O+.5,y:D+.5},f={x:N+.5,y:z+.5}):(g={x:a,y:o},f={x:s,y:l}),g=i.BB.rotate(g.x,g.y,t.angleRad/Math.PI*180),(f=i.BB.rotate(f.x,f.y,t.angleRad/Math.PI*180)).x=f.x-g.x,f.y=f.y-g.y,t.fillRgb?e.fillRect(g.x,g.y,f.x,f.y):e.strokeRect(g.x,g.y,f.x,f.y)}else g=i.BB.rotate(a,o,t.angleRad/Math.PI*180),f=i.BB.rotate(s,l,t.angleRad/Math.PI*180),m=g.x,v=g.y,y=f.x-g.x,x=f.y-g.y,e.beginPath(),e.ellipse(m+y/2,v+x/2,Math.abs(y/2),Math.abs(x/2),0,0,2*Math.PI),t.fillRgb?e.fill():e.stroke();e.restore()}})),r.register("h20yl",(function(e,n){t(e.exports,"renderText",(function(){return a}));var i=r("eWjiX");function a(e,t){for(var n=""===t.textStr?" ":t.textStr,r=i.BB.el({css:{position:"fixed",left:"0",top:"0",width:"100000px",fontSize:t.size+"px",lineHeight:t.lineHeight?t.lineHeight+"px":"default"}}),a=i.BB.el({parent:r,css:{display:"inline-block",textAlign:t.align?t.align:"left",fontFamily:t.font?t.font:"sans-serif",fontSize:t.size+"px",fontWeight:t.isBold?"bold":"normal",fontStyle:t.isItalic?"italic":"normal",lineHeight:t.lineHeight?t.lineHeight+"px":"default",opacity:"0",pointerEvents:"none"}}),o="",s=0;s<n.length;s++)"\n"!==n[s]?o+=n[s].replace("\t","    "):(a.appendChild(i.BB.el({tagName:"span",textContent:o,css:{whiteSpace:"pre"}})),o="",a.appendChild(i.BB.el({tagName:"br"})));a.appendChild(i.BB.el({tagName:"span",textContent:o,css:{whiteSpace:"pre"}})),document.body.appendChild(r);for(var l={x0:99999999,y0:99999999,x1:0,y1:0},c=0;c<a.children.length;c++){var u=a.children[c];l.x0=Math.min(l.x0,u.offsetLeft),l.y0=Math.min(l.y0,u.offsetTop),l.x1=Math.max(l.x1,u.offsetLeft+u.offsetWidth),l.y1=Math.max(l.y1,u.offsetTop+u.offsetHeight)}var h=e.getContext("2d");h.save();var d=[];t.isItalic&&d.push("italic"),t.isBold&&d.push("bold"),d.push(t.size+"px "+(t.font?t.font:"sans-serif")),h.font=d.join(" "),h.fillStyle=t.color?t.color:"#000";var p=t.x,g=t.y;"right"===t.align&&(p+=-l.x1+l.x0),"center"===t.align&&(p+=(-l.x1+l.x0)/2),h.translate(t.x,t.y),h.rotate(t.angleRad?-t.angleRad:0),h.translate(-t.x,-t.y),h.translate(p,g);for(var f=0;f<a.children.length;f++){var m=a.children[f];h.fillText(m.innerText,m.offsetLeft,m.offsetTop)}return t.isDebug?(h.lineWidth=1,h.strokeRect(0,.85*-t.size,l.x1,l.y1),h.restore(),h.fillRect(t.x-1,t.y-1,2,2)):h.restore(),document.body.removeChild(r),{x:p-t.x,y:g-t.y-.85*t.size,width:l.x1-l.x0,height:l.y1-l.y0}}})),r.register("aSJRf",(function(e,n){t(e.exports,"drawProject",(function(){return a}));var i=r("eWjiX");function a(e,t){var n=i.BB.canvas(Math.max(1,Math.round(e.width*t)),Math.max(1,Math.round(e.height*t))),r=n.getContext("2d");r.save(),t>1&&(r.imageSmoothingEnabled=!1);for(var a=0;a<e.layers.length;a++)0!==e.layers[a].opacity&&(r.globalAlpha=e.layers[a].opacity,r.globalCompositeOperation=e.layers[a].mixModeStr?e.layers[a].mixModeStr:"source-over",r.drawImage(e.layers[a].image,0,0,n.width,n.height));return r.restore(),n}})),r.register("bBcC4",(function(e,n){t(e.exports,"translateBlending",(function(){return a}));var i=r("1mH1z");function a(e){if(!e)return(0,i.LANG)("layers-blend-normal");var t={"source-over":"layers-blend-normal",darken:"layers-blend-darken",multiply:"layers-blend-multiply","color-burn":"layers-blend-color-burn",lighten:"layers-blend-lighten",screen:"layers-blend-screen","color-dodge":"layers-blend-color-dodge",overlay:"layers-blend-overlay","soft-light":"layers-blend-soft-light","hard-light":"layers-blend-hard-light",difference:"layers-blend-difference",exclusion:"layers-blend-exclusion",hue:"layers-blend-hue",saturation:"layers-blend-saturation",color:"layers-blend-color",luminosity:"layers-blend-luminosity"};if(!(e in t))throw new Error("unknown blend mode");return(0,i.LANG)(t[e])}})),r.register("7bo3M",(function(e,n){t(e.exports,"WorkspaceSvgOverlay",(function(){return s}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("eWjiX"),s=function(){"use strict";function e(t){(0,i.default)(this,e),this.rootElement=o.BB.createSvg({elementType:"svg",width:""+t.width,height:""+t.height}),o.BB.css(this.rootElement,{position:"absolute",left:"0",top:"0",pointerEvents:"none",userSelect:"none"}),this.brushCircleOuter=o.BB.createSvg({elementType:"circle",r:"10",stroke:"rgba(0,0,0,0.7)","stroke-width":"1",fill:"none"}),this.brushCircleInner=o.BB.createSvg({elementType:"circle",r:"9",stroke:"rgba(255,255,255,0.7)","stroke-width":"1",fill:"none"}),this.rootElement.append(this.brushCircleOuter,this.brushCircleInner),this.pickerPreviewBorder=o.BB.createSvg({elementType:"circle",r:"47",stroke:"black","stroke-width":"22",fill:"none"}),this.pickerPreviewBorder.style.opacity="0",this.pickerPreviewCol=o.BB.createSvg({elementType:"circle",r:"47",stroke:"black","stroke-width":"20",fill:"none"}),this.pickerPreviewCol.style.opacity="0",this.rootElement.append(this.pickerPreviewBorder,this.pickerPreviewCol),this.compassSize=30,this.compass=o.BB.createSvg({elementType:"g",transform:"translate("+t.width/2+", "+t.height/2+")"}),o.BB.css(this.compass,{transition:"opacity 0.25s ease-in-out",opacity:"0"}),this.compassInner=o.BB.createSvg({elementType:"g",transform:"rotate(45)"}),this.compassBaseCircle=o.BB.createSvg({elementType:"circle",fill:"rgba(0,0,0,0.9)",stroke:"none",cx:"0",cy:"0",r:""+this.compassSize}),this.compassLineCircle=o.BB.createSvg({elementType:"circle",fill:"none",stroke:"rgba(255,255,255,0.75)","stroke-width":"1",cx:"0",cy:"0",r:""+.9*this.compassSize}),this.compassUpperTriangle=o.BB.createSvg({elementType:"path",fill:"#f00",stroke:"none",d:"M -"+.25*this.compassSize+",0 "+.25*this.compassSize+",0 0,-"+.9*this.compassSize+" z"}),this.compassLowerTriangle=o.BB.createSvg({elementType:"path",fill:"#fff",stroke:"none",d:"M -"+.25*this.compassSize+",0 "+.25*this.compassSize+",0 0,"+.9*this.compassSize+" z"}),this.compassInner.append(this.compassBaseCircle,this.compassLineCircle,this.compassUpperTriangle,this.compassLowerTriangle),this.compass.append(this.compassInner),this.rootElement.append(this.compass)}return(0,a.default)(e,[{key:"getElement",value:function(){return this.rootElement}},{key:"setSize",value:function(e,t){this.rootElement.setAttribute("width",""+e),this.rootElement.setAttribute("height",""+t),this.compass.setAttribute("transform","translate("+e/2+", "+t/2+")")}},{key:"updateCursor",value:function(e){"x"in e&&(this.brushCircleOuter.setAttribute("cx",""+e.x),this.brushCircleInner.setAttribute("cx",""+e.x)),"y"in e&&(this.brushCircleOuter.setAttribute("cy",""+e.y),this.brushCircleInner.setAttribute("cy",""+e.y)),"radius"in e&&(this.brushCircleOuter.setAttribute("r",""+Math.max(0,e.radius)),this.brushCircleInner.setAttribute("r",""+Math.max(0,e.radius-1))),"isVisible"in e&&(this.brushCircleOuter.style.opacity=e.isVisible?"1":"0",this.brushCircleInner.style.opacity=e.isVisible?"1":"0")}},{key:"updateColorPreview",value:function(e){if("x"in e&&(this.pickerPreviewCol.setAttribute("cx",""+e.x),this.pickerPreviewBorder.setAttribute("cx",""+e.x)),"y"in e&&(this.pickerPreviewCol.setAttribute("cy",""+e.y),this.pickerPreviewBorder.setAttribute("cy",""+e.y)),"color"in e){this.pickerPreviewCol.setAttribute("stroke",o.BB.ColorConverter.toRgbStr(e.color));var t=o.BB.testIsWhiteBestContrast(e.color)?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)";this.pickerPreviewBorder.setAttribute("stroke",t)}"isVisible"in e&&(this.pickerPreviewCol.style.opacity=e.isVisible?"1":"0",this.pickerPreviewBorder.style.opacity=e.isVisible?"1":"0")}},{key:"updateCompass",value:function(e){"angleDeg"in e&&(this.compassInner.setAttribute("transform","rotate("+e.angleDeg+")"),this.compassLineCircle.style.opacity=e.angleDeg%90==0?"1":"0"),"isVisible"in e&&(this.compass.style.opacity=e.isVisible?"1":"0")}}]),e}()})),r.register("lV6Vy",(function(n,i){t(n.exports,"KlCanvasWorkspace",(function(){return y}));var a,o,s=r("gFgFC"),l=r("kiQ5H"),c=r("eWjiX"),u=r("7bo3M"),h=r("gWfkn"),d=r("hNEwm"),p=r("iOLNv"),g=r("3zTyb"),f=r("kFdtJ"),m=r("hrnUX"),v=.0625;(o=a||(a={}))[o.Draw=0]="Draw",o[o.Hand=1]="Hand",o[o.HandGrabbing=2]="HandGrabbing",o[o.Pick=3]="Pick",o[o.Zoom=4]="Zoom",o[o.Rotate=5]="Rotate",o[o.Rotating=6]="Rotating",o[o.Fill=7]="Fill",o[o.Text=8]="Text",o[o.Shape=9]="Shape";var y=function(){"use strict";function t(e){var n=this;(0,s.default)(this,t);var r=this;this.rootEl=c.BB.el({css:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0",cursor:"crosshair",userSelect:"none",colorScheme:"only light"}}),this.klCanvas=e.klCanvas,this.onViewChange=e.onViewChange,this.renderTargetCanvas=c.BB.canvas(e.width,e.height),this.renderTargetCtx=this.renderTargetCanvas.getContext("2d"),this.renderWidth=e.width,this.renderHeight=e.height,this.compositeCanvas=c.BB.canvas(1,1),this.compositeCtx=this.compositeCanvas.getContext("2d"),this.doResizeCanvas=!1,this.oldTransformObj=null,this.targetTransformObj={x:0,y:0,scale:1,angle:0},this.highResTransformObj={x:0,y:0,scale:1,angle:0},this.renderedTransformObj={x:null,y:null,scale:null,angle:null},this.cursorPos={x:0,y:0},this.usesCssCursor=!1,this.bgVisible=!0,this.transformIsDirty=!0,this.doAnimateTranslate=!0,this.svgOverlay=new(0,u.WorkspaceSvgOverlay)({width:e.width,height:e.height}),c.BB.css(this.renderTargetCanvas,{userSelect:"none",pointerEvents:"none"}),c.BB.createCheckerDataUrl(8,(function(e){n.renderTargetCanvas.style.background="url("+e+")"})),this.rootEl.appendChild(this.renderTargetCanvas),this.rootEl.appendChild(this.svgOverlay.getElement()),c.BB.addEventListener(this.rootEl,"touchend",(function(e){return e.preventDefault(),!1})),c.BB.addEventListener(this.rootEl,"contextmenu",(function(e){return e.preventDefault(),!1})),c.BB.addEventListener(this.rootEl,"dragstart",(function(e){return e.preventDefault(),!1})),this.emptyCanvas=c.BB.canvas(1,1),this.emptyCanvas.getContext("2d").fillRect(0,0,1,1),this.keyListener=new c.BB.KeyListener({onDown:function(e,t,r,i){if(!(m.KL.dialogCounter.get()>0||c.BB.isInputFocused(!0)||("alt"===e&&t.preventDefault(),i)))if(n.currentInputProcessor)n.currentInputProcessor.onKeyDown(e,t,r,i);else{if([a.Draw,a.Pick,a.Fill,a.Text,a.Shape].includes(n.globalMode)&&"space"===r)return n.currentInputProcessor=n.inputProcessorObj.spaceHand,void n.currentInputProcessor.onKeyDown(e,t,r,i);if([a.Draw,a.Hand,a.Fill,a.Text,a.Shape].includes(n.globalMode)&&"alt"===r)return n.currentInputProcessor=n.inputProcessorObj.altPicker,void n.currentInputProcessor.onKeyDown(e,t,r,i);if(["r","shift+r"].includes(r))return n.currentInputProcessor=n.inputProcessorObj.rotate,void n.currentInputProcessor.onKeyDown(e,t,r,i);if("z"===r)return n.currentInputProcessor=n.inputProcessorObj.zoom,void n.currentInputProcessor.onKeyDown(e,t,r,i)}},onUp:function(e,t,r){"alt"===e&&t.preventDefault(),n.currentInputProcessor&&n.currentInputProcessor.onKeyUp(e,t,r)}}),this.updateChangeListener(),this.currentMode=a.Draw,this.globalMode=a.Draw,this.renderTime=0,this.lastDrawEvent=null,this.linetoolProcessor=new c.BB.EventChain.LinetoolProcessor({onDraw:function(t){var r=function(){var e=n.getRenderedTransform(),t=c.BB.Matrix.getIdentity();return t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createScaleMatrix(1/e.scale)),t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createRotationMatrix(-e.angle)),t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createTranslationMatrix(-e.x,-e.y))};if("line"===t.type&&!n.lastDrawEvent){var i=r(),a=[t.x1,t.y1,0,1];return a=c.BB.Matrix.multiplyMatrixAndPoint(i,a),void(n.lastDrawEvent={x:a[0],y:a[1],pressure:t.pressure1})}if("x"in t||"x0"in t){var o=r();if("x"in t){var s=[t.x,t.y,0,1];s=c.BB.Matrix.multiplyMatrixAndPoint(o,s),t.x=s[0],t.y=s[1]}if("x0"in t){t.x0=n.lastDrawEvent.x,t.y0=n.lastDrawEvent.y,t.pressure0=n.lastDrawEvent.pressure;var l=[t.x1,t.y1,0,1];l=c.BB.Matrix.multiplyMatrixAndPoint(o,l),t.x1=l[0],t.y1=l[1],n.lastDrawEvent={x:t.x1,y:t.y1,pressure:t.pressure1}}}["down","move"].includes(t.type)&&(n.lastDrawEvent=t),e.onDraw(t)}}),this.pointer=null,this.isDrawing=!1,this.inputProcessorObj={draw:{onPointer:function(e){n.reqFrame(),n.updateCursor(a.Draw);var t=n.keyListener.getComboStr(),r={scale:n.highResTransformObj.scale};if(r.shiftIsPressed="shift"===t,r.pressure=e.pressure,r.isCoalesced=!!e.isCoalesced,"pointerdown"===e.type)n.isDrawing=!0,r.type="down";else{if(!e.button)return"pointerup"===e.type?(n.isDrawing=!1,r.type="up",n.linetoolProcessor.process(r),void n.resetInputProcessor()):void 0;r.type="move"}r.x=e.relX,r.y=e.relY,n.linetoolProcessor.process(r)},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},fill:{onPointer:function(t){if(n.reqFrame(),n.updateCursor(a.Fill),"pointerdown"===t.type){var r=n.workspaceToCanvasCoord({x:t.relX,y:t.relY});e.onFill(Math.floor(r.x),Math.floor(r.y))}else if("pointerup"===t.type)return void n.resetInputProcessor()},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},text:{onPointer:function(t){if(n.reqFrame(),n.updateCursor(a.Text),"pointerdown"===t.type){var r=n.workspaceToCanvasCoord({x:t.relX,y:t.relY});e.onText(Math.floor(r.x),Math.floor(r.y),n.renderedTransformObj.angle)}else if("pointerup"===t.type)return void n.resetInputProcessor()},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},shape:{onPointer:function(t){n.reqFrame(),n.updateCursor(a.Shape);var r=n.workspaceToCanvasCoord({x:t.relX,y:t.relY});"pointerdown"===t.type?(n.isDrawing=!0,e.onShape("down",r.x,r.y,n.renderedTransformObj.angle)):"pointermove"===t.type?e.onShape("move",r.x,r.y,n.renderedTransformObj.angle):"pointerup"===t.type&&(n.isDrawing=!1,e.onShape("up",r.x,r.y,n.renderedTransformObj.angle),n.resetInputProcessor())},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},hand:{onPointer:function(e){n.updateCursor(a.Hand),["left","middle"].includes(e.button)?(n.updateCursor(a.HandGrabbing),n.targetTransformObj.x+=e.dX,n.targetTransformObj.y+=e.dY,n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.doAnimateTranslate=!1,n.transformIsDirty=!0,n.reqFrame(!0)):"pointerup"===e.type&&n.resetInputProcessor()},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},spaceHand:{onPointer:function(e){n.updateCursor(a.Hand),["left","middle"].includes(e.button)&&(n.updateCursor(a.HandGrabbing),n.targetTransformObj.x+=e.dX,n.targetTransformObj.y+=e.dY,n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.doAnimateTranslate=!1,n.transformIsDirty=!0,n.reqFrame(!0))},onKeyDown:function(e,t,r,i){"space"!==r?n.resetInputProcessor():n.updateCursor(a.Hand)},onKeyUp:function(e,t,r){n.resetInputProcessor()}},zoom:{onPointer:function(e){if(n.updateCursor(a.Zoom),"left"===e.button&&!e.isCoalesced&&0!=e.dX){var t=e.pageX-e.relX,r=e.pageY-e.relY;n.internalZoomByStep(e.dX/175,e.downPageX-t,e.downPageY-r),n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.lastRenderedState=-1,n.reqFrame(),n.onViewChange({changed:["scale"],angle:n.targetTransformObj.angle,scale:n.targetTransformObj.scale})}},onKeyDown:function(e,t,r,i){"z"!==r?n.resetInputProcessor():n.updateCursor(a.Zoom)},onKeyUp:function(e,t,r){n.resetInputProcessor()}},picker:{onPointer:function(t){if(n.updateCursor(a.Pick),["left","right"].includes(t.button)&&!t.isCoalesced||"pointerup"===t.type){var r=n.workspaceToCanvasCoord({x:t.relX,y:t.relY}),i=n.klCanvas.getColorAt(r.x,r.y);e.onPick(i,"pointerup"===t.type),n.svgOverlay.updateColorPreview({x:t.relX,y:t.relY,color:i,isVisible:"pointerup"!==t.type}),"pointerup"===t.type&&n.resetInputProcessor()}},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},altPicker:{onPointer:function(t){if(n.updateCursor(a.Pick),["left","right"].includes(t.button)&&!t.isCoalesced||"pointerup"===t.type){var r=n.workspaceToCanvasCoord({x:t.relX,y:t.relY}),i=n.klCanvas.getColorAt(r.x,r.y);e.onPick(i,"pointerup"===t.type),n.svgOverlay.updateColorPreview({x:t.relX,y:t.relY,color:i,isVisible:"pointerup"!==t.type})}},onKeyDown:function(e,t,r,i){"alt"!==r?n.resetInputProcessor():n.updateCursor(a.Pick)},onKeyUp:function(e,t,r){n.resetInputProcessor()}},rotate:{onPointer:function(e){if(n.updateCursor("left"===e.button?a.Rotating:a.Rotate),"pointerdown"===e.type&&"left"===e.button)n.oldTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj));else if("left"===e.button&&!e.isCoalesced&&n.oldTransformObj){var t=e.pageX-e.relX,r=e.pageY-e.relY,i={x:n.renderWidth/2,y:n.renderHeight/2},o=c.BB.Vec2.angle(i,{x:e.downPageX-t,y:e.downPageY-r}),s=c.BB.Vec2.angle(i,{x:e.pageX-t,y:e.pageY-r})-o;n.targetTransformObj=JSON.parse(JSON.stringify(n.oldTransformObj)),n.targetTransformObj.angle+=s,n.keyListener.isPressed("shift")&&(n.targetTransformObj.angle=Math.round(n.targetTransformObj.angle/Math.PI*8)*Math.PI/8,s=n.targetTransformObj.angle-n.oldTransformObj.angle),n.targetTransformObj.angle=n.minimizeAngleRad(n.targetTransformObj.angle);var l=c.BB.Matrix.getIdentity();l=c.BB.Matrix.multiplyMatrices(l,c.BB.Matrix.createTranslationMatrix(i.x,i.y)),l=c.BB.Matrix.multiplyMatrices(l,c.BB.Matrix.createRotationMatrix(s)),l=c.BB.Matrix.multiplyMatrices(l,c.BB.Matrix.createTranslationMatrix(-i.x,-i.y));var u=[n.targetTransformObj.x,n.targetTransformObj.y,0,1];u=c.BB.Matrix.multiplyMatrixAndPoint(l,u),n.targetTransformObj.x=u[0],n.targetTransformObj.y=u[1],n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.transformIsDirty=!0,n.lastRenderedState=-1,n.reqFrame(),n.onViewChange({changed:["angle"],scale:n.targetTransformObj.scale,angle:n.targetTransformObj.angle})}},onKeyDown:function(e,t,r,i){["r","r+shift","shift+r","r+left","r+right","r+left+right","r+right+left","r+up"].includes(r)?n.updateCursor(a.Rotate):n.resetInputProcessor()},onKeyUp:function(e,t,r){var i=n.keyListener.getComboStr();["r","r+shift","shift+r","r+left","r+right","r+left+right","r+right+left","r+up"].includes(i)?n.updateCursor(a.Rotate):n.resetInputProcessor()}}},this.currentInputProcessor=null,this.angleIsExtraSticky=!1,this.pinchZoomer=new c.BB.EventChain.PinchZoomer({onPinch:function(e){if("move"===e.type){n.oldTransformObj||(n.oldTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.angleIsExtraSticky=n.targetTransformObj.angle%(Math.PI/2)==0),n.targetTransformObj=JSON.parse(JSON.stringify(n.oldTransformObj)),e.scale=Math.max(v,Math.min(64,n.targetTransformObj.scale*e.scale))/n.targetTransformObj.scale,n.targetTransformObj.scale*=e.scale,n.targetTransformObj.angle+=e.angleRad,n.targetTransformObj.angle=n.minimizeAngleRad(n.snapAngleRad(n.targetTransformObj.angle,90,n.angleIsExtraSticky?12:4)),n.targetTransformObj.angle%(Math.PI/2)!=0&&(n.angleIsExtraSticky=!1),e.angleRad=n.targetTransformObj.angle-n.oldTransformObj.angle;var t=c.BB.Matrix.getIdentity();t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createTranslationMatrix(e.relX,e.relY)),t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createScaleMatrix(e.scale)),t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createRotationMatrix(e.angleRad)),t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createTranslationMatrix(-e.relX,-e.relY)),t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createTranslationMatrix(e.relX-e.downRelX,e.relY-e.downRelY));var r=[n.targetTransformObj.x,n.targetTransformObj.y,0,1];r=c.BB.Matrix.multiplyMatrixAndPoint(t,r),n.targetTransformObj.x=r[0],n.targetTransformObj.y=r[1],n.highResTransformObj=c.BB.copyObj(n.targetTransformObj),n.onViewChange({changed:["scale","angle"],scale:n.targetTransformObj.scale,angle:n.targetTransformObj.angle}),n.reqFrame(),n.transformIsDirty=!0,n.lastRenderedState=-1}else"end"===e.type&&(n.oldTransformObj=null)}});var i=function(){var e=JSON.parse(JSON.stringify(n.targetTransformObj));r.fitView(),n.lastRenderedState=-1,n.reqFrame(),e.scale===n.targetTransformObj.scale&&e.angle===n.targetTransformObj.angle||n.onViewChange({changed:["scale","angle"],angle:n.targetTransformObj.angle,scale:n.targetTransformObj.scale})};this.mainDoubleTapper=new c.BB.EventChain.DoubleTapper({onDoubleTap:i}),this.middleDoubleTapper=new c.BB.EventChain.DoubleTapper({onDoubleTap:i}),this.middleDoubleTapper.setAllowedButtonArr(["middle"]),this.twoFingerTap=new c.BB.EventChain.NFingerTapper({fingers:2,onTap:function(){e.onUndo()}}),this.threeFingerTap=new c.BB.EventChain.NFingerTapper({fingers:3,onTap:function(){e.onRedo()}}),this.pointerEventChain=new c.BB.EventChain.EventChain({chainArr:[this.twoFingerTap,this.threeFingerTap,this.mainDoubleTapper,this.middleDoubleTapper,this.pinchZoomer,new c.BB.EventChain.OnePointerLimiter,new c.BB.EventChain.CoalescedExploder]}),this.pointerEventChain.setChainOut((function(e){if(n.cursorPos.x=e.relX,n.cursorPos.y=e.relY,"pointerup"===e.type&&"touch"===e.pointerType?(n.pointer=null,n.lastRenderedState=-1,n.reqFrame()):(n.pointer||(n.pointer={x:0,y:0}),n.pointer.x=e.relX,n.pointer.y=e.relY),n.currentInputProcessor)n.currentInputProcessor.onPointer(e);else{var t=n.keyListener.getComboStr();n.globalMode===a.Draw?["","shift","ctrl"].includes(t)&&"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.draw,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(a.Draw),n.reqFrame()):n.globalMode===a.Hand?"pointerdown"===e.type&&["left","middle"].includes(e.button)?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):n.updateCursor(a.Hand):n.globalMode===a.Pick?"pointerdown"===e.type&&["left","right"].includes(e.button)?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):n.updateCursor(a.Pick):n.globalMode===a.Fill?"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.fill,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(a.Fill),n.reqFrame()):n.globalMode===a.Text?"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.text,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(a.Text),n.reqFrame()):n.globalMode===a.Shape&&(["","shift","ctrl"].includes(t)&&"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.shape,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(a.Shape),n.reqFrame()))}})),c.BB.addEventListener(this.rootEl,"wheel",(function(e){e.preventDefault()})),setTimeout((function(){n.pointerListener=new c.BB.PointerListener({target:n.rootEl,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&"middle"===e.button)try{e.eventPreventDefault()}catch(e){}"pointerdown"===e.type&&c.BB.unfocusAnyInput(),n.pointerEventChain.chainIn(e)},onWheel:function(e){n.isDrawing||(n.reqFrame(),n.internalZoomByStep(-e.deltaY/(n.keyListener.isPressed("shift")?8:2),e.relX,e.relY)&&n.onViewChange({changed:["scale"],angle:n.targetTransformObj.angle,scale:n.targetTransformObj.scale}),n.lastRenderedState=-1)},onEnterLeave:function(e){e||n.isDrawing||(n.pointer=null,n.lastRenderedState=-1)},maxPointers:4})}),1),this.brushRadius=1,this.animationFrameRequested=!1,this.lastRenderedState=-2,this.lastRenderTime=performance.now(),window.requestAnimationFrame((function(){return n.updateLoop()})),this.resetView()}return(0,l.default)(t,[{key:"getRenderedTransform",value:function(){var e=this.renderedTransformObj;return e.x=this.highResTransformObj.x,e.y=this.highResTransformObj.y,e.scale=this.highResTransformObj.scale,e.angle=this.highResTransformObj.angle,e.angle%(Math.PI/2)==0&&e.scale%1==0&&(e.x=Math.round(e.x),e.y=Math.round(e.y)),e}},{key:"updateChangeListener",value:function(){var e=this;this.klCanvas.addChangeListener((function(){e.lastRenderedState=-1,e.reqFrame()}))}},{key:"updateCursor",value:function(t,n){if(t!==this.currentMode||n){var r=this.currentMode;if(this.currentMode=t,this.lastRenderedState=-1,this.currentMode===a.Draw?this.rootEl.style.cursor="crosshair":this.currentMode===a.Hand?this.rootEl.style.cursor="grab":this.currentMode===a.HandGrabbing?this.rootEl.style.cursor="grabbing":this.currentMode===a.Pick?this.rootEl.style.cursor="url('"+e(d)+"') 0 15, crosshair":this.currentMode===a.Zoom?this.rootEl.style.cursor="url('"+e(p)+"') 7 7, zoom-in":this.currentMode===a.Rotate?this.rootEl.style.cursor="grab":this.currentMode===a.Rotating?this.rootEl.style.cursor="grabbing":this.currentMode===a.Fill?this.rootEl.style.cursor="url('"+e(g)+"') 1 12, crosshair":this.currentMode===a.Text?this.rootEl.style.cursor="url('"+e(f)+"') 1 12, crosshair":this.currentMode===a.Shape&&(this.rootEl.style.cursor="crosshair"),[a.Draw,a.Pick,a.Fill,a.Text,a.Shape].includes(this.globalMode)){var i=[a.Hand,a.HandGrabbing].includes(r),o=[a.Hand,a.HandGrabbing].includes(this.currentMode);!i&&o&&this.mainDoubleTapper.setAllowedPointerTypeArr(["mouse","pen","touch"]),i&&!o&&this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])}this.currentMode!==a.Pick&&this.svgOverlay.updateColorPreview({isVisible:!1})}}},{key:"internalZoomByStep",value:function(e,t,n){var r=Math.log2(this.targetTransformObj.scale)/Math.abs(e);r+=e>0?1:-1,r=Math.round(r),r*=Math.abs(e);var i=Math.max(v,Math.min(64,Math.pow(2,r)));if(i===this.targetTransformObj.scale)return!1;var a=i/this.targetTransformObj.scale;this.targetTransformObj.scale=i;var o=c.BB.Matrix.getIdentity();o=c.BB.Matrix.multiplyMatrices(o,c.BB.Matrix.createTranslationMatrix(t,n)),o=c.BB.Matrix.multiplyMatrices(o,c.BB.Matrix.createScaleMatrix(a)),o=c.BB.Matrix.multiplyMatrices(o,c.BB.Matrix.createTranslationMatrix(-t,-n));var s=[this.targetTransformObj.x,this.targetTransformObj.y,0,1];return s=c.BB.Matrix.multiplyMatrixAndPoint(o,s),this.targetTransformObj.x=s[0],this.targetTransformObj.y=s[1],this.transformIsDirty=!0,!0}},{key:"mixTransformObj",value:function(e,t,n){if(e.angle===t.angle)return e.scale=c.BB.mix(e.scale,t.scale,n),e.x=c.BB.mix(e.x,t.x,n),e.y=c.BB.mix(e.y,t.y,n),void(e.angle=c.BB.mix(e.angle,t.angle,n));var r=this.klCanvas.getWidth(),i=this.klCanvas.getHeight(),a=this.canvasToWorkspaceCoord({x:r/2,y:i/2},e),o=this.canvasToWorkspaceCoord({x:r/2,y:i/2},t);e.x=c.BB.mix(a.x,o.x,n),e.y=c.BB.mix(a.y,o.y,n),e.scale=c.BB.mix(e.scale,t.scale,n),e.angle=c.BB.mix(e.angle,t.angle,n);var s=this.canvasToWorkspaceCoord({x:-r/2,y:-i/2},e);e.x=s.x,e.y=s.y}},{key:"render",value:function(){this.doResizeCanvas&&(this.doResizeCanvas=!1,this.renderTargetCanvas.width=this.renderWidth,this.renderTargetCanvas.height=this.renderHeight),this.renderContext(this.renderTargetCtx)}},{key:"testBgVisible",value:function(){var e=[[0,0],[this.renderWidth,0],[this.renderWidth,this.renderHeight],[0,this.renderHeight]],t=this.getRenderedTransform(),n=c.BB.Matrix.getIdentity();n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createScaleMatrix(1/t.scale)),n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createRotationMatrix(-t.angle)),n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createTranslationMatrix(-t.x,-t.y));for(var r=0;r<e.length;r++){var i=[e[r][0],e[r][1],0,1];if(!(0<=(i=c.BB.Matrix.multiplyMatrixAndPoint(n,i))[0]&&i[0]<=this.klCanvas.getWidth()&&0<=i[1]&&i[1]<=this.klCanvas.getHeight()))return!0}return!1}},{key:"renderContext",value:function(e){var t=this.klCanvas.getWidth(),n=this.klCanvas.getHeight(),r=this.getRenderedTransform();if(r.scale>=4||1===r.scale&&0===r.angle?e.imageSmoothingEnabled=!1:(e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="low"),e.save(),this.bgVisible?(e.fillStyle="rgb(158,158,158)",e.fillRect(0,0,this.renderWidth,this.renderHeight)):e.clearRect(0,0,this.renderWidth,this.renderHeight),this.bgVisible){e.save(),e.translate(r.x,r.y),e.scale(r.scale,r.scale),e.rotate(r.angle),e.imageSmoothingEnabled=!1;e.globalAlpha=.2,e.drawImage(this.emptyCanvas,-1/r.scale,-1/r.scale,t+2/r.scale,n+2/r.scale),e.globalAlpha=1,e.globalCompositeOperation="destination-out",e.drawImage(this.emptyCanvas,0,0,t,n),e.restore()}e.translate(r.x,r.y),e.scale(r.scale,r.scale),e.rotate(r.angle);for(var i=this.klCanvas.getLayersFast(),o=0;o<i.length;o++)i[o].opacity>0&&(e.globalAlpha=i[o].opacity,e.globalCompositeOperation=i[o].mixModeStr,i[o].canvas.compositeObj?(this.compositeCanvas.width!==i[o].canvas.width||this.compositeCanvas.height!==i[o].canvas.height?(this.compositeCanvas.width=i[o].canvas.width,this.compositeCanvas.height=i[o].canvas.height):this.compositeCtx.clearRect(0,0,this.compositeCanvas.width,this.compositeCanvas.height),this.compositeCtx.drawImage(i[o].canvas,0,0),i[o].canvas.compositeObj.draw(this.compositeCtx),e.drawImage(this.compositeCanvas,0,0,t,n)):e.drawImage(i[o].canvas,0,0,t,n));e.globalAlpha=1,e.restore(),a.Rotate===this.currentMode||a.Rotating===this.currentMode?this.svgOverlay.updateCompass({isVisible:!0,angleDeg:r.angle/Math.PI*180}):this.svgOverlay.updateCompass({isVisible:!1})}},{key:"workspaceToCanvasCoord",value:function(e){var t=this.getRenderedTransform(),n=c.BB.Matrix.getIdentity();n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createScaleMatrix(1/t.scale)),n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createRotationMatrix(-t.angle)),n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createTranslationMatrix(-t.x,-t.y));var r=[e.x,e.y,0,1];return{x:(r=c.BB.Matrix.multiplyMatrixAndPoint(n,r))[0],y:r[1]}}},{key:"canvasToWorkspaceCoord",value:function(e,t){var n=c.BB.Matrix.getIdentity();n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createTranslationMatrix(t.x,t.y)),n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createRotationMatrix(t.angle)),n=c.BB.Matrix.multiplyMatrices(n,c.BB.Matrix.createScaleMatrix(t.scale));var r=[e.x,e.y,0,1];return{x:(r=c.BB.Matrix.multiplyMatrixAndPoint(n,r))[0],y:r[1]}}},{key:"snapAngleRad",value:function(e,t,n){var r=180*e/Math.PI,i=Math.abs(r%t);return Math.min(i,t-i)<=n&&(r=Math.round(r/t)*t),r/180*Math.PI}},{key:"minimizeAngleRad",value:function(e){return(e%=2*Math.PI)>Math.PI?e-=2*Math.PI:e<-Math.PI&&(e+=2*Math.PI),e}},{key:"resetInputProcessor",value:function(){this.currentInputProcessor=null,this.updateCursor(this.globalMode),this.reqFrame(!0)}},{key:"reqFrame",value:function(e){this.animationFrameRequested=!0,e&&(this.lastRenderedState=-1)}},{key:"updateLoop",value:function(){var e=this;window.requestAnimationFrame((function(){return e.updateLoop()}));var t=h.klHistory.getState(),n=this.lastRenderedState<t,r=performance.now(),i=60*(r-this.lastRenderTime)/1e3;this.lastRenderTime=r,(this.animationFrameRequested||n)&&(this.animationFrameRequested=!1,this.checkChange(i))}},{key:"checkChange",value:function(e){var t=h.klHistory.getState(),n=this.lastRenderedState<t||this.highResTransformObj.scale!==this.targetTransformObj.scale||this.highResTransformObj.x!==this.targetTransformObj.x||this.highResTransformObj.y!==this.targetTransformObj.y;if(!this.doAnimateTranslate&&(this.highResTransformObj.scale===this.targetTransformObj.scale||Math.abs(this.highResTransformObj.scale-this.targetTransformObj.scale)<.008*this.targetTransformObj.scale))this.highResTransformObj.scale=this.targetTransformObj.scale,this.highResTransformObj.x=this.targetTransformObj.x,this.highResTransformObj.y=this.targetTransformObj.y,this.highResTransformObj.angle=this.targetTransformObj.angle,this.transformIsDirty&&(this.transformIsDirty=!1,this.bgVisible=this.testBgVisible()),this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale});else if((this.highResTransformObj.x===this.targetTransformObj.x||Math.abs(this.highResTransformObj.x-this.targetTransformObj.x)<.5)&&(this.highResTransformObj.y===this.targetTransformObj.y||Math.abs(this.highResTransformObj.y-this.targetTransformObj.y)<.5)&&(this.highResTransformObj.scale===this.targetTransformObj.scale||Math.abs(this.highResTransformObj.scale-this.targetTransformObj.scale)<.008*this.targetTransformObj.scale))this.highResTransformObj.scale=this.targetTransformObj.scale,this.highResTransformObj.x=this.targetTransformObj.x,this.highResTransformObj.y=this.targetTransformObj.y,this.highResTransformObj.angle=this.targetTransformObj.angle,this.doAnimateTranslate=!1,this.transformIsDirty&&(this.transformIsDirty=!1,this.bgVisible=this.testBgVisible()),this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale});else{this.reqFrame();var r=Math.min(1,.3*e);this.mixTransformObj(this.highResTransformObj,this.targetTransformObj,r),this.bgVisible=!0,this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale})}if(this.pointer&&this.currentMode==a.Draw&&!this.usesCssCursor?this.svgOverlay.updateCursor({x:this.pointer.x,y:this.pointer.y,isVisible:!0}):this.svgOverlay.updateCursor({isVisible:!1}),n){this.lastRenderedState=t;var i=performance.now();this.render(),this.renderTime=c.BB.mix(this.renderTime,performance.now()-i,.05)}}},{key:"getElement",value:function(){return this.rootEl}},{key:"setCanvas",value:function(e){this.klCanvas=e,this.lastDrawEvent=null,this.resetView(),this.updateChangeListener(),this.lastRenderedState=-1,this.reqFrame()}},{key:"setSize",value:function(e,t){var n=this.renderWidth,r=this.renderHeight;e===n&&t===r||(this.doResizeCanvas=!0,this.renderWidth=e,this.renderHeight=t,this.svgOverlay.setSize(e,t),this.targetTransformObj.x+=(e-n)/2,this.targetTransformObj.y+=(t-r)/2,this.highResTransformObj.x=this.targetTransformObj.x,this.highResTransformObj.y=this.targetTransformObj.y,this.bgVisible=this.testBgVisible(),this.lastRenderedState=-1,this.reqFrame())}},{key:"setMode",value:function(e){"draw"===e&&(this.globalMode=a.Draw,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"fill"===e&&(this.globalMode=a.Fill,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"text"===e&&(this.globalMode=a.Text,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"shape"===e&&(this.globalMode=a.Shape,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"hand"===e&&(this.globalMode=a.Hand,this.mainDoubleTapper.setAllowedPointerTypeArr(["mouse","pen","touch"])),"pick"===e&&(this.globalMode=a.Pick,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"]))}},{key:"setEnabled",value:function(e){}},{key:"setCursorSize",value:function(e){var t=this;this.brushRadius=e/2,this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale}),null===this.pointer&&(clearTimeout(this.hideBrushCursorTimeout),this.svgOverlay.updateCursor({x:this.renderWidth/2,y:this.renderHeight/2,isVisible:!0}),this.hideBrushCursorTimeout=setTimeout((function(){null===t.pointer&&t.svgOverlay.updateCursor({isVisible:!1})}),500))}},{key:"zoomByStep",value:function(e){this.internalZoomByStep(e,this.renderWidth/2,this.renderHeight/2)&&(this.lastRenderedState=-1,this.reqFrame(),this.onViewChange({changed:["scale"],angle:this.targetTransformObj.angle,scale:this.targetTransformObj.scale}))}},{key:"resetView",value:function(e){this.targetTransformObj.scale=1,this.targetTransformObj.angle=0,this.targetTransformObj.x=(this.renderWidth-this.klCanvas.getWidth())/2,this.targetTransformObj.y=(this.renderHeight-this.klCanvas.getHeight())/2,e?(this.doAnimateTranslate=!0,this.transformIsDirty=!0):this.highResTransformObj=JSON.parse(JSON.stringify(this.targetTransformObj)),this.bgVisible=this.testBgVisible(),this.reqFrame(),e&&this.onViewChange({changed:["scale","angle"],scale:this.targetTransformObj.scale,angle:this.targetTransformObj.angle})}},{key:"fitView",value:function(){this.targetTransformObj.angle=this.snapAngleRad(this.targetTransformObj.angle,90,90);var e=[[0,0],[this.klCanvas.getWidth(),0],[this.klCanvas.getWidth(),this.klCanvas.getHeight()],[0,this.klCanvas.getHeight()],[this.klCanvas.getWidth()/2,this.klCanvas.getHeight()/2]],t=c.BB.Matrix.getIdentity();t=c.BB.Matrix.multiplyMatrices(t,c.BB.Matrix.createRotationMatrix(this.targetTransformObj.angle));for(var n=0;n<e.length;n++){var r=[e[n][0],e[n][1],0,1];r=c.BB.Matrix.multiplyMatrixAndPoint(t,r),e[n][0]=r[0],e[n][1]=r[1]}for(var i={x0:null,y0:null,x1:null,y1:null},a=0;a<e.length;a++)(null===i.x0||e[a][0]<i.x0)&&(i.x0=e[a][0]),(null===i.y0||e[a][1]<i.y0)&&(i.y0=e[a][1]),(null===i.x1||e[a][0]>i.x1)&&(i.x1=e[a][0]),(null===i.y1||e[a][1]>i.y1)&&(i.y1=e[a][1]);var o=i.x1-i.x0,s=i.y1-i.y0,l=c.BB.fitInto(o,s,this.renderWidth-40,this.renderHeight-40,1).width/o;this.targetTransformObj.x=this.renderWidth/2-(e[4][0]-e[0][0])*l,this.targetTransformObj.y=this.renderHeight/2-(e[4][1]-e[0][1])*l,this.targetTransformObj.scale=l,this.doAnimateTranslate=!0,this.transformIsDirty=!0,this.reqFrame(),this.onViewChange({changed:["scale","angle"],scale:this.targetTransformObj.scale,angle:this.targetTransformObj.angle})}},{key:"setAngle",value:function(e,t){var n={x:this.renderWidth/2,y:this.renderHeight/2},r=this.targetTransformObj.angle,i=e/180*Math.PI;t?this.targetTransformObj.angle+=i:this.targetTransformObj.angle=i,this.targetTransformObj.angle=this.minimizeAngleRad(this.snapAngleRad(this.targetTransformObj.angle,90,4));var a=c.BB.Matrix.getIdentity();a=c.BB.Matrix.multiplyMatrices(a,c.BB.Matrix.createTranslationMatrix(n.x,n.y)),a=c.BB.Matrix.multiplyMatrices(a,c.BB.Matrix.createRotationMatrix(this.targetTransformObj.angle-r)),a=c.BB.Matrix.multiplyMatrices(a,c.BB.Matrix.createTranslationMatrix(-n.x,-n.y));var o=[this.targetTransformObj.x,this.targetTransformObj.y,0,1];o=c.BB.Matrix.multiplyMatrixAndPoint(a,o),this.targetTransformObj.x=o[0],this.targetTransformObj.y=o[1],this.highResTransformObj=JSON.parse(JSON.stringify(this.targetTransformObj)),this.transformIsDirty=!0,this.reqFrame(!0)}},{key:"translateView",value:function(e,t){this.targetTransformObj.x+=40*e,this.targetTransformObj.y+=40*t,this.transformIsDirty=!0,this.doAnimateTranslate=!0,this.reqFrame(!0)}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"getScale",value:function(){return this.targetTransformObj.scale}},{key:"getAngleDeg",value:function(){return 180*this.targetTransformObj.angle/Math.PI}},{key:"getMaxScale",value:function(){return 64}},{key:"getMinScale",value:function(){return v}},{key:"requestFrame",value:function(){this.lastRenderedState=-1,this.reqFrame()}},{key:"setLastDrawEvent",value:function(e,t,n){null!==e?(this.lastDrawEvent||(this.lastDrawEvent={x:0,y:0,pressure:0}),this.lastDrawEvent.x=e,this.lastDrawEvent.y=t,this.lastDrawEvent.pressure=n):this.lastDrawEvent=null}}]),t}()})),r.register("hNEwm",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("1dLwT")})),r.register("iOLNv",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("9wZxU")})),r.register("3zTyb",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("hQSEH")})),r.register("kFdtJ",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("916ZI")})),r.register("i5nyl",(function(e,n){t(e.exports,"KlCanvasPreview",(function(){return a}));var i=r("eWjiX");function a(e){var t=function(){s.save(),s.clearRect(0,0,o.width,o.height);for(var t=0;t<e.layers.length;t++)s.globalAlpha=e.layers[t].opacity,s.globalCompositeOperation=e.layers[t].mixModeStr,o.width>e.layers[t].image.width&&(s.imageSmoothingEnabled=!1),s.drawImage(e.layers[t].image,0,0,o.width,o.height);s.restore()},n=e.width/e.layers[0].image.width,r=n>1?e.layers[0].image.width:e.width,a=n>1?e.layers[0].image.height:e.height,o=i.BB.canvas(r,a);o.style.backgroundImage="url("+i.BB.createCheckerDataUrl(8)+")";var s=o.getContext("2d");i.BB.css(o,{width:"100%",height:"100%",imageRendering:n>1?"pixelated":null}),setTimeout(t,0),this.getElement=function(){return o},this.render=function(){t()}}})),r.register("cNhNm",(function(n,i){t(n.exports,"FreeTransform",(function(){return g}));var a=r("gFgFC"),o=r("kiQ5H"),s=r("7U0Ew"),l=r("eWjiX"),c=r("lQMok");function u(e){if(Math.abs(e.angleDeg)%90==0){e.width=Math.round(e.width),e.height=Math.round(e.height);var t=Math.abs(e.angleDeg-90)%180==0;e.x=(t?e.height:e.width)%2==0?Math.round(e.x):Math.round(e.x-.5)+.5,e.y=(t?e.width:e.height)%2==0?Math.round(e.y):Math.round(e.y-.5)+.5}}function h(e){return{x:e.x,y:e.y,width:e.width,height:e.height,angleDeg:e.angleDeg}}function d(e,t,n){var r,i;r=e-n.x,i=t-n.y;var a=l.BB.rotateAround({x:0,y:0},{x:r,y:i},-n.angleDeg);return{x:r=a.x,y:i=a.y}}function p(e,t,n){var r=l.BB.rotateAround({x:0,y:0},{x:e,y:t},n.angleDeg);return{x:r.x+n.x,y:r.y+n.y}}var g=function(){"use strict";function t(n){var r=this;(0,a.default)(this,t);(0,s.default)(this,"scaled",{x:0,y:0,width:0,height:0,corners:[{x:0,y:0}]}),(0,s.default)(this,"minSnapDist",7),(0,s.default)(this,"cornerCursors",["nw","n","ne","e","se","s","sw","w"]),(0,s.default)(this,"gripSize",14),(0,s.default)(this,"edgeSize",10),(0,s.default)(this,"corners",[]),(0,s.default)(this,"edges",[]),this.transform={x:n.x,y:n.y,width:n.width,height:n.height,angleDeg:n.angleDeg},this.isConstrained=!!n.isConstrained,this.snapX=n.snapX,this.snapY=n.snapY,this.callback=n.callback,this.scale=n.scale,this.snappingEnabled=!0,this.ratio=this.transform.width/this.transform.height,this.rootEl=l.BB.el({className:"kl-free-transform",css:{userSelect:"none"}}),this.transEl=l.BB.el({parent:this.rootEl,css:{position:"absolute"}}),this.boundsEl=l.BB.el({css:{position:"absolute",cursor:"move",boxShadow:"rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px"}});var i={x:0,y:0};this.keyListener=new l.BB.KeyListener({});var o,h={x:0,y:0};this.boundsPointerListener=new l.BB.PointerListener({target:this.boundsEl,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointerdown"===e.type&&(h={x:r.transform.x,y:r.transform.y}),"pointermove"===e.type&&"left"===e.button){var t;r.transform.x=h.x+(e.pageX-e.downPageX)/r.scale,r.transform.y=h.y+(e.pageY-e.downPageY)/r.scale;var n={};if(r.snappingEnabled){var i,a;for(i=0;i<r.snapX.length;i++)(t=Math.abs(r.transform.x-r.snapX[i]))<r.minSnapDist/r.scale&&(!n.x||t<n.distX)&&(n.x=r.snapX[i],n.distX=t);for(i=0;i<r.snapY.length;i++)(t=Math.abs(r.transform.y-r.snapY[i]))<r.minSnapDist/r.scale&&(!n.y||t<n.distY)&&(n.y=r.snapY[i],n.distY=t);for(i=0;i<4;i++){a=p(r.corners[i].x,r.corners[i].y,r.transform);var o=void 0;for(o=0;o<r.snapX.length;o++)(t=Math.abs(a.x-r.snapX[o]))<r.minSnapDist/r.scale&&(!n.x||t<n.distX)&&(n.x=r.snapX[o]-(a.x-r.transform.x),n.distX=t);for(o=0;o<r.snapY.length;o++)(t=Math.abs(a.y-r.snapY[o]))<r.minSnapDist/r.scale&&(!n.y||t<n.distY)&&(n.y=r.snapY[o]-(a.y-r.transform.y),n.distY=t)}}if("shift"===r.keyListener.getComboStr()){var s=l.BB.projectPointOnLine({x:0,y:h.y},{x:10,y:h.y},{x:r.transform.x,y:r.transform.y}),c=l.BB.dist(s.x,s.y,r.transform.x,r.transform.y);(n={}).x=s.x,n.y=s.y,n.distX=c,n.distY=c,s=l.BB.projectPointOnLine({x:h.x,y:0},{x:h.x,y:10},{x:r.transform.x,y:r.transform.y}),(c=l.BB.dist(s.x,s.y,r.transform.x,r.transform.y))<n.distX&&(n.x=s.x,n.y=s.y,n.distX=c,n.distY=c),s=l.BB.projectPointOnLine({x:h.x,y:h.y},{x:h.x+1,y:h.y+1},{x:r.transform.x,y:r.transform.y}),(c=l.BB.dist(s.x,s.y,r.transform.x,r.transform.y))<n.distX&&(n.x=s.x,n.y=s.y,n.distX=c,n.distY=c),s=l.BB.projectPointOnLine({x:h.x,y:h.y},{x:h.x+1,y:h.y-1},{x:r.transform.x,y:r.transform.y}),(c=l.BB.dist(s.x,s.y,r.transform.x,r.transform.y))<n.distX&&(n.x=s.x,n.y=s.y,n.distX=c,n.distY=c)}null!=n.x&&(r.transform.x=n.x),null!=n.y&&(r.transform.y=n.y),Math.abs(r.transform.angleDeg)%90==0&&(u(r.transform),r.updateCornerPositions()),r.updateDOM()}}});for(var g=0;g<4;g++)!function(e){var t=r.corners[e]={i:e,el:l.BB.el({css:{width:r.gripSize+"px",height:r.gripSize+"px",background:"#fff",borderRadius:r.gripSize+"px",position:"absolute",boxShadow:"inset 0 0 0 2px #000"}}),x:0,y:0,virtualPos:{x:0,y:0},updateDOM:null,pointerListener:null};t.updateDOM=function(){var n=[[-1,-1],[1,-1],[1,1],[-1,1]].map((function(e){return e[0]*=r.transform.width>0?1:-1,e[1]*=r.transform.height>0?1:-1,e})),i=Math.abs(r.scaled.width)<20||Math.abs(r.scaled.height)<20?10:0;l.BB.css(t.el,{left:r.scaled.corners[t.i].x-r.gripSize/2+n[e][0]*i+"px",top:r.scaled.corners[t.i].y-r.gripSize/2+n[e][1]*i+"px"});for(var a=l.BB.pointsToAngleDeg({x:r.transform.x,y:r.transform.y},p(t.x,t.y,r.transform))+135;a<0;)a+=360;var o=Math.round(a/45)%r.cornerCursors.length;l.BB.css(t.el,{cursor:r.cornerCursors[o]+"-resize"})},t.pointerListener=new l.BB.PointerListener({target:r.corners[e].el,fixScribble:!0,onPointer:function(t){if(t.eventPreventDefault(),"pointerdown"===t.type&&"left"===t.button)r.corners[e].virtualPos=p(r.corners[e].x,r.corners[e].y,r.transform);else if("pointermove"===t.type&&"left"===t.button){r.corners[e].virtualPos.x+=t.dX/r.scale,r.corners[e].virtualPos.y+=t.dY/r.scale;var n={x:r.corners[e].virtualPos.x,y:r.corners[e].virtualPos.y};n=r.constrainCorner(e,n.x,n.y),r.isConstrained||(n=r.snapCorner(n.x,n.y)),Math.abs(r.transform.angleDeg)%90==0&&(n.x=Math.round(n.x),n.y=Math.round(n.y));var i=d(n.x,n.y,r.transform),a=i.x-r.corners[e].x,o=i.y-r.corners[e].y;r.corners[e].x=i.x,r.corners[e].y=i.y;var s=[];0===e?s=[3,1,2]:1===e?s=[2,0,3]:2===e?s=[1,3,0]:3===e&&(s=[0,2,1]),r.corners[s[0]].x=r.corners[e].x,r.corners[s[1]].y=r.corners[e].y,r.keyListener.isPressed("shift")&&(r.corners[s[2]].x-=a,r.corners[s[2]].y-=o,r.corners[s[1]].x=r.corners[s[2]].x,r.corners[s[0]].y=r.corners[s[2]].y),r.updateTransformViaCorners()}}})}(g);this.updateCornerPositions(),this.updateScaled();for(var f=0;f<4;f++)!function(e){r.edges[e]={el:l.BB.el({css:{width:r.edgeSize+"px",height:r.edgeSize+"px",position:"absolute"}}),updateDOM:null,pointerListener:null};var t=r.edges[e];t.updateDOM=function(){0===e?l.BB.css(t.el,{left:Math.min(r.scaled.corners[0].x,r.scaled.corners[1].x)+"px",top:Math.min(r.scaled.corners[0].y,r.scaled.corners[3].y)-r.edgeSize+"px",width:Math.abs(r.scaled.width)+"px",height:r.edgeSize+"px"}):1===e?l.BB.css(t.el,{left:Math.max(r.scaled.corners[0].x,r.scaled.corners[1].x)+"px",top:Math.min(r.scaled.corners[1].y,r.scaled.corners[2].y)+"px",width:r.edgeSize+"px",height:Math.abs(r.scaled.height)+"px"}):2===e?l.BB.css(t.el,{left:Math.min(r.scaled.corners[3].x,r.scaled.corners[2].x)+"px",top:Math.max(r.scaled.corners[0].y,r.scaled.corners[3].y)+"px",width:Math.abs(r.scaled.width)+"px",height:r.edgeSize+"px"}):3===e&&l.BB.css(t.el,{left:Math.min(r.scaled.corners[0].x,r.scaled.corners[1].x)-r.edgeSize+"px",top:Math.min(r.scaled.corners[0].y,r.scaled.corners[3].y)+"px",width:r.edgeSize+"px",height:Math.abs(r.scaled.height)+"px"});for(var n=Math.round(r.transform.angleDeg/45);n<0;)n+=8;n=(2*e+1+n)%r.cornerCursors.length,t.el.style.cursor=r.cornerCursors[n]+"-resize"};var n=[0,2].includes(e);t.pointerListener=new l.BB.PointerListener({target:r.edges[e].el,fixScribble:!0,onPointer:function(t){if(t.eventPreventDefault(),"pointerdown"===t.type&&"left"===t.button&&(o=n?r.corners[0].y>=r.corners[3].y:r.corners[0].x>=r.corners[1].x,i.x=0,i.y=0),"pointermove"===t.type&&"left"===t.button){var a=l.BB.rotateAround({x:0,y:0},{x:t.dX/r.scale,y:t.dY/r.scale},-r.transform.angleDeg),s={dX:a.x,dY:a.y};Math.abs(r.transform.angleDeg)%90==0&&(s=l.BB.intDxy(i,a.x,a.y));var c=[];0===e?c=[2,3,0,1]:1===e?c=[0,3,1,2]:2===e?c=[0,1,2,3]:3===e&&(c=[1,2,0,3]);var u=n?"y":"x",h=n?s.dY:s.dX;o?(r.corners[c[0]][u]+=h,r.corners[c[1]][u]+=h):(r.corners[c[2]][u]+=h,r.corners[c[3]][u]+=h),r.keyListener.isPressed("shift")&&(o?(r.corners[c[2]][u]-=h,r.corners[c[3]][u]-=h):(r.corners[c[0]][u]-=h,r.corners[c[1]][u]-=h)),n?r.restoreRatio(!1,!0):r.restoreRatio(!0,!1),r.updateTransformViaCorners()}}})}(f);this.angleGrip={el:l.BB.el({css:{cursor:"url("+e(c)+") 10 10, move",width:this.gripSize+"px",height:this.gripSize+"px",background:"#0ff",borderRadius:this.gripSize+"px",position:"absolute",boxShadow:"inset 0 0 0 2px #000"}}),x:0,y:0,snap:!1,updateDOM:function(){l.BB.css(r.angleGrip.el,{left:r.angleGrip.x-r.gripSize/2+"px",top:r.angleGrip.y-r.gripSize/2+"px"})}},l.BB.el({parent:this.angleGrip.el,css:{width:"2px",height:"13px",left:this.gripSize/2-1+"px",top:this.gripSize+"px",background:"#0ff",position:"absolute"}}),this.anglePointerListener=new l.BB.PointerListener({target:this.angleGrip.el,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=r.rootEl.getBoundingClientRect(),n={x:t.left-r.rootEl.scrollLeft,y:t.top-r.rootEl.scrollTop},i={x:(e.clientX-n.x)/r.scale,y:(e.clientY-n.y)/r.scale},a=l.BB.pointsToAngleDeg({x:r.transform.x,y:r.transform.y},i)+90;r.transform.angleDeg=a;var o=45*Math.round(a/360*8);("shift"===r.keyListener.getComboStr()||r.snappingEnabled&&Math.abs(o-a)<8)&&(r.transform.angleDeg=o),r.updateDOM()}"pointerup"===e.type&&Math.abs(r.transform.angleDeg)%90==0&&(u(r.transform),r.updateCornerPositions(),r.updateDOM())}}),u(this.transform),this.updateDOM(!0),l.BB.append(this.transEl,[this.boundsEl,this.edges[0].el,this.edges[1].el,this.edges[2].el,this.edges[3].el,this.corners[0].el,this.corners[1].el,this.corners[2].el,this.corners[3].el,this.angleGrip.el])}return(0,o.default)(t,[{key:"updateScaled",value:function(){var e=this;this.scaled.x=this.transform.x*this.scale,this.scaled.y=this.transform.y*this.scale,this.scaled.width=this.transform.width*this.scale,this.scaled.height=this.transform.height*this.scale,this.scaled.corners=this.corners.map((function(t){return{x:t.x*e.scale,y:t.y*e.scale}}))}},{key:"snapCorner",value:function(e,t){if(!this.snappingEnabled)return{x:e,y:t};for(var n,r,i,a={x:null,y:null,dist:{x:null,y:null}},o=0;o<this.snapX.length;o++)(n=Math.abs(e-this.snapX[o]))<this.minSnapDist/this.scale&&(null===a.x||n<a.dist.x)&&(a.x=this.snapX[o],a.dist.x=n);for(var s=0;s<this.snapY.length;s++)(n=Math.abs(t-this.snapY[s]))<this.minSnapDist/this.scale&&(null===a.y||n<a.dist.y)&&(a.y=this.snapY[s],a.dist.y=n);return null===a.x&&null===a.y?{x:e,y:t}:{x:null!==(r=a.x)&&void 0!==r?r:e,y:null!==(i=a.y)&&void 0!==i?i:t}}},{key:"constrainCorner",value:function(e,t,n){if(!this.isConstrained)return{x:t,y:n};var r=this.transform.width*this.transform.height<0?-1:1;return l.BB.projectPointOnLine({x:this.transform.x,y:this.transform.y},p(this.ratio,r*([0,2].includes(e)?1:-1),this.transform),{x:t,y:n})}},{key:"updateCornerPositions",value:function(){this.corners[0].x=-this.transform.width/2,this.corners[0].y=-this.transform.height/2,this.corners[1].x=this.transform.width/2,this.corners[1].y=-this.transform.height/2,this.corners[2].x=this.transform.width/2,this.corners[2].y=this.transform.height/2,this.corners[3].x=-this.transform.width/2,this.corners[3].y=this.transform.height/2}},{key:"restoreRatio",value:function(e,t){if(this.isConstrained){var n=Math.abs(this.transform.angleDeg)%90==0,r=Math.abs(this.transform.angleDeg-90)%180==0;if(t&&!e){var i=Math.abs(this.corners[3].y-this.corners[0].y),a=this.ratio*i;n&&(a=0==(r?this.transform.y%1:this.transform.x%1)?l.BB.roundEven(a):l.BB.roundUneven(a)),this.corners[1].x-this.corners[0].x<0&&(a*=-1),this.corners[0].x=-a/2,this.corners[3].x=-a/2,this.corners[1].x=a/2,this.corners[2].x=a/2}if(!t&&e){var o=Math.abs(this.corners[0].x-this.corners[1].x)/this.ratio;n&&(o=0==(r?this.transform.x%1:this.transform.y%1)?l.BB.roundEven(o):l.BB.roundUneven(o)),this.corners[3].y-this.corners[0].y<0&&(o*=-1),this.corners[0].y=-o/2,this.corners[1].y=-o/2,this.corners[2].y=o/2,this.corners[3].y=o/2}}}},{key:"updateTransformViaCorners",value:function(){var e=l.BB.rotateAround({x:0,y:0},{x:(this.corners[0].x+this.corners[1].x)/2,y:(this.corners[0].y+this.corners[3].y)/2},this.transform.angleDeg);this.transform.x=e.x+this.transform.x,this.transform.y=e.y+this.transform.y,this.transform.width=this.corners[1].x-this.corners[0].x,this.transform.height=this.corners[3].y-this.corners[0].y,this.updateCornerPositions(),this.updateDOM()}},{key:"updateDOM",value:function(e){this.updateScaled(),l.BB.css(this.transEl,{left:this.scaled.x+"px",top:this.scaled.y+"px",transformOrigin:"0 0",transform:"rotate("+this.transform.angleDeg+"deg)"}),l.BB.css(this.boundsEl,{width:Math.abs(this.scaled.width)+"px",height:Math.abs(this.scaled.height)+"px",left:Math.min(this.scaled.corners[0].x,this.scaled.corners[1].x)+"px",top:Math.min(this.scaled.corners[0].y,this.scaled.corners[3].y)+"px"}),this.corners[0].updateDOM(),this.corners[1].updateDOM(),this.corners[2].updateDOM(),this.corners[3].updateDOM(),this.edges[0].updateDOM(),this.edges[1].updateDOM(),this.edges[2].updateDOM(),this.edges[3].updateDOM(),this.angleGrip.x=0,this.angleGrip.y=-Math.abs(this.transform.height*this.scale)/2-20,this.angleGrip.updateDOM(),e||this.callback&&this.callback(h(this.transform))}},{key:"getTransform",value:function(){return h(this.transform)}},{key:"setConstrained",value:function(e){this.isConstrained=!!e,e&&0!==this.transform.width&&0!==this.transform.height&&(this.ratio=Math.abs(this.transform.width/this.transform.height))}},{key:"setSnapping",value:function(e){this.snappingEnabled=!!e}},{key:"setPos",value:function(e){this.transform.x=e.x,this.transform.y=e.y,this.updateDOM(!0)}},{key:"move",value:function(e,t){this.transform.x+=e,this.transform.y+=t,this.updateDOM(!1)}},{key:"setSize",value:function(e,t){this.transform.width=e,this.transform.height=t,Math.abs(this.transform.angleDeg)%90==0&&u(this.transform),this.updateCornerPositions(),this.updateDOM(!1)}},{key:"setAngleDeg",value:function(e){this.transform.angleDeg=e,Math.abs(this.transform.angleDeg)%90==0&&(u(this.transform),this.updateCornerPositions()),this.updateDOM(!0)}},{key:"getElement",value:function(){return this.rootEl}},{key:"getRatio",value:function(){return this.ratio}},{key:"destroy",value:function(){this.keyListener.destroy(),this.boundsPointerListener.destroy(),this.corners[0].pointerListener.destroy(),this.corners[1].pointerListener.destroy(),this.corners[2].pointerListener.destroy(),this.corners[3].pointerListener.destroy(),this.edges[0].pointerListener.destroy(),this.edges[1].pointerListener.destroy(),this.edges[2].pointerListener.destroy(),this.edges[3].pointerListener.destroy(),this.anglePointerListener.destroy()}}]),t}()})),r.register("lQMok",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("045N6")})),r.register("kEeSq",(function(e,n){t(e.exports,"FreeTransformCanvas",(function(){return s}));var i=r("eWjiX"),a=r("i5nyl"),o=r("cNhNm");function s(e){var t=function(){if(u){var t=u.getTransform();r<1&&(t.x*=r,t.y*=r,t.width*=r,t.height*=r);var n=c[e.transformIndex].image,a=n.getContext("2d");a.save(),a.clearRect(0,0,n.width,n.height),i.BB.drawTransformedImageWithBounds(a,e.layers[e.transformIndex].image,t,null,i.BB.testShouldPixelate(t,t.width/h.width,t.height/h.height)),a.restore(),d.render()}},n=i.BB.fitInto(e.imageWidth,e.imageHeight,e.elementWidth-20,e.elementHeight-60,1),r=n.width/e.imageWidth,s=i.BB.el({css:{width:e.elementWidth+"px",height:e.elementHeight+"px",backgroundColor:"#9e9e9e",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",userSelect:"none",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"}});s.oncontextmenu=function(){return!1};var l=i.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:n.width+"px",height:n.height+"px"}});s.appendChild(l);var c=e.layers.map((function(e){return{image:e.image,mixModeStr:e.mixModeStr,opacity:e.opacity}}));c[c.length-1].image=i.BB.canvas(r>1?e.imageWidth:n.width,r>1?e.imageHeight:n.height);var u,h,d=new(0,a.KlCanvasPreview)({width:n.width,height:n.height,layers:c});l.appendChild(d.getElement());var p={width:e.layers[e.transformIndex].image.width*r,height:e.layers[e.transformIndex].image.height*r};(p.width>n.width||p.height>n.height)&&(p=i.BB.fitInto(e.layers[e.transformIndex].image.width,e.layers[e.transformIndex].image.height,n.width,n.height,1)),h={x:e.imageWidth/2,y:e.imageHeight/2,width:e.layers[e.transformIndex].image.width,height:e.layers[e.transformIndex].image.height},u=new(0,o.FreeTransform)({x:h.x,y:h.y,width:h.width,height:h.height,angleDeg:0,isConstrained:!0,snapX:[0,e.imageWidth],snapY:[0,e.imageHeight],scale:r,callback:function(e){t()}}),i.BB.css(u.getElement(),{position:"absolute",left:"0",top:"0"}),l.appendChild(u.getElement()),setTimeout(t,0),this.move=function(e,t){u.move(e,t)},this.reset=function(){var n=e.layers[e.transformIndex].image.width,r=e.layers[e.transformIndex].image.height;u.setSize(n,r),u.setPos({x:n/2,y:r/2}),u.setAngleDeg(0),t()},this.setTransformFit=function(){var n=i.BB.fitInto(e.layers[e.transformIndex].image.width,e.layers[e.transformIndex].image.height,e.imageWidth,e.imageHeight,1);u.setSize(n.width,n.height),u.setPos({x:n.width/2,y:n.height/2}),u.setAngleDeg(0),t()},this.setTransformCenter=function(){u.setPos({x:e.imageWidth/2,y:e.imageHeight/2}),u.setAngleDeg(0),t()},this.getTransformation=function(){return!!u&&u.getTransform()},this.getIsPixelated=function(){var e=u.getTransform();return i.BB.testShouldPixelate(e,e.width/h.width,e.height/h.height)},this.getElement=function(){return s},this.destroy=function(){u.destroy()}}})),r.register("32CBv",(function(e,n){t(e.exports,"Cropper",(function(){return a}));var i=r("eWjiX");function a(e){var t=function(e){L[0].y+=e,L[0].y=Math.max(L[3].y-m,Math.min(L[3].y-1,L[0].y)),L[1].y=L[0].y},n=function(e){L[1].x+=e,L[1].x=Math.min(L[0].x+f,Math.max(L[0].x+1,L[1].x)),L[2].x=L[1].x},r=function(e){L[2].y+=e,L[2].y=Math.min(L[1].y+m,Math.max(L[1].y+1,L[2].y)),L[3].y=L[2].y},a=function(e){L[0].x+=e,L[0].x=Math.max(L[1].x-f,Math.min(L[1].x-1,L[0].x)),L[3].x=L[0].x},o=function(){B.x=0,B.y=0,g(s())},s=function(){return L[1].x-=L[0].x,L[1].y-=L[0].y,L[2].x-=L[0].x,L[2].y-=L[0].y,L[3].x-=L[0].x,L[3].y-=L[0].y,c+=L[0].x,u+=L[0].y,L[0].x=0,L[0].y=0,{x:c,y:u,width:L[1].x,height:L[2].y}},l=function(){T[0].update(),T[1].update(),T[2].update(),T[3].update(),D[0].update(),D[1].update(),D[2].update(),D[3].update(),M[0].update(),M[1].update(),M[2].update(),M[3].update(),b.update(),C.update(),S.update()},c=e.x,u=e.y,h=e.width,d=e.height,p=e.scale,g=e.callback,f=e.maxW,m=e.maxH,v=document.createElement("div"),y=["nw","n","ne","e","se","s","sw","w"],x=new i.BB.KeyListener({});i.BB.css(v,{position:"absolute",left:c*p+"px",top:u*p+"px"});var b=document.createElement("div");i.BB.css(b,{position:"absolute",border:"1px dashed #fff",cursor:"move"}),b.update=function(){i.BB.css(b,{left:L[0].x*p-1+"px",top:L[0].y*p-1+"px",width:(L[2].x-L[0].x)*p+"px",height:(L[2].y-L[0].y)*p+"px"})};var B={x:0,y:0},w=new i.BB.PointerListener({target:b,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=i.BB.intDxy(B,e.dX/p,e.dY/p),n=t.dX,r=t.dY;L[0].x+=n,L[0].y+=r,L[1].x+=n,L[1].y+=r,L[2].x+=n,L[2].y+=r,L[3].x+=n,L[3].y+=r,l()}"pointerup"===e.type&&o()}}),C=document.createElement("div");i.BB.css(C,{position:"absolute",borderTop:"1px solid #0ff",borderBottom:"1px solid #0ff"}),C.update=function(){i.BB.css(C,{left:L[0].x*p+"px",top:(L[0].y+(L[2].y-L[0].y)/3)*p+"px",width:(L[2].x-L[0].x)*p+"px",height:(L[2].y-L[0].y)/3*p+"px"})};var S=document.createElement("div");i.BB.css(S,{position:"absolute",borderLeft:"1px solid #0ff",borderRight:"1px solid #0ff"}),S.update=function(){i.BB.css(S,{left:(L[0].x+(L[2].x-L[0].x)/3)*p+"px",top:L[0].y*p+"px",width:(L[2].x-L[0].x)/3*p+"px",height:(L[2].y-L[0].y)*p+"px"})};for(var k=10,L=[{x:0,y:0},{x:h,y:0},{x:h,y:d},{x:0,y:d}],T=[],E=0;E<4;E++)!function(e){T[e]=document.createElement("div");var t=T[e];t.style.width="40px",t.style.height="40px",t.style.position="absolute",t.update=function(){0===e?(t.style.left=L[0].x*p+k+"px",t.style.top=L[0].y*p-80+k+"px",t.style.width=(L[1].x-L[0].x)*p-20+"px",t.style.height="80px"):1===e?(t.style.left=L[1].x*p-k+"px",t.style.top=L[1].y*p+k+"px",t.style.width="80px",t.style.height=(L[2].y-L[1].y)*p-20+"px"):2===e?(t.style.left=L[3].x*p+k+"px",t.style.top=L[3].y*p-k+"px",t.style.width=(L[2].x-L[3].x)*p-20+"px",t.style.height="80px"):3===e&&(t.style.left=L[0].x*p-80+k+"px",t.style.top=L[0].y*p+k+"px",t.style.width="80px",t.style.height=(L[3].y-L[0].y)*p-20+"px");var n=2*e+1;t.style.cursor=y[n]+"-resize"}}(E);for(var M=[],I=0;I<4;I++)!function(e){M[e]=document.createElement("div");var t=M[e];t.style.position="absolute",t.style.background="#000",t.style.opacity="0.5",t.update=function(){0===e?(t.style.left=L[0].x*p+"px",t.style.top=L[0].y*p-8e3+"px",t.style.width=(L[1].x-L[0].x)*p+"px",t.style.height="8000px"):1===e?(t.style.left=L[1].x*p+"px",t.style.top=L[1].y*p-8e3+"px",t.style.width="8000px",t.style.height="16000px"):2===e?(t.style.left=L[3].x*p+"px",t.style.top=L[3].y*p+"px",t.style.width=(L[2].x-L[3].x)*p+"px",t.style.height="8000px"):3===e&&(t.style.left=L[0].x*p-8e3+"px",t.style.top=L[0].y*p-8e3+"px",t.style.width="8000px",t.style.height="16000px")}}(I);var A=new i.BB.PointerListener({target:T[0],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var n=i.BB.intDxy(B,e.dX/p,e.dY/p),a=(n.dX,n.dY);t(a),x.isPressed("shift")&&r(-a),l()}"pointerup"===e.type&&o()}}),R=new i.BB.PointerListener({target:T[1],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=i.BB.intDxy(B,e.dX/p,e.dY/p),r=t.dX;t.dY;n(r),x.isPressed("shift")&&a(-r),l()}"pointerup"===e.type&&o()}}),P=new i.BB.PointerListener({target:T[2],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var n=i.BB.intDxy(B,e.dX/p,e.dY/p),a=(n.dX,n.dY);r(a),x.isPressed("shift")&&t(-a),l()}"pointerup"===e.type&&o()}}),O=new i.BB.PointerListener({target:T[3],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=i.BB.intDxy(B,e.dX/p,e.dY/p),r=t.dX;t.dY;a(r),x.isPressed("shift")&&n(-r),l()}"pointerup"===e.type&&o()}}),D=[];!function(){for(var e=0;e<4;e++)!function(e){D[e]=document.createElement("div");var t=D[e];i.BB.css(t,{width:"80px",height:"80px",position:"absolute"}),t.style.cursor=["nwse-resize","nesw-resize"][e%2],t.update=function(){0===e?i.BB.css(t,{left:L[0].x*p-80+k+"px",top:L[0].y*p-80+k+"px"}):1===e?i.BB.css(t,{left:L[1].x*p-k+"px",top:L[1].y*p-80+k+"px"}):2===e?i.BB.css(t,{left:L[1].x*p-k+"px",top:L[2].y*p-k+"px"}):3===e&&i.BB.css(t,{left:L[0].x*p-80+k+"px",top:L[2].y*p-k+"px"})}}(e)}();var N=new i.BB.PointerListener({target:D[0],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var s=i.BB.intDxy(B,e.dX/p,e.dY/p),c=s.dX,u=s.dY;a(c),t(u),x.isPressed("shift")&&(n(-c),r(-u)),l()}"pointerup"===e.type&&o()}}),z=new i.BB.PointerListener({target:D[1],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var s=i.BB.intDxy(B,e.dX/p,e.dY/p),c=s.dX,u=s.dY;n(c),t(u),x.isPressed("shift")&&(a(-c),r(-u)),l()}"pointerup"===e.type&&o()}}),G=new i.BB.PointerListener({target:D[2],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var s=i.BB.intDxy(B,e.dX/p,e.dY/p),c=s.dX,u=s.dY;n(c),r(u),x.isPressed("shift")&&(a(-c),t(-u)),l()}"pointerup"===e.type&&o()}}),j=new i.BB.PointerListener({target:D[3],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var s=i.BB.intDxy(B,e.dX/p,e.dY/p),c=s.dX,u=s.dY;a(c),r(u),x.isPressed("shift")&&(n(-c),t(-u)),l()}"pointerup"===e.type&&o()}});v.append(M[1],M[0],M[2],M[3],C,S,b,T[1],T[0],T[2],T[3],D[0],D[1],D[2],D[3]),l(),this.getTransform=s,this.setTransform=function(e){c=e.x,u=e.y,h=e.width,d=e.height,i.BB.css(v,{left:c*p+"px",top:u*p+"px"}),L[0].x=0,L[0].y=0,L[1].x=h,L[1].y=0,L[2].x=h,L[2].y=d,L[3].x=0,L[3].y=d,l(),o()},this.setScale=function(e){p=e,i.BB.css(v,{left:c*p+"px",top:u*p+"px"}),l()},this.showThirds=function(e){e?(C.style.display="block",S.style.display="block"):(C.style.display="none",S.style.display="none")},this.getElement=function(){return v},this.destroy=function(){x.destroy(),w.destroy(),N.destroy(),z.destroy(),G.destroy(),j.destroy(),A.destroy(),R.destroy(),P.destroy(),O.destroy()}}})),r.register("kqmpc",(function(e,n){t(e.exports,"LayerPreview",(function(){return s}));var i=r("eWjiX"),a=r("gWfkn"),o=r("1mH1z");function s(e){var t,n,r=function(e){if(h){E.textContent=t.name,A.innerHTML=(0,o.LANG)("opacity")+"<br>"+Math.round(100*t.opacity)+"%";var n=t.context.canvas;if(n.width!==m.width||n.height!==m.height){var r=i.BB.fitInto(n.width,n.height,p,p,1);k.width=Math.round(r.width),k.height=Math.round(r.height),e=!0}v.width=k.width,v.height=k.height,y.save(),y.imageSmoothingEnabled=!1,y.fillStyle=D,y.fillRect(0,0,v.width,v.height),y.drawImage(n,0,0,v.width,v.height),y.restore(),e?(b=0,L.save(),L.drawImage(v,0,0),L.restore()):(b=x,z()),l(),f=a.klHistory.getState(),m.width=n.width,m.height=n.height}},s=function(){r(!0)},l=function(){if(B&&t){var e=t.context.canvas,n=i.BB.fitInto(e.width,e.height,g,g,1);P.width=Math.round(n.width),P.height=Math.round(n.height),O.save(),P.width>e.width?O.imageSmoothingEnabled=!1:(O.imageSmoothingEnabled=!0,O.imageSmoothingQuality="high"),O.fillStyle=N,O.fillRect(0,0,P.width,P.height),O.drawImage(e,0,0,P.width,P.height),O.restore();var r=u.getBoundingClientRect();i.BB.css(R,{top:Math.max(10,r.top+d/2-P.height/2)+"px"})}},c=function(){try{e.klRootEl.removeChild(R)}catch(e){}},u=i.BB.el({}),h=!0,d=40,p=d-10,g=300,f=-2,m={width:0,height:0},v=i.BB.canvas(),y=v.getContext("2d"),x=30,b=0,B=!1,w=300,C=i.BB.el({css:{display:"flex",alignItems:"center",height:d+"px",color:"#666"}}),S=i.BB.el({css:{minWidth:d+"px",height:d+"px",display:"flex",justifyContent:"center",alignItems:"center"}}),k=i.BB.canvas(p,p),L=k.getContext("2d");k.title=(0,o.LANG)("layers-active-layer"),i.BB.css(k,{boxShadow:"0 0 0 1px #9e9e9e",colorScheme:"only light"});var T=i.BB.el({css:{flexGrow:"1",paddingLeft:"10px",fontSize:"13px",overflow:"hidden",position:"relative"}}),E=i.BB.el({content:"",css:{cssFloat:"left",whiteSpace:"nowrap"}}),M=i.BB.el({css:{backgroundImage:"linear-gradient(to right, rgba(221,221,221,0) 0%, rgba(221,221,221,0.8) 100%)",position:"absolute",right:"0",top:"0",width:"50px",height:"100%"}}),I=i.BB.el({css:{position:"absolute",left:"10px",top:"0",width:"90px",height:"100%"}});e.onClick&&(i.BB.addEventListener(I,"click",(function(){e.onClick()})),i.BB.addEventListener(k,"click",(function(){e.onClick()})));var A=i.BB.el({content:(0,o.LANG)("opacity")+"<br>100%",css:{minWidth:"60px",fontSize:"12px",textAlign:"center",background:"#dddddd",color:"#555"}}),R=i.BB.el({onClick:i.BB.handleClick,css:{pointerEvents:"none",background:"#fff",position:"absolute",right:"280px",top:"10px",border:"1px solid #aaa",boxShadow:"1px 1px 3px rgba(0,0,0,0.3)",transition:"opacity "+w+"ms ease-in-out",userSelect:"none",display:"block",webkitTouchCallout:"none",colorScheme:"only light"}}),P=i.BB.canvas(g,g);R.append(P);var O=P.getContext("2d");i.BB.css(P,{display:"block"}),u.appendChild(C),C.appendChild(S),S.appendChild(k),C.appendChild(T),T.appendChild(E),T.appendChild(M),T.appendChild(I),C.appendChild(A);var D=y.createPattern(i.BB.createCheckerCanvas(4),"repeat"),N=L.createPattern(i.BB.createCheckerCanvas(4),"repeat");function z(){0!==b&&(b--,L.save(),L.globalAlpha=Math.pow((x-b)/x,2),L.drawImage(v,0,0),L.restore(),b>0&&requestAnimationFrame(z))}setInterval((function(){t&&(a.klHistory.getState()!==f&&(t.opacity=t.context.canvas.opacity,r(!1)))}),2e3);new i.BB.PointerListener({target:k,onEnterLeave:function(t){!function(t){B!==t&&(clearTimeout(n),B=t,t?n=setTimeout((function(){l(),R.style.opacity="0",e.klRootEl.appendChild(R),setTimeout((function(){R.style.opacity="1"}),20)}),250):(R.style.opacity="0",n=setTimeout(c,w+20)))}(t)}});this.getElement=function(){return u},this.setIsVisible=function(e){if(h!==e){h=e,C.style.display=h?"flex":"none",u.style.marginBottom=h?"":"10px";var t=a.klHistory.getState();e&&f!==t&&s()}},this.setLayer=function(e){t=e,s()},this.setUiState=function(e){"left"===""+e?i.BB.css(R,{left:"280px",right:""}):i.BB.css(R,{left:"",right:"280px"})}}})),r.register("j1kEL",(function(e,n){t(e.exports,"FittedImage",(function(){return a}));var i=r("eWjiX");function a(e){var t=i.BB.fitInto(e.image.width,e.image.height,e.width,e.height,1),n=parseInt(""+t.width),r=parseInt(""+t.height),a=i.BB.canvas(n,r);a.getContext("2d").drawImage(e.image,0,0,n,r),i.BB.css(a,{display:"block",boxShadow:"0 0 0 1px #aaa"}),this.getElement=function(){return a}}})),r.register("8ebuX",(function(e,n){t(e.exports,"showImportAsLayerDialog",(function(){return l}));var i=r("eWjiX"),a=r("kEeSq"),o=r("ekHRj"),s=r("1mH1z");function l(e){var t=function(e,t){m.move(e,t)},n=document.createElement("div");if(i.BB.appendTextDiv(n,(0,s.LANG)("import-as-layer-description")),e.klCanvas.isLayerLimitReached()){var r=i.BB.el({content:(0,s.LANG)("import-as-layer-limit-reached"),css:{background:"#ff0",padding:"10px",marginTop:"5px",marginBottom:"5px",border:"1px solid #e7d321",borderRadius:"5px"}});n.appendChild(r)}var l=window.innerWidth<550,c=i.BB.el({css:{display:"flex"}}),u=i.BB.el({tagName:"button",content:"1:1",css:{marginRight:"10px"},onClick:function(){m.reset()}}),h=i.BB.el({tagName:"button",content:(0,s.LANG)("import-as-layer-fit"),css:{marginRight:"10px"},onClick:function(){m.setTransformFit()}}),d=i.BB.el({tagName:"button",content:(0,s.LANG)("center"),css:{marginRight:"10px"},onClick:function(){m.setTransformCenter()}});c.appendChild(u),c.appendChild(h),c.appendChild(d),n.appendChild(c);for(var p=[],g=e.klCanvas.getLayers(),f=0;f<g.length;f++)p.push({image:g[f].context.canvas,opacity:g[f].opacity,mixModeStr:g[f].mixModeStr});p.push({image:e.importImage,opacity:1,mixModeStr:"source-over"});var m=new(0,a.FreeTransformCanvas)({elementWidth:l?340:540,elementHeight:l?280:350,imageWidth:e.klCanvas.getLayerContext(0).canvas.width,imageHeight:e.klCanvas.getLayerContext(0).canvas.height,layers:p,transformIndex:p.length-1});i.BB.css(m.getElement(),{marginTop:"10px",marginLeft:"-20px"}),n.appendChild(m.getElement());var v=new i.BB.KeyListener({onDown:function(e){"left"===e&&t(-1,0),"right"===e&&t(1,0),"up"===e&&t(0,-1),"down"===e&&t(0,1)}});(0,o.popup)({target:e.target,message:"<b>".concat((0,s.LANG)("import-as-layer-title"),"</b>"),div:n,style:l?null:{width:"500px"},buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(t){v.destroy(),m.destroy(),i.BB.destroyEl(u),i.BB.destroyEl(h),i.BB.destroyEl(d),"Ok"===t?e.callback(m.getTransformation(),m.getIsPixelated()):e.callback()}})}})),r.register("13r5y",(function(e,n){t(e.exports,"KlImageDropper",(function(){return a}));var i=r("eWjiX");function a(e){var t=function(){u=0,h=0,d=0;try{e.target.removeChild(a)}catch(e){}},n=function(e){try{return!e.dataTransfer.types.includes("text/plain")}catch(e){}return!1},r=function(){var e="0 0 20px 4px #fff";h>0?(l.style.boxShadow=e,c.style.boxShadow=""):d>0?(l.style.boxShadow="",c.style.boxShadow=e):(l.style.boxShadow="",c.style.boxShadow="")},a=i.BB.el({content:"Drop to import",css:{paddingTop:"100px",position:"fixed",left:"0",top:"0",width:"100%",height:"100%",background:"rgba(50, 50, 50, 0.7)",color:"#fff",textShadow:"2px 2px #000",textAlign:"center",fontSize:"25px"}}),o=i.BB.el({css:{marginTop:"50px",display:"flex",justifyContent:"center"}}),s={width:"200px",padding:"50px",margin:"10px",borderRadius:"20px",border:"1px dashed #fff",background:"#00aefe",fontWeight:"bold"},l=i.BB.el({content:"As Layer",css:s}),c=i.BB.el({content:"As New Image",css:s});a.appendChild(o),o.appendChild(l),o.appendChild(c);var u=0,h=0,d=0;i.BB.addEventListener(l,"dragenter",(function(){h++,r()})),i.BB.addEventListener(l,"dragleave",(function(){h--,r()})),i.BB.addEventListener(c,"dragenter",(function(){d++,r()})),i.BB.addEventListener(c,"dragleave",(function(){d--,r()})),i.BB.addEventListener(window,"dragover",(function(e){n(e)&&(e.stopPropagation(),e.preventDefault())}),!1),i.BB.addEventListener(window,"dragenter",(function(t){e.enabledTest()&&n(t)&&(0===u&&e.target.appendChild(a),u++)}),!1),i.BB.addEventListener(window,"dragleave",(function(t){n(t)&&0!==u&&0===(u=Math.max(0,u-1))&&e.target.removeChild(a)}),!1),i.BB.addEventListener(window,"drop",(function(i){if(n(i)&&0!==i.dataTransfer.files.length){i.stopPropagation(),i.preventDefault();var o="default";h>0?o="layer":d>0&&(o="image"),e.onDrop(i.dataTransfer.files,o),u>0&&e.target.removeChild(a),u=0,h=0,d=0,r()}else t()}),!1),i.BB.addEventListener(a,"pointerdown",(function(){t()}));new i.BB.KeyListener({onDown:function(e){u>0&&"esc"===e&&t()}})}})),r.register("9p4Zp",(function(e,n){t(e.exports,"OverlayToolspace",(function(){return l}));var i=r("eWjiX"),a=r("kzhsD"),o=r("llzZ0"),s=r("1mH1z");function l(e){var t=function(e){h.setColor(e),d.style.backgroundColor="rgb("+e.r+","+e.g+","+e.b+")"},n=function(){i.BB.unfocusAnyInput(),c.style.display=l?"block":"none",l&&y&&(c.style.left=y.x-Math.round(r.width/2)+"px",c.style.top=y.y-Math.round(r.svHeight+3*r.hHeight/2)+"px")},r={width:150,svHeight:90,hHeight:20,sliderHeight:25},l=!1,c=i.BB.el({css:{position:"absolute",left:"500px",top:"500px",background:"rgb(221, 221, 221)",display:"none",border:"1px solid #fff",boxShadow:"0 0 10px rgba(0,0,0,0.5)",colorScheme:"only light"}}),u={color:null,size:null,opacity:null},h=new(0,a.KlSmallColorSlider)({width:r.width,heightSV:r.svHeight,heightH:r.hHeight,color:e.brushSettingService.getColor(),callback:function(t){d.style.backgroundColor="rgb("+t.r+","+t.g+","+t.b+")",e.brushSettingService.setColor(t,m)}}),d=i.BB.el({css:{width:r.width+"px",height:r.hHeight+"px",pointerEvents:"none"}}),p=e.brushSettingService.getColor();d.style.backgroundColor="rgb("+p.r+","+p.g+","+p.b+")",c.appendChild(d),c.appendChild(h.getElement());var g=new(0,o.KlSlider)({label:(0,s.LANG)("brush-size"),width:r.width,height:r.sliderHeight,min:0,max:500,value:50,resolution:225,eventResMs:1e3/30,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){e.brushSettingService.setSize(t)},formatFunc:function(e){return e<10?i.BB.round(e,1):Math.round(e)}});i.BB.css(g.getElement(),{marginTop:"2px"}),c.appendChild(g.getElement());var f=new(0,o.KlSlider)({label:(0,s.LANG)("opacity"),width:r.width,height:r.sliderHeight,min:0,max:1,value:1,resolution:225,eventResMs:1e3/30,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){e.brushSettingService.setOpacity(t)}});i.BB.css(f.getElement(),{margin:"2px 0"}),c.appendChild(f.getElement());var m=function(e){"color"===e.type&&(l?t(e.value):u.color=e.value),"size"===e.type&&(l?g.setValue(e.value):u.size=e.value),"opacity"===e.type&&(l?f.setValue(e.value):u.opacity=e.value),"sliderConfig"===e.type&&(g.update(e.value.sizeSlider),f.update(e.value.opacitySlider))};e.brushSettingService.subscribe(m);var v=e.brushSettingService.getSliderConfig();g.update(v.sizeSlider),f.update(v.opacitySlider),g.setValue(e.brushSettingService.getSize()),f.setValue(e.brushSettingService.getOpacity());var y=null;i.BB.addEventListener(document,"pointermove",(function(e){y={x:e.pageX,y:e.pageY}}));new i.BB.KeyListener({onDown:function(r,i,a,o){if(!o)return l?(l=!1,void n()):void(e.enabledTest()&&y&&["ctrl+alt","cmd+alt","alt+ctrl","alt+cmd"].includes(a)&&(i.preventDefault(),l=!0,null!==u.color&&(t(u.color),u.color=null),null!==u.size&&(g.setValue(u.size),u.size=null),null!==u.opacity&&(f.setValue(u.opacity),u.opacity=null),n()))},onUp:function(e,t,r){["ctrl+alt","cmd+alt","alt+ctrl","alt+cmd"].includes(r)&&l&&(l=!1,h.end(),n())},onBlur:function(){l&&(l=!1,h.end(),n())}});this.getElement=function(){return c}}})),r.register("8jqzp",(function(n,i){t(n.exports,"ToolspaceTopRow",(function(){return p}));var a=r("eWjiX"),o=r("8oUiM"),s=r("1gUFn"),l=r("gswMe"),c=r("lLh5u"),u=r("5xpQb"),h=r("kS5uZ"),d=r("1mH1z");function p(t){var n=function(e){var t=6+(e.extraPadding?e.extraPadding:0),n=a.BB.el({className:"toolspace-row-button nohighlight",title:e.title,onClick:e.onClick,css:{padding:e.contain?t+"px 0":""}}),r=a.BB.el({css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%"}});return r.style.pointerEvents="none",n.appendChild(r),n.pointerListener=new a.BB.PointerListener({target:n,onEnterLeave:function(e){n.classList.toggle("toolspace-row-button-hover",e)}}),n},r=document.createElement("div");a.BB.css(r,{height:"36px",display:"flex",backgroundImage:"linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)"});var i=n({onClick:t.onLogo,title:(0,d.LANG)("home"),image:t.logoImg?t.logoImg:e(o),contain:!0});i.style.width="45px",i.style.borderRight="1px solid rgb(212, 212, 212)";var p=n({onClick:t.onNew,title:(0,d.LANG)("file-new"),image:e(s),extraPadding:1,contain:!0}),g=n({onClick:t.onImport,title:(0,d.LANG)("file-import"),image:e(l),extraPadding:1,contain:!0}),f=n({onClick:t.onSave,title:(0,d.LANG)("file-save"),image:e(c),extraPadding:1,contain:!0}),m=null;a.BB.canShareFiles()&&(m=n({onClick:t.onShare,title:(0,d.LANG)("file-share"),image:e(u),contain:!0}));var v=n({onClick:t.onHelp,title:(0,d.LANG)("help"),image:e(h),contain:!0});r.appendChild(i),r.appendChild(p),r.appendChild(g),r.appendChild(f),m&&r.appendChild(m),r.appendChild(v),this.getElement=function(){return r}}})),r.register("8oUiM",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("eHdqz")})),r.register("1gUFn",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("3x5dR")})),r.register("gswMe",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("hbDTd")})),r.register("lLh5u",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("16iGk")})),r.register("5xpQb",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("2ME3z")})),r.register("kS5uZ",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("hZnSk")})),r.register("84zxV",(function(n,i){t(n.exports,"ToolDropdown",(function(){return p}));var a=r("eWjiX"),o=r("i8UFO"),s=r("fxAg2"),l=r("fuF9j"),c=r("adBnR"),u=r("cafM1"),h=r("gzZrf"),d=r("1mH1z");function p(t){var n=function(e){var t={},n=a.BB.el({parent:A,className:"tool-dropdown-button",title:e.title,css:{padding:"10px 0",height:100/(f.length-1)+"%",boxSizing:"border-box"},onClick:function(t){t.preventDefault(),t.stopPropagation(),e.onClick(e.index,e.id)}});t.wrapper=n;a.BB.el({parent:n,css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain",height:"100%",pointerEvents:"none",opacity:"0.75"}});return t.show=function(e){n.style.display=e?"block":"none"},t.setIsSmall=function(e){n.style.padding=e?S:"10px 0"},t},r=function(e,n){p(),x=!0,y=e,g(),t.onChange(f[y])},i=function(){o.dialogCounter.increase(.5),b=!0;for(var e=0;e<f.length;e++)R[e].show(y!==e);M.style.display="none",k.style.zIndex="1",document.body.appendChild(I),k.appendChild(A)},p=function(){o.dialogCounter.decrease(.5),b=!1,M.style.removeProperty("display"),k.style.removeProperty("z-index"),document.body.removeChild(I),k.removeChild(A)},g=function(){T.title=v[y],E.style.backgroundImage="url('"+m[y]+"')"},f=["draw","fill","text","shape"],m=[e(s),e(l),e(c),e(u)],v=["".concat((0,d.LANG)("tool-brush")," [B]"),"".concat((0,d.LANG)("tool-paint-bucket")," [G]"),"".concat((0,d.LANG)("tool-text")," [T]"),"".concat((0,d.LANG)("tool-shape")," [U]")],y=0,x=!0,b=!1;setTimeout((function(){for(var e=1;e<m.length;e++){(new Image).src=m[e]}}),100);var B,w,C,S="6px 0",k=a.BB.el({css:{position:"relative",flexGrow:"1"}}),L=!1;a.BB.hasPointerEvents&&new a.BB.PointerListener({target:k,maxPointers:1,onPointer:function(e){if("pointerdown"===e.type){if(b)return;B=setTimeout((function(){i()}),400),L=!0,w=e.pageX,C=e.pageY}else if("pointermove"===e.type)L&&!b&&a.BB.dist(w,C,e.pageX,e.pageY)>5&&(clearTimeout(B),i());else if("pointerup"===e.type){if(clearTimeout(B),b&&L)for(var n=document.elementFromPoint(e.pageX,e.pageY),r=0;r<R.length;r++)if(n===R[r].wrapper){p(),x=!0,y=r,g(),t.onChange(f[y]);break}L=!1}}});for(var T=a.BB.el({parent:k,className:"toolspace-row-button nohighlight toolspace-row-button-activated",title:v[y],onClick:function(e){if(x&&!b)return e.preventDefault(),e.stopPropagation(),void i();x=!0,t.onChange(f[y]),b&&p()},css:{padding:"10px 0",pointerEvents:"auto",height:"100%",boxSizing:"border-box"}}),E=a.BB.el({parent:T,css:{backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain",width:"calc(100% - 7px)",height:"100%",pointerEvents:"none",opacity:"0.75"}}),M=a.BB.el({parent:T,css:{position:"absolute",right:"1px",bottom:"1px",width:"18px",height:"18px",cursor:"pointer",backgroundImage:"url('"+e(h)+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"60%"},title:"More Tools",onClick:function(e){e.preventDefault(),e.stopPropagation(),i()}}),I=a.BB.el({css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0"}}),A=(new a.BB.PointerListener({target:I,pointers:1,onPointer:function(e){"pointerdown"===e.type&&(e.eventPreventDefault(),p())}}),a.BB.el({className:"tool-dropdown-wrapper",css:{position:"absolute",width:"100%",height:100*(f.length-1)+"%",top:"100%",left:"0",zIndex:"1",boxSizing:"border-box",cursor:"pointer",transition:"height 0.1s ease-in-out, opacity 0.1s ease-in-out",borderBottomLeftRadius:"5px",borderBottomRightRadius:"5px",overflow:"hidden"}})),R=[],P=0;P<f.length;P++)R.push(n({index:P,id:f[P],image:m[P],title:v[P],onClick:r}));g(),this.setIsSmall=function(e){T.style.padding=e?S:"10px 0";for(var t=0;t<f.length;t++)R[t].setIsSmall(e);e?(M.style.width="14px",M.style.height="14px"):(M.style.width="18px",M.style.height="18px")},this.setActive=function(e){if(f.includes(e)){x=!0;for(var t=0;t<f.length;t++)if(f[t]===e){y=t;break}T.classList.add("toolspace-row-button-activated"),g()}else x=!1,T.classList.remove("toolspace-row-button-activated")},this.getActive=function(){return f[y]},this.getElement=function(){return k}}})),r.register("fxAg2",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("6mHrC")})),r.register("fuF9j",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("hS5Hj")})),r.register("adBnR",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("doX4v")})),r.register("cafM1",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("7NqHO")})),r.register("gzZrf",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("dz3mY")})),r.register("9Kxky",(function(n,i){t(n.exports,"ToolspaceToolRow",(function(){return d}));var a=r("eWjiX"),o=r("84zxV"),s=r("2dTGs"),l=r("3KoFh"),c=r("eWf2I"),u=r("fc34V"),h=r("1mH1z");function d(t){var n=function(e,n){p!==e&&(p=e,g.setActive(p),f.classList.toggle("toolspace-row-button-activated","hand"===p),n&&t.onActivate(p))},r=function(e){var t=e.doLighten?"6px 0":"8px 0",n=a.BB.el({className:"toolspace-row-button nohighlight",onClick:e.onClick,css:{padding:e.contain?"10px 0":""}}),r=a.BB.el({css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%",transform:e.doMirror?"scale(-1, 1)":"",pointerEvents:"none",opacity:e.doLighten?"0.75":"1"}});return n.appendChild(r),n.pointerListener=new a.BB.PointerListener({target:n,onEnterLeave:function(e){n.classList.toggle("toolspace-row-button-hover",e)}}),n.setIsSmall=function(r){n.style.padding=e.contain?r?t:"10px 0":""},n},i=function(e){var t=document.createElement("div");a.BB.css(t,{flexGrow:"1",position:"relative"});var n=a.BB.createSvg({elementType:"svg",width:"67px",height:"54px",viewBox:"0 0 100 100",preserveAspectRatio:"none"});a.BB.css(n,{position:"absolute",left:"0",top:"0"});var r=a.BB.createSvg({elementType:"defs",childrenArr:[{elementType:"filter",id:"innershadow",x0:"-50%",y0:"-50%",width:"200%",height:"200%",childrenArr:[{elementType:"feGaussianBlur",in:"SourceAlpha",stdDeviation:"10",result:"blur"},{elementType:"feOffset",dx:"2",dy:"2"},{elementType:"feComposite",in2:"SourceAlpha",operator:"arithmetic",k2:"-1",k3:"1",result:"shadowDiff"},{elementType:"feFlood","flood-color":"#000","flood-opacity":"0.2"},{elementType:"feComposite",in2:"shadowDiff",operator:"in"},{elementType:"feComposite",in2:"SourceGraphic",operator:"over",result:"firstfilter"},{elementType:"feGaussianBlur",in:"firstfilter",stdDeviation:"10",result:"blur2"},{elementType:"feOffset",dx:"2",dy:"2"},{elementType:"feComposite",in2:"firstfilter",operator:"arithmetic",k2:"-1",k3:"1",result:"shadowDiff"},{elementType:"feFlood","flood-color":"#000","flood-opacity":"0.2"},{elementType:"feComposite",in2:"shadowDiff",operator:"in"},{elementType:"feComposite",in2:"firstfilter",operator:"over"}]}]}),i=a.BB.createSvg({elementType:"path","vector-effect":"non-scaling-stroke",d:"M0,0 L 100,0 0,100 z",fill:"rgba(0,0,0,0)",class:"toolspace-svg-triangle-button"});i.onclick=function(){e.onLeft(),i.classList.remove("toolspace-svg-triangle-button-hover")};var o=a.BB.createSvg({elementType:"path","vector-effect":"non-scaling-stroke",d:"M100,100 L 100,0 0,100 z",fill:"rgba(0,0,0,0)",class:"toolspace-svg-triangle-button"});o.onclick=function(){e.onRight(),o.classList.remove("toolspace-svg-triangle-button-hover")},t.leftPointerListener=new a.BB.PointerListener({target:i,onEnterLeave:function(e){i.classList.toggle("toolspace-svg-triangle-button-hover",e)}}),t.rightPointerListener=new a.BB.PointerListener({target:o,onEnterLeave:function(e){o.classList.toggle("toolspace-svg-triangle-button-hover",e)}}),n.appendChild(r),n.appendChild(i),n.appendChild(o),t.appendChild(n);var s=a.BB.el({css:{backgroundImage:"url('"+e.leftImage+"')",backgroundRepeat:"no-repeat",backgroundSize:"contain",width:"20px",height:"20px",position:"absolute",left:"10px",top:"8px",pointerEvents:"none"}});t.appendChild(s);var l=a.BB.el({css:{backgroundImage:"url('"+(e.rightImage?e.rightImage:e.leftImage)+"')",backgroundRepeat:"no-repeat",backgroundSize:"contain",width:"20px",height:"20px",position:"absolute",right:"10px",bottom:"8px",transform:e.rightImage?"":"scale(-1, 1)",pointerEvents:"none"}});return t.appendChild(l),t.setIsEnabledLeft=function(e){i.classList.toggle("toolspace-row-button-disabled",!e),s.classList.toggle("toolspace-row-button-disabled",!e)},t.setIsEnabledRight=function(e){o.classList.toggle("toolspace-row-button-disabled",!e),l.classList.toggle("toolspace-row-button-disabled",!e)},t},d=document.createElement("div");a.BB.css(d,{height:"54px",display:"flex",backgroundImage:"linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)"});var p="draw",g=new(0,o.ToolDropdown)({onChange:function(e){n(e,!0)}});d.appendChild(g.getElement());var f=r({onClick:function(){n("hand",!0)},image:e(s),contain:!0,doLighten:!0});f.style.borderRight="1px solid rgb(212, 212, 212)",f.title=(0,h.LANG)("tool-hand"),d.appendChild(f);var m=i({onLeft:t.onZoomIn,onRight:t.onZoomOut,leftImage:e(l),rightImage:e(c)});m.title=(0,h.LANG)("tool-zoom"),d.appendChild(m);var v=r({onClick:t.onZoomIn,image:e(l),contain:!0});v.title=(0,h.LANG)("zoom-in"),d.appendChild(v);var y=r({onClick:t.onZoomOut,image:e(c),contain:!0});y.title=(0,h.LANG)("zoom-out"),d.appendChild(y);var x=i({onLeft:t.onUndo,onRight:t.onRedo,leftImage:e(u),rightImage:null});x.title=(0,h.LANG)("tool-undo-redo"),x.setIsEnabledLeft(!1),x.setIsEnabledRight(!1),d.appendChild(x);var b=r({onClick:t.onUndo,image:e(u),contain:!0});b.title=(0,h.LANG)("undo"),b.classList.add("toolspace-row-button-disabled"),d.appendChild(b);var B=r({onClick:t.onRedo,image:e(u),contain:!0,doMirror:!0});B.title=(0,h.LANG)("redo"),B.classList.add("toolspace-row-button-disabled"),d.appendChild(B),v.style.display="none",y.style.display="none",b.style.display="none",B.style.display="none",this.getElement=function(){return d},this.setIsSmall=function(e){a.BB.css(d,{height:e?"36px":"54px"}),g.setIsSmall(e),f.setIsSmall(e),v.setIsSmall(e),y.setIsSmall(e),b.setIsSmall(e),B.setIsSmall(e),e?(m.style.display="none",x.style.display="none",v.style.display="block",y.style.display="block",b.style.display="block",B.style.display="block"):(m.style.display="block",x.style.display="block",v.style.display="none",y.style.display="none",b.style.display="none",B.style.display="none")},this.setEnableZoomIn=function(e){v.classList.toggle("toolspace-row-button-disabled",!e),m.setIsEnabledLeft(e)},this.setEnableZoomOut=function(e){y.classList.toggle("toolspace-row-button-disabled",!e),m.setIsEnabledRight(e)},this.setEnableUndo=function(e){b.classList.toggle("toolspace-row-button-disabled",!e),x.setIsEnabledLeft(e)},this.setEnableRedo=function(e){B.classList.toggle("toolspace-row-button-disabled",!e),x.setIsEnabledRight(e)},this.setActive=function(e){n(e)},this.getActive=function(){return p}}})),r.register("2dTGs",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("2gZH2")})),r.register("3KoFh",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("04ZZm")})),r.register("eWf2I",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("j9xio")})),r.register("fc34V",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("AnO0a")})),r.register("1Ax5m",(function(e,n){t(e.exports,"ToolspaceStabilizerRow",(function(){return s}));var i=r("eWjiX"),a=r("21VAD"),o=r("1mH1z");function s(e){var t=i.BB.el({tagName:"label",content:(0,o.LANG)("stabilizer")+"&nbsp;",title:(0,o.LANG)("stabilizer-title"),css:{display:"flex",alignItems:"center",fontSize:"13px",color:"rgba(0,0,0,0.6)"}}),n=new(0,a.Select)({optionArr:[["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"]],initValue:e.smoothing,onChange:function(t){e.onSelect(parseInt(t))}});t.appendChild(n.getElement());new i.BB.PointerListener({target:t,onWheel:function(e){n.setDeltaValue(e.deltaY)}});this.getElement=function(){return t}}})),r.register("e4sAN",(function(n,i){t(n.exports,"TabRow",(function(){return s}));var a=r("eWjiX"),o=r("4m0AU");function s(t){for(var n=function(e,t,n){var r={id:e.id,isVisible:!("isVisible"in e)||e.isVisible,onOpen:e.onOpen,onClose:e.onClose,update:function(e){o.className=e===r?n?"tabrow-tab tabrow-tab-opened-accented":"tabrow-tab tabrow-tab-opened":"tabrow-tab",o.style.display=r.isVisible?"block":"none"}},o=a.BB.el({content:"label"in e?e.label:"",title:"title"in e?e.title:void 0,className:t===r.id?n?"tabrow-tab tabrow-tab-opened-accented":"tabrow-tab tabrow-tab-opened":"tabrow-tab",css:{lineHeight:s+"px",display:r.isVisible?"block":"none",zIndex:"0"},onClick:function(){u!==r&&i.open(r.id)}});r.div=o,"image"in e&&a.BB.css(o,{backgroundImage:"url('"+e.image+"')",backgroundSize:s-7+"px"}),"css"in e&&a.BB.css(o,e.css),l.appendChild(o);new a.BB.PointerListener({target:o,onEnterLeave:function(e){o.classList.toggle("tabrow-tab-hover",e)}});return t===r.id?(r.onOpen(),r.div.appendChild(h),r.div.appendChild(d)):r.onClose(),r},r=function(){for(var e=0;e<c.length;e++)c[e].update(u)},i=this,s=35,l=a.BB.el({className:"tabrow",css:{height:s+"px"}}),c=[],u=null,h=a.BB.el({css:{width:"10px",height:"10px",backgroundImage:"url('".concat(e(o),"')"),backgroundSize:"cover",position:"absolute",right:"-10px",bottom:"0",pointerEvents:"none"}}),d=a.BB.el({css:{width:"10px",height:"10px",backgroundImage:"url('".concat(e(o),"')"),backgroundSize:"cover",position:"absolute",left:"-10px",bottom:"0",transform:"scale(-1,1)",pointerEvents:"none"}}),p=0;p<t.tabArr.length;p++)c.push(n(t.tabArr[p],t.initialId,t.useAccent));for(var g=0;g<c.length;g++)c[g].id===t.initialId&&(u=c[g]);if(null===u)throw"invalid initialId";this.getElement=function(){return l},this.open=function(e){for(var t=0;t<c.length;t++)if(c[t].id===e){if(u===c[t])return;return u.onClose(),(u=c[t]).onOpen(),u.div.appendChild(h),u.div.appendChild(d),void r()}throw"TabRow.open - invalid tabId"},this.getOpenedTabId=function(){return""+u.id},this.setIsVisible=function(e,t){for(var n=0;n<c.length;n++)if(c[n].id===e)return c[n].isVisible=!!t,void r();throw"TabRow.setIsVisible - invalid tabId"}}})),r.register("4m0AU",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("nTvP2")})),r.register("khi8I",(function(n,i){t(n.exports,"HandUi",(function(){return c}));var a=r("eWjiX"),o=r("bv5Zj"),s=r("2n4Fs"),l=r("1mH1z");function c(t){var n=function(){g.innerHTML=Math.round(100*c)+"%",m.innerHTML=Math.round(u)+"°",f.style.transform="rotate("+u+"deg)",f.style.boxShadow=u%90==0?"inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)":""},r=a.BB.el({css:{margin:"10px"}}),i=!0,c=t.scale,u=t.angleDeg,h=a.BB.el({css:{marginBottom:"10px",display:"flex"}}),d=a.BB.el({css:{display:"flex",marginBottom:"10px"}}),p=a.BB.el({css:{display:"flex"}});r.append(h,d,p);var g=a.BB.el({css:{width:"55px",userSelect:"none"}});h.appendChild(g);var f=new Image;f.src=e(o),a.BB.css(f,{verticalAlign:"bottom",width:"20px",height:"20px",marginRight:"5px",borderRadius:"10px",background:"rgba(0,0,0,0.2)",userSelect:"none"}),h.appendChild(f);var m=a.BB.el({css:{userSelect:"none"}});h.appendChild(m),n();var v=a.BB.el({tagName:"button",content:(0,l.LANG)("hand-reset"),onClick:t.onReset});a.BB.makeUnfocusable(v);var y=a.BB.el({tagName:"button",content:(0,l.LANG)("hand-fit"),css:{marginLeft:"10px"},onClick:t.onFit});a.BB.makeUnfocusable(y),d.append(v,y);var x=a.BB.el({tagName:"button",content:'<img height="20" src="'+e(s)+'" alt="Rotate" style="transform: scale(-1, 1)"/>',onClick:function(){t.onAngleChange(-15,!0)}});a.BB.makeUnfocusable(x);var b=a.BB.el({tagName:"button",content:"0°",css:{marginLeft:"10px"},onClick:function(){t.onAngleChange(0)}});a.BB.makeUnfocusable(b);var B=a.BB.el({tagName:"button",content:'<img height="20" src="'+e(s)+'" alt="Rotate"/>',css:{marginLeft:"10px"},onClick:function(){t.onAngleChange(15,!0)}});a.BB.makeUnfocusable(B),p.append(x,b,B),this.getElement=function(){return r},this.setIsVisible=function(e){i=!!e,r.style.display=i?"block":"none",i&&n()},this.update=function(e,t){c=e,u=t,i&&n()}}})),r.register("2n4Fs",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("6toXQ")})),r.register("dJXmR",(function(e,n){t(e.exports,"FillUi",(function(){return c}));var i=r("eWjiX"),a=r("llzZ0"),o=r("21VAD"),s=r("lXqiv"),l=r("1mH1z");function c(e){var t=i.BB.el({css:{margin:"10px"}}),n=!0,r=i.BB.el({parent:t,css:{marginBottom:"10px"}}),c=new(0,a.KlSlider)({label:(0,l.LANG)("opacity"),width:250,height:30,min:.01,max:1,value:1,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e}});t.appendChild(c.getElement());var u=new(0,a.KlSlider)({label:(0,l.LANG)("bucket-tolerance"),width:250,height:30,min:0,max:255,value:51,toValue:function(e){return 2.55*e},toDisplayValue:function(e){return e/2.55}});i.BB.css(u.getElement(),{marginTop:"10px"}),t.appendChild(u.getElement());var h,d,p=i.BB.el({parent:t,css:{display:"flex",marginTop:"10px"}});h=i.BB.el({content:(0,l.LANG)("bucket-sample")+"&nbsp;",title:(0,l.LANG)("bucket-sample-title"),css:{fontSize:"15px"}}),d=new(0,o.Select)({optionArr:[["all",(0,l.LANG)("bucket-sample-all")],["current",(0,l.LANG)("bucket-sample-active")],["above",(0,l.LANG)("bucket-sample-above")]],initValue:"all",onChange:function(e){}});var g,f;new i.BB.PointerListener({target:d.getElement(),onWheel:function(e){d.setDeltaValue(e.deltaY)}});h.appendChild(d.getElement()),p.appendChild(h),g=i.BB.el({content:(0,l.LANG)("bucket-grow")+"&nbsp;",title:(0,l.LANG)("bucket-grow-title"),css:{fontSize:"15px",marginLeft:"10px"}}),f=new(0,o.Select)({optionArr:[["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"]],initValue:"0",onChange:function(e){}});new i.BB.PointerListener({target:f.getElement(),onWheel:function(e){f.setDeltaValue(e.deltaY)}});g.appendChild(f.getElement()),p.appendChild(g);var m=!0,v=new(0,s.Checkbox)({init:!0,label:(0,l.LANG)("bucket-contiguous"),title:(0,l.LANG)("bucket-contiguous-title"),callback:function(e){m=e},css:{marginTop:"10px",paddingRight:"5px",display:"inline-block"}});t.appendChild(v.getElement()),this.getElement=function(){return t},this.setIsVisible=function(i){n=!!i,t.style.display=n?"block":"none",n&&(r.appendChild(e.colorSlider.getElement()),r.appendChild(e.colorSlider.getOutputElement()))},this.getTolerance=function(){return u.getValue()},this.getOpacity=function(){return c.getValue()},this.getSample=function(){return d.getValue()},this.getGrow=function(){return parseInt(f.getValue(),10)},this.getContiguous=function(){return m}}})),r.register("iS9xS",(function(e,n){t(e.exports,"TextUi",(function(){return o}));var i=r("eWjiX"),a=r("1mH1z");function o(e){var t=i.BB.el({css:{margin:"10px"}}),n=!0,r=i.BB.el({parent:t,css:{marginBottom:"10px"}});i.BB.el({parent:t,content:(0,a.LANG)("text-instruction")});this.getElement=function(){return t},this.setIsVisible=function(i){n=!!i,t.style.display=n?"block":"none",n&&(r.appendChild(e.colorSlider.getElement()),r.appendChild(e.colorSlider.getOutputElement()))}}})),r.register("9J17G",(function(e,n){t(e.exports,"ShapeUi",(function(){return c}));var i=r("eWjiX"),a=r("iskOY"),o=r("lXqiv"),s=r("llzZ0"),l=r("1mH1z");function c(e){var t,n,r=function(){var e=i.BB.clamp(Math.round(T.getValue()/10),1,10)+"px",t=1.35;i.BB.css(g,{fill:"none",stroke:"black",strokeWidth:e}),i.BB.css(m,{fill:"black",stroke:"none"}),i.BB.css(y,{fill:"none",stroke:"black",strokeWidth:e}),i.BB.css(b,{fill:"black",stroke:"none"}),i.BB.css(w,{fill:"none",stroke:"black",strokeWidth:e}),A.getValue()?(g.setAttribute("y",""+p),g.setAttribute("height",""+(d-2*p)),m.setAttribute("y",""+p),m.setAttribute("height",""+(d-2*p)),y.setAttribute("ry",""+(d/2-p)),b.setAttribute("ry",""+(d/2-p))):(g.setAttribute("y",""+p*t),g.setAttribute("height",""+(d-p*t*2)),m.setAttribute("y",""+p*t),m.setAttribute("height",""+(d-p*t*2)),y.setAttribute("ry",""+(d/2-p*t)),b.setAttribute("ry",""+(d/2-p*t))),R.getValue()?(w.setAttribute("y1",""+(d-p)),w.setAttribute("y2",""+p)):(w.setAttribute("y1",""+(d-p*t)),w.setAttribute("y2",""+p*t))},c=i.BB.el({css:{margin:"10px"}}),u=!0,h=i.BB.el({parent:c,css:{marginBottom:"10px"}}),d=35,p=8,g=i.BB.createSvg({elementType:"rect",x:""+p,width:""+(d-2*p)}),f=i.BB.createSvg({elementType:"svg",width:""+d,height:""+d});f.appendChild(g),i.BB.css(f,{display:"block"});var m=i.BB.createSvg({elementType:"rect",x:""+p,width:""+(d-2*p)}),v=i.BB.createSvg({elementType:"svg",width:""+d,height:""+d});v.appendChild(m),i.BB.css(v,{display:"block"});var y=i.BB.createSvg({elementType:"ellipse",cx:""+d/2,cy:""+d/2,rx:""+(d/2-p)}),x=i.BB.createSvg({elementType:"svg",width:""+d,height:""+d});x.appendChild(y),i.BB.css(x,{display:"block"});var b=i.BB.createSvg({elementType:"ellipse",cx:""+d/2,cy:""+d/2,rx:""+(d/2-p)}),B=i.BB.createSvg({elementType:"svg",width:""+d,height:""+d});B.appendChild(b),i.BB.css(B,{display:"block"});var w=i.BB.createSvg({elementType:"line",x1:""+p,x2:""+(d-p)}),C=i.BB.createSvg({elementType:"svg",width:""+d,height:""+d});C.appendChild(w),i.BB.css(C,{display:"block"});var S=i.BB.el({parent:c,css:{display:"flex",justifyContent:"space-between",alignItems:"start"}}),k=new(0,a.Options)({optionArr:[{id:"rect-stroke",label:f,title:(0,l.LANG)("shape-rect")+" "+(0,l.LANG)("shape-stroke")},{id:"ellipse-stroke",label:x,title:(0,l.LANG)("shape-ellipse")+" "+(0,l.LANG)("shape-stroke")},{id:"line",label:C,title:(0,l.LANG)("shape-line")},{id:"rect-fill",label:v,title:(0,l.LANG)("shape-rect")+" "+(0,l.LANG)("shape-fill")},{id:"ellipse-fill",label:B,title:(0,l.LANG)("shape-ellipse")+" "+(0,l.LANG)("shape-fill")}],initId:"rect",onChange:function(e){var r=e.split("-");t=r[0],n=r[1],i.BB.css(A.getElement(),{display:"line"===t?"none":null}),i.BB.css(R.getElement(),{display:"line"===t?null:"none"}),i.BB.css(T.getElement(),{display:"line"!==t&&"fill"===n?"none":null})},changeOnInit:!0});k.getElement().style.width="120px",S.appendChild(k.getElement());var L=new(0,o.Checkbox)({init:!1,label:(0,l.LANG)("eraser"),callback:function(e){r()}});S.appendChild(L.getElement());var T=new(0,s.KlSlider)({label:(0,l.LANG)("shape-line-width"),width:250,height:30,min:1,max:200,value:4,curve:"quadratic",onChange:function(e){r()}});i.BB.css(T.getElement(),{marginTop:"10px"}),c.appendChild(T.getElement());var E=new(0,s.KlSlider)({label:(0,l.LANG)("opacity"),width:250,height:30,min:.01,max:1,value:1,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e}});i.BB.css(E.getElement(),{marginTop:"10px"}),c.appendChild(E.getElement());var M=i.BB.el({parent:c,css:{display:"flex",alignItems:"center",marginTop:"10px"}}),I=new(0,o.Checkbox)({init:!1,label:(0,l.LANG)("shape-outwards"),callback:function(e){},css:{width:"50%",marginRight:"10px"}});M.appendChild(I.getElement());var A=new(0,o.Checkbox)({init:!1,label:(0,l.LANG)("shape-fixed"),callback:function(e){r()},css:{flexGrow:"1"}});M.appendChild(A.getElement());var R=new(0,o.Checkbox)({init:!1,label:(0,l.LANG)("shape-snap"),title:(0,l.LANG)("shape-snap-title"),callback:function(e){r()},css:{flexGrow:"1"}});M.appendChild(R.getElement()),r(),this.getElement=function(){return c},this.setIsVisible=function(t){u=!!t,c.style.display=u?"block":"none",u&&(h.appendChild(e.colorSlider.getElement()),h.appendChild(e.colorSlider.getOutputElement()))},this.getShape=function(){return t},this.getMode=function(){return n},this.getIsEraser=function(){return L.getValue()},this.getOpacity=function(){return E.getValue()},this.getLineWidth=function(){return T.getValue()},this.getIsOutwards=function(){return I.getValue()},this.getIsFixed=function(){return A.getValue()},this.getIsSnap=function(){return R.getValue()}}})),r.register("76Qvv",(function(e,n){t(e.exports,"newImageDialog",(function(){return c}));var i=r("eWjiX"),a=r("21VAD"),o=r("9A7OD"),s=r("ekHRj"),l=r("1mH1z");function c(e){var t=function(e,t,n,r,a){return i.BB.fitInto(e,t,Math.min(u,n-a),Math.min(u,r-a),1)},n=function(){b.value=""+Math.min(u,parseInt(b.value)),w.value=""+Math.min(u,parseInt(w.value));var e=parseInt(b.value),t=parseInt(w.value);(e<1||e>u||t<1||t>u)&&(e>u?e=u:t>u&&(t=u),b.value=""+e,w.value=""+t);for(var n=[[1,2],[2,1],[2,3],[3,2],[3,4],[4,3],[4,5],[5,4],[16,9],[9,16],[3,2],[2,3],[5,3],[3,5],[2,1],[1,2],[1.414,1],[1,1.414]],r=i.BB.reduce(e,t),a=null,o=null,s=0;s<n.length;s++)(0===s||Math.abs(n[s][0]/n[s][1]-r[0]/r[1])<o)&&(a=n[s],o=Math.abs(n[s][0]/n[s][1]-r[0]/r[1]));S.innerText=o>0&&o<.005?(0,l.LANG)("new-ratio")+": ~"+a[0]+":"+a[1]:(0,l.LANG)("new-ratio")+": "+r[0]+":"+r[1],e,t;var c=e,h=function(e,t){for(var n=e,r=t;;){if(!(n%=r))return r;if(!(r%=n))return n}}(e,t);e/=h,t/=h,t*=260,(e*=260)>260&&(t*=260/e,e=260),t>100&&(e*=100/t,t=100),z.style.width=e+"px",z.style.height=t+"px",i.BB.createCheckerDataUrl(parseInt(""+e/c*30),(function(e){N.style.background="url("+e+")"}))},r=e.currentColor,c=e.secondaryColor,u=e.maxCanvasSize,h=e.canvasWidth,d=e.canvasHeight,p=e.workspaceWidth,g=e.workspaceHeight,f=e.onConfirm,m=e.onCancel,v=document.createElement("div"),y=document.createElement("div"),x=document.createElement("div"),b=document.createElement("input"),B=document.createElement("div"),w=document.createElement("input"),C=document.createElement("div");y.style.position="relative",y.style.width="145px",y.style.height="35px",y.style.lineHeight="30px",x.style.width="145px",x.style.height="35px",x.style.lineHeight="30px",B.innerText=(0,l.LANG)("new-px"),B.style.color="#888",B.style.fontSize="12px",B.style.marginLeft="5px",B.style.cssFloat="right",C.innerText=(0,l.LANG)("new-px"),C.style.color="#888",C.style.fontSize="12px",C.style.marginLeft="5px",C.style.cssFloat="right",b.setAttribute("data-ignore-focus","true"),w.setAttribute("data-ignore-focus","true"),b.type="number",b.min="1",b.max=u,b.style.cssFloat="right",b.style.width="70px",w.type="number",w.min="1",w.max=u,w.style.cssFloat="right",w.style.width="70px",b.value=h,w.value=d,b.onclick=function(){this.focus(),n()},w.onclick=function(){this.focus(),n()},y.appendChild(B),y.appendChild(b),i.BB.appendTextDiv(y,(0,l.LANG)("width")+": "),x.appendChild(C),x.appendChild(w),i.BB.appendTextDiv(x,(0,l.LANG)("height")+": ");var S=document.createElement("div");S.style.marginTop="5px",S.style.color="#888";var k=document.createElement("div"),L=document.createElement("button");k.style.marginBottom="10px";var T=document.createElement("button"),E=document.createElement("button"),M=document.createElement("button"),I=document.createElement("button"),A=document.createElement("button");T.textContent=(0,l.LANG)("new-current"),L.textContent=(0,l.LANG)("new-fit"),A.textContent=(0,l.LANG)("new-oversize"),M.textContent=(0,l.LANG)("new-landscape"),I.textContent=(0,l.LANG)("new-portrait"),E.textContent=(0,l.LANG)("new-square"),T.style.marginRight="5px",L.style.marginRight="5px",A.style.marginRight="5px",M.style.marginTop="5px",M.style.marginRight="5px",I.style.marginTop="5px",I.style.marginRight="5px",k.appendChild(T),k.appendChild(L),k.appendChild(A),k.appendChild(E),k.appendChild(M),k.appendChild(I);T.onclick=function(){b.value=h,w.value=d,n()},L.onclick=function(){b.value=p,w.value=g,n()},A.onclick=function(){b.value=p+500,w.value=g+500,n()},E.onclick=function(){var e=t(1,1,p,g,50);b.value=""+Math.round(e.width),w.value=""+Math.round(e.height),n()},M.onclick=function(){var e=t(4,3,p,g,50);b.value=""+Math.round(e.width),w.value=""+Math.round(e.height),n()},I.onclick=function(){var e=t(3,4,p,g,50);b.value=""+Math.round(e.width),w.value=""+Math.round(e.height),n()};var R=new(0,a.Select)({isFocusable:!0,optionArr:[["screen",(0,l.LANG)("new-screen")],["16 9",(0,l.LANG)("new-video")+" 16:9"],["3 2","3:2"],["5 3","5:3"],["2 1","2:1"],["paper",(0,l.LANG)("new-din-paper")+" √2:1"],["9 16","9:16"],["2 3","2:3"],["3 5","3:5"],["1 2","1:2"],["1 1.4142135623730951","1:√2"]],onChange:function(e){if("screen"===e)b.value=""+window.screen.width,w.value=""+window.screen.height;else if("paper"===e){var r=t(Math.sqrt(2),1,p,g,50);b.value=""+Math.round(r.width),w.value=""+Math.round(r.height)}else{var i=e.split(" "),a=t(parseFloat(i[0]),parseFloat(i[1]),p,g,50);b.value=""+Math.round(a.width),w.value=""+Math.round(a.height)}n(),R.setValue(null)}});setTimeout((function(){R.setValue(null)}),0),i.BB.css(R.getElement(),{width:"80px"}),k.appendChild(R.getElement());var P={r:255,g:255,b:255,a:1},O=[{r:255,g:255,b:255,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:0}];O.push({r:r.r,g:r.g,b:r.b,a:1}),O.push({r:c.r,g:c.g,b:c.b,a:1});var D=new(0,o.ColorOptions)({colorArr:O,onChange:function(e){P=e,z.style.backgroundColor="rgba("+e.r+","+e.g+","+e.b+", "+e.a+")"}}),N=document.createElement("div");i.BB.css(N,{boxSizing:"border-box",width:"340px",height:"140px",display:"table",backgroundColor:"#9e9e9e",padding:"10px",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",marginLeft:"-20px",colorScheme:"only light"});var z=document.createElement("div");i.BB.css(z,{width:"200px",height:"100px",backgroundColor:"#fff",marginLeft:"auto",marginRight:"auto",color:"#aaa",fontSize:"16px",fontWeight:"bold",textAlign:"center",verticalAlign:"center",display:"table",overflow:"hidden",boxShadow:"0px 0px 3px rgba(0,0,0,0.5)"});var G=document.createElement("div");G.style.display="table-cell",G.style.verticalAlign="middle",G.appendChild(z),N.appendChild(G);var j=i.BB.appendTextDiv(z,"");j.style.display="table-cell",j.style.verticalAlign="middle";parseInt(b.value),parseInt(w.value);b.onchange=function(){(""===b.value||parseInt(b.value)<0)&&(b.value="1"),n()},b.onkeyup=function(){n()},w.onchange=function(){(""===w.value||parseFloat(w.value)<0)&&(w.value="1"),n()},w.onkeyup=function(){n()},n(),v.appendChild(k);var H=i.BB.el({parent:v,css:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"}}),X=i.BB.el({parent:H});X.appendChild(y),X.appendChild(x),X.appendChild(S),H.appendChild(D.getElement()),v.appendChild(N),(0,s.popup)({target:document.body,message:"<b>".concat((0,l.LANG)("new-title"),"</b>"),div:v,buttons:["Ok","Cancel"],callback:function(e){b.onclick=null,w.onclick=null,T.onclick=null,L.onclick=null,A.onclick=null,E.onclick=null,M.onclick=null,I.onclick=null,b.onchange=null,b.onkeyup=null,w.onchange=null,w.onkeyup=null,R.destroy(),D.destroy(),"Cancel"===e||parseInt(b.value)<=0||parseInt(w.value)<=0||isNaN(parseInt(b.value))||isNaN(parseInt(w.value))?m():f(parseInt(b.value),parseInt(w.value),P)},clickOnEnter:"Ok"})}})),r.register("1uc3b",(function(n,i){t(n.exports,"ToolspaceCollapser",(function(){return l}));var a=r("eWjiX"),o=r("jiQkU"),s=r("1mH1z");function l(t){var n=function(){c.style.transform="left"===i?r?"rotate(180deg)":"":r?"":"rotate(180deg)"},r=!0,i="right",l=a.BB.el({css:{width:"36px",height:"36px",background:"rgba(100, 100, 100, 0.9)",color:"#fff",position:"absolute",top:"0",textAlign:"center",lineHeight:"36px",cursor:"pointer",userSelect:"none",padding:"6px",boxSizing:"border-box"},title:(0,s.LANG)("toggle-show-tools"),onClick:function(e){e.preventDefault(),r=!r,n(),t.onChange()}}),c=a.BB.el({parent:l,css:{backgroundImage:"url(".concat(e(o),")"),width:"100%",height:"100%",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",userSelect:"none"}});l.oncontextmenu=function(){return!1},this.isOpen=function(){return r},this.setDirection=function(e){i=e,n()},this.getElement=function(){return l}}})),r.register("jiQkU",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("b1UMP")})),r.register("keKW3",(function(n,i){t(n.exports,"textToolDialog",(function(){return C}));var a=r("3Rl3W"),o=r("a7ch7"),s=r("eWjiX"),l=r("h20yl"),c=r("9A7OD"),u=r("21VAD"),h=r("gmlbk"),d=r("jKOQl"),p=r("llzZ0"),g=r("ekHRj"),f=r("2dqOY"),m=r("rk4vM"),v=r("hucjG"),y=r("cZa2s"),x=r("03Zd8"),b=r("3KoFh"),B=r("eWf2I"),w=r("1mH1z");function C(t){var n=function(){P.clearRect(0,0,R.width,R.height);var e=(0,o.default)((0,a.default)({},t.color),{a:ce.getValue()}),n=(0,l.renderText)(R,{x:t.x,y:t.y,textStr:ue.value,align:oe.getValue(),isItalic:se.getValue(),isBold:le.getValue(),size:parseFloat(ie.value),font:Z.getValue(),color:s.BB.ColorConverter.toRgbaStr(e),angleRad:t.angleRad});n.width=Math.max(n.width,1),n.height=Math.max(n.height,1);var r=s.BB.rotate(n.x,n.y,-t.angleRad/Math.PI*180),i=s.BB.rotate(n.width,n.height,-t.angleRad/Math.PI*180),c=t.x+r.x+i.x/2,u=t.y+r.y+i.y/2,h=s.BB.fitInto(n.width,n.height,E-100,M-100);I=Math.min(1,h.width/n.width),I=Math.min(4,I*Math.pow(2,ee)),D.save(),I>=4?D.imageSmoothingEnabled=!1:(D.imageSmoothingEnabled=!0,D.imageSmoothingQuality=I>=1?"low":"medium"),D.clearRect(0,0,G.width,G.height),D.translate(E/2,M/2),D.scale(I,I),D.rotate(t.angleRad),D.drawImage(A[t.layerIndex].canvas,-c,-u),D.drawImage(R,-c,-u),D.restore(),z.save(),z.fillStyle="rgb(158,158,158)",z.fillRect(0,0,E,M),z.save(),z.translate(E/2,M/2),z.scale(I,I),z.rotate(t.angleRad),z.imageSmoothingEnabled=!1;var d=1/I;z.globalAlpha=.2,z.drawImage(F,-c-d,-u-d,R.width+2*d,R.height+2*d),z.globalAlpha=1,z.globalCompositeOperation="destination-out",z.drawImage(F,-c,-u,R.width,R.height),z.restore(),I>=4?z.imageSmoothingEnabled=!1:(z.imageSmoothingEnabled=!0,z.imageSmoothingQuality=I>=1?"low":"medium"),z.save(),z.translate(E/2,M/2),z.scale(I,I),z.rotate(t.angleRad);for(var p=0;p<t.layerIndex;p++)A[p].opacity>0&&(z.globalAlpha=A[p].opacity,z.globalCompositeOperation=A[p].mixModeStr,z.drawImage(A[p].canvas,-c,-u));z.restore(),z.globalAlpha=A[t.layerIndex].opacity,z.globalCompositeOperation=A[t.layerIndex].mixModeStr,z.drawImage(O,0,0),z.save(),z.translate(E/2,M/2),z.scale(I,I),z.rotate(t.angleRad);for(var g=t.layerIndex+1;g<A.length;g++)A[g].opacity>0&&(z.globalAlpha=A[g].opacity,z.globalCompositeOperation=A[g].mixModeStr,z.drawImage(A[g].canvas,-c,-u));z.restore(),z.restore(),j.save(),j.fillStyle=X,j.fillRect(0,0,G.width,G.height),j.drawImage(N,0,0),j.restore(),j.save(),j.globalCompositeOperation="difference",j.strokeStyle="#fff",j.lineWidth=1,j.strokeRect(Math.round(E/2-n.width/2*I),Math.round(M/2-n.height/2*I),Math.round(n.width*I),Math.round(n.height*I)),j.restore()},r=function(e,r){var i=s.BB.rotate(e,r,-t.angleRad/Math.PI*180);t.x+=i.x/I,t.y+=i.y/I,n()},i=function(e){ee=Math.min(2,Math.max(-2,ee+e)),n(),ne.disabled=!C(1),re.disabled=!C(-1)},C=function(e){return ee!==Math.min(2,Math.max(-2,ee+e))},S=function(){window.scrollTo(0,0)},k=s.BB.el({}),L=window.innerWidth<550,T=window.innerHeight<630,E=L?340:540,M=L?T?210:260:T?230:350,I=1,A=t.klCanvas.getLayersFast(),R=s.BB.canvas(t.klCanvas.getWidth(),t.klCanvas.getHeight()),P=R.getContext("2d"),O=s.BB.canvas(E,M),D=O.getContext("2d"),N=s.BB.canvas(E,M),z=N.getContext("2d"),G=s.BB.canvas(E,M),j=G.getContext("2d");s.BB.css(G,{display:"block"});var H=s.BB.el({parent:k,css:{position:"relative",width:E+"px",marginLeft:"-20px",cursor:"move",colorScheme:"only light",touchAction:"none"},onClick:function(){ue.focus()}});s.BB.el({parent:H,css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",pointerEvents:"none"}}),H.appendChild(G);var X=j.createPattern(s.BB.createCheckerCanvas(8),"repeat"),F=s.BB.canvas(1,1);F.getContext("2d").fillRect(0,0,1,1);var U=new s.BB.PointerListener({target:G,pointers:1,onPointer:function(e){"pointermove"===e.type&&e.button&&(e.eventPreventDefault(),r(-e.dX,-e.dY))},onWheel:function(e){i(-e.deltaY)}}),K=function(e){e.preventDefault()};s.BB.addEventListener(G,"wheel",K);var V=s.BB.el({parent:k,css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"10px"}}),W=s.BB.el({parent:k,css:L?{}:{display:"flex",alignItems:"center",justifyContent:"space-between"}}),Y=s.BB.el({parent:W,css:{display:"flex",alignItems:"center",marginTop:"5px"}}),_=s.BB.el({parent:W,css:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:"5px",width:L?"":"300px"}}),q=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];q.unshift({r:t.secondaryColor.r,g:t.secondaryColor.g,b:t.secondaryColor.b,a:1}),q.unshift({r:t.color.r,g:t.color.g,b:t.color.b,a:1});var Q=new(0,c.ColorOptions)({colorArr:q,initialIndex:0,onChange:function(e){t.color=e,n()}});Q.getElement().title=(0,w.LANG)("text-color"),Q.getElement().style.marginLeft="-5px",V.appendChild(Q.getElement());var J,Z,$,ee=0,te=s.BB.el({parent:V,css:{}}),ne=s.BB.el({parent:te,content:'<img height="20" src="'.concat(e(b),'">'),title:(0,w.LANG)("zoom-in"),tagName:"button",onClick:function(){i(1)},css:{fontWeight:"bold"}}),re=s.BB.el({parent:te,content:'<img height="20" src="'.concat(e(B),'">'),title:(0,w.LANG)("zoom-out"),tagName:"button",onClick:function(){i(-1)},css:{fontWeight:"bold",marginLeft:"5px"}}),ie=s.BB.el({parent:Y,tagName:"input",title:(0,w.LANG)("text-size"),custom:{type:"number",min:1,max:1e4,value:t.size},css:{width:"60px"},onChange:function(){ie.value=""+Math.max(1,Math.min(1e4,parseInt(ie.value))),n()}}),ae=new s.BB.PointerListener({target:ie,onWheel:function(e){ie.value=""+Math.max(1,Math.min(1e3,parseInt(ie.value)-e.deltaY)),n()}});J=s.BB.el({css:{fontSize:"15px",marginLeft:"10px"}}),Z=new(0,u.Select)({isFocusable:!0,optionArr:[["sans-serif","Sans-serif"],["serif","Serif"],["monospace","Monospace"],["cursive","Cursive"],["fantasy","Fantasy"]],initValue:t.font,onChange:function(e){n()}}),J.appendChild(Z.getElement()),Y.appendChild(J),$=new s.BB.PointerListener({target:Z.getElement(),onWheel:function(e){Z.setDeltaValue(e.deltaY)}});var oe=new(0,h.ImageRadioList)({optionArr:[{id:"left",title:(0,w.LANG)("text-left"),image:e(f)},{id:"center",title:(0,w.LANG)("text-center"),image:e(m)},{id:"right",title:(0,w.LANG)("text-right"),image:e(v)}],initId:t.align,onChange:function(e){n()}});_.appendChild(oe.getElement());var se=new(0,d.ImageToggle)({image:e(y),title:(0,w.LANG)("text-italic"),initValue:t.isItalic,onChange:function(e){n()}});_.appendChild(se.getElement());var le=new(0,d.ImageToggle)({image:e(x),title:(0,w.LANG)("text-bold"),initValue:t.isBold,onChange:function(e){n()}});_.appendChild(le.getElement());var ce=new(0,p.KlSlider)({label:(0,w.LANG)("opacity"),width:150,height:30,min:.01,max:1,value:t.opacity,resolution:225,eventResMs:1e3/30,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e},onChange:function(e){n()}});_.appendChild(ce.getElement());var ue=s.BB.el({parent:k,tagName:"textarea",custom:{placeholder:(0,w.LANG)("text-placeholder"),"data-ignore-focus":"true"},css:{whiteSpace:"pre",overflow:"auto",width:"100%",height:"70px",resize:"vertical",marginTop:"10px"},onChange:function(){n()}});ue.addEventListener("input",n),setTimeout((function(){ue.focus(),ue.select()}));var he=new s.BB.KeyListener({onDown:function(e,t,n){s.BB.isInputFocused(!0)||("left"===e&&r(-1,0),"right"===e&&r(1,0),"up"===e&&r(0,-1),"down"===e&&r(0,1))}});window.addEventListener("scroll",S),(0,g.popup)({target:document.body,message:"<b>".concat((0,w.LANG)("text-title"),"</b>"),div:k,buttons:["Ok","Cancel"],style:L?{}:{width:"500px"},callback:function(e){var r={x:t.x,y:t.y,textStr:ue.value,align:oe.getValue(),isItalic:se.getValue(),isBold:le.getValue(),color:t.color,size:ie.value,font:Z.getValue(),opacity:ce.getValue()};window.removeEventListener("scroll",S),ue.removeEventListener("input",n),s.BB.destroyEl(ue),U.destroy(),ae.destroy(),$.destroy(),s.BB.removeEventListener(G,"wheel",K),s.BB.destroyEl(H),s.BB.destroyEl(ne),s.BB.destroyEl(re),s.BB.destroyEl(ie),Q.destroy(),Z.destroy(),he.destroy(),oe.destroy(),se.destroy(),le.destroy(),ce.destroy(),"Ok"===e&&t.onConfirm(r)},autoFocus:!1,clickOnEnter:"Ok",ignoreBackground:!0,closefunc:function(e){e}}),n()}})),r.register("2dqOY",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("lvwQ5")})),r.register("rk4vM",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("imAvm")})),r.register("hucjG",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("dC0sF")})),r.register("cZa2s",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("h3hPo")})),r.register("03Zd8",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("1pAeY")})),r.register("kDGzx",(function(e,n){t(e.exports,"showImportImageDialog",(function(){return c}));var i=r("eWjiX"),a=r("hRdOL"),o=r("lXqiv"),s=r("ekHRj"),l=r("1mH1z");function c(e){var t,n=function(n,r){var a=i.BB.fitInto(n,r,e.maxSize,e.maxSize);a.width<n?(t.innerHTML='<span style="color:#f00">'.concat(n," X ").concat(r,"</span> ⟶ ").concat(Math.round(a.width)," X ").concat(Math.round(a.height)),t.title=(0,l.LANG)("import-too-large")):(t.innerHTML="".concat(n," X ").concat(r),t.title="")},r=i.BB.el({}),c=window.innerWidth<550||window.innerHeight<550,u=c?{}:{width:"500px"},h=new(0,a.CropCopy)({width:c?340:540,height:c?300:400,canvas:e.image.canvas,isNotCopy:!0,onChange:function(e,r){t&&n(e,r)}});i.BB.css(h.getEl(),{marginLeft:"-20px",borderTop:"1px solid #bbb",borderBottom:"1px solid #bbb"}),h.getEl().title=(0,l.LANG)("crop-drag-to-crop"),r.appendChild(h.getEl()),t=i.BB.el({parent:r,css:{marginTop:"10px",textAlign:"center",color:"#888",lineHeight:"20px"}}),n(e.image.width,e.image.height);var d,p=!1;if("psd"===e.image.type){var g={background:"rgba(255,255,0,0.5)",padding:"10px",marginTop:"5px",marginBottom:"5px",border:"1px solid #e7d321",borderRadius:"5px"};if(e.image.layers){if(d=new(0,o.Checkbox)({init:p,label:(0,l.LANG)("import-flatten"),callback:function(e){p=e}}),r.appendChild(d.getElement()),e.image.warningArr){var f=i.BB.el({content:(0,l.LANG)("import-psd-limited-support"),css:g});f.appendChild(i.BB.el({tagName:"a",content:"Details",onClick:function(){!function(e){for(var t=[],n={mask:"Masks not supported. Mask was applied.",clipping:"Clipping not supported. Clipping layers were merged.",group:"Groups not supported. Layers were ungrouped.",adjustment:"Adjustment layers not supported.","layer-effect":"Layer effects not supported.","smart-object":"Smart objects not supported.","blend-mode":"Unsupported layer blend mode.","bits-per-channel":"Unsupported color depth. Only 8bit per channel supported."},r=0;r<e.length;r++)t.push("- "+n[e[r]]);alert(t.join("\n"))}(e.image.warningArr)}})),r.appendChild(f)}}else{var m=i.BB.el({content:(0,l.LANG)("import-psd-unsupported"),css:g});r.appendChild(m)}}(0,s.popup)({target:e.target,message:"<b>".concat((0,l.LANG)("import-title"),"</b>"),div:r,style:u,buttons:[(0,l.LANG)("import-btn-as-layer"),(0,l.LANG)("import-btn-as-image"),"Cancel"],callback:function(t){var n=h.getCroppedImage(),r=h.getRect();h.destroy(),d&&d.destroy(),t===(0,l.LANG)("import-btn-as-layer")?e.callback({type:"as-layer",image:n}):t===(0,l.LANG)("import-btn-as-image")?"psd"===e.image.type?(p&&(e.image.layers=null),e.callback({type:"as-image-psd",image:e.image,cropObj:r})):"image"===e.image.type&&e.callback({type:"as-image",image:n}):e.callback({type:"cancel"})},autoFocus:"As Image"})}})),r.register("941rU",(function(e,n){t(e.exports,"blendPsdToKl",(function(){return u})),t(e.exports,"blendKlToPsd",(function(){return h})),t(e.exports,"readPsd",(function(){return d})),t(e.exports,"klPsdToKlProject",(function(){return p}));var i,a,o=r("eelgW"),s=r("1mH1z"),l=r("705qg");function c(){if(!i){i={"source-over":"normal",darken:"darken",multiply:"multiply","color-burn":"color burn",lighten:"lighten",screen:"screen","color-dodge":"color dodge",overlay:"overlay","soft-light":"soft light","hard-light":"hard light",difference:"difference",exclusion:"exclusion",hue:"hue",saturation:"saturation",color:"color",luminosity:"luminosity"},a={};for(var e=Object.keys(i),t=0;t<e.length;t++)a[i[e[t]]]=e[t]}}function u(e){return c(),a[e]}function h(e){return c(),i[e]}function d(e){var t=function(e){i.warningArr||(i.warningArr=[]),i.warningArr.includes(e)||i.warningArr.push(e)},n=function(e){var n=u(e);return n||(t("blend-mode"),n="source-over"),n},r=function(e,t){var n=e.getContext("2d"),r=n.getImageData(0,0,e.width,e.height);if(0===t)for(var i=0;i<r.data.length;i+=4)r.data[i+3]=r.data[i];else for(var a=0;a<r.data.length;a+=4)r.data[a+3]=255-r.data[a];n.putImageData(r,0,0)},i={type:"psd",canvas:e.canvas,width:e.width,height:e.height};if(8!==e.bitsPerChannel&&t("bits-per-channel"),!e.children)return i.error=!0,i;var a=l.MAX_LAYERS,s=0;if(s+=function e(n){var r=0;if(n.blendMode){var i=u(n.blendMode);if(i&&"source-over"!==i)return 1}for(var a=0;a<n.children.length;a++){var o=n.children[a];o.clipping||o.adjustment||(o.children?(t("group"),r+=e(o)):r++)}return r}(e),s>a)return i.error=!0,i;return i.layers=[],i.layers=function e(a){var s,l,c=[],u=a.hidden?0:a.opacity,h=n(a.blendMode);"source-over"!==h&&(l=(s=(0,o.createCanvas)(i.width,i.height)).getContext("2d")),a.mask&&(t("mask"),r(a.mask.canvas,a.mask.defaultColor));for(var d=0;d<a.children.length;d++){var p=a.children[d];if(!p.clipping)if(p.adjustment)t("adjustment");else{var g=(p.children||p.canvas)&&a.children[d+1]&&a.children[d+1].clipping;if(g&&t("clipping"),p.children)for(var f=e(p),m=0;m<f.length;m++){var v=f[m],y=v.image.getContext("2d");if(g){var x=(0,o.createCanvas)(i.width,i.height),b=x.getContext("2d");b.drawImage(v.image,0,0);for(var B=d+1;B<a.children.length&&a.children[B].clipping;B++){var w=a.children[B];0===w.opacity||w.hidden||(b.globalCompositeOperation=n(w.blendMode),b.globalAlpha=w.opacity,b.drawImage(w.canvas,w.left,w.top))}y.globalCompositeOperation="source-atop",y.drawImage(x,0,0)}a.mask&&(y.globalCompositeOperation=0===a.mask.defaultColor?"destination-in":"destination-out",y.drawImage(a.mask.canvas,a.mask.left,a.mask.top)),s?(l.globalCompositeOperation=v.mixModeStr,l.globalAlpha=v.opacity,l.drawImage(v.image,0,0)):(v.opacity=v.opacity*u,c.push(v))}else{var C=(0,o.createCanvas)(i.width,i.height),S=C.getContext("2d");if(p.canvas&&S.drawImage(p.canvas,p.left,p.top),p.effects&&t("layer-effect"),p.mask&&(t("mask"),r(p.mask.canvas,p.mask.defaultColor),S.globalCompositeOperation=0===p.mask.defaultColor?"destination-in":"destination-out",S.drawImage(p.mask.canvas,p.mask.left,p.mask.top)),g){var k=(0,o.createCanvas)(p.right-p.left,p.bottom-p.top),L=k.getContext("2d");L.drawImage(p.canvas,0,0);for(var T=d+1;T<a.children.length&&a.children[T].clipping;T++){var E=a.children[T];0===E.opacity||E.hidden||(L.globalCompositeOperation=n(E.blendMode),L.globalAlpha=E.opacity,L.drawImage(E.canvas,E.left-p.left,E.top-p.top))}S.globalCompositeOperation="source-atop",S.drawImage(k,p.left,p.top)}a.mask&&(S.globalCompositeOperation=0===a.mask.defaultColor?"destination-in":"destination-out",S.drawImage(a.mask.canvas,a.mask.left,a.mask.top)),s?u>0&&(l.globalCompositeOperation=n(p.blendMode),l.globalAlpha=p.hidden?0:p.opacity,l.drawImage(C,0,0)):c.push({name:p.name,opacity:(p.hidden?0:p.opacity)*u,mixModeStr:n(p.blendMode),image:C})}}}return s&&(c=[{name:a.name,opacity:u,mixModeStr:h,image:s}]),c}({name:"root",opacity:1,blendMode:"normal",children:e.children}),i}function p(e){var t={width:e.width,height:e.height,layers:[]};return e.layers?t.layers=t.layers.concat(e.layers.map((function(e){return{name:e.name,opacity:e.opacity,mixModeStr:e.mixModeStr,image:e.image}}))):t.layers.push({name:(0,s.LANG)("background"),opacity:1,mixModeStr:"source-over",image:e.canvas}),t}})),r.register("9BlwZ",(function(e,n){t(e.exports,"setDbName",(function(){return o})),t(e.exports,"getKlProjectObj",(function(){return l})),t(e.exports,"storeKlProjectObj",(function(){return c})),t(e.exports,"clear",(function(){return u}));var r=!!window.indexedDB,i="Klecks",a="ProjectStore";function o(e){i=""+e}function s(e,t,n){var o=function(e){s||(s=!0,n(e))},s=!1;if(r){var l;try{l=window.indexedDB.open(i,1)}catch(e){return void o(e.message)}l.onupgradeneeded=function(e){try{l.result.createObjectStore(a,{keyPath:"id"}).createIndex("id","id",{unique:!0})}catch(e){o(e.message)}},l.onerror=function(e){o("indexedDB.open failed, "+l.error)},l.onsuccess=function(n){var r,c,u;try{if(!(r=l.result).objectStoreNames.contains(a))return window.indexedDB.deleteDatabase(i),void o("object store ProjectStore missing. destroying db");(u=(c=r.transaction(a,"readwrite")).objectStore(a)).index("id")}catch(e){return void o(e.message)}r.onerror=function(e){o("database error, "+r.error)};try{e(u)}catch(e){return void o(e.message)}c.oncomplete=function(){s||(s=!0,t()),r.close()},c.onerror=function(){o("transaction error, "+c.error)}}}else setTimeout((function(){o("no indexed db available")}),0)}function l(e,t){var n;r?s((function(e){n=e.get(1)}),(function(){e(n.result)}),(function(e){t("execIndexedDBTransaction error, "+e)})):e(null)}function c(e,t,n){s((function(t){t.put(e)}),(function(){t()}),(function(e){n(e)}))}function u(e,t){s((function(e){e.delete(1)}),(function(){e()}),(function(e){t(e)}))}})),r.register("kyVjY",(function(n,i){t(n.exports,"filterLibStatus",(function(){return B})),t(n.exports,"filterLib",(function(){return w}));var a=r("8k5kH"),o=r("4UkHZ"),s=r("e7LnL"),l=r("iI5sC"),c=r("eySuj"),u=r("iPRwU"),h=r("krmR4"),d=r("92iBR"),p=r("2n4Fs"),g=r("bFASM"),f=r("9m6gZ"),m=r("4fkq2"),v=r("dPWA8"),y=r("cQHFd"),x=r("9vOYE"),b=r("as29q"),B={isLoaded:!1},w={brightnessContrast:{lang:{name:"filter-bright-contrast-title",button:"filter-bright-contrast"},icon:e(a),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},cropExtend:{lang:{name:"filter-crop-title",button:"filter-crop-extend"},icon:e(o),updatePos:!0,getDialog:null,apply:null,inEmbed:!1},curves:{lang:{name:"filter-curves-title",button:"filter-curves"},icon:e(s),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},flip:{lang:{name:"filter-flip-title",button:"filter-flip"},icon:e(l),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},hueSaturation:{lang:{name:"filter-hue-sat-title",button:"filter-hue-sat"},icon:e(c),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},invert:{lang:{name:"filter-invert",button:"filter-invert"},icon:e(u),updatePos:!1,isInstant:!0,getDialog:null,apply:null,inEmbed:!0},perspective:{lang:{name:"filter-perspective-title",button:"filter-perspective"},icon:e(h),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},resize:{lang:{name:"filter-resize-title",button:"filter-resize"},icon:e(d),updatePos:!0,getDialog:null,apply:null,inEmbed:!1},rotate:{lang:{name:"filter-rotate-title",button:"filter-rotate"},icon:e(p),updatePos:!0,getDialog:null,apply:null,inEmbed:!1},tiltShift:{lang:{name:"filter-tilt-shift-title",button:"filter-tilt-shift"},icon:e(g),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},toAlpha:{lang:{name:"filter-to-alpha-title",button:"filter-to-alpha"},icon:e(f),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},transform:{lang:{name:"filter-transform-title",button:"filter-transform"},icon:e(m),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},blur:{lang:{name:"filter-triangle-blur-title",button:"filter-triangle-blur"},icon:e(v),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},unsharpMask:{lang:{name:"filter-unsharp-mask-title",button:"filter-unsharp-mask"},icon:e(y),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},grid:{lang:{name:"filter-grid",button:"filter-grid"},icon:e(x),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},noise:{lang:{name:"filter-noise",button:"filter-noise"},icon:e(b),updatePos:!1,getDialog:null,apply:null,inEmbed:!0}}})),r.register("8k5kH",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("5tPq3")})),r.register("4UkHZ",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("cazOx")})),r.register("e7LnL",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("245NA")})),r.register("iI5sC",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("1hkCG")})),r.register("eySuj",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("k2eFf")})),r.register("iPRwU",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("krKGd")})),r.register("krmR4",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("ehfxY")})),r.register("92iBR",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("beOjS")})),r.register("bFASM",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("Gk9bV")})),r.register("9m6gZ",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("csed7")})),r.register("4fkq2",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("equSE")})),r.register("dPWA8",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("h1dN3")})),r.register("cQHFd",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("LfAXI")})),r.register("9vOYE",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("cB6q6")})),r.register("as29q",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("S9ano")})),r.register("dAXbp",(function(e,n){t(e.exports,"brushes",(function(){return h}));var i=r("68QTJ"),a=r("5PSXS"),o=r("ewgr9"),s=r("kic4a"),l=r("7cUpm"),c=r("ltaBP"),u=r("6Nq1H"),h={PenBrush:i.PenBrush,BlendBrush:a.BlendBrush,SketchyBrush:o.SketchyBrush,PixelBrush:s.PixelBrush,ChemyBrush:u.ChemyBrush,SmudgeBrush:c.SmudgeBrush,EraserBrush:l.EraserBrush}})),r.register("68QTJ",(function(e,n){t(e.exports,"PenBrush",(function(){return s}));var i=r("eWjiX"),a=r("5CF7D"),o=r("hrnUX");function s(){var e,t,n,r,s,l,c=function(e){return m*(y?e*e:1)},u=function(){if(C!==b&&C!==w)for(var e,t=[[E,128],[M,64],[I,32]],r=0;r<t.length;r++)(e=t[r][0].getContext("2d")).save(),e.clearRect(0,0,t[r][1],t[r][1]),e.fillStyle="rgba("+n.r+", "+n.g+", "+n.b+", "+T[C]+")",e.fillRect(0,0,t[r][1],t[r][1]),e.globalCompositeOperation="destination-in",e.imageSmoothingQuality="high",e.drawImage(a.alphaImArr[C],0,0,t[r][1],t[r][1]),e.restore()},h=function(t,n,i,a,o,s){if(!(i<=0))if(x&&(e.globalCompositeOperation="source-atop"),s&&s[3]===a||(e.globalAlpha=a),s||C!==b&&C!==w||(e.fillStyle=r),C===b)e.beginPath(),e.arc(t,n,i,0,R),e.closePath(),e.fill(),P=!0;else if(C===w)void 0!==o&&(e.save(),e.translate(t,n),e.rotate(o/180*Math.PI),e.fillRect(-i,-i,2*i,2*i),e.restore(),P=!0);else{e.save(),e.translate(t,n);var l=E;i<=32&&i>16?l=M:i<=16&&(l=I),e.scale(i,i),C===B&&e.rotate(53123*(t+n)%R),e.drawImage(l,-1,-1,2,2),e.restore(),P=!0}},d=function(t,n,r,a){null===A&&(A=new i.BB.BezierLine).add(S.x,S.y,0,(function(){}));var o=[];function s(e){var t=i.BB.mix(k.pressure,a,e.t),n=c(t),r=Math.max(.1,g*(v?t:1));o.push([e.x,e.y,r,n,e.angle])}var l,u=r*f;null===t?A.addFinal(u,s):A.add(t,n,u,s),e.save();for(var d=0;d<o.length;d++){var p=o[d];h(p[0],p[1],p[2],p[3],p[4],l),l=p}e.restore()},p=new o.KL.DecoyKlHistory,g=2,f=.8489,m=1,v=!0,y=!1,x=!1,b=0,B=1,w=3,C=b,S={x:0,y:0,pressure:0},k={x:0,y:0,pressure:0},L=!1,T=[1,.9,1,1],E=i.BB.canvas(128,128),M=i.BB.canvas(64,64),I=i.BB.canvas(32,32),A=null,R=2*Math.PI,P=!1;this.startLine=function(r,a,o){(t={tool:["brush","PenBrush"],actions:[]}).actions.push({action:"opacityPressure",params:[y]}),t.actions.push({action:"sizePressure",params:[v]}),t.actions.push({action:"setSize",params:[g]}),t.actions.push({action:"setSpacing",params:[f]}),t.actions.push({action:"setOpacity",params:[m]}),t.actions.push({action:"setColor",params:[n]}),t.actions.push({action:"setAlpha",params:[C]}),t.actions.push({action:"setLockAlpha",params:[x]}),o=i.BB.clamp(o,0,1);var u=c(o),d=v?Math.max(.1,o*g):Math.max(.1,g);P=!1,L=!0,e.save(),h(r,a,d,u),e.restore(),s=d*f,S.x=r,S.y=a,S.pressure=o,k.pressure=o,l=[{x:r,y:a,pressure:o}],t.actions.push({action:"startLine",params:[r,a,o]})},this.goLine=function(n,r,a){if(L){t.actions.push({action:"goLine",params:[n,r,a]});var o=i.BB.clamp(a,0,1),s=v?Math.max(.1,S.pressure*g):Math.max(.1,g);e.save(),d(n,r,s,S.pressure),e.restore(),S.x=n,S.y=r,k.pressure=S.pressure,S.pressure=o,l.push({x:n,y:r,pressure:a})}},this.endLine=function(n,r){var a=v?Math.max(.1,S.pressure*g):Math.max(.1,g);if(e.save(),d(null,null,a,S.pressure),e.restore(),L=!1,C===w&&!P){var o=l[0];l.forEach((function(e){e.pressure>o.pressure&&(o=e)})),e.save();var s=i.BB.clamp(o.pressure,0,1),u=c(s);h(o.x,o.y,a,u,0),e.restore()}A=null,t&&(t.actions.push({action:"endLine",params:[n,r]}),p.push(t),t=void 0),P=!1,l=[]},this.drawLineSegment=function(t,r,a,o){if(S.x=a,S.y=o,S.pressure=1,!L&&void 0!==t){var l,c=i.BB.pointsToAngleDeg({x:t,y:r},{x:a,y:o}),u=Math.sqrt(Math.pow(a-t,2)+Math.pow(o-r,2)),d=(a-t)/u,b=(o-r)/u,B=g*f;for(s=g*f,e.save(),l=s;l<=u;l+=B)h(t+d*l,r+b*l,g,m,c);e.restore();var w={tool:["brush","PenBrush"],actions:[]};w.actions.push({action:"opacityPressure",params:[y]}),w.actions.push({action:"sizePressure",params:[v]}),w.actions.push({action:"setSize",params:[g]}),w.actions.push({action:"setSpacing",params:[f]}),w.actions.push({action:"setOpacity",params:[m]}),w.actions.push({action:"setColor",params:[n]}),w.actions.push({action:"setAlpha",params:[C]}),w.actions.push({action:"setLockAlpha",params:[x]}),w.actions.push({action:"drawLineSegment",params:[t,r,a,o]}),p.push(w)}},this.isDrawing=function(){return L},this.setAlpha=function(e){C!==e&&(C=e,u())},this.setColor=function(e){n!==e&&(n={r:e.r,g:e.g,b:e.b},r="rgb("+n.r+","+n.g+","+n.b+")",u())},this.setContext=function(t){e=t},this.setHistory=function(e){p=e},this.setSize=function(e){g=e},this.setOpacity=function(e){m=e},this.setSpacing=function(e){f=e},this.sizePressure=function(e){v=e},this.opacityPressure=function(e){y=e},this.setLockAlpha=function(e){x=e},this.getSpacing=function(){return f},this.getSize=function(){return g},this.getOpacity=function(){return m},this.getLockAlpha=function(e){return x}}})),r.register("5CF7D",(function(e,n){t(e.exports,"alphaImArr",(function(){return a}));var i=r("74D3O"),a=[];a[1]=(0,i.genBrushAlpha01)(128),a[2]=(0,i.genBrushAlpha02)(128)})),r.register("74D3O",(function(e,n){t(e.exports,"genBrushAlpha01",(function(){return o})),t(e.exports,"genBrushAlpha02",(function(){return l}));var i=r("eWjiX"),a=r("gZSR2");function o(e){for(var t=e/500,n=e,r=i.BB.canvas(e,n),o=r.getContext("2d"),s=o.createImageData(e,n),l=0;l<e;l++)for(var c=0;c<n;c++){var u=4*(c*e+l),h=t+.04*a.noise.simplex2(l/50/t,c/50/t),d=100+(a.noise.simplex2(l/50/h,c/50/h)+1)/2*100;d-=(a.noise.simplex2(l/10/t,c/10/t)+1)/2*100;var p=i.BB.dist(e/2,n/2,l,c);d*=i.BB.clamp(1-((p-e/2.5)/(e/14)+a.noise.simplex2(l/22/h,c/22/h)),0,1),d*=2*i.BB.clamp(1-p/e,0,1),s.data[u]=0,s.data[u+1]=0,s.data[u+2]=0,s.data[u+3]=i.BB.clamp(d,0,255)}return o.putImageData(s,0,0),r}function s(e,t,n){var r=i.BB.Vec2.sub(n,t),a=i.BB.Vec2.sub(e,t),o=i.BB.clamp(i.BB.Vec2.dot(a,r)/i.BB.Vec2.dot(r,r),0,1);return i.BB.Vec2.len(i.BB.Vec2.sub(a,i.BB.Vec2.mul(r,o)))}function l(e){var t=.25;for(var n={x:t*e,y:e-e*t},r={x:e-e*t,y:t*e},a=e,o=i.BB.canvas(e,a),l=o.getContext("2d"),c=l.createImageData(e,a),u=0;u<e;u++)for(var h=0;h<a;h++){var d=4*(h*e+u),p=s({x:u,y:h},n,r);p=i.BB.clamp(255-(p-.16666666666666666*e)/(.08333333333333333*e)*255,0,255),c.data[d]=0,c.data[d+1]=0,c.data[d+2]=0,c.data[d+3]=p}return l.putImageData(c,0,0),o}})),r.register("gZSR2",(function(e,n){t(e.exports,"noise",(function(){return h}));var r={};function i(e,t,n){this.x=e,this.y=t,this.z=n}i.prototype.dot2=function(e,t){return this.x*e+this.y*t};var a=[new i(1,1,0),new i(-1,1,0),new i(1,-1,0),new i(-1,-1,0),new i(1,0,1),new i(-1,0,1),new i(1,0,-1),new i(-1,0,-1),new i(0,1,1),new i(0,-1,1),new i(0,1,-1),new i(0,-1,-1)],o=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],s=new Array(512),l=new Array(512);r.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n=void 0;n=1&t?o[t]^255&e:o[t]^e>>8&255,s[t]=s[t+256]=n,l[t]=l[t+256]=a[n%12]}},r.seed(0);var c=.5*(Math.sqrt(3)-1),u=(3-Math.sqrt(3))/6;r.simplex2=function(e,t){var n,r,i=(e+t)*c,a=Math.floor(e+i),o=Math.floor(t+i),h=(a+o)*u,d=e-a+h,p=t-o+h;d>p?(n=1,r=0):(n=0,r=1);var g=d-n+u,f=p-r+u,m=d-1+2*u,v=p-1+2*u,y=l[(a&=255)+s[o&=255]],x=l[a+n+s[o+r]],b=l[a+1+s[o+1]],B=.5-d*d-p*p,w=.5-g*g-f*f,C=.5-m*m-v*v;return 70*((B<0?0:(B*=B)*B*y.dot2(d,p))+(w<0?0:(w*=w)*w*x.dot2(g,f))+(C<0?0:(C*=C)*C*b.dot2(m,v)))};var h=r})),r.register("5PSXS",(function(e,n){t(e.exports,"BlendBrush",(function(){return u}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("7U0Ew"),s=r("eWjiX"),l=256;function c(e,t,n){return e<=t?t:e>=n?n:e}var u=function(){"use strict";function e(){(0,i.default)(this,e),(0,o.default)(this,"isTesting",!1),(0,o.default)(this,"size",29),(0,o.default)(this,"opacity",.6),(0,o.default)(this,"blending",.65),(0,o.default)(this,"settingLockLayerAlpha",!1),(0,o.default)(this,"settingSizePressure",!0),(0,o.default)(this,"settingOpacityPressure",!1),(0,o.default)(this,"blendCol",{r:0,g:0,b:0,a:1}),(0,o.default)(this,"blendMix",.45),(0,o.default)(this,"isDrawing",!1),(0,o.default)(this,"lastInput",{x:0,y:0,pressure:0}),(0,o.default)(this,"lastInput2",{x:0,y:0,pressure:0})}return(0,a.default)(e,[{key:"updateRedrawBounds",value:function(e){this.redrawBounds=s.BB.updateBounds(this.redrawBounds,e)}},{key:"getCellsWidth",value:function(){return Math.ceil(this.context.canvas.width/l)}},{key:"drawChangedCells",value:function(){var e=this,t=this.cells.map((function(e){return null}));this.getTouchedCells(this.redrawBounds).forEach((function(n,r){n&&(t[r]=e.cells[r])})),this.drawCells(t),this.redrawBounds=null}},{key:"getTouchedCells",value:function(e){for(var t=this.cells.map((function(e){return!1})),n=this.getCellsWidth(),r=(e={x1:Math.floor(e.x1/l),y1:Math.floor(e.y1/l),x2:Math.floor(e.x2/l),y2:Math.floor(e.y2/l)}).x1;r<=e.x2;r++)for(var i=e.y1;i<=e.y2;i++)t[i*n+r]=!0;return t}},{key:"sliceBounds",value:function(e){var t=this,n=this.getCellsWidth(),r=[];return this.getTouchedCells(e).forEach((function(i,a){if(i){var o=a%n*l,s=Math.floor(a/n)*l,c=t.cells[a].width,u=t.cells[a].height,h={x1:Math.max(0,e.x1-o),y1:Math.max(0,e.y1-s),x2:Math.min(c-1,e.x2-o),y2:Math.min(u-1,e.y2-s)};h.x1>h.x2||h.y1>h.y2||r.push({index:a,bounds:h})}})),r}},{key:"copyFromCanvas",value:function(e){var t=this;if(e){var n=this.getTouchedCells(e),r=this.getCellsWidth();n.forEach((function(e,n){if(e&&!t.cells[n]){var i=n%r,a=Math.floor(n/r),o=(Math.min(i*l+l,t.context.canvas.width)-1)%l+1,c=(Math.min(a*l+l,t.context.canvas.height)-1)%l+1,u=s.BB.canvas(o,c).getContext("2d");u.drawImage(t.context.canvas,-i*l,-a*l),t.cells[n]=u.getImageData(0,0,o,c)}}))}}},{key:"getAverage",value:function(e,t,n){var r=this;n=Math.max(.5,.75*n);var i=Math.max(0,Math.floor(e-n)),a=Math.max(0,Math.floor(t-n)),o=Math.min(this.context.canvas.width-1,Math.ceil(e+n)),s=Math.min(this.context.canvas.height-1,Math.ceil(t+n));if(i>o||a>s)return{r:0,g:0,b:0,a:0};var l,c=0,u=0,h=0,d=0;return this.sliceBounds({x1:i,y1:a,x2:o,y2:s}).forEach((function(e){for(var t=r.cells[e.index].width,n=r.cells[e.index].data,i=e.bounds,a=i.y1;a<=i.y2;a+=4)for(var o=i.x1,s=a*t*4+4*i.x1;o<=i.x2;o+=4,s+=16)l=n[s+3],c+=n[s]*l,u+=n[s+1]*l,h+=n[s+2]*l,d+=l})),0!==d&&(c/=d,u/=d,h/=d,d=Math.min(1,d)),{r:c,g:u,b:h,a:d}}},{key:"prepDot",value:function(e,t,n){n=Math.max(.5,n);var r=Math.max(0,Math.floor(e-n)),i=Math.max(0,Math.floor(t-n)),a=Math.min(this.context.canvas.width-1,Math.ceil(e+n)),o=Math.min(this.context.canvas.height-1,Math.ceil(t+n));return r>a||i>o?null:{x1:r,y1:i,x2:a,y2:o}}},{key:"drawDot",value:function(e){for(var t=this,n=0,r=e.size>30?1024:512,i=[],a=0;a<r;a++)i[a]=(Math.random()-.5)/1.001+.5;var o=[8,4,4,4,2,2,2,2,2,2][Math.floor(2*e.size)],u=o?o*o:0,h=[];if(o)for(var d=0,p=0;p<o;p++)for(var g=0;g<o;g++,d+=2)h[d]=(p+1)/o,h[d+1]=(g+1)/o;var f=.8*Math.pow(e.opacity,2),m=1-f,v=f/m,y=e.size*e.size,x=y*m/e.opacity,b=(1+v)*e.opacity,B=this.sliceBounds({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}),w=this.getCellsWidth();B.forEach((function(a){for(var o=a.index%w*l,d=Math.floor(a.index/w)*l,p=t.cells[a.index].width,g=t.cells[a.index].data,f=a.bounds.y1,m=f+d-e.y;f<=a.bounds.y2;f++,m++)for(var v=a.bounds.x1,B=f*p*4+4*a.bounds.x1,C=v+o-e.x;v<=a.bounds.x2;v++,B+=4,C++){var S=0;if(u){for(var k=0;k<h.length;k+=2){var L=s.BB.lenSquared(C+h[k],m+h[k+1]);L>=y||(S+=c(b-L/x,0,e.opacity))}if(!S)continue;S/=u}else{var T=Math.pow(C,2)+Math.pow(m,2);if(T>=y)continue;S=c(b-T/x,0,e.opacity)}var E=1-S,M=g[B+3]/255;if(t.settingLockLayerAlpha){var I=e.r*S+g[B]*E,A=e.g*S+g[B+1]*E,R=e.b*S+g[B+2]*E;M&&(g[B]=Math.floor(I+i[n]),g[B+1]=Math.floor(A+i[n]),g[B+2]=Math.floor(R+i[n]))}else{var P=e.r*S+g[B]*M*E,O=e.g*S+g[B+1]*M*E,D=e.b*S+g[B+2]*M*E,N=1-E*(1-M);g[B+3]=Math.floor(Math.min(255,255*N)+.5),N&&(g[B]=Math.floor(P/N+i[n]),g[B+1]=Math.floor(O/N+i[n]),g[B+2]=Math.floor(D/N+i[n]))}n=(n+1)%r}}))}},{key:"calcSpacing",value:function(e){return s.BB.mix(2*e/2,2*e/9,s.BB.clamp((e-2.7)/9.3,0,1))}},{key:"continueLine",value:function(e,t,n,r){var i,a,o=this;this.drawBuffer=[];var l,c=this.settingSizePressure?Math.max(1,n*this.size):Math.max(1,this.size),u=this.calcSpacing(c),h=e,d=t;if(null===e&&(h=this.lastInput.x,d=this.lastInput.y),0===this.blending)this.mixr=this.color.r,this.mixg=this.color.g,this.mixb=this.color.b;else{var p;if(r)p={r:this.localColOld.r,g:this.localColOld.g,b:this.localColOld.b,a:0};else{var g=[h,d,this.settingSizePressure?Math.max(.5,n*this.size):Math.max(.5,this.size)],f=this.prepDot(g[0],g[1],g[2]);this.copyFromCanvas(f),p=this.getAverage(g[0],g[1],g[2])}l={r:0,g:0,b:0,a:0},p.a>0&&0===this.blendCol.a?(this.blendCol.r=p.r,this.blendCol.g=p.g,this.blendCol.b=p.b,this.blendCol.a=p.a,l.r=this.blendCol.r,l.g=this.blendCol.g,l.b=this.blendCol.b,l.a=this.blendCol.a):(0===p.a&&(p.r=this.color.r,p.g=this.color.g,p.b=this.color.b,p.a=1-this.blending),this.blendCol.r=s.BB.mix(this.blendCol.r,s.BB.mix(this.blendCol.r,p.r,this.blendMix),p.a),this.blendCol.g=s.BB.mix(this.blendCol.g,s.BB.mix(this.blendCol.g,p.g,this.blendMix),p.a),this.blendCol.b=s.BB.mix(this.blendCol.b,s.BB.mix(this.blendCol.b,p.b,this.blendMix),p.a),this.blendCol.a=Math.min(1,this.blendCol.a+p.a),l.r=this.blendCol.r,l.g=this.blendCol.g,l.b=this.blendCol.b,l.a=this.blendCol.a)}var m=function(e){if(!(o.blending>=1&&o.blendCol.a<=0)){var t=e.t;i=o.lastInput2.pressure*(1-t)+n*t,a=o.settingOpacityPressure?o.opacity*i*i:o.opacity,c=o.settingSizePressure?Math.max(.1,i*o.size):Math.max(.1,o.size),0!=o.blending&&(o.mixr=s.BB.mix(o.localColOld.r,l.r,t),o.mixg=s.BB.mix(o.localColOld.g,l.g,t),o.mixb=s.BB.mix(o.localColOld.b,l.b,t)),1===o.blending&&0===o.localColOld.a&&(o.mixr=l.r,o.mixg=l.g,o.mixb=l.b);var r=o.prepDot(e.x,e.y,c);r&&(o.updateRedrawBounds(r),o.drawBuffer.push({x:e.x,y:e.y,size:c,opacity:a,x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,r:s.BB.mix(o.color.r,o.mixr,o.blending),g:s.BB.mix(o.color.g,o.mixg,o.blending),b:s.BB.mix(o.color.b,o.mixb,o.blending)}))}};null===e?this.bezierLine.addFinal(u,m):this.bezierLine.add(e,t,u,m),this.copyFromCanvas(this.redrawBounds),this.drawBuffer.forEach((function(e){o.drawDot(e)})),this.drawBuffer=[],this.localColOld=l}},{key:"setHistory",value:function(e){this.history=e}},{key:"getSize",value:function(){return this.size}},{key:"setSize",value:function(e){this.size=e}},{key:"getOpacity",value:function(){return this.opacity}},{key:"setOpacity",value:function(e){this.opacity=e}},{key:"getBlending",value:function(){return this.blending}},{key:"setBlending",value:function(e){this.blending=e}},{key:"setColor",value:function(e){this.color=s.BB.copyObj(e)}},{key:"setContext",value:function(e){this.context=e}},{key:"setSizePressure",value:function(e){this.settingSizePressure=!!e}},{key:"setOpacityPressure",value:function(e){this.settingOpacityPressure=!!e}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=!!e}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"setIsTesting",value:function(e){this.isTesting=!!e}},{key:"startLine",value:function(e,t,n){var r=this;this.historyEntry={tool:["brush","BlendBrush"],actions:[]};var i=Math.ceil(this.context.canvas.width/l)*Math.ceil(this.context.canvas.height/l);this.cells="0".repeat(i).split("").map((function(e){return null})),this.isDrawing=!0,n=Math.max(0,Math.min(1,n));var a=this.settingOpacityPressure?this.opacity*n*n:this.opacity,o=this.settingSizePressure?Math.max(.1,n*this.size):Math.max(.1,this.size);if(0===this.blending)this.mixr=this.color.r,this.mixg=this.color.g,this.mixb=this.color.b;else{this.copyFromCanvas(this.prepDot(e,t,o));var c=this.getAverage(e,t,this.settingSizePressure?Math.max(.1,n*this.size):Math.max(.1,this.size));0===c.a?this.blendCol={r:this.color.r,g:this.color.g,b:this.color.b,a:1-this.blending}:this.blendCol={r:c.r,g:c.g,b:c.b,a:c.a},this.mixr=this.blendCol.r,this.mixg=this.blendCol.g,this.mixb=this.blendCol.b}if(this.localColOld={r:this.mixr,g:this.mixg,b:this.mixb,a:this.blendCol.a},this.redrawBounds=null,this.drawBuffer=[],this.blending<1||this.blendCol.a>0){var u=this.prepDot(e,t,o);u&&(this.updateRedrawBounds(u),this.drawBuffer.push({x:e,y:t,size:o,opacity:a,x1:u.x1,y1:u.y1,x2:u.x2,y2:u.y2,r:s.BB.mix(this.color.r,this.mixr,this.blending),g:s.BB.mix(this.color.g,this.mixg,this.blending),b:s.BB.mix(this.color.b,this.mixb,this.blending)}))}this.copyFromCanvas(this.redrawBounds),this.drawBuffer.forEach((function(e){r.drawDot(e)})),this.drawBuffer=[],this.bezierLine=new s.BB.BezierLine,this.bezierLine.add(e,t,0,(function(){})),this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=n,this.lastInput2=s.BB.copyObj(this.lastInput),this.redrawBounds&&!this.isTesting&&this.drawChangedCells()}},{key:"goLine",value:function(e,t,n,r){this.isDrawing&&(this.continueLine(e,t,this.lastInput.pressure,r),this.lastInput2=s.BB.copyObj(this.lastInput),this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=n,this.redrawBounds&&!this.isTesting&&this.drawChangedCells())}},{key:"endLine",value:function(){this.bezierLine&&this.continueLine(null,null,this.lastInput.pressure,!1),this.isDrawing=!1,this.bezierLine=null,this.redrawBounds&&this.drawChangedCells(),this.historyEntry&&this.history&&this.cells.find((function(e){return!!e}))&&(this.historyEntry.actions.push({action:"drawCells",params:[this.cells]}),this.history.push(this.historyEntry),this.historyEntry=null),this.cells=null}},{key:"drawCells",value:function(e){var t=this,n=this.getCellsWidth();e.forEach((function(e,r){if(e){var i=r%n*l,a=Math.floor(r/n)*l;t.context.putImageData(e,i,a)}}))}},{key:"drawLineSegment",value:function(e,t,n,r){var i=this;if(this.lastInput.x=n,this.lastInput.y=r,!this.isDrawing&&void 0!==e){var a=Math.ceil(this.context.canvas.width/l)*Math.ceil(this.context.canvas.height/l);this.cells="0".repeat(a).split("").map((function(e){return null})),this.redrawBounds=null,this.drawBuffer=[],this.copyFromCanvas(this.prepDot(e,t,Math.max(.1,this.size)));var o=this.getAverage(e,t,Math.max(.1,this.size));0===o.a?this.blendCol={r:this.color.r,g:this.color.g,b:this.color.b,a:1-this.blending}:this.blendCol={r:o.r,g:o.g,b:o.b,a:o.a},this.mixr=this.color.r*(1-this.blendCol.a)+(this.blending*this.blendCol.r+this.color.r*(1-this.blending))*this.blendCol.a,this.mixg=this.color.g*(1-this.blendCol.a)+(this.blending*this.blendCol.g+this.color.g*(1-this.blending))*this.blendCol.a,this.mixb=this.color.b*(1-this.blendCol.a)+(this.blending*this.blendCol.b+this.color.b*(1-this.blending))*this.blendCol.a;for(var c=this.settingOpacityPressure?1*this.opacity*1:this.opacity,u=this.settingSizePressure?Math.max(.1,1*this.size):Math.max(.1,this.size),h=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2)),d=(n-e)/h,p=(r-t)/h,g=this.calcSpacing(u),f=0;f<=h;f+=g){var m=this.prepDot(e+d*f,t+p*f,u);m&&(this.copyFromCanvas(m),this.drawBuffer.push({x:e+d*f,y:t+p*f,size:u,opacity:c,x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,r:s.BB.mix(this.color.r,this.mixr,this.blending),g:s.BB.mix(this.color.g,this.mixg,this.blending),b:s.BB.mix(this.color.b,this.mixb,this.blending)}))}this.drawBuffer.forEach((function(e){i.drawDot(e)})),this.drawBuffer=[],this.history&&this.cells.find((function(e){return!!e}))&&(this.drawCells(this.cells),this.historyEntry={tool:["brush","BlendBrush"],actions:[{action:"drawCells",params:[this.cells]}]},this.history.push(this.historyEntry),this.historyEntry=null),this.cells=null}}}]),e}()})),r.register("ewgr9",(function(e,n){t(e.exports,"SketchyBrush",(function(){return l}));var i=r("eWjiX"),a=r("hrnUX"),o=i.BB.canvas(32,32),s=o.getContext("2d");function l(){var e,t,n,r,l,c=1,u=.2,h=.5,d=1,p=!1,g={x:0,y:0,pressure:0},f=new a.KL.DecoyKlHistory,m=0;this.setHistory=function(e){f=e},this.setSeed=function(e){m=parseInt(e)},this.getSeed=function(){return parseInt(""+m)};var v=[],y=0,x=[function(e,t){return e},function(e,t){var n=new i.BB.RGB(e.r,e.g,e.b);return n.r*=t.r/255,n.g*=t.g/255,n.b*=t.b/255,n},function(e,t){var n=new i.BB.RGB(e.r,e.g,e.b);return n.r*=t.r/255,n.g*=t.g/255,n.b*=t.b/255,n}];this.getSize=function(){return c/2},this.setColor=function(e){t=e},this.getOpacity=function(){return u},this.setOpacity=function(e){u=e},this.getBlending=function(){return h},this.setBlending=function(e){h=e},this.setSize=function(e){c=2*e},this.getScale=function(){return d},this.setScale=function(e){d=e},this.setContext=function(t){e=t},this.startLine=function(e,i,a,o){if(o&&g.x){g.x,g.y;p=!0,this.endLine()}else p=!0,n=e,r=i,g.x=e,g.y=i,(l={tool:["brush","SketchyBrush"],actions:[]}).actions.push({action:"setScale",params:[d]}),l.actions.push({action:"setSize",params:[c/2]}),l.actions.push({action:"setOpacity",params:[u]}),l.actions.push({action:"setColor",params:[t]}),l.actions.push({action:"setBlending",params:[h]}),l.actions.push({action:"startLine",params:[e,i,a]})},this.goLine=function(a,o,s,f){if(p&&(a!==g.x||o!==g.y)){var b,B,w,C,S=parseInt(a),k=parseInt(o);v.push([S,k]);var L=t.r,T=t.g,E=t.b;if(null!==f)L=f.r,T=f.g,E=f.b;else if(0!==h&&S+5>=0&&k+5>=0&&S-5<e.canvas.width-1&&k-5<e.canvas.height-1){L=0,T=0,E=0;var M=Math.min(e.canvas.width-1,Math.max(0,S-5)),I=Math.min(e.canvas.height-1,Math.max(0,k-5)),A=Math.min(e.canvas.width-1,Math.max(0,S+5)),R=Math.min(e.canvas.height-1,Math.max(0,k+5));if(R-=I,(A-=M)>0&&R>0){for(var P=e.getImageData(M,I,A,R),O=0,D=0;D<P.data.length;D+=4)L+=P.data[D+0],T+=P.data[D+1],E+=P.data[D+2],O++;L/=O,T/=O,E/=O}var N=x[0](new i.BB.RGB(L,T,E),t);L=parseInt(""+i.BB.mix(t.r,N.r,h)),T=parseInt(""+i.BB.mix(t.g,N.g,h)),E=parseInt(""+i.BB.mix(t.b,N.b,h))}for(e.save(),e.strokeStyle="rgba("+L+", "+T+", "+E+", "+u+")",e.lineWidth=c,e.beginPath(),e.moveTo(n,r),e.lineTo(S,k),b=0;b<v.length;b++)(C=(B=v[b][0]-v[y][0])*B+(w=v[b][1]-v[y][1])*w)<4e3*d*d&&(m++,.5*Math.sin(6324634.2345*Math.cos(5342.3423*m))+.5>C/2e3/d/d)&&(e.moveTo(v[y][0]+.3*B,v[y][1]+.3*w),e.lineTo(v[b][0]-.3*B,v[b][1]-.3*w));e.stroke(),e.restore(),y++,n=S,r=k,g.x=S,g.y=k,l.actions.push({action:"goLine",params:[a,o,s,{r:L,g:T,b:E}]})}},this.endLine=function(){p=!1,y=0,v=[],l&&(l.actions.push({action:"endLine",params:[]}),f.push(l),l=void 0)},this.drawLineSegment=function(n,r,a,l){if(g.x=a,g.y=l,!p&&void 0!==n){e.save(),e.lineWidth=c;var m=t.r,v=t.g,y=t.b;if(n+5>=0&&r+5>=0&&n-5<e.canvas.width-1&&r-5<e.canvas.height-1){m=0,v=0,y=0;var b=Math.min(e.canvas.width-1,Math.max(0,n-5)),B=Math.min(e.canvas.height-1,Math.max(0,r-5)),w=Math.min(e.canvas.width-1,Math.max(0,n+5)),C=Math.min(e.canvas.height-1,Math.max(0,r+5));if(C-=B,(w-=b)>0&&C>0){var S=Math.min(o.width,w),k=Math.min(o.height,C);s.save(),s.globalCompositeOperation="copy",s.drawImage(e.canvas,b,B,w,C,0,0,S,k),s.restore();for(var L=s.getImageData(b,B,w,C),T=0,E=0;E<L.data.length;E+=4)m+=L.data[E+0],v+=L.data[E+1],y+=L.data[E+2],T++;m/=T,v/=T,y/=T}}var M=x[0](new i.BB.RGB(m,v,y),t);m=parseInt(""+(h*M.r+t.r*(1-h))),v=parseInt(""+(h*M.g+t.g*(1-h))),y=parseInt(""+(h*M.b+t.b*(1-h))),e.strokeStyle="rgba("+m+", "+v+", "+y+", "+u+")",e.beginPath(),e.moveTo(n,r),e.lineTo(a,l),e.stroke(),e.strokeStyle="rgba("+m+", "+v+", "+y+", "+u+")",e.restore();var I={tool:["brush","SketchyBrush"],actions:[]};I.actions.push({action:"setScale",params:[d]}),I.actions.push({action:"setSize",params:[c/2]}),I.actions.push({action:"setOpacity",params:[u]}),I.actions.push({action:"setColor",params:[t]}),I.actions.push({action:"setBlending",params:[h]}),I.actions.push({action:"drawLineSegment",params:[n,r,a,l]}),f.push(I)}},this.isDrawing=function(){return p}}})),r.register("kic4a",(function(e,n){t(e.exports,"PixelBrush",(function(){return o}));var i=r("eWjiX"),a=r("hrnUX");function o(){var e,t,n,r,o,s=function(){L.clearRect(0,0,4,4),L.fillStyle=x?"#fff":r;for(var t=0;t<Math.max(1,Math.round(f*T.length));t++)L.fillRect(T[t][0],T[t][1],1,1);o=e.createPattern(k,"repeat")},l=function(t,n,i,a,s){e.save(),x?(e.fillStyle=b?o:"#fff",e.globalCompositeOperation=y?"source-atop":"destination-out"):(e.fillStyle=b?o:r,y&&(e.globalCompositeOperation="source-atop")),e.globalAlpha=b?1:f,t=Math.floor(t),n=Math.floor(n),i=Math.floor(i),a=Math.floor(a);for(var l=Math.abs(i-t),c=t<i?1:-1,u=-Math.abs(a-n),h=n<a?1:-1,d=l+u;s?s=!1:e.fillRect(t,n,1,1),t!==i||n!==a;){var p=2*d;p>=u&&(d+=u,t+=c),p<=l&&(d+=l,n+=h)}e.restore()},c=function(e,t,n,r){var a=function(e,t,n,r,a){var o=i.BB.Vec2.nor({x:r.x-e.x,y:r.y-e.y}),s=i.BB.Vec2.nor({x:t.x-e.x,y:t.y-e.y}),l=i.BB.Vec2.nor({x:r.x-n.x,y:r.y-n.y});return Math.abs(i.BB.Vec2.angle(o,s)%Math.PI),Math.PI,Math.abs(i.BB.Vec2.angle(o,l)%Math.PI),Math.PI,Math.max(i.BB.Vec2.dist(o,s),i.BB.Vec2.dist(o,l))>a}(e,t,n,r,.1);e.x=Math.floor(e.x),e.y=Math.floor(e.y),r.x=Math.floor(r.x),r.y=Math.floor(r.y);var o=i.BB.dist(e.x,e.y,r.x,r.y);if(!a||o<7)l(e.x,e.y,r.x,r.y,!0);else{for(var s=Math.max(2,Math.round(o/4)),c=[],u=0;u<=s;u++){var h=u/s,d=Math.pow(1-h,3),p=3*h*Math.pow(1-h,2),g=3*Math.pow(h,2)*(1-h),f=Math.pow(h,3);c.push({x:d*e.x+p*t.x+g*n.x+f*r.x,y:d*e.y+p*t.y+g*n.y+f*r.y})}for(var m=0;m<s;m++)l(Math.round(c[m].x),Math.round(c[m].y),Math.round(c[m+1].x),Math.round(c[m+1].y),!0)}},u=function(t,n,i,a,s){e.save(),x?(e.fillStyle=b?o:"#fff",e.globalCompositeOperation=y?"source-atop":"destination-out"):(e.fillStyle=b?o:r,y&&(e.globalCompositeOperation="source-atop")),e.globalAlpha=b?1:a,e.fillRect(Math.round(t+-i),Math.round(n+-i),Math.round(2*i),Math.round(2*i)),e.restore()},h=function(t,n,r,a){function o(e){var t=i.BB.mix(w.pressure,a,e.t),n=f*(v?t*t:1),r=Math.max(.5,p*(m?t:1));u(e.x,e.y,r,n,e.angle)}function s(e){c(e.p1,e.p2,e.p3,e.p4)}if(null===S&&(S=new i.BB.BezierLine).add(B.x,B.y,0,(function(){})),e.save(),1===Math.round(2*p))null===t?S.addFinal(4,null,s):S.add(t,n,4,null,s);else{var l=r*g;null===t?S.addFinal(l,o):S.add(t,n,l,o)}e.restore()},d=new a.KL.DecoyKlHistory,p=.5,g=.9,f=1,m=!0,v=!1,y=!1,x=!1,b=!0,B={x:0,y:0,pressure:0},w={x:0,y:0,pressure:0},C=!1,S=null,k=(Math.PI,i.BB.canvas(4,4)),L=k.getContext("2d"),T=[[3,2],[1,0],[3,0],[1,2],[2,1],[0,3],[0,1],[2,3],[2,0],[0,2],[0,0],[2,2],[1,1],[3,3],[3,1],[1,3]];this.startLine=function(e,r,a){(t={tool:["brush","PixelBrush"],actions:[]}).actions.push({action:"sizePressure",params:[m]}),t.actions.push({action:"setSize",params:[p]}),t.actions.push({action:"setSpacing",params:[g]}),t.actions.push({action:"setOpacity",params:[f]}),t.actions.push({action:"setColor",params:[n]}),t.actions.push({action:"setLockAlpha",params:[y]}),t.actions.push({action:"setIsEraser",params:[x]}),t.actions.push({action:"setUseDither",params:[b]}),b&&s(),a=Math.max(0,Math.min(1,a));var o=v?f*a*a:f,l=m?Math.max(.5,a*p):Math.max(.5,p);C=!0,u(e,r,l,o),l*g,B.x=e,B.y=r,B.pressure=a,w=i.BB.copyObj(B),t.actions.push({action:"startLine",params:[e,r,a]})},this.goLine=function(e,n,r){if(C){t.actions.push({action:"goLine",params:[e,n,r]});var a=i.BB.clamp(r,0,1),o=m?Math.max(.1,B.pressure*p):Math.max(.1,p);h(e,n,o,B.pressure),w=i.BB.copyObj(B),B.x=e,B.y=n,B.pressure=a}},this.endLine=function(e,n){var r=m?Math.max(.1,B.pressure*p):Math.max(.1,p);h(null,null,r,B.pressure),C=!1,S=null,t&&(t.actions.push({action:"endLine",params:[e,n]}),d.push(t),t=void 0)},this.drawLineSegment=function(e,t,r,a){if(B.x=r,B.y=a,B.pressure=1,!C&&void 0!==e){if(b&&s(),1===Math.round(2*p))l(e,t,r,a,!0);else{i.BB.pointsToAngleDeg({x:e,y:t},{x:r,y:a});var o,c=Math.sqrt(Math.pow(r-e,2)+Math.pow(a-t,2)),h=(r-e)/c,v=(a-t)/c,w=p*g;for(o=p*g;o<=c;o+=w)u(e+h*o,t+v*o,p,f)}var S={tool:["brush","PixelBrush"],actions:[]};S.actions.push({action:"sizePressure",params:[m]}),S.actions.push({action:"setSize",params:[p]}),S.actions.push({action:"setSpacing",params:[g]}),S.actions.push({action:"setOpacity",params:[f]}),S.actions.push({action:"setColor",params:[n]}),S.actions.push({action:"setLockAlpha",params:[y]}),S.actions.push({action:"setIsEraser",params:[x]}),S.actions.push({action:"setUseDither",params:[b]}),S.actions.push({action:"drawLineSegment",params:[e,t,r,a]}),d.push(S)}},this.isDrawing=function(){return C},this.setColor=function(e){n!==e&&(r="rgb("+(n=e).r+","+n.g+","+n.b+")")},this.setContext=function(t){e=t},this.setHistory=function(e){d=e},this.setSize=function(e){p=Math.round(2*e)/2},this.setOpacity=function(e){f=e},this.setSpacing=function(e){g=e},this.sizePressure=function(e){m=e},this.opacityPressure=function(e){v=e},this.setLockAlpha=function(e){y=e},this.setIsEraser=function(e){x=!!e},this.setUseDither=function(e){b=!!e},this.getSpacing=function(){return g},this.getSize=function(){return p},this.getOpacity=function(){return f},this.getLockAlpha=function(){return y},this.getIsEraser=function(){return x},this.getUseDither=function(){return b}}})),r.register("7cUpm",(function(e,n){t(e.exports,"EraserBrush",(function(){return o}));var i=r("eWjiX"),a=r("hrnUX");function o(){var e,t,n,r=function(t,n,r,i){e.save(),e.globalCompositeOperation=m?v?"destination-out":"source-atop":"destination-out";var a=e.createRadialGradient(r,r,0,r,r,r),o=Math.pow(i,2);o=Math.max(0,Math.min((r-1)/r,o));var s=Math.max(0,Math.min(1,i)),l=2*s-s*s;a.addColorStop(o,"rgba(255, 255, 255, "+l+")"),a.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=a,e.translate(t-r,n-r),e.fillRect(0,0,2*r,2*r),e.restore()},o=function(e,t,i){var a,o;i=Math.max(0,Math.min(1,i));var s=h?Math.max(.1,i*l):Math.max(.1,l),p=Math.max(1,Math.max(.5,1-u)*s*c);function f(e){var t=e.t;a=g.pressure*(1-t)+i*t,o=d?u*a*a:u,s=h?Math.max(.1,a*l):Math.max(.1,l),r(e.x,e.y,s,o)}null===e?n.addFinal(p,f):n.add(e,t,p,f)},s=new a.KL.DecoyKlHistory,l=30,c=.4,u=1,h=!0,d=!1,p={x:0,y:0,pressure:0},g={x:0,y:0,pressure:0},f=!1,m=!1,v=!1;this.startLine=function(a,o,s){(t={tool:["brush","EraserBrush"],actions:[]}).actions.push({action:"opacityPressure",params:[d]}),t.actions.push({action:"sizePressure",params:[h]}),t.actions.push({action:"setSize",params:[l]}),t.actions.push({action:"setOpacity",params:[u]}),t.actions.push({action:"setTransparentBG",params:[v]}),m=0===e.canvas.index,s=Math.max(0,Math.min(1,s));var y=d?u*s*s:u,x=h?Math.max(.1,s*l):Math.max(.1,l);f=!0,x>1&&r(a,o,x,y),x*c,p.x=a,p.y=o,p.pressure=s,g=i.BB.copyObj(p),(n=new i.BB.BezierLine).add(a,o,0,(function(){})),t.actions.push({action:"startLine",params:[a,o,s]})},this.goLine=function(e,n,r){f&&(t.actions.push({action:"goLine",params:[e,n,r]}),o(e,n,p.pressure),g=i.BB.copyObj(p),p.x=e,p.y=n,p.pressure=r)},this.endLine=function(){n&&o(null,null,p.pressure),f=!1,n=void 0,t&&(t.actions.push({action:"endLine",params:[]}),s.push(t),t=void 0)},this.drawLineSegment=function(t,n,i,a){if(m=0===e.canvas.index,p.x=i,p.y=a,!f&&void 0!==t){var o,g=Math.sqrt(Math.pow(i-t,2)+Math.pow(a-n,2)),y=(i-t)/g,x=(a-n)/g,b=Math.max(1,Math.max(.5,1-u)*l*c);for(o=0;o<=g;o+=b)r(t+y*o,n+x*o,l,u);var B={tool:["brush","EraserBrush"],actions:[]};B.actions.push({action:"opacityPressure",params:[d]}),B.actions.push({action:"sizePressure",params:[h]}),B.actions.push({action:"setSize",params:[l]}),B.actions.push({action:"setOpacity",params:[u]}),B.actions.push({action:"setTransparentBG",params:[v]}),B.actions.push({action:"drawLineSegment",params:[t,n,i,a]}),s.push(B)}},this.isDrawing=function(){return f},this.setContext=function(t){e=t},this.setHistory=function(e){s=e},this.setSize=function(e){l=e},this.setOpacity=function(e){u=e},this.sizePressure=function(e){h=e},this.opacityPressure=function(e){d=e},this.setTransparentBG=function(e){v=1==e},this.getSize=function(){return l},this.getOpacity=function(){return u}}})),r.register("ltaBP",(function(e,n){t(e.exports,"SmudgeBrush",(function(){return h}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("7U0Ew"),s=r("eWjiX"),l=r("hrnUX"),c=256;function u(e,t){for(var n=(t=s.BB.copyObj(t)).brush.size,r=t.brush.center.x,i=t.brush.center.y,a=t.aP.y*e.width+t.aP.x,o=4*(t.bP.y*e.width+t.bP.x-a),l=0,c=n>30?1024:512,u=[],h=0;h<c;h++)u[h]=(Math.random()-.5)/1.001+.5;var d=Math.max(3,Math.min(8,t.brush.size-8)),p=function(a,o,h,p){var g,f,m,v=s.BB.dist(r,i,h,p),y=1-t.brush.opacity*(1-(m=1,(g=(v-(n-d))/d)<=(f=0)?f:g>=m?m:g));if(1!==y){if(e.data[a+3])if(e.data[o+3]){var x;x=e.data[a+3]<e.data[o+3]?1-e.data[a+3]/e.data[o+3]*(1-y):e.data[o+3]/e.data[a+3]*y,e.data[o]=Math.floor(s.BB.mix(e.data[a],e.data[o+0],x)+u[l]),e.data[o+1]=Math.floor(s.BB.mix(e.data[a+1],e.data[o+1],x)+u[l]),e.data[o+2]=Math.floor(s.BB.mix(e.data[a+2],e.data[o+2],x)+u[l]),l=(l+1)%c}else e.data[o]=e.data[a+0],e.data[o+1]=e.data[a+1],e.data[o+2]=e.data[a+2];else;t.brush.alphaLock||(e.data[o+3]=Math.floor(s.BB.mix(e.data[a+3],e.data[o+3],y)+.5))}},g=4*t.bP.x,f=g+4*(t.size.w-1);if(t.aP.y<t.bP.y)for(var m=t.size.h-1,v=t.bP.y+t.size.h-1;m>=0;m--,v--)for(var y=(m+t.bP.y)*e.width*4,x=f+y,b=f+y-o,B=t.bP.x+t.size.w-1;x>=g+y;x-=4,b-=4,B--)p(b,x,B,v);else if(t.aP.y>t.bP.y)for(var w=0,C=t.bP.y;w<t.size.h;w++,C++)for(var S=(w+t.bP.y)*e.width*4,k=f+S,L=f+S-o,T=t.bP.x+t.size.w-1;k>=g+S;k-=4,L-=4,T--)p(L,k,T,C);else if(t.aP.x<t.bP.x)for(var E=t.size.h-1,M=t.bP.y+t.size.h-1;E>=0;E--,M--)for(var I=(E+t.bP.y)*e.width*4,A=f+I,R=f+I-o,P=t.bP.x+t.size.w-1;A>=g+I;A-=4,R-=4,P--)p(R,A,P,M);else for(var O=0,D=t.bP.y;O<t.size.h;O++,D++)for(var N=(O+t.bP.y)*e.width*4,z=g+N,G=g+N-o,j=t.bP.x;z<f+N;z+=4,G+=4,j++)p(G,z,j,D)}var h=function(){"use strict";function e(){(0,i.default)(this,e),(0,o.default)(this,"history",new l.KL.DecoyKlHistory),(0,o.default)(this,"settingColor",{r:0,g:0,b:0}),(0,o.default)(this,"settingSize",35),(0,o.default)(this,"settingSpacing",.20446882736951905),(0,o.default)(this,"settingOpacity",.8),(0,o.default)(this,"settingHasSizePressure",!1),(0,o.default)(this,"settingHasOpacityPressure",!1),(0,o.default)(this,"settingLockLayerAlpha",!1),(0,o.default)(this,"lastInput",{x:0,y:0,pressure:0}),(0,o.default)(this,"lastInput2",{x:0,y:0,pressure:0}),(0,o.default)(this,"isDrawing",!1),(0,o.default)(this,"bezierLine",null),(0,o.default)(this,"drawBuffer",[])}return(0,a.default)(e,[{key:"updateRedrawBounds",value:function(e){this.redrawBounds=s.BB.updateBounds(this.redrawBounds,e)}},{key:"updateCompleteRedrawBounds",value:function(e,t,n,r){this.completeRedrawBounds=s.BB.updateBounds(this.completeRedrawBounds,{x1:e,y1:t,x2:n,y2:r})}},{key:"copyFromCanvas",value:function(){var e=this,t=this.copiedCells.map((function(e){return!1})),n=[],r=Math.ceil(this.copyImageData.width/c);this.redrawBounds&&(n.push({x1:Math.floor(this.redrawBounds.x1/c),y1:Math.floor(this.redrawBounds.y1/c),x2:Math.floor(this.redrawBounds.x2/c),y2:Math.floor(this.redrawBounds.y2/c)}),n.forEach((function(e){for(var n=e.x1;n<=e.x2;n++)for(var i=e.y1;i<=e.y2;i++)t[i*r+n]=!0})),t.forEach((function(t,n){if(t&&!e.copiedCells[n]){e.copiedCells[n]=!0;var i=n%r,a=Math.floor(n/r),o=(Math.min(i*c+c,e.copyImageData.width)-1)%c+1,l=(Math.min(a*c+c,e.copyImageData.height)-1)%c+1,u=s.BB.canvas(o,l).getContext("2d");u.drawImage(e.context.canvas,-i*c,-a*c);for(var h=u.getImageData(0,0,o,l),d=0;d<l;d++)for(var p=0,g=d*o*4,f=4*((a*c+d)*e.copyImageData.width+i*c);p<o;p++,g+=4,f+=4)e.copyImageData.data[f]=h.data[g],e.copyImageData.data[f+1]=h.data[g+1],e.copyImageData.data[f+2]=h.data[g+2],e.copyImageData.data[f+3]=h.data[g+3]}})))}},{key:"prepDot",value:function(e,t,n,r){if(this.lastDot){n=Math.round(n);var i=Math.round(2*n),a=Math.round(2*n),o=function(e,t,n,r,i){if(n.x===r.x&&n.y===r.y)return null;n=s.BB.copyObj(n),r=s.BB.copyObj(r),i=s.BB.copyObj(i);var a=0,o=0,l=0,c=0;return n.x<0&&(c=-n.x),n.y<0&&(a=-n.y),r.x<0&&(c=Math.max(c,-r.x)),r.y<0&&(a=Math.max(a,-r.y)),n.x+i.w>e&&(o=n.x+i.w-e),n.y+i.h>t&&(l=n.y+i.h-t),r.x+i.w>e&&(o=Math.max(o,r.x+i.w-e)),r.y+i.h>t&&(l=Math.max(l,r.y+i.h-t)),n.x+=c,r.x+=c,n.y+=a,r.y+=a,i.w=i.w-c-o,i.h=i.h-a-l,i.w<=0||i.h<=0?null:{aP:{x:n.x,y:n.y},bP:{x:r.x,y:r.y},size:{w:i.w,h:i.h}}}(this.copyImageData.width,this.copyImageData.height,{x:Math.round(this.lastDot.x-n),y:Math.round(this.lastDot.y-n)},{x:Math.round(e-n),y:Math.round(t-n)},{w:i,h:a});if(o){var l={aP:o.aP,bP:o.bP,size:o.size,brush:{center:{x:e,y:t},size:n,opacity:r,alphaLock:this.settingLockLayerAlpha}};this.updateRedrawBounds({x1:l.bP.x,y1:l.bP.y,x2:l.bP.x+2*l.brush.size,y2:l.bP.y+2*l.brush.size}),this.drawBuffer.push(l)}this.lastDot={x:e,y:t}}else this.lastDot={x:e,y:t}}},{key:"continueLine",value:function(e,t,n,r){var i=this;this.drawBuffer=[],null===this.bezierLine&&(this.bezierLine=new s.BB.BezierLine,this.bezierLine.add(this.lastInput.x,this.lastInput.y,0,(function(){})));var a=[],o=function(e){var t=s.BB.mix(i.lastInput2.pressure,r,e.t),n=i.settingOpacity*(i.settingHasOpacityPressure?t*t:1),o=Math.max(.1,i.settingSize*(i.settingHasSizePressure?t:1));a.push([e.x,e.y,o,n,e.angle])},l=n*this.settingSpacing/3;null===e?this.bezierLine.addFinal(l,o):this.bezierLine.add(e,t,l,o);for(var c=0;c<a.length;c++){var h=a[c];this.prepDot(h[0],h[1],h[2],h[3]),h}this.copyFromCanvas();for(var d=0;d<this.drawBuffer.length;d++)u(this.copyImageData,this.drawBuffer[d])}},{key:"startLine",value:function(e,t,n){this.historyEntry={tool:["brush","SmudgeBrush"],actions:[]},n=s.BB.clamp(n,0,1);var r=this.settingHasOpacityPressure?this.settingOpacity*n*n:this.settingOpacity,i=this.settingHasSizePressure?Math.max(.1,n*this.settingSize):Math.max(.1,this.settingSize);this.lastDot=null,this.isDrawing=!0,this.copyImageData=new ImageData(this.context.canvas.width,this.context.canvas.height);var a=Math.ceil(this.context.canvas.width/c)*Math.ceil(this.context.canvas.height/c);this.copiedCells="0".repeat(a).split("").map((function(e){return!1})),this.prepDot(e,t,i,r),this.lineToolLastDot=i*this.settingSpacing,this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=n,this.lastInput2.pressure=n,this.completeRedrawBounds=null}},{key:"goLine",value:function(e,t,n){if(this.isDrawing){this.redrawBounds=null;var r=s.BB.clamp(n,0,1),i=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);this.continueLine(e,t,i,this.lastInput.pressure),this.redrawBounds&&(this.context.putImageData(this.copyImageData,0,0,this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2-this.redrawBounds.x1-1,this.redrawBounds.y2-this.redrawBounds.y1-1),this.updateCompleteRedrawBounds(this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2,this.redrawBounds.y2)),this.lastInput.x=e,this.lastInput.y=t,this.lastInput2.pressure=this.lastInput.pressure,this.lastInput.pressure=r}}},{key:"endLine",value:function(){this.redrawBounds=null;var e=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);if(this.context.save(),this.continueLine(null,null,e,this.lastInput.pressure),this.context.restore(),this.isDrawing=!1,this.bezierLine=null,this.redrawBounds&&(this.context.putImageData(this.copyImageData,0,0,this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2-this.redrawBounds.x1-1,this.redrawBounds.y2-this.redrawBounds.y1-1),this.updateCompleteRedrawBounds(this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2,this.redrawBounds.y2)),this.historyEntry&&this.completeRedrawBounds){var t=this.copyImageData;if(!(0===this.completeRedrawBounds.x1&&0===this.completeRedrawBounds.y1&&this.completeRedrawBounds.x2>=this.context.canvas.width-1&&this.completeRedrawBounds.y2>=this.context.canvas.height-1)){var n=s.BB.canvas(this.completeRedrawBounds.x2-this.completeRedrawBounds.x1+1,this.completeRedrawBounds.y2-this.completeRedrawBounds.y1+1);n.getContext("2d").drawImage(this.context.canvas,-this.completeRedrawBounds.x1,-this.completeRedrawBounds.y1),t=n}this.historyEntry.actions.push({action:"drawImage",params:[t,this.completeRedrawBounds.x1,this.completeRedrawBounds.y1]}),this.history.push(this.historyEntry),this.historyEntry=void 0}this.copyImageData=null}},{key:"drawImage",value:function(e,t,n){e instanceof ImageData?this.context.putImageData(e,t,n):(this.context.clearRect(t,n,e.width,e.height),this.context.drawImage(e,t,n))}},{key:"drawLineSegment",value:function(e,t,n,r){}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"setColor",value:function(e){this.settingColor.r===e.r&&this.settingColor.g===e.g&&this.settingColor.b===e.b||(this.settingColor={r:e.r,g:e.g,b:e.b},this.settingColorStr=s.BB.ColorConverter.toRgbStr(this.settingColor))}},{key:"setContext",value:function(e){this.context=e}},{key:"setHistory",value:function(e){this.history=e}},{key:"setSize",value:function(e){this.settingSize=e}},{key:"setOpacity",value:function(e){this.settingOpacity=e}},{key:"setSpacing",value:function(e){this.settingSpacing=e}},{key:"sizePressure",value:function(e){this.settingHasSizePressure=!!e}},{key:"opacityPressure",value:function(e){this.settingHasOpacityPressure=!!e}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=!!e}},{key:"getSpacing",value:function(){return this.settingSpacing}},{key:"getSize",value:function(){return this.settingSize}},{key:"getOpacity",value:function(){return this.settingOpacity}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}}]),e}()})),r.register("6Nq1H",(function(e,n){t(e.exports,"ChemyBrush",(function(){return c}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("7U0Ew"),s=r("3Rl3W"),l=r("eWjiX"),c=function(){"use strict";function e(){(0,i.default)(this,e),(0,o.default)(this,"settingSize",.25),(0,o.default)(this,"settingOpacity",1),(0,o.default)(this,"settingLockLayerAlpha",!1),(0,o.default)(this,"settingIsEraser",!1),(0,o.default)(this,"settingMode","fill"),(0,o.default)(this,"settingDistort",0),(0,o.default)(this,"settingXSymmetry",!1),(0,o.default)(this,"settingYSymmetry",!1),(0,o.default)(this,"settingGradient",!1),(0,o.default)(this,"isDrawing",!1)}return(0,a.default)(e,[{key:"updateCompleteRedrawBounds",value:function(e,t){var n={x1:e,y1:t,x2:e,y2:t};this.settingXSymmetry&&(n=l.BB.updateBounds(n,{x1:-e+this.copyCanvas.width,y1:t,x2:-e+this.copyCanvas.width,y2:t})),this.settingYSymmetry&&(n=l.BB.updateBounds(n,{x1:e,y1:-t+this.copyCanvas.height,x2:e,y2:-t+this.copyCanvas.height}));var r="stroke"===this.settingMode?this.settingSize+1:1;n.x1=Math.floor(n.x1-r),n.y1=Math.floor(n.y1-r),n.x2=Math.ceil(n.x2+r),n.y2=Math.ceil(n.y2+r),this.completeRedrawBounds=l.BB.updateBounds(this.completeRedrawBounds,n)}},{key:"drawShape",value:function(){var e=this;this.context.save(),this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),this.context.drawImage(this.copyCanvas,0,0);var t=(0,s.default)({},this.settingColor);if(this.settingIsEraser?(t.r=255,t.g=255,t.b=255,this.settingLockLayerAlpha?this.context.globalCompositeOperation="source-atop":this.context.globalCompositeOperation="destination-out"):this.settingLockLayerAlpha&&(this.context.globalCompositeOperation="source-atop"),this.path){var n=new Path2D;this.path.forEach((function(e,t){0===t?n.moveTo(e.x,e.y):n.lineTo(e.x,e.y)}));var r=l.BB.ColorConverter.toRgbaStr({r:t.r,g:t.g,b:t.b,a:this.settingOpacity});if(this.settingGradient){var i=this.path[0].x>this.path[this.path.length-1].x,a=this.context.createLinearGradient(0,i?this.minY:this.maxY,0,i?this.maxY:this.minY);a.addColorStop(0,l.BB.ColorConverter.toRgbaStr({r:t.r,g:t.g,b:t.b,a:this.settingOpacity})),a.addColorStop(1,l.BB.ColorConverter.toRgbaStr({r:t.r,g:t.g,b:t.b,a:0})),r=a}"fill"===this.settingMode?this.context.fillStyle=r:(this.context.lineWidth=2*this.settingSize,this.context.lineJoin="bevel",this.context.strokeStyle=r);var o=function(){"fill"===e.settingMode?e.context.fill(n):e.context.stroke(n)};o(),this.settingXSymmetry&&(this.context.save(),this.context.translate(this.context.canvas.width/2,0),this.context.scale(-1,1),this.context.translate(-this.context.canvas.width/2,0),o(),this.context.restore()),this.settingYSymmetry&&(this.context.save(),this.context.translate(0,this.context.canvas.height/2),this.context.scale(1,-1),this.context.translate(0,-this.context.canvas.height/2),o(),this.context.restore(),this.settingXSymmetry&&(this.context.save(),this.context.translate(this.context.canvas.width/2,this.context.canvas.height/2),this.context.scale(-1,-1),this.context.translate(-this.context.canvas.width/2,-this.context.canvas.height/2),o(),this.context.restore()))}this.context.restore()}},{key:"setHistory",value:function(e){this.history=e}},{key:"getSize",value:function(){return"stroke"===this.settingMode?this.settingSize:0}},{key:"setSize",value:function(e){this.settingSize=e}},{key:"getOpacity",value:function(){return this.settingOpacity}},{key:"setOpacity",value:function(e){this.settingOpacity=e}},{key:"setColor",value:function(e){this.settingColor=l.BB.copyObj(e)}},{key:"setContext",value:function(e){this.context=e}},{key:"setMode",value:function(e){this.settingMode=e}},{key:"getMode",value:function(){return this.settingMode}},{key:"setDistort",value:function(e){this.settingDistort=l.BB.clamp(e,0,1)}},{key:"getDistort",value:function(){return this.settingDistort}},{key:"setXSymmetry",value:function(e){this.settingXSymmetry=!!e}},{key:"getXSymmetry",value:function(){return this.settingXSymmetry}},{key:"setYSymmetry",value:function(e){this.settingYSymmetry=!!e}},{key:"getYSymmetry",value:function(){return this.settingYSymmetry}},{key:"setGradient",value:function(e){this.settingGradient=!!e}},{key:"getGradient",value:function(){return this.settingGradient}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=!!e}},{key:"getIsEraser",value:function(){return this.settingIsEraser}},{key:"setIsEraser",value:function(e){this.settingIsEraser=!!e}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"startLine",value:function(e,t){this.isDrawing=!0,this.path=[{x:e,y:t}],this.minY=t,this.maxY=t,this.copyCanvas=l.BB.canvas(this.context.canvas.width,this.context.canvas.height),this.copyCanvas.getContext("2d").drawImage(this.context.canvas,0,0),this.completeRedrawBounds=null,this.updateCompleteRedrawBounds(e,t)}},{key:"goLine",value:function(e,t){if(this.isDrawing){var n={x:e,y:t};this.settingDistort>0&&(n.x+=(Math.random()-.5)*this.settingDistort*80,n.y+=(Math.random()-.5)*this.settingDistort*80),this.minY=Math.min(this.minY,n.y),this.maxY=Math.max(this.maxY,n.y),this.path.push(n),this.updateCompleteRedrawBounds(e,t),this.drawShape()}}},{key:"endLine",value:function(){if(this.isDrawing=!1,this.completeRedrawBounds=l.BB.boundsInArea(this.completeRedrawBounds,this.copyCanvas.width,this.copyCanvas.height),this.path.length>1&&this.completeRedrawBounds){var e=l.BB.canvas(this.completeRedrawBounds.x2-this.completeRedrawBounds.x1+1,this.completeRedrawBounds.y2-this.completeRedrawBounds.y1+1);e.getContext("2d").drawImage(this.context.canvas,-this.completeRedrawBounds.x1,-this.completeRedrawBounds.y1),this.history.push({tool:["brush","ChemyBrush"],actions:[{action:"drawImage",params:[e,this.completeRedrawBounds.x1,this.completeRedrawBounds.y1]}]})}this.path=null,this.copyCanvas=null}},{key:"drawImage",value:function(e,t,n){this.context.save(),this.context.clearRect(t,n,e.width,e.height),this.context.drawImage(e,t,n),this.context.restore()}},{key:"drawLineSegment",value:function(e,t,n,r){}}]),e}()})),r.register("3P46L",(function(e,n){t(e.exports,"brushesUI",(function(){return h}));var i=r("cVFne"),a=r("9mjXI"),o=r("iYbUv"),s=r("brjBD"),l=r("9rc5F"),c=r("dS2qM"),u=r("vCnsd"),h={penBrush:i.penBrushUi,blendBrush:a.blendBrushUi,sketchyBrush:o.sketchyBrushUi,pixelBrush:s.pixelBrushUi,chemyBrush:u.chemyBrushUi,smudgeBrush:c.smudgeBrushUi,eraserBrush:l.eraserBrushUi}})),r.register("cVFne",(function(n,i){t(n.exports,"penBrushUi",(function(){return v}));var a,o,s=r("eWjiX"),l=r("dAXbp"),c=r("7NTKy"),u=r("gWfkn"),h=r("lXqiv"),d=r("llzZ0"),p=r("fCJWy"),g=r("7gVvp"),f=r("74D3O"),m=r("1mH1z"),v=(a={image:e(g),tooltip:(0,m.LANG)("brush-pen"),sizeSlider:{min:.5,max:100,curve:s.BB.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1,curve:[[0,.01],[.5,.3],[1,1]]},Ui:null},o=[(0,m.LANG)("brush-pen-circle"),(0,m.LANG)("brush-pen-chalk"),(0,m.LANG)("brush-pen-calligraphy"),(0,m.LANG)("brush-pen-square")],m.languageStrings.subscribe((function(){a.tooltip=(0,m.LANG)("brush-pen"),o=[(0,m.LANG)("brush-pen-circle"),(0,m.LANG)("brush-pen-chalk"),(0,m.LANG)("brush-pen-calligraphy"),(0,m.LANG)("brush-pen-square")]})),a.Ui=function(e){var t,n,r=function(){for(var e=0;e<y.length;e++)y[e].className=e===x?"brush-alpha-selected":"brush-alpha"},i=function(e){v.setSize(e),v.setSpacing(Math.max(2,w.interpolate(e))/15)},g=document.createElement("div"),v=new l.brushes.PenBrush;v.setHistory(u.klHistory),e.onSizeChange(v.getSize());for(var y=[],x=0,b=0;b<4;b++)!function(e){var t=s.BB.el({title:o[e],onClick:function(){var t;x=t=e,v.setAlpha(t),r()}}),n=s.BB.canvas(70,70),i=n.getContext("2d");0===e||3===e?0===e?(i.beginPath(),i.arc(35,35,30,0,2*Math.PI),i.closePath(),i.fill()):i.fillRect(5,5,60,60):1===e?i.drawImage((0,f.genBrushAlpha01)(60),5,5):2===e&&i.drawImage((0,f.genBrushAlpha02)(60),5,5),t.style.backgroundImage="url("+n.toDataURL("image/png")+")",y.push(t)}(b);r();var B=new(0,h.Checkbox)({init:v.getLockAlpha(),label:(0,m.LANG)("brush-lock-alpha"),callback:function(e){v.setLockAlpha(e)},doHighlight:!0,title:(0,m.LANG)("brush-lock-alpha-title"),css:{cssFloat:"right",textAlign:"right"}}),w=new s.BB.SplineInterpolator([[0,15],[8,7],[14,4],[30,3],[50,2.7],[100,2]]);!function(){t=new(0,d.KlSlider)({label:(0,m.LANG)("brush-size"),width:225,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:v.getSize(),curve:a.sizeSlider.curve,eventResMs:c.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){i(t),e.onSizeChange(t)},formatFunc:function(e){return e<10?s.BB.round(e,1):Math.round(e)},manualInputRoundDigits:1}),n=new(0,d.KlSlider)({label:(0,m.LANG)("opacity"),width:225,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:a.opacitySlider.max,curve:a.opacitySlider.curve,eventResMs:c.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){v.setOpacity(t),e.onOpacityChange(t)}});var r=(0,p.penPressureToggle)(!0,(function(e){v.sizePressure(e)})),o=(0,p.penPressureToggle)(!1,(function(e){v.opacityPressure(e)}));g.append(s.BB.el({content:[t.getElement(),r],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),s.BB.el({content:[n.getElement(),o],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}));for(var l=document.createElement("div"),u=0;u<y.length;u++)l.appendChild(y[u]);l.style.marginTop="10px",g.appendChild(l),l.appendChild(B.getElement())}(),this.increaseSize=function(e){v.isDrawing()||t.changeSliderValue(e)},this.decreaseSize=function(e){v.isDrawing()||t.changeSliderValue(-e)},this.getSize=function(){return v.getSize()},this.setSize=function(e){i(e),t.setValue(e)},this.getOpacity=function(){return v.getOpacity()},this.setOpacity=function(e){v.setOpacity(e),n.setValue(e)},this.setColor=function(e){v.setColor(e)},this.setContext=function(e){v.setContext(e)},this.startLine=function(e,t,n){v.startLine(e,t,n)},this.goLine=function(e,t,n){v.goLine(e,t,n)},this.endLine=function(e,t){v.endLine(e,t)},this.getBrush=function(){return v},this.isDrawing=function(){return v.isDrawing()},this.getElement=function(){return g}},a)})),r.register("7NTKy",(function(e,n){t(e.exports,"eventResMs",(function(){return r}));var r=20})),r.register("7gVvp",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("iiCd6")})),r.register("9mjXI",(function(n,i){t(n.exports,"blendBrushUi",(function(){return f}));var a,o=r("eWjiX"),s=r("fCJWy"),l=r("7NTKy"),c=r("lXqiv"),u=r("dAXbp"),h=r("gWfkn"),d=r("llzZ0"),p=r("cQSIC"),g=r("1mH1z"),f=(a={image:e(p),tooltip:(0,g.LANG)("brush-blend"),sizeSlider:{min:.5,max:100,curve:o.BB.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1},Ui:null},g.languageStrings.subscribe((function(){a.tooltip=(0,g.LANG)("brush-blend")})),a.Ui=function(e){var t,n,r=function(e){p.setSize(e)},i=document.createElement("div"),p=new u.brushes.BlendBrush;p.setHistory(h.klHistory),e.onSizeChange(p.getSize()),function(){t=new(0,d.KlSlider)({label:(0,g.LANG)("brush-size"),width:225,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:58,curve:a.sizeSlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){r(t),e.onSizeChange(t)}}),n=new(0,d.KlSlider)({label:(0,g.LANG)("opacity"),width:225,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:p.getOpacity(),curve:a.opacitySlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){p.setOpacity(t),e.onOpacityChange(t)}});var u=new(0,d.KlSlider)({label:(0,g.LANG)("brush-blending"),width:225,height:30,min:0,max:1,value:p.getBlending(),eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(e){p.setBlending(e)}});u.getElement().style.marginTop="10px";var h=(0,s.penPressureToggle)(!0,(function(e){p.setSizePressure(e)})),f=(0,s.penPressureToggle)(!1,(function(e){p.setOpacityPressure(e)})),m=new(0,c.Checkbox)({init:p.getLockAlpha(),label:(0,g.LANG)("brush-lock-alpha"),callback:function(e){p.setLockAlpha(e)},doHighlight:!0,title:(0,g.LANG)("brush-lock-alpha-title"),css:{marginTop:"10px",display:"inline-block"}});i.append(o.BB.el({content:[t.getElement(),h],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),o.BB.el({content:[n.getElement(),f],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}),u.getElement(),m.getElement())}(),this.increaseSize=function(e){p.getIsDrawing()||t.changeSliderValue(e)},this.decreaseSize=function(e){p.getIsDrawing()||t.changeSliderValue(-e)},this.getSize=function(){return p.getSize()},this.setSize=function(e){r(e),t.setValue(e)},this.getOpacity=function(){return p.getOpacity()},this.setOpacity=function(e){p.setOpacity(e),n.setValue(e)},this.setColor=function(e){p.setColor(e)},this.setContext=function(e){p.setContext(e)},this.startLine=function(e,t,n){p.startLine(e,t,n)},this.goLine=function(e,t,n,r){p.goLine(e,t,n,r)},this.endLine=function(){p.endLine()},this.getBrush=function(){return p},this.isDrawing=function(){return p.getIsDrawing()},this.getElement=function(){return i}},a)})),r.register("cQSIC",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("6fRlX")})),r.register("iYbUv",(function(n,i){t(n.exports,"sketchyBrushUi",(function(){return p}));var a,o=r("dAXbp"),s=r("7NTKy"),l=r("gWfkn"),c=r("llzZ0"),u=r("bteky"),h=r("1mH1z"),d=r("eWjiX"),p=(a={image:e(u),tooltip:(0,h.LANG)("brush-sketchy"),sizeSlider:{min:.5,max:10},opacitySlider:{min:.01,max:1},Ui:null},h.languageStrings.subscribe((function(){a.tooltip=(0,h.LANG)("brush-sketchy")})),a.Ui=function(e){var t,n,r=document.createElement("div"),i=new o.brushes.SketchyBrush;i.setHistory(l.klHistory),e.onSizeChange(i.getSize()),function(){t=new(0,c.KlSlider)({label:(0,h.LANG)("brush-size"),width:250,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:2*i.getSize(),eventResMs:s.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){i.setSize(t),e.onSizeChange(t)},formatFunc:function(e){return e<10?d.BB.round(e,1):Math.round(e)},manualInputRoundDigits:1}),n=new(0,c.KlSlider)({label:(0,h.LANG)("opacity"),width:250,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:i.getOpacity(),eventResMs:s.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){i.setOpacity(t),e.onOpacityChange(t)}});var o=new(0,c.KlSlider)({label:(0,h.LANG)("brush-blending"),width:250,height:30,min:0,max:1,value:i.getBlending(),eventResMs:s.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(e){i.setBlending(e)}}),l=new(0,c.KlSlider)({label:(0,h.LANG)("brush-sketchy-scale"),width:250,height:30,min:1,max:20,value:i.getScale(),eventResMs:s.eventResMs,onChange:function(e){i.setScale(e)}});n.getElement().style.marginTop="10px",o.getElement().style.marginTop="10px",l.getElement().style.marginTop="10px",r.appendChild(t.getElement()),r.appendChild(n.getElement()),r.appendChild(o.getElement()),r.appendChild(l.getElement())}(),this.increaseSize=function(e){i.isDrawing()||t.changeSliderValue(e)},this.decreaseSize=function(e){i.isDrawing()||t.changeSliderValue(-e)},this.getSize=function(){return i.getSize()},this.setSize=function(e){!function(e){i.setSize(e)}(e),t.setValue(e)},this.getOpacity=function(){return i.getOpacity()},this.setOpacity=function(e){i.setOpacity(e),n.setValue(e)},this.setColor=function(e){i.setColor(e)},this.setContext=function(e){i.setContext(e)},this.startLine=function(e,t,n){i.startLine(e,t,n)},this.goLine=function(e,t,n){i.goLine(e,t,n,null)},this.endLine=function(){i.endLine()},this.getSeed=function(){return parseInt(i.getSeed())},this.setSeed=function(e){i.setSeed(parseInt(e))},this.getBrush=function(){return i},this.isDrawing=function(){return i.isDrawing()},this.getElement=function(){return r}},a)})),r.register("bteky",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("hC7PC")})),r.register("brjBD",(function(n,i){t(n.exports,"pixelBrushUi",(function(){return f}));var a,o=r("eWjiX"),s=r("dAXbp"),l=r("7NTKy"),c=r("gWfkn"),u=r("lXqiv"),h=r("llzZ0"),d=r("fCJWy"),p=r("4PDnu"),g=r("1mH1z"),f=(a={image:e(p),tooltip:(0,g.LANG)("brush-pixel"),sizeSlider:{min:.5,max:100,curve:o.BB.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1,curve:[[0,.01],[.5,.3],[1,1]]},Ui:null},g.languageStrings.subscribe((function(){a.tooltip=(0,g.LANG)("brush-pixel")})),a.Ui=function(e){var t,n,r=function(e){p.setSize(e),p.setSpacing(y.interpolate(e)/e)},i=document.createElement("div"),p=new s.brushes.PixelBrush;p.setHistory(c.klHistory),e.onSizeChange(p.getSize());var f=new(0,u.Checkbox)({init:p.getLockAlpha(),label:(0,g.LANG)("brush-lock-alpha"),callback:function(e){p.setLockAlpha(e)},doHighlight:!0,title:(0,g.LANG)("brush-lock-alpha-title"),css:{marginRight:"10px"}}),m=new(0,u.Checkbox)({init:p.getIsEraser(),label:(0,g.LANG)("eraser"),callback:function(e){p.setIsEraser(e)},css:{marginRight:"10px"}}),v=new(0,u.Checkbox)({init:p.getUseDither(),label:(0,g.LANG)("brush-pixel-dither"),callback:function(e){p.setUseDither(e)}}),y=new o.BB.SplineInterpolator([[.5,.45],[100,4]]);!function(){t=new(0,h.KlSlider)({label:(0,g.LANG)("brush-size"),width:225,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:p.getSize(),curve:a.sizeSlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){r(t),e.onSizeChange(t)}}),n=new(0,h.KlSlider)({label:(0,g.LANG)("opacity"),width:225,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:a.opacitySlider.max,eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){p.setOpacity(t),e.onOpacityChange(t)}});var s=(0,d.penPressureToggle)(!0,(function(e){p.sizePressure(e)}));i.append(o.BB.el({content:[t.getElement(),s],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),n.getElement());var c=o.BB.el({parent:i,css:{display:"flex",marginTop:"10px"}});c.appendChild(f.getElement()),c.appendChild(m.getElement()),c.appendChild(v.getElement())}(),this.increaseSize=function(e){p.isDrawing()||t.changeSliderValue(e)},this.decreaseSize=function(e){p.isDrawing()||t.changeSliderValue(-e)},this.getSize=function(){return p.getSize()},this.setSize=function(e){r(e),t.setValue(2*e)},this.getOpacity=function(){return p.getOpacity()},this.setOpacity=function(e){p.setOpacity(e),n.setValue(100*e)},this.setColor=function(e){p.setColor(e)},this.setContext=function(e){p.setContext(e)},this.startLine=function(e,t,n){p.startLine(e,t,n)},this.goLine=function(e,t,n){p.goLine(e,t,n)},this.endLine=function(e,t){p.endLine(e,t)},this.getBrush=function(){return p},this.isDrawing=function(){return p.isDrawing()},this.getElement=function(){return i}},a)})),r.register("4PDnu",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("eZgVv")})),r.register("9rc5F",(function(n,i){t(n.exports,"eraserBrushUi",(function(){return f}));var a,o=r("eWjiX"),s=r("dAXbp"),l=r("7NTKy"),c=r("gWfkn"),u=r("llzZ0"),h=r("fCJWy"),d=r("lXqiv"),p=r("984eq"),g=r("1mH1z"),f=(a={image:e(p),tooltip:(0,g.LANG)("eraser")+" [E]",sizeSlider:{min:.5,max:200,curve:o.BB.quadraticSplineInput(.5,200,.1)},opacitySlider:{min:.01,max:1},Ui:null},g.languageStrings.subscribe((function(){a.tooltip=(0,g.LANG)("eraser")+" [E]"})),a.Ui=function(e){var t,n,r=function(e){p.setSize(e)},i=document.createElement("div"),p=new s.brushes.EraserBrush;p.setHistory(c.klHistory),e.onSizeChange(p.getSize());var f=!1;!function(){t=new(0,u.KlSlider)({label:(0,g.LANG)("brush-size"),width:225,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:30,curve:a.sizeSlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){r(t),e.onSizeChange(t)},formatFunc:function(e){return e<10?o.BB.round(e,1):Math.round(e)},manualInputRoundDigits:1}),n=new(0,u.KlSlider)({label:(0,g.LANG)("opacity"),width:225,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:a.opacitySlider.max,eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){p.setOpacity(t),e.onOpacityChange(t)}});var s=(0,h.penPressureToggle)(!0,(function(e){p.sizePressure(e)})),c=(0,h.penPressureToggle)(!1,(function(e){p.opacityPressure(e)}));i.append(o.BB.el({content:[t.getElement(),s],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),o.BB.el({content:[n.getElement(),c],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}));var m=new(0,d.Checkbox)({init:!1,label:(0,g.LANG)("brush-eraser-transparent-bg"),callback:function(e){f=e,p.setTransparentBG(e)},css:{marginTop:"10px"}});i.appendChild(m.getElement())}(),this.increaseSize=function(e){p.isDrawing()||t.changeSliderValue(e)},this.decreaseSize=function(e){p.isDrawing()||t.changeSliderValue(-e)},this.getSize=function(){return p.getSize()},this.setSize=function(e){r(e),t.setValue(e)},this.getOpacity=function(){return p.getOpacity()},this.setOpacity=function(e){p.setOpacity(e),n.setValue(e)},this.setColor=function(e){},this.setContext=function(e){p.setContext(e)},this.startLine=function(e,t,n){p.startLine(e,t,n)},this.goLine=function(e,t,n){p.goLine(e,t,n)},this.endLine=function(){p.endLine()},this.getBrush=function(){return p},this.getIsTransparentBg=function(){return f},this.isDrawing=function(){return p.isDrawing()},this.getElement=function(){return i}},a)})),r.register("984eq",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("fPZin")})),r.register("dS2qM",(function(n,i){t(n.exports,"smudgeBrushUi",(function(){return f}));var a,o=r("eWjiX"),s=r("dAXbp"),l=r("7NTKy"),c=r("gWfkn"),u=r("lXqiv"),h=r("llzZ0"),d=r("fCJWy"),p=r("3QgTy"),g=r("1mH1z"),f=(a={image:e(p),tooltip:(0,g.LANG)("brush-smudge"),sizeSlider:{min:.5,max:100,curve:o.BB.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1,curve:[[0,.01],[.5,.3],[1,1]]},Ui:null},g.languageStrings.subscribe((function(){a.tooltip=(0,g.LANG)("brush-smudge")})),a.Ui=function(e){var t,n,r=function(e){p.setSize(e),p.setSpacing(Math.max(2,m.interpolate(e))/15)},i=document.createElement("div"),p=new s.brushes.SmudgeBrush;p.setHistory(c.klHistory),e.onSizeChange(p.getSize());var f=new(0,u.Checkbox)({init:p.getLockAlpha(),label:(0,g.LANG)("brush-lock-alpha"),callback:function(e){p.setLockAlpha(e)},doHighlight:!0,title:(0,g.LANG)("brush-lock-alpha-title")}),m=new o.BB.SplineInterpolator([[0,15],[8,7],[14,4],[30,3],[50,2.7],[100,2]]);!function(){t=new(0,h.KlSlider)({label:(0,g.LANG)("brush-size"),width:225,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:p.getSize(),curve:a.sizeSlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){r(t),e.onSizeChange(t)},formatFunc:function(e){return e<10?o.BB.round(e,1):Math.round(e)},manualInputRoundDigits:1}),n=new(0,h.KlSlider)({label:(0,g.LANG)("opacity"),width:225,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:p.getOpacity(),curve:a.opacitySlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){p.setOpacity(t),e.onOpacityChange(t)}});var s=(0,d.penPressureToggle)(!1,(function(e){p.sizePressure(e)})),c=(0,d.penPressureToggle)(!1,(function(e){p.opacityPressure(e)}));i.append(o.BB.el({content:[t.getElement(),s],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),o.BB.el({content:[n.getElement(),c],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}})),o.BB.el({parent:i,css:{marginTop:"10px"}}).append(f.getElement())}(),this.increaseSize=function(e){p.getIsDrawing()||t.changeSliderValue(e)},this.decreaseSize=function(e){p.getIsDrawing()||t.changeSliderValue(-e)},this.getSize=function(){return p.getSize()},this.setSize=function(e){r(e),t.setValue(e)},this.getOpacity=function(){return p.getOpacity()},this.setOpacity=function(e){p.setOpacity(e),n.setValue(e)},this.setColor=function(e){p.setColor(e)},this.setContext=function(e){p.setContext(e)},this.startLine=function(e,t,n){p.startLine(e,t,n)},this.goLine=function(e,t,n){p.goLine(e,t,n)},this.endLine=function(e,t){p.endLine()},this.getBrush=function(){return p},this.isDrawing=function(){return p.getIsDrawing()},this.getElement=function(){return i}},a)})),r.register("3QgTy",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("fp7H1")})),r.register("vCnsd",(function(n,i){t(n.exports,"chemyBrushUi",(function(){return m}));var a,o=r("eWjiX"),s=r("7NTKy"),l=r("lXqiv"),c=r("dAXbp"),u=r("gWfkn"),h=r("llzZ0"),d=r("18kre"),p=r("iskOY"),g=r("iDHln"),f=r("1mH1z"),m=(a={image:e(d),tooltip:(0,f.LANG)("brush-chemy"),sizeSlider:{min:.25,max:25,curve:o.BB.quadraticSplineInput(.25,25,.1),isDisabled:!0},opacitySlider:{min:.01,max:1},Ui:null},f.languageStrings.subscribe((function(){a.tooltip=(0,f.LANG)("brush-chemy")})),a.Ui=function(e){var t,n,r=function(e){d.setSize(e)},i=document.createElement("div"),d=new c.brushes.ChemyBrush;d.setHistory(u.klHistory),e.onSizeChange(d.getSize()),function(){t=new(0,h.KlSlider)({label:(0,f.LANG)("brush-size"),width:250,height:30,min:a.sizeSlider.min,max:a.sizeSlider.max,value:d.getSize(),curve:a.sizeSlider.curve,eventResMs:s.eventResMs,isEnabled:"stroke"===d.getMode(),toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){r(t),e.onSizeChange(t)},formatFunc:function(e){return e<5?o.BB.round(e,1):Math.round(e)},manualInputRoundDigits:1}),n=new(0,h.KlSlider)({label:(0,f.LANG)("opacity"),width:250,height:30,min:a.opacitySlider.min,max:a.opacitySlider.max,value:d.getOpacity(),eventResMs:s.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){d.setOpacity(t),e.onOpacityChange(t)}}),o.BB.css(n.getElement(),{marginTop:"10px"});var c=new(0,l.Checkbox)({init:d.getIsEraser(),label:(0,f.LANG)("eraser"),callback:function(e){d.setIsEraser(e)},css:{marginTop:"10px",marginLeft:"10px"}}),u=new(0,l.Checkbox)({init:d.getLockAlpha(),label:(0,f.LANG)("brush-lock-alpha"),callback:function(e){d.setLockAlpha(e)},doHighlight:!0,title:(0,f.LANG)("brush-lock-alpha-title"),css:{marginTop:"10px"}}),m=o.BB.el({css:{display:"flex",marginTop:"10px"}}),v=19,y=new(0,p.Options)({optionArr:[{id:"fill",label:o.BB.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"#000",style:"transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(".concat(v,", ").concat(v,") translate(0.5px, 0.5px)"),d:"M 0,0 C 1.5,0 -0.5,1 1,1"}]}),title:(0,f.LANG)("brush-chemy-fill")},{id:"stroke",label:o.BB.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(".concat(v,", ").concat(v,") translate(0.5px, 0.5px)"),d:"M 0,0 C 1.5,0 -0.5,1 1,1"}]}),title:(0,f.LANG)("brush-chemy-stroke")}],initId:d.getMode(),onChange:function(n){d.setMode(n),a.sizeSlider.isDisabled="fill"===d.getMode(),t.setIsEnabled(!a.sizeSlider.isDisabled);var r=d.getSize();t.setValue(r),e.onSizeChange(r),e.onConfigChange()}}),x=new(0,g.BoxToggle)({label:o.BB.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 1px",d:"M ".concat(17.5,",").concat(8," ").concat(17.5,",").concat(27)}]}),title:(0,f.LANG)("brush-chemy-mirror-x"),init:d.getXSymmetry(),onChange:function(e){d.setXSymmetry(e)}}),b=new(0,g.BoxToggle)({label:o.BB.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 1px",d:"M ".concat(8,",").concat(17.5," ").concat(27,",").concat(17.5)}]}),title:(0,f.LANG)("brush-chemy-mirror-y"),init:d.getYSymmetry(),onChange:function(e){d.setYSymmetry(e)}}),B=new(0,g.BoxToggle)({label:o.BB.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"defs",childrenArr:[{elementType:"linearGradient",id:"gradient",x1:"0",y1:"0",x2:"0",y2:"1",childrenArr:[{elementType:"stop",offset:"0%","stop-color":"rgba(0,0,0,0)"},{elementType:"stop",offset:"100%","stop-color":"rgba(0,0,0,1)"}]}]},{elementType:"rect",fill:"url('#gradient')",x:"8",y:"8",width:"19",height:"19"}]}),title:(0,f.LANG)("brush-chemy-gradient"),init:d.getGradient(),onChange:function(e){d.setGradient(e)}});o.BB.css(x.getElement(),{marginLeft:"10px"});var w={marginLeft:"4px"};o.BB.css(b.getElement(),w),o.BB.css(B.getElement(),w),m.append(y.getElement(),x.getElement(),b.getElement(),B.getElement()),i.append(t.getElement(),n.getElement(),m,o.BB.el({content:[u.getElement(),c.getElement()],css:{display:"flex"}}))}(),this.increaseSize=function(e){d.getIsDrawing()||"stroke"!==d.getMode()||t.changeSliderValue(e)},this.decreaseSize=function(e){d.getIsDrawing()||"stroke"!==d.getMode()||t.changeSliderValue(-e)},this.getSize=function(){return d.getSize()},this.setSize=function(e){r(e),t.setValue(e)},this.getOpacity=function(){return d.getOpacity()},this.setOpacity=function(e){d.setOpacity(e),n.setValue(e)},this.setColor=function(e){d.setColor(e)},this.setContext=function(e){d.setContext(e)},this.startLine=function(e,t,n){d.startLine(e,t)},this.goLine=function(e,t,n,r){d.goLine(e,t)},this.endLine=function(){d.endLine()},this.getBrush=function(){return d},this.isDrawing=function(){return d.getIsDrawing()},this.getElement=function(){return i}},a)})),r.register("18kre",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("eX098")})),r.register("iDHln",(function(e,n){t(e.exports,"BoxToggle",(function(){return s}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("eWjiX"),s=function(){"use strict";function e(t){var n=this;(0,i.default)(this,e),this.value=!!t.init,this.el=o.BB.el({content:t.label,title:t.title,className:"string"==typeof t.label?"kl-box-toggle":"kl-box-toggle kl-box-toggle--custom-el",onClick:function(){n.value=!n.value,n.update(),t.onChange(n.value)},css:{cursor:"pointer"}}),"string"!=typeof t.label&&o.BB.css(t.label,{display:"block",pointerEvents:"none"}),this.update()}return(0,a.default)(e,[{key:"update",value:function(){this.el.classList.toggle("kl-box-toggle--active",this.value)}},{key:"getValue",value:function(){return this.value}},{key:"setValue",value:function(e){this.value=!!e,this.update()}},{key:"getElement",value:function(){return this.el}},{key:"destroy",value:function(){o.BB.destroyEl(this.el)}}]),e}()})),r.register("5ebUJ",(function(e,n){t(e.exports,"showIframePopup",(function(){return s}));var i=r("eWjiX"),a=r("ekHRj"),o=r("1mH1z");function s(e,t){if(t||!(window.innerHeight<500||window.innerWidth<700)){var n,r=i.BB.el({tagName:"iframe",custom:{src:e},css:{width:"100%",height:"100%"}}),s=i.BB.el({});t||(n=i.BB.el({tagName:"a",parent:s,content:(0,o.LANG)("modal-new-tab"),custom:{href:"help",target:"_blank"},onClick:function(){l.close()}}),r.onload=function(){i.BB.setAttributes(n,{href:""+r.contentWindow.location})});var l=new(0,a.Popup)({title:s,content:r,width:880,isMaxHeight:!0,onClose:function(){n&&i.BB.destroyEl(n)}})}else window.open(e)}})),r.register("bHZQg",(function(e,n){t(e.exports,"RadioList",(function(){return l}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("7U0Ew"),s=r("eWjiX"),l=function(){"use strict";function e(t){var n=t.name,r=t.init,a=t.items,l=t.ignoreFocus,c=this;(0,i.default)(this,e),(0,o.default)(this,"inputs",[]),this.el=s.BB.el({className:"kl-radio"}),a.forEach((function(e){var t=s.BB.el({tagName:"label"}),i=s.BB.el({tagName:"input",parent:t,custom:{name:n,value:e.value,type:"radio"}});l&&i.setAttribute("data-ignore-focus","true"),r===e.value&&(i.checked=!0),t.append(e.label),c.el.append(t),c.inputs.push(i)}))}return(0,a.default)(e,[{key:"getValue",value:function(){for(var e=0;e<this.inputs.length;e++)if(this.inputs[e].checked)return this.inputs[e].value;return null}},{key:"getElement",value:function(){return this.el}}]),e}()})),r.register("9pcu9",(function(n,i){t(n.exports,"BrowserStorageUi",(function(){return g}));var a=r("3kC7t"),o=r("gFgFC"),s=r("kiQ5H"),l=r("cijLd"),c=r("eWjiX"),u=r("8yL1I"),h=r("5ebUJ"),d=r("hrnUX"),p=r("1mH1z"),g=function(){"use strict";function t(n,r,i,s,d){var g,f=this;(0,o.default)(this,t),this.projectStore=n,this.getProject=r,this.saveReminder=i,this.klRootEl=s,this.options=d,this.element=c.BB.el({css:{display:"grid",gridTemplateColumns:"1fr 0fr",gridTemplateRows:"0fr 0fr 0fr",gap:"0 0",gridTemplateAreas:'"title title" "preview store" "preview clear"'}});var m=c.BB.el({parent:this.element,content:(0,p.LANG)("file-storage"),css:{gridArea:"title",display:"flex",margin:"-5px 0"}});if(this.infoEl=c.BB.el({parent:m,content:"?",title:(0,p.LANG)("file-storage-about"),css:{cursor:"pointer",marginLeft:"5px",width:"19px",height:"19px",borderRadius:"100%",textAlign:"center",lineHeight:"19px",fontWeight:"bold",boxShadow:"inset 0 0 0 1px #000"},onClick:function(){(0,h.showIframePopup)("./help/#help-browser-storage",!1)}}),this.projectStore.isBroken())c.BB.el({parent:this.element,content:"🔴 "+(0,p.LANG)("file-storage-cant-access"),css:{marginTop:"10px"}});else{this.previewEl=c.BB.el({parent:this.element,title:(0,p.LANG)("file-storage-thumb-title"),css:{gridArea:"preview",display:"flex",alignItems:"center",justifyContent:"center",marginTop:"10px",position:"relative",boxShadow:"inset 0 0 0 1px #aaa",background:"#cdcdcd",color:"#545454",colorScheme:"only light",minHeight:"67px"}}),this.ageEl=c.BB.el({css:{position:"absolute",right:"0",bottom:"0",width:"100%",textAlign:"center",background:"rgba(0,0,0,0.7)",color:"#fff",textSize:"13px"}});var v=(null==d?void 0:d.isFocusable)?{}:{tabIndex:-1};this.storeButtonEl=c.BB.el({parent:this.element,tagName:"button",className:"gridButton",content:(0,p.LANG)("file-storage-store"),css:{gridArea:"store"},custom:v,onClick:function(){return f.store()}}),this.clearButtonEl=c.BB.el({parent:this.element,tagName:"button",className:"gridButton",content:'<img src="'+e(u)+'" height="20"/> '+(0,p.LANG)("file-storage-clear"),css:{gridArea:"clear"},custom:v,onClick:function(){return f.clear()}}),(null===(g=this.options)||void 0===g?void 0:g.hideClearButton)&&(this.clearButtonEl.style.visibility="hidden"),this.storeListener={onUpdate:function(e,t){f.updateThumb(e,t)}},this.projectStore.subscribe(this.storeListener),setInterval((function(){return f.updateAge()}),6e4);var y=this;(0,a.default)(e(l).mark((function t(){var n;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.projectStore.read();case 3:(n=e.sent)?y.updateThumb(n.timestamp,n.thumbnail):y.updateThumb(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),setTimeout((function(){throw new Error("storage-ui: failed initial read browser storage, "+e.t0)}),0);case 10:case"end":return e.stop()}}),t,null,[[0,7]])})))()}}return(0,s.default)(t,[{key:"updateAge",value:function(){if(this.timestamp){var e,t=(new Date).getTime()-this.timestamp;t=Math.floor(t/1e3/60),e=(0,p.LANG)("file-storage-min-ago").replace("{x}",""+t),t>60&&(t=Math.floor(t/60),e=(0,p.LANG)("file-storage-hours-ago").replace("{x}",""+t),t>24&&(t=Math.floor(t/24),e=(0,p.LANG)("file-storage-days-ago").replace("{x}",""+t),t>31&&(e=(0,p.LANG)("file-storage-month-ago")))),this.ageEl.textContent=e}}},{key:"resetButtons",value:function(){this.timestamp?(this.storeButtonEl.textContent=(0,p.LANG)("file-storage-overwrite"),this.storeButtonEl.disabled=!1,this.clearButtonEl.disabled=!1):(this.storeButtonEl.textContent=(0,p.LANG)("file-storage-store"),this.storeButtonEl.disabled=!1,this.clearButtonEl.disabled=!0)}},{key:"updateThumb",value:function(e,t){this.timestamp=e,this.timestamp?(c.BB.css(t,{display:"block",maxWidth:"calc(100% - 2px)",maxHeight:"calc(100% - 2px)",margin:"0 auto",background:"url('"+c.BB.createCheckerCanvas(4).toDataURL("image/png")+"')",boxShadow:"0 0 0 1px #aaa",pointerEvents:"none"}),this.previewEl.innerHTML="",this.updateAge(),this.previewEl.append(t,this.ageEl)):this.previewEl.innerHTML=(0,p.LANG)("file-storage-empty"),this.resetButtons()}},{key:"store",value:function(){var t=this;return(0,a.default)(e(l).mark((function n(){return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storeButtonEl.textContent=(0,p.LANG)("file-storage-storing"),t.storeButtonEl.disabled=!0,t.clearButtonEl.disabled=!0,e.next=5,new Promise((function(e){setTimeout((function(){return e(null)}),20)}));case 5:return e.prev=5,e.next=8,t.projectStore.store(t.getProject());case 8:t.saveReminder.reset(),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(5),t.resetButtons(),d.KL.popup({target:t.klRootEl,type:"error",message:["".concat((0,p.LANG)("file-storage-failed-1"),"<ul>"),"<li>".concat((0,p.LANG)("file-storage-failed-2"),"</li>"),"<li>".concat((0,p.LANG)("file-storage-failed-3"),"</li>"),"<li>".concat((0,p.LANG)("file-storage-failed-4"),"</li>"),"</ul>"].join(""),buttons:["Ok"]}),setTimeout((function(){throw new Error("storage-ui: failed to store browser storage, "+e.t0)}),0);case 16:case"end":return e.stop()}}),n,null,[[5,11]])})))()}},{key:"clear",value:function(){var t=this;return(0,a.default)(e(l).mark((function n(){return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storeButtonEl.disabled=!0,t.clearButtonEl.disabled=!0,e.prev=2,e.next=5,t.projectStore.clear();case 5:e.next=12;break;case 7:e.prev=7,e.t0=e.catch(2),t.resetButtons(),d.KL.popup({target:t.klRootEl,type:"error",message:(0,p.LANG)("file-storage-failed-clear"),buttons:["Ok"]}),setTimeout((function(){throw new Error("storage-ui: failed to clear browser storage, "+e.t0)}),0);case 12:case"end":return e.stop()}}),n,null,[[2,7]])})))()}},{key:"getElement",value:function(){return this.element}},{key:"show",value:function(){}},{key:"hide",value:function(){}},{key:"destroy",value:function(){c.BB.destroyEl(this.infoEl),c.BB.destroyEl(this.storeButtonEl),c.BB.destroyEl(this.clearButtonEl),this.projectStore.unsubscribe(this.storeListener)}}]),t}()})),r.register("6mTnI",(function(n,i){t(n.exports,"ProjectStore",(function(){return g}));var a=r("3kC7t"),o=r("gFgFC"),s=r("kiQ5H"),l=r("7U0Ew"),c=r("cijLd"),u=r("3hwQ7"),h=r("9BlwZ"),d=r("6l0gQ");function p(e){return new Promise((function(t,n){e(t,n)}))}var g=function(){"use strict";function t(){var n=this;(0,o.default)(this,t),(0,l.default)(this,"listeners",[]),(0,l.default)(this,"accessHasFailed",!1),window.addEventListener("storage",(function(t){if("indexedDbUpdatedAt"===t.key&&0!==n.listeners.length)try{var r=n;(0,a.default)(e(c).mark((function t(){var n;return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.read();case 2:(n=e.sent)?r.emit(n.timestamp,n.thumbnail):r.emit();case 4:case"end":return e.stop()}}),t)})))()}catch(e){0===e.message.indexOf("db-error")&&(n.accessHasFailed=!0)}}))}return(0,s.default)(t,[{key:"lowLevelStore",value:function(t){return(0,a.default)(e(c).mark((function n(){return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){(0,h.storeKlProjectObj)(t,e,n)}));case 2:case"end":return e.stop()}}),n)})))()}},{key:"lowLevelRead",value:function(){return(0,a.default)(e(c).mark((function t(){return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(h.getKlProjectObj);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),t)})))()}},{key:"lowLevelClear",value:function(){return(0,a.default)(e(c).mark((function t(){return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(h.clear);case 2:case"end":return e.stop()}}),t)})))()}},{key:"emit",value:function(e,t){this.listeners.forEach((function(n){n.onUpdate(e,t)}))}},{key:"updateTimestamp",value:function(){d.LocalStorage.setItem("indexedDbUpdatedAt",""+(new Date).getTime())}},{key:"read",value:function(){var t=this;return(0,a.default)(e(c).mark((function n(){var r,i;return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,t.lowLevelRead();case 4:r=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),t.accessHasFailed=!0,new Error("db-error: "+e.t0);case 11:if(r){e.next=13;break}return e.abrupt("return",null);case 13:return e.prev=14,e.next=17,u.ProjectConverter.readStorageProject(r);case 17:i=e.sent,e.next=23;break;case 20:throw e.prev=20,e.t1=e.catch(14),new Error("format-error: "+e.t1);case 23:return e.abrupt("return",i);case 24:case"end":return e.stop()}}),n,null,[[1,7],[14,20]])})))()}},{key:"store",value:function(t){var n=this;return(0,a.default)(e(c).mark((function r(){var i,a,o;return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=u.ProjectConverter.createStorageProject(t),e.next=4,n.lowLevelStore(i);case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),n.accessHasFailed=!0,new Error("db-error: "+e.t0);case 10:return e.next=12,n.lowLevelRead();case 12:return a=e.sent,o=null,e.prev=14,e.next=17,u.ProjectConverter.readStorageProject(a);case 17:o=e.sent,e.next=27;break;case 20:return e.prev=20,e.t1=e.catch(14),e.next=24,n.lowLevelClear();case 24:throw n.updateTimestamp(),setTimeout((function(){return n.emit()}),0),new Error("format-error: "+e.t1);case 27:n.updateTimestamp(),setTimeout((function(){return n.emit(o.timestamp,o.thumbnail)}),0);case 29:case"end":return e.stop()}}),r,null,[[0,6],[14,20]])})))()}},{key:"clear",value:function(){var t=this;return(0,a.default)(e(c).mark((function n(){return e(c).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.lowLevelClear();case 2:t.updateTimestamp(),setTimeout((function(){return t.emit()}),0);case 4:case"end":return e.stop()}}),n)})))()}},{key:"subscribe",value:function(e){this.listeners.includes(e)||this.listeners.push(e)}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.listeners.length;t++)if(e===this.listeners[t])return void this.listeners.splice(t,1)}},{key:"isBroken",value:function(){return this.accessHasFailed}}]),t}()})),r.register("3hwQ7",(function(n,i){t(n.exports,"ProjectConverter",(function(){return p}));var a=r("3kC7t"),o=r("gFgFC"),s=r("kiQ5H"),l=r("cijLd"),c=r("eWjiX"),u=r("aSJRf"),h=r("2wCWz");function d(e){return new Promise((function(t,n){var r=new Image;try{r.src=c.BB.imageBlobToUrl(e)}catch(e){return void n("imageBlobToUrl, "+e.message)}r.onload=function(){URL.revokeObjectURL(r.src),t(r)},r.onabort=function(){n("layer image failed loading")},r.onerror=function(){n("layer image failed loading")}}))}var p=function(){"use strict";function t(){(0,o.default)(this,t)}return(0,s.default)(t,null,[{key:"createThumbnail",value:function(e){var t=c.BB.fitInto(e.width,e.height,240,240).width/e.width;return(0,u.drawProject)(e,t)}},{key:"createStorageProject",value:function(e){return{id:1,timestamp:(new Date).getTime(),thumbnail:(0,h.base64ToBlob)(t.createThumbnail(e).toDataURL("image/png")),width:e.width,height:e.height,layers:e.layers.map((function(e){var t;if(!(e.image instanceof HTMLCanvasElement))throw new Error("Not implemented");return t=(0,h.base64ToBlob)(e.image.toDataURL("image/png")),{name:e.name,opacity:e.opacity,mixModeStr:e.mixModeStr,blob:t}}))}}},{key:"readStorageProject",value:function(n){return(0,a.default)(e(l).mark((function r(){var i,a;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!n.width||!n.height||isNaN(n.width)||isNaN(n.height)||n.width<1||n.height<1)){e.next=2;break}throw new Error("readStorageProject invalid canvas size: "+n.width+", "+n.height);case 2:return e.t0=n.width,e.t1=n.height,e.next=6,Promise.all(n.layers.map((function(e){return d(e.blob)})));case 6:if(e.t2=e.sent.map((function(e,t){return{name:n.layers[t].name,opacity:n.layers[t].opacity,mixModeStr:n.layers[t].mixModeStr,image:e}})),i={width:e.t0,height:e.t1,layers:e.t2},!n.thumbnail){e.next=15;break}return e.next=12,d(n.thumbnail);case 12:a=e.sent,e.next=16;break;case 15:a=t.createThumbnail(i);case 16:return e.abrupt("return",{project:i,timestamp:n.timestamp,thumbnail:a});case 17:case"end":return e.stop()}}),r)})))()}}]),t}()})),r.register("2wCWz",(function(e,n){function r(e){for(var t=e.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/),n=atob(t[3]),r=new ArrayBuffer(n.length),i=new Uint8Array(r),a=0;a<i.length;a++)i[a]=n.charCodeAt(a);return new Blob([i],{type:t[1]})}t(e.exports,"base64ToBlob",(function(){return r}))})),r.register("eK8ID",(function(n,i){t(n.exports,"FileTab",(function(){return v}));var a=r("gFgFC"),o=r("kiQ5H"),s=r("eWjiX"),l=r("hrnUX"),c=r("1gUFn"),u=r("lLh5u"),h=r("5xpQb"),d=r("4xKQD"),p=r("gswMe"),g=r("fcsnL"),f=r("9pcu9"),m=r("1mH1z"),v=function(){"use strict";function t(n,r,i,o,v,y,x,b,B,w,C,S){var k=this;(0,a.default)(this,t),this.exportType=o;var L=this;this.div=document.createElement("div");setTimeout((function(){var t=function(){var e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div");return e.appendChild(t),e.appendChild(n),s.BB.css(t,{clear:"both"}),s.BB.css(n,{marginLeft:"10px",marginRight:"10px",marginTop:"10px",borderBottom:"1px solid rgba(0,0,0,0.2)",clear:"both"}),e},a=document.createElement("div"),T=document.createElement("button"),E=document.createElement("button"),M=document.createElement("button"),I=document.createElement("button"),A=document.createElement("button");T.style.cssFloat="left",s.BB.css(E,{cssFloat:"left",clear:"both"}),s.BB.css(A,{cssFloat:"left",clear:"both"}),T.tabIndex=-1,E.tabIndex=-1,M.tabIndex=-1,I.tabIndex=-1,A.tabIndex=-1,T.innerHTML="<img src='".concat(e(c),"' alt='icon' height='20'/>").concat((0,m.LANG)("file-new")),E.innerHTML="<img src='".concat(e(u),"' alt='icon' height='20'/>").concat((0,m.LANG)("file-save")),M.innerHTML="<img src='".concat(e(h),"' alt='icon' height='20'/>").concat((0,m.LANG)("file-share")),I.innerHTML="<img style='float:left' src='".concat(e(d),"' height='20' alt='icon'/>").concat((0,m.LANG)("file-upload")),A.innerHTML="<img src='".concat(e(g),"' alt='icon' height='20'/>").concat((0,m.LANG)("file-copy")),A.title=(0,m.LANG)("file-copy-title"),T.className="gridButton",E.className="gridButton",M.className="gridButton",I.className="gridButton",A.className="gridButton",k.importButton=document.createElement("input"),k.importButton.tabIndex=-1,k.importButton.type="file",k.importButton.multiple=!0,k.importButton.accept="image",k.importButton.size="71",k.importButton.textContent="Import";var R,P,O=k.importButton;!function(){(O=document.createElement("div")).className="gridButton",O.style.position="relative",O.style.cursor="pointer",O.style.cssFloat="left";var t=document.createElement("div");t.style.width="120px",t.style.height="28px",t.style.overflow="hidden",t.style.cursor="pointer",t.style.position="relative",O.appendChild(t),t.appendChild(L.importButton);var n=document.createElement("button");n.innerHTML="<img style='float:left' height='20' src='"+e(p)+"' alt='icon'/>"+(0,m.LANG)("file-import"),n.tabIndex=-1,s.BB.css(n,{width:"120px",display:"box",position:"absolute",left:"0",top:"0",cursor:"pointer"}),s.BB.css(L.importButton,{display:"none"}),O.appendChild(n),n.onclick=function(){L.importButton.click()}}(),k.importButton.onchange=function(e){y(L.importButton.files,"default"),L.importButton.value=""},R=s.BB.el({css:{fontSize:"15px",marginLeft:"10px",marginTop:"10px",cssFloat:"left",width:"calc(50% - 15px)",height:"30px"}}),P=new l.KL.Select({optionArr:[["png",(0,m.LANG)("file-save-png")],["psd",(0,m.LANG)("file-save-psd")],["layers",(0,m.LANG)("file-save-layers")]],initValue:o,onChange:function(e){v(o=e),x()}}),s.BB.css(P.getElement(),{width:"120px",height:"30px"}),R.appendChild(P.getElement()),T.onclick=b,E.onclick=function(){x()},M.onclick=function(){M.disabled=!0,B((function(){M.disabled=!1}))},I.onclick=function(){w()},A.onclick=function(){A.blur(),C()};var D=document.createElement("div");D.textContent="⚠️ "+(0,m.LANG)("file-no-autosave"),s.BB.css(D,{textAlign:"center",marginTop:"10px",background:"rgb(243, 243, 161)",padding:"5px 0px",color:"rgba(0,0,0,0.65)",fontSize:"15px"}),L.fileBrowserStorage=new(0,f.BrowserStorageUi)(r,i,S,n),s.BB.css(L.fileBrowserStorage.getElement(),{margin:"10px"}),s.BB.append(a,[D,T,O,s.BB.el({css:{clear:"both"}}),E,R,s.BB.el({css:{clear:"both"}}),A,s.BB.canShareFiles()?M:null,s.BB.el({css:{clear:"both"}}),t(),L.fileBrowserStorage.getElement(),t(),I]),k.div.appendChild(a)}),1)}return(0,o.default)(t,[{key:"refresh",value:function(){}},{key:"getElement",value:function(){return this.div}},{key:"setIsVisible",value:function(e){e&&this.refresh()}},{key:"triggerImport",value:function(){this.importButton.click()}}]),t}()})),r.register("4xKQD",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("2oHM2")})),r.register("2umOB",(function(e,n){t(e.exports,"FilterTab",(function(){return u}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("eWjiX"),s=r("hrnUX"),l=r("gWfkn"),c=r("1mH1z"),u=function(){"use strict";function e(t,n,r,a,o,s,l,c,u,h,d){(0,i.default)(this,e),this.klRootEl=t,this.klColorSlider=n,this.layerManager=r,this.klCanvasWorkspace=a,this.handUi=o,this.getCurrentColor=s,this.getKlMaxCanvasSize=l,this.getKlCanvas=c,this.getCurrentLayerCtx=u,this.isEmbed=h,this.statusOverlay=d,this.isInit=!1,this.div=document.createElement("div")}return(0,a.default)(e,[{key:"init",value:function(){var e=function(e,t){var r=document.createElement("button"),a=(0,c.LANG)(t[e].lang.button),u='<img height="20" width="18" src="'+t[e].icon+'" alt="icon" />';r.innerHTML=u+a,r.className="gridButton",o.BB.css(r,{lineHeight:"20px",fontSize:"12px"}),r.tabIndex=-1;var h=(0,c.LANG)(t[e].lang.name);return r.onclick=function(){if("apply"in t[e])if(t[e].isInstant)r.blur(),d(null),n.statusOverlay.out('"'+h+'" '+(0,c.LANG)("filter-applied"),!0);else{var i,a=n.klColorSlider.getSecondaryRGB(),o=t[e].getDialog({context:n.getCurrentLayerCtx(),klCanvas:n.getKlCanvas(),maxWidth:n.getKlMaxCanvasSize(),maxHeight:n.getKlMaxCanvasSize(),currentColorRgb:{r:n.getCurrentColor().r,g:n.getCurrentColor().g,b:n.getCurrentColor().b},secondaryColorRgb:{r:a.r,g:a.g,b:a.b}});if(!o)return;o.errorCallback=function(e){setTimeout((function(){throw alert("Error: could not perform action"),e}),0),i()};var u={};"width"in o&&(u.width=o.width+"px"),s.KL.popup({target:n.klRootEl,message:"<b>"+h+"</b>",div:o.element,style:u,buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(e){!function(e,t){if("Cancel"!=e){var n;try{n=t.getInput()}catch(e){throw-1!==e.message.indexOf(".getInput is not a function")?"filterDialog.getInput is not a function, filter: "+h:e}d(n)}else t.destroy&&t.destroy()}(e,o)},closefunc:function(e){i=e}})}else alert("Application not fully loaded");function d(r){!1===t[e].apply({context:n.getCurrentLayerCtx(),klCanvas:n.getKlCanvas(),history:l.klHistory,input:r})&&alert("Couldn't apply the edit action"),!0===t[e].updatePos&&(n.klCanvasWorkspace.resetView(),n.handUi.update(n.klCanvasWorkspace.getScale(),n.klCanvasWorkspace.getAngleDeg())),n.layerManager.update()}},i[i.length]=r,r},t=function(t,r,i){for(var a in r)!r.hasOwnProperty[a]&&t.includes(a)&&(n.isEmbed&&!r[a].inEmbed||i.appendChild(e(a,r)))},n=this,r=s.KL.filterLib,i=[];if(o.BB.BbLog.emit({type:"init-filters"}),!s.KL.filterLibStatus.isLoaded)throw new Error("filters not loaded");t(["cropExtend","flip","perspective","resize","rotate","transform"],r,n.div),n.div.appendChild(o.BB.el({className:"gridHr"})),t(["brightnessContrast","curves","hueSaturation","invert","tiltShift","toAlpha","blur","unsharpMask"],r,n.div),n.div.appendChild(o.BB.el({className:"gridHr"})),t(["grid","noise"],r,n.div),this.isInit=!0}},{key:"getElement",value:function(){return this.div}},{key:"show",value:function(){this.isInit||this.init(),this.div.style.display="block"}},{key:"hide",value:function(){this.div.style.display="none"}}]),e}()})),r.register("5ENro",(function(n,i){t(n.exports,"imgurUpload",(function(){return g}));var a=r("3kC7t"),o=r("cijLd"),s=r("eWjiX"),l=r("hrnUX"),c=r("j8sUl"),u=r("2wCWz"),h=r("1mH1z");function d(e,t,n,r,i){return p.apply(this,arguments)}function p(){return(p=(0,a.default)(e(o).mark((function t(n,r,i,a,l){var d,p,g,f,m,v,y,x;return e(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return d=(0,u.base64ToBlob)(n.toDataURL("image/"+a)),p=window.open(),g=p.document.createElement("div"),(f=p.document.createElement("img")).src=e(c),g.appendChild(f),s.BB.css(f,{filter:"invert(1)"}),p.document.body.style.backgroundColor="#121211",p.document.body.style.backgroundImage="linear-gradient(#2b2b2b 0%, #121211 50%)",p.document.body.style.backgroundRepeat="no-repeat",(m=p.document.createElement("div")).style.marginTop="10px",g.appendChild(m),m.textContent=(0,h.LANG)("upload-uploading"),p.document.body.appendChild(g),s.BB.css(g,{marginLeft:"auto",marginRight:"auto",marginTop:"100px",fontFamily:"Arial, sans-serif",fontSize:"20px",textAlign:"center",transition:"opacity 0.3s ease-in-out",opacity:"0",color:"#ccc"}),setTimeout((function(){g.style.opacity="1"}),20),t.prev=18,(y=new FormData).append("title",r),y.append("description",i),y.append("image",d),t.next=25,fetch("https://api.imgur.com/3/image",{method:"POST",headers:{Authorization:"Client-ID "+l},body:y});case 25:v=t.sent,t.next=32;break;case 28:throw t.prev=28,t.t0=t.catch(18),p.close(),new Error(t.t0);case 32:if(v.ok){t.next=35;break}throw p.close(),new Error;case 35:return t.next=37,v.json();case 37:return x=t.sent.data,p.location.href=x.link.replace(/\.(jpg|png)/,""),t.abrupt("return",x);case 40:case"end":return t.stop()}}),t,null,[[18,28]])})))).apply(this,arguments)}function g(t,n,r,i){if(!i)throw new Error("imgur key missing");var c=document.createElement("input");c.type="text",c.value=(0,h.LANG)("upload-title-untitled");var u=s.BB.el({tagName:"textarea",custom:{rows:2},css:{width:"100%",maxWidth:"100%"}}),p=document.createElement("div");p.textContent=(0,h.LANG)("upload-name")+":";var g=s.BB.el({content:(0,h.LANG)("upload-caption")+":",css:{marginTop:"10px"}}),f=document.createElement("div");f.innerHTML='<br/><a href="https://imgur.com/tos" target="_blank" rel="noopener noreferrer">'.concat((0,h.LANG)("upload-tos"),"</a> ").concat((0,h.LANG)("upload-tos-2"));var m=new l.KL.RadioList({name:"filetype",init:"jpeg",items:[{label:"JPG",value:"jpeg"},{label:"PNG",value:"png"}],ignoreFocus:!0});s.BB.css(m.getElement(),{marginBottom:"10px"});var v,y=document.createElement("div"),x=document.createElement("div");x.className="info-hint",x.textContent=(0,h.LANG)("upload-link-notice"),y.append(x,m.getElement(),p,c,g,u,f),l.KL.popup({target:n,message:"<b>".concat((0,h.LANG)("upload-title"),"</b>"),type:"upload",div:y,buttons:[(0,h.LANG)("upload-submit"),"Cancel"],clickOnEnter:(0,h.LANG)("upload-submit"),primaries:[(0,h.LANG)("upload-submit")],autoFocus:(0,h.LANG)("upload-submit"),callback:(v=(0,a.default)(e(o).mark((function a(s){var p;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s!==(0,h.LANG)("upload-submit")&&"Yes"!==s&&"Ok"!==s){e.next=12;break}return e.prev=1,e.next=4,d(t.getCompleteCanvas(1),c.value,u.value,m.getValue(),i);case 4:p=e.sent,l.KL.popup({target:n,type:"ok",message:"<h3>".concat((0,h.LANG)("upload-success"),"</h3><br>").concat((0,h.LANG)("upload-delete"),"<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/").concat(p.deletehash,"'>imgur.com/<b>delete</b>/").concat(p.deletehash,"</a><br><br>"),buttons:["Ok"]}),r.reset(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),l.KL.popup({target:n,type:"error",message:(0,h.LANG)("upload-failed"),buttons:["Ok"]});case 12:case"end":return e.stop()}}),a,null,[[1,9]])}))),function(e){return v.apply(this,arguments)})})}})),r.register("j8sUl",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("iGeXe")})),r.register("lkluh",(function(n,i){t(n.exports,"loadAgPsd",(function(){return c}));var a,o=r("3kC7t"),s=r("cijLd"),l=r("eWjiX");function c(){return u.apply(this,arguments)}function u(){return(u=(0,o.default)(e(s).mark((function t(){return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=5;break}return e.next=3,r("bxnoy");case 3:a=e.sent,l.BB.BbLog.emit({type:"loaded-agpsd"});case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),t)})))).apply(this,arguments)}})),r.register("bxnoy",(function(e,t){e.exports=r("ih7W4")(r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("kNYzr")).then((function(){return r("2m2jt")}))})),r.register("5ngYX",(function(e,n){t(e.exports,"SaveReminder",(function(){return u}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("hrnUX"),s=r("eWjiX"),l=r("1mH1z"),c=r("9pcu9"),u=function(){"use strict";function e(t,n,r,a,o,s,l){var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"Klecks";(0,i.default)(this,e),this.history=t,this.showReminder=n,this.changeTitle=r,this.onSaveAsPsd=a,this.isDrawing=o,this.projectStore=s,this.getProject=l,this.title=c,this.lastSavedActionNumber=null}return(0,a.default)(e,[{key:"showPopup",value:function(){var e=this;if(!this.projectStore||!this.getProject)throw new Error("projectStore and getProject need to be set");var t=Math.round((performance.now()-this.lastSavedAt)/1e3/60),n=s.BB.el({});n.append(s.BB.el({content:(0,l.LANG)("save-reminder-text",{a:"<strong>"+t,b:"</strong>"}),css:{marginBottom:"20px"}}));var r=s.BB.el({css:{borderTop:"1px solid #aaa",margin:"0 -20px",padding:"20px"}}),i=s.BB.el({css:{borderTop:"1px solid #aaa",margin:"0 -20px",padding:"20px",paddingBottom:"0"}});n.append(r,i);var a=s.BB.el({tagName:"button",className:"kl-button",content:(0,l.LANG)("save-reminder-save-psd"),onClick:function(){return e.onSaveAsPsd()}});r.append(a,s.BB.el({content:(0,l.LANG)("save-reminder-psd-layers"),css:{marginTop:"10px"}}));var u=new(0,c.BrowserStorageUi)(this.projectStore,this.getProject,this,document.body,{hideClearButton:!0,isFocusable:!0});i.append(u.getElement()),o.KL.popup({target:document.body,message:"<b>".concat((0,l.LANG)("save-reminder-title"),"</b>"),div:n,ignoreBackground:!0,callback:function(){u.destroy(),s.BB.destroyEl(a),e.closeFunc=null,e.lastReminderShownAt=performance.now()},closefunc:function(t){e.closeFunc=t}}),setTimeout((function(){a.focus()}),40)}},{key:"init",value:function(){var e=this,t=function(e){e.preventDefault(),e.returnValue=""};null===this.lastSavedActionNumber&&(this.lastSavedActionNumber=this.history.getActionNumber(),this.lastReminderShownAt=performance.now(),this.lastSavedAt=performance.now(),this.showReminder&&setInterval((function(){if("visible"===document.visibilityState){var t=Math.abs(e.history.getActionNumber()-e.lastSavedActionNumber);0===o.KL.dialogCounter.get()&&!e.isDrawing()&&e.lastReminderShownAt+12e5<performance.now()&&t>=100&&e.showPopup()}}),5e3),this.history.addListener((function(){var n=e.history.getActionNumber();e.lastSavedActionNumber!==n?s.BB.setEventListener(window,"onbeforeunload",t):s.BB.setEventListener(window,"onbeforeunload",null)})),this.changeTitle&&document.addEventListener("visibilitychange",(function(){if("visible"===document.visibilityState)document.title=e.title,clearInterval(e.unsavedInterval);else{var t=e.history.getActionNumber();if(e.lastSavedActionNumber!==t){document.title=(0,l.LANG)("unsaved")+" - "+e.title;var n=0;e.unsavedInterval=setInterval((function(){n=(n+1)%2,document.title=1===n?(0,l.LANG)("unsaved")+" · "+e.title:(0,l.LANG)("unsaved")+" - "+e.title}),18e4)}}})))}},{key:"reset",value:function(){null!==this.lastSavedActionNumber&&(this.lastSavedActionNumber=this.history.getActionNumber(),this.lastReminderShownAt=performance.now(),this.lastSavedAt=performance.now(),s.BB.setEventListener(window,"onbeforeunload",null),this.closeFunc&&this.closeFunc())}}]),e}()})),r.register("eyygR",(function(e,n){t(e.exports,"SaveToComputer",(function(){return c}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("eWjiX"),s=r("hrnUX"),l=r("98ax7"),c=function(){"use strict";function e(t,n,r,a,o){(0,i.default)(this,e),this.saveReminder=t,this.klRootEl=n,this.getExportType=r,this.getKlCanvas=a,this.filenameBase=o}return(0,a.default)(e,[{key:"save",value:function(e){var t=this,n=function(e,t,n){for(var r=e.toDataURL(n).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/),i=atob(r[3]),a=new ArrayBuffer(i.length),o=new Uint8Array(a),s=0;s<o.length;s++)o[s]=i.charCodeAt(s);var c=new Blob([o],{type:r[1]});(0,l.saveAs)(c,t)},r=this;if(r.saveReminder.reset(),e||(e=r.getExportType()),"png"===e){var i="image/png",a=o.BB.getDate()+this.filenameBase+".png",c=r.getKlCanvas().getCompleteCanvas(1);try{n(c,a,i)}catch(e){var u=new Image;u.width=r.getKlCanvas().getWidth(),u.height=r.getKlCanvas().getHeight(),u.src=c.toDataURL(i),s.KL.exportDialog(r.klRootEl,u)}}else if("layers"===e)for(var h=o.BB.getDate()+this.filenameBase,d=r.getKlCanvas().getLayersFast(),p=0;p<d.length;p++){var g=d[p],f=[h,"_",(""+(p+1)).padStart(2,"0"),"_",g.name,".","png"];n(g.canvas,f.join(""),"image/png")}else if("psd"===e){for(var m=r.getKlCanvas().getLayersFast(),v={width:r.getKlCanvas().getWidth(),height:r.getKlCanvas().getHeight(),children:[],canvas:r.getKlCanvas().getCompleteCanvas(1)},y=0;y<m.length;y++){var x=m[y];v.children.push({name:x.name,opacity:x.opacity,canvas:x.canvas,blendMode:s.KL.PSD.blendKlToPsd(x.mixModeStr),left:0,top:0})}s.KL.loadAgPsd().then((function(e){var n=e.writePsdBuffer(v),r=new Blob([n],{type:"application/octet-stream"});(0,l.saveAs)(r,o.BB.getDate()+t.filenameBase+".psd")})).catch((function(){alert("Error: failed to load PSD library")}))}}}]),e}()})),r.register("98ax7",(function(e,t){var r;e.exports,r=function(){"use strict";var t=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){s(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()},r=function(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status},i=function(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}},a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,o=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(e,n,o){var s=a.URL||a.webkitURL,l=document.createElement("a");n=n||e.name||"download",l.download=n,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?i(l):r(l.href)?t(e,n,o):i(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){i(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,n,a){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,a),n);else if(r(e))t(e,n,a);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout((function(){i(o)}))}}:function(e,n,r,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,r);var s="application/octet-stream"===e.type,l=/constructor/i.test(a.HTMLElement)||a.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&l||o)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},u.readAsDataURL(e)}else{var h=a.URL||a.webkitURL,d=h.createObjectURL(e);i?i.location=d:location.href=d,i=null,setTimeout((function(){h.revokeObjectURL(d)}),4e4)}});a.saveAs=s.saveAs=s,e.exports=s},"function"==typeof define&&define.amd?define([],r):r()})),r.register("6rdi0",(function(e,n){t(e.exports,"UndoRedoCatchup",(function(){return l}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("hrnUX"),s=r("gWfkn"),l=function(){"use strict";function e(t,n,r,a,o,s,l,c,u,h){(0,i.default)(this,e),this.brushUiObj=t,this.layerPreview=n,this.layerManager=r,this.handUi=a,this.klCanvasWorkspace=o,this.getInitState=s,this.getKlCanvas=l,this.getCurrentLayerCtx=c,this.setCurrentLayerCtx=u,this.getCurrentBrush=h,this.doIgnore=!1}return(0,a.default)(e,[{key:"ignoreTest",value:function(){var e=this;return!this.doIgnore&&(this.doIgnore=!0,setTimeout((function(){e.doIgnore=!1}),0),!0)}},{key:"undo",value:function(){var e=this;if(!this.ignoreTest())return!1;if(!s.klHistory.canUndo())return!1;var t=s.klHistory.undo();s.klHistory.pause(!0);var n=this.getInitState(),r=this.getKlCanvas().getWidth(),i=this.getKlCanvas().getHeight();this.getKlCanvas().copy(n.canvas);var a=n.focus;this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(a));var l={};for(var c in o.KL.brushes)o.KL.brushes.hasOwnProperty(c)&&(l[c]=new o.KL.brushes[c],l[c].setContext(this.getCurrentLayerCtx()));l.SketchyBrush.setSeed(n.brushes.SketchyBrush.getSeed());for(var u=0;u<t.length;u++)!function(n){if("brush"===t[n].tool[0]){var r=l[t[n].tool[1]];if(t[n].actions)for(var i=0;i<t[n].actions.length;i++){var s=t[n].actions[i].params;r[t[n].actions[i].action].apply(r,s)}else{var c=t[n].params;r[t[n].action].apply(r,c)}}else if("canvas"===t[n].tool[0]){var u=t[n].params,h=e.getKlCanvas()[t[n].action].apply(e.getKlCanvas(),u);if("number"==typeof h)for(var d in a=h,e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(a)),l)l.hasOwnProperty(d)&&l[d].setContext(e.getCurrentLayerCtx())}else if("filter"===t[n].tool[0]){var p=[{context:e.getCurrentLayerCtx(),klCanvas:e.getKlCanvas(),input:t[n].params[0].input,history:new o.KL.DecoyKlHistory}];o.KL.filterLib[t[n].tool[1]][t[n].action].apply(null,p)}else if("misc"===t[n].tool[0]&&"focusLayer"===t[n].action)for(var g in a=t[n].params[0],e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(t[n].params[0])),l)l.hasOwnProperty(g)&&l[g].setContext(e.getCurrentLayerCtx());else if("misc"===t[n].tool[0]&&"importImage"===t[n].action){var f=e.getKlCanvas().addLayer();if("number"==typeof f)for(var m in a=f,t[n].params[1]&&e.getKlCanvas().renameLayer(a,t[n].params[1]),e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(a)),l)l.hasOwnProperty(m)&&l[m].setContext(e.getCurrentLayerCtx());e.getCurrentLayerCtx().drawImage(t[n].params[0],0,0)}}(u);return r===this.getKlCanvas().getWidth()&&i===this.getKlCanvas().getHeight()||(this.klCanvasWorkspace.resetView(),this.handUi.update(this.klCanvasWorkspace.getScale(),this.klCanvasWorkspace.getAngleDeg())),this.layerManager.update(a),this.layerPreview.setLayer(this.getKlCanvas().getLayer(a)),this.brushUiObj.sketchyBrush.setSeed(l.SketchyBrush.getSeed()),this.getCurrentBrush().setContext(this.getCurrentLayerCtx()),this.klCanvasWorkspace.setLastDrawEvent(null),s.klHistory.pause(!1),!0}},{key:"redo",value:function(){var e=this;if(!this.ignoreTest())return!1;if(!s.klHistory.canRedo())return!1;var t=s.klHistory.redo();s.klHistory.pause(!0);var n,r=this.getKlCanvas().getWidth(),i=this.getKlCanvas().getHeight(),a={};for(var l in o.KL.brushes)o.KL.brushes.hasOwnProperty(l)&&(a[l]=new o.KL.brushes[l],a[l].setContext(this.getCurrentLayerCtx()));a.SketchyBrush.setSeed(this.brushUiObj.sketchyBrush.getSeed());for(var c=0;c<t.length;c++)!function(r){if("brush"===t[r].tool[0]){var i=a[t[r].tool[1]];if(t[r].actions)for(var s=0;s<t[r].actions.length;s++){var l=t[r].actions[s].params;i[t[r].actions[s].action].apply(i,l)}else{var c=t[r].params;i[t[r].action].apply(i,c)}}else if("canvas"===t[r].tool[0]){var u=t[r].params,h=e.getKlCanvas()[t[r].action].apply(e.getKlCanvas(),u);if("number"==typeof h)for(var d in n=h,e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(n)),a)a.hasOwnProperty(d)&&a[d].setContext(e.getCurrentLayerCtx())}else if("filter"===t[r].tool[0]){var p=[{context:e.getCurrentLayerCtx(),klCanvas:e.getKlCanvas(),input:t[r].params[0].input,history:new o.KL.DecoyKlHistory}];o.KL.filterLib[t[r].tool[1]][t[r].action].apply(null,p)}else if("misc"===t[r].tool[0]&&"focusLayer"===t[r].action)for(var g in n=t[r].params[0],e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(t[r].params[0])),a)a.hasOwnProperty(g)&&a[g].setContext(e.getCurrentLayerCtx());else if("misc"===t[r].tool[0]&&"importImage"===t[r].action){var f=e.getKlCanvas().addLayer();if("number"==typeof f)for(var m in n=f,t[r].params[1]&&e.getKlCanvas().renameLayer(n,t[r].params[1]),e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(n)),a)a.hasOwnProperty(m)&&a[m].setContext(e.getCurrentLayerCtx());e.getCurrentLayerCtx().drawImage(t[r].params[0],0,0)}}(c);r===this.getKlCanvas().getWidth()&&i===this.getKlCanvas().getHeight()||(this.klCanvasWorkspace.resetView(),this.handUi.update(this.klCanvasWorkspace.getScale(),this.klCanvasWorkspace.getAngleDeg()));var u=this.getKlCanvas().getLayerIndex(this.getCurrentLayerCtx().canvas);return this.layerManager.update(u),this.layerPreview.setLayer(this.getKlCanvas().getLayer(u)),this.brushUiObj.sketchyBrush.setSeed(a.SketchyBrush.getSeed()),this.getCurrentBrush().setContext(this.getCurrentLayerCtx()),this.klCanvasWorkspace.setLastDrawEvent(null),s.klHistory.pause(!1),!0}},{key:"catchup",value:function(e){var t=this;if(e&&e.bufferUpdate){var n=this.getInitState(),r=n.brushes,i=[e.bufferUpdate],a=n.canvas.getLayerContext(n.focus),s=n.canvas,l=n.focus;!function(e){if("brush"===i[0].tool[0]){var n=r[i[0].tool[1]];if(i[0].actions)for(var c=0;c<i[0].actions.length;c++){var u=i[0].actions[c].params;n[i[0].actions[c].action].apply(n,u)}else{var h=i[0].params;n[i[0].action].apply(n,h)}}else if("canvas"===i[0].tool[0]){var d=i[0].params,p=s[i[0].action].apply(s,d);if("number"==typeof p)for(var g in l=p,a=s.getLayerContext(l),r)r.hasOwnProperty(g)&&r[g].setContext(a)}else if("filter"===i[0].tool[0]){var f=[{context:a,klCanvas:s,input:i[0].params[0].input,history:new o.KL.DecoyKlHistory}];o.KL.filterLib[i[0].tool[1]][i[0].action].apply(null,f)}else if("misc"===i[0].tool[0]&&"focusLayer"===i[0].action)for(var m in l=i[0].params[0],a=s.getLayerContext(i[0].params[0]),r)r.hasOwnProperty(m)&&r[m].setContext(a);else if("misc"===i[0].tool[0]&&"importImage"===i[0].action){var v=s.addLayer();if("number"==typeof v)for(var y in l=v,i[0].params[1]&&t.getKlCanvas().renameLayer(l,i[0].params[1]),a=s.getLayerContext(l),r)r.hasOwnProperty(y)&&r[y].setContext(a);a.drawImage(i[0].params[0],0,0)}}(),n.focus=l}}}]),e}()})),r.register("7pyBK",(function(e,n){t(e.exports,"BrushSettingService",(function(){return o}));var i=r("gFgFC"),a=r("kiQ5H"),o=function(){"use strict";function e(t,n,r,a,o,s,l){if((0,i.default)(this,e),this.onSetColor=t,this.onSetSize=n,this.onSetOpacity=r,this.onGetColor=a,this.onGetSize=o,this.onGetOpacity=s,this.onGetSliderConfig=l,this.subscriberArr=[],e.instance)throw new Error("BrushSettingService already instantiated");e.instance=this}return(0,a.default)(e,[{key:"emit",value:function(e,t){for(var n=0;n<this.subscriberArr.length;n++)this.subscriberArr[n]!==t&&this.subscriberArr[n](e)}},{key:"emitColor",value:function(e,t){this.emit({type:"color",value:e},t)}},{key:"emitSize",value:function(e,t){this.emit({type:"size",value:e},t)}},{key:"emitOpacity",value:function(e,t){this.emit({type:"opacity",value:e},t)}},{key:"emitSliderConfig",value:function(e,t){this.emit({type:"sliderConfig",value:e},t)}},{key:"setColor",value:function(e,t){this.onSetColor(e),this.emitColor(e,t)}},{key:"setSize",value:function(e,t){this.onSetSize(e)}},{key:"setOpacity",value:function(e,t){this.onSetOpacity(e)}},{key:"getColor",value:function(){return this.onGetColor()}},{key:"getSize",value:function(){return this.onGetSize()}},{key:"getOpacity",value:function(){return this.onGetOpacity()}},{key:"getSliderConfig",value:function(){return this.onGetSliderConfig()}},{key:"subscribe",value:function(e){this.subscriberArr.includes(e)||this.subscriberArr.push(e)}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.subscriberArr.length;t++)e===this.subscriberArr[t]&&(this.subscriberArr.splice(t,1),t--)}}]),e}()})),r.register("bIgqE",(function(n,i){t(n.exports,"SettingsTab",(function(){return m}));var a=r("gFgFC"),o=r("kiQ5H"),s=r("eWjiX"),l=r("1mH1z"),c=r("hrnUX"),u=r("fgfvl"),h=r("ekHRj"),d=r("6qSiv"),p=r("8oUiM"),g=r("7OLuX"),f=r("6l0gQ"),m=function(){"use strict";function t(n,i){(0,a.default)(this,t);var o=function(){return s.BB.el({tagName:"a",content:(0,l.LANG)("licenses"),onClick:function(){r("eSypg").then((function(e){new(0,h.Popup)({title:s.BB.el({content:(0,l.LANG)("licenses")}),content:s.BB.el({content:s.BB.el({content:e.licenses.replace(/\n/g,"<br>"),css:{padding:"20px"}}),css:{height:"100%",overflowY:"scroll"}}),width:800,isMaxHeight:!0})}))}})},m=l.languageStrings.getLanguage();this.el=s.BB.el({content:"\n".concat((0,l.LANG)("settings-language"),": ").concat(m.name," (").concat(m.code,")\n            "),css:{margin:"10px"}});var v=s.BB.el({content:(0,l.LANG)("settings-preferred-language")+":<br>",css:{marginTop:"10px"}}),y=[["auto",(0,l.LANG)("auto")]].concat(u.languages.map((function(e){return[e.code,e.name+" (".concat(e.code,")")]}))),x=new c.KL.Select({initValue:f.LocalStorage.getItem(l.LS_LANGUAGE_KEY)?f.LocalStorage.getItem(l.LS_LANGUAGE_KEY):"auto",optionArr:y,onChange:function(e){"auto"===e?f.LocalStorage.removeItem(l.LS_LANGUAGE_KEY):f.LocalStorage.setItem(l.LS_LANGUAGE_KEY,e),b.style.display="block"}}),b=s.BB.el({content:(0,l.LANG)("settings-language-reload"),css:{display:"none",marginTop:"5px"}});(v.append(x.getElement(),b),this.el.append(v),s.BB.el({tagName:"button",parent:this.el,content:'<img height="20" width="18" src="'+e(g)+'" alt="icon" style="margin-right: 5px"/>'+(0,l.LANG)("switch-ui-left-right"),onClick:function(){return n()},css:{marginTop:"20px"},custom:{tabIndex:"-1"}}),this.el.append(s.BB.el({className:"gridHr",css:{margin:"10px 0"}})),i)?(this.el.append(i),i.innerHTML||s.BB.el({parent:i,css:{textAlign:"center"}}).append(s.BB.el({content:'<img alt="icon" height="20" style="vertical-align:middle" src="'.concat(e(d),'"> <a href="https://bitbof.com" target="_blank" tabIndex="-1">bitbof</a> © 2022<br>')}),o())):s.BB.el({parent:this.el,css:{textAlign:"center"},content:'\n<img alt="Klecks" height="25" src="'.concat(e(p),'"><br>\n<img alt="icon" height="20" style="vertical-align:middle" src="').concat(e(d),'"> <a href="https://bitbof.com" target="_blank" tabIndex="-1">bitbof</a> © 2022<br>')}).append(o(),document.createTextNode(" | "),s.BB.el({tagName:"a",content:(0,l.LANG)("donate"),custom:{href:"https://kleki.com/donate/",target:"_blank"}}),document.createTextNode(" | "),s.BB.el({tagName:"a",content:(0,l.LANG)("source-code"),custom:{href:"https://klecks.org",target:"_blank"}}));window.addEventListener("storage",(function(e){e.key===l.LS_LANGUAGE_KEY&&x.setValue(f.LocalStorage.getItem(l.LS_LANGUAGE_KEY)?f.LocalStorage.getItem(l.LS_LANGUAGE_KEY):"auto")}))}return(0,o.default)(t,[{key:"getElement",value:function(){return this.el}}]),t}()})),r.register("6qSiv",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("kSWIa")})),r.register("7OLuX",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("4FMUg")})),r.register("eSypg",(function(e,t){e.exports=r("ih7W4")(r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("79hnx")).then((function(){return r("jNQF2")}))})),r.register("iVHpg",(function(e,n){t(e.exports,"ToolspaceScroller",(function(){return c}));var i=r("gFgFC"),a=r("kiQ5H"),o=r("eWjiX"),s=r("1mH1z"),l=r("i8UFO"),c=function(){"use strict";function e(t){var n=this;(0,i.default)(this,e),this.toolspace=t.toolspace,this.upBtn=o.BB.el({parent:this.toolspace,title:(0,s.LANG)("scroll"),className:"kl-scroller",css:{top:"0",transform:"rotate(180deg)"}}),this.downBtn=o.BB.el({parent:this.toolspace,title:(0,s.LANG)("scroll"),className:"kl-scroller",css:{bottom:"0"}}),this.updateUiState(t.uiState);new o.BB.PointerListener({target:this.upBtn,onPointer:function(e){"pointerdown"===e.type&&(n.upInterval=setInterval((function(){n.toolspace.scrollBy(0,-13),n.update()}),20)),"pointerup"===e.type&&(clearInterval(n.upInterval),setTimeout((function(){n.upInterval=null,n.update()}),50))}}),new o.BB.PointerListener({target:this.downBtn,onPointer:function(e){"pointerdown"===e.type&&(n.downInterval=setInterval((function(){n.toolspace.scrollBy(0,13),n.update()}),20)),"pointerup"===e.type&&(clearInterval(n.downInterval),setTimeout((function(){n.downInterval=null,n.update()}),50))}});var r=function(e){n.toolspace.scrollBy(0,Math.round(.7*e.deltaY)),n.update()};this.upBtn.addEventListener("wheel",r),this.downBtn.addEventListener("wheel",r),this.update(),new MutationObserver((function(){return n.update()})).observe(this.toolspace,{attributes:!0,childList:!0,subtree:!0}),window.addEventListener("resize",(function(){return n.update()})),l.dialogCounter.subscribe((function(e){n.upBtn.style.opacity=e>=1?"0":"",n.downBtn.style.opacity=e>=1?"0":""}))}return(0,a.default)(e,[{key:"update",value:function(){this.toolspace.scrollHeight>this.toolspace.offsetHeight+3?(this.upInterval||(this.upBtn.style.display=0===this.toolspace.scrollTop?"none":"block"),this.downInterval||(this.downBtn.style.display=this.toolspace.scrollTop+this.toolspace.offsetHeight+1>=this.toolspace.scrollHeight?"none":"block")):(this.upBtn.style.display="none",this.downBtn.style.display="none")}},{key:"updateUiState",value:function(e){o.BB.css(this.upBtn,{left:"left"===e?"0":null,right:"right"===e?"0":null}),o.BB.css(this.downBtn,{left:"left"===e?"0":null,right:"right"===e?"0":null})}}]),e}()})),r.register("85H3x",(function(n,i){t(n.exports,"ToolspaceTopRow",(function(){return h}));var a=r("gFgFC"),o=r("kiQ5H"),s=r("eWjiX"),l=r("7OLuX"),c=r("kS5uZ"),u=r("1mH1z"),h=function(){"use strict";function t(n){(0,a.default)(this,t);var r=function(e){var t=6+(e.extraPadding?e.extraPadding:0),n=s.BB.el({className:"toolspace-row-button nohighlight",title:e.title,onClick:e.onClick,css:{padding:e.content?"":e.contain?t+"px 0":""}});if(e.content)n.appendChild(e.content);else{var r=s.BB.el({css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%"}});r.style.pointerEvents="none",n.appendChild(r)}return n.pointerListener=new s.BB.PointerListener({target:n,onEnterLeave:function(e){n.classList.toggle("toolspace-row-button-hover",e)}}),n},i=document.createElement("div");this.el=i,s.BB.css(i,{height:"36px",display:"flex",backgroundImage:"linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)"});var o=r({onClick:n.onSubmit,title:(0,u.LANG)("submit-title"),content:s.BB.el({content:(0,u.LANG)("submit"),className:"toolspace-row-button__submit",css:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%"}}),contain:!0});o.style.width="45px";var h=r({onClick:n.onHelp,title:(0,u.LANG)("help"),image:e(c),contain:!0}),d=r({onClick:n.onLeftRight,title:(0,u.LANG)("switch-ui-left-right"),image:e(l),contain:!0});i.appendChild(o),i.appendChild(d),i.appendChild(h)}return(0,o.default)(t,[{key:"getElement",value:function(){return this.el}}]),t}()})),r.register("iUR3L",(function(e,n){t(e.exports,"importFilters",(function(){return w}));var i=r("kyVjY"),a=r("iiVKq"),o=r("lorQQ"),s=r("8Ri8I"),l=r("fADXF"),c=r("bIns5"),u=r("30jcG"),h=r("cCks8"),d=r("huXOx"),p=r("dsRff"),g=r("lhchB"),f=r("lXpcU"),m=r("1CjeM"),v=r("dNWKZ"),y=r("94Tq7"),x=r("d8Fqy"),b=r("gtdB1");function B(e,t){t.getDialog&&(e.getDialog=t.getDialog),e.apply=t.apply}function w(e){i.filterLibStatus.isLoaded||(e,B(i.filterLib.brightnessContrast,a.filterBrightnessContrast),B(i.filterLib.cropExtend,o.filterCropExtend),B(i.filterLib.curves,s.filterCurves),B(i.filterLib.flip,l.filterFlip),B(i.filterLib.hueSaturation,c.filterHueSaturation),B(i.filterLib.invert,u.filterInvert),B(i.filterLib.perspective,h.filterPerspective),B(i.filterLib.resize,d.filterResize),B(i.filterLib.rotate,p.filterRotate),B(i.filterLib.tiltShift,g.filterTiltShift),B(i.filterLib.transform,f.filterTransform),B(i.filterLib.blur,m.filterBlur),B(i.filterLib.unsharpMask,v.filterUnsharpMask),B(i.filterLib.toAlpha,y.filterToAlpha),B(i.filterLib.grid,x.filterGrid),B(i.filterLib.noise,b.filterNoise),i.filterLibStatus.isLoaded=!0)}})),r.register("iiVKq",(function(e,n){t(e.exports,"filterBrightnessContrast",(function(){return u}));var i=r("eWjiX"),a=r("llzZ0"),o=r("cH2YE"),s=r("i5nyl"),l=r("5RaQo"),c=r("1mH1z"),u={getDialog:function(e){var t=document.createElement("div"),n={element:t},r=e.context,u=e.klCanvas;if(!r||!u)return!1;var h=u.getLayers(),d=u.getLayerIndex(r.canvas),p=i.BB.fitInto(r.canvas.width,r.canvas.height,280,200,1),g=parseInt(""+p.width),f=parseInt(""+p.height),m=i.BB.canvas(g,f),v=m.getContext("2d");return v.save(),m.width>r.canvas.width&&(v.imageSmoothingEnabled=!1),v.drawImage(r.canvas,0,0,g,f),v.restore(),setTimeout((function(){var e=0,r=0;t.innerHTML=(0,c.LANG)("filter-bright-contrast-description")+"<br/><br/>";var u=(0,l.getSharedFx)();if(u){var p=u.texture(m);u.draw(p).update();var v=new(0,a.KlSlider)({label:(0,c.LANG)("filter-bright-contrast-brightness"),width:300,height:30,min:0,max:100,value:50*(e+1),eventResMs:o.eventResMs,onChange:function(t){e=t/50-1,u.draw(p).brightnessContrast(e,r).update(),w.render()}}),y=new(0,a.KlSlider)({label:(0,c.LANG)("filter-bright-contrast-contrast"),width:300,height:30,min:0,max:100,value:50*(r+1),eventResMs:o.eventResMs,onChange:function(t){r=t/50-1,u.draw(p).brightnessContrast(e,r).update(),w.render()}});v.getElement().style.marginBottom="10px",t.appendChild(v.getElement()),t.appendChild(y.getElement());var x=document.createElement("div");i.BB.css(x,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var b=[],B=0;B<h.length;B++)b.push({image:B===d?u:h[B].context.canvas,opacity:h[B].opacity,mixModeStr:h[B].mixModeStr});var w=new(0,s.KlCanvasPreview)({width:parseInt(""+g),height:parseInt(""+f),layers:b}),C=i.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+g)+"px",height:parseInt(""+f)+"px"}});C.appendChild(w.getElement()),x.appendChild(C),t.appendChild(x);try{u.draw(p).brightnessContrast(e,r).update(),w.render()}catch(e){t.errorCallback(e)}n.destroy=function(){v.destroy(),y.destroy(),p.destroy()},n.getInput=function(){return n.destroy(),{brightness:e,contrast:r}}}}),1),n},apply:function(e){var t=e.context,n=e.input.brightness,r=e.input.contrast,i=e.history;if(!t||null===n||null===r||!i)return!1;i.pause(!0);var a=(0,l.getSharedFx)();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).brightnessContrast(n,r).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),i.pause(!1),i.push({tool:["filter","brightnessContrast"],action:"apply",params:[{input:e.input}]}),!0}}})),r.register("cH2YE",(function(e,n){t(e.exports,"eventResMs",(function(){return r}));var r=60})),r.register("5RaQo",(function(e,n){t(e.exports,"getSharedFx",(function(){return o}));var i=r("TEtAx"),a=null;try{a=i.fx.canvas()}catch(e){}function o(){if(!a||a._.gl.isContextLost())try{a=i.fx.canvas()}catch(e){}return a}})),r.register("TEtAx",(function(n,i){t(n.exports,"fx",(function(){return o}));var a=r("dVkJn"),o=function(){var t,n=function(e,t,n){return Math.max(e,Math.min(t,n))},r=function(e){return{_:e,loadContentsOf:function(e){t=this._.gl,this._.loadContentsOf(e)},destroy:function(){t=this._.gl,this._.destroy()}}},i=function(e){return r(V.fromElement(e))},o=function(e,n){var r=t.UNSIGNED_BYTE;if(t.getExtension("OES_texture_float")&&t.getExtension("OES_texture_float_linear")){var i=new V(100,100,t.RGBA,t.FLOAT);try{i.drawTo((function(){r=t.FLOAT}))}catch(e){}i.destroy()}this._.texture&&this._.texture.destroy(),this._.spareTexture&&this._.spareTexture.destroy(),this.width=e,this.height=n,this._.texture=new V(e,n,t.RGBA,r),this._.spareTexture=new V(e,n,t.RGBA,r),this._.extraTexture=this._.extraTexture||new V(0,0,t.RGBA,r),this._.flippedShader=this._.flippedShader||new K(null,"        uniform sampler2D texture;        varying vec2 texCoord;        void main() {            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));        }    ","flippedShader"),this._.isInitialized=!0},s=function(e,t,n){return this._.isInitialized&&e._.width==this.width&&e._.height==this.height||o.call(this,t||e._.width,n||e._.height),e._.use(),this._.texture.drawTo((function(){K.getDefaultShader().drawRect()})),this},l=function(){return this._.texture.use(),this._.flippedShader.drawRect(),this},c=function(e,t,n,r){(n||this._.texture).use(),this._.spareTexture.drawTo((function(){e.uniforms(t).drawRect()})),this._.spareTexture.swapWith(r||this._.texture)},u=function(e){return e.parentNode.insertBefore(this,e),e.parentNode.removeChild(e),this},h=function(){var e=new V(this._.texture.width,this._.texture.height,t.RGBA,t.UNSIGNED_BYTE);return this._.texture.use(),e.drawTo((function(){K.getDefaultShader().drawRect()})),r(e)},d=function(){var e=this._.texture.width,n=this._.texture.height,r=new Uint8Array(e*n*4);return this._.texture.drawTo((function(){t.readPixels(0,0,e,n,t.RGBA,t.UNSIGNED_BYTE,r)})),r},p=function(e){return function(){return t=this._.gl,e.apply(this,arguments)}},g=function(e,t,n,r,i,a,o,s){var l=n-i,c=r-a,u=o-i,h=s-a,d=e-n+i-o,p=t-r+a-s,g=l*h-u*c,f=(d*h-u*p)/g,m=(l*p-d*c)/g;return[n-e+f*n,r-t+f*r,f,o-e+m*o,s-t+m*s,m,e,t,1]},f=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=t*a*c-t*o*l-n*i*c+n*o*s+r*i*l-r*a*s;return[(a*c-o*l)/u,(r*l-n*c)/u,(n*o-r*a)/u,(o*s-i*c)/u,(t*c-r*s)/u,(r*i-t*o)/u,(i*l-a*s)/u,(n*s-t*l)/u,(t*a-n*i)/u]},m=function(e){var t=e.length;this.xa=[],this.ya=[],this.u=[],this.y2=[],e.sort((function(e,t){return e[0]-t[0]}));for(var n=0;n<t;n++)this.xa.push(e[n][0]),this.ya.push(e[n][1]);this.u[0]=0,this.y2[0]=0;for(n=1;n<t-1;++n){var r=this.xa[n+1]-this.xa[n-1],i=(this.xa[n]-this.xa[n-1])/r,a=i*this.y2[n-1]+2;this.y2[n]=(i-1)/a;var o=(this.ya[n+1]-this.ya[n])/(this.xa[n+1]-this.xa[n])-(this.ya[n]-this.ya[n-1])/(this.xa[n]-this.xa[n-1]);this.u[n]=(6*o/r-i*this.u[n-1])/a}this.y2[t-1]=0;for(n=t-2;n>=0;--n)this.y2[n]=this.y2[n]*this.y2[n+1]+this.u[n]},v=function(e,t){return new K(null,e+"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;    void main() {        vec2 coord = texCoord * texSize;        "+t+"        gl_FragColor = texture2D(texture, coord / texSize);        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);        if (coord != clampedCoord) {            /* fade to transparent if we are outside the image */            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));        }    }","warp")},y=function(e,r){return t.brightnessContrast=t.brightnessContrast||new K(null,"        uniform sampler2D texture;        uniform float brightness;        uniform float contrast;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.rgb += brightness;            if (contrast > 0.0) {                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;            } else {                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;            }            gl_FragColor = color;        }    ","brightnessContrast"),c.call(this,t.brightnessContrast,{brightness:n(-1,e,1),contrast:n(-1,r,1)}),this},x=function(e){for(var t=new m(e),r=[],i=0;i<256;i++)r.push(n(0,Math.floor(256*t.interpolate(i/255)),255));return r},b=function(e,n,r){e=x(e),1==arguments.length?n=r=e:(n=x(n),r=x(r));for(var i=[],a=0;a<256;a++)i.splice(i.length,0,e[a],n[a],r[a],255);return this._.extraTexture.initFromBytes(256,1,i),this._.extraTexture.use(1),t.curves=t.curves||new K(null,"        uniform sampler2D texture;        uniform sampler2D map;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.r = texture2D(map, vec2(color.r)).r;            color.g = texture2D(map, vec2(color.g)).g;            color.b = texture2D(map, vec2(color.b)).b;            gl_FragColor = color;        }    ","curves"),t.curves.textures({map:1}),c.call(this,t.curves,{}),this},B=function(e){t.denoise=t.denoise||new K(null,"        uniform sampler2D texture;        uniform float exponent;        uniform float strength;        uniform vec2 texSize;        varying vec2 texCoord;        void main() {            vec4 center = texture2D(texture, texCoord);            vec4 color = vec4(0.0);            float total = 0.0;            for (float x = -4.0; x <= 4.0; x += 1.0) {                for (float y = -4.0; y <= 4.0; y += 1.0) {                    vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);                    float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));                    weight = pow(weight, exponent);                    color += sample * weight;                    total += weight;                }            }            gl_FragColor = color / total;        }    ","denoise");for(var n=0;n<2;n++)c.call(this,t.denoise,{exponent:Math.max(0,e),texSize:[this.width,this.height]});return this},w=function(e,r){return t.hueSaturation=t.hueSaturation||new K(null,"        uniform sampler2D texture;        uniform float hue;        uniform float saturation;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);                        /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */            float angle = hue * 3.14159265;            float s = sin(angle), c = cos(angle);            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;            float len = length(color.rgb);            color.rgb = vec3(                dot(color.rgb, weights.xyz),                dot(color.rgb, weights.zxy),                dot(color.rgb, weights.yzx)            );                        /* saturation adjustment */            float average = (color.r + color.g + color.b) / 3.0;            if (saturation > 0.0) {                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));            } else {                color.rgb += (average - color.rgb) * (-saturation);            }                        gl_FragColor = color;        }    ","hueSaturation"),c.call(this,t.hueSaturation,{hue:n(-1,e,1),saturation:n(-1,r,1)}),this},C=function(n,r,i,o,s,l,u,h,d,p,g,f,m){return t.noise=t.noise||new K(null,e(a).replace(/#define.*/,""),"noise"),c.call(this,t.noise,{seed:n,type:r,scale:[i[0],i[1]],offset:o,octaves:s,samples:l,texSize:[this.width,this.height],peaks:u,brightness:h,contrast:d,doInvert:p?1:0,colA:g?[g.r/255,g.g/255,g.b/255]:[0,0,0],colB:f?[f.r/255,f.g/255,f.b/255]:[1,1,1],channels:"rgb"===m?0:1}),this},S=function(e){return t.sepia=t.sepia||new K(null,"        uniform sampler2D texture;        uniform float amount;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            float r = color.r;            float g = color.g;            float b = color.b;                        color.r = min(1.0, (r * (1.0 - (0.607 * amount))) + (g * (0.769 * amount)) + (b * (0.189 * amount)));            color.g = min(1.0, (r * 0.349 * amount) + (g * (1.0 - (0.314 * amount))) + (b * 0.168 * amount));            color.b = min(1.0, (r * 0.272 * amount) + (g * 0.534 * amount) + (b * (1.0 - (0.869 * amount))));                        gl_FragColor = color;        }    ","sepia"),c.call(this,t.sepia,{amount:n(0,e,1)}),this},k=function(e,n){return t.unsharpMask=t.unsharpMask||new K(null,"        uniform sampler2D blurredTexture;        uniform sampler2D originalTexture;        uniform float strength;        uniform float threshold;        varying vec2 texCoord;        void main() {            vec4 blurred = texture2D(blurredTexture, texCoord);            vec4 original = texture2D(originalTexture, texCoord);            gl_FragColor = mix(blurred, original, 1.0 + strength);        }    ","unsharpMask"),this._.extraTexture.ensureFormat(this._.texture),this._.texture.use(),this._.extraTexture.drawTo((function(){K.getDefaultShader().drawRect()})),this._.extraTexture.use(1),this.triangleBlur(e),t.unsharpMask.textures({originalTexture:1}),c.call(this,t.unsharpMask,{strength:n}),this._.extraTexture.unuse(1),this},L=function(e){return t.vibrance=t.vibrance||new K(null,"        uniform sampler2D texture;        uniform float amount;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            float average = (color.r + color.g + color.b) / 3.0;            float mx = max(color.r, max(color.g, color.b));            float amt = (mx - average) * (-amount * 3.0);            color.rgb = mix(color.rgb, vec3(mx), amt);            gl_FragColor = color;        }    ","vibrance"),c.call(this,t.vibrance,{amount:n(-1,e,1)}),this},T=function(e,r){return t.vignette=t.vignette||new K(null,"        uniform sampler2D texture;        uniform float size;        uniform float amount;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);                        float dist = distance(texCoord, vec2(0.5, 0.5));            color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount + size));                        gl_FragColor = color;        }    ","vignette"),c.call(this,t.vignette,{size:n(0,e,1),amount:n(0,r,1)}),this},E=function(e,r,i){t.lensBlurPrePass=t.lensBlurPrePass||new K(null,"        uniform sampler2D texture;        uniform float power;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color = pow(color, vec4(power));            gl_FragColor = vec4(color);        }    ","lensBlurPrePass");var a="        uniform sampler2D texture0;        uniform sampler2D texture1;        uniform vec2 delta0;        uniform vec2 delta1;        uniform float power;        varying vec2 texCoord;        "+W+"        vec4 sample(vec2 delta) {            /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(delta, 151.7182), 0.0);                        vec4 color = vec4(0.0);            float total = 0.0;            for (float t = 0.0; t <= 30.0; t++) {                float percent = (t + offset) / 30.0;                color += texture2D(texture0, texCoord + delta * percent);                total += 1.0;            }            return color / total;        }    ";t.lensBlur0=t.lensBlur0||new K(null,a+"        void main() {            gl_FragColor = sample(delta0);        }    ","lensBlur0"),t.lensBlur1=t.lensBlur1||new K(null,a+"        void main() {            gl_FragColor = (sample(delta0) + sample(delta1)) * 0.5;        }    ","lensBlur1"),t.lensBlur2=t.lensBlur2||new K(null,a+"        void main() {            vec4 color = (sample(delta0) + 2.0 * texture2D(texture1, texCoord)) / 3.0;            gl_FragColor = pow(color, vec4(power));        }    ","lensBlur2").textures({texture1:1});for(var o=[],s=0;s<3;s++){var l=i+s*Math.PI*2/3;o.push([e*Math.sin(l)/this.width,e*Math.cos(l)/this.height])}var u=Math.pow(10,n(-1,r,1));return c.call(this,t.lensBlurPrePass,{power:u}),this._.extraTexture.ensureFormat(this._.texture),c.call(this,t.lensBlur0,{delta0:o[0]},this._.texture,this._.extraTexture),c.call(this,t.lensBlur1,{delta0:o[1],delta1:o[2]},this._.extraTexture,this._.extraTexture),c.call(this,t.lensBlur0,{delta0:o[1]}),this._.extraTexture.use(1),c.call(this,t.lensBlur2,{power:1/u,delta0:o[2]}),this},M=function(e,n,r,i,a,o){t.tiltShift=t.tiltShift||new K(null,"        uniform sampler2D texture;        uniform float blurRadius;        uniform float gradientRadius;        uniform vec2 start;        uniform vec2 end;        uniform vec2 delta;        uniform vec2 texSize;        varying vec2 texCoord;        "+W+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;            for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    ","tiltShift");var s=r-e,l=i-n,u=Math.sqrt(s*s+l*l);return c.call(this,t.tiltShift,{blurRadius:a,gradientRadius:o,start:[e,n],end:[r,i],delta:[s/u,l/u],texSize:[this.width,this.height]}),c.call(this,t.tiltShift,{blurRadius:a,gradientRadius:o,start:[e,n],end:[r,i],delta:[-l/u,s/u],texSize:[this.width,this.height]}),this},I=function(e){return t.triangleBlur=t.triangleBlur||new K(null,"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        "+W+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta * percent);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    ","triangleBlur"),c.call(this,t.triangleBlur,{delta:[e/this.width,0]}),c.call(this,t.triangleBlur,{delta:[0,e/this.height]}),this},A=function(e,n,r){return t.zoomBlur=t.zoomBlur||new K(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float strength;        uniform vec2 texSize;        varying vec2 texCoord;        "+W+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;            vec2 toCenter = center - texCoord * texSize;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = 0.0; t <= 40.0; t++) {                float percent = (t + offset) / 40.0;                float weight = 4.0 * (percent - percent * percent);                vec4 sample = texture2D(texture, texCoord + toCenter * percent * strength / texSize);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    ","zoomBlur"),c.call(this,t.zoomBlur,{center:[e,n],strength:r,texSize:[this.width,this.height]}),this},R=function(e,n,r,i){return t.colorHalftone=t.colorHalftone||new K(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float angle;        uniform float scale;        uniform vec2 texSize;        varying vec2 texCoord;                float pattern(float angle) {            float s = sin(angle), c = cos(angle);            vec2 tex = texCoord * texSize - center;            vec2 point = vec2(                c * tex.x - s * tex.y,                s * tex.x + c * tex.y            ) * scale;            return (sin(point.x) * sin(point.y)) * 4.0;        }                void main() {            vec4 color = texture2D(texture, texCoord);            vec3 cmy = 1.0 - color.rgb;            float k = min(cmy.x, min(cmy.y, cmy.z));            cmy = (cmy - k) / (1.0 - k);            cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(angle + 0.26179), pattern(angle + 1.30899), pattern(angle)), 0.0, 1.0);            k = clamp(k * 10.0 - 5.0 + pattern(angle + 0.78539), 0.0, 1.0);            gl_FragColor = vec4(1.0 - cmy - k, color.a);        }    ","colorHalftone"),c.call(this,t.colorHalftone,{center:[e,n],angle:r,scale:Math.PI/i,texSize:[this.width,this.height]}),this},P=function(e,n,r,i){return t.dotScreen=t.dotScreen||new K(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float angle;        uniform float scale;        uniform vec2 texSize;        varying vec2 texCoord;                float pattern() {            float s = sin(angle), c = cos(angle);            vec2 tex = texCoord * texSize - center;            vec2 point = vec2(                c * tex.x - s * tex.y,                s * tex.x + c * tex.y            ) * scale;            return (sin(point.x) * sin(point.y)) * 4.0;        }                void main() {            vec4 color = texture2D(texture, texCoord);            float average = (color.r + color.g + color.b) / 3.0;            gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);        }    ","dotScreen"),c.call(this,t.dotScreen,{center:[e,n],angle:r,scale:Math.PI/i,texSize:[this.width,this.height]}),this},O=function(e){return t.edgeWork1=t.edgeWork1||new K(null,"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        "+W+"        void main() {            vec2 color = vec2(0.0);            vec2 total = vec2(0.0);                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec3 sample = texture2D(texture, texCoord + delta * percent).rgb;                float average = (sample.r + sample.g + sample.b) / 3.0;                color.x += average * weight;                total.x += weight;                if (abs(t) < 15.0) {                    weight = weight * 2.0 - 1.0;                    color.y += average * weight;                    total.y += weight;                }            }            gl_FragColor = vec4(color / total, 0.0, 1.0);        }    ","edgeWork1"),t.edgeWork2=t.edgeWork2||new K(null,"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        "+W+"        void main() {            vec2 color = vec2(0.0);            vec2 total = vec2(0.0);                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec2 sample = texture2D(texture, texCoord + delta * percent).xy;                color.x += sample.x * weight;                total.x += weight;                if (abs(t) < 15.0) {                    weight = weight * 2.0 - 1.0;                    color.y += sample.y * weight;                    total.y += weight;                }            }            float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);            gl_FragColor = vec4(c, c, c, 1.0);        }    ","edgeWork2"),c.call(this,t.edgeWork1,{delta:[e/this.width,0]}),c.call(this,t.edgeWork2,{delta:[0,e/this.height]}),this},D=function(e,n,r){return t.hexagonalPixelate=t.hexagonalPixelate||new K(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float scale;        uniform vec2 texSize;        varying vec2 texCoord;        void main() {            vec2 tex = (texCoord * texSize - center) / scale;            tex.y /= 0.866025404;            tex.x -= tex.y * 0.5;                        vec2 a;            if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) a = vec2(floor(tex.x), floor(tex.y));            else a = vec2(ceil(tex.x), ceil(tex.y));            vec2 b = vec2(ceil(tex.x), floor(tex.y));            vec2 c = vec2(floor(tex.x), ceil(tex.y));                        vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);            vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);            vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);            vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);                        float alen = length(TEX - A);            float blen = length(TEX - B);            float clen = length(TEX - C);                        vec2 choice;            if (alen < blen) {                if (alen < clen) choice = a;                else choice = c;            } else {                if (blen < clen) choice = b;                else choice = c;            }                        choice.x += choice.y * 0.5;            choice.y *= 0.866025404;            choice *= scale / texSize;            gl_FragColor = texture2D(texture, choice + center / texSize);        }    ","hexagonalPixelate"),c.call(this,t.hexagonalPixelate,{center:[e,n],scale:r,texSize:[this.width,this.height]}),this},N=function(e){return t.ink=t.ink||new K(null,"        uniform sampler2D texture;        uniform float strength;        uniform vec2 texSize;        varying vec2 texCoord;        void main() {            vec2 dx = vec2(1.0 / texSize.x, 0.0);            vec2 dy = vec2(0.0, 1.0 / texSize.y);            vec4 color = texture2D(texture, texCoord);            float bigTotal = 0.0;            float smallTotal = 0.0;            vec3 bigAverage = vec3(0.0);            vec3 smallAverage = vec3(0.0);            for (float x = -2.0; x <= 2.0; x += 1.0) {                for (float y = -2.0; y <= 2.0; y += 1.0) {                    vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;                    bigAverage += sample;                    bigTotal += 1.0;                    if (abs(x) + abs(y) < 2.0) {                        smallAverage += sample;                        smallTotal += 1.0;                    }                }            }            vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);            gl_FragColor = vec4(color.rgb - dot(edge, edge) * strength * 100000.0, color.a);        }    ","ink"),c.call(this,t.ink,{strength:e*e*e*e*e,texSize:[this.width,this.height]}),this},z=function(e,r,i,a){return t.bulgePinch=t.bulgePinch||v("        uniform float radius;        uniform float strength;        uniform vec2 center;    ","        coord -= center;        float distance = length(coord);        if (distance < radius) {            float percent = distance / radius;            if (strength > 0.0) {                coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);            } else {                coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);            }        }        coord += center;    "),c.call(this,t.bulgePinch,{radius:i,strength:n(-1,a,1),center:[e,r],texSize:[this.width,this.height]}),this},G=function(e,n,r){if(t.matrixWarp=t.matrixWarp||v("        uniform mat3 matrix;        uniform bool useTextureSpace;    ","        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;        vec3 warp = matrix * vec3(coord, 1.0);        coord = warp.xy / warp.z;        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;    "),4==(e=Array.prototype.concat.apply([],e)).length)e=[e[0],e[1],0,e[2],e[3],0,0,0,1];else if(9!=e.length)throw"can only warp with 2x2 or 3x3 matrix";return c.call(this,t.matrixWarp,{matrix:n?f(e):e,texSize:[this.width,this.height],useTextureSpace:0|r}),this},j=function(e,t){var n=g.apply(null,t),r=g.apply(null,e),i=function(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}(f(n),r);return this.matrixWarp(i)},H=function(e,n,r,i){return t.swirl=t.swirl||v("        uniform float radius;        uniform float angle;        uniform vec2 center;    ","        coord -= center;        float distance = length(coord);        if (distance < radius) {            float percent = (radius - distance) / radius;            float theta = percent * percent * angle;            float s = sin(theta);            float c = cos(theta);            coord = vec2(                coord.x * c - coord.y * s,                coord.x * s + coord.y * c            );        }        coord += center;    "),c.call(this,t.swirl,{radius:r,center:[e,n],angle:i,texSize:[this.width,this.height]}),this},X=function(){return t.invert=t.invert||new K(null,"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        gl_FragColor = vec4(1.0 - color.r, 1.0 - color.g, 1.0 - color.b, color.a);    }","invert"),c.call(this,t.invert,{texSize:[this.width,this.height]}),this},F=function(e,n){return t.toAlpha=t.toAlpha||new K(null,"    uniform bool isInverted;    uniform vec4 replace;    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        float alpha = (color.r + color.g + color.b) / 3.0;        if (isInverted) alpha = 1.0 - alpha;        alpha = min(color.a, alpha);        if (replace.a > 0.0) color = replace;        gl_FragColor = vec4(color.r, color.g, color.b, alpha);    }","toAlpha"),c.call(this,t.toAlpha,{isInverted:e?1:0,replace:n?[n.r/255,n.g/255,n.b/255,n.a]:[0,0,0,0],texSize:[this.width,this.height]}),this},U={};!function(){var e,n,r=function(){};try{document.createElement("canvas").getContext("experimental-webgl")}catch(e){}t&&-1===t.getSupportedExtensions().indexOf("OES_texture_float_linear")&&(function(e){if(!e.getExtension("OES_texture_float"))return!1;var t=e.createFramebuffer(),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2,2,0,e.RGBA,e.FLOAT,new Float32Array([2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));var i=e.createProgram(),a=e.createShader(e.VERTEX_SHADER),o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,"      attribute vec2 vertex;      void main() {        gl_Position = vec4(vertex, 0.0, 1.0);      }    "),e.shaderSource(o,"      uniform sampler2D texture;      void main() {        gl_FragColor = texture2D(texture, vec2(0.5));      }    "),e.compileShader(a),e.compileShader(o),e.attachShader(i,a),e.attachShader(i,o),e.linkProgram(i);var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0]),e.STREAM_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0);var l=new Uint8Array(4);return e.useProgram(i),e.viewport(0,0,1,1),e.bindTexture(e.TEXTURE_2D,r),e.drawArrays(e.POINTS,0,1),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,l),127===l[0]||128===l[0]}(t)&&(e=WebGLRenderingContext.prototype.getExtension,n=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getExtension=function(t){return"OES_texture_float_linear"===t?function(e){return void 0===e.$OES_texture_float_linear$&&Object.defineProperty(e,"$OES_texture_float_linear$",{enumerable:!1,configurable:!1,writable:!1,value:new r}),e.$OES_texture_float_linear$}(this):e.call(this,t)},WebGLRenderingContext.prototype.getSupportedExtensions=function(){var e=n.call(this);return-1===e.indexOf("OES_texture_float_linear")&&e.push("OES_texture_float_linear"),e}))}(),U.canvas=function(){var e=document.createElement("canvas");try{t=e.getContext("experimental-webgl",{premultipliedAlpha:!1})}catch(e){t=null}if(!t)throw"This browser does not support WebGL";return e._={gl:t,isInitialized:!1,texture:null,spareTexture:null,flippedShader:null},e.texture=p(i),e.draw=p(s),e.update=p(l),e.replace=p(u),e.contents=p(h),e.getPixelArray=p(d),e.brightnessContrast=p(y),e.hexagonalPixelate=p(D),e.hueSaturation=p(w),e.colorHalftone=p(R),e.triangleBlur=p(I),e.unsharpMask=p(k),e.perspective=p(j),e.matrixWarp=p(G),e.bulgePinch=p(z),e.tiltShift=p(M),e.dotScreen=p(P),e.edgeWork=p(O),e.lensBlur=p(E),e.zoomBlur=p(A),e.noise=p(C),e.denoise=p(B),e.curves=p(b),e.swirl=p(H),e.ink=p(N),e.vignette=p(T),e.vibrance=p(L),e.sepia=p(S),e.invert=p(X),e.toAlpha=p(F),e},U.splineInterpolate=x;var K=function(){var e=function(e){return"[object Number]"==Object.prototype.toString.call(e)},n=function(e,n,r){var i=t.createShader(e);if(t.shaderSource(i,n.replace(/#define.*/,"")),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw"compile error: "+r+" - "+t.getShaderInfoLog(i);return i},r=function(e){var n=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,e);return null!==n&&0!==n.precision},i=function(e,i,l){if(this.vertexAttribute=null,this.texCoordAttribute=null,this.program=t.createProgram(),e=e||a,i=i||o,null===s&&(s=r(t.HIGH_FLOAT)?"highp":r(t.MEDIUM_FLOAT)?"mediump":"lowp"),i="precision "+s+" float;"+i,t.attachShader(this.program,n(t.VERTEX_SHADER,e,l+"(vertex)")),t.attachShader(this.program,n(t.FRAGMENT_SHADER,i,l+"(fragment)")),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))throw"link error: "+t.getProgramInfoLog(this.program)},a="    attribute vec2 vertex;    attribute vec2 _texCoord;    varying vec2 texCoord;    void main() {        texCoord = _texCoord;        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);    }",o="    uniform sampler2D texture;    varying vec2 texCoord;    void main() {        gl_FragColor = texture2D(texture, texCoord);    }",s=null;return i.prototype.destroy=function(){t.deleteProgram(this.program),this.program=null},i.prototype.uniforms=function(n){for(var r in t.useProgram(this.program),n)if(n.hasOwnProperty(r)){var i=t.getUniformLocation(this.program,r);if(null!==i){var a=n[r];if(o=a,"[object Array]"==Object.prototype.toString.call(o))switch(a.length){case 1:t.uniform1fv(i,new Float32Array(a));break;case 2:t.uniform2fv(i,new Float32Array(a));break;case 3:t.uniform3fv(i,new Float32Array(a));break;case 4:t.uniform4fv(i,new Float32Array(a));break;case 9:t.uniformMatrix3fv(i,!1,new Float32Array(a));break;case 16:t.uniformMatrix4fv(i,!1,new Float32Array(a));break;default:throw"dont't know how to load uniform \""+r+'" of length '+a.length}else{if(!e(a))throw'attempted to set uniform "'+r+'" to invalid value '+(a||"undefined").toString();t.uniform1f(i,a)}}}var o;return this},i.prototype.textures=function(e){for(var n in t.useProgram(this.program),e)e.hasOwnProperty(n)&&t.uniform1i(t.getUniformLocation(this.program,n),e[n]);return this},i.prototype.drawRect=function(e,n,r,i){var a,o=t.getParameter(t.VIEWPORT);n=n!==a?(n-o[1])/o[3]:0,e=e!==a?(e-o[0])/o[2]:0,r=r!==a?(r-o[0])/o[2]:1,i=i!==a?(i-o[1])/o[3]:1,null==t.vertexBuffer&&(t.vertexBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,t.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([e,n,e,i,r,n,r,i]),t.STATIC_DRAW),null==t.texCoordBuffer&&(t.texCoordBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,t.texCoordBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW)),null==this.vertexAttribute&&(this.vertexAttribute=t.getAttribLocation(this.program,"vertex"),t.enableVertexAttribArray(this.vertexAttribute)),null==this.texCoordAttribute&&(this.texCoordAttribute=t.getAttribLocation(this.program,"_texCoord"),t.enableVertexAttribArray(this.texCoordAttribute)),t.useProgram(this.program),t.bindBuffer(t.ARRAY_BUFFER,t.vertexBuffer),t.vertexAttribPointer(this.vertexAttribute,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,t.texCoordBuffer),t.vertexAttribPointer(this.texCoordAttribute,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4)},i.getDefaultShader=function(){return t.defaultShader=t.defaultShader||new i,t.defaultShader},i}();m.prototype.interpolate=function(e){for(var t=0,n=this.ya.length-1;n-t>1;){var r=n+t>>1;this.xa[r]>e?n=r:t=r}var i=this.xa[n]-this.xa[t],a=(this.xa[n]-e)/i,o=(e-this.xa[t])/i;return a*this.ya[t]+o*this.ya[n]+((a*a*a-a)*this.y2[t]+(o*o*o-o)*this.y2[n])*(i*i)/6};var V=function(){var e=function(e,n,r,i){this.gl=t,this.id=t.createTexture(),this.width=e,this.height=n,this.format=r,this.type=i,t.bindTexture(t.TEXTURE_2D,this.id),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e&&n&&t.texImage2D(t.TEXTURE_2D,0,this.format,e,n,0,this.format,this.type,null)},n=function(e){null==r&&(r=document.createElement("canvas")),r.width=e.width,r.height=e.height;var t=r.getContext("2d");return t.clearRect(0,0,r.width,r.height),t};e.fromElement=function(n){var r=new e(0,0,t.RGBA,t.UNSIGNED_BYTE);return r.loadContentsOf(n),r},e.prototype.loadContentsOf=function(e){this.width=e.width||e.videoWidth,this.height=e.height||e.videoHeight,t.bindTexture(t.TEXTURE_2D,this.id),t.texImage2D(t.TEXTURE_2D,0,this.format,this.format,this.type,e)},e.prototype.initFromBytes=function(e,n,r){this.width=e,this.height=n,this.format=t.RGBA,this.type=t.UNSIGNED_BYTE,t.bindTexture(t.TEXTURE_2D,this.id),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,this.type,new Uint8Array(r))},e.prototype.destroy=function(){t.deleteTexture(this.id),this.id=null},e.prototype.use=function(e){t.activeTexture(t.TEXTURE0+(e||0)),t.bindTexture(t.TEXTURE_2D,this.id)},e.prototype.unuse=function(e){t.activeTexture(t.TEXTURE0+(e||0)),t.bindTexture(t.TEXTURE_2D,null)},e.prototype.ensureFormat=function(e,n,r,i){if(1==arguments.length){var a=arguments[0];e=a.width,n=a.height,r=a.format,i=a.type}e==this.width&&n==this.height&&r==this.format&&i==this.type||(this.width=e,this.height=n,this.format=r,this.type=i,t.bindTexture(t.TEXTURE_2D,this.id),t.texImage2D(t.TEXTURE_2D,0,this.format,e,n,0,this.format,this.type,null))},e.prototype.drawTo=function(e){if(t.framebuffer=t.framebuffer||t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,t.framebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.id,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw new Error("incomplete framebuffer");t.viewport(0,0,this.width,this.height),e(),t.bindFramebuffer(t.FRAMEBUFFER,null)};var r=null;return e.prototype.fillUsingCanvas=function(e){return e(n(this)),this.format=t.RGBA,this.type=t.UNSIGNED_BYTE,t.bindTexture(t.TEXTURE_2D,this.id),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),this},e.prototype.toImage=function(e){this.use(),K.getDefaultShader().drawRect();var i=this.width*this.height*4,a=new Uint8Array(i),o=n(this),s=o.createImageData(this.width,this.height);t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,a);for(var l=0;l<i;l++)s.data[l]=a[l];o.putImageData(s,0,0),e.src=r.toDataURL()},e.prototype.swapWith=function(e){var t;t=e.id,e.id=this.id,this.id=t,t=e.width,e.width=this.width,this.width=t,t=e.height,e.height=this.height,this.height=t,t=e.format,e.format=this.format,this.format=t},e}(),W="    float random(vec3 scale, float seed) {        /* use the fragment position for a different seed per-pixel */        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);    }";return U}()})),r.register("dVkJn",(function(e,t){e.exports="#define GLSLIFY 1\nuniform sampler2D texture;\nvarying vec2 texCoord;\nuniform vec2 texSize;\n\nuniform float seed;\nuniform float type;\nuniform vec2 scale;\nuniform vec2 offset;\nuniform float octaves;\nuniform float samples;\n\nuniform float peaks;\nuniform float contrast;\nuniform float brightness;\nuniform float doInvert;\n\nuniform vec3 colA;\nuniform vec3 colB;\n\nuniform float channels; // 0 - rgb, 1 - alpha\n\n// fbm, cellular_noise based on\n// https://github.com/Gonkee/Gonkees-Shaders\n// MIT, Copyright © Gonkee\n\n// hash & simplex based on\n// https://www.shadertoy.com/view/Msf3WH\n// MIT, Copyright © 2013 Inigo Quilez\n// https://www.youtube.com/c/InigoQuilez\n// https://iquilezles.org\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nfloat value_noise(vec2 coord){\n    return rand(floor(coord) / 100.0);\n}\n\nfloat cellular_noise(vec2 coord) {\n    vec2 i = floor(coord);\n    vec2 f = fract(coord);\n\n    float min_dist = 99999.0;\n    for (float x = -1.0; x <= 1.0; x++) {\n        for (float y = -1.0; y <= 1.0; y++) {\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\n            min_dist = min(min_dist, dist);\n        }\n    }\n    return min_dist;\n}\n\n// ---------- Simplex Alternative _--------------------\n\nvec3 hash(vec3 p)\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\n, dot(p, vec3(269.5, 183.3, 246.1))\n, dot(p, vec3(113.5, 271.9, 124.6)))\n;return fract(sin(p)*43758.5453123)*2.-1.; }\n\nmat3 hash(mat3 p)\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\n\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\n\n//return noiseGra13dx as .x, and its derivatives as .yzw\n// https://www.shadertoy.com/view/llByD1\nvec3 noiseGra13dx(in vec3 x) {\n    vec3 p=floor(x), w=fract(x)\n    #if 1\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\n    #else\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\n    #endif\n    //gradients\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\n    //projections\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\n    //interpolations\n    float g=dot(G, w), f=dot(F, w-vec3(1));\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\n    mat3 S=D-mat3(G, G, G), W=D-E;\n    a.x=(a.x+a.y+a.z)+f-g;\n    ;float b=u.x*u.y*u.z;\n\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\n    return 0.5 + 0.5 * result.xxx;\n}\n\nfloat fbm(vec2 coord) {\n    float normalize_factor = 0.0;\n    float value = 0.0;\n    float scale = 0.5;\n\n    for (float i = 0.0; i < 7.0; i++){\n        if (i < octaves) {\n            if (type == 0.0) {\n                value += value_noise(coord) * scale;\n            } else if (type == 1.0) {\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\n            } else if (type == 2.0) {\n                value += cellular_noise(coord) * scale;\n            }\n            normalize_factor += scale;\n            coord *= 2.0;\n            scale *= 0.5;\n        }\n    }\n    return value / normalize_factor;\n}\n\nfloat render (vec2 pos) {\n    float result = fbm(pos);\n    //\n\n    if (peaks > 0.0) {\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\n    }\n\n    result += brightness;\n    if (contrast > 0.0) {\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\n    } else if (contrast < 0.0) {\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\n    }\n\n    if (doInvert == 1.0) {\n        result = 1.0 - result;\n    }\n    return result;\n}\n\nvoid main() {\n    vec4 color;\n\n    vec2 seedOffset;\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\n\n    float val = 0.0;\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\n\n    if (samples == 1.0) {\n        val = render(basePos);\n\n    }/* else if (samples == 4.0) {\n        for (float i = 0.0; i < 2.0; i++) {\n            for (float e = 0.0; e < 2.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\n            }\n        }\n        val /= 4.0;\n\n    }*/ else if (samples == 16.0) {\n        for (float i = 0.0; i < 4.0; i++) {\n            for (float e = 0.0; e < 4.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\n            }\n        }\n        val /= 16.0;\n    }\n\n    if (channels == 0.0) {\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\n    } else {\n        gl_FragColor = vec4(vec3(1.0), val);\n    }\n}"})),r.register("lorQQ",(function(e,n){t(e.exports,"filterCropExtend",(function(){return u}));var i=r("eWjiX"),a=r("c4LUw"),o=r("lXqiv"),s=r("9A7OD"),l=r("32CBv"),c=r("1mH1z"),u={getDialog:function(e){var t=function(){y=parseInt(I.value),x=parseInt(A.value),b=parseInt(R.value),B=parseInt(P.value);var e=r.getWidth()+y+x,t=r.getHeight()+b+B;e<=0&&(w&&(y=-r.getWidth()-x+1,I.value=""+y),C&&(x=-r.getWidth()-y+1,A.value=""+x),e=1),e>L&&(w&&(y=-r.getWidth()-x+L,I.value=""+y),C&&(x=-r.getWidth()-y+L,A.value=""+x),e=L),t<=0&&(S&&(b=-r.getHeight()-B+1,R.value=""+b),k&&(B=-r.getHeight()-b+1,P.value=""+B),t=1),t>T&&(S&&(b=-r.getHeight()-B+T,R.value=""+b),k&&(B=-r.getHeight()-b+T,P.value=""+B),t=T),K.setTransform({x:-y,y:-b,width:e,height:t}),w=!1,C=!1,S=!1,k=!1},n=function(e){var t=i.BB.fitInto(e.width,e.height,260,180,1);v=t.width/e.width;var n=i.BB.centerWithin(340,220,t.width,t.height);u.style.width=r.getWidth()*v+"px",u.style.height=r.getHeight()*v+"px",U.style.left=n.x-e.x*v+"px",U.style.top=n.y-e.y*v+"px",y=parseInt(""+-e.x),b=parseInt(""+-e.y),x=parseInt(""+(e.x+e.width-r.getWidth())),B=parseInt(""+(e.y+e.height-r.getHeight())),I.value=""+y,R.value=""+b,A.value=""+x,P.value=""+B,i.BB.createCheckerDataUrl(parseInt(""+50*v),(function(e){X.style.background="url("+e+")",0!==z.a&&(u.style.background="url("+e+")")})),X.style.backgroundPosition=n.x+"px "+n.y+"px",K.setScale(v)},r=e.klCanvas;if(!r)return!1;var u=i.BB.canvas(),h=i.BB.fitInto(r.getWidth(),r.getHeight(),560,400,1),d=parseInt(""+h.width),p=parseInt(""+h.height),g=d/r.getWidth();u.width=d,u.height=p,u.style.display="block",u.getContext("2d").drawImage(r.getCompleteCanvas(g),0,0,d,p);var f=document.createElement("div"),m={element:f};f.innerHTML=(0,c.LANG)("filter-crop-description")+"<br/><br/>";var v,y=0,x=0,b=0,B=0,w=!1,C=!1,S=!1,k=!1,L=e.maxWidth,T=e.maxHeight,E=i.BB.el({css:{lineHeight:"30px",height:"35px"}}),M=i.BB.el({css:{lineHeight:"30px",height:"35px"}});f.appendChild(E),f.appendChild(M);var I=(0,a.input)({init:0,type:"number",min:-r.getWidth(),max:L,css:{width:"75px",marginRight:"20px"},callback:function(e){w=!0,t()}}),A=(0,a.input)({init:0,type:"number",min:-r.getWidth(),max:L,css:{width:"75px"},callback:function(e){C=!0,t()}}),R=(0,a.input)({init:0,type:"number",min:-r.getHeight(),max:T,css:{width:"75px",marginRight:"20px"},callback:function(e){S=!0,t()}}),P=(0,a.input)({init:0,type:"number",min:-r.getHeight(),max:T,css:{width:"75px"},callback:function(e){k=!0,t()}}),O={display:"inline-block",width:"60px"};E.append(i.BB.el({content:(0,c.LANG)("filter-crop-left")+":",css:O}),I,i.BB.el({content:(0,c.LANG)("filter-crop-right")+":",css:O}),A),M.append(i.BB.el({content:(0,c.LANG)("filter-crop-top")+":",css:O}),R,i.BB.el({content:(0,c.LANG)("filter-crop-bottom")+":",css:O}),P);var D=!0,N=new(0,o.Checkbox)({init:!0,label:(0,c.LANG)("filter-crop-rule-thirds"),allowTab:!0,callback:function(e){D=e,K.showThirds(D)}});f.appendChild(i.BB.el({css:{clear:"both"}}));var z={r:0,g:0,b:0,a:0},G=[{r:0,g:0,b:0,a:0},{r:255,g:255,b:255,a:1},{r:0,g:0,b:0,a:1}];G.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),G.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1});var j=new(0,s.ColorOptions)({label:(0,c.LANG)("filter-crop-fill"),colorArr:G,onChange:function(e){z=e,function(e){var t;0===e.a?(t="rgba(0,0,0,0.5)",F.style.background="",u.style.background=""):(t=e.r+e.g+e.b<382.5?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)",F.style.background=i.BB.ColorConverter.toRgbStr(e),i.BB.createCheckerDataUrl(parseInt(""+50*v),(function(e){u.style.background="url("+e+")"}))),u.style.boxShadow="0 0 3px 1px "+t}(e)}}),H=i.BB.el({css:{display:"flex",justifyContent:"space-between"}});f.appendChild(H),H.appendChild(N.getElement()),H.appendChild(j.getElement());var X=i.BB.el({css:{width:"340px",marginTop:"10px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",position:"relative",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",userSelect:"none",colorScheme:"only light",touchAction:"none"}});X.oncontextmenu=function(){return!1};var F=i.BB.el({css:{position:"absolute",left:"0",top:"0",bottom:"0",right:"0"}});X.appendChild(F);var U=document.createElement("div");U.style.position="absolute",U.style.left="0px",U.style.top="0px",X.appendChild(U),i.BB.appendTextDiv(U,"").appendChild(u),u.style.boxShadow="0 0 3px 1px rgba(0,0,0,0.5)",u.style.position="absolute",u.style.left="0px",u.style.top="0px",f.appendChild(X);var K=new(0,l.Cropper)({x:0,y:0,width:r.getWidth(),height:r.getHeight(),scale:v,callback:n,maxW:L,maxH:T});return n(K.getTransform()),U.appendChild(K.getElement()),m.destroy=function(){K.destroy(),N.destroy()},m.getInput=function(){return m.destroy(),{left:y,right:x,top:b,bottom:B,fillColor:0===z.a?null:z}},m},apply:function(e){var t=e.klCanvas,n=e.history;return!(!t||!n||isNaN(e.input.left)||isNaN(e.input.right)||isNaN(e.input.top)||isNaN(e.input.bottom))&&(n.pause(!0),t.resizeCanvas(e.input),n.pause(!1),n.push({tool:["filter","cropExtend"],action:"apply",params:[{input:JSON.parse(JSON.stringify(e.input))}]}),!0)}}})),r.register("8Ri8I",(function(e,n){t(e.exports,"filterCurves",(function(){return c}));var i=r("eWjiX"),a=r("iskOY"),o=r("i5nyl"),s=r("5RaQo"),l=r("1mH1z"),c={getDialog:function(e){var t=e.context,n=e.klCanvas;if(!t||!n)return!1;var r=n.getLayers(),c=n.getLayerIndex(t.canvas),u=i.BB.fitInto(t.canvas.width,t.canvas.height,280,200,1),h=parseInt(""+u.width),d=parseInt(""+u.height),p=i.BB.canvas(h,d),g=p.getContext("2d");g.save(),p.width>t.canvas.width&&(g.imageSmoothingEnabled=!1),g.drawImage(t.canvas,0,0,h,d),g.restore();var f,m=document.createElement("div"),v={element:m};return setTimeout((function(){t.canvas.width;m.innerHTML=(0,l.LANG)("filter-curves-description")+"<br/><br/>";var e={r:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],g:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],b:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]]},n=(0,s.getSharedFx)();if(n){var u,g=n.texture(p);n.draw(g).update();var y=new function(e){var t=document.createElement("div");t.oncontextmenu=function(){return!1},t.style.position="relative",t.style.marginBottom="10px";var n="All",r=e.curves;u=new(0,a.Options)({optionArr:[{id:"All",label:(0,l.LANG)("filter-curves-all")},{id:"Red",label:(0,l.LANG)("red")},{id:"Green",label:(0,l.LANG)("green")},{id:"Blue",label:(0,l.LANG)("blue")}],initialId:"All",onChange:function(e){"All"===(n=e)&&(r={r:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],g:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],b:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]]});var t=r.r;"Green"===n&&(t=r.g),"Blue"===n&&(t=r.b),m.setPos(0,c-t[0][1]*c),v.setPos(t[1][0]*s,c-t[1][1]*c),y.setPos(t[2][0]*s,c-t[2][1]*c),x.setPos(s,c-t[3][1]*c),b()}}),t.appendChild(u.getElement());var o=document.createElement("div");i.BB.css(o,{position:"relative",marginTop:"10px",colorScheme:"only light"}),t.appendChild(o);var s=300,c=100,h=i.BB.canvas(s,c);i.BB.css(h,{background:"#c6c6c6",boxShadow:"0 0 0 1px rgba(0,0,0,0.3)"});var d=h.getContext("2d");function p(e){return Math.max(0,Math.min(1,e))}function g(e,t,n,r){var a=t,l=e,u=document.createElement("div");return i.BB.css(u,{position:"absolute",left:e-7+"px",top:t-7+"px",width:"14px",height:"14px",background:"#fff",cursor:"move",borderRadius:"14px",boxShadow:"inset 0 0 0 2px #000",userSelect:"none",touchAction:"none"}),u.pointerListener=new i.BB.PointerListener({target:u,maxPointers:1,onPointer:function(o){o.eventPreventDefault(),"pointerdown"===o.type&&(l=e,a=t),"left"===o.button&&"pointermove"===o.type&&(r||(l+=o.dX),e=Math.max(0,Math.min(s,l)),a+=o.dY,t=Math.max(0,Math.min(c,a)),i.BB.css(u,{left:e-7+"px",top:t-7+"px"}),n({x:e,y:t}))}}),o.appendChild(u),u.setPos=function(n,r){a=t=r,l=e=n,i.BB.css(u,{left:e-7+"px",top:t-7+"px"})},u}function f(e,t,i){"All"===n&&(r.r[e]=[p(t/s),p(1-i/c)],r.g[e]=[p(t/s),p(1-i/c)],r.b[e]=[p(t/s),p(1-i/c)]),"Red"===n&&(r.r[e]=[p(t/s),p(1-i/c)]),"Green"===n&&(r.g[e]=[p(t/s),p(1-i/c)]),"Blue"===n&&(r.b[e]=[p(t/s),p(1-i/c)])}o.appendChild(h);var m=g(0,c,(function(e){f(0,e.x,e.y),b()}),!0),v=g(s/3,c/3*2,(function(e){f(1,e.x,e.y),b()})),y=g(s/3*2,c/3,(function(e){f(2,e.x,e.y),b()})),x=g(s,0,(function(e){f(3,e.x,e.y),b()}),!0);function b(){h.width=h.width,d=h.getContext("2d");for(var t={r:[],g:[],b:[]},a=0;a<r.r.length;a++)t.r.push(r.r[a]),t.g.push(r.g[a]),t.b.push(r.b[a]);function o(e){d.beginPath();for(var t=new i.BB.SplineInterpolator(e),n=0;n<100;n++){var r=t.interpolate(n/100);r=Math.max(0,Math.min(1,r)),0===n?d.moveTo(n/100*s,c-r*c):d.lineTo(n/100*s,c-r*c)}d.stroke()}d.save(),"All"===n?(d.strokeStyle="black",o(t.r)):(d.globalAlpha=.5,d.strokeStyle="red",o(t.r),d.strokeStyle="green",o(t.g),d.strokeStyle="blue",o(t.b)),d.restore(),e.callback(t)}b(),this.getDiv=function(){return t},this.destroy=function(){m.pointerListener.destroy(),v.pointerListener.destroy(),y.pointerListener.destroy(),x.pointerListener.destroy()}}({curves:e,callback:function(t){e=t,function(){try{n.draw(g).curves(e.r,e.g,e.b).update(),f&&f.render()}catch(e){m.errorCallback(e)}}()}});m.appendChild(y.getDiv());var x=document.createElement("div");i.BB.css(x,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var b=[],B=0;B<r.length;B++)b.push({image:B===c?n:r[B].context.canvas,opacity:r[B].opacity,mixModeStr:r[B].mixModeStr});f=new(0,o.KlCanvasPreview)({width:parseInt(""+h),height:parseInt(""+d),layers:b});var w=i.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+h)+"px",height:parseInt(""+d)+"px"}});w.appendChild(f.getElement()),x.appendChild(w),m.appendChild(x),v.destroy=function(){y.destroy(),g.destroy(),u.destroy()},v.getInput=function(){return v.destroy(),{curves:e}}}}),1),v},apply:function(e){var t=e.context,n=e.input.curves,r=e.history;if(!t||null===n||!r)return!1;r.pause(!0);var i=(0,s.getSharedFx)();if(!i)return!1;var a=i.texture(t.canvas);return i.draw(a).curves(n.r,n.g,n.b).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(i,0,0),a.destroy(),r.pause(!1),r.push({tool:["filter","curves"],action:"apply",params:[{input:e.input}]}),!0}}})),r.register("fADXF",(function(n,i){t(n.exports,"filterFlip",(function(){return u}));var a=r("eWjiX"),o=r("lXqiv"),s=r("i5nyl"),l=r("1RI49"),c=r("1mH1z"),u={getDialog:function(t){var n=function(){var e=L.image.getContext("2d");e.save(),e.clearRect(0,0,L.image.width,L.image.height),x&&(v&&(e.translate(L.image.width,0),e.scale(-1,1)),y&&(e.translate(0,L.image.height),e.scale(1,-1)));for(var t=0;t<u.length;t++)e.save(),x||h!==t||(v&&(e.translate(L.image.width,0),e.scale(-1,1)),y&&(e.translate(0,L.image.height),e.scale(1,-1))),e.canvas.width>u[t].context.canvas.width&&(e.imageSmoothingEnabled=!1),e.globalAlpha=u[t].opacity,e.globalCompositeOperation=u[t].mixModeStr,e.drawImage(u[t].context.canvas,0,0,L.image.width,L.image.height),e.restore();T.render(),e.restore()},r=t.context,i=t.klCanvas;if(!r||!i)return!1;var u=i.getLayers(),h=i.getLayerIndex(r.canvas),d=a.BB.fitInto(r.canvas.width,r.canvas.height,280,200,1),p=parseInt(""+d.width),g=parseInt(""+d.height),f=document.createElement("div"),m={element:f},v=!0,y=!1,x=!0;f.innerHTML=(0,c.LANG)("filter-flip-description")+"<br/><br/>";var b=new(0,o.Checkbox)({init:v,label:(0,c.LANG)("filter-flip-horizontal")+" ⟷",allowTab:!0,callback:function(e){v=e,n()},css:{marginBottom:"10px"}}),B=new(0,o.Checkbox)({init:y,label:(0,c.LANG)("filter-flip-vertical")+" ↕",allowTab:!0,callback:function(e){y=e,n()},css:{marginBottom:"10px"}});f.appendChild(b.getElement()),f.appendChild(B.getElement());var w=document.createElement("div");a.BB.setEventListener(w,"onpointerdown",(function(){return!1})),w.textContent=(0,c.LANG)("filter-flip-image"),w.style.width="150px",w.style.height="30px",w.style.paddingTop="10px",w.style.textAlign="center",w.style.cssFloat="left",w.style.paddingBottom="0px",w.style.borderTopLeftRadius="10px",w.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",w.style.background="url("+e(l)+") no-repeat 12px 16px",w.style.backgroundSize="8%",w.style.backgroundColor="#9e9e9e";var C=document.createElement("div");a.BB.setEventListener(C,"onpointerdown",(function(){return!1})),C.textContent=(0,c.LANG)("filter-flip-layer"),C.style.width="150px",C.style.height="30px",C.style.paddingTop="10px",C.style.textAlign="center",C.style.cssFloat="left",C.style.paddingBottom="0px",C.style.borderTopRightRadius="10px",C.style.cursor="pointer",C.style.backgroundColor="rgba(0, 0, 0, 0.1)",C.style.backgroundSize="8%",a.BB.setEventListener(w,"onpointerover",(function(){!1===x&&(w.style.backgroundColor="#ccc")})),a.BB.setEventListener(w,"onpointerout",(function(){!1===x&&(w.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),a.BB.setEventListener(C,"onpointerover",(function(){!0===x&&(C.style.backgroundColor="#ccc")})),a.BB.setEventListener(C,"onpointerout",(function(){!0===x&&(C.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),w.onclick=function(){x=!0,C.style.background="",C.style.backgroundColor="rgba(0, 0, 0, 0.1)",C.style.boxShadow="",C.style.cursor="pointer",w.style.background="url("+e(l)+") no-repeat 12px 16px",w.style.backgroundSize="8%",w.style.backgroundColor="#9e9e9e",w.style.cursor="default",w.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",n()},C.onclick=function(){x=!1,w.style.background="",w.style.backgroundColor="rgba(0, 0, 0, 0.1)",w.style.boxShadow="",w.style.cursor="pointer",C.style.background="url("+e(l)+") no-repeat 12px 16px",C.style.backgroundSize="8%",C.style.backgroundColor="#9e9e9e",C.style.cursor="default",C.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",n()};var S=document.createElement("div");S.appendChild(w),S.appendChild(C),f.appendChild(S);var k=document.createElement("div");a.BB.css(k,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});var L={image:a.BB.canvas(Math.round(p),Math.round(g)),opacity:1,mixModeStr:"source-over"},T=new(0,s.KlCanvasPreview)({width:Math.round(p),height:Math.round(g),layers:[L]}),E=a.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+p)+"px",height:parseInt(""+g)+"px"}});return E.appendChild(T.getElement()),k.appendChild(E),setTimeout(n,0),f.appendChild(k),m.destroy=function(){b.destroy(),B.destroy()},m.getInput=function(){return m.destroy(),{horizontal:v,vertical:y,flipCanvas:x}},m},apply:function(e){var t=e.context,n=e.klCanvas,r=e.history,i=e.input.horizontal,a=e.input.vertical,o=e.input.flipCanvas;return!!(t&&n&&r)&&(r.pause(!0),n.flip(i,a,o?null:n.getLayerIndex(t.canvas)),r.pause(!1),r.push({tool:["filter","flip"],action:"apply",params:[{input:e.input}]}),!0)}}})),r.register("1RI49",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("eFiVD")})),r.register("bIns5",(function(e,n){t(e.exports,"filterHueSaturation",(function(){return u}));var i=r("eWjiX"),a=r("cH2YE"),o=r("llzZ0"),s=r("i5nyl"),l=r("5RaQo"),c=r("1mH1z"),u={getDialog:function(e){var t=e.context,n=e.klCanvas;if(!t||!n)return!1;var r=n.getLayers(),u=n.getLayerIndex(t.canvas),h=i.BB.fitInto(t.canvas.width,t.canvas.height,280,200,1),d=parseInt(""+h.width),p=parseInt(""+h.height),g=i.BB.canvas(d,p),f=g.getContext("2d");f.save(),g.width>t.canvas.width&&(f.imageSmoothingEnabled=!1),f.drawImage(t.canvas,0,0,d,p),f.restore();var m=document.createElement("div"),v={element:m};return setTimeout((function(){var e=0,t=0;m.innerHTML=(0,c.LANG)("filter-hue-sat-description")+"<br/><br/>";var n=(0,l.getSharedFx)();if(n){var h=n.texture(g);n.draw(h).update();var f=new(0,o.KlSlider)({label:(0,c.LANG)("filter-hue-sat-hue"),width:300,height:30,min:-100,max:100,value:100*e,eventResMs:a.eventResMs,onChange:function(r){e=r/100,n.draw(h).hueSaturation(e,t).update(),w.render()}}),y=new(0,o.KlSlider)({label:(0,c.LANG)("filter-hue-sat-saturation"),width:300,height:30,min:0,max:100,value:50*(t+1),eventResMs:a.eventResMs,onChange:function(r){t=r/50-1,n.draw(h).hueSaturation(e,t).update(),w.render()}});f.getElement().style.marginBottom="10px",m.appendChild(f.getElement()),m.appendChild(y.getElement());var x=document.createElement("div");i.BB.css(x,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var b=[],B=0;B<r.length;B++)b.push({image:B===u?n:r[B].context.canvas,opacity:r[B].opacity,mixModeStr:r[B].mixModeStr});var w=new(0,s.KlCanvasPreview)({width:parseInt(""+d),height:parseInt(""+p),layers:b}),C=i.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+d)+"px",height:parseInt(""+p)+"px"}});C.appendChild(w.getElement()),x.appendChild(C),m.appendChild(x);try{n.draw(h).hueSaturation(e,t).update(),w.render()}catch(e){m.errorCallback(e)}v.destroy=function(){f.destroy(),y.destroy(),h.destroy()},v.getInput=function(){return v.destroy(),{hue:e,Saturation:t}}}}),1),v},apply:function(e){var t=e.context,n=e.input.hue,r=e.history,i=e.input.Saturation;if(!t||null===n||null===i||!r)return!1;r.pause(!0);var a=(0,l.getSharedFx)();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).hueSaturation(n,i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),r.pause(!1),r.push({tool:["filter","hueSaturation"],action:"apply",params:[{input:e.input}]}),!0}}})),r.register("30jcG",(function(e,n){t(e.exports,"filterInvert",(function(){return a}));var i=r("5RaQo"),a={apply:function(e){var t=e.context,n=e.history;if(!t||!n)return!1;n.pause(!0);var r=(0,i.getSharedFx)();if(!r)return!1;var a=r.texture(t.canvas);return r.draw(a).invert().update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(r,0,0),a.destroy(),n.pause(!1),n.push({tool:["filter","invert"],action:"apply",params:[{input:e.input}]}),!0}}})),r.register("cCks8",(function(n,i){t(n.exports,"filterPerspective",(function(){return u}));var a=r("eWjiX"),o=r("i5nyl"),s=r("1RI49"),l=r("5RaQo"),c=r("1mH1z"),u={getDialog:function(t){var n=t.context,r=t.klCanvas;if(!n||!r)return!1;var i=window.innerWidth<550,u=r.getLayers(),h=r.getLayerIndex(n.canvas),d=a.BB.fitInto(n.canvas.width,n.canvas.height,i?280:490,i?200:240,1),p=parseInt(""+d.width),g=parseInt(""+d.height),f=Math.min(p,n.canvas.width),m=Math.min(g,n.canvas.height),v=a.BB.canvas(f,m),y=v.getContext("2d");y.save(),f>n.canvas.width&&(y.imageSmoothingEnabled=!1),y.drawImage(n.canvas,0,0,f,m),y.restore();var x=p/n.canvas.width,b=document.createElement("div"),B={element:b};i||(B.width=500);var w=[];return setTimeout((function(){b.innerHTML=(0,c.LANG)("filter-perspective-description")+"<br/><br/>";var t=(0,l.getSharedFx)();if(t){var n,r,d,y,C,S,k,L,T=t.texture(v);t.draw(T).update(),n=j(0,0,H),r=j(p,0,H),d=j(p,g,H),y=j(0,g,H),C=j(0,0),S=j(p,0),k=j(p,g),L=j(0,g);var E=!1,M=document.createElement("div");a.BB.setEventListener(M,"onpointerdown",(function(){return!1})),M.textContent=(0,c.LANG)("filter-perspective-before"),M.style.width="150px",M.style.height="30px",M.style.marginLeft=i?"0":"100px",M.style.paddingTop="10px",M.style.textAlign="center",M.style.cssFloat="left",M.style.paddingBottom="0px",M.style.borderTopLeftRadius="10px",M.style.cursor="pointer",M.style.backgroundColor="rgba(0, 0, 0, 0.1)",M.style.backgroundSize="8%";var I=document.createElement("div");a.BB.setEventListener(I,"onpointerdown",(function(){return!1})),I.textContent=(0,c.LANG)("filter-perspective-after"),I.style.width="150px",I.style.height="30px",I.style.paddingTop="10px",I.style.textAlign="center",I.style.cssFloat="left",I.style.paddingBottom="0px",I.style.borderTopRightRadius="10px",I.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",I.style.background="url("+e(s)+") no-repeat 12px 16px",I.style.backgroundSize="8%",I.style.backgroundColor="#9e9e9e",a.BB.setEventListener(M,"onpointerover",(function(){!1===E&&(M.style.backgroundColor="#ccc")})),a.BB.setEventListener(M,"onpointerout",(function(){!1===E&&(M.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),a.BB.setEventListener(I,"onpointerover",(function(){!0===E&&(I.style.backgroundColor="#ccc")})),a.BB.setEventListener(I,"onpointerout",(function(){!0===E&&(I.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),M.onclick=function(){M.style.background="url("+e(s)+") no-repeat 12px 16px",M.style.backgroundSize="8%",M.style.backgroundColor="#9e9e9e",M.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",M.style.cursor="default",I.style.background="",I.style.backgroundColor="rgba(0, 0, 0, 0.1)",I.style.boxShadow="",I.style.cursor="pointer",C.style.display="none",S.style.display="none",k.style.display="none",L.style.display="none",n.style.display="block",r.style.display="block",d.style.display="block",y.style.display="block",n.copy(C),r.copy(S),d.copy(k),y.copy(L),E=!0,G()},I.onclick=function(){E=!1,I.style.background="url("+e(s)+") no-repeat 12px 16px",I.style.backgroundSize="8%",I.style.backgroundColor="#9e9e9e",I.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",I.style.cursor="default",M.style.background="",M.style.backgroundColor="rgba(0, 0, 0, 0.1)",M.style.boxShadow="",M.style.cursor="pointer",n.style.display="none",r.style.display="none",d.style.display="none",y.style.display="none",C.style.display="block",S.style.display="block",k.style.display="block",L.style.display="block",C.copy(n),S.copy(r),k.copy(d),L.copy(y)};var A=document.createElement("div");A.appendChild(M),A.appendChild(I),b.appendChild(A);var R=document.createElement("div");R.oncontextmenu=function(){return!1},a.BB.css(R,{width:i?"340px":"540px",marginLeft:"-20px",height:i?"260px":"300px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var P=[],O=0;O<u.length;O++){var D=O===h?t:u[O].context.canvas;P.push({image:D,opacity:u[O].opacity,mixModeStr:u[O].mixModeStr})}var N=new(0,o.KlCanvasPreview)({width:parseInt(""+p),height:parseInt(""+g),layers:P}),z=a.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+p)+"px",height:parseInt(""+g)+"px"}});z.appendChild(N.getElement()),R.appendChild(z),z.appendChild(C),z.appendChild(S),z.appendChild(k),z.appendChild(L),n.style.display="none",r.style.display="none",d.style.display="none",y.style.display="none",z.appendChild(n),z.appendChild(r),z.appendChild(d),z.appendChild(y),b.appendChild(R),G(),B.destroy=function(){for(var e=0;e<w.length;e++)w[e].destroy();T.destroy()},B.getInput=function(){return B.destroy(),{before:[n.x/x,n.y/x,r.x/x,r.y/x,d.x/x,d.y/x,y.x/x,y.y/x],after:[C.x/x,C.y/x,S.x/x,S.y/x,k.x/x,k.y/x,L.x/x,L.y/x]}}}function G(){try{t.draw(T).perspective([n.x,n.y,r.x,r.y,d.x,d.y,y.x,y.y].map((function(e,t){return t%2==0?e/p*f:e/g*m})),[C.x,C.y,S.x,S.y,k.x,k.y,L.x,L.y].map((function(e,t){return t%2==0?e/p*f:e/g*m}))).update(),N.render()}catch(e){b.errorCallback(e)}}function j(e,t,n){var r=document.createElement("div");r.x=e,r.y=t,a.BB.css(r,{width:"14px",height:"14px",backgroundColor:"#fff",boxShadow:"inset 0 0 0 2px #000",borderRadius:"14px",position:"absolute",cursor:"move",left:r.x-7+"px",top:r.y-7+"px",userSelect:"none",touchAction:"none"});var i=new a.BB.PointerListener({target:r,maxPointers:1,onPointer:function(e){e.eventPreventDefault(),"left"===e.button&&"pointermove"===e.type&&(r.x+=e.dX,r.y+=e.dY,r.style.left=r.x-7+"px",r.style.top=r.y-7+"px",n&&n(),G())}});return r.copy=function(e){r.x=e.x,r.y=e.y,r.style.left=r.x-7+"px",r.style.top=r.y-7+"px"},w.push(i),r}function H(){C.copy(n),S.copy(r),k.copy(d),L.copy(y)}}),1),B},apply:function(e){var t=e.context,n=e.history,r=e.input.before,i=e.input.after;if(!(t&&r&&i&&n))return!1;n.pause(!0);var a=(0,l.getSharedFx)();if(!a)return!1;var o=a.texture(t.canvas);t.canvas.width,t.canvas.height;return a.draw(o).perspective(r,i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),n.pause(!1),n.push({tool:["filter","perspective"],action:"apply",params:[{input:e.input}]}),!0}}})),r.register("huXOx",(function(n,i){t(n.exports,"filterResize",(function(){return u}));var a=r("eWjiX"),o=r("lXqiv"),s=r("21VAD"),l=r("jfTWC"),c=r("1mH1z"),u={getDialog:function(t){var n=function(){if(0===w.value.length&&L||0===C.value.length&&k)return k=!1,void(L=!1);if(w.value=""+Math.max(1,parseInt(w.value)),C.value=""+Math.max(1,parseInt(C.value)),E&&(k&&(w.value=""+parseInt(""+parseInt(C.value)*T)),L&&(C.value=""+parseInt(""+parseInt(w.value)/T)),parseInt(w.value)>y||parseInt(C.value)>x)){var e=a.BB.fitInto(parseInt(w.value),parseInt(C.value),y,x,1);w.value=""+parseInt(""+e.width),C.value=""+parseInt(""+e.height)}parseInt(w.value)>y&&(w.value=""+y),parseInt(C.value)>x&&(C.value=""+x),k=!1,L=!1,m=parseInt(w.value),v=parseInt(C.value);var t=a.BB.fitInto(m,v,280,200,1),n=parseInt(""+t.width),i=parseInt(""+t.height);d=n/m;var o=a.BB.centerWithin(340,220,n,i);"smooth"===I.getValue()?(R.style.imageRendering=d>1?"pixelated":"",R.width=r.getWidth(),R.height=r.getHeight(),P.save(),P.imageSmoothingQuality="high",P.drawImage(p,0,0),a.BB.resizeCanvas(R,m,v),P.restore()):(R.style.imageRendering="pixelated",R.width=m,R.height=v,P.save(),P.imageSmoothingEnabled=!1,P.drawImage(p,0,0,R.width,R.height),P.restore()),R.style.width=Math.max(1,n)+"px",R.style.height=Math.max(1,i)+"px",D.style.left=o.x+"px",D.style.top=o.y+"px",D.style.width=Math.max(1,n)+"px",D.style.height=Math.max(1,i)+"px"},r=t.klCanvas;if(!r)return!1;var i=a.BB.fitInto(r.getWidth(),r.getHeight(),280,200,1),u=parseInt(""+i.width),h=parseInt(""+i.height),d=u/r.getWidth(),p=r.getCompleteCanvas(1),g=document.createElement("div"),f={element:g},m=r.getWidth(),v=r.getHeight();g.innerHTML=(0,c.LANG)("filter-resize-description")+"<br/><br/>";var y=t.maxWidth,x=t.maxHeight,b=a.BB.el({css:{width:"150px",height:"35px",lineHeight:"30px"}}),B=a.BB.el({css:{width:"150px",height:"35px",lineHeight:"30px"}}),w=a.BB.el({tagName:"input",css:{cssFloat:"right",width:"90px"},custom:{type:"number",min:"1",max:""+y,value:""+r.getWidth()}}),C=a.BB.el({tagName:"input",css:{cssFloat:"right",width:"90px"},custom:{type:"number",min:"1",max:""+x,value:""+r.getHeight()}});w.onclick=function(){this.focus(),L=!0,n()},C.onclick=function(){this.focus(),k=!0,n()},w.onchange=function(){L=!0,n()},C.onchange=function(){k=!0,n()},b.append((0,c.LANG)("width")+": ",w),B.append((0,c.LANG)("height")+": ",C);var S=a.BB.el({css:{background:"url("+e(l)+") no-repeat 140px 5px",backgroundSize:"50px 52px"}});S.append(b,B),g.appendChild(S);var k=!1,L=!1,T=r.getWidth()/r.getHeight(),E=!0,M=new(0,o.Checkbox)({init:!0,label:(0,c.LANG)("constrain-proportions"),allowTab:!0,callback:function(t){(E=t)?(w.value=""+r.getWidth(),C.value=""+r.getHeight(),S.style.background="url("+e(l)+") no-repeat 140px 5px",S.style.backgroundSize="50px 52px",n()):S.style.background=""}});g.appendChild(a.BB.el({css:{clear:"both"}}));var I=new(0,s.Select)({isFocusable:!0,optionArr:[["smooth",(0,c.LANG)("algorithm-smooth")],["pixelated",(0,c.LANG)("algorithm-pixelated")]],title:(0,c.LANG)("scaling-algorithm"),initValue:"smooth",onChange:function(){n()}}),A=a.BB.el({parent:g,css:{display:"flex",justifyContent:"space-between"}});A.appendChild(M.getElement()),A.appendChild(I.getElement());var R=a.BB.canvas(u,h);R.style.imageRendering="pixelated";var P=R.getContext("2d"),O=document.createElement("div");a.BB.css(O,{width:"340px",marginLeft:"-20px",height:"220px",display:"table",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",position:"relative",userSelect:"none",colorScheme:"only light"});var D=a.BB.appendTextDiv(O,"");return D.appendChild(R),D.style.width=u+"px",D.style.height=h+"px",D.style.position="absolute",D.style.overflow="hidden",D.style.boxShadow="0 0 5px rgba(0,0,0,0.8)",D.style.overflow="hidden",a.BB.createCheckerDataUrl(8,(function(e){O.style.background="url("+e+")"})),g.appendChild(O),n(),f.destroy=function(){M.destroy()},f.getInput=function(){return f.destroy(),{width:m,height:v,algorithm:I.getValue()}},f},apply:function(e){var t=e.klCanvas,n=e.history,r=e.input.width,i=e.input.height,a=e.input.algorithm;return!(!t||!n)&&(n.pause(!0),t.resize(r,i,a),n.pause(!1),n.push({tool:["filter","resize"],action:"apply",params:[{input:e.input}]}),!0)}}})),r.register("jfTWC",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("2BZYe")})),r.register("dsRff",(function(e,n){t(e.exports,"filterRotate",(function(){return o}));var i=r("eWjiX"),a=r("1mH1z"),o={getDialog:function(e){var t=function(){if(v.style.WebkitTransform="rotate("+d+"deg)",v.style.MozTransform="rotate("+d+"deg)",v.style.OTransform="rotate("+d+"deg)",v.style.msTransform="rotate("+d+"deg)",90===Math.abs(d%180)){var e=i.BB.fitInto(s,o,280,200,1),t=parseInt(""+e.height)/o;v.style.WebkitTransform="rotate("+d+"deg) scale("+t+")",v.style.MozTransform="rotate("+d+"deg) scale("+t+")",v.style.OTransform="rotate("+d+"deg) scale("+t+")",v.style.msTransform="rotate("+d+"deg) scale("+t+")"}},n=e.klCanvas;if(!n)return!1;var r=i.BB.fitInto(n.getWidth(),n.getHeight(),280,200,1),o=parseInt(""+r.width),s=parseInt(""+r.height),l=o/n.getWidth(),c=i.BB.canvas(o,s);c.style.display="block",c.getContext("2d").drawImage(n.getCompleteCanvas(l),0,0,o,s);var u=document.createElement("div"),h={element:u},d=0;u.innerHTML=(0,a.LANG)("filter-rotate-description")+"<br/><br/>";var p=document.createElement("button");p.innerHTML="<span style='font-size: 1.3em'>⟳</span> 90°";var g=document.createElement("button");g.innerHTML="<span style='font-size: 1.3em'>⟲</span> 90°",g.style.marginRight="5px",p.onclick=function(){d+=90,t()},g.onclick=function(){d-=90,t()},u.appendChild(g),u.appendChild(p);var f=document.createElement("div");i.BB.css(f,{width:"340px",marginLeft:"-20px",height:"220px",display:"table",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",colorScheme:"only light"});var m=document.createElement("div");m.style.display="table-cell",m.style.verticalAlign="middle";var v=i.BB.appendTextDiv(m,"");return v.appendChild(c),f.appendChild(m),v.style.width=o+"px",v.style.height=s+"px",v.style.marginLeft="auto",v.style.marginRight="auto",v.style.boxShadow="0 0 5px rgba(0,0,0,0.8)",v.style.overflow="hidden",i.BB.createCheckerDataUrl(4,(function(e){v.style.background="url("+e+")"})),v.style.transition="all 0.2s ease-out",u.appendChild(f),t(),h.getInput=function(){return{deg:d}},h},apply:function(e){var t=e.klCanvas,n=e.history,r=e.input.deg;return!(!t||!n)&&(n.pause(!0),t.rotate(r),n.pause(!1),n.push({tool:["filter","rotate"],action:"apply",params:[{input:e.input}]}),!0)}}})),r.register("lhchB",(function(e,n){t(e.exports,"filterTiltShift",(function(){return u}));var i=r("eWjiX"),a=r("cH2YE"),o=r("llzZ0"),s=r("i5nyl"),l=r("5RaQo"),c=r("1mH1z"),u={getDialog:function(e){var t=e.context,n=e.klCanvas;if(!t||!n)return!1;var r=n.getLayers(),u=n.getLayerIndex(t.canvas),h=i.BB.fitInto(t.canvas.width,t.canvas.height,280,200,1),d=parseInt(""+h.width),p=parseInt(""+h.height),g=Math.min(d,t.canvas.width),f=Math.min(p,t.canvas.height),m=i.BB.canvas(g,f),v=m.getContext("2d");v.save(),g>t.canvas.width&&(v.imageSmoothingEnabled=!1),v.drawImage(t.canvas,0,0,g,f),v.restore();var y=g/t.canvas.width,x=d/t.canvas.width,b=document.createElement("div"),B={element:b},w=[];return setTimeout((function(){var e=20,t=200;b.innerHTML=(0,c.LANG)("filter-tilt-shift-description")+"<br/><br/>";var n=(0,l.getSharedFx)();if(n){var h,g,f=n.texture(m);n.draw(f).update(),h=I(parseInt(""+d/6),parseInt(""+p/2)),g=I(parseInt(""+(d-d/6)),parseInt(""+(p-p/3)));var v=new(0,o.KlSlider)({label:(0,c.LANG)("filter-tilt-shift-blur"),width:300,height:30,min:0,max:200,value:e,eventResMs:a.eventResMs,onChange:function(t){e=t,M()}});v.getElement().style.marginBottom="10px",b.appendChild(v.getElement());var C=new(0,o.KlSlider)({label:(0,c.LANG)("filter-tilt-shift-gradient"),width:300,height:30,min:0,max:1e3,value:t,eventResMs:a.eventResMs,onChange:function(e){t=e,M()}});b.appendChild(C.getElement());var S=document.createElement("div");S.oncontextmenu=function(){return!1},i.BB.css(S,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var k=[],L=0;L<r.length;L++)k.push({image:L===u?n:r[L].context.canvas,opacity:r[L].opacity,mixModeStr:r[L].mixModeStr});var T=new(0,s.KlCanvasPreview)({width:parseInt(""+d),height:parseInt(""+p),layers:k}),E=i.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+d)+"px",height:parseInt(""+p)+"px"}});E.appendChild(T.getElement()),S.appendChild(E),E.appendChild(h),E.appendChild(g),b.appendChild(S),M(),B.destroy=function(){for(var e=0;e<w.length;e++)w[e].destroy();v.destroy(),C.destroy(),f.destroy()},B.getInput=function(){return B.destroy(),{a:{x:h.x/x,y:h.y/x},b:{x:g.x/x,y:g.y/x},blur:e,gradient:t}}}function M(){try{n.draw(f).tiltShift(h.x/x*y,h.y/x*y,g.x/x*y,g.y/x*y,e*y,t*y).update(),T.render()}catch(e){b.errorCallback(e)}}function I(e,t){var n=i.BB.el({css:{width:"14px",height:"14px",backgroundColor:"#fff",boxShadow:"inset 0 0 0 2px #000",borderRadius:"14px",position:"absolute",cursor:"move",left:e-7+"px",top:t-7+"px",userSelect:"none",touchAction:"none"}});n.x=e,n.y=t;var r=new i.BB.PointerListener({target:n,maxPointers:1,onPointer:function(e){e.eventPreventDefault(),"left"===e.button&&"pointermove"===e.type&&(n.x+=e.dX,n.y+=e.dY,n.style.left=n.x-7+"px",n.style.top=n.y-7+"px",M())}});return w.push(r),n}}),1),B},apply:function(e){var t=e.context,n=e.history,r=e.input.a,i=e.input.b,a=e.input.blur,o=e.input.gradient;if(!t||!n)return!1;n.pause(!0);var s=(0,l.getSharedFx)();if(!s)return!1;var c=s.texture(t.canvas);return s.draw(c).tiltShift(r.x,r.y,i.x,i.y,a,o).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(s,0,0),c.destroy(),n.pause(!1),n.push({tool:["filter","tiltShift"],action:"apply",params:[{input:e.input}]}),!0}}})),r.register("lXpcU",(function(e,n){t(e.exports,"filterTransform",(function(){return u}));var i=r("eWjiX"),a=r("lXqiv"),o=r("i5nyl"),s=r("cNhNm"),l=r("21VAD"),c=r("1mH1z"),u={getDialog:function(e){var t,n=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(d){var t=d.getTransform();if(JSON.stringify(t)!==re||e){re=JSON.stringify(t),B<1&&(t.x*=B,t.y*=B,t.width*=B,t.height*=B);var n=ee[f].image,r=n.getContext("2d");r.save(),r.clearRect(0,0,n.width,n.height),i.BB.drawTransformedImageWithBounds(r,g[f].context.canvas,t,w,"pixelated"===Z.getValue()||i.BB.testShouldPixelate(t,t.width/T.width,t.height/T.height)),r.restore(),ie.render()}}},r=function(){d.setPos({x:parseInt(D.value)+T.x,y:parseInt(O.value)+T.y}),d.setAngleDeg(parseInt(N.value)),n()},u=e.context,h=e.klCanvas;if(!u||!h)return!1;var d,p=window.innerWidth<550,g=h.getLayers(),f=h.getLayerIndex(u.canvas),m=i.BB.fitInto(u.canvas.width,u.canvas.height,p?280:490,p?200:240,1),v=parseInt(""+m.width),y=parseInt(""+m.height),x=Math.min(v,u.canvas.width),b=Math.min(y,u.canvas.height),B=v/u.canvas.width,w={x:0,y:0,width:0,height:0},C={x1:null,y1:null,x2:null,y2:null},S=u.getImageData(0,0,u.canvas.width,u.canvas.height);if(S.data[3]>0&&S.data[S.data.length-1]>0)C.x1=0,C.y1=0,C.x2=u.canvas.width-1,C.y2=u.canvas.height-1;else for(t=3;t<S.data.length;t+=4)if(S.data[t]>0){var k=(t-3)/4%u.canvas.width,L=Math.floor((t-3)/4/u.canvas.width);(C.x1>k||null===C.x1)&&(C.x1=k),null===C.y1&&(C.y1=L),(C.x2<k||null===C.x2)&&(C.x2=k),(C.y2<L||null===C.y2)&&(C.y2=L)}if(null===C.x1||null===C.y1)return alert((0,c.LANG)("filter-transform-empty")),!1;w.x=C.x1,w.y=C.y1,w.width=C.x2-C.x1+1,w.height=C.y2-C.y1+1;var T={x:w.x+w.width/2,y:w.y+w.height/2,width:w.width,height:w.height,angleDeg:0},E=document.createElement("div"),M={element:E};p||(M.width=500),E.innerHTML=(0,c.LANG)("filter-transform-description");var I=new i.BB.KeyListener({onDown:function(e){i.BB.isInputFocused(!0)||("left"===e&&(D.value=""+(parseFloat(D.value)-1),r()),"right"===e&&(D.value=""+(parseFloat(D.value)+1),r()),"up"===e&&(O.value=""+(parseFloat(O.value)-1),r()),"down"===e&&(O.value=""+(parseFloat(O.value)+1),r()))}}),A=document.createElement("div"),R=document.createElement("div"),P=document.createElement("div"),O=document.createElement("input"),D=document.createElement("input"),N=document.createElement("input");(A.style.width="100px",A.style.height="30px",R.style.width="100px",R.style.height="30px",R.style.display="inline-block",A.style.display="inline-block",P.style.display="inline-block",P.style.width="150px",P.style.height="30px",O.type="number",D.type="number",N.type="number",D.style.width="70px",O.style.width="70px",N.style.width="70px",O.value="0",D.value="0",N.value="0",O.onclick=function(){this.focus(),r()},D.onclick=function(){this.focus(),r()},N.onclick=function(){this.focus(),r()},O.onchange=function(){r()},D.onchange=function(){r()},N.onchange=function(){r()},O.onkeyup=function(){r()},D.onkeyup=function(){r()},N.onkeyup=function(){r()},A.append("X: ",D),R.append("Y: ",O),P.append((0,c.LANG)("filter-transform-rotation")+": ",N),p)||i.BB.el({parent:E,css:{marginTop:"10px"}}).append(A,R,P);var z={marginLeft:"10px",marginTop:"10px"},G=i.BB.el({parent:E,css:{display:"flex",flexWrap:"wrap",marginLeft:"-10px"}}),j=i.BB.el({parent:G,tagName:"button",content:(0,c.LANG)("filter-transform-flip")+" X",onClick:function(){var e=d.getTransform();d.setSize(-e.width,e.height)},css:z}),H=i.BB.el({parent:G,tagName:"button",content:(0,c.LANG)("filter-transform-flip")+" Y",onClick:function(){var e=d.getTransform();d.setSize(e.width,-e.height)},css:z}),X=i.BB.el({parent:G,tagName:"button",content:"-90°",onClick:function(){var e=d.getTransform();e.angleDeg-=90,e.angleDeg%=360,d.setAngleDeg(e.angleDeg),N.value=""+Math.round(e.angleDeg),n()},css:z}),F=i.BB.el({parent:G,tagName:"button",content:"+90°",onClick:function(){var e=d.getTransform();e.angleDeg+=90,e.angleDeg%=360,d.setAngleDeg(e.angleDeg),N.value=""+Math.round(e.angleDeg),n()},css:z}),U=i.BB.el({parent:G,tagName:"button",content:"2x",onClick:function(){var e=d.getTransform();Y.getValue()?d.setSize(d.getRatio()*e.height*2,2*e.height):d.setSize(2*e.width,2*e.height)},css:z}),K=i.BB.el({parent:G,tagName:"button",content:"1/2x",onClick:function(){var e=d.getTransform();d.setSize(Math.round(e.width/2),Math.round(e.height/2))},css:z}),V=i.BB.el({parent:G,tagName:"button",content:(0,c.LANG)("center"),onClick:function(){var e=d.getTransform();d.setPos({x:u.canvas.width/2,y:u.canvas.height/2}),d.setAngleDeg(e.angleDeg),n()},css:z}),W=!0,Y=new(0,a.Checkbox)({init:!0,label:(0,c.LANG)("filter-transform-constrain"),title:(0,c.LANG)("constrain-proportions"),allowTab:!0,callback:function(e){W=e,d.setConstrained(W)},css:{display:"inline-block"}}),_=!1,q=new(0,a.Checkbox)({init:!0,label:(0,c.LANG)("filter-transform-snap"),title:(0,c.LANG)("filter-transform-snap-title"),allowTab:!0,callback:function(e){_=e,d.setSnapping(_)},css:{display:"inline-block",marginLeft:"10px"}}),Q=i.BB.el({});Q.append(Y.getElement(),q.getElement()),E.appendChild(i.BB.el({css:{clear:"both",height:"10px"}}));var J=i.BB.el({parent:E,css:{display:"flex",justifyContent:"space-between"}}),Z=new(0,l.Select)({isFocusable:!0,optionArr:[["smooth",(0,c.LANG)("algorithm-smooth")],["pixelated",(0,c.LANG)("algorithm-pixelated")]],initValue:"smooth",title:(0,c.LANG)("scaling-algorithm"),onChange:function(){n(!0)}});J.append(Q,Z.getElement());var $=document.createElement("div");$.oncontextmenu=function(){return!1},i.BB.css($,{width:p?"340px":"540px",marginLeft:"-20px",height:p?"260px":"300px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var ee=[],te=0;te<g.length;te++){var ne=void 0;if(te===f)(ne=i.BB.canvas(parseInt(""+x),parseInt(""+b))).getContext("2d").drawImage(g[te].context.canvas,0,0,ne.width,ne.height);else ne=g[te].context.canvas;ee.push({image:ne,opacity:g[te].opacity,mixModeStr:g[te].mixModeStr})}var re,ie=new(0,o.KlCanvasPreview)({width:parseInt(""+v),height:parseInt(""+y),layers:ee}),ae=i.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+v)+"px",height:parseInt(""+y)+"px"}});return ae.appendChild(ie.getElement()),$.appendChild(ae),d=new(0,s.FreeTransform)({x:T.x,y:T.y,width:T.width,height:T.height,angleDeg:T.angleDeg,isConstrained:!0,snapX:[0,u.canvas.width],snapY:[0,u.canvas.height],callback:function(e){D.value=""+Math.round(e.x-T.x),O.value=""+Math.round(e.y-T.y),N.value=""+Math.round(e.angleDeg),n()},scale:B}),i.BB.css(d.getElement(),{position:"absolute",left:"0",top:"0"}),ae.appendChild(d.getElement()),n(),E.appendChild($),M.destroy=function(){I.destroy(),d.destroy(),Y.destroy(),q.destroy(),i.BB.destroyEl(j),i.BB.destroyEl(H),i.BB.destroyEl(X),i.BB.destroyEl(F),i.BB.destroyEl(U),i.BB.destroyEl(K),i.BB.destroyEl(V)},M.getInput=function(){var e=d.getTransform(),t={transform:e,bounds:w,isPixelated:"pixelated"===Z.getValue()||i.BB.testShouldPixelate(e,e.width/T.width,e.height/T.height)};return M.destroy(),JSON.parse(JSON.stringify(t))},M},apply:function(e){var t=e.context,n=e.history;if(!t||!n)return!1;n.pause(!0);var r=e.input,a=i.BB.copyCanvas(t.canvas);return t.clearRect(0,0,t.canvas.width,t.canvas.height),i.BB.drawTransformedImageWithBounds(t,a,r.transform,r.bounds,r.isPixelated),n.pause(!1),n.push({tool:["filter","transform"],action:"apply",params:[{input:r}]}),!0}}})),r.register("1CjeM",(function(e,n){t(e.exports,"filterBlur",(function(){return u}));var i=r("eWjiX"),a=r("llzZ0"),o=r("cH2YE"),s=r("i5nyl"),l=r("5RaQo"),c=r("1mH1z"),u={getDialog:function(e){var t=e.klCanvas,n=e.context;if(!t||!n)return!1;var r=t.getLayers(),u=t.getLayerIndex(n.canvas),h=i.BB.fitInto(n.canvas.width,n.canvas.height,280,200,1),d=parseInt(""+h.width),p=parseInt(""+h.height),g=Math.min(d,n.canvas.width),f=Math.min(p,n.canvas.height),m=i.BB.canvas(g,f),v=m.getContext("2d");v.save(),g>n.canvas.width&&(v.imageSmoothingEnabled=!1),v.drawImage(n.canvas,0,0,g,f),v.restore();var y=g/n.canvas.width,x=document.createElement("div"),b={element:x};return setTimeout((function(){var e=10;x.innerHTML=(0,c.LANG)("filter-triangle-blur-description")+"<br/><br/>";var t=(0,l.getSharedFx)();if(t){var n=t.texture(m);t.draw(n).update();var h=new(0,a.KlSlider)({label:(0,c.LANG)("radius"),width:300,height:30,min:1,max:200,value:e,eventResMs:o.eventResMs,onChange:function(r){e=r,t.draw(n).triangleBlur(e*y).update(),B.render()}});x.appendChild(h.getElement());var g=document.createElement("div");i.BB.css(g,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var f=[],v=0;v<r.length;v++)f.push({image:v===u?t:r[v].context.canvas,opacity:r[v].opacity,mixModeStr:r[v].mixModeStr});var B=new(0,s.KlCanvasPreview)({width:parseInt(""+d),height:parseInt(""+p),layers:f}),w=i.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+d)+"px",height:parseInt(""+p)+"px"}});w.appendChild(B.getElement()),g.appendChild(w),x.appendChild(g);try{t.draw(n).triangleBlur(e*y).update(),B.render()}catch(e){x.errorCallback(e)}b.destroy=function(){n.destroy(),h.destroy()},b.getInput=function(){return b.destroy(),{radius:e}}}}),1),b},apply:function(e){var t=e.context,n=e.history,r=e.input.radius;if(!t||!r||!n)return!1;n.pause(!0);var i=(0,l.getSharedFx)();if(!i)return!1;var a=i.texture(t.canvas);return i.draw(a).triangleBlur(r).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(i,0,0),a.destroy(),n.pause(!1),n.push({tool:["filter","blur"],action:"apply",params:[{input:e.input}]}),!0}}})),r.register("dNWKZ",(function(e,n){t(e.exports,"filterUnsharpMask",(function(){return u}));var i=r("eWjiX"),a=r("cH2YE"),o=r("llzZ0"),s=r("i5nyl"),l=r("5RaQo"),c=r("1mH1z"),u={getDialog:function(e){var t=e.context,n=e.klCanvas;if(!t||!n)return!1;var r=n.getLayers(),u=n.getLayerIndex(t.canvas),h=i.BB.fitInto(t.canvas.width,t.canvas.height,280,200,1),d=parseInt(""+h.width),p=parseInt(""+h.height),g=Math.min(d,t.canvas.width),f=Math.min(p,t.canvas.height),m=i.BB.canvas(g,f),v=m.getContext("2d");v.save(),g>t.canvas.width&&(v.imageSmoothingEnabled=!1),v.drawImage(t.canvas,0,0,g,f),v.restore();var y=g/t.canvas.width,x=document.createElement("div"),b={element:x};return setTimeout((function(){var e=2,t=.51;x.innerHTML=(0,c.LANG)("filter-unsharp-mask-description")+"<br/><br/>";var n=(0,l.getSharedFx)();if(n){var h=n.texture(m);n.draw(h).update();var g=new(0,o.KlSlider)({label:(0,c.LANG)("radius"),width:300,height:30,min:0,max:200,value:2,eventResMs:a.eventResMs,onChange:function(r){e=r,n.draw(h).unsharpMask(e*y,t).update(),C.render()},curve:[[0,0],[.1,2],[.5,50],[1,200]]}),f=new(0,o.KlSlider)({label:(0,c.LANG)("filter-unsharp-mask-strength"),width:300,height:30,min:0,max:50,value:5.1,eventResMs:a.eventResMs,onChange:function(r){t=r/10,n.draw(h).unsharpMask(e*y,t).update(),C.render()},curve:[[0,0],[.1,2],[.5,10],[1,50]]});g.getElement().style.marginBottom="10px",x.appendChild(g.getElement()),x.appendChild(f.getElement());var v=document.createElement("div");i.BB.css(v,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var B=[],w=0;w<r.length;w++)B.push({image:w===u?n:r[w].context.canvas,opacity:r[w].opacity,mixModeStr:r[w].mixModeStr});var C=new(0,s.KlCanvasPreview)({width:parseInt(""+d),height:parseInt(""+p),layers:B}),S=i.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+d)+"px",height:parseInt(""+p)+"px"}});S.appendChild(C.getElement()),v.appendChild(S),x.appendChild(v);try{n.draw(h).unsharpMask(e*y,t).update(),C.render()}catch(e){x.errorCallback(e)}b.destroy=function(){g.destroy(),f.destroy(),h.destroy()},b.getInput=function(){return b.destroy(),{radius:e,strength:t}}}}),1),b},apply:function(e){var t=e.context,n=e.history,r=e.input.radius,i=e.input.strength;if(!t||null===r||null===i||!n)return!1;n.pause(!0);var a=(0,l.getSharedFx)();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).unsharpMask(r,i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),n.pause(!1),n.push({tool:["filter","unsharpMask"],action:"apply",params:[{input:e.input}]}),!0}}})),r.register("94Tq7",(function(e,n){t(e.exports,"filterToAlpha",(function(){return u}));var i=r("eWjiX"),a=r("iskOY"),o=r("9A7OD"),s=r("i5nyl"),l=r("5RaQo"),c=r("1mH1z"),u={getDialog:function(e){var t=e.context,n=e.klCanvas;if(!t||!n)return!1;var r=n.getLayers(),u=n.getLayerIndex(t.canvas),h=i.BB.fitInto(t.canvas.width,t.canvas.height,280,200,1),d=parseInt(""+h.width),p=parseInt(""+h.height),g=i.BB.canvas(d,p),f=g.getContext("2d");f.save(),g.width>t.canvas.width&&(f.imageSmoothingEnabled=!1),f.drawImage(t.canvas,0,0,d,p),f.restore();var m=document.createElement("div"),v={element:m};return setTimeout((function(){m.appendChild(i.BB.el({content:(0,c.LANG)("filter-to-alpha-description"),css:{marginBottom:"5px"}}));var t=(0,l.getSharedFx)();if(t){var n=t.texture(g);t.draw(n).update();var h="inverted-luminance",f=new(0,a.Options)({optionArr:[{id:"inverted-luminance",label:(0,c.LANG)("filter-to-alpha-inverted-lum")},{id:"luminance",label:(0,c.LANG)("filter-to-alpha-lum")}],initialId:h,onChange:function(e){h=e,L()}});m.appendChild(f.getElement());var y={r:0,g:0,b:0,a:1},x=[null,{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];x.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),x.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1});var b=new(0,o.ColorOptions)({label:(0,c.LANG)("filter-to-alpha-replace"),colorArr:x,initialIndex:1,onChange:function(e){y=e,L()}});b.getElement().style.marginTop="10px",m.appendChild(b.getElement());var B=document.createElement("div");i.BB.css(B,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var w=[],C=0;C<r.length;C++)w.push({image:C===u?t:r[C].context.canvas,opacity:r[C].opacity,mixModeStr:r[C].mixModeStr});var S=new(0,s.KlCanvasPreview)({width:parseInt(""+d),height:parseInt(""+p),layers:w}),k=i.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+d)+"px",height:parseInt(""+p)+"px"}});k.appendChild(S.getElement()),B.appendChild(k),m.appendChild(B),setTimeout((function(){try{L()}catch(e){m.errorCallback(e)}}),1),v.destroy=function(){n.destroy(),f.destroy()},v.getInput=function(){return v.destroy(),{sourceId:h,selectedRgbaObj:y}}}function L(){t.draw(n).toAlpha("inverted-luminance"===h,y).update(),S.render()}}),1),v},apply:function(e){var t=e.context,n=e.history,r=e.input.sourceId,i=e.input.selectedRgbaObj;if(!t||!r||!n)return!1;n.pause(!0);var a=(0,l.getSharedFx)();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).toAlpha("inverted-luminance"===r,i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),n.pause(!1),n.push({tool:["filter","toAlpha"],action:"apply",params:[{input:e.input}]}),!0}}})),r.register("d8Fqy",(function(e,n){t(e.exports,"filterGrid",(function(){return u}));var i=r("eWjiX"),a=r("i5nyl"),o=r("1mH1z"),s=r("c4LUw"),l=r("9A7OD"),c=r("1xi6g"),u={getDialog:function(e){var t=function(){var e=A.image.getContext("2d");e.save(),e.clearRect(0,0,f,m),e.drawImage(n.canvas,0,0,f,m),(0,c.drawGrid)(e,b.x,b.y,Math.max(b.thickness*v,1),b.color,b.opacity),e.restore(),R.render()},n=e.context,r=e.klCanvas;if(!n||!r)return!1;var u=r.getLayers(),h=r.getLayerIndex(n.canvas),d=i.BB.fitInto(n.canvas.width,n.canvas.height,280,200,1),p=parseInt(""+d.width),g=parseInt(""+d.height),f=Math.min(p,n.canvas.width),m=Math.min(g,n.canvas.height),v=f/n.canvas.width,y=document.createElement("div"),x={element:y};y.innerHTML=(0,o.LANG)("filter-grid-description")+"<br/><br/>";var b={x:2,y:2,thickness:2,color:"#000",opacity:1},B=i.BB.el({parent:y,css:{display:"flex",alignItems:"center"}}),w=i.BB.el({parent:y,css:{display:"flex",alignItems:"center",marginTop:"10px"}}),C=(0,s.input)({init:2,type:"number",min:1,css:{width:"75px",marginRight:"20px"},callback:function(e){b.x=parseFloat(e),t()}}),S=(0,s.input)({init:2,type:"number",min:1,css:{width:"75px",marginRight:"20px"},callback:function(e){b.y=parseFloat(e),t()}}),k=(0,s.input)({init:2,type:"number",min:1,css:{width:"75px",marginRight:"20px"},callback:function(e){b.thickness=parseFloat(e),t()}}),L={r:0,g:0,b:0,a:1},T=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];T.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),T.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1}),b.color=i.BB.ColorConverter.toRgbStr(L);var E=new(0,l.ColorOptions)({label:(0,o.LANG)("shape-stroke"),colorArr:T,onChange:function(e){L=e,b.color=i.BB.ColorConverter.toRgbStr(L),t()}}),M={display:"inline-block",marginRight:"5px"};B.append(i.BB.el({content:"X:",css:M}),C,i.BB.el({content:"Y:",css:M}),S),w.append(i.BB.el({content:(0,o.LANG)("brush-size")+":",css:M}),k,i.BB.el({css:{flexGrow:"1"}}),E.getElement());var I=document.createElement("div");i.BB.css(I,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});var A={image:i.BB.canvas(f,m),opacity:u[h].opacity,mixModeStr:u[h].mixModeStr},R=new(0,a.KlCanvasPreview)({width:Math.round(p),height:Math.round(g),layers:u.map((function(e,t){return t===h?A:{image:e.context.canvas,opacity:e.opacity,mixModeStr:e.mixModeStr}}))}),P=i.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+p)+"px",height:parseInt(""+g)+"px"}});return P.appendChild(R.getElement()),I.appendChild(P),setTimeout(t,0),y.appendChild(I),x.destroy=function(){},x.getInput=function(){return x.destroy(),i.BB.copyObj(b)},x},apply:function(e){var t=e.context,n=e.klCanvas,r=e.history;return!!(t&&n&&r)&&(r.pause(!0),(0,c.drawGrid)(t,e.input.x,e.input.y,e.input.thickness,e.input.color,e.input.opacity),r.pause(!1),r.push({tool:["filter","grid"],action:"apply",params:[{input:e.input}]}),!0)}}})),r.register("1xi6g",(function(e,n){function r(e,t,n,r,i,a){e.save();var o=e.canvas.width,s=e.canvas.height,l=(r=Math.round(r))%2==0;e.beginPath(),e.lineWidth=r,e.strokeStyle=i,e.globalAlpha=a;for(var c=0;c<t-1;c++){var u=o/t*(c+1);u=l?Math.round(u):Math.round(u+.5)-.5,e.moveTo(u,0),e.lineTo(u,s)}for(var h=0;h<n-1;h++){var d=s/n*(h+1);d=l?Math.round(d):Math.round(d+.5)-.5,e.moveTo(0,d),e.lineTo(o,d)}e.stroke(),e.restore()}t(e.exports,"drawGrid",(function(){return r}))})),r.register("gtdB1",(function(e,n){t(e.exports,"filterNoise",(function(){return y}));var i=r("eWjiX"),a=r("i5nyl"),o=r("1mH1z"),s=r("llzZ0"),l=r("5RaQo"),c=r("iskOY"),u=r("cH2YE"),h=r("21VAD"),d=r("bBcC4"),p=r("hrnUX"),g=r("dJ1E2"),f=r("lXqiv"),m=[{type:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0,octaves:1,samples:1,peaks:0,brightness:0,contrast:0,doInvert:!0},{type:1,scaleX:166,scaleY:164,offsetX:105,offsetY:30,octaves:6,samples:1,peaks:0,brightness:.055,contrast:.23,doInvert:!0},{type:1,scaleX:235,scaleY:190,offsetX:3227,offsetY:2156,octaves:4,samples:16,peaks:22,brightness:-.375,contrast:1,doInvert:!1},{type:1,scaleX:40,scaleY:40,offsetX:0,offsetY:0,octaves:1,samples:1,peaks:0,brightness:0,contrast:0,doInvert:!1},{type:0,scaleX:26,scaleY:26,offsetX:557,offsetY:365,octaves:1,samples:1,peaks:0,brightness:.02,contrast:1,doInvert:!0},{type:1,scaleX:1500,scaleY:1500,offsetX:745,offsetY:2871,octaves:5,samples:16,peaks:156.02,brightness:.03,contrast:1,doInvert:!0},{type:1,scaleX:11,scaleY:11,offsetX:2940,offsetY:2045,octaves:1,samples:16,peaks:1,brightness:-.045,contrast:1,doInvert:!0},{type:2,scaleX:74,scaleY:74,offsetX:4816,offsetY:1304,octaves:3,samples:1,peaks:2.78,brightness:0,contrast:0,doInvert:!1}];function v(e,t){e.noise(t.seed?t.seed:0,t.type,[t.scaleX,t.scaleY],[e.width/2,e.height/2],t.octaves,t.samples,t.peaks,t.brightness,t.contrast,t.doInvert,t.colA,t.colB,t.channels?t.channels:"rgb").update()}var y={getDialog:function(e){var t=function(){var e=_.image.getContext("2d");e.save(),e.clearRect(0,0,C,S),e.drawImage(n.canvas,0,0,C,S),e.globalAlpha=O.opacity;var t=i.BB.copyObj(m[O.presetIndex]);t.seed=O.seed,t.scaleX=t.scaleX*O.scale/50*k,t.scaleY=t.scaleY*O.scale/50*k,t.colA=O.colA,t.colB=O.colB,t.doInvert=O.doInvert?!t.doInvert:t.doInvert,t.channels=O.channels,v(L,t),"alpha"===O.channels?e.globalCompositeOperation="destination-out":e.globalCompositeOperation=O.mixModeStr,e.drawImage(L,0,0),e.restore(),q.render()},n=e.context,r=e.klCanvas;if(!n||!r)return!1;var y=r.getLayers(),x=r.getLayerIndex(n.canvas),b=i.BB.fitInto(n.canvas.width,n.canvas.height,280,200,1),B=parseInt(""+b.width),w=parseInt(""+b.height),C=Math.min(B,n.canvas.width),S=Math.min(w,n.canvas.height),k=C/n.canvas.width,L=(0,l.getSharedFx)();if(L){var T,E=[],M=i.BB.canvas(32,32),I=M.getContext("2d");T=L.texture(M),L.draw(T).update(),T.destroy(),m.forEach((function(e,t){var n=new Image,r=i.BB.copyObj(e);r.scaleX/=10,r.scaleY/=10,v(L,r),I.drawImage(L,0,0),n.src=M.toDataURL("image/png"),E.push(n)}));var A=i.BB.canvas(C,S);T=L.texture(A),L.draw(T).update(),A=null;var R=document.createElement("div"),P={element:R};R.innerHTML=(0,o.LANG)("filter-noise-description")+"<br/><br/>";var O={seed:300*Math.random(),presetIndex:0,scale:50,opacity:.5,doInvert:!1,channels:"rgb",mixModeStr:"source-over",colA:{r:0,g:0,b:0},colB:{r:255,g:255,b:255}},D=new(0,c.Options)({optionArr:E.map((function(e,t){return i.BB.css(e,{margin:"1px",borderRadius:"3px",transition:"all 0.1s ease-in-out"}),{id:""+t,label:e}})),initialId:"0",onChange:function(e){O.presetIndex=Number(e),t()}});D.getElement().style.marginBottom="10px",R.append(D.getElement());var N=new(0,s.KlSlider)({label:(0,o.LANG)("filter-noise-scale"),width:300,height:30,min:1,max:1e3,value:O.scale,eventResMs:u.eventResMs,curve:i.BB.quadraticSplineInput(1,1e3,.1),onChange:function(e){O.scale=e,t()}});N.getElement().style.marginBottom="10px";var z=new(0,s.KlSlider)({label:(0,o.LANG)("opacity"),width:300,height:30,min:.01,max:1,value:O.opacity,eventResMs:u.eventResMs,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e},onChange:function(e){O.opacity=e,t()}});z.getElement().style.marginBottom="10px";var G=i.BB.el({css:{display:"flex",alignItems:"center",marginBottom:"10px"}}),j=i.BB.el({css:{display:"flex"}}),H=new(0,c.Options)({optionArr:[{id:"rgb",label:"RGB"},{id:"alpha",label:(0,o.LANG)("filter-noise-alpha")}],initialId:"rgb",onChange:function(e){O.channels=e,j.style.visibility="rgb"===e?"":"hidden",t()}}),X=new(0,f.Checkbox)({label:(0,o.LANG)("filter-noise-inverted"),callback:function(e){O.doInvert=e,t()},allowTab:!0}),F=new(0,h.Select)({isFocusable:!0,optionArr:["source-over",null,"darken","multiply","color-burn",null,"lighten","screen","color-dodge",null,"overlay","soft-light","hard-light",null,"difference","exclusion",null,"hue","saturation","color","luminosity"].map((function(e){return e?[e,(0,d.translateBlending)(e)]:null})),initValue:O.mixModeStr,onChange:function(e){O.mixModeStr=e,t()}});F.getElement().title=(0,o.LANG)("layers-blending");var U=i.BB.el({css:{display:"flex"}}),K={width:"34px",height:"34px",marginRight:"5px"},V=p.KL.input({type:"color",init:"#"+g.ColorConverter.toHexString(O.colA),callback:function(e){O.colA=g.ColorConverter.hexToRGB(e),t()},css:K}),W=p.KL.input({type:"color",init:"#"+g.ColorConverter.toHexString(O.colB),callback:function(e){O.colB=g.ColorConverter.hexToRGB(e),t()},css:K});U.append(V,W),G.append(H.getElement(),i.BB.el({css:{flexGrow:"1"}}),X.getElement()),j.append(F.getElement(),i.BB.el({css:{flexGrow:"1"}}),U),R.append(N.getElement(),z.getElement(),G,j);var Y=document.createElement("div");i.BB.css(Y,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});var _={image:i.BB.canvas(C,S),opacity:y[x].opacity,mixModeStr:y[x].mixModeStr},q=new(0,a.KlCanvasPreview)({width:Math.round(B),height:Math.round(w),layers:y.map((function(e,t){return t===x?_:{image:e.context.canvas,opacity:e.opacity,mixModeStr:e.mixModeStr}}))}),Q=i.BB.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+B)+"px",height:parseInt(""+w)+"px"}});return Q.appendChild(q.getElement()),Y.appendChild(Q),setTimeout(t,0),R.appendChild(Y),P.destroy=function(){D.destroy(),N.destroy(),z.destroy(),X.destroy(),H.destroy(),T.destroy(),F.destroy()},P.getInput=function(){return P.destroy(),i.BB.copyObj(O)},P}},apply:function(e){var t=e.context,n=e.klCanvas,r=e.history;if(!t||!n||!r)return!1;r.pause(!0);var a=(0,l.getSharedFx)();if(!a)return!1;var o=a.texture(t.canvas);a.draw(o).update(),o.destroy();var s=e.input,c=i.BB.copyObj(m[s.presetIndex]);return c.seed=s.seed,c.scaleX=c.scaleX*s.scale/50,c.scaleY=c.scaleY*s.scale/50,c.colA=s.colA,c.colB=s.colB,c.doInvert=s.doInvert?!c.doInvert:c.doInvert,c.channels=s.channels,v(a,c),t.save(),t.globalAlpha=s.opacity,"alpha"===s.channels?t.globalCompositeOperation="destination-out":t.globalCompositeOperation=s.mixModeStr,t.drawImage(a,0,0),t.restore(),r.pause(!1),r.push({tool:["canvas"],action:"replaceLayer",params:[n.getLayerIndex(t.canvas),t.getImageData(0,0,t.canvas.width,t.canvas.height)]}),!0}}})),r.register("3WOmu",(function(n,i){t(n.exports,"klCanvasToPsdBlob",(function(){return l}));var a=r("3kC7t"),o=r("cijLd"),s=r("hrnUX");function l(e){return c.apply(this,arguments)}function c(){return(c=(0,a.default)(e(o).mark((function t(n){var i,a,l,c,u,h;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=n.getLayersFast(),a={width:n.getWidth(),height:n.getHeight(),children:[]},l=0;l<i.length;l++)c=i[l],a.children.push({name:c.name,opacity:c.opacity,canvas:c.canvas,blendMode:s.KL.PSD.blendKlToPsd(c.mixModeStr),left:0,top:0});return e.next=5,r("bxnoy");case 5:return u=e.sent,h=u.writePsdBuffer(a),e.abrupt("return",new Blob([h],{type:"application/octet-stream"}));case 8:case"end":return e.stop()}}),t)})))).apply(this,arguments)}})),r.register("eIlXd",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("k9Nks")})),r.register("23J3k",(function(e,t){e.exports=r("f6OTe").getBundleURL("dafOa")+r("2evKT").resolve("bBxqy")}))}();
//# sourceMappingURL=main-embed.00f99f72.js.map

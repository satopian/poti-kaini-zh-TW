{"mappings":"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","sources":["src/app/script/main-embed.ts","src/app/script/polyfills.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","src/app/script/app/kl-app.ts","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/klecks/ui/modals/popup.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/input/event-listener.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/base/base.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/math/math.ts","src/app/script/bb/input/event-chain.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","<<jsx-config-pragma.js>>","src/app/script/bb/base/local-storage.ts","node_modules/@parcel/runtime-js/lib/runtime-34832b43d0ebd3bf.js","node_modules/@parcel/runtime-js/lib/runtime-a96f6567e6dac4f3.js","src/app/script/klecks/ui/base-components/checkbox.ts","src/app/script/klecks/ui/base-components/input.ts","src/app/script/klecks/ui/base-components/select.ts","src/app/script/klecks/ui/base-components/image-toggle.ts","src/app/script/klecks/ui/base-components/image-radio-list.ts","src/app/script/klecks/ui/base-components/pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-065238818b5d6d26.js","src/app/script/klecks/ui/base-components/kl-slider.ts","src/app/script/klecks/ui/base-components/slider-falloff.ts","src/app/script/klecks/ui/base-components/kl-slider-manual-input.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-ce95b2abc71314b0.js","src/app/script/klecks/ui/base-components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-e7bece06ac3b91da.js","src/app/script/klecks/ui/base-components/kl-color-slider-small.ts","src/app/script/klecks/ui/base-components/point-slider.ts","src/app/script/klecks/ui/base-components/color-options.ts","src/app/script/klecks/ui/base-components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-76fc4a9796871f89.js","src/app/script/klecks/ui/modals/export-dialog-deprecated.ts","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/kl-layer-manager.ts","node_modules/@parcel/runtime-js/lib/runtime-9e9c6514323b50ff.js","node_modules/@parcel/runtime-js/lib/runtime-f141aefb87a862aa.js","node_modules/@parcel/runtime-js/lib/runtime-e93ed5f4a72fe388.js","node_modules/@parcel/runtime-js/lib/runtime-e1e96fa0dcd63695.js","node_modules/@parcel/runtime-js/lib/runtime-2d2417fe7f53ff5b.js","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/image-operations/gradient-tool.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-ce6158b179cda36d.js","node_modules/@parcel/runtime-js/lib/runtime-9180b336d2c14eb8.js","node_modules/@parcel/runtime-js/lib/runtime-e98ceba16f4f3e8c.js","node_modules/@parcel/runtime-js/lib/runtime-1c4e2d66dbd3cd26.js","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-7b1b46c773a5d5de.js","src/app/script/klecks/ui/components/free-transform-canvas.ts","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/components/fitted-image.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-c595ccae60beff87.js","node_modules/@parcel/runtime-js/lib/runtime-e5d7180bbee5b536.js","node_modules/@parcel/runtime-js/lib/runtime-6c52a4e8d76ec49b.js","node_modules/@parcel/runtime-js/lib/runtime-fa73233744fc505c.js","node_modules/@parcel/runtime-js/lib/runtime-b34e92e9fb9b8c68.js","node_modules/@parcel/runtime-js/lib/runtime-8a2022a1c05c8770.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-760df77bff0950f0.js","node_modules/@parcel/runtime-js/lib/runtime-ff3da4d7dabee86d.js","node_modules/@parcel/runtime-js/lib/runtime-182f547eb7376cf5.js","node_modules/@parcel/runtime-js/lib/runtime-297f8366ec2375c9.js","node_modules/@parcel/runtime-js/lib/runtime-d831990ac91a582d.js","node_modules/@parcel/runtime-js/lib/runtime-621488e8bcab6d4d.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-7355152122a84936.js","node_modules/@parcel/runtime-js/lib/runtime-81519c452bdfbaa9.js","node_modules/@parcel/runtime-js/lib/runtime-3fc59c96423b70ad.js","node_modules/@parcel/runtime-js/lib/runtime-1eef10cb07c9c851.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-b9f67aff2ffaa235.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-4486cf75fca81822.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-3ca3a85d3436a84f.js","src/app/script/klecks/ui/modals/text-tool-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-47401ec572d2cfcf.js","node_modules/@parcel/runtime-js/lib/runtime-6476cf999a0e75d3.js","node_modules/@parcel/runtime-js/lib/runtime-4ee49cef2a1bfd51.js","node_modules/@parcel/runtime-js/lib/runtime-01d9fe07522d7373.js","node_modules/@parcel/runtime-js/lib/runtime-8450ca7f4e68dde7.js","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-08ec85fc3ea564e8.js","node_modules/@parcel/runtime-js/lib/runtime-c105dce751d9b16c.js","node_modules/@parcel/runtime-js/lib/runtime-272cd0cc0051d99c.js","node_modules/@parcel/runtime-js/lib/runtime-d623cec3e031c802.js","node_modules/@parcel/runtime-js/lib/runtime-4aa563d1de55ad17.js","node_modules/@parcel/runtime-js/lib/runtime-acf5209c71eb3497.js","node_modules/@parcel/runtime-js/lib/runtime-726a62492af9f94e.js","node_modules/@parcel/runtime-js/lib/runtime-f1cff4f2714da535.js","node_modules/@parcel/runtime-js/lib/runtime-06b47f2ffca8a188.js","node_modules/@parcel/runtime-js/lib/runtime-866a2902b0cdf580.js","node_modules/@parcel/runtime-js/lib/runtime-3b4878106cdf1b9c.js","node_modules/@parcel/runtime-js/lib/runtime-02847deebefdd0a7.js","node_modules/@parcel/runtime-js/lib/runtime-3dce3f08da564a07.js","node_modules/@parcel/runtime-js/lib/runtime-0e43c74fde652ea0.js","node_modules/@parcel/runtime-js/lib/runtime-2d3b073eae8e5f9b.js","node_modules/@parcel/runtime-js/lib/runtime-679ef653bc7e04ce.js","node_modules/@parcel/runtime-js/lib/runtime-b88d84f511ba7b52.js","node_modules/@parcel/runtime-js/lib/runtime-032418d95d19e88c.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-f5fee83b55dfe524.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c1ff462122383f3a.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c362cafb743e4bf7.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-9083363aed84d015.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-72d61ca9dbc6379a.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-2e54934a27c8b910.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-a3466c6b7be08d45.js","src/app/script/klecks/ui/base-components/box-toggle.ts","src/app/script/klecks/ui/modals/show-iframe-popup.ts","src/app/script/klecks/ui/base-components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-174f5efa9e6f0131.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-257b8f01a8ca9ad6.js","src/app/script/klecks/storage/ag-psd-wrapper.ts","node_modules/@parcel/runtime-js/lib/runtime-5ea32053680ef652.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","node_modules/file-saver/src/FileSaver.js","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-3e3712af4386deba.js","node_modules/@parcel/runtime-js/lib/runtime-050615743b2088cc.js","node_modules/@parcel/runtime-js/lib/runtime-4135c6b241ed0f39.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/klecks/ui/tool-tabs/gradient-ui.ts","src/app/script/embed/toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/filter-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/klecks/filters/shared-gl-fx.ts","src/app/script-vendor/glfx.ts","src/app/script-vendor/shader-noise.glsl","src/app/script/klecks/filters/filter-crop-extend.ts","src/app/script/klecks/filters/filter-curves.ts","src/app/script/klecks/filters/filter-flip.ts","node_modules/@parcel/runtime-js/lib/runtime-0b614230dd5a2fbc.js","src/app/script/klecks/filters/filter-hue-saturation.ts","src/app/script/klecks/filters/filter-invert.ts","src/app/script/klecks/filters/filter-perspective.ts","src/app/script/klecks/ui/components/two-tabs.ts","src/app/script/klecks/filters/filter-resize.ts","node_modules/@parcel/runtime-js/lib/runtime-c388461235ee692d.js","src/app/script/klecks/filters/filter-rotate.ts","src/app/script/klecks/filters/filter-tilt-shift.ts","src/app/script/klecks/filters/filter-transform.ts","src/app/script/klecks/filters/filter-blur.ts","src/app/script/klecks/filters/filter-unsharp-mask.ts","src/app/script/klecks/filters/filter-to-alpha.ts","src/app/script/klecks/filters/filter-grid.ts","src/app/script/klecks/image-operations/draw-grid.ts","src/app/script/klecks/filters/filter-noise.ts","src/app/script/klecks/filters/filter-pattern.ts","src/app/script/klecks/filters/filter-distort.ts","src/app/script/klecks/filters/filter-vanish-point.ts","src/app/script/klecks/image-operations/draw-vanish-point.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","node_modules/@parcel/runtime-js/lib/runtime-fe04d655c2a3180f.js","node_modules/@parcel/runtime-js/lib/runtime-f15ea15a7900b9a3.js"],"sourcesContent":["import './polyfills';\r\nimport {KlApp} from './app/kl-app';\r\nimport {IKlProject} from './klecks/kl.types';\r\nimport {SaveReminder} from './klecks/ui/components/save-reminder';\r\nimport {klHistory} from './klecks/history/kl-history';\r\nimport {klPsdToKlProject, readPsd} from './klecks/storage/psd';\r\nimport {LANG} from './language/language';\r\n\r\nexport interface IEmbedParams {\r\n    project?: IKlProject,\r\n    psdBlob?: Blob,\r\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    embedUrl: string;\r\n    logoImg?: any;\r\n    bottomBar?: HTMLElement;\r\n    aboutEl?: HTMLElement;\r\n}\r\n\r\nexport interface IReadPSD {\r\n    blob: Blob;\r\n    callback: (k: IKlProject) => void;\r\n}\r\n\r\nexport function Embed(p: IEmbedParams) {\r\n\r\n    let isInitialized: boolean = false;\r\n    let klApp;\r\n    const psdQueue: IReadPSD[] = []; // queue of psds waiting while ag-psd is loading\r\n    let agPsd: any | 'error';\r\n\r\n    let loadingScreenEl = document.getElementById(\"loading-screen\");\r\n    let loadingScreenTextEl = document.getElementById(\"loading-screen-text\");\r\n    if (loadingScreenTextEl) {\r\n        loadingScreenTextEl.textContent = LANG('embed-init-waiting');\r\n    }\r\n\r\n    function onProjectReady(project: IKlProject) {\r\n        try {\r\n            if (isInitialized) {\r\n                throw new Error('Already called openProject');\r\n            }\r\n            isInitialized = true;\r\n\r\n            const saveReminder = new SaveReminder(\r\n                klHistory,\r\n                false,\r\n                false,\r\n                () => {},\r\n                () => klApp ? klApp.isDrawing() : false,\r\n                null,\r\n                null,\r\n            );\r\n            klApp = new KlApp(\r\n                project,\r\n                {\r\n                    saveReminder,\r\n                    bottomBar: p.bottomBar,\r\n                    aboutEl: p.aboutEl,\r\n                    embed: {\r\n                        url: p.embedUrl,\r\n                        onSubmit: p.onSubmit,\r\n                    }\r\n                }\r\n            );\r\n            saveReminder.init();\r\n\r\n            if (loadingScreenEl && loadingScreenEl.parentNode) {\r\n                loadingScreenEl.parentNode.removeChild(loadingScreenEl);\r\n            }\r\n            loadingScreenEl = null;\r\n            loadingScreenTextEl = null;\r\n\r\n            document.body.appendChild(klApp.getEl());\r\n        } catch (e) {\r\n            if (loadingScreenTextEl) {\r\n                loadingScreenTextEl.textContent = '❌ ' + e;\r\n            }\r\n            if (loadingScreenEl) {\r\n                loadingScreenEl.className += 'loading-screen-error';\r\n            }\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    if (p.project) {\r\n        onProjectReady(p.project);\r\n    }\r\n    this.openProject = onProjectReady;\r\n    this.initError = (error: string) => {\r\n        if (loadingScreenTextEl) {\r\n            loadingScreenTextEl.textContent = '❌ ' + error;\r\n        }\r\n        if (loadingScreenEl) {\r\n            loadingScreenEl.className += 'loading-screen-error';\r\n        }\r\n    };\r\n    this.getPNG = (): Blob => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return klApp.getPNG();\r\n    };\r\n    this.getPSD = async (): Promise<Blob> => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return await klApp.getPSD();\r\n    };\r\n    this.readPSDs = (psds: IReadPSD[]) => {\r\n        if (psds.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const readItem = (item: IReadPSD) => {\r\n            try {\r\n                const psd = agPsd.readPsd(item.blob);\r\n                const project = klPsdToKlProject(readPsd(psd));\r\n                item.callback(project);\r\n            } catch (e) {\r\n                console.error('failed to read psd', e);\r\n                item.callback(null);\r\n            }\r\n        };\r\n\r\n        if (!agPsd) {\r\n            if (psdQueue.length === 0) {\r\n                // load ag-psd\r\n                (async () => {\r\n                    try {\r\n                        agPsd = await import('ag-psd');\r\n                    } catch (e) {\r\n                        agPsd = 'error';\r\n                    }\r\n                    while (psdQueue.length) {\r\n                        readItem(psdQueue.shift());\r\n                    }\r\n                })();\r\n            }\r\n            psds.forEach(item => {\r\n                psdQueue.push(item);\r\n            });\r\n        } else {\r\n            psds.forEach(readItem);\r\n        }\r\n    };\r\n}","// import 'core-js';\r\nimport 'mdn-polyfills/Node.prototype.append';\r\nimport 'mdn-polyfills/Node.prototype.prepend';\r\nimport 'mdn-polyfills/String.prototype.padStart';\r\n\r\nif (!('scrollTo' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollTo', {\r\n        value: function (x, y) {\r\n            this.scrollLeft = x;\r\n            this.scrollTop = y;\r\n        }\r\n    });\r\n}\r\n\r\nif (!('scrollBy' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollBy', {\r\n        value: function (x, y) {\r\n            this.scrollLeft += x;\r\n            this.scrollTop += y;\r\n        }\r\n    });\r\n}\r\n\r\n// sometimes Android WebView has no localStorage\r\nif (!('localStorage' in window)) {\r\n    try {\r\n        window['localStorage'] = {\r\n            getItem: () => null,\r\n            setItem: () => {},\r\n            removeItem: () => {},\r\n        } as any;\r\n    } catch (e) {\r\n        // maybe it doesn't let me set this\r\n    }\r\n}","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","import {KL} from '../klecks/kl';\r\nimport {klHistory} from '../klecks/history/kl-history';\r\nimport {BB} from '../bb/bb';\r\nimport {showIframePopup} from '../klecks/ui/modals/show-iframe-popup';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\nimport {exportType} from '../klecks/ui/tool-tabs/file-tab';\r\nimport {ToolspaceTopRow} from \"../embed/toolspace-top-row\";\r\nimport {IGradient, IInitState, IKlProject, IKlPsd} from '../klecks/kl.types';\r\nimport {importFilters} from '../klecks/filters/filters-lazy';\r\nimport {base64ToBlob} from '../klecks/storage/base-64-to-blob';\r\nimport {klCanvasToPsdBlob} from '../klecks/storage/kl-canvas-to-psd-blob';\r\nimport {ProjectStore} from '../klecks/storage/project-store';\r\nimport {SaveReminder} from \"../klecks/ui/components/save-reminder\";\r\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\r\nimport {LANG} from '../language/language';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolGradientImg from 'url:~/src/app/img/ui/tool-gradient.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport tabSettingsImg from 'url:~/src/app/img/ui/tab-settings.svg';\r\n// @ts-ignore\r\nimport tabLayersImg from 'url:~/src/app/img/ui/tab-layers.svg';\r\nimport {LocalStorage} from '../bb/base/local-storage';\r\n\r\n\r\ninterface IKlAppOptions {\r\n    saveReminder?: SaveReminder;\r\n    projectStore?: ProjectStore;\r\n    logoImg?: any; // app logo\r\n    bottomBar?: HTMLElement; // row at bottom of toolspace\r\n    embed?: {\r\n        url: string;\r\n        onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    };\r\n    app?: {\r\n        filenameBase?: string; // part of filename when downloading drawing\r\n        imgurKey?: string; // for imgur uploads\r\n    };\r\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\r\n}\r\n\r\nimportFilters();\r\n\r\nexport function KlApp(pProject: IKlProject | null, pOptions: IKlAppOptions) {\r\n    // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\r\n    // but not larger than 4096 - a fairly arbitrary decision\r\n    let klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\r\n    let collapseThreshold = 820;\r\n    let uiState: 'left' | 'right' = (pOptions.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as any;\r\n    const filenameBase = pOptions.app?.filenameBase ? pOptions.app.filenameBase : 'Klecks';\r\n    const projectStore = pOptions.projectStore;\r\n    let klRootEl = document.createElement(\"div\");\r\n    klRootEl.className = 'g-root';\r\n    let uiWidth: number = Math.max(0, window.innerWidth);\r\n    let uiHeight: number = Math.max(0, window.innerHeight);\r\n    const toolWidth = 271;\r\n    let exportType: exportType = 'png';\r\n    let klCanvas: KlCanvas = new KL.KlCanvas(\r\n        pProject ? {\r\n            projectObj: pProject\r\n        } : {\r\n            width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < collapseThreshold ? uiWidth : uiWidth - toolWidth)),\r\n            height: Math.max(10, Math.min(klMaxCanvasSize, uiHeight)),\r\n        }, pOptions.embed ? -1 : 0);\r\n    klCanvas.setHistory(klHistory);\r\n    let initState: IInitState = null;\r\n    let mainTabRow;\r\n\r\n    if (!pOptions.saveReminder) {\r\n        pOptions.saveReminder = {init: () => {}, reset: () => {}} as SaveReminder;\r\n    }\r\n\r\n    function translateSmoothing(s: number): number {\r\n        if (s == 1) {\r\n            return 1 - 0.5;\r\n        }\r\n        if (s == 2) {\r\n            return 1 - 0.16;\r\n        }\r\n        if (s == 3) {\r\n            return 1 - 0.035;\r\n        }\r\n        if (s == 4) {\r\n            return 1 - 0.0175;\r\n        }\r\n        if (s == 5) {\r\n            return 1 - 0.00875;\r\n        }\r\n        return s;\r\n    }\r\n\r\n    let isFirstImage = true;\r\n\r\n    if (pProject) {\r\n        pProject.layers.forEach(layer => {\r\n            layer.image = null;\r\n        });\r\n        pProject = null;\r\n    } else {\r\n        klHistory.pause(true);\r\n        klCanvas.addLayer();\r\n        klCanvas.layerFill(0, { r: 255, g: 255, b: 255});\r\n        klHistory.pause(false);\r\n    }\r\n    try {\r\n        initState = {\r\n            canvas: new KL.KlCanvas({copy: klCanvas}, pOptions.embed ? -1 : 0),\r\n            focus: klCanvas.getLayerCount() - 1,\r\n            brushes: {},\r\n        };\r\n    } catch (e) {\r\n        if (e.message === 'kl-create-canvas-error') {\r\n            klCanvas.destroy();\r\n        }\r\n        throw e;\r\n    }\r\n    for (let b in KL.brushes) {\r\n        if (KL.brushes.hasOwnProperty(b)) {\r\n            initState.brushes[b] = new KL.brushes[b]();\r\n            if (initState.canvas) {\r\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    let currentColor = new BB.RGB(0, 0, 0);\r\n    let currentBrush, currentBrushId;\r\n    let lastNonEraserBrushId = 0;\r\n    let currentLayerCtx = klCanvas.getLayerContext(klCanvas.getLayerCount() - 1);\r\n\r\n    function sizeWatcher(val) {\r\n        brushSettingService.emitSize(val);\r\n        if (klCanvasWorkspace) {\r\n            klCanvasWorkspace.setCursorSize(val * 2);\r\n        }\r\n    }\r\n\r\n    const brushSettingService = new KL.BrushSettingService(\r\n        (color) => {\r\n            klColorSlider.setColor(color);\r\n            currentBrush.setColor(color);\r\n            currentColor = BB.copyObj(color);\r\n        },\r\n        (size) => {\r\n            currentBrush.setSize(size);\r\n            klCanvasWorkspace.setCursorSize(size * 2);\r\n        },\r\n        (opacity) => {\r\n            currentBrush.setOpacity(opacity);\r\n        },\r\n        () => klColorSlider.getColor(),\r\n        () => brushUiObj[currentBrushId].getSize(),\r\n        () => brushUiObj[currentBrushId].getOpacity(),\r\n        () => {\r\n            return {\r\n                sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n            };\r\n        }\r\n    );\r\n\r\n    let lineSmoothing = new BB.EventChain.LineSmoothing({\r\n        smoothing: translateSmoothing(1),\r\n    });\r\n    let lineSanitizer = new BB.EventChain.LineSanitizer();\r\n\r\n    let drawEventChain = new BB.EventChain.EventChain({\r\n        chainArr: [\r\n            lineSanitizer,\r\n            lineSmoothing\r\n        ],\r\n    });\r\n\r\n    drawEventChain.setChainOut(function(event) {\r\n        if (event.type === 'down') {\r\n            toolspace.style.pointerEvents = 'none';\r\n            currentBrush.startLine(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'move') {\r\n            currentBrush.goLine(event.x, event.y, event.pressure, false, event.isCoalesced)\r\n            klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'up') {\r\n            toolspace.style.pointerEvents = '';\r\n            currentBrush.endLine();\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'line') {\r\n            currentBrush.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n    });\r\n\r\n    let textToolSettings = {\r\n        size: 20,\r\n        align: 'left' as ('left' | 'center' | 'right'),\r\n        isBold: false,\r\n        isItalic: false,\r\n        font: 'sans-serif' as ('serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'),\r\n        opacity: 1\r\n    };\r\n\r\n    const klCanvasWorkspace: KlCanvasWorkspace = new KL.KlCanvasWorkspace({\r\n        klCanvas: klCanvas,\r\n        width: Math.max(0, uiWidth - toolWidth),\r\n        height: uiHeight,\r\n        onDraw: drawEventChain.chainIn,\r\n        onPick: function(rgbObj, isDragDone) {\r\n            brushSettingService.setColor(rgbObj);\r\n            if (isDragDone) {\r\n                klColorSlider.pickingDone();\r\n                klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            }\r\n        },\r\n        onFill: function(canvasX, canvasY) {\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n            klCanvas.floodFill(\r\n                layerIndex,\r\n                canvasX,\r\n                canvasY,\r\n                fillUi.getIsEraser() ? null : klColorSlider.getColor(),\r\n                fillUi.getOpacity(),\r\n                fillUi.getTolerance(),\r\n                fillUi.getSample(),\r\n                fillUi.getGrow(),\r\n                fillUi.getContiguous()\r\n            );\r\n            klCanvasWorkspace.requestFrame();\r\n        },\r\n        onGradient: function(typeStr, canvasX, canvasY, angleRad) {\r\n            if (typeStr === 'down') {\r\n                gradientTool.onDown(canvasX, canvasY, angleRad);\r\n            }\r\n            if (typeStr === 'move') {\r\n                gradientTool.onMove(canvasX, canvasY);\r\n            }\r\n            if (typeStr === 'up') {\r\n                gradientTool.onUp(canvasX, canvasY);\r\n            }\r\n        },\r\n        onText: function(canvasX, canvasY, angleRad) {\r\n            if (KL.dialogCounter.get() > 0) {\r\n                return;\r\n            }\r\n\r\n            KL.textToolDialog({\r\n                klCanvas: klCanvas,\r\n                layerIndex: klCanvas.getLayerIndex(currentLayerCtx.canvas),\r\n                x: canvasX,\r\n                y: canvasY,\r\n                angleRad: angleRad,\r\n                color: klColorSlider.getColor(),\r\n                secondaryColor: klColorSlider.getSecondaryRGB(),\r\n                size: textToolSettings.size,\r\n                align: textToolSettings.align,\r\n                isBold: textToolSettings.isBold,\r\n                isItalic: textToolSettings.isItalic,\r\n                font: textToolSettings.font,\r\n                opacity: textToolSettings.opacity,\r\n                onConfirm: function(val) {\r\n\r\n                    let colorRGBA = val.color;\r\n                    colorRGBA.a = val.opacity;\r\n\r\n                    textToolSettings.size = val.size;\r\n                    textToolSettings.align = val.align;\r\n                    textToolSettings.isBold = val.isBold;\r\n                    textToolSettings.isItalic = val.isItalic;\r\n                    textToolSettings.font = val.font;\r\n                    textToolSettings.opacity = val.opacity;\r\n\r\n                    let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                    klCanvas.text(layerIndex, {\r\n                        textStr: val.textStr,\r\n                        x: val.x,\r\n                        y: val.y,\r\n                        size: val.size,\r\n                        font: val.font,\r\n                        align: val.align,\r\n                        isBold: val.isBold,\r\n                        isItalic: val.isItalic,\r\n                        angleRad: angleRad,\r\n                        color: BB.ColorConverter.toRgbaStr(colorRGBA)\r\n                    });\r\n                    klCanvasWorkspace.requestFrame();\r\n                }\r\n            });\r\n\r\n        },\r\n        onShape: function(typeStr, canvasX, canvasY, angleRad) {\r\n            if (typeStr === 'down') {\r\n                shapeTool.onDown(canvasX, canvasY, angleRad);\r\n            }\r\n            if (typeStr === 'move') {\r\n                shapeTool.onMove(canvasX, canvasY);\r\n            }\r\n            if (typeStr === 'up') {\r\n                shapeTool.onUp(canvasX, canvasY);\r\n            }\r\n        },\r\n\r\n        onViewChange: function(viewChangeObj) {\r\n\r\n            if (viewChangeObj.changed.includes('scale')) {\r\n                statusOverlay.out({\r\n                    type: 'transform',\r\n                    scale: viewChangeObj.scale,\r\n                    angleDeg: viewChangeObj.angle * 180 / Math.PI\r\n                });\r\n            }\r\n\r\n            toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== klCanvasWorkspace.getMaxScale());\r\n            toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== klCanvasWorkspace.getMinScale());\r\n\r\n            handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\r\n        },\r\n        onUndo: function() {\r\n            if (klHistory.canUndo()) {\r\n                if (undoRedoCatchup.undo()) {\r\n                    statusOverlay.out(LANG('undo'), true);\r\n                }\r\n            }\r\n        },\r\n        onRedo: function() {\r\n            if (klHistory.canRedo()) {\r\n                if (undoRedoCatchup.redo()) {\r\n                    statusOverlay.out(LANG('redo'), true);\r\n                }\r\n            }\r\n        },\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, event, comboStr) {\r\n            if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n\r\n            let isDrawing = lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n            if (isDrawing) {\r\n                return;\r\n            }\r\n\r\n            if (comboStr === 'plus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n            }\r\n            if (comboStr === 'minus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n            }\r\n            if (comboStr === 'home') {\r\n                klCanvasWorkspace.fitView();\r\n            }\r\n            if (comboStr === 'end') {\r\n                klCanvasWorkspace.resetView(true);\r\n            }\r\n            if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.undo();\r\n            }\r\n            if (\r\n                ['ctrl+y', 'cmd+y'].includes(comboStr) ||\r\n                (\r\n                    (\r\n                        BB.sameKeys('ctrl+shift+z', comboStr) ||\r\n                        BB.sameKeys('cmd+shift+z', comboStr)\r\n                    ) && keyStr === 'z'\r\n                )\r\n            ) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.redo();\r\n            }\r\n            if (!pOptions.embed) {\r\n                if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    saveToComputer.save();\r\n                }\r\n                if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n\r\n                    (async () => {\r\n                        let success = true;\r\n                        try {\r\n                            await projectStore.store(klCanvas.getProject());\r\n                        } catch (e) {\r\n                            success = false;\r\n                            setTimeout(() => {\r\n                                throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\r\n                            }, 0);\r\n                            statusOverlay.out('❌ ' + LANG('file-storage-failed'), true);\r\n                        }\r\n                        if (success) {\r\n                            pOptions.saveReminder.reset();\r\n                            statusOverlay.out(LANG('file-storage-stored'), true);\r\n                        }\r\n                    })();\r\n                }\r\n                if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    copyToClipboard(true);\r\n                }\r\n            }\r\n            if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\r\n                event.preventDefault();\r\n            }\r\n\r\n\r\n            if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.translateView(1, 0);\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.translateView(-1, 0);\r\n                }\r\n                if (keyStr === 'up') {\r\n                    klCanvasWorkspace.translateView(0, 1);\r\n                }\r\n                if (keyStr === 'down') {\r\n                    klCanvasWorkspace.translateView(0, -1);\r\n                }\r\n            }\r\n\r\n\r\n            if (['r+left','r+right'].includes(comboStr)) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.setAngle(-15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.setAngle(15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n            }\r\n            if (['r+up'].includes(comboStr)) {\r\n                klCanvasWorkspace.setAngle(0);\r\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n            }\r\n\r\n\r\n            if (comboStr === 'sqbr_open') {\r\n                currentBrush.decreaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'sqbr_close') {\r\n                currentBrush.increaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'enter') {\r\n                klCanvas.layerFill(klCanvas.getLayerIndex(currentLayerCtx.canvas), klColorSlider.getColor());\r\n                statusOverlay.out(LANG('filled'), true);\r\n            }\r\n            if (['delete', 'backspace'].includes(comboStr)) {\r\n                let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                if (layerIndex === 0 && !brushUiObj.eraserBrush.getIsTransparentBg()) {\r\n                    klCanvas.layerFill(layerIndex, {r: 255, g: 255, b: 255}, 'source-in');\r\n                } else {\r\n                    klCanvas.clearLayer(layerIndex);\r\n                }\r\n                statusOverlay.out(LANG('cleared-layer'), true);\r\n            }\r\n            if (comboStr === 'e') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open('eraserBrush');\r\n            }\r\n            if (comboStr === 'b') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open(lastNonEraserBrushId);\r\n            }\r\n            if (comboStr === 'g') {\r\n                event.preventDefault();\r\n                const newMode = klCanvasWorkspace.getMode() === 'fill' ? 'gradient' : 'fill';\r\n                klCanvasWorkspace.setMode(newMode);\r\n                toolspaceToolRow.setActive(newMode);\r\n                mainTabRow.open(newMode);\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 't') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('text');\r\n                toolspaceToolRow.setActive('text');\r\n                mainTabRow.open('text');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'u') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('shape');\r\n                toolspaceToolRow.setActive('shape');\r\n                mainTabRow.open('shape');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'x') {\r\n                event.preventDefault();\r\n                klColorSlider.swapColors();\r\n            }\r\n\r\n\r\n        },\r\n        onUp: function(keyStr, event) {\r\n        }\r\n    });\r\n\r\n    /**\r\n     *\r\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\r\n     * @param filename - string e.g. 'drawing.psd'\r\n     * @param optionStr? - 'default' | 'layer' | 'image'\r\n     */\r\n    function importFinishedLoading(\r\n        importedImage: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLCanvasElement | HTMLImageElement;\r\n        },\r\n        filename: string,\r\n        optionStr: 'default' | 'layer' | 'image',\r\n    ) {\r\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"error\",\r\n                message: LANG('import-broken-file'),\r\n                buttons: [\"Ok\"],\r\n            });\r\n            return;\r\n        }\r\n\r\n        function getResizedDimensions(width, height) {\r\n            let w = parseInt(width);\r\n            let h = parseInt(height);\r\n            if (w > klMaxCanvasSize) {\r\n                h = klMaxCanvasSize / w * h;\r\n                w = klMaxCanvasSize;\r\n            }\r\n            if (h > klMaxCanvasSize) {\r\n                w = klMaxCanvasSize / h * w;\r\n                h = klMaxCanvasSize;\r\n            }\r\n            w = parseInt('' + w);\r\n            h = parseInt('' + h);\r\n            return {\r\n                width: w,\r\n                height: h\r\n            }\r\n        }\r\n\r\n        function importAsImage(canvas) {\r\n            let resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\r\n\r\n            //resize first\r\n            let tempCanvas = BB.canvas(canvas.width, canvas.height);\r\n            let tempCanvasCtx = tempCanvas.getContext('2d');\r\n            tempCanvasCtx.drawImage(canvas, 0, 0);\r\n\r\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\r\n\r\n            klCanvas.reset({\r\n                width: resizedDimensions.width,\r\n                height: resizedDimensions.height,\r\n                image: tempCanvas,\r\n                layerName: filename\r\n            });\r\n\r\n            layerManager.update(0);\r\n            setCurrentLayer(klCanvas.getLayer(0));\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n            isFirstImage = false;\r\n        }\r\n\r\n        /**\r\n         *\r\n         * @param convertedPsdObj - if flattened then without layers\r\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\r\n         */\r\n        function importAsImagePsd(convertedPsdObj: IKlPsd, cropObj?) {\r\n\r\n            // crop\r\n            function crop(targetCanvas, cropCanvas, cropObj) {\r\n                cropCanvas.width = cropCanvas.width;\r\n                cropCanvas.getContext('2d').drawImage(targetCanvas, -cropObj.x, -cropObj.y);\r\n                targetCanvas.width = cropObj.width;\r\n                targetCanvas.height = cropObj.height;\r\n                targetCanvas.getContext('2d').drawImage(cropCanvas, 0, 0);\r\n            }\r\n            if (cropObj && (cropObj.width !== convertedPsdObj.width ||cropObj.height !== convertedPsdObj.height)) {\r\n                let cropCanvas = BB.canvas(cropObj.width, cropObj.height);\r\n                convertedPsdObj.width = cropObj.width;\r\n                convertedPsdObj.height = cropObj.height;\r\n\r\n                if (!convertedPsdObj.layers) {\r\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\r\n                }\r\n                if (convertedPsdObj.layers) {\r\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                        let item = convertedPsdObj.layers[i];\r\n                        crop(item.image, cropCanvas, cropObj);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // resize\r\n            let resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\r\n            convertedPsdObj.width = resizedDimensions.width;\r\n            convertedPsdObj.height = resizedDimensions.height;\r\n            if (!convertedPsdObj.layers) {\r\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\r\n            }\r\n            if (convertedPsdObj.layers) {\r\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                    let item = convertedPsdObj.layers[i];\r\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\r\n                }\r\n            }\r\n\r\n            let layerIndex;\r\n            if (convertedPsdObj.layers) {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    layers: convertedPsdObj.layers\r\n                });\r\n            } else {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    image: convertedPsdObj.canvas\r\n                });\r\n            }\r\n            layerManager.update(layerIndex);\r\n            setCurrentLayer(klCanvas.getLayer(layerIndex));\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n            isFirstImage = false;\r\n        }\r\n\r\n        function importAsLayer(canvas) {\r\n            KL.showImportAsLayerDialog({\r\n                target: klRootEl,\r\n                klCanvas: klCanvas,\r\n                importImage: canvas,\r\n                callback: function(transformObj, isPixelated: boolean) {\r\n                    if (!transformObj) {\r\n                        return;\r\n                    }\r\n\r\n                    klHistory.pause(true);\r\n                    klCanvas.addLayer();\r\n                    let layers = klCanvas.getLayers();\r\n                    let activeLayerIndex = layers.length - 1;\r\n                    if (filename) {\r\n                        klCanvas.renameLayer(activeLayerIndex, filename);\r\n                    }\r\n                    let activeLayerContext = klCanvas.getLayerContext(activeLayerIndex);\r\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, null, isPixelated);\r\n                    setCurrentLayer(klCanvas.getLayer(activeLayerIndex));\r\n                    layerManager.update(activeLayerIndex);\r\n\r\n                    klHistory.pause(false);\r\n\r\n                    klHistory.push({\r\n                        tool: [\"misc\"],\r\n                        action: \"importImage\",\r\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename]\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n\r\n        if (optionStr === 'default' || !optionStr) {\r\n            KL.showImportImageDialog({\r\n                image: importedImage,\r\n                target: klRootEl,\r\n                maxSize: klMaxCanvasSize,\r\n                callback: function(res) {\r\n                    if (res.type === 'as-image') {\r\n                        importAsImage(res.image);\r\n                    } else if (res.type === 'as-image-psd') {\r\n                        importAsImagePsd(res.image, res.cropObj);\r\n                    } else if (res.type === 'as-layer') {\r\n                        importAsLayer(res.image);\r\n                    } else if (res.type === 'cancel') {\r\n                        // nothing to do\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        if (optionStr === 'layer') {\r\n            importAsLayer(importedImage.canvas);\r\n        }\r\n        if (optionStr === 'image') {\r\n            if (importedImage.type === 'psd') {\r\n                importAsImagePsd(importedImage);\r\n            } else {\r\n                importAsImage(importedImage.canvas);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function onPaste(e) {\r\n        if (KL.dialogCounter.get() > 0) {\r\n            return;\r\n        }\r\n\r\n        function retrieveImageFromClipboardAsBlob(pasteEvent, callback) {\r\n            if (pasteEvent.clipboardData == false) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            }\r\n\r\n            let items = pasteEvent.clipboardData.items;\r\n\r\n            if (items == undefined) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            } else {\r\n                for (let i = 0; i < items.length; i++) {\r\n                    if (items[i].type.indexOf(\"image\") == -1) {\r\n                        continue;\r\n                    }\r\n                    let blob = items[i].getAsFile();\r\n\r\n                    if (typeof (callback) == \"function\") {\r\n                        callback(blob);\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (e.clipboardData.files[0]) {\r\n            retrieveImageFromClipboardAsBlob(e, function (imageBlob) {\r\n                // If there's an image, display it in the canvas\r\n                if (imageBlob) {\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        URL.revokeObjectURL(img.src);\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    let URLObj = window.URL || window.webkitURL;\r\n                    img.src = URLObj.createObjectURL(imageBlob);\r\n                }\r\n            });\r\n        } else if (e.clipboardData.items[0]) {\r\n            e.clipboardData.items[0].getAsString(function(pasteStr) {\r\n                pasteStr = pasteStr.trim();\r\n                if (pasteStr.match(/^https?/)) {\r\n                    // url\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    img.onerror = function (e) {\r\n                        console.log('error loading', e);\r\n                    };\r\n                    img.crossOrigin = 'Anonymous';\r\n                    img.src = pasteStr;\r\n\r\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\r\n                    // url\r\n                    let rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\r\n                    brushSettingService.setColor(rgbObj);\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    function handleFileSelect(files, optionStr) {\r\n\r\n        function showWarningPsdFlattened() {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"warning\",\r\n                message: LANG('import-psd-unsupported') + \"<br /><br />\",\r\n                buttons: [\"Ok\"],\r\n            });\r\n        }\r\n\r\n        let hasUnsupportedFile = false;\r\n        for (let i = 0, file; file = files[i]; i++) {\r\n            let extension = file.name.split(\".\");\r\n            extension = extension[extension.length - 1].toLowerCase();\r\n            if (extension === \"psd\") {\r\n\r\n                (function(f) {\r\n                    let loaderSizeBytes = 1024 * 1024 * 25; // 25mb\r\n                    let maxSizeBytes = 1024 * 1024 * 1024; // 1gb\r\n                    let maxResolution = 4096;\r\n\r\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            type: \"error\",\r\n                            message: \"File too big. Unable to import.<br /><br />\",\r\n                            buttons: [\"Ok\"],\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    let doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\r\n                    let loaderIsOpen = true;\r\n                    let closeLoader;\r\n\r\n                    if (doShowLoader) {\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            message: LANG('import-opening'),\r\n                            callback: function (result) {\r\n                                loaderIsOpen = false;\r\n                                closeLoader = null;\r\n                            },\r\n                            closefunc: function (f) {\r\n                                closeLoader = f;\r\n                            }\r\n                        });\r\n                    }\r\n\r\n\r\n                    let reader = new FileReader();\r\n                    reader.onload = function (readerResult) {\r\n\r\n                        KL.loadAgPsd().then(function(agPsdLazy) {\r\n\r\n                            if (doShowLoader && !loaderIsOpen) {\r\n                                return;\r\n                            }\r\n\r\n                            try {\r\n                                let psd;\r\n\r\n                                // first pass, only read metadata\r\n                                psd = agPsdLazy.readPsd(\r\n                                    (readerResult.target.result as any),\r\n                                    {\r\n                                        skipLayerImageData: true,\r\n                                        skipThumbnail: true,\r\n                                        skipCompositeImageData: true\r\n                                    });\r\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    KL.popup({\r\n                                        target: klRootEl,\r\n                                        type: \"error\",\r\n                                        //message: \"Image exceeds maximum dimensions of \" + maxResolution + \" x \" + maxResolution + \" pixels. Unable to import.\"\r\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\r\n                                            + \"<br /><br />\"\r\n                                            + LANG('import-psd-size') + \": \" + psd.width + \" x \" + psd.height + ' pixels'\r\n                                            + \"<br /><br />\"\r\n                                        ,\r\n                                        buttons: [\"Ok\"],\r\n                                    });\r\n                                    return;\r\n                                }\r\n\r\n\r\n                                // second pass, now load actual data.\r\n                                psd = null;\r\n\r\n                                try {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any));\r\n                                } catch (e) {\r\n                                    //console.log('failed regular psd import', e);\r\n                                }\r\n                                if (psd) {\r\n                                    //console.log('psd', psd);\r\n                                    let convertedPsd = KL.PSD.readPsd(psd);\r\n                                    //console.log('converted', convertedPsd);\r\n                                    if (optionStr === 'image' && convertedPsd.error) {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading(convertedPsd, f.name, optionStr);\r\n                                } else {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any), { skipLayerImageData: true, skipThumbnail: true });\r\n                                    if (optionStr === 'image') {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading({\r\n                                        type: 'psd',\r\n                                        width: psd.width,\r\n                                        height: psd.height,\r\n                                        canvas: psd.canvas,\r\n                                        error: true\r\n                                    }, f.name, optionStr);\r\n                                }\r\n\r\n\r\n                            } catch (e) {\r\n                                if (closeLoader) {\r\n                                    closeLoader();\r\n                                }\r\n                                KL.popup({\r\n                                    target: klRootEl,\r\n                                    type: \"error\",\r\n                                    message: \"Failed to load PSD.<br /><br />\",\r\n                                    buttons: [\"Ok\"],\r\n                                });\r\n                            }\r\n                        }).catch(() => {\r\n                            closeLoader();\r\n                            alert('Error: failed to load PSD library');\r\n                        });\r\n\r\n                    };\r\n                    reader.readAsArrayBuffer(f);\r\n                })(file);\r\n\r\n            } else if (file.type.match('image.*')) {\r\n                (function (f) {\r\n                    window.URL = window.URL || window.webkitURL;\r\n                    let url = window.URL.createObjectURL(f);\r\n                    let im = new Image();\r\n                    im.src = url;\r\n                    BB.loadImage(im, function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: im.width,\r\n                            height: im.height,\r\n                            canvas: im\r\n                        }, f.name, optionStr);\r\n                    });\r\n                })(file);\r\n            } else {\r\n                hasUnsupportedFile = true;\r\n            }\r\n        }\r\n        if (hasUnsupportedFile) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                message: LANG('import-unsupported-file'),\r\n                type: 'error',\r\n                buttons: ['OK'],\r\n            });\r\n        }\r\n    }\r\n\r\n    if (!pOptions.embed) {\r\n        new KL.KlImageDropper({\r\n            target: document.body,\r\n            onDrop: function(files, optionStr) {\r\n                if (KL.dialogCounter.get() > 0) {\r\n                    return;\r\n                }\r\n                handleFileSelect(files, optionStr);\r\n            },\r\n            enabledTest: function() {\r\n                return KL.dialogCounter.get() === 0;\r\n            }\r\n        });\r\n\r\n        BB.addEventListener(window, 'paste', onPaste, false);\r\n    }\r\n\r\n    const brushUiObj: any = {};\r\n\r\n    // create brush UIs\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            let ui = new KL.brushesUI[b].Ui({\r\n                onSizeChange: sizeWatcher,\r\n                onOpacityChange: function(opacity) {\r\n                    brushSettingService.emitOpacity(opacity);\r\n                },\r\n                onConfigChange: () => {\r\n                    brushSettingService.emitSliderConfig({\r\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider\r\n                    });\r\n                }\r\n            });\r\n            brushUiObj[b] = ui;\r\n            ui.getElement().style.padding = 10 + 'px';\r\n        }\r\n    }\r\n\r\n\r\n    BB.css(klRootEl, {\r\n        position: 'absolute',\r\n        left: '0',\r\n        top: '0',\r\n        right: '0',\r\n        bottom: '0'\r\n    });\r\n\r\n    let statusOverlay = new KL.StatusOverlay();\r\n\r\n    const toolspace = BB.el({});\r\n    const toolspaceInner = BB.el({\r\n        parent: toolspace,\r\n    });\r\n    toolspace.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n    toolspace.onclick = BB.handleClick;\r\n\r\n\r\n    let toolspaceCollapser = new KL.ToolspaceCollapser({\r\n        onChange: function() {\r\n            updateCollapse();\r\n        }\r\n    });\r\n    function updateCollapse() {\r\n\r\n        //collapser\r\n        if (uiWidth < collapseThreshold) {\r\n            toolspaceCollapser.getElement().style.display = 'block';\r\n\r\n            toolspaceCollapser.setDirection(uiState);\r\n            if (toolspaceCollapser.isOpen()) {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '271px',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '271px'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '271px'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'block';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n                statusOverlay.setWide(false);\r\n\r\n            } else {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '0',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '0'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'none';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth), uiHeight);\r\n                statusOverlay.setWide(true);\r\n\r\n            }\r\n\r\n        } else {\r\n            toolspaceCollapser.getElement().style.display = 'none';\r\n            if (uiState === 'left') {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '271px'\r\n                });\r\n            } else {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '0'\r\n                });\r\n            }\r\n            toolspace.style.display = 'block';\r\n            klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n            statusOverlay.setWide(false);\r\n\r\n        }\r\n    }\r\n    updateCollapse();\r\n\r\n    function updateUi() {\r\n        if (uiState === 'left') {\r\n            BB.css(toolspace, {\r\n                left: '0',\r\n                right: '',\r\n                borderLeft: 'none',\r\n                borderRight: '1px solid rgb(135, 135, 135)'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '271px'\r\n            });\r\n        } else {\r\n            BB.css(toolspace, {\r\n                left: '',\r\n                right: '0',\r\n                borderLeft: '1px solid rgb(135, 135, 135)',\r\n                borderRight: 'none'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '0'\r\n            });\r\n        }\r\n        statusOverlay.setUiState(uiState);\r\n        layerPreview.setUiState('' + uiState);\r\n        layerManager.setUiState('' + uiState);\r\n        updateCollapse();\r\n        toolspaceScroller.updateUiState(uiState);\r\n    }\r\n\r\n\r\n\r\n    let overlayToolspace;\r\n    setTimeout(function() {\r\n        overlayToolspace = new KL.OverlayToolspace({\r\n            enabledTest: function() {\r\n                return KL.dialogCounter.get() === 0 && !lineSanitizer.getIsDrawing();\r\n            },\r\n            brushSettingService,\r\n        });\r\n        klRootEl.appendChild(overlayToolspace.getElement());\r\n    }, 0);\r\n\r\n    BB.append(klRootEl, [klCanvasWorkspace.getElement(), toolspace, toolspaceCollapser.getElement()]);\r\n\r\n    BB.css(toolspace, {\r\n        position: \"absolute\",\r\n        right: '0',\r\n        top: '0',\r\n        bottom: '0',\r\n        width: (toolWidth - 1) + \"px\",\r\n\r\n        overflow: \"hidden\",\r\n        backgroundColor: \"#ddd\",\r\n        borderLeft: \"1px solid rgb(135, 135, 135)\",\r\n        userSelect: 'none',\r\n        touchAction: 'none'\r\n    });\r\n\r\n    let toolspaceTopRow;\r\n    if (pOptions.embed) {\r\n        toolspaceTopRow = new ToolspaceTopRow({\r\n            onHelp: () => {\r\n                showIframePopup(pOptions.embed.url + '/help.html', !!pOptions.embed);\r\n            },\r\n            onSubmit: () => {\r\n                KL.popup({\r\n                    target: klRootEl,\r\n                    message: LANG('submit-prompt'),\r\n                    buttons: [LANG('submit'), 'Cancel'],\r\n                    callback: async (result) => {\r\n                        if (result !== LANG('submit')) {\r\n                            return;\r\n                        }\r\n\r\n                        let overlay = BB.el({\r\n                            parent: klRootEl,\r\n                            className: 'upload-overlay',\r\n                            content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\r\n                        });\r\n\r\n                        pOptions.embed.onSubmit(\r\n                            () => {\r\n                                pOptions.saveReminder.reset();\r\n                                klRootEl.removeChild(overlay);\r\n                            },\r\n                            () => {\r\n                                klRootEl.removeChild(overlay);\r\n                            });\r\n                    }\r\n                });\r\n            },\r\n            onLeftRight: () => {\r\n                uiState = uiState === 'left' ? 'right' : 'left';\r\n                updateUi();\r\n            },\r\n        });\r\n    } else {\r\n        toolspaceTopRow = new KL.ToolspaceTopRow({\r\n            logoImg: pOptions.logoImg,\r\n            onLogo: function() {\r\n                showIframePopup('./home/', !!pOptions.embed);\r\n            },\r\n            onNew: function() {\r\n                showNewImageDialog();\r\n            },\r\n            onImport: function() {\r\n                fileTab.triggerImport();\r\n            },\r\n            onSave: function() {\r\n                saveToComputer.save();\r\n            },\r\n            onShare: function() {\r\n                shareImage();\r\n            },\r\n            onHelp: function() {\r\n                showIframePopup('./help/', !!pOptions.embed);\r\n            },\r\n        });\r\n    }\r\n    toolspaceTopRow.getElement().classList.add('toolspace-row-shadow');\r\n    toolspaceTopRow.getElement().style.marginBottom = '10px';\r\n    toolspaceInner.appendChild(toolspaceTopRow.getElement());\r\n\r\n    let toolspaceToolRow = new KL.ToolspaceToolRow({\r\n        onActivate: function(activeStr) {\r\n            if (activeStr === 'draw') {\r\n                klCanvasWorkspace.setMode('draw');\r\n            } else if (activeStr === 'hand') {\r\n                klCanvasWorkspace.setMode('hand');\r\n            } else if (activeStr === 'fill') {\r\n                klCanvasWorkspace.setMode('fill');\r\n            } else if (activeStr === 'gradient') {\r\n                klCanvasWorkspace.setMode('gradient');\r\n            } else if (activeStr === 'text') {\r\n                klCanvasWorkspace.setMode('text');\r\n            } else if (activeStr === 'shape') {\r\n                klCanvasWorkspace.setMode('shape');\r\n            } else {\r\n                throw new Error('unknown activeStr');\r\n            }\r\n            mainTabRow.open(activeStr);\r\n            updateMainTabVisibility();\r\n            klColorSlider.pickingDone();\r\n        },\r\n        onZoomIn: function() {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n        },\r\n        onZoomOut: function() {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n        },\r\n        onUndo: function() {\r\n            undoRedoCatchup.undo();\r\n        },\r\n        onRedo: function() {\r\n            undoRedoCatchup.redo();\r\n        }\r\n    });\r\n    toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    klHistory.addListener(function() {\r\n        toolspaceToolRow.setEnableUndo(klHistory.canUndo());\r\n        toolspaceToolRow.setEnableRedo(klHistory.canRedo());\r\n    });\r\n    toolspaceToolRow.getElement().classList.add('toolspace-row-shadow');\r\n    toolspaceInner.appendChild(toolspaceToolRow.getElement());\r\n\r\n    let klColorSlider;\r\n\r\n    function setCurrentBrush(brushId) {\r\n        if (brushId !== 'eraserBrush') {\r\n            lastNonEraserBrushId = brushId;\r\n        }\r\n\r\n        if (klColorSlider) {\r\n            if (brushId === 'eraserBrush') {\r\n                klColorSlider.enable(false);\r\n            } else {\r\n                klColorSlider.enable(true);\r\n            }\r\n        }\r\n\r\n        currentBrushId = brushId;\r\n        currentBrush = brushUiObj[brushId];\r\n        currentBrush.setColor(currentColor);\r\n        currentBrush.setContext(currentLayerCtx);\r\n        klCanvasWorkspace.setMode('draw');\r\n        toolspaceToolRow.setActive('draw');\r\n        updateMainTabVisibility();\r\n    }\r\n\r\n    function setCurrentLayer(layer) { //BrushContext(p_context) {\r\n        currentLayerCtx = layer.context;\r\n        currentBrush.setContext(layer.context);\r\n        layerPreview.setLayer(layer);\r\n    }\r\n\r\n    function setBrushColor(p_color) {\r\n        currentColor = p_color;\r\n        currentBrush.setColor(p_color);\r\n        brushSettingService.emitColor(p_color);\r\n        klColorSlider.pickingDone();\r\n    }\r\n\r\n    klColorSlider = new KL.KlColorSlider({\r\n        width: 250,\r\n        height: 30,\r\n        svHeight: 100,\r\n        startValue: new BB.RGB(0, 0, 0),\r\n        onPick: setBrushColor\r\n    });\r\n    klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n    klColorSlider.setPickCallback(function (doPick) {\r\n\r\n        if (doPick) {\r\n            klCanvasWorkspace.setMode('pick');\r\n        } else {\r\n            klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            updateMainTabVisibility();\r\n        }\r\n\r\n    });\r\n    let brushDiv = document.createElement(\"div\");\r\n    let colorDiv = document.createElement(\"div\");\r\n    BB.css(colorDiv, {\r\n        margin: '10px',\r\n        display: 'flex',\r\n        flexWrap: 'wrap',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'flex-end'\r\n    });\r\n    let toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\r\n        smoothing: 1,\r\n        onSelect: function(v) {\r\n            lineSmoothing.setSmoothing(translateSmoothing(v));\r\n        }\r\n    });\r\n\r\n\r\n    brushDiv.appendChild(colorDiv);\r\n    BB.append(\r\n        colorDiv,\r\n        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n    );\r\n\r\n    let brushTabRow = new KL.TabRow({\r\n        initialId: 'penBrush',\r\n        useAccent: true,\r\n        tabArr: (function () {\r\n            let result = [];\r\n\r\n            function createTab(keyStr) {\r\n                return {\r\n                    id: keyStr,\r\n                    image: KL.brushesUI[keyStr].image,\r\n                    title: KL.brushesUI[keyStr].tooltip,\r\n                    onOpen: function() {\r\n                        brushUiObj[keyStr].getElement().style.display = 'block';\r\n                        setCurrentBrush(keyStr);\r\n                        klColorSlider.pickingDone();\r\n                        brushSettingService.emitSliderConfig({\r\n                            sizeSlider: KL.brushesUI[keyStr].sizeSlider,\r\n                            opacitySlider: KL.brushesUI[keyStr].opacitySlider\r\n                        });\r\n                        sizeWatcher(brushUiObj[keyStr].getSize());\r\n                        brushSettingService.emitOpacity(brushUiObj[keyStr].getOpacity());\r\n                    },\r\n                    onClose: function() {\r\n                        brushUiObj[keyStr].getElement().style.display = 'none';\r\n                    }\r\n                };\r\n            }\r\n\r\n            let keyArr = Object.keys(brushUiObj);\r\n            for (let i = 0; i < keyArr.length; i++) {\r\n                result.push(createTab(keyArr[i]));\r\n            }\r\n            return result;\r\n        })()\r\n    });\r\n    brushDiv.appendChild(brushTabRow.getElement());\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            brushDiv.appendChild(brushUiObj[b].getElement());\r\n        }\r\n    }\r\n\r\n    const handUi = new KL.HandUi({\r\n        scale: 1,\r\n        angleDeg: 0,\r\n        onReset: function() {\r\n            klCanvasWorkspace.resetView(true);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onFit: function() {\r\n            klCanvasWorkspace.fitView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onAngleChange: function(angleDeg, isRelative) {\r\n            klCanvasWorkspace.setAngle(angleDeg, isRelative);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n    });\r\n\r\n    let fillUi = new KL.FillUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let gradientUi = new KL.GradientUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let textUi = new KL.TextUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let shapeUi = new KL.ShapeUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    const gradientTool = new KL.GradientTool({\r\n        onGradient: (isDone, x1, y1, x2, y2, angleRad) => {\r\n            const layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n            const settings = gradientUi.getSettings();\r\n            const gradientObj: IGradient = {\r\n                type: settings.type,\r\n                color1: klColorSlider.getColor(),\r\n                isReversed: settings.isReversed,\r\n                opacity: settings.opacity,\r\n                doLockAlpha: settings.doLockAlpha,\r\n                isEraser: settings.isEraser,\r\n                doSnap: keyListener.isPressed('shift') || settings.doSnap,\r\n                x1,\r\n                y1,\r\n                x2,\r\n                y2,\r\n                angleRad,\r\n            };\r\n\r\n            if (isDone) {\r\n                klCanvas.setComposite(layerIndex, null);\r\n                klCanvas.drawGradient(layerIndex, gradientObj);\r\n            } else {\r\n                klCanvas.setComposite(layerIndex, {\r\n                    draw: function(ctx) {\r\n                        KL.drawGradient(ctx, gradientObj);\r\n                    }\r\n                });\r\n            }\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n    });\r\n\r\n    let shapeTool = new KL.ShapeTool({\r\n        onShape: function(isDone, x1, y1, x2, y2, angleRad) {\r\n\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n\r\n            let shapeObj: any = {\r\n                type: shapeUi.getShape(),\r\n                x1: x1,\r\n                y1: y1,\r\n                x2: x2,\r\n                y2: y2,\r\n                angleRad: angleRad,\r\n                isOutwards: shapeUi.getIsOutwards(),\r\n                opacity: shapeUi.getOpacity(),\r\n                isEraser: shapeUi.getIsEraser(),\r\n                doLockAlpha: shapeUi.getDoLockAlpha(),\r\n            };\r\n            if (shapeUi.getShape() === 'line') {\r\n                shapeObj.strokeRgb = klColorSlider.getColor();\r\n                shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\r\n            } else {\r\n                shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\r\n                if (shapeUi.getMode() === 'stroke') {\r\n                    shapeObj.strokeRgb = klColorSlider.getColor();\r\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                } else {\r\n                    shapeObj.fillRgb = klColorSlider.getColor();\r\n                }\r\n            }\r\n\r\n            if (isDone) {\r\n                klCanvas.setComposite(layerIndex, null);\r\n                klCanvas.drawShape(layerIndex, shapeObj);\r\n            } else {\r\n                klCanvas.setComposite(layerIndex, {\r\n                    draw: function(ctx) {\r\n                        KL.drawShape(ctx, shapeObj);\r\n                    }\r\n                });\r\n            }\r\n            klCanvasWorkspace.requestFrame();\r\n\r\n        }\r\n    });\r\n\r\n    const layerManager = KL.klLayerManager(klCanvas, function (val) {\r\n        setCurrentLayer(klCanvas.getLayer(val));\r\n        klHistory.push({\r\n            tool: [\"misc\"],\r\n            action: \"focusLayer\",\r\n            params: [val]\r\n        });\r\n    }, klRootEl) as any;\r\n    const layerPreview = new KL.LayerPreview({\r\n        klRootEl: klRootEl,\r\n        onClick: function () {\r\n            mainTabRow.open('layers');\r\n        }\r\n    });\r\n    layerPreview.setIsVisible(uiHeight >= 579);\r\n    layerPreview.setLayer(klCanvas.getLayer(klCanvas.getLayerIndex(currentLayerCtx.canvas)));\r\n\r\n    const filterTab = new KL.FilterTab(\r\n        klRootEl,\r\n        klColorSlider,\r\n        layerManager,\r\n        // setCurrentLayer,\r\n        klCanvasWorkspace,\r\n        handUi,\r\n        () => { //get current color\r\n            return currentColor;\r\n        },\r\n        () => { // get max canvas size\r\n            return klMaxCanvasSize;\r\n        },\r\n        () => { // get kl canvas\r\n            return klCanvas;\r\n        },\r\n        () => { // get current layer ctx\r\n            return currentLayerCtx;\r\n        },\r\n        !!pOptions.embed,\r\n        statusOverlay,\r\n    );\r\n\r\n    const undoRedoCatchup = new KL.UndoRedoCatchup(\r\n        brushUiObj,\r\n        layerPreview,\r\n        layerManager,\r\n        handUi,\r\n        klCanvasWorkspace,\r\n        () => {\r\n            if (!initState) {\r\n                throw new Error('initState not initialized');\r\n            }\r\n            return initState;\r\n        },\r\n        () => klCanvas,\r\n        () => currentLayerCtx,\r\n        (clctx) => {\r\n            currentLayerCtx = clctx;\r\n        },\r\n        () => currentBrush,\r\n    );\r\n    klHistory.addListener((p) => {\r\n        undoRedoCatchup.catchup(p);\r\n    });\r\n\r\n    function showNewImageDialog() {\r\n        KL.newImageDialog({\r\n            currentColor: currentColor,\r\n            secondaryColor: klColorSlider.getSecondaryRGB(),\r\n            maxCanvasSize: klMaxCanvasSize,\r\n            canvasWidth: klCanvas.getWidth(),\r\n            canvasHeight: klCanvas.getHeight(),\r\n            workspaceWidth: window.innerWidth < collapseThreshold ? uiWidth : uiWidth - toolWidth,\r\n            workspaceHeight: uiHeight,\r\n            onConfirm: function(width, height, color) {\r\n                klCanvas.reset({\r\n                    width: width,\r\n                    height: height,\r\n                    color: color.a === 1 ? color : null\r\n                });\r\n\r\n                layerManager.update(0);\r\n                setCurrentLayer(klCanvas.getLayer(0));\r\n                klCanvasWorkspace.resetView();\r\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n                isFirstImage = false;\r\n            },\r\n            onCancel: function() {}\r\n        });\r\n    }\r\n\r\n    function shareImage(callback?) {\r\n        BB.shareCanvas({\r\n            canvas: klCanvas.getCompleteCanvas(1),\r\n            fileName: BB.getDate() + filenameBase + '.png',\r\n            title: BB.getDate() + filenameBase + '.png',\r\n            callback: callback ? callback : function() {}\r\n        });\r\n    }\r\n\r\n    const saveToComputer = new KL.SaveToComputer(\r\n        pOptions.saveReminder,\r\n        klRootEl,\r\n        () => exportType,\r\n        () => klCanvas,\r\n        filenameBase,\r\n    );\r\n\r\n    const fileTab = pOptions.embed ? null : new KL.FileTab(\r\n        klRootEl,\r\n        projectStore,\r\n        () => klCanvas.getProject(),\r\n        exportType,\r\n        (type) => {\r\n            exportType = type;\r\n        },\r\n        handleFileSelect,\r\n        () => {\r\n            saveToComputer.save();\r\n        },\r\n        showNewImageDialog,\r\n        shareImage,\r\n        () => { // on upload\r\n            KL.imgurUpload(klCanvas, klRootEl, pOptions.saveReminder, pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : null, );\r\n        },\r\n        copyToClipboard,\r\n        pOptions.saveReminder,\r\n    );\r\n\r\n    const settingsTab = new KL.SettingsTab(\r\n        () => {\r\n            uiState = uiState === 'left' ? 'right' : 'left';\r\n            updateUi();\r\n            if (!pOptions.embed) {\r\n                LocalStorage.setItem('uiState', uiState);\r\n            }\r\n        },\r\n        pOptions.aboutEl\r\n    );\r\n\r\n    mainTabRow = new KL.TabRow({\r\n        initialId: 'draw',\r\n        tabArr: [\r\n            {\r\n                id: 'draw',\r\n                title: LANG('tool-brush'),\r\n                image: toolPaintImg,\r\n                onOpen: function() {\r\n                    if (currentBrushId === 'eraserBrush') {\r\n                        klColorSlider.enable(false);\r\n                    }\r\n                    BB.append(\r\n                        colorDiv,\r\n                        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n                    );\r\n                    brushDiv.style.display = 'block';\r\n                },\r\n                onClose: function() {\r\n                    brushDiv.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'hand',\r\n                title: LANG('tool-hand'),\r\n                image: toolHandImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    handUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    handUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'fill',\r\n                title: LANG('tool-paint-bucket'),\r\n                image: toolFillImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    fillUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    fillUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'gradient',\r\n                title: LANG('tool-gradient'),\r\n                image: toolGradientImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    gradientUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    gradientUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'text',\r\n                title: LANG('tool-text'),\r\n                image: toolTextImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    textUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    textUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'shape',\r\n                title: LANG('tool-shape'),\r\n                image: toolShapeImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    shapeUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    shapeUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'layers',\r\n                title: LANG('tab-layers'),\r\n                image: tabLayersImg,\r\n                onOpen: function() {\r\n                    layerManager.update();\r\n                    layerManager.style.display = 'block';\r\n                },\r\n                onClose: function() {\r\n                    layerManager.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'edit',\r\n                label: LANG('tab-edit'),\r\n                onOpen: function() {\r\n                    filterTab.show();\r\n                },\r\n                onClose: function() {\r\n                    filterTab.hide();\r\n                },\r\n                css: {\r\n                    padding: '0 7px',\r\n                },\r\n            },\r\n            {\r\n                id: 'file',\r\n                label: LANG('tab-file'),\r\n                isVisible: !!fileTab,\r\n                onOpen: function() {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'block';\r\n                    fileTab.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'none';\r\n                    fileTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    padding: '0 7px',\r\n                },\r\n            },\r\n            {\r\n                id: 'settings',\r\n                title: LANG('tab-settings'),\r\n                image: tabSettingsImg,\r\n                onOpen: function() {\r\n                    settingsTab.getElement().style.display = 'block';\r\n                    // settingsTab.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    settingsTab.getElement().style.display = 'none';\r\n                    // settingsTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            }\r\n        ]\r\n    });\r\n    function updateMainTabVisibility() {\r\n        if (!mainTabRow) {\r\n            return;\r\n        }\r\n\r\n        let toolObj = {\r\n            'draw': {},\r\n            'hand': {},\r\n            'fill': {},\r\n            'gradient': {},\r\n            'text': {},\r\n            'shape': {}\r\n        };\r\n\r\n        let activeStr = toolspaceToolRow.getActive();\r\n        let oldTabId = mainTabRow.getOpenedTabId();\r\n\r\n        let keysArr = Object.keys(toolObj);\r\n        for (let i = 0; i < keysArr.length; i++) {\r\n            if (activeStr === keysArr[i]) {\r\n                mainTabRow.setIsVisible(keysArr[i], true);\r\n            } else {\r\n                mainTabRow.setIsVisible(keysArr[i], false);\r\n                if (oldTabId === keysArr[i]) {\r\n                    mainTabRow.open(activeStr);\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function copyToClipboard(showCrop?) {\r\n        KL.clipboardDialog(klRootEl, klCanvas.getCompleteCanvas(1), function (inputObj) {\r\n            if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\r\n                return;\r\n            }\r\n            //do a crop\r\n            KL.filterLib.cropExtend.apply({\r\n                context: currentLayerCtx,\r\n                klCanvas: klCanvas,\r\n                input: inputObj, //{left,right,top,bottom}\r\n                history: klHistory\r\n            });\r\n            layerManager.update();\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        }, statusOverlay, showCrop);\r\n    }\r\n\r\n    const bottomBarWrapper = BB.el({\r\n        css: {\r\n            width: \"270px\",\r\n            position: \"absolute\",\r\n            bottom: '0',\r\n            left: '0'\r\n        },\r\n    });\r\n    if (pOptions.bottomBar) {\r\n        bottomBarWrapper.append(pOptions.bottomBar);\r\n        const observer = new MutationObserver(() => updateBottomBar());\r\n        observer.observe(\r\n            toolspaceInner,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n    }\r\n    function updateBottomBar() {\r\n        if (!pOptions.bottomBar) {\r\n            return;\r\n        }\r\n        const threshold = 617; //590\r\n        const isVisible = (\r\n            threshold < window.innerHeight &&\r\n            toolspaceInner.scrollHeight + 50 < window.innerHeight\r\n        );\r\n        bottomBarWrapper.style.display = isVisible ? '' : 'none';\r\n    }\r\n\r\n\r\n\r\n    BB.append(toolspaceInner, [\r\n        layerPreview.getElement(),\r\n        mainTabRow.getElement(),\r\n        brushDiv,\r\n        handUi.getElement(),\r\n        fillUi.getElement(),\r\n        gradientUi.getElement(),\r\n        textUi.getElement(),\r\n        shapeUi.getElement(),\r\n        layerManager,\r\n        filterTab.getElement(),\r\n        fileTab ? fileTab.getElement() : null,\r\n        settingsTab.getElement(),\r\n        BB.el({\r\n            css: {\r\n                height: '10px', // a bit of spacing at the bottom\r\n            }\r\n        }),\r\n        bottomBarWrapper ? bottomBarWrapper : null\r\n    ]);\r\n\r\n    const toolspaceScroller = new KL.ToolspaceScroller({\r\n        toolspace,\r\n        uiState,\r\n    });\r\n\r\n    // --- interface ---\r\n\r\n    this.getEl = () => {\r\n        return klRootEl;\r\n    };\r\n\r\n    this.resize = (w, h) => {\r\n\r\n        // iPad scrolls down when increasing text zoom\r\n        if (window.scrollY > 0) {\r\n            window.scrollTo(0, 0);\r\n        }\r\n\r\n        if (uiWidth === Math.max(0, w) && uiHeight === Math.max(0, h)) {\r\n            return;\r\n        }\r\n\r\n        uiWidth = Math.max(0, w);\r\n        uiHeight = Math.max(0, h);\r\n\r\n        updateCollapse();\r\n        updateBottomBar();\r\n\r\n        layerPreview.setIsVisible(uiHeight >= 579);\r\n        klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n        toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    };\r\n\r\n    this.out = (msg) => {\r\n        statusOverlay.out(msg);\r\n    };\r\n\r\n    this.getPNG = function(): Blob {\r\n        return base64ToBlob(klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\r\n    };\r\n\r\n    this.getPSD = async function() {\r\n        return await klCanvasToPsdBlob(klCanvas);\r\n    };\r\n\r\n    this.getProject = () => klCanvas.getProject();\r\n\r\n    this.swapUiLeftRight = () => {\r\n        uiState = uiState === 'left' ? 'right' : 'left';\r\n        if (!pOptions.embed) {\r\n            LocalStorage.setItem('uiState', uiState);\r\n        }\r\n        updateUi();\r\n    };\r\n\r\n    this.saveAsPsd = () => {\r\n        saveToComputer.save('psd');\r\n    };\r\n\r\n    this.isDrawing = () => {\r\n        return lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n    };\r\n\r\n    // --- end interface ---\r\n\r\n    this.resize(uiWidth, uiHeight);\r\n    updateUi();\r\n\r\n    {\r\n        BB.addEventListener(window, 'resize', () => {\r\n            this.resize(window.innerWidth, window.innerHeight);\r\n        });\r\n        BB.addEventListener(window, 'orientationchange', () => {\r\n            this.resize(window.innerWidth, window.innerHeight);\r\n        });\r\n\r\n        // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\r\n        // Workaround: place a div in the body that fills the window, and use a ResizeObserver\r\n        const windowResizeWatcher = BB.el({\r\n            parent: document.body,\r\n            css: {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n                pointerEvents: 'none',\r\n                zIndex: '-1',\r\n                userSelect: 'none',\r\n            }\r\n        });\r\n        try {\r\n            // Not all browsers support ResizeObserver. Not critical though.\r\n            const observer = new ResizeObserver(() => this.resize(window.innerWidth, window.innerHeight));\r\n            observer.observe(windowResizeWatcher);\r\n        } catch (e) {\r\n            windowResizeWatcher.parentNode.removeChild(windowResizeWatcher);\r\n        }\r\n\r\n        // prevent ctrl scroll -> zooming page\r\n        BB.addEventListener(klRootEl, 'wheel', (event) => {\r\n            if (keyListener.isPressed('ctrl')) {\r\n                event.preventDefault();\r\n            }\r\n        });\r\n        //maybe prevent zooming on safari mac os - todo still needed?\r\n        const prevent = (e) => {\r\n            e.preventDefault();\r\n        }\r\n        window.addEventListener('gesturestart', prevent);\r\n        window.addEventListener('gesturechange', prevent);\r\n        window.addEventListener('gestureend', prevent);\r\n    }\r\n}","import {DecoyKlHistory, klHistory} from './history/kl-history';\r\nimport {Popup, popup} from './ui/modals/popup';\r\nimport {dialogCounter} from './ui/modals/modal-count';\r\nimport {Checkbox} from './ui/base-components/checkbox';\r\nimport {input} from './ui/base-components/input';\r\nimport {Select} from './ui/base-components/select';\r\nimport {ImageToggle} from './ui/base-components/image-toggle';\r\nimport {ImageRadioList} from './ui/base-components/image-radio-list';\r\nimport {penPressureToggle} from './ui/base-components/pen-pressure-toggle';\r\nimport {KlSlider} from './ui/base-components/kl-slider';\r\nimport {calcSliderFalloffFactor} from './ui/base-components/slider-falloff';\r\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\r\nimport {KlColorSlider} from './ui/base-components/kl-color-slider';\r\nimport {KlSmallColorSlider} from './ui/base-components/kl-color-slider-small';\r\nimport {PointSlider} from './ui/base-components/point-slider';\r\nimport {ColorOptions} from './ui/base-components/color-options';\r\nimport {Options} from './ui/base-components/options';\r\nimport {StatusOverlay} from './ui/components/status-overlay';\r\nimport {exportDialog} from './ui/modals/export-dialog-deprecated';\r\nimport {CropCopy} from './ui/components/crop-copy';\r\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\r\nimport {klLayerManager} from './ui/tool-tabs/kl-layer-manager';\r\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\r\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './ui/components/free-transform';\r\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\r\nimport {Cropper} from './ui/components/cropper';\r\nimport {LayerPreview} from './ui/components/layer-preview';\r\nimport {FittedImage} from './ui/components/fitted-image';\r\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\r\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\r\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\r\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\r\nimport {ToolDropdown} from './ui/components/tool-dropdown';\r\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\r\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\r\nimport {TabRow} from './ui/components/tab-row';\r\nimport {HandUi} from './ui/tool-tabs/hand-ui';\r\nimport {FillUi} from './ui/tool-tabs/fill-ui';\r\nimport {TextUi} from './ui/tool-tabs/text-ui';\r\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\r\nimport {newImageDialog} from './ui/modals/new-image-dialog';\r\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\r\nimport {renderText} from './image-operations/render-text';\r\nimport {textToolDialog} from './ui/modals/text-tool-dialog';\r\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\r\nimport {floodFillBits} from './image-operations/flood-fill';\r\nimport * as PSD from './storage/psd';\r\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\r\nimport {KlCanvas} from './canvas/kl-canvas';\r\nimport * as indexedDb from './storage/indexed-db';\r\nimport {filterLib, filterLibStatus} from './filters/filters';\r\nimport {brushes} from './brushes/brushes';\r\nimport {brushesUI} from './brushes-ui/brushes-ui';\r\nimport {showIframePopup} from './ui/modals/show-iframe-popup';\r\nimport {RadioList} from './ui/base-components/radio-list';\r\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\r\nimport {drawProject} from './canvas/draw-project';\r\nimport {ProjectStore} from './storage/project-store';\r\nimport {FileTab} from \"./ui/tool-tabs/file-tab\";\r\nimport {FilterTab} from \"./ui/tool-tabs/filter-tab\";\r\nimport {imgurUpload} from \"./ui/modals/imgur-upload\";\r\nimport {loadAgPsd} from \"./storage/ag-psd-wrapper\";\r\nimport {SaveReminder} from \"./ui/components/save-reminder\";\r\nimport {SaveToComputer} from \"./storage/save-to-computer\";\r\nimport {UndoRedoCatchup} from \"./history/undo-redo-catchup\";\r\nimport {setDbName} from './storage/indexed-db';\r\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\r\nimport {BoxToggle} from './ui/base-components/box-toggle';\r\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\r\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\r\nimport {GradientUi} from './ui/tool-tabs/gradient-ui';\r\nimport {drawGradient, GradientTool} from './image-operations/gradient-tool';\r\n\r\n/**\r\n * paint tool functionality\r\n */\r\nexport const KL = {\r\n\r\n    // --- brushes ---\r\n    brushes,\r\n    brushesUI,\r\n    BrushSettingService,\r\n\r\n    // --- canvas ---\r\n    KlCanvas,\r\n    drawProject,\r\n\r\n    // --- canvas ui ---\r\n    WorkspaceSvgOverlay,\r\n    KlCanvasWorkspace,\r\n    KlCanvasPreview,\r\n\r\n    // --- filters ---\r\n    filterLibStatus,\r\n    filterLib,\r\n\r\n    // --- history ---\r\n    UndoRedoCatchup,\r\n\r\n    // --- image operations ---\r\n    renderText,\r\n    floodFillBits,\r\n    ShapeTool,\r\n    drawShape,\r\n    GradientTool,\r\n    drawGradient,\r\n\r\n    // --- storage ---\r\n    PSD,\r\n    setDbName,\r\n    indexedDb,\r\n    ProjectStore,\r\n    loadAgPsd,\r\n    SaveToComputer,\r\n\r\n    // --- ui - base components ---\r\n    calcSliderFalloffFactor,\r\n    Checkbox,\r\n    input,\r\n    Select,\r\n    ImageToggle,\r\n    ImageRadioList,\r\n    RadioList,\r\n    penPressureToggle,\r\n    KlSlider,\r\n    HexColorDialog,\r\n    KlColorSlider,\r\n    KlSmallColorSlider,\r\n    PointSlider,\r\n    ColorOptions,\r\n    Options,\r\n    BoxToggle,\r\n\r\n    // --- ui - components ---\r\n    StatusOverlay,\r\n    CropCopy,\r\n    FreeTransform,\r\n    FreeTransformCanvas,\r\n    Cropper,\r\n    LayerPreview,\r\n    FittedImage,\r\n    KlImageDropper,\r\n    OverlayToolspace,\r\n    ToolspaceTopRow,\r\n    ToolDropdown,\r\n    ToolspaceToolRow,\r\n    ToolspaceStabilizerRow,\r\n    TabRow,\r\n    ToolspaceCollapser,\r\n    BrowserStorageUi,\r\n    SaveReminder,\r\n    ToolspaceScroller,\r\n\r\n    // --- ui - modals ---\r\n    dialogCounter,\r\n    popup,\r\n    Popup,\r\n    exportDialog,\r\n    clipboardDialog,\r\n    showImportAsLayerDialog,\r\n    newImageDialog,\r\n    textToolDialog,\r\n    showImportImageDialog,\r\n    showIframePopup,\r\n    imgurUpload,\r\n\r\n    // --- ui - tool tabs ---\r\n    HandUi,\r\n    FillUi,\r\n    GradientUi,\r\n    TextUi,\r\n    ShapeUi,\r\n    FileTab,\r\n    FilterTab,\r\n    SettingsTab,\r\n    klLayerManager,\r\n\r\n\r\n    klHistory,\r\n    DecoyKlHistory,\r\n};","\r\nexport interface IHistoryEntry {\r\n    tool: string[];\r\n    action?: string;\r\n    params?: any[];\r\n\r\n    actions?: {\r\n        action: string;\r\n        params: any[];\r\n    }[]\r\n}\r\n\r\nexport interface IHistoryBroadcast {\r\n    bufferUpdate: IHistoryEntry;\r\n}\r\n\r\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\r\n\r\nlet historyInstance: boolean = false;\r\n\r\nexport interface KlHistoryInterface {\r\n    pause (b: boolean): void;\r\n    addListener (l: IHistoryListener): void;\r\n    push (e: IHistoryEntry): void;\r\n    undo (): (IHistoryEntry | null)[];\r\n    redo (): (IHistoryEntry | null)[];\r\n    getAll (): (IHistoryEntry | null)[];\r\n    canRedo (): boolean;\r\n    canUndo (): boolean;\r\n    getState (): number;\r\n    getActionNumber (): number;\r\n}\r\n\r\nexport class DecoyKlHistory implements KlHistoryInterface {\r\n    pause (b: boolean): void {}\r\n    addListener (l: IHistoryListener): void {}\r\n    push (e: IHistoryEntry): void {}\r\n    undo (): (IHistoryEntry | null)[] { return []; }\r\n    redo (): (IHistoryEntry | null)[] { return []; }\r\n    getAll (): (IHistoryEntry | null)[] { return []; }\r\n    canRedo (): boolean { return false; }\r\n    canUndo (): boolean { return false; }\r\n    getState (): number { return 0; }\r\n    getActionNumber (): number { return 0; }\r\n}\r\n\r\nexport class KlHistory implements KlHistoryInterface {\r\n\r\n    private state: number; // on .push state increments by one\r\n    private dataArr: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\r\n    private listeners: IHistoryListener[];\r\n    private pauseStack: number; // how often paused without unpause\r\n    private readonly max: number = 20; // max number undo steps\r\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\r\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\r\n    \r\n    private broadcast (p: IHistoryBroadcast | null): void {\r\n        setTimeout(() => {\r\n            for (let i = 0; i < this.listeners.length; i++) {\r\n                this.listeners[i](p);\r\n            }\r\n            this.state++;\r\n        }, 1);\r\n    }\r\n    \r\n    // ---- public ----\r\n    \r\n    constructor () {\r\n        if (historyInstance) {\r\n            throw new Error('klHistory already instantiated');\r\n        }\r\n        historyInstance = true;\r\n        this.state = 0;\r\n        this.dataArr = [];\r\n        this.listeners = [];\r\n        this.pauseStack = 0;\r\n        this.maxState = -1;\r\n        this.actionNumber = -1;\r\n    }\r\n\r\n    /**\r\n     * you need pause because there are sometimes actions that would cause other\r\n     * undo steps\r\n     * for example a filter that does something crazy with two layers and then merges them\r\n     * you want that to be one undo step, and prevent merging from causing its undo step.\r\n     * so while that filter is doing its magic you should pause possible undo steps that\r\n     * are caused by a part of its code(in this example: merging layers)\r\n     *\r\n     * @param b\r\n     */\r\n    pause (b: boolean): void {\r\n        if (b === false) {\r\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\r\n        } else {\r\n            this.pauseStack++;\r\n        }\r\n    }\r\n\r\n    addListener (l: IHistoryListener): void {\r\n        this.listeners.push(l);\r\n    }\r\n\r\n    push (e: IHistoryEntry): void {\r\n        if (this.pauseStack > 0) {\r\n            return;\r\n        }\r\n        while (this.actionNumber < this.dataArr.length - 1) {\r\n            this.dataArr.pop();\r\n        }\r\n\r\n        //taking care of actions that shouldn't cause a new undo step\r\n        const top = this.dataArr[this.dataArr.length - 1];\r\n        if (e.action === 'layerOpacity' && top && top.action === 'layerOpacity' && top.params[0] === e.params[0]) {\r\n            this.dataArr[this.dataArr.length - 1] = e;\r\n            this.state++; //still needs to increment because something changed\r\n            return;\r\n        }\r\n        if (e.action === 'focusLayer' && top && top.action === 'focusLayer') {\r\n            this.dataArr[this.dataArr.length - 1] = e;\r\n            this.state++;\r\n            return;\r\n        }\r\n\r\n\r\n        this.dataArr[this.dataArr.length] = e;\r\n        this.actionNumber = this.dataArr.length - 1;\r\n        const maxBefore = this.maxState;\r\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\r\n        if (maxBefore < this.maxState) {\r\n            this.broadcast({bufferUpdate: this.dataArr[this.maxState]});\r\n        } else {\r\n            this.broadcast(null);\r\n        }\r\n        if (this.maxState >= 0) {\r\n            this.dataArr[this.maxState] = null; //to free some memory...imported images take a lot of space\r\n        }\r\n    }\r\n\r\n    undo (): (IHistoryEntry | null)[] {\r\n        let result;\r\n        if (this.canUndo()) {\r\n            result = [];\r\n            for (let i = this.maxState + 1; i < this.actionNumber; i++) {\r\n                result.push(this.dataArr[i]);\r\n            }\r\n            this.actionNumber--;\r\n            this.broadcast(null);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    redo (): (IHistoryEntry | null)[] {\r\n        const result = [];\r\n        if (this.canRedo()) {\r\n            this.actionNumber++;\r\n            result.push(this.dataArr[this.actionNumber]);\r\n            this.broadcast(null);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    getAll (): (IHistoryEntry | null)[] {\r\n        return [].concat(this.dataArr);\r\n    }\r\n\r\n    canRedo (): boolean {\r\n        return this.actionNumber < this.dataArr.length - 1;\r\n    }\r\n\r\n    canUndo (): boolean {\r\n        return this.actionNumber > this.maxState;\r\n    }\r\n\r\n    getState (): number {\r\n        return this.state;\r\n    }\r\n\r\n    /**\r\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\r\n     */\r\n    getActionNumber (): number {\r\n        return (this.actionNumber + 1);\r\n    }\r\n    \r\n}\r\n\r\nexport const klHistory = new KlHistory();\r\n","import {dialogCounter} from './modal-count';\r\nimport {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport checkImg from 'url:~/src/app/img/ui/check.svg';\r\n// @ts-ignore\r\nimport cancelImg from 'url:~/src/app/img/ui/cancel.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\nwindow.onscroll = (e) => {\r\n    e.preventDefault();\r\n}\r\n\r\nexport function popup (\r\n    p: {\r\n        target: HTMLElement;\r\n        div?: HTMLElement; // node with content\r\n        message: string; // can be html\r\n        callback?: (result: string) => void;\r\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\r\n        primaries?: string[];\r\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\r\n        closefunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\r\n        style?: IKeyString;\r\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\r\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\r\n        ignoreBackground?: boolean; // deafult false; if true clicking on background doesn't close\r\n    }\r\n): void {\r\n    dialogCounter.increase();\r\n    let isClosed = false;\r\n\r\n\r\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\r\n    const rootRootEl = BB.el({\r\n        parent: document.body,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n    const rootEl = BB.el({\r\n        parent: rootRootEl,\r\n        className: 'kl-popup',\r\n    });\r\n\r\n    const scrollContent = BB.el({\r\n        parent: rootEl,\r\n        css: {\r\n            width: '100%',\r\n            minHeight: '100%',\r\n            // padding: '10px 0',\r\n            position: 'relative',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n        }\r\n    });\r\n\r\n    const bgEl = BB.el({\r\n        parent: scrollContent,\r\n        onClick: () => {\r\n            if (p.ignoreBackground) {\r\n                return;\r\n            }\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            zIndex: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n        }\r\n    });\r\n\r\n    const titleHeight = 40;\r\n    const xButton = BB.el({\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: () => {\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            position: 'absolute',\r\n            right: '0',\r\n            top: '0',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        }\r\n    });\r\n\r\n    const boxClasses = ['kl-popup-box'];\r\n    boxClasses.push('kl-popup-box--sm');\r\n    const boxEl = BB.el({\r\n        content: [\r\n            xButton,\r\n            BB.el({\r\n                content:p.message,\r\n                css: {\r\n                    marginBottom: p.div ? '10px' : null,\r\n                    marginRight: '15px',\r\n                }\r\n            }),\r\n            p.div,\r\n        ],\r\n        className: boxClasses.join(' '),\r\n        css: p.style ? p.style : null,\r\n    });\r\n\r\n    scrollContent.append(\r\n        BB.el({\r\n            css: {\r\n                flex: '0.5',\r\n            }\r\n        }),\r\n        boxEl,\r\n        BB.el({\r\n            css: {\r\n                flex: '1',\r\n            }\r\n        })\r\n    );\r\n\r\n    if (p.type === 'error') {\r\n        boxEl.classList.add('poperror');\r\n    }\r\n    if (p.type === 'ok') {\r\n        boxEl.classList.add('popok');\r\n    }\r\n    if (p.type === 'warning') {\r\n        boxEl.classList.add('popwarning');\r\n    }\r\n    if (p.type === 'upload') {\r\n        boxEl.classList.add('popupload');\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (isClosed) {\r\n                return;\r\n            }\r\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\r\n                e.stopPropagation();\r\n                setTimeout(function() {\r\n                    clickOnEnterBtn.click();\r\n                }, 10);\r\n            }\r\n            if (comboStr === 'esc') {\r\n                e.stopPropagation();\r\n                close('Cancel');\r\n            }\r\n        }\r\n    });\r\n    // prevent ctrl scroll -> zooming page\r\n    const wheelPrevent = (event) => {\r\n        if (keyListener.isPressed('ctrl')) {\r\n            event.preventDefault();\r\n        }\r\n    };\r\n    BB.addEventListener(rootEl, 'wheel', wheelPrevent);\r\n    rootEl.onclick = BB.handleClick;\r\n\r\n    let autoFocus = null;\r\n    if (p.autoFocus) {\r\n        autoFocus = p.autoFocus;\r\n    } else if (p.autoFocus === false) {\r\n        autoFocus = null;\r\n    } else {\r\n        autoFocus = 'Ok';\r\n    }\r\n\r\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\r\n        parent: boxEl,\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            justifyContent: 'flex-end',\r\n            marginTop: '12px', // 8px already via buttons\r\n            marginLeft: '-8px',\r\n        }\r\n    }) : null;\r\n    let clickOnEnterBtn;\r\n    const btnElArr = [];\r\n    if (p.buttons) {\r\n        p.buttons.forEach(buttonName => {\r\n            const btnClasses = ['kl-popup__btn'];\r\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\r\n                btnClasses.push('kl-button-primary');\r\n            }\r\n            let iconUrl;\r\n            let label = buttonName;\r\n            if (buttonName === 'Ok') {\r\n                label = LANG('modal-ok');\r\n                iconUrl = checkImg;\r\n            }\r\n            if (buttonName === 'Cancel') {\r\n                label = LANG('modal-cancel');\r\n                iconUrl = cancelImg;\r\n            }\r\n            let iconImg = null;\r\n            if (iconUrl) {\r\n                iconImg = BB.el({\r\n                    tagName: 'img',\r\n                    custom: {\r\n                        src: iconUrl,\r\n                        height: '17',\r\n                    }\r\n                });\r\n            }\r\n            const btn = BB.el({\r\n                parent: buttonRowEl,\r\n                tagName: 'button',\r\n                className: btnClasses.join(' '),\r\n                content: [iconImg, label],\r\n                onClick: () => {\r\n                    close(buttonName);\r\n                },\r\n            });\r\n            btnElArr.push(btn);\r\n            if (autoFocus === buttonName) {\r\n                setTimeout(() => {\r\n                    btn.focus();\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 10);\r\n                setTimeout(() => {\r\n                    // safari needs a separate timeout\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 20);\r\n            }\r\n            if (buttonName === p.clickOnEnter) {\r\n                clickOnEnterBtn = btn;\r\n            }\r\n        });\r\n    }\r\n\r\n    function close (value: string) {\r\n        if (isClosed) {\r\n            return;\r\n        }\r\n\r\n        isClosed = true;\r\n        BB.clearSelection();\r\n        BB.unfocusAnyInput();\r\n        document.body.removeChild(rootRootEl);\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        keyListener.destroy();\r\n        BB.removeEventListener(rootEl, 'wheel', wheelPrevent);\r\n        rootEl.onclick = null;\r\n        btnElArr.forEach(item => {\r\n            BB.destroyEl(item);\r\n        });\r\n        btnElArr.splice(0, btnElArr.length);\r\n\r\n        if (p.callback) {\r\n            p.callback(value);\r\n        }\r\n    }\r\n\r\n    if (p.closefunc) {\r\n        p.closefunc(function () {\r\n            close('Cancel');\r\n        });\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * popups that fill whole height, with some padding.\r\n * currently only used for iframe popups.\r\n *\r\n * p = {\r\n *      title: DOM Element | string, // optional (todo allow string)\r\n *      icon: 'ok', // optional todo\r\n *      content: DOM Element, // optional\r\n *      buttonArr: [ // optional todo\r\n *          'Ok',\r\n *          'Cancel'\r\n *      ],\r\n *      autoFocus: string | false, //todo\r\n *      clickOnEnter: string, //todo\r\n *      onClose: function(result: string), // optional (todo result)\r\n *\r\n *      //size and position\r\n *      width: 500,\r\n *      isMaxHeight: boolean //todo, currently always true\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const Popup = function(p) {\r\n    dialogCounter.increase();\r\n    const parent = document.body;\r\n    const div = BB.el({\r\n        parent: parent,\r\n        className: 'g-root',\r\n        css: {\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0',\r\n            background: 'rgba(0, 0, 0, 0.45)',\r\n            overflow: 'auto',\r\n            animationName: 'consoleIn',\r\n            animationDuration: '0.3s',\r\n            animationTimingFunction: 'ease-out'\r\n        }\r\n    });\r\n    div.onclick = BB.handleClick;\r\n\r\n    let updateInterval;\r\n\r\n    function close() {\r\n        dialogCounter.decrease();\r\n        div.onclick = null;\r\n        parent.removeChild(div);\r\n        clearInterval(updateInterval);\r\n        window.removeEventListener('resize', updatePos);\r\n        keyListener.destroy();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        if (p.onClose) {\r\n            p.onClose();\r\n        }\r\n    }\r\n\r\n    //background element registering clicks\r\n    const bgEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0'\r\n        },\r\n        onClick: close\r\n    });\r\n\r\n    //the actual popup box\r\n    const popupEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            width: (BB.isCssMinMaxSupported() ?\r\n                'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\r\n                (p.width ? p.width : 400) + 'px'),\r\n            height: 'calc(100% - 40px)',\r\n            background: '#eee',\r\n            borderRadius: '10px',\r\n            overflow: 'hidden',\r\n            boxShadow: 'rgba(0, 0, 0, 0.25) 0px 5px 60px'\r\n        }\r\n    });\r\n\r\n    //x and y position via script. flex not powerful enough imo\r\n    function updatePos() {\r\n        const elW = popupEl.offsetWidth;\r\n        const elH = popupEl.offsetHeight;\r\n\r\n        BB.css(popupEl, {\r\n            left: Math.max(0, (window.innerWidth - elW) / 2) + 'px',\r\n            top: Math.max(20, (window.innerHeight - elH) / 2 - (elH * 0.20)) + 'px'\r\n        });\r\n    }\r\n    //todo also update when popup changes size - resizeobserver and fallback\r\n    //updateInterval = setInterval(updatePos, 100);\r\n    updatePos();\r\n    window.addEventListener('resize', updatePos);\r\n\r\n    //title row in popup\r\n    const titleHeight = 40;\r\n    const titleEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: titleHeight + 'px',\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            paddingLeft: (titleHeight / 2) + 'px'\r\n        }\r\n    });\r\n    if (p.title) {\r\n        titleEl.appendChild(p.title);\r\n    }\r\n    const xButton = BB.el({\r\n        parent: titleEl,\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: close,\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        },\r\n        custom: {\r\n            tabindex: '0',\r\n        }\r\n    });\r\n\r\n    const contentEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: 'calc(100% - ' + titleHeight + 'px)'\r\n        }\r\n    });\r\n    if (p.content) {\r\n        contentEl.appendChild(p.content);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e) {\r\n            if (keyStr === 'esc') {\r\n                e.stopPropagation();\r\n                close();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n    this.close = function() {\r\n        close();\r\n    };\r\n};","\r\n// not the best\r\n\r\n/**\r\n * how many modals are open\r\n */\r\n\r\nexport class DialogCounter {\r\n    private listeners: ((v: number) => void)[] = [];\r\n    private count = 0;\r\n\r\n    private emit (): void {\r\n        this.listeners.forEach(item => {\r\n            item(this.count);\r\n        });\r\n    }\r\n\r\n    increase (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count += v;\r\n        } else {\r\n            this.count++;\r\n        }\r\n        this.emit();\r\n    }\r\n    decrease (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count -= v;\r\n        } else {\r\n            this.count--;\r\n        }\r\n        this.emit();\r\n    }\r\n    get (): number {\r\n        return this.count;\r\n    }\r\n    subscribe (listener: (v: number) => void): void {\r\n        this.listeners.push(listener);\r\n    }\r\n}\r\n\r\nexport const dialogCounter = new DialogCounter();\r\n","import * as BBEventListener from './input/event-listener';\r\nimport {\r\n    append, centerWithin, copyObj, createSvg,\r\n    css, dateDayDifference, decToFraction,\r\n    fitInto, gcd, getDate,\r\n    handleClick, imageBlobToUrl,\r\n    insertAfter, loadImage,\r\n    reduce,\r\n    setAttributes, shareCanvas\r\n} from './base/base';\r\nimport {\r\n    canShareFiles,\r\n    eventUsesHighResTimeStamp,\r\n    getVisitor,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    isCssMinMaxSupported,\r\n    mouseEventHasMovement\r\n} from './base/browser';\r\nimport {KeyListener, sameKeys} from './input/key-listener';\r\nimport {PointerListener} from './input/pointer-listener';\r\nimport * as EventChain from './input/event-chain';\r\nimport {\r\n    canvasBounds,\r\n    convertToAlphaChannelCanvas,\r\n    copyCanvas,\r\n    createCheckerCanvas, createCheckerDataUrl,\r\n    drawTransformedImageOnCanvas,\r\n    drawTransformedImageWithBounds, freeCanvas, resizeCanvas, testShouldPixelate\r\n} from './base/canvas';\r\nimport {Matrix} from './math/matrix';\r\nimport {Vec2} from './math/vec2';\r\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\r\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\r\nimport {\r\n    appendTextDiv,\r\n    clearSelection,\r\n    destroyEl,\r\n    el,\r\n    isInputFocused,\r\n    makeUnfocusable,\r\n    unfocusAnyInput\r\n} from './base/ui';\r\nimport {\r\n    pointsToAngleDeg,\r\n    clamp,\r\n    dist,\r\n    mix,\r\n    pointsToAngleRad,\r\n    rotate,\r\n    rotateAround,\r\n    intDxy,\r\n    roundEven, roundUneven, distSquared, lenSquared, updateBounds, boundsInArea, round, isInsideRect\r\n} from './math/math';\r\nimport {createCanvas} from './base/create-canvas';\r\nimport {BbLog} from './base/bb-log';\r\nimport {LocalStorage} from './base/local-storage';\r\n\r\nexport const BB = {\r\n\r\n    // ---- browser ----\r\n    eventUsesHighResTimeStamp,\r\n    mouseEventHasMovement,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    getVisitor,\r\n    isCssMinMaxSupported,\r\n    canShareFiles,\r\n\r\n    // ---- base ----\r\n    insertAfter,\r\n    loadImage,\r\n    css,\r\n    setAttributes,\r\n    append,\r\n    fitInto,\r\n    centerWithin,\r\n    getDate,\r\n    gcd,\r\n    reduce,\r\n    decToFraction,\r\n    imageBlobToUrl,\r\n    dateDayDifference,\r\n    copyObj,\r\n    shareCanvas,\r\n    handleClick,\r\n    createSvg,\r\n    BbLog,\r\n    LocalStorage,\r\n\r\n    // ---- math ----\r\n    mix,\r\n    dist,\r\n    distSquared,\r\n    lenSquared,\r\n    pointsToAngleRad,\r\n    pointsToAngleDeg,\r\n    isInsideRect,\r\n    clamp,\r\n    rotate,\r\n    rotateAround,\r\n    Matrix,\r\n    Vec2,\r\n    intDxy,\r\n    roundEven,\r\n    roundUneven,\r\n    round,\r\n    updateBounds,\r\n    boundsInArea,\r\n\r\n    // ---- line ----\r\n    projectPointOnLine,\r\n    PointLine,\r\n    BezierLine,\r\n    SplineInterpolator,\r\n    quadraticSplineInput,\r\n\r\n    // ---- canvas ----\r\n    canvas: createCanvas,\r\n    copyCanvas,\r\n    testShouldPixelate,\r\n    drawTransformedImageWithBounds,\r\n    drawTransformedImageOnCanvas,\r\n    createCheckerCanvas,\r\n    createCheckerDataUrl,\r\n    resizeCanvas,\r\n    convertToAlphaChannelCanvas,\r\n    freeCanvas,\r\n    canvasBounds,\r\n\r\n    // ---- color ----\r\n    HSV,\r\n    RGB,\r\n    CMYK,\r\n    ColorConverter,\r\n    testIsWhiteBestContrast,\r\n\r\n    // ---- UI ----\r\n    appendTextDiv,\r\n    clearSelection,\r\n    makeUnfocusable,\r\n    el,\r\n    destroyEl,\r\n    isInputFocused,\r\n    unfocusAnyInput,\r\n\r\n\r\n    // ---- events / input ----\r\n\r\n    addEventListener: BBEventListener.addEventListener,\r\n    removeEventListener: BBEventListener.removeEventListener,\r\n    setEventListener: BBEventListener.setEventListener,\r\n\r\n    KeyListener,\r\n    PointerListener,\r\n    sameKeys,\r\n\r\n    EventChain,\r\n\r\n};\r\n","import {hasPointerEvents} from '../base/browser';\r\n\r\nconst listenerFuncObj = {}; // for debugging\r\n\r\nexport const setEventListener = function (DomEl, type, listener) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    DomEl[type] = listener;\r\n};\r\n\r\nexport const addEventListener = function (DomEl, type, listener, options?) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    /*if (!(type in listenerFuncObj)) {\r\n        listenerFuncObj[type] = [];\r\n    }\r\n    listenerFuncObj[type].push(listener);*/\r\n    DomEl.addEventListener(type, listener, options);\r\n};\r\n\r\nexport const removeEventListener = function (DomEl, type, listener, options?) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    /*if (type in listenerFuncObj) {\r\n        for (let i = 0; i < listenerFuncObj[type].length; i++) {\r\n            if (listenerFuncObj[type][i] === listener) {\r\n                listenerFuncObj[type].splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }*/\r\n    DomEl.removeEventListener(type, listener, options);\r\n};","import {createCanvas} from './create-canvas';\r\n\r\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n\r\nexport const eventUsesHighResTimeStamp = (function() {\r\n\r\n    let eventUsesHighResTimeStamp: boolean | null = null;\r\n    if (document.body) {\r\n        (function() {\r\n            const event = new Event('');\r\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\r\n        })();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function(event) {\r\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\r\n        });\r\n    }\r\n\r\n    return function(): boolean {\r\n        if (eventUsesHighResTimeStamp === null) {\r\n            throw 'eventUsesHighResTimeStamp not initialized';\r\n        }\r\n        return eventUsesHighResTimeStamp;\r\n    }\r\n})();\r\n\r\nexport const mouseEventHasMovement = (() => {\r\n\r\n    // no support: IE, Safari, Safari iOS\r\n    // supported but broken: Firefox\r\n\r\n    if (!('MouseEvent' in window)) {\r\n        return false;\r\n    }\r\n    let mouseEvent;\r\n    try {\r\n        mouseEvent = new MouseEvent('mousemove'); // browsers not supporting the constructor don't have it\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n    if (!('movementX' in mouseEvent)) {\r\n        return false; // likely safari\r\n    }\r\n    return !isFirefox;\r\n})();\r\n\r\nexport const hasPointerEvents = !!window.PointerEvent;\r\n\r\nexport const hasWebGl = (function() {\r\n\r\n    const hasWebgl = (function() {\r\n        const canvas = createCanvas();\r\n        try {\r\n            canvas.getContext('experimental-webgl', { premultipliedAlpha: false });\r\n            return true;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    })();\r\n\r\n    return function() {\r\n        return hasWebgl;\r\n    }\r\n})();\r\n\r\nexport const getVisitor = (function () {\r\n    const visitor = {\r\n        chrome: false,\r\n        gl: false\r\n    };\r\n    //Chrome\r\n    if ((window as any).chrome && (window as any).chrome.app) {\r\n        visitor.chrome = true;\r\n    }\r\n    //WebGL\r\n    visitor.gl = hasWebGl();\r\n    return function () {\r\n        return JSON.parse(JSON.stringify(visitor));\r\n    }\r\n})();\r\n\r\nexport const isCssMinMaxSupported = (function() {\r\n    let result: boolean | null = null;\r\n\r\n    function test() {\r\n        const div = document.createElement('div');\r\n        div.style.position = 'absolute';\r\n        div.style.top = '0';\r\n        div.style.left = 'max(0px, 25px)';\r\n        document.body.appendChild(div);\r\n        setTimeout(function() {\r\n            result = div.offsetLeft === 25;\r\n            document.body.removeChild(div);\r\n        }, 25);\r\n    }\r\n\r\n    if (document.body) {\r\n        test();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function() {\r\n            test();\r\n        });\r\n    }\r\n\r\n    return function(): boolean {\r\n        if (result === null) {\r\n            throw new Error('isCssMinMaxSupported not initialized');\r\n        }\r\n        return result;\r\n    };\r\n})();\r\n\r\nexport const canShareFiles = function(): boolean {\r\n    return 'share' in navigator && 'canShare' in navigator;\r\n};","/*window['canvases'] = [];\r\n\r\nwindow['printCanvases'] = () => {\r\n    let total = 0;\r\n\r\n    console.log(window['canvases'].map(item => {\r\n        total += item.width * item.height;\r\n        return {w: item.width, h: item.height};\r\n    }));\r\n\r\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\r\n};*/\r\n\r\nexport function createCanvas(w?: number, h?: number): HTMLCanvasElement {\r\n    const result = document.createElement('canvas');\r\n    if (w && h) {\r\n        result.width = w;\r\n        result.height = h;\r\n    }\r\n    // window['canvases'].push(result);\r\n    return result;\r\n}","import {IKeyString, ISize2D, ISVG, IVector2D} from '../BB.types';\r\n\r\nexport function insertAfter (referenceNode: Element, newNode: Element): void {\r\n    if (referenceNode.parentNode) {\r\n        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\r\n    }\r\n}\r\n\r\nexport function loadImage (im: HTMLImageElement, callback: () => void): void {\r\n    let counter = 0;\r\n\r\n    function check() {\r\n        if (counter === 1000) {\r\n            alert(\"couldn't load\");\r\n            return;\r\n        }\r\n        if (im.complete) {\r\n            counter++;\r\n            callback();\r\n        } else {\r\n            setTimeout(check, 1);\r\n        }\r\n    }\r\n\r\n    check();\r\n}\r\n\r\nexport function css (el: HTMLElement | SVGElement, styleObj: IKeyString): void {\r\n    const keyArr = Object.keys(styleObj);\r\n    let keyStr: string;\r\n    const style = (el.style as unknown) as IKeyString;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        style[keyStr] = styleObj[keyStr];\r\n        style.alignContent = 'true';\r\n        if (keyStr === 'userSelect') {\r\n            style.webkitUserSelect = styleObj[keyStr]; // safari\r\n        }\r\n    }\r\n}\r\n\r\nexport function setAttributes (el: HTMLElement, attrObj: IKeyString): void {\r\n    const keyArr = Object.keys(attrObj);\r\n    let keyStr;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        el.setAttribute(keyStr, attrObj[keyStr]);\r\n    }\r\n}\r\n\r\n/**\r\n * appendChild with an array\r\n * @param target\r\n * @param els\r\n */\r\nexport function append(target: HTMLElement, els: (HTMLElement | string | null)[]) {\r\n    const fragment = document.createDocumentFragment();\r\n    els.forEach(item => item ? fragment.append(item) : null);\r\n    target.append(fragment);\r\n}\r\n\r\n/**\r\n * a needs to fit into b\r\n * @param aw\r\n * @param ah\r\n * @param bw\r\n * @param bh\r\n * @param min\r\n */\r\nexport function fitInto (aw: number, ah: number, bw: number, bh: number, min?: number): ISize2D {\r\n    let width = aw * bw, height = ah * bw;\r\n    if (width > bw) {\r\n        height = bw / width * height;\r\n        width = bw;\r\n    }\r\n    if (height > bh) {\r\n        width = bh / height * width;\r\n        height = bh;\r\n    }\r\n    if (min) {\r\n        width = Math.max(min, width);\r\n        height = Math.max(min, height);\r\n    }\r\n    return {width, height};\r\n}\r\n\r\n/**\r\n * center b in a\r\n * @param aw\r\n * @param ah\r\n * @param bw\r\n * @param bh\r\n */\r\nexport function centerWithin (aw: number, ah: number, bw: number, bh: number): IVector2D {\r\n    return {\r\n        x: aw / 2 - bw / 2,\r\n        y: ah / 2 - bh / 2\r\n    };\r\n}\r\n\r\nexport function getDate (): string {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\r\n    const day = date.getDate().toString().padStart(2, '0');\r\n    const minutes = (date.getHours() * 60 + date.getMinutes()).toString(36).padStart(3, '0');\r\n\r\n    return year + '_' + month + '_' + day + '_' + minutes + '_';\r\n}\r\n\r\nexport function gcd (a: number, b: number): number {\r\n    return b ? gcd(b, a % b) : a;\r\n}\r\n\r\nexport function reduce (numerator: number, denominator: number): [number, number] {\r\n    const g = gcd(numerator, denominator);\r\n    return [numerator / g, denominator / g];\r\n}\r\n\r\nexport function decToFraction (decimalNumber: number): [number, number] {\r\n    const len = decimalNumber.toString().length - 2;\r\n    const denominator = Math.pow(10, len);\r\n    const numerator = decimalNumber * denominator;\r\n    return reduce(numerator, denominator);\r\n}\r\n\r\n/**\r\n * blobObj isn't always a Blob, but rather an object, because Blob doesn't exist.\r\n * @param blobObj\r\n * @returns {string}\r\n */\r\nexport function imageBlobToUrl(blobObj: Blob): string {\r\n    if (!blobObj) {\r\n        throw new Error('blobObj is undefined or null');\r\n    }\r\n    if (window.Blob && blobObj instanceof Blob) {\r\n        return URL.createObjectURL(blobObj); // object url\r\n    } else if (blobObj.constructor.name === 'Object') {\r\n        const fauxBlob = (blobObj as unknown) as {type: string, encoding: string, data: string};\r\n        return 'data:' + fauxBlob.type + ';' + fauxBlob.encoding + ',' + fauxBlob.data; // data url\r\n    } else {\r\n        throw new Error('unknown blob format');\r\n    }\r\n}\r\n\r\nexport function dateDayDifference (dateA: string | Date, dateB: string | Date): number {\r\n    dateA = new Date(dateA);\r\n    dateB = new Date(dateB);\r\n    dateA.setHours(0, 0, 0, 0);\r\n    dateB.setHours(0, 0, 0, 0);\r\n    return (dateB.getTime() - dateA.getTime()) / (1000 * 60 * 60 * 24);\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\r\nexport function copyObj (obj: any): any {\r\n    return JSON.parse(JSON.stringify(obj));\r\n}\r\n\r\n/**\r\n * triggers Web Share API - share feature on mobile devices\r\n * Only works if they support file sharing - e.g. Safari can't do this yet\r\n * only call if BB.canShareFiles() -> true\r\n *\r\n * p = {\r\n *     canvas: Canvas,\r\n *     fileName: string,\r\n *     title: string\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function shareCanvas (p: {canvas: HTMLCanvasElement, fileName:string, title: string, callback: () => void}): void {\r\n    const mimetype = 'image/png';\r\n    const err = () => alert('sharing not supported');\r\n    p.canvas.toBlob(function(blob) {\r\n        if (blob === null) {\r\n            err();\r\n            p.callback();\r\n            return;\r\n        }\r\n        try {\r\n            const filesArray = [new File([blob], p.fileName, {type: mimetype})];\r\n            navigator.share({\r\n                title: p.title,\r\n                files: filesArray,\r\n            } as any)\r\n                .then(r => {\r\n\r\n                })\r\n                .catch(e => {\r\n                    err();\r\n            });\r\n        } catch(e) {\r\n            err();\r\n        }\r\n        p.callback();\r\n    }, mimetype);\r\n}\r\n\r\n/**\r\n * Prevent ipad from zooming in when double tapping. iPadOS 13 bug.\r\n * Give it your click event\r\n *\r\n * @param clickEvent\r\n * @returns {boolean}\r\n */\r\nexport function handleClick (clickEvent: MouseEvent): boolean {\r\n    const target: HTMLElement | null = clickEvent.target as HTMLElement;\r\n    if (!target) {\r\n        return false;\r\n    }\r\n    if (['A', 'LABEL', 'INPUT'].includes(target.tagName) || (target as any).allowClick) {\r\n        return true;\r\n    }\r\n    clickEvent.preventDefault();\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n * @param el {elementType: string, childrenArr: []el, ...svg attributes...}\r\n * @returns svg element tree\r\n */\r\nexport function createSvg (el: ISVG): SVGElement {\r\n    const result = document.createElementNS('http://www.w3.org/2000/svg', el.elementType);\r\n    const keyArr = Object.keys(el);\r\n    let keyStr;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        if (keyStr === 'childrenArr') {\r\n            for (let e = 0; e < el.childrenArr.length; e++) {\r\n                result.appendChild(createSvg(el.childrenArr[e]));\r\n            }\r\n        } else if (keyStr !== 'elementType') {\r\n            result.setAttribute(keyStr, el[keyStr] as string);\r\n        }\r\n    }\r\n    return result;\r\n}","import {addEventListener, removeEventListener} from './event-listener';\r\n\r\n\r\nconst globalKey = (() => {\r\n\r\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\r\n        'space': [' ', 'Spacebar'], // Spacebar in IE\r\n        'alt': ['Alt', 'AltGraph'],\r\n        'shift': 'Shift',\r\n        'ctrl': 'Control',\r\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\r\n        'enter': 'Enter',\r\n        'esc': 'Escape',\r\n        'backspace': 'Backspace',\r\n        'delete': 'Delete',\r\n        'sqbr_open': '[',\r\n        'sqbr_close': ']',\r\n        'a': ['a', 'A'],\r\n        'b': ['b', 'B'],\r\n        'c': ['c', 'C'],\r\n        'e': ['e', 'E'],\r\n        'f': ['f', 'F'],\r\n        'g': ['g', 'G'],\r\n        'r': ['r', 'R'], // when holding shift\r\n        's': ['s', 'S'],\r\n        't': ['t', 'T'],\r\n        'u': ['u', 'U'],\r\n        'x': ['x', 'X'],\r\n        'y': ['y', 'Y'],\r\n        'z': ['z', 'Z'],\r\n        'plus': '+',\r\n        'minus': '-',\r\n        'left': 'ArrowLeft',\r\n        'right': 'ArrowRight',\r\n        'up': 'ArrowUp',\r\n        'down': 'ArrowDown',\r\n        'home': 'Home',\r\n        'end': 'End'\r\n    };\r\n    const keyToKeyStrArr = Object.keys(keyStrToKeyObj);\r\n    const isDownObj = {};\r\n    const keyToKeyStrObj = {}; // event.key to keyStr { ArrowLeft: 'left', ... }\r\n    let comboArr = [];\r\n    //a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\r\n    let codeIsDownObj = {}; // { KeyE: 'e', KeyF: null } - null not down, string, the associated keyStr\r\n    const listenerArr = [];\r\n\r\n    for (let i = 0; i < keyToKeyStrArr.length; i++) {\r\n        isDownObj[keyToKeyStrArr[i]] = false;\r\n\r\n        const code = keyStrToKeyObj[keyToKeyStrArr[i]];\r\n        if (typeof code === 'string') {\r\n            keyToKeyStrObj[keyStrToKeyObj[keyToKeyStrArr[i]]] = keyToKeyStrArr[i];\r\n        } else {\r\n            for (let e = 0; e < code.length; e++) {\r\n                keyToKeyStrObj[code[e]] = keyToKeyStrArr[i];\r\n            }\r\n        }\r\n    }\r\n\r\n    function emitDown(a, b, c, d?) {\r\n        listenerArr.forEach(item => {\r\n            if (!item[0]) {\r\n                return;\r\n            }\r\n            item[0](a, b, c, d);\r\n        });\r\n    }\r\n\r\n    function emitUp(a, b, c) {\r\n        listenerArr.forEach(item => {\r\n            if (!item[1]) {\r\n                return;\r\n            }\r\n            item[1](a, b, c);\r\n        });\r\n    }\r\n\r\n    function emitBlur() {\r\n        listenerArr.forEach(item => {\r\n            if (!item[2]) {\r\n                return;\r\n            }\r\n            item[2]();\r\n        });\r\n    }\r\n\r\n    function keyDown(e) {\r\n        const key = e.key;\r\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\r\n\r\n        if (key in keyToKeyStrObj) {\r\n            const keyStr = keyToKeyStrObj[key];\r\n            if (isDownObj[keyStr]) {\r\n                emitDown(keyStr, e, comboArr.join('+'), true);\r\n                return;\r\n            }\r\n            isDownObj[keyStr] = true;\r\n            codeIsDownObj[code] = keyStr;\r\n\r\n            //add to combo\r\n            comboArr.push(keyStr);\r\n\r\n            emitDown(keyStr, e, comboArr.join('+'));\r\n        }\r\n    }\r\n\r\n\r\n    function keyUp(e) {\r\n        const key = e.key;\r\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\r\n        const oldComboStr = comboArr.join('+');\r\n\r\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\r\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\r\n        if ([\r\n            'Meta', 'MetaLeft', 'MetaRight',\r\n            'OSLeft', 'OSRight', // Firefox\r\n        ].includes(code)) {\r\n            blur(null);\r\n            return;\r\n        }\r\n\r\n        if (code in codeIsDownObj && codeIsDownObj[code] !== null) {\r\n            const keyStr = codeIsDownObj[code];\r\n            isDownObj[keyStr] = false;\r\n            codeIsDownObj[code] = null;\r\n\r\n            //remove from combo\r\n            for (let i = 0; i < comboArr.length; i++) {\r\n                if (comboArr[i] == keyStr) {\r\n                    comboArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n\r\n            emitUp(keyStr, e, oldComboStr);\r\n        }\r\n    }\r\n\r\n    function blur(event) {\r\n        const oldComboStr = comboArr.join('+');\r\n        comboArr = [];\r\n        codeIsDownObj = {};\r\n\r\n        const eventArr = [];\r\n        for (let i = 0; i < keyToKeyStrArr.length; i++) {\r\n            if (isDownObj[keyToKeyStrArr[i]]) {\r\n                isDownObj[keyToKeyStrArr[i]] = false;\r\n                eventArr.push(keyToKeyStrArr[i]);\r\n            }\r\n        }\r\n        for (let i = 0; i < eventArr.length; i++) {\r\n            emitUp(\r\n                eventArr[i],\r\n                {\r\n                    preventDefault: function () {},\r\n                    stopPropagation: function () {},\r\n                },\r\n                oldComboStr,\r\n            );\r\n        }\r\n        emitBlur();\r\n    }\r\n\r\n\r\n\r\n    return {\r\n        add: (keyListener) => {\r\n            if (listenerArr.includes(keyListener)) {\r\n                return;\r\n            }\r\n            const first = listenerArr.length === 0;\r\n            listenerArr.push(keyListener);\r\n\r\n            if (first) {\r\n                addEventListener(document, 'keydown', keyDown);\r\n                addEventListener(document, 'keyup', keyUp);\r\n                addEventListener(window, 'blur', blur);\r\n            }\r\n        },\r\n        remove: (keyListener) => {\r\n            if (!listenerArr.includes(keyListener)) {\r\n                return;\r\n            }\r\n            const last = listenerArr.length === 1;\r\n            for (let i = 0; i < listenerArr.length; i++) {\r\n                if (listenerArr[i] === keyListener) {\r\n                    listenerArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            if (last) {\r\n                removeEventListener(document, 'keydown', keyDown);\r\n                removeEventListener(document, 'keyup', keyUp);\r\n                removeEventListener(window, 'blur', blur);\r\n            }\r\n        },\r\n        getIsDown: () => {\r\n            return isDownObj;\r\n        },\r\n        getCombo: () => {\r\n            return comboArr;\r\n        },\r\n    };\r\n})();\r\n\r\n\r\n\r\n/**\r\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\r\n *\r\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\r\n * comboStr - string joins currently pressed keyStr with a +\r\n *              e.g. 'ctrl+z'\r\n *\r\n */\r\nexport class KeyListener {\r\n\r\n    private readonly onDown;\r\n    private readonly onUp;\r\n    private readonly onBlur;\r\n    private readonly ref;\r\n\r\n    constructor (\r\n        p: {\r\n            onDown?: (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\r\n            onUp?: (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\r\n            onBlur?: () => void;\r\n        },\r\n    ) {\r\n        this.onDown = p.onDown;\r\n        this.onUp = p.onUp;\r\n        this.onBlur = p.onBlur;\r\n        this.ref = [this.onDown, this.onUp, this.onBlur];\r\n        globalKey.add(this.ref);\r\n    }\r\n\r\n    isPressed (keyStr: string): boolean {\r\n        if (!(keyStr in globalKey.getIsDown())) {\r\n            throw 'key \"' + keyStr + '\" not found';\r\n        }\r\n        return globalKey.getIsDown()[keyStr];\r\n    }\r\n\r\n    getComboStr (): string {\r\n        return globalKey.getCombo().join('+');\r\n    }\r\n\r\n    comboOnlyContains (keyStrArr: string[]): boolean {\r\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\r\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    destroy (): void {\r\n        globalKey.remove(this.ref);\r\n    }\r\n}\r\n\r\nexport function sameKeys(comboAStr: string, comboBStr: string): boolean {\r\n    return comboAStr.split('+').sort().join('+')=== comboBStr.split('+').sort().join('+');\r\n}","import {addEventListener, removeEventListener} from './event-listener';\r\n\r\n\r\n/**\r\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\r\n * Normalizes regular scrolls.\r\n *\r\n * Why:\r\n * - trackpad scrolling is different from old school mouse scrolling\r\n * - but there is not way to learn from the browser if it's trackpad scrolling\r\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\r\n *      continue an arbitrary amount, at an arbitrary scale\r\n * - each browser does this differently. So you can't offer a coherent experience\r\n *\r\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\r\n *\r\n * @param callback - func({deltaY: number, pageX: number, pageY: number, clientX: number, clientY: number}\r\n * @constructor\r\n */\r\nimport {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\r\nimport {mix} from '../math/math';\r\n\r\nconst WheelCleaner = function (callback) {\r\n    const sequenceTimeoutMs = 200;\r\n\r\n    const knownUnitArr = [100];\r\n    let sequenceLength = 0;\r\n    let sequenceUnit = null;\r\n    let endSequenceTimeout;\r\n    let toEmitDelta = null;\r\n    let position = null;\r\n\r\n\r\n    function emit(delta) {\r\n        callback({\r\n            deltaY: Math.round(delta / sequenceUnit),\r\n            pageX: position.pageX,\r\n            pageY: position.pageY,\r\n            clientX: position.clientX,\r\n            clientY: position.clientY,\r\n        });\r\n    }\r\n\r\n    function endSequence() {\r\n        if (toEmitDelta !== null) {\r\n            emit(toEmitDelta);\r\n            toEmitDelta = null;\r\n        }\r\n        if (sequenceUnit !== null && !(knownUnitArr.includes(sequenceUnit))) {\r\n            knownUnitArr.push(sequenceUnit);\r\n        }\r\n        sequenceLength = 0;\r\n        sequenceUnit = null;\r\n    }\r\n\r\n    // --- interface ---\r\n    this.process = function (event) {\r\n\r\n        position = {\r\n            pageX: event.pageX,\r\n            pageY: event.pageY,\r\n            clientX: event.clientX,\r\n            clientY: event.clientY,\r\n        };\r\n\r\n        clearTimeout(endSequenceTimeout);\r\n        endSequenceTimeout = setTimeout(endSequence, sequenceTimeoutMs);\r\n\r\n        //prep delta\r\n        let delta = event.deltaY;\r\n        if ('deltaMode' in event && event.deltaMode === 1) {\r\n            delta *= 100 / 3;\r\n        }\r\n        const absDelta = Math.abs(delta);\r\n\r\n\r\n        if (sequenceLength > 0 && sequenceUnit === null) {\r\n            //previously determined dirty sequence\r\n            toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n        //sequence begins\r\n        if (sequenceLength === 0) {\r\n            sequenceLength++;\r\n            if (absDelta < 50) {\r\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\r\n                return;\r\n            }\r\n\r\n            sequenceUnit = absDelta;\r\n            if (knownUnitArr.includes(sequenceUnit)) {\r\n                //we know this unit - emit right away\r\n                emit(delta);\r\n            } else {\r\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\r\n                toEmitDelta = delta;\r\n            }\r\n            return;\r\n        }\r\n\r\n        //sequence continues\r\n        if (absDelta === 0) {\r\n            //ignore zero scroll\r\n            return;\r\n        }\r\n        if (\r\n            absDelta === sequenceUnit ||\r\n            (absDelta / sequenceUnit) % 1 < 0.0001// a multiple\r\n        ) {\r\n            //fine\r\n        } else if ((sequenceUnit / absDelta) % 1 < 0.0001) {\r\n            //unit was actually a multiple - update it\r\n            sequenceUnit = absDelta;\r\n\r\n        } else if (absDelta !== sequenceUnit) {\r\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\r\n            sequenceUnit = null;\r\n            toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n\r\n        if (toEmitDelta !== null) {\r\n            emit(toEmitDelta);\r\n            toEmitDelta = null;\r\n        }\r\n        emit(delta);\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers\r\n * Has some workarounds for browser specific bugs. As browsers get better, this constructor should get smaller\r\n *\r\n * p = {\r\n *     target: DOM element,\r\n *     onPointer: func (pointerEvent), //optional\r\n *     onWheel: func (wheelEvent), //optional\r\n *     onEnterLeave: func (isOver: boolean), //optional\r\n *     maxPointers: int (1 - n), //default is 1\r\n *     fixScribble: boolean, // fix ipad scribble issue\r\n * }\r\n *\r\n * pointerEvent = {\r\n *     type: 'pointerdown'|'pointermove'|'pointerup',\r\n *     pointerId: long,\r\n *     pointerType: 'touch'|'mouse'|'pen',\r\n *     pageX: number,\r\n *     pageY: number,\r\n *     clientX: number,\r\n *     clientY: number,\r\n *     relX: number, //position relative to top left of target\r\n *     relY: number,\r\n *     dX: number, //movementX not supported by safari on iOS, so need my own\r\n *     dY: number,\r\n *     downPageX: number, //where was pointer when down-event occurred - set for down|move|up\r\n *     downPageY: number,\r\n *     coalescedArr: Array of {\r\n *         pageX: number,\r\n *         pageY: number,\r\n *         clientX: number,\r\n *         clientY: number,\r\n *         relX: number, //position relative to top left of target\r\n *         relY: number,\r\n *         dX: number,\r\n *         dY: number,\r\n *         time: number// same timescale as performance.now() - might be exact same number as in parent\r\n *     },\r\n *     time: number, // same timescale as performance.now()\r\n *     button: 'left'|'middle'|'right',\r\n *     pressure: number (0-1), // always 1 for touch and mouse\r\n *     eventPreventDefault: function(),\r\n *     eventStopPropagation: function(),\r\n * }\r\n *\r\n * wheelEvent = {\r\n *     deltaY: number, // increments of 1\r\n *     pageX: number,\r\n *     pageY: number,\r\n *     relX: number,\r\n *     relY: number,\r\n * }\r\n *\r\n * isOver(): boolean - if pointer over the target\r\n *\r\n * @param p\r\n */\r\nexport const PointerListener = (function () {\r\n\r\n    //keeping track of pointers for movement fallback\r\n    const pointerArr = [];\r\n\r\n    function addPointer(event) {\r\n        const pointerObj = {\r\n            pointerId: event.pointerId,\r\n            lastPageX: null,\r\n            lastPageY: null\r\n        };\r\n        pointerArr.push(pointerObj);\r\n\r\n        if (pointerArr.length > 15) {\r\n            pointerArr.shift();\r\n        }\r\n\r\n        return pointerObj;\r\n    }\r\n\r\n    function getPointer(event) {\r\n        for (let i = pointerArr.length - 1; i >= 0; i--) {\r\n            if (event.pointerId === pointerArr[i].pointerId) {\r\n                return pointerArr[i];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    let pressureNormalizeAvgCount = 0;\r\n    let pressureNormalizeAvgPressure = null;\r\n    let pressureNormalizeIsComplete = false;\r\n    let pressureNormalizeFactor = 1;\r\n\r\n    return function (p) {\r\n        const targetElement = p.target;\r\n        const onPointerCallback = p.onPointer;\r\n        const onWheelCallback = p.onWheel;\r\n        const onEnterLeaveCallback = p.onEnterLeave;\r\n        const maxPointers = 'maxPointers' in p ? p.maxPointers : 1;\r\n        const buttonsToStr = { // translation\r\n            '1': 'left',\r\n            '2': 'right',\r\n            '4': 'middle'\r\n        };\r\n        const wheelCleaner = new WheelCleaner(function (wheelEvent) {\r\n            if (isDestroyed) {\r\n                return;\r\n            }\r\n            if (onWheelCallback) {\r\n                const bounds = targetElement.getBoundingClientRect();\r\n                wheelEvent.relX = wheelEvent.clientX - bounds.left + targetElement.scrollLeft;\r\n                wheelEvent.relY = wheelEvent.clientY - bounds.top + targetElement.scrollTop;\r\n                onWheelCallback(wheelEvent);\r\n            }\r\n        });\r\n        let isDestroyed = false;\r\n\r\n        const timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\r\n\r\n\r\n        //to circumvent a chrome input glitch\r\n        let lastPointerType = '';\r\n        let didSkip = false;\r\n\r\n\r\n        /*\r\n        pointers that are pressing a button\r\n        dragObj = {\r\n            pointerId: long,\r\n            pointerType: 'mouse'|'pen'|'touch',\r\n            downPageX: number, //where was pointer when down-event occurred\r\n            downPageY: number,\r\n            button: long,\r\n            lastPageX: number, //pageX in previous event - only for touch events, because they don't have movementX/Y\r\n            lastPageY: number,\r\n            lastTimeStamp: number\r\n        }\r\n         */\r\n        const dragObjArr = [];\r\n        const dragPointerIdArr = [];\r\n\r\n        function getDragObj(pointerId) {\r\n            for (let i = 0; i < dragObjArr.length; i++) {\r\n                if (pointerId === dragObjArr[i].pointerId) {\r\n                    return dragObjArr[i];\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        function removeDragObj(pointerId) {\r\n            let removedDragObj = null;\r\n            for (let i = 0; i < dragPointerIdArr.length; i++) {\r\n                if (dragPointerIdArr[i] === pointerId) {\r\n                    removedDragObj = dragObjArr[i];\r\n                    dragObjArr.splice(i, 1);\r\n                    dragPointerIdArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n            return removedDragObj;\r\n        }\r\n\r\n\r\n        function normalizePressure(pressure, type?) {\r\n            if (pressure === 0 || pressure === 1) {\r\n                return pressure;\r\n            }\r\n\r\n            // was this there to prevent some glitch?\r\n            /*if (pressureNormalizeIsComplete && type === 'pointerdown' && pressure !== 1) {\r\n                pressure *= 0.004;\r\n            }*/\r\n\r\n            if (pressureNormalizeAvgCount < 60) {\r\n                if (pressureNormalizeAvgCount === 0) {\r\n                    pressureNormalizeAvgPressure = pressure;\r\n                } else {\r\n                    pressureNormalizeAvgPressure = mix(pressure, pressureNormalizeAvgPressure, 0.95);\r\n                }\r\n                pressureNormalizeAvgCount++;\r\n            } else if (!pressureNormalizeIsComplete) {\r\n                pressureNormalizeIsComplete = true;\r\n                //BB.throwOut('avg pressure decision!' + pressureNormalizeAvgPressure);\r\n                if (pressureNormalizeAvgPressure < 0.13) { // absurd pressure needed\r\n                    pressureNormalizeFactor = 2.3;\r\n                }\r\n            }\r\n\r\n\r\n            return Math.pow(pressure, 1 / pressureNormalizeFactor);\r\n        }\r\n\r\n\r\n        /**\r\n         *\r\n         * More trustworthy pointer attributes. that behave the same across browsers.\r\n         * returns a new object. this object also gets attached to the orig event. -> event.corrected\r\n         *\r\n         * @param event\r\n         * @returns {{pointerId: number, timeStamp: number, button, buttons, pointerType: (string|string|any), movementY: number, movementX: number, pressure, coalescedArr: [], pageY, pageX, clientX, clientY, eventPreventDefault: func, eventStopPropagation: func}\r\n         */\r\n        function correctPointerEvent(event) {\r\n            if (event.corrected) {\r\n                return event.corrected;\r\n            }\r\n\r\n            /*if (event.type === 'pointermove' && !window.hidePressureOut) {\r\n                if (event.type === 'pointermove') {\r\n                    BB.throwOut(event.pressure + ' ' + event.pointerType);\r\n                }\r\n            }*/\r\n\r\n            const correctedObj = {\r\n                pointerId: event.pointerId,\r\n                pointerType: event.pointerType,\r\n                pageX: event.pageX,\r\n                pageY: event.pageY,\r\n                clientX: event.clientX,\r\n                clientY: event.clientY,\r\n                movementX: event.movementX,\r\n                movementY: event.movementY,\r\n                timeStamp: event.timeStamp + timeStampOffset,\r\n                pressure: normalizePressure(event.pressure, event.type),\r\n                buttons: event.buttons,\r\n                button: event.button,\r\n                coalescedArr: [],\r\n                eventPreventDefault: function () {\r\n                    event.preventDefault();\r\n                },\r\n                eventStopPropagation: function () {\r\n                    event.stopPropagation();\r\n                }\r\n            };\r\n            event.corrected = correctedObj;\r\n\r\n            let customPressure = null;\r\n            if ('pointerId' in event) {\r\n                if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\r\n                    correctedObj.pressure = 1;\r\n                    customPressure = 1;\r\n                }\r\n            } else {\r\n                correctedObj.pointerId = 0;\r\n                correctedObj.pointerType = 'mouse';\r\n                correctedObj.pressure = event.buttons !== 0 ? 1 : 0;\r\n                customPressure = correctedObj.pressure;\r\n            }\r\n\r\n            if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\r\n                correctedObj.buttons = 1; //todo wrong if no buttons actually pressed\r\n            }\r\n\r\n            let coalescedEventArr = [];\r\n            if ('getCoalescedEvents' in event) {\r\n                coalescedEventArr = event.getCoalescedEvents();\r\n            }\r\n\r\n            // chrome somehow movementX not same scale as pageX. todo: only chrome?\r\n            // so make my own\r\n\r\n            let pointerObj = getPointer(correctedObj);\r\n            if (pointerObj === null) {\r\n                pointerObj = addPointer(correctedObj);\r\n            }\r\n\r\n            const totalLastX = pointerObj.lastPageX;\r\n            const totalLastY = pointerObj.lastPageY;\r\n\r\n            for (let i = 0; i < coalescedEventArr.length; i++) {\r\n                const eventItem = coalescedEventArr[i];\r\n\r\n                correctedObj.coalescedArr.push({\r\n                    pageX: eventItem.pageX,\r\n                    pageY: eventItem.pageY,\r\n                    clientX: eventItem.clientX,\r\n                    clientY: eventItem.clientY,\r\n                    movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\r\n                    movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\r\n                    timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\r\n                    pressure: customPressure === null ? normalizePressure(eventItem.pressure) : customPressure\r\n                });\r\n\r\n                pointerObj.lastPageX = eventItem.pageX;\r\n                pointerObj.lastPageY = eventItem.pageY;\r\n            }\r\n\r\n            pointerObj.lastPageX = correctedObj.pageX;\r\n            pointerObj.lastPageY = correctedObj.pageY;\r\n            correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\r\n            correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\r\n\r\n            return correctedObj;\r\n\r\n        }\r\n\r\n        /**\r\n         * creates a value for onPointer, from a pointer event handler\r\n         *\r\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\r\n         * @param correctedEvent - corrected pointer event from correctPointerEvent()\r\n         * @param custom - object for setting custom attributes\r\n         * @returns {{pointerId: number, pointerType: *, dX: (*), relY: number, dY: (*), relX: number, type: *, event: *, pageY: *, pageX: *}}\r\n         */\r\n        function createPointerOutEvent(typeStr, correctedEvent, custom?) {\r\n\r\n            const bounds = targetElement.getBoundingClientRect();\r\n            const result: any = {\r\n                type: typeStr,\r\n                pointerId: correctedEvent.pointerId,\r\n                pointerType: correctedEvent.pointerType,\r\n                pageX: correctedEvent.pageX,\r\n                pageY: correctedEvent.pageY,\r\n                clientX: correctedEvent.clientX,\r\n                clientY: correctedEvent.clientY,\r\n                relX: correctedEvent.clientX - bounds.left + targetElement.scrollLeft,\r\n                relY: correctedEvent.clientY - bounds.top + targetElement.scrollTop,\r\n                dX: correctedEvent.movementX,\r\n                dY: correctedEvent.movementY,\r\n                time: correctedEvent.timeStamp,\r\n                eventPreventDefault: correctedEvent.eventPreventDefault,\r\n                eventStopPropagation: correctedEvent.eventStopPropagation\r\n            };\r\n\r\n            if (typeStr === 'pointermove') {\r\n                result.coalescedArr = [];\r\n                if (correctedEvent.coalescedArr.length > 1) {\r\n                    let coalescedItem;\r\n                    for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\r\n                        coalescedItem = correctedEvent.coalescedArr[i];\r\n                        result.coalescedArr.push({\r\n                            pageX: coalescedItem.pageX,\r\n                            pageY: coalescedItem.pageY,\r\n                            clientX: coalescedItem.clientX,\r\n                            clientY: coalescedItem.clientY,\r\n                            relX: coalescedItem.clientX - bounds.left + targetElement.scrollLeft,\r\n                            relY: coalescedItem.clientY - bounds.top + targetElement.scrollTop,\r\n                            dX: coalescedItem.movementX,\r\n                            dY: coalescedItem.movementY,\r\n                            time: coalescedItem.timeStamp\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (custom) {\r\n                const keyArr = Object.keys(custom);\r\n                for (let i = 0; i < keyArr.length; i++) {\r\n                    result[keyArr[i]] = custom[keyArr[i]];\r\n                }\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        /**\r\n         * creates a value for onPointer, from a fallback touch event handler\r\n         *\r\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\r\n         * @param touchListItem - element from changed touch list\r\n         * @param touchEvent - touch event\r\n         * @param custom - object for setting custom attributes\r\n         * @returns {{pointerId: number, pointerType: string, relY: number, relX: number, type: *, event: *, pageY: *, pageX: *}}\r\n         */\r\n        function createTouchOutEvent(typeStr, touchListItem, touchEvent, custom) {\r\n            const bounds = targetElement.getBoundingClientRect();\r\n            const result: any = {\r\n                type: typeStr,\r\n                pointerId: touchListItem.identifier,\r\n                pointerType: 'touch',\r\n                pageX: touchListItem.pageX,\r\n                pageY: touchListItem.pageY,\r\n                clientX: touchListItem.clientX,\r\n                clientY: touchListItem.clientY,\r\n                relX: touchListItem.pageX - bounds.left + targetElement.scrollLeft,\r\n                relY: touchListItem.pageY - bounds.top + targetElement.scrollTop,\r\n                time: touchEvent.timeStamp + timeStampOffset,\r\n                eventPreventDefault: function() { touchEvent.preventDefault(); },\r\n                eventStopPropagation: function() { touchEvent.stopPropagation(); }\r\n            };\r\n\r\n            if (typeStr === 'pointermove') {\r\n                result.coalescedArr = [];\r\n            }\r\n\r\n            const keyArr = Object.keys(custom);\r\n            for (let i = 0; i < keyArr.length; i++) {\r\n                result[keyArr[i]] = custom[keyArr[i]];\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        function setupDocumentListeners() {\r\n            addEventListener(document, 'pointermove', onGlobalPointerMove);\r\n            addEventListener(document, 'pointerup', onGlobalPointerUp);\r\n            addEventListener(document, 'pointerleave', onGlobalPointerLeave);\r\n        }\r\n\r\n        function destroyDocumentListeners() {\r\n            removeEventListener(document, 'pointermove', onGlobalPointerMove);\r\n            removeEventListener(document, 'pointerup', onGlobalPointerUp);\r\n            removeEventListener(document, 'pointerleave', onGlobalPointerLeave);\r\n        }\r\n\r\n        let isOverCounter = 0; // might be multiple pointers\r\n        function onPointerEnter() {\r\n            isOverCounter++;\r\n            if (onEnterLeaveCallback) {\r\n                onEnterLeaveCallback(true);\r\n            }\r\n        }\r\n\r\n        function onPointerLeave() {\r\n            isOverCounter--;\r\n            if (onEnterLeaveCallback) {\r\n                onEnterLeaveCallback(false);\r\n            }\r\n        }\r\n\r\n        function onPointermove(event) {\r\n            event = correctPointerEvent(event);\r\n\r\n            const tempLastPointerType = lastPointerType;\r\n            lastPointerType = event.pointerType;\r\n\r\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || event.pointerType === 'touch') {\r\n                didSkip = false;\r\n                return;\r\n            }\r\n\r\n            // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\r\n            if (!didSkip && event.pointerType === 'mouse' && tempLastPointerType === 'pen') {\r\n                didSkip = true;\r\n                return;\r\n            }\r\n            didSkip = false;\r\n\r\n            const outEvent = createPointerOutEvent('pointermove', event);\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onPointerdown(event) {\r\n            //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' pointerdown');\r\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || !([1, 2, 4].includes(event.buttons))) {\r\n                //BB.throwOut('pointerdown ignored');\r\n                return;\r\n            }\r\n\r\n\r\n            //set up global listeners\r\n            if (dragObjArr.length === 0) {\r\n                setupDocumentListeners();\r\n            }\r\n            const dragObj = {\r\n                pointerId: event.pointerId,\r\n                pointerType: event.pointerType,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n                buttons: event.buttons,\r\n                lastPageX: event.pageX,\r\n                lastPageY: event.pageY,\r\n                lastTimeStamp: event.timeStamp\r\n            };\r\n            dragObjArr.push(dragObj);\r\n            setTouchTimeout(dragObj);\r\n            dragPointerIdArr.push(event.pointerId);\r\n\r\n            const outEvent = createPointerOutEvent('pointerdown', event, {\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n                button: buttonsToStr[event.buttons],\r\n                pressure: event.pressure\r\n            });\r\n\r\n            onPointerCallback(outEvent);\r\n        }\r\n\r\n\r\n        function onGlobalPointerMove(event) {\r\n            //BB.throwOut('pointermove ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\r\n                return;\r\n            }\r\n\r\n            const dragObj = getDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            //if pointer changes button its pressing -> turn into pointerup\r\n            if (event.buttons !== dragObj.buttons) {\r\n                //pointer up\r\n\r\n                //remove listener\r\n                if (dragObjArr.length === 1) {\r\n                    destroyDocumentListeners();\r\n                }\r\n                removeDragObj(event.pointerId);\r\n\r\n                const outEvent = createPointerOutEvent('pointerup', event, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY\r\n                });\r\n                onPointerCallback(outEvent);\r\n                return;\r\n\r\n            }\r\n\r\n            setTouchTimeout(dragObj);\r\n\r\n            // ipad likes to do this\r\n            if (\r\n                event.pointerType === 'pen' &&\r\n                event.pageX === dragObj.lastPageX &&\r\n                event.pageY === dragObj.lastPageY &&\r\n                event.timeStamp === dragObj.lastTimeStamp\r\n            ) {\r\n                //ignore\r\n                return;\r\n            }\r\n\r\n            const outEvent = createPointerOutEvent('pointermove', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY,\r\n                button: buttonsToStr[event.buttons],\r\n                pressure: event.pressure\r\n            });\r\n\r\n            dragObj.lastPageX = event.pageX;\r\n            dragObj.lastPageY = event.pageY;\r\n            dragObj.lastTimeStamp = event.timeStamp;\r\n\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onGlobalPointerUp(event) {\r\n            //BB.throwOut('pointerup ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\r\n                return;\r\n            }\r\n\r\n            //remove listener\r\n            if (dragObjArr.length === 1) {\r\n                destroyDocumentListeners();\r\n            }\r\n            const dragObj = removeDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            const outEvent = createPointerOutEvent('pointerup', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY\r\n            });\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onGlobalPointerLeave(event) {\r\n            //BB.throwOut('pointerleave ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) { //} || event.target !== document) {\r\n                return;\r\n            }\r\n\r\n            //remove listener\r\n            if (dragObjArr.length === 1) {\r\n                destroyDocumentListeners();\r\n            }\r\n            const dragObj = removeDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            const outEvent = createPointerOutEvent('pointerup', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY\r\n            });\r\n            onPointerCallback(outEvent);\r\n        }\r\n\r\n\r\n        /*\r\n        --- ipad pointer event glitch damage control ---\r\n\r\n        ipad pointer events are glitchy. doesn't always fire pointerup.\r\n        - when two fingers get really close to each other\r\n        - when finger moves out and back in bottom\r\n\r\n        This artificially fires a pointerup\r\n        */\r\n        function onTouchTimeout(dragObj) {\r\n\r\n            //create fake event\r\n            const fakeEvent = {\r\n                pointerId: dragObj.pointerId,\r\n                pointerType: dragObj.pointerType,\r\n                type: 'pointerup',\r\n                timeStamp: performance.now(),\r\n                pageX: 0,\r\n                pageY: 0,\r\n                clientX: 0,\r\n                clientY: 0,\r\n                preventDefault: function () {\r\n                },\r\n                stopPropagation: function () {\r\n                }\r\n            };\r\n\r\n            //call onGlobalPointerUp with it\r\n            onGlobalPointerUp(fakeEvent);\r\n        }\r\n\r\n        function setTouchTimeout(dragObj) {\r\n            if (dragObj.pointerType !== 'touch') {\r\n                return;\r\n            }\r\n            dragObj.touchTimeout = setTimeout(function () {\r\n                onTouchTimeout(dragObj);\r\n            }, 2500); // 2.5 seconds\r\n        }\r\n\r\n        function clearTouchTimeout(dragObj) {\r\n            if (!dragObj.touchTimeout) {\r\n                return;\r\n            }\r\n            clearTimeout(dragObj.touchTimeout);\r\n            dragObj.touchTimeout = null;\r\n        }\r\n\r\n\r\n        if (onEnterLeaveCallback) {\r\n            addEventListener(targetElement, 'pointerenter', onPointerEnter);\r\n            addEventListener(targetElement, 'pointerleave', onPointerLeave);\r\n        }\r\n        if (onPointerCallback) {\r\n            addEventListener(targetElement, 'pointermove', onPointermove);\r\n            addEventListener(targetElement, 'pointerdown', onPointerdown);\r\n        }\r\n        if (onWheelCallback) {\r\n            addEventListener(targetElement, 'wheel', wheelCleaner.process);\r\n        }\r\n\r\n\r\n        let onTouchstart;\r\n        let onTouchmove;\r\n        let onTouchend;\r\n\r\n        // --- touch fallback ---\r\n        if (!(hasPointerEvents)) {\r\n\r\n            onTouchstart = function (event) {\r\n                ////console.log('onTouchstart', event, event.changedTouches.length);\r\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length && dragObjArr.length < maxPointers; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    //set up global listeners\r\n                    if (dragObjArr.length === 0) {\r\n                        addEventListener(document, 'touchmove', onTouchmove);\r\n                        addEventListener(document, 'touchend', onTouchend);\r\n                        addEventListener(document, 'touchcancel', onTouchend);\r\n                    }\r\n                    dragObjArr.push({\r\n                        pointerId: touchObj.identifier,\r\n                        downPageX: touchObj.pageX,\r\n                        downPageY: touchObj.pageY,\r\n                        buttons: 1,\r\n                        lastPageX: touchObj.pageX,\r\n                        lastPageY: touchObj.pageY,\r\n                    });\r\n                    dragPointerIdArr.push(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointerdown', touchObj, event, {\r\n                        dX: 0,\r\n                        dY: 0,\r\n                        downPageX: touchObj.downPageX,\r\n                        downPageY: touchObj.downPageY,\r\n                        button: 'left',\r\n                        pressure: 1\r\n                    });\r\n                    onPointerCallback(outEvent);\r\n                }\r\n\r\n            }\r\n\r\n            onTouchmove = function (event) {\r\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\r\n                        continue;\r\n                    }\r\n                    const dragObj = getDragObj(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointermove', touchObj, event, {\r\n                        dX: touchObj.pageX - dragObj.lastPageX,\r\n                        dY: touchObj.pageY - dragObj.lastPageY,\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                        button: 'left',\r\n                        isCoalesced: false,\r\n                        pressure: 1\r\n                    });\r\n                    dragObj.lastPageX = touchObj.pageX;\r\n                    dragObj.lastPageY = touchObj.pageY;\r\n                    onPointerCallback(outEvent);\r\n\r\n                }\r\n\r\n            }\r\n\r\n            onTouchend = function (event) {\r\n                if (event.type !== 'touchcancel') {\r\n                    event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n                }\r\n\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\r\n                        continue;\r\n                    }\r\n\r\n                    //remove listener\r\n                    if (dragObjArr.length === 1) {\r\n                        removeEventListener(document, 'touchmove', onTouchmove);\r\n                        removeEventListener(document, 'touchend', onTouchend);\r\n                        removeEventListener(document, 'touchcancel', onTouchend);\r\n                    }\r\n                    const dragObj = removeDragObj(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointerup', touchObj, event, {\r\n                        dX: touchObj.pageX - dragObj.lastPageX,\r\n                        dY: touchObj.pageY - dragObj.lastPageY,\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                    });\r\n\r\n                    onPointerCallback(outEvent);\r\n                }\r\n\r\n            }\r\n\r\n            if (onPointerCallback) {\r\n                addEventListener(targetElement, 'touchstart', onTouchstart);\r\n            }\r\n\r\n        } else if (p.fixScribble) {\r\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\r\n            onTouchmove = function(e) {\r\n                e.preventDefault();\r\n            }\r\n            addEventListener(targetElement, 'touchmove', onTouchmove);\r\n\r\n        }\r\n\r\n\r\n        // --- interface ---\r\n\r\n        this.isOver = function () {\r\n            return isOverCounter > 0;\r\n        };\r\n\r\n        this.destroy = function () {\r\n            if (isDestroyed) {\r\n                return;\r\n            }\r\n            isDestroyed = true;\r\n            removeEventListener(targetElement, 'pointerenter', onPointerEnter);\r\n            removeEventListener(targetElement, 'pointerleave', onPointerLeave);\r\n            removeEventListener(targetElement, 'pointermove', onPointermove);\r\n            removeEventListener(targetElement, 'pointerdown', onPointerdown);\r\n            removeEventListener(targetElement, 'wheel', wheelCleaner.process);\r\n            if (dragObjArr.length > 0) {\r\n                destroyDocumentListeners();\r\n            }\r\n\r\n            if (!(hasPointerEvents)) {\r\n                removeEventListener(targetElement, 'touchstart', onTouchstart);\r\n                if (dragObjArr.length > 0) {\r\n                    removeEventListener(document, 'touchmove', onTouchmove);\r\n                    removeEventListener(document, 'touchend', onTouchend);\r\n                    removeEventListener(document, 'touchcancel', onTouchend);\r\n                }\r\n            } else {\r\n                removeEventListener(targetElement, 'touchmove', onTouchmove);\r\n            }\r\n        };\r\n\r\n    }\r\n})();","import {IBounds, IRect, IVector2D} from '../BB.types';\r\n\r\nexport function mix (a: number, b: number, f: number): number {\r\n    return a * (1 - f) + b * f;\r\n}\r\n\r\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\r\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\r\n}\r\n\r\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\r\n    // faster because no square-root\r\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\r\n}\r\n\r\nexport function lenSquared (x: number, y: number): number {\r\n    // faster because no square-root\r\n    return x * x + y * y;\r\n}\r\n\r\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\r\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n}\r\n\r\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\r\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\r\n}\r\n\r\nexport function isInsideRect(p: IVector2D, rect: IRect): boolean {\r\n    return rect.x <= p.x && p.x <= rect.x + rect.width &&\r\n        rect.y <= p.y && p.y <= rect.y + rect.height;\r\n}\r\n\r\nexport function clamp (num: number, min: number, max: number): number {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num;\r\n}\r\n\r\nexport function rotate (x: number, y: number, deg: number): IVector2D {\r\n    const theta = deg * (Math.PI / 180);\r\n    const cs = Math.cos(theta);\r\n    const sn = Math.sin(theta);\r\n\r\n    return {\r\n        x: x * cs - y * sn,\r\n        y: x * sn + y * cs\r\n    };\r\n}\r\n\r\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\r\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\r\n    rot.x += center.x;\r\n    rot.y += center.y;\r\n    return rot;\r\n}\r\n\r\nexport function intDxy(remainder: IVector2D, fDx: number, fDy: number) {\r\n    remainder.x += fDx;\r\n    remainder.y += fDy;\r\n    const dX = Math.round(remainder.x);\r\n    const dY = Math.round(remainder.y);\r\n    remainder.x -= dX;\r\n    remainder.y -= dY;\r\n    return {\r\n        dX,\r\n        dY,\r\n    };\r\n}\r\n\r\n/**\r\n * return closest even number\r\n * @param f\r\n */\r\nexport function roundEven(f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f;\r\n        }\r\n        return f + 1;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 0) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * return closest uneven number\r\n * @param f\r\n */\r\nexport function roundUneven(f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f + 1;\r\n        }\r\n        return f;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 1) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * round number to certain precision.\r\n * round(1.2345, 2) = 1.23\r\n * round(1.2345, 0) = 0\r\n * round(123, -1) = 120\r\n *\r\n * @param f\r\n * @param digits\r\n */\r\nexport function round(f: number, digits: number): number {\r\n    const digitMult = Math.pow(10, digits);\r\n    return Math.round((f/* + Number.EPSILON*/) * digitMult) / digitMult;\r\n}\r\n\r\n/**\r\n * update target so it includes bounds\r\n * @param target\r\n * @param bounds\r\n */\r\nexport function updateBounds (target: IBounds, bounds: IBounds): IBounds {\r\n    if (!bounds) {\r\n        return target;\r\n    }\r\n    if (!target) {\r\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\r\n    } else {\r\n        target.x1 = Math.min(target.x1, bounds.x1);\r\n        target.y1 = Math.min(target.y1, bounds.y1);\r\n        target.x2 = Math.max(target.x2, bounds.x2);\r\n        target.y2 = Math.max(target.y2, bounds.y2);\r\n    }\r\n    return target;\r\n}\r\n\r\n/**\r\n * determine overlap of bounds with width&height\r\n */\r\nexport function boundsInArea (bounds: IBounds, width: number, height: number): IBounds | null {\r\n    let x1 = Math.max(0, bounds.x1);\r\n    let y1 = Math.max(0, bounds.y1);\r\n    let x2 = Math.min(width - 1, bounds.x2);\r\n    let y2 = Math.min(height - 1, bounds.y2);\r\n    if (x1 > x2 || y1 > y2) {\r\n        return null;\r\n    }\r\n    return { x1, y1, x2, y2 };\r\n}","import {clamp, dist, mix, pointsToAngleRad} from '../math/math';\r\n\r\n\r\ntype ChainOutFunc = (event?) => void;\r\n\r\n/**\r\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\r\n * each element in the chain might hold back the events, swallow them, or transform them\r\n *\r\n * p = {\r\n *     chainArr: ChainElement[]\r\n * }\r\n *\r\n * chainIn(event): null - feed an event into the chain\r\n * setChainOut(func): void - func(event) <- called when passed through chain\r\n * ^ each ChainElement needs these methods too\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const EventChain = function (p) {\r\n\r\n    const chainArr = p.chainArr;\r\n    let chainOut: ChainOutFunc = () => undefined;\r\n\r\n    function continueChain(i, event) {\r\n        for (; i < chainArr.length; i++) {\r\n            event = chainArr[i].chainIn(event);\r\n            if (event === null) {\r\n                return null;\r\n            }\r\n        }\r\n        chainOut(event);\r\n        return null;\r\n    }\r\n\r\n    for (let i = 0; i < chainArr.length; i++) {\r\n        (function (i) {\r\n            chainArr[i].setChainOut(function (event) {\r\n                continueChain(i + 1, event);\r\n            });\r\n        })(i);\r\n    }\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        return continueChain(0, event);\r\n    };\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects double taps.\r\n *\r\n * p = {\r\n *     onDoubleTap: function({pageX: number, pageY: number}) - fires when double tap occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n * setAllowedPointerTypeArr(string[]): void - which pointer types are allowed\r\n * setAllowedButtonArr(string[]): void - which buttons are allowed\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const DoubleTapper = function (p) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    const minSilenceBeforeDurationMs = 400;\r\n    const maxPressedDurationMs = 300;\r\n    const maxPressedDistancePx = 10;\r\n    const maxInbetweenDistancePx = 19;\r\n    const maxUpToUpDurationMs = 500;\r\n    const maxUntilSecondDownDurationMs = 300;\r\n    const minSilenceAfterMs = 250;\r\n\r\n    let allowedPointerTypeArr = ['touch', 'mouse', 'pen'];\r\n    let allowedButtonArr = ['left'];\r\n\r\n    let sequenceArr = [];\r\n    const pointersDownIdArr = [];\r\n    let lastUpTime = 0;\r\n    let nowTime = 0;\r\n\r\n    let eventQueueArr = [];\r\n\r\n\r\n    function fail() {\r\n        if (sequenceArr.length === 0) { // no gesture started -> can be ignored\r\n            return;\r\n        }\r\n        clearTimeout(timeoutObj.fail);\r\n        clearTimeout(timeoutObj.maxUntilSecondDown);\r\n        clearTimeout(timeoutObj.success);\r\n        timeoutObj.fail = null;\r\n        timeoutObj.maxUntilSecondDown = null;\r\n        timeoutObj.success = null;\r\n\r\n\r\n        for (let i = 0; i < eventQueueArr.length; i++) {\r\n            chainOut(eventQueueArr[i]);\r\n        }\r\n        eventQueueArr = [];\r\n\r\n        sequenceArr = [];\r\n    }\r\n\r\n    // double tap achieved\r\n    function success() {\r\n        timeoutObj.fail = null;\r\n        timeoutObj.success = null;\r\n        eventQueueArr = []; // events get swallowed\r\n        const lastSequenceItem = sequenceArr[sequenceArr.length - 1];\r\n        sequenceArr = [];\r\n        p.onDoubleTap({pageX: lastSequenceItem.pageX, pageY: lastSequenceItem.pageY});\r\n    }\r\n\r\n\r\n    const timeoutObj = {\r\n        fail: null,\r\n        maxUntilSecondDown: null,\r\n        success: null\r\n    };\r\n\r\n    //returns false if time already up. otherwise sets up timeout\r\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n\r\n    /**\r\n     * @param event object - a pointer event from BB.PointerListener\r\n     */\r\n    function processEvent(event) {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\r\n            //console.log('wrong input type -> fail');\r\n            fail();\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n        const lastSequenceItem = sequenceArr.length > 0 ? sequenceArr[sequenceArr.length - 1] : null;\r\n        if (event.type === 'pointerup') {\r\n            lastUpTime = event.time;\r\n        }\r\n\r\n        if (event.type === 'pointerdown') {\r\n            if (pointersDownIdArr.length > 1) { // more than one pointer down -> fail\r\n                //console.log('more than one pointer down -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (timeoutObj.success !== null) { // silence-after not achieved -> fail\r\n                //console.log('silence-after not achieved -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (sequenceArr.length === 0 && nowTime - lastUpTime < minSilenceBeforeDurationMs) { // silence before not achieved -> fail\r\n                //console.log('silence before not achieved -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (!allowedButtonArr.includes(event.button)) { // wrong button -> fail\r\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\r\n                fail();\r\n                return;\r\n            }\r\n            if (lastSequenceItem && lastSequenceItem.isDown || sequenceArr.length > 2) { // jumbled -> fail\r\n                //console.log('jumbled -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (lastSequenceItem) {\r\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n                if (distance > maxInbetweenDistancePx) { //moved too much -> reset\r\n                    //console.log('maxInbetweenDistancePx -> reset');\r\n                    fail();\r\n\r\n                    if (nowTime - lastSequenceItem.time < minSilenceBeforeDurationMs) { //silence before not achieved -> fail\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            sequenceArr.push({\r\n                isDown: true,\r\n                time: nowTime,\r\n                position: [event.pageX, event.pageY],\r\n                pointerId: event.pointerId\r\n            });\r\n            //maxUntilSecondDown\r\n\r\n            if (sequenceArr.length > 1) {\r\n                clearTimeout(timeoutObj.maxUntilSecondDown);\r\n            } else if (!setupTimeout('maxUntilSecondDown', fail, event.time + maxUntilSecondDownDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n\r\n            clearTimeout(timeoutObj.fail);\r\n            if (!setupTimeout('fail', fail, event.time + maxPressedDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointermove' && lastSequenceItem.pointerId === event.pointerId) {\r\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                console.log('another pointer mixing in -> fail');\r\n                fail();\r\n                return;\r\n            }*/\r\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n            if (distance > maxPressedDistancePx) { //moved too much -> fail\r\n                //console.log('maxPressedDistancePx -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointerup') {\r\n            if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            if (nowTime >= lastSequenceItem.time + maxPressedDurationMs) { //pressed too long -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            clearTimeout(timeoutObj.fail);\r\n\r\n            if (sequenceArr.length < 3) {\r\n                if (!setupTimeout('fail', fail, event.time + maxUpToUpDurationMs)) {\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n                sequenceArr = [\r\n                    lastSequenceItem,\r\n                    {\r\n                        isUp: true,\r\n                        time: nowTime,\r\n                        position: [event.pageX, event.pageY]\r\n                    }\r\n                ];\r\n                return;\r\n            }\r\n\r\n            if (nowTime < sequenceArr[1].time + maxUpToUpDurationMs) {\r\n                // double tap almost success\r\n                // only needs silence\r\n                sequenceArr.push({\r\n                    pageX: event.pageX,\r\n                    pageY: event.pageY\r\n                });\r\n                if (!setupTimeout('success', success, event.time + minSilenceAfterMs)) {\r\n                    fail();\r\n                }\r\n            } else { // time up -> fail\r\n                fail();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        processEvent(event);\r\n\r\n        if (sequenceArr.length === 0) { //existing events can not become a double tap\r\n            fail();\r\n            return event;\r\n        }\r\n        // events might become a double tap -> queue\r\n        eventQueueArr.push(event);\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n    this.setAllowedPointerTypeArr = function (arr) {\r\n        allowedPointerTypeArr = arr;\r\n    };\r\n\r\n    this.setAllowedButtonArr = function (arr) {\r\n        allowedButtonArr = arr;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects a single tap, done with N 'touch' pointers\r\n *\r\n * p = {\r\n *      fingers: number - number of fingers\r\n *      onTap: function() - fires when tap occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const NFingerTapper = function (p) {\r\n\r\n    const fingers = p.fingers;\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    const minSilenceBeforeDurationMs = 50; //250;\r\n    const maxTapMs = 500;\r\n    const maxFirstLastFingerDownMs = 250;\r\n    const maxPressedDistancePx = 12; //5 + fingers * 5;\r\n    const silenceAfterDurationMs = 250;\r\n\r\n\r\n    /*\r\n        fingerObj = {\r\n            pointerId: number,\r\n            downTime: number,\r\n            downPageX: number,\r\n            downPageY: number,\r\n            isUp: boolean\r\n        }\r\n     */\r\n    let fingerArr = [];\r\n    let firstDownTime;\r\n    let eventQueueArr = [];\r\n    let lastEventTime = 0;\r\n    const pointersDownIdArr = [];\r\n\r\n    function fail() {\r\n        if (eventQueueArr.length === 0) {\r\n            return;\r\n        }\r\n        clearTimeout(timeoutObj.firstLastDownTimeout);\r\n        clearTimeout(timeoutObj.tapTimeout);\r\n        for (let i = 0; i < eventQueueArr.length; i++) {\r\n            chainOut(eventQueueArr[i]);\r\n        }\r\n        eventQueueArr = [];\r\n        fingerArr = [];\r\n    }\r\n\r\n    function success() {\r\n        clearTimeout(timeoutObj.firstLastDownTimeout);\r\n        clearTimeout(timeoutObj.tapTimeout);\r\n        eventQueueArr = []; // events get swallowed\r\n        fingerArr = [];\r\n        p.onTap();\r\n    }\r\n\r\n    let nowTime;\r\n    const timeoutObj = {\r\n        firstLastDownTimeout: null,\r\n        tapTimeout: null\r\n    };\r\n\r\n    function setupTimeout(timeoutStr, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(fail, diff);\r\n        return true;\r\n    }\r\n\r\n    function processEvent(event) {\r\n\r\n        const tempLastEventTime = lastEventTime;\r\n        lastEventTime = event.time;\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (event.pointerType !== 'touch') {\r\n            if (fingerArr.length > 0) { // already in gesture -> fail\r\n                fail();\r\n            }\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n\r\n        if (event.type === 'pointerdown') {\r\n            //console.log('down');\r\n            if (fingerArr.length + 1 !== pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length === fingers) { // too many fingers down -> fail\r\n                //console.log(fingers + ': too many fingers down -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length > 0 && event.time - maxFirstLastFingerDownMs > fingerArr[0].downTime) { // took too long to touch with all fingers -> fail\r\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length === 0 && event.time - minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\r\n                //console.log(fingers + ': not enough silence before -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            if (fingerArr.length === 0) {\r\n                firstDownTime = event.time;\r\n\r\n                if (!setupTimeout('firstLastDownTimeout', event.time + maxFirstLastFingerDownMs) || !setupTimeout('tapTimeout', event.time + maxTapMs)) { // timeouts already up -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n            }\r\n            fingerArr.push({\r\n                pointerId: event.pointerId,\r\n                downTime: event.time,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY\r\n            });\r\n            return;\r\n\r\n        }\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            for (let i = 0; i < fingerArr.length; i++) {\r\n                if (fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\r\n                fail();\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'pointerup') {\r\n\r\n            if (fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            //console.log('up', event.pageX, event.pageY);\r\n            if (fingerArr.length !== fingers) { // not enough fingers -> fail\r\n                //console.log(fingers + ': not enough fingers -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            let i = 0;\r\n            for (; i < fingerArr.length; i++) {\r\n                if (fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) {\r\n                //do nothing\r\n                return;\r\n            }\r\n\r\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\r\n                //console.log(fingerArr);\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            fingerObj.isUp = true;\r\n\r\n            let allAreUp = true;\r\n            for (let i = 0; i < fingerArr.length; i++) {\r\n                if (!fingerArr[i].isUp) {\r\n                    allAreUp = false;\r\n                    break;\r\n                }\r\n            }\r\n            //console.log('fingerArr', fingerArr);\r\n\r\n            if (allAreUp) { // success\r\n                success();\r\n                return true;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        const result = processEvent(event);\r\n\r\n        //console.log(fingerArr.length);\r\n\r\n        if (result === true) {\r\n            //tap success -> event gets swallowed\r\n            return null;\r\n        }\r\n        if (fingerArr.length === 0) {\r\n            return event;\r\n        } else {\r\n            eventQueueArr.push(event);\r\n        }\r\n\r\n        return null;\r\n\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\r\n * Further pointers are ignored, but their events get swallowed during the pinching.\r\n * pinching ends when ALL pointers are lifted.\r\n * Events passed through if no pinching.\r\n *\r\n * p = {\r\n *      onPinch: function({type: 'end'} | {\r\n *          type: 'move',\r\n *          relX: number,\r\n *          relY: number,\r\n *          downRelX: number,\r\n *          downRelY: number,\r\n *          angleDeg: number,\r\n *          scale: number\r\n *      }) - fires when pinching occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const PinchZoomer = function (p) {\r\n\r\n    const firstFingerMaxDistancePx = 10;\r\n    const untilSecondFingerDurationMs = 250;\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    const pointersDownIdArr = [];\r\n    /*\r\n    gestureObj = {\r\n        touchPointerArr: Array of {\r\n            pointerId: number,\r\n            relX: number,\r\n            relY: number,\r\n            downRelX: number, // only for first\r\n            downRelY: number\r\n        },\r\n        otherPointerIdArr: number[],\r\n        isInProgress: boolean\r\n    }\r\n    */\r\n    let gestureObj = null;\r\n    let eventQueueArr = [];\r\n\r\n\r\n    function end() {\r\n        gestureObj = null;\r\n        eventQueueArr = [];\r\n    }\r\n\r\n    function fail(doSwallow?) {\r\n        if (!gestureObj) { // no gesture happening -> ignore\r\n            return;\r\n        }\r\n\r\n        clearTimeout(timeoutObj.secondFingerTimeout);\r\n        if (!doSwallow) {\r\n            for (let i = 0; i < eventQueueArr.length; i++) {\r\n                chainOut(eventQueueArr[i]);\r\n            }\r\n        }\r\n        end();\r\n    }\r\n\r\n\r\n    let nowTime;\r\n    const timeoutObj = {\r\n        secondFingerTimeout: null\r\n    };\r\n\r\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n\r\n    function processEvent(event) {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        //pass through scenarios\r\n        if (\r\n            !gestureObj && (\r\n                event.pointerType !== 'touch' || // wrong pointer type\r\n                (event.type === 'pointermove' && pointersDownIdArr.length > 0) || // failed before\r\n                pointersDownIdArr.length > 1 || // failed before\r\n                event.type === 'pointerup' // failed before\r\n            )\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n\r\n\r\n        //pointer down\r\n        if (event.type === 'pointerdown') {\r\n\r\n            if (gestureObj) {\r\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\r\n\r\n                    gestureObj.touchPointerArr.push({\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY\r\n                    });\r\n\r\n                    if (gestureObj.isInProgress) {\r\n                        continuePinch(gestureObj, {\r\n                            type: 'down',\r\n                            index: gestureObj.touchPointerArr.length - 1\r\n                        });\r\n                    } else {\r\n                        clearTimeout(timeoutObj.secondFingerTimeout);\r\n                        gestureObj.isInProgress = true;\r\n                        beginPinch(gestureObj);\r\n                    }\r\n                    return;\r\n\r\n                } else { // non-touch finger down - as nth pointer\r\n\r\n                    if (gestureObj.isInProgress) {\r\n                        gestureObj.otherPointerIdArr.push(event.pointerId);\r\n                    } else { // second pointer wrong type -> fail\r\n                        fail();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n\r\n            } else {\r\n                // first finger down - can only be touch if no gestureObj\r\n                gestureObj = {\r\n                    touchPointerArr: [{\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY,\r\n                        downRelX: event.relX,\r\n                        downRelY: event.relY\r\n                    }],\r\n                    otherPointerIdArr: [],\r\n                    isInProgress: false\r\n                };\r\n                if (!setupTimeout('secondFingerTimeout', function () {\r\n                    fail();\r\n                }, event.time + untilSecondFingerDurationMs)) { // time ran out -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        //pointer move\r\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\r\n            //gesture object should always exist here\r\n\r\n            let touchPointerObj = null;\r\n            let i = 0;\r\n            for (; i < gestureObj.touchPointerArr.length; i++) {\r\n                if (event.pointerId === gestureObj.touchPointerArr[i].pointerId) {\r\n                    touchPointerObj = gestureObj.touchPointerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n\r\n            //null should not be possible\r\n\r\n            touchPointerObj.relX = event.relX;\r\n            touchPointerObj.relY = event.relY;\r\n\r\n            if (!gestureObj.isInProgress) { // only one finger down & pinching hasn't started\r\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\r\n                if (distance > firstFingerMaxDistancePx) { // moved too much -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n            } else {\r\n                if (i < 2) { // only first two touches can affect pinching\r\n                    continuePinch(gestureObj, {\r\n                        type: 'move',\r\n                        index: i\r\n                    });\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n\r\n        //pointer up\r\n        if (event.type === 'pointerup') {\r\n            //gesture object should always exist here\r\n\r\n            if (event.pointerType === 'touch') {\r\n                let i = 0;\r\n                for (; i < gestureObj.touchPointerArr.length; i++) {\r\n                    if (gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\r\n                        gestureObj.touchPointerArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n                if (gestureObj.touchPointerArr.length > 0) {\r\n                    continuePinch(gestureObj, {\r\n                        type: 'up',\r\n                        index: i\r\n                    });\r\n                }\r\n\r\n            } else { // non-touch\r\n                for (let i = 0; i < gestureObj.otherPointerIdArr.length; i++) {\r\n                    if (gestureObj.otherPointerIdArr[i] === event.pointerId) {\r\n                        gestureObj.otherPointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            //all fingers lifted?\r\n            if (gestureObj.touchPointerArr.length === 0 && gestureObj.otherPointerIdArr.length === 0) {\r\n                if (gestureObj.isInProgress) { // lifted last finger -> end of pinching\r\n                    end();\r\n                    endPinch();\r\n                } else { // lifted finger again before pinching started -> fail\r\n                    fail();\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    // --- actual pinch transform logic ---\r\n\r\n    let pincherArr = [];\r\n\r\n    function beginPinch(gestureObj) {\r\n\r\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\r\n            const pointerObj = gestureObj.touchPointerArr[i];\r\n            pincherArr.push({\r\n                pointerId: pointerObj.pointerId,\r\n                relX: pointerObj.relX,\r\n                relY: pointerObj.relY,\r\n                downRelX: pointerObj.relX,\r\n                downRelY: pointerObj.relY\r\n            });\r\n        }\r\n\r\n        const event: any = {\r\n            type: 'move',\r\n            angleRad: 0,\r\n            scale: 1\r\n        };\r\n\r\n        if (pincherArr.length === 1) {\r\n            event.relX = pincherArr[0].downRelX;\r\n            event.relY = pincherArr[0].downRelY;\r\n        } else {\r\n            event.relX = 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX);\r\n            event.relY = 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY);\r\n        }\r\n        event.downRelX = event.relX;\r\n        event.downRelY = event.relY;\r\n\r\n        p.onPinch(event);\r\n\r\n    }\r\n\r\n    //actionObj = {type: 'down'|'move'|'up', index: number}\r\n    function continuePinch(gestureObj, actionObj) {\r\n\r\n        if (actionObj.index > 1) { // only first two pointers matter\r\n            return;\r\n        }\r\n\r\n        if (actionObj.type === 'move') {\r\n\r\n            let event;\r\n            pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\r\n            pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\r\n\r\n            if (pincherArr.length === 1) {\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: pincherArr[0].downRelX,\r\n                    downRelY: pincherArr[0].downRelY,\r\n                    relX: pincherArr[0].relX,\r\n                    relY: pincherArr[0].relY,\r\n                    angleRad: 0,\r\n                    scale: 1\r\n                };\r\n\r\n            } else {\r\n\r\n                const startDist = dist(pincherArr[0].downRelX, pincherArr[0].downRelY, pincherArr[1].downRelX, pincherArr[1].downRelY);\r\n                const distance = dist(pincherArr[0].relX, pincherArr[0].relY, pincherArr[1].relX, pincherArr[1].relY);\r\n\r\n                const startAngle = pointsToAngleRad({\r\n                    x: pincherArr[0].downRelX,\r\n                    y: pincherArr[0].downRelY\r\n                }, {x: pincherArr[1].downRelX, y: pincherArr[1].downRelY});\r\n                const angle = pointsToAngleRad({\r\n                    x: pincherArr[0].relX,\r\n                    y: pincherArr[0].relY\r\n                }, {x: pincherArr[1].relX, y: pincherArr[1].relY});\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX),\r\n                    downRelY: 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY),\r\n                    relX: 0.5 * (pincherArr[0].relX + pincherArr[1].relX),\r\n                    relY: 0.5 * (pincherArr[0].relY + pincherArr[1].relY),\r\n                    angleRad: angle - startAngle,\r\n                    scale: distance / startDist\r\n                };\r\n\r\n            }\r\n\r\n            p.onPinch(event);\r\n\r\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\r\n            endPinch();\r\n            beginPinch(gestureObj);\r\n        }\r\n\r\n    }\r\n\r\n    function endPinch() {\r\n        pincherArr = [];\r\n        p.onPinch({\r\n            type: 'end'\r\n        });\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        processEvent(event);\r\n        if (gestureObj) {\r\n            if (!gestureObj.isInProgress) { // might still fail -> into queue\r\n                eventQueueArr.push(event);\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\r\n *\r\n * @constructor\r\n */\r\nexport const CoalescedExploder = function () {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (event.coalescedArr.length > 0) {\r\n\r\n                let eventCopy = JSON.parse(JSON.stringify(event));\r\n                eventCopy.coalescedArr = [];\r\n                let coalescedItem;\r\n\r\n                for (let i = 0; i < event.coalescedArr.length; i++) {\r\n\r\n                    if (i > 0) {\r\n                        eventCopy = JSON.parse(JSON.stringify(event));\r\n                    }\r\n                    coalescedItem = event.coalescedArr[i];\r\n\r\n                    eventCopy.pageX = coalescedItem.pageX;\r\n                    eventCopy.pageY = coalescedItem.pageY;\r\n                    eventCopy.relX = coalescedItem.relX;\r\n                    eventCopy.relY = coalescedItem.relY;\r\n                    eventCopy.dX = coalescedItem.dX;\r\n                    eventCopy.dY = coalescedItem.dY;\r\n                    eventCopy.time = coalescedItem.time;\r\n                    if (i < event.coalescedArr.length - 1) {\r\n                        eventCopy.isCoalesced = true;\r\n                    }\r\n\r\n                    chainOut(eventCopy);\r\n                }\r\n\r\n            } else {\r\n                return event;\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\nexport const OnePointerLimiter = function (pointers?) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    let downPointerId = null;\r\n    const ignorePointerIdArr = [];\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        if (ignorePointerIdArr.includes(event.pointerId)) {\r\n            if (event.type === 'pointerup') {\r\n                for (let i = 0; i < ignorePointerIdArr.length; i++) {\r\n                    if (ignorePointerIdArr[i] === event.pointerId) {\r\n                        ignorePointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        if (downPointerId === null) {\r\n            if (event.type === 'pointerdown') {\r\n                downPointerId = event.pointerId;\r\n            }\r\n            return event;\r\n\r\n        } else {\r\n            if (event.pointerId !== downPointerId) {\r\n                if (event.type === 'pointerdown') {\r\n                    ignorePointerIdArr.push(event.pointerId);\r\n                }\r\n                return null;\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                downPointerId = null;\r\n            }\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n};\r\n\r\n\r\n/**\r\n * Not really and event chain element. but pretty similar.\r\n *\r\n * Processes draw input events. When shift held -> linetool\r\n * line events - what KlCanvasWorkspace passes onDraw(e)\r\n *\r\n * p = {\r\n *     onDraw: function(drawEvent)\r\n * }\r\n *\r\n * pass input in with process(drawEvent)\r\n *\r\n * modifies draw event to include such events:\r\n * {\r\n *     type: 'line',\r\n *     x0: null, // you have to fill that in\r\n *     y0: null, // you have to fill that in\r\n *     pressure0: null, // you have to fill that in\r\n *     x1: number,\r\n *     y1: number,\r\n *     pressure1: number\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const LinetoolProcessor = function (p) {\r\n\r\n    let downEvent = null;\r\n    let eventQueue = [];\r\n    let direction = null;\r\n    const DIR_X = 0, DIR_Y = 1;\r\n\r\n    this.process = function (event) {\r\n        if (event.type === 'down') {\r\n            downEvent = event;\r\n            direction = null;\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                p.onDraw({\r\n                    type: 'line',\r\n                    x0: null,\r\n                    y0: null,\r\n                    pressure0: null,\r\n                    x1: event.x,\r\n                    y1: event.y,\r\n                    pressure1: event.pressure\r\n                });\r\n\r\n                eventQueue.push(event);\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                if (direction === null) {\r\n                    const dX = Math.abs(event.x - downEvent.x);\r\n                    const dY = Math.abs(event.y - downEvent.y);\r\n\r\n                    if (dX > 5 || dY > 5) {\r\n                        direction = dX > dY ? DIR_X : DIR_Y;\r\n\r\n                        for (let i = 0; i < eventQueue.length; i++) {\r\n                            const e = eventQueue[i];\r\n                            if (direction === DIR_X) {\r\n                                e.y = downEvent.y;\r\n                            } else {\r\n                                e.x = downEvent.x;\r\n                            }\r\n                            p.onDraw(JSON.parse(JSON.stringify(e)));\r\n                        }\r\n                        eventQueue = [];\r\n                    }\r\n                }\r\n\r\n                if (direction === null) {\r\n                    eventQueue.push(event);\r\n                    return;\r\n                }\r\n\r\n                if (direction === DIR_X) {\r\n                    event.y = downEvent.y;\r\n                } else {\r\n                    event.x = downEvent.x;\r\n                }\r\n\r\n            } else {\r\n                if (eventQueue.length > 0) {\r\n                    for (let i = 0; i < eventQueue.length; i++) {\r\n                        p.onDraw(JSON.parse(JSON.stringify(eventQueue[i])));\r\n                    }\r\n                    eventQueue = [];\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'up') {\r\n            eventQueue = [];\r\n        }\r\n\r\n        p.onDraw(JSON.parse(JSON.stringify(event)));\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * cleans up DrawEvents. More trustworthy events. EventChain element\r\n *\r\n * that events can only go line this: down -> n x move -> up\r\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\r\n * @constructor\r\n */\r\nexport const LineSanitizer = function () {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    let isDrawing = false;\r\n\r\n    // --- interface ---\r\n    this.chainIn = function (event) {\r\n\r\n        if (event.type === 'down') {\r\n            if (isDrawing) {\r\n                //console.log('line sanitizer - down, but already drawing');\r\n                chainOut({\r\n                    type: 'up',\r\n                    scale: event.scale,\r\n                    shiftIsPressed: event.shiftIsPressed,\r\n                    isCoalesced: false\r\n                });\r\n            } else {\r\n                isDrawing = true;\r\n            }\r\n        }\r\n        if (!isDrawing && (event.type === 'move' || event.type === 'up')) {\r\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\r\n            return null;\r\n        }\r\n\r\n        if (event.type === 'up' && isDrawing) {\r\n            isDrawing = false;\r\n        }\r\n\r\n        return event;\r\n    };\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n    this.getIsDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\r\n * for onDraw events from KlCanvasWorkspace.\r\n *\r\n * p = {\r\n *     smoothing: number, // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\r\n * }\r\n *\r\n * smoothing > 0: will fire DrawEvents in interval when no new move events\r\n *\r\n * type: 'line' Events are just passed through.\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const LineSmoothing = function (p) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    let smoothing = clamp(p.smoothing, 0, 1);\r\n    let lastMixedInput;\r\n    let interval;\r\n    let timeout;\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        event = JSON.parse(JSON.stringify(event));\r\n        clearTimeout(timeout);\r\n        clearInterval(interval);\r\n\r\n        if (event.type === 'down') {\r\n            lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure\r\n            };\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            const inputX = event.x;\r\n            const inputY = event.y;\r\n            const inputPressure = event.pressure;\r\n\r\n            event.x = mix(event.x, lastMixedInput.x, smoothing);\r\n            event.y = mix(event.y, lastMixedInput.y, smoothing);\r\n            event.pressure = mix(event.pressure, lastMixedInput.pressure, smoothing);\r\n            lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure\r\n            };\r\n\r\n            if (smoothing > 0) {\r\n                timeout = setTimeout(function () {\r\n                    interval = setInterval(function () {\r\n                        event = JSON.parse(JSON.stringify(event));\r\n\r\n                        event.x = mix(inputX, lastMixedInput.x, smoothing);\r\n                        event.y = mix(inputY, lastMixedInput.y, smoothing);\r\n                        event.pressure = mix(inputPressure, lastMixedInput.pressure, smoothing);\r\n                        lastMixedInput = {\r\n                            x: event.x,\r\n                            y: event.y,\r\n                            pressure: event.pressure\r\n                        };\r\n\r\n                        chainOut(event);\r\n                    }, 35);\r\n                }, 80);\r\n            }\r\n\r\n        }\r\n\r\n        return event;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n    this.setSmoothing = function (s) {\r\n        smoothing = clamp(s, 0, 1);\r\n    };\r\n};\r\n","import {IKeyString, IRect} from '../BB.types';\r\nimport {createCanvas} from './create-canvas';\r\n\r\nexport function copyCanvas(canvas: HTMLCanvasElement): HTMLCanvasElement {\r\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\r\n    const ctx = resultCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.drawImage(canvas, 0, 0);\r\n    return resultCanvas;\r\n}\r\n\r\n/**\r\n * Determine if should disable imageSmoothing for transformation.\r\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\r\n */\r\nexport function testShouldPixelate(\r\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n    scaleX: number,\r\n    scaleY: number,\r\n): boolean {\r\n    if (\r\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\r\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\r\n        Math.abs(transform.angleDeg) % 90 !== 0\r\n    ) {\r\n        return false;\r\n    }\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    const width = whSwapped ? transform.height : transform.width;\r\n    const height = whSwapped ? transform.width : transform.height;\r\n    return (\r\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\r\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\r\n        ) &&\r\n        (\r\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\r\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\r\n        );\r\n}\r\n\r\n\r\n/**\r\n * @param destCtx - the canvas that will be drawn on\r\n * @param transformImage - image that will be drawn on canvas\r\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\r\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\r\n * @param pixelated\r\n */\r\nexport function drawTransformedImageWithBounds(\r\n    destCtx: CanvasRenderingContext2D,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n    bounds?: {x: number, y: number, width: number, height: number},\r\n    pixelated?: boolean,\r\n): void {\r\n    if (!bounds) {\r\n        bounds = {\r\n            x: 0,\r\n            y: 0,\r\n            width: transformImage.width,\r\n            height: transformImage.height\r\n        };\r\n    }\r\n\r\n    destCtx.save();\r\n    if (pixelated) {\r\n        destCtx.imageSmoothingEnabled = false;\r\n    } else {\r\n        destCtx.imageSmoothingEnabled = true;\r\n        destCtx.imageSmoothingQuality = 'high';\r\n    }\r\n\r\n    destCtx.translate(transform.x, transform.y);\r\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\r\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\r\n    destCtx.drawImage(\r\n        transformImage,\r\n        bounds.x, bounds.y, bounds.width, bounds.height,\r\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\r\n\r\n    destCtx.restore();\r\n}\r\n\r\n/**\r\n * all transformations are optional\r\n * center is the point around which will be scaled and rotated\r\n *\r\n * @param baseCanvas canvas - the canvas that will be drawn on\r\n * @param transformImage image|canvas - image that will be drawn on canvas\r\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\r\n */\r\nexport function drawTransformedImageOnCanvas(\r\n    baseCanvas: HTMLCanvasElement,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transformObj: {\r\n        center: {x: number, y: number},\r\n        scale: {x: number, y: number},\r\n        translate: {x: number, y: number},\r\n        angleDegree: number,\r\n    },\r\n): void {\r\n    transformObj = JSON.parse(JSON.stringify(transformObj));\r\n    if (!transformObj.center) {\r\n        transformObj.center = {\r\n            x: transformImage.width / 2,\r\n            y: transformImage.height / 2\r\n        }\r\n    }\r\n    if (!transformObj.scale) {\r\n        transformObj.scale = {\r\n            x: 1,\r\n            y: 1\r\n        };\r\n    }\r\n    if (!transformObj.angleDegree) {\r\n        transformObj.angleDegree = 0;\r\n    }\r\n    if (!transformObj.translate) {\r\n        transformObj.translate = {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n    }\r\n\r\n    const ctx = baseCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.save();\r\n    if (\r\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\r\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\r\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\r\n    ) {\r\n        ctx.imageSmoothingEnabled = true;\r\n        ctx.imageSmoothingQuality = 'high';\r\n    } else {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n\r\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\r\n    ctx.translate(transformObj.center.x, transformObj.center.y);\r\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\r\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\r\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\r\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\r\n\r\n    ctx.restore();\r\n}\r\n\r\nexport const createCheckerCanvas = function(size: number): HTMLCanvasElement {\r\n    const canvas = createCanvas();\r\n    let ctx;\r\n    if (size < 1) {\r\n        canvas.width = 1;\r\n        canvas.height = 1;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(128, 128, 128)';\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    } else if (size > 200) {\r\n        canvas.width = 401;\r\n        canvas.height = 401;\r\n    } else {\r\n        canvas.width = size * 2;\r\n        canvas.height = size * 2;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(255, 255, 255)';\r\n        ctx.fillRect(0, 0, size * 2, size * 2);\r\n        ctx.fillStyle = 'rgb(200, 200, 200)';\r\n        ctx.fillRect(0, 0, size, size);\r\n        ctx.fillRect(size, size, size * 2, size * 2);\r\n    }\r\n    return canvas;\r\n};\r\n\r\nexport const createCheckerDataUrl = (function () {\r\n    const cache: IKeyString = { // previously created dataUrls\r\n        '8': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\r\n        '4': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC'\r\n    };\r\n\r\n    return function (size: number, callback?: (s: string) => void) {\r\n        function create(size: number): string {\r\n            size = parseInt('' + size);\r\n            if (cache['' + size]) {\r\n                return cache['' + size];\r\n            }\r\n            const canvas = createCheckerCanvas(size);\r\n            const result = canvas.toDataURL('image/png');\r\n            cache['' + size] = result;\r\n            return result;\r\n        }\r\n\r\n        if (callback) { //async\r\n            setTimeout(function () {\r\n                callback(create(size));\r\n            }, 1);\r\n        } else { //sync\r\n            return create(size);\r\n        }\r\n    };\r\n})();\r\n\r\n/**\r\n * smooth resize image\r\n * @param canvas canvas - will be resized (modified)\r\n * @param w\r\n * @param h\r\n * @param tmp1 canvas - optional, provide to save resources\r\n * @param tmp2 canvas - optional, provide to save resources\r\n */\r\nexport function resizeCanvas(\r\n    canvas: HTMLCanvasElement,\r\n    w: number,\r\n    h: number,\r\n    tmp1?: HTMLCanvasElement,\r\n    tmp2?: HTMLCanvasElement,\r\n): void {\r\n\r\n    //determine base 2 exponents of old and new size\r\n    function getBase2Obj(oldW: number, oldH: number, newW: number, newH: number) {\r\n        const result = {\r\n            oldWidthEx: Math.round(Math.log2(oldW)),\r\n            oldHeightEx: Math.round(Math.log2(oldH)),\r\n            newWidthEx: Math.ceil(Math.log2(newW)),\r\n            newHeightEx: Math.ceil(Math.log2(newH))\r\n        };\r\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\r\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\r\n        return result;\r\n    }\r\n\r\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\r\n        return;\r\n    }\r\n    w = Math.max(w, 1);\r\n    h = Math.max(h, 1);\r\n    if (w <= canvas.width && h <= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\r\n\r\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\r\n\r\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\r\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\r\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\r\n        tmp1.getContext('2d')!.save();\r\n        tmp2.getContext('2d')!.save();\r\n\r\n        let ew, eh;\r\n        let buffer1 = tmp1, buffer2 = tmp2;\r\n\r\n        ew = base2.oldWidthEx;\r\n        eh = base2.oldHeightEx;\r\n\r\n        let bufferCtx = buffer2.getContext('2d')!;\r\n        bufferCtx.imageSmoothingEnabled = true;\r\n        bufferCtx.imageSmoothingQuality  = 'high';\r\n        bufferCtx.globalCompositeOperation  = 'copy';\r\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\r\n\r\n        let currentWidth = buffer2.width;\r\n        let currentHeight = buffer2.height;\r\n\r\n        //stepwise half the size\r\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\r\n            bufferCtx = buffer1.getContext('2d')!;\r\n            bufferCtx.imageSmoothingEnabled = true;\r\n            bufferCtx.imageSmoothingQuality  = 'high';\r\n            bufferCtx.globalCompositeOperation  = 'copy';\r\n\r\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\r\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\r\n\r\n            //buffer also needs to be properly sized, unfortunately\r\n            buffer1.width = newWidth;\r\n            buffer1.height = newHeight;\r\n\r\n            bufferCtx.drawImage(\r\n                buffer2,\r\n                0, 0,\r\n                currentWidth, currentHeight,\r\n                0, 0,\r\n                newWidth, newHeight\r\n            );\r\n            currentWidth = newWidth;\r\n            currentHeight = newHeight;\r\n\r\n            //swap\r\n            const tmp = buffer1;\r\n            buffer1 = buffer2;\r\n            buffer2 = tmp;\r\n        }\r\n\r\n        //when no longer can be halved, bring to target size\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        const canvasCtx = canvas.getContext('2d')!;\r\n        canvasCtx.save();\r\n        canvasCtx.imageSmoothingEnabled = true;\r\n        canvasCtx.imageSmoothingQuality  = 'high';\r\n        canvasCtx.drawImage(\r\n            buffer2,\r\n            0, 0,\r\n            currentWidth, currentHeight,\r\n            0, 0,\r\n            w, h\r\n        );\r\n        canvasCtx.restore();\r\n        tmp1.getContext('2d')!.restore();\r\n        tmp2.getContext('2d')!.restore();\r\n\r\n    } else if (w >= canvas.width && h >= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp1.width = w;\r\n        tmp1.height = h;\r\n        const tmp1Ctx = tmp1.getContext('2d')!;\r\n        tmp1Ctx.save();\r\n        tmp1Ctx.imageSmoothingEnabled = true;\r\n        tmp1Ctx.imageSmoothingQuality  = 'high';\r\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\r\n        tmp1Ctx.restore();\r\n\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\r\n\r\n    } else {\r\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\r\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\r\n    }\r\n}\r\n\r\n/**\r\n * puts naive greyscale version of image into alpha channel.\r\n * only writes a, doesn't write rgb\r\n * @param canvas\r\n */\r\nexport function convertToAlphaChannelCanvas(canvas: HTMLCanvasElement): void {\r\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\r\n    for (let i = 0; i < imdat.data.length; i += 4) {\r\n        if (imdat.data[i + 3] === 0) {\r\n            continue;\r\n        }\r\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\r\n    }\r\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\r\n}\r\n\r\n/**\r\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\r\n * or there is a hard to fix memory leak.\r\n * This function manually makes the canvas use as little memory as possible.\r\n */\r\nexport function freeCanvas(canvas: HTMLCanvasElement): void {\r\n    canvas.width = 1;\r\n    canvas.height = 1;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx && ctx.clearRect(0, 0, 1, 1);\r\n}\r\n\r\n/**\r\n * Determine bounding box that describes all pixels which are not fully transparent.\r\n * Returns null if empty.\r\n *\r\n * @param context\r\n */\r\nexport function canvasBounds(context: CanvasRenderingContext2D): IRect | null {\r\n    let boundsObj: {\r\n        x: number;\r\n        y: number;\r\n        width: number;\r\n        height: number;\r\n    } = { x: 0, y: 0, width: 0, height: 0 };\r\n    {\r\n        let tempBounds: any = {\r\n            x1: null,\r\n            y1: null,\r\n            x2: null,\r\n            y2: null\r\n        };\r\n        let imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n        if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\r\n            tempBounds.x1 = 0;\r\n            tempBounds.y1 = 0;\r\n            tempBounds.x2 = context.canvas.width - 1;\r\n            tempBounds.y2 = context.canvas.height - 1;\r\n        } else {\r\n            for (let i = 3; i < imdat.data.length; i += 4) {\r\n                if (imdat.data[i] > 0 ) {\r\n                    let x = ((i - 3) / 4) %  context.canvas.width;\r\n                    let y = Math.floor((i - 3) / 4 / context.canvas.width);\r\n                    if (tempBounds.x1 > x || tempBounds.x1 === null) {\r\n                        tempBounds.x1 = x;\r\n                    }\r\n                    if (tempBounds.y1 === null) {\r\n                        tempBounds.y1 = y;\r\n                    }\r\n                    if (tempBounds.x2 < x || tempBounds.x2 === null) {\r\n                        tempBounds.x2 = x;\r\n                    }\r\n                    if (tempBounds.y2 < y || tempBounds.y2 === null) {\r\n                        tempBounds.y2 = y;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (tempBounds.x1 === null || tempBounds.y1 === null) {\r\n            return null;\r\n        }\r\n        boundsObj.x = tempBounds.x1;\r\n        boundsObj.y = tempBounds.y1;\r\n        boundsObj.width = tempBounds.x2 - tempBounds.x1 + 1;\r\n        boundsObj.height = tempBounds.y2 - tempBounds.y1 + 1;\r\n    }\r\n    return boundsObj;\r\n}","export const Matrix = (function () {\r\n\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\r\n    // yes not optimized - but it's not used for physics simulations.\r\n\r\n    // const perfTotal = 0;\r\n\r\n    // point • matrix\r\n    function multiplyMatrixAndPoint(matrix, point) {\r\n        const result = [\r\n            (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\r\n            (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\r\n            (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\r\n            (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]) // w\r\n        ];\r\n        return result;\r\n    }\r\n\r\n    //matrixB • matrixA\r\n    function multiplyMatrices(matrixA, matrixB) {\r\n\r\n        // Slice the second matrix up into rows\r\n        const row0 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\r\n        const row1 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\r\n        const row2 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\r\n        const row3 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\r\n\r\n        // Multiply each row by matrixA\r\n        const result0 = multiplyMatrixAndPoint(matrixA, row0);\r\n        const result1 = multiplyMatrixAndPoint(matrixA, row1);\r\n        const result2 = multiplyMatrixAndPoint(matrixA, row2);\r\n        const result3 = multiplyMatrixAndPoint(matrixA, row3);\r\n\r\n        // Turn the result rows back into a single matrix\r\n        return [\r\n            result0[0], result0[1], result0[2], result0[3],\r\n            result1[0], result1[1], result1[2], result1[3],\r\n            result2[0], result2[1], result2[2], result2[3],\r\n            result3[0], result3[1], result3[2], result3[3]\r\n        ];\r\n    }\r\n\r\n    function createTranslationMatrix(x, y) {\r\n        return [\r\n            1, 0, 0, 0,\r\n            0, 1, 0, 0,\r\n            0, 0, 1, 0,\r\n            x, y, 0, 1\r\n        ];\r\n    }\r\n\r\n    function createRotationMatrix(angleRad) {\r\n        //let angleRad = angleDeg / 360 * 2 * Math.PI;\r\n        return [\r\n            Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\r\n            Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1\r\n        ];\r\n    }\r\n\r\n    function createScaleMatrix(f) {\r\n        return [\r\n            f, 0, 0, 0,\r\n            0, f, 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1\r\n        ];\r\n    }\r\n\r\n    return {\r\n        getIdentity: function () {\r\n            return [\r\n                1, 0, 0, 0,\r\n                0, 1, 0, 0,\r\n                0, 0, 1, 0,\r\n                0, 0, 0, 1\r\n            ];\r\n        },\r\n        multiplyMatrixAndPoint: multiplyMatrixAndPoint,\r\n        multiplyMatrices: multiplyMatrices,\r\n        createTranslationMatrix: createTranslationMatrix,\r\n        createRotationMatrix: createRotationMatrix,\r\n        createScaleMatrix: createScaleMatrix\r\n    };\r\n})();","import {IVector2D} from '../BB.types';\r\n\r\nexport const Vec2 = {\r\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\r\n    },\r\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\r\n    },\r\n    nor: function (p: IVector2D): IVector2D {\r\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n        return {x: p.x / len, y: p.y / len};\r\n    },\r\n    len: function (p: IVector2D): number {\r\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n    },\r\n    dist: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Vec2.len(Vec2.sub(p1, p2));\r\n    },\r\n    mul: function (p: IVector2D, s: number): IVector2D {\r\n        return {x: p.x * s, y: p.y * s};\r\n    },\r\n    angle: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n    },\r\n    dot: function(a: IVector2D, b: IVector2D): number {\r\n        const aArr = [a.x, a.y];\r\n        const bArr = [b.x, b.y];\r\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\r\n    }\r\n};","import {Vec2} from './vec2';\r\nimport {pointsToAngleDeg, clamp, dist, mix} from './math';\r\nimport {IVector2D} from \"../bb.types\";\r\n\r\n/**\r\n * project p onto line\r\n * @param lineStart\r\n * @param lineEnd\r\n * @param p\r\n */\r\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\r\n    let x, y;\r\n    if (lineStart.x === lineEnd.x) {\r\n        x = lineStart.x;\r\n        y = p.y;\r\n\r\n        return {\r\n            x: x,\r\n            y: y\r\n        };\r\n    }\r\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\r\n    const b = lineStart.y - (m * lineStart.x);\r\n\r\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\r\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\r\n\r\n    return {\r\n        x: x,\r\n        y: y\r\n    };\r\n};\r\n\r\n\r\n\r\n/**\r\n * Operations on a line made up of points\r\n *\r\n * getAtDist(dist) - point when traveling *dist* along the line\r\n * getLength - gives you total length of line\r\n *\r\n * @param params object - {points: [{x:float, y:float}, ...]}\r\n * @constructor\r\n */\r\nexport const PointLine = function (params) {\r\n    const segmentArr = [];\r\n    const _this = this;\r\n\r\n    for (let i = 0; i < params.points.length; i++) {\r\n        (function (i) {\r\n            let length = undefined;\r\n            if (i < params.points.length - 1) {\r\n                length = dist(params.points[i].x, params.points[i].y, params.points[i + 1].x, params.points[i + 1].y);\r\n            }\r\n            segmentArr[i] = {\r\n                x: params.points[i].x,\r\n                y: params.points[i].y,\r\n                length: length\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    /**\r\n     * @param dist number - distance in pixels, > 0\r\n     * @returns {{x: number, y: number}}\r\n     */\r\n    this.getAtDist = function (dist) {\r\n        let remainder = Math.min(_this.getLength(), dist);\r\n        let i = 0;\r\n\r\n        for (; remainder > segmentArr[i].length && i < segmentArr.length - 2; i++) {\r\n            remainder -= segmentArr[i].length;\r\n        }\r\n\r\n        const fac = Math.min(1, Math.max(0, remainder / segmentArr[i].length));\r\n\r\n        return {\r\n            x: (segmentArr[i].x * (1 - fac) + segmentArr[i + 1].x * fac),\r\n            y: (segmentArr[i].y * (1 - fac) + segmentArr[i + 1].y * fac)\r\n        };\r\n    };\r\n    this.getLength = function () {\r\n        let result = 0;\r\n        for (let i = 0; i < segmentArr.length - 1; i++) {\r\n            result += segmentArr[i].length;\r\n        }\r\n        return result;\r\n    };\r\n};\r\n\r\n/**\r\n * Each instance is one line made up of bezier interpolated segments.\r\n * You feed it points. It calculates control points on its own, and the resulting curve.\r\n *\r\n * @constructor\r\n */\r\nexport const BezierLine = function () {\r\n    const _this = this;\r\n    const pointArr = [];\r\n    let lastDot = 0;\r\n    let lastPoint;\r\n    let lastCallbackPoint;\r\n    let lastAngle;\r\n    let lastSpacing = null;\r\n\r\n    /**\r\n     * creates bezier curve from control points\r\n     *\r\n     * @param p1 - control point 1 {x: float, y: float}\r\n     * @param p2 - control point 2 {x: float, y: float}\r\n     * @param p3 - control point 3 {x: float, y: float}\r\n     * @param p4 - control point 4 {x: float, y: float}\r\n     * @param resolution - int\r\n     * @returns {Array} - bezier curve made up of points {x: float, y: float}\r\n     */\r\n    function getBezierPoints(p1, p2, p3, p4, resolution) {\r\n        const curvePoints = [];\r\n        let t, result;\r\n        for (let i = 0; i <= resolution; i++) {\r\n            t = i / resolution;\r\n            result = {};\r\n            result.x = Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x;\r\n            result.y = Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y;\r\n            curvePoints[curvePoints.length] = result;\r\n        }\r\n        return curvePoints;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * add now point to line\r\n     * line will go until the previous point\r\n     *\r\n     * @param x - coord of new point\r\n     * @param y - coord of new point\r\n     * @param spacing - space between each step\r\n     * @param callback - calls for each step - x, y, t - t is 0-1 how far along\r\n     * @param controlsCallback - calls that callback with the bezier control points p1, p2, p3, p4 - each {x: float, y: float}\r\n     */\r\n    this.add = function (x, y, spacing, callback, controlsCallback) {\r\n        if (lastPoint && x === lastPoint.x && y === lastPoint.y) {\r\n            return;\r\n        }\r\n        lastPoint = {x: x, y: y};\r\n        pointArr[pointArr.length] = {\r\n            x: x,\r\n            y: y,\r\n            spacing: spacing\r\n        };\r\n\r\n        //calculate directions\r\n        if (pointArr.length === 1) {\r\n            lastSpacing = spacing;\r\n            return;\r\n        } else if (pointArr.length === 2) {\r\n            pointArr[0].dir = Vec2.nor(Vec2.sub(pointArr[1], pointArr[0]));\r\n            lastDot = spacing;\r\n            lastSpacing = spacing;\r\n            return;\r\n        } else {\r\n            const pointM1 = pointArr[pointArr.length - 1];\r\n            const pointM2 = pointArr[pointArr.length - 2];\r\n            const pointM3 = pointArr[pointArr.length - 3];\r\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\r\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\r\n                //when xy -3 == -1\r\n                pointM2.dir = JSON.parse(JSON.stringify(pointM3.dir));\r\n            }\r\n        }\r\n\r\n        //get bezier curve\r\n        const a = pointArr[pointArr.length - 3];\r\n        const b = pointArr[pointArr.length - 2];\r\n        const p1 = a;\r\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\r\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\r\n        const p4 = b;\r\n\r\n\r\n        let pointLine;\r\n        if (callback) {\r\n            let curvePoints;\r\n            curvePoints = getBezierPoints(p1, p2, p3, p4, 20);\r\n            pointLine = new PointLine({points: curvePoints});\r\n        } else {\r\n            pointLine = new PointLine({points: [p1, p4]});\r\n        }\r\n\r\n        //interate over curve with spacing and callback\r\n        const len = pointLine.getLength();\r\n        let tempSpacing = mix(lastSpacing, spacing, clamp(lastDot / len, 0, 1));\r\n        let d = lastDot;\r\n        for (; d <= len; d += tempSpacing) {\r\n            tempSpacing = mix(lastSpacing, spacing, clamp(d / len, 0, 1));\r\n            const point = pointLine.getAtDist(d);\r\n            const angle = lastCallbackPoint ? pointsToAngleDeg(lastCallbackPoint, point) : undefined;\r\n            if (callback) {\r\n                callback({\r\n                    x: point.x,\r\n                    y: point.y,\r\n                    t: d / len,\r\n                    angle: angle,\r\n                    dAngle: lastCallbackPoint ? angle - lastAngle : 0\r\n                });\r\n            }\r\n            lastCallbackPoint = point;\r\n            lastAngle = angle;\r\n        }\r\n\r\n        if (callback) {\r\n            lastDot = d - len;\r\n        } else {\r\n            lastDot = 0;\r\n            controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\r\n        }\r\n\r\n        lastSpacing = spacing;\r\n    };\r\n\r\n    this.addFinal = function(spacing, callback, controlsCallback) {\r\n        if (pointArr.length < 2) {\r\n            return;\r\n        }\r\n\r\n        const p1 = pointArr[pointArr.length - 2];\r\n        const p2 = pointArr[pointArr.length - 1];\r\n\r\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\r\n\r\n        _this.add(newP.x, newP.y, spacing, callback, controlsCallback);\r\n    };\r\n\r\n};\r\n\r\n/**\r\n * from glfx.script by evanW:\r\n * from SplineInterpolator.cs in the Paint.NET source code\r\n *\r\n * points go 0 - 1. I think.\r\n *\r\n * @param points\r\n * @constructor\r\n */\r\nexport const SplineInterpolator = function (points) {\r\n    const n = points.length;\r\n    this.xa = [];\r\n    this.ya = [];\r\n    this.u = [];\r\n    this.y2 = [];\r\n    let i;\r\n\r\n    const first = points[0][0];\r\n    const last = points[points.length - 1][0];\r\n\r\n    points.sort(function (a, b) {\r\n        return a[0] - b[0];\r\n    });\r\n    for (i = 0; i < n; i++) {\r\n        this.xa.push(points[i][0]);\r\n        this.ya.push(points[i][1]);\r\n    }\r\n\r\n    this.u[0] = 0;\r\n    this.y2[0] = 0;\r\n\r\n    for (i = 1; i < n - 1; ++i) {\r\n        // This is the decomposition loop of the tridiagonal algorithm.\r\n        // y2 and u are used for temporary storage of the decomposed factors.\r\n        const wx = this.xa[i + 1] - this.xa[i - 1];\r\n        const sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n        const p = sig * this.y2[i - 1] + 2.0;\r\n\r\n        this.y2[i] = (sig - 1.0) / p;\r\n\r\n        const ddydx =\r\n            (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\r\n            (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n        this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n    }\r\n\r\n    this.y2[n - 1] = 0;\r\n\r\n    // This is the backsubstitution loop of the tridiagonal algorithm\r\n    for (i = n - 2; i >= 0; --i) {\r\n        this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n    }\r\n\r\n    this.getFirstX = function () {\r\n        return first;\r\n    };\r\n    this.getLastX = function () {\r\n        return last;\r\n    };\r\n};\r\n\r\nSplineInterpolator.prototype.interpolate = function (x) {\r\n    const n = this.ya.length;\r\n    let klo = 0;\r\n    let khi = n - 1;\r\n\r\n    // We will find the right place in the table by means of\r\n    // bisection. This is optimal if sequential calls to this\r\n    // routine are at random values of x. If sequential calls\r\n    // are in order, and closely spaced, one would do better\r\n    // to store previous values of klo and khi.\r\n    while (khi - klo > 1) {\r\n        const k = (khi + klo) >> 1;\r\n\r\n        if (this.xa[k] > x) {\r\n            khi = k;\r\n        } else {\r\n            klo = k;\r\n        }\r\n    }\r\n\r\n    const h = this.xa[khi] - this.xa[klo];\r\n    const a = (this.xa[khi] - x) / h;\r\n    const b = (x - this.xa[klo]) / h;\r\n\r\n    // Cubic spline polynomial is now evaluated.\r\n    return a * this.ya[klo] + b * this.ya[khi] +\r\n        ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n};\r\n\r\n/**\r\n * find x to y. simply by stepping through. suboptimal, so don't call often.\r\n * searches in x 0-1 range\r\n *\r\n * @param y\r\n * @param resolution\r\n */\r\nSplineInterpolator.prototype.findX = function (y, resolution) {\r\n    let x = null;\r\n    let dist = null;\r\n    for (let i = 0; i <= resolution; i++) {\r\n        const tempX = i / resolution;\r\n        const tempY = this.interpolate(tempX);\r\n        if (x === null) {\r\n            x = tempX;\r\n            dist = Math.abs(tempY - y);\r\n            continue;\r\n        }\r\n\r\n        const tempDist = Math.abs(tempY - y);\r\n\r\n        if (tempDist < dist) {\r\n            x = tempX;\r\n            dist = tempDist;\r\n        } else {\r\n            //distance increasing\r\n            break;\r\n        }\r\n    }\r\n    return x;\r\n};\r\n\r\n/**\r\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\r\n * returns [[0, startVal], ..., [1, endVal]]\r\n * @param startVal\r\n * @param endVal\r\n * @param stepSize\r\n * @returns {[]}\r\n */\r\nexport const quadraticSplineInput = function (startVal, endVal, stepSize) {\r\n    function round(v, dec) {\r\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\r\n    }\r\n\r\n    const resultArr = [];\r\n    for (let i = 0; i <= 1; i += stepSize) {\r\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\r\n    }\r\n    return resultArr;\r\n};","\r\n\r\n\r\n// based on js color conversion http://www.webtoolkit.info/\r\n\r\n\r\nexport class HSV {\r\n    h: number;\r\n    s: number;\r\n    v: number;\r\n    constructor(h: number, s: number, v: number) {\r\n        this.h = Math.max(0, Math.min(360, h));\r\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\r\n        this.v = Math.max(0, Math.min(100, v));\r\n    }\r\n}\r\n\r\nexport class RGB {\r\n    r : number;\r\n    g: number;\r\n    b: number;\r\n    constructor(r: number, g: number, b: number) {\r\n        this.r = Math.max(0, Math.min(255, r));\r\n        this.g = Math.max(0, Math.min(255, g));\r\n        this.b = Math.max(0, Math.min(255, b));\r\n    }\r\n}\r\n\r\nexport class CMYK {\r\n    c: number;\r\n    m: number;\r\n    y: number;\r\n    k: number;\r\n    constructor(c: number, m: number, y: number, k: number) {\r\n        this.c = Math.max(0, Math.min(100, c));\r\n        this.m = Math.max(0, Math.min(100, m));\r\n        this.y = Math.max(0, Math.min(100, y));\r\n        this.k = Math.max(0, Math.min(100, k));\r\n    }\r\n}\r\n\r\nexport const ColorConverter = {\r\n\r\n    _RGBtoHSV: function (RGB: RGB): HSV {\r\n        const result = new HSV(0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        const minVal = Math.min(r, g, b);\r\n        const maxVal = Math.max(r, g, b);\r\n        const delta = maxVal - minVal;\r\n\r\n        result.v = maxVal;\r\n\r\n        if (delta == 0) {\r\n            result.h = 0;\r\n            result.s = 0;\r\n        } else {\r\n            result.s = delta / maxVal;\r\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\r\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\r\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\r\n\r\n            if (r == maxVal) {\r\n                result.h = del_B - del_G;\r\n            } else if (g == maxVal) {\r\n                result.h = (1 / 3) + del_R - del_B;\r\n            } else if (b == maxVal) {\r\n                result.h = (2 / 3) + del_G - del_R;\r\n            }\r\n\r\n            if (result.h < 0) {\r\n                result.h += 1;\r\n            }\r\n            if (result.h > 1) {\r\n                result.h -= 1;\r\n            }\r\n        }\r\n\r\n        result.h = Math.round(result.h * 360);\r\n        result.s = Math.round(result.s * 100);\r\n        result.v = Math.round(result.v * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    _HSVtoRGB: function (HSV: HSV): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\r\n\r\n        const h = (HSV.h / 360) % 1;\r\n        const s = HSV.s / 100;\r\n        const v = HSV.v / 100;\r\n\r\n        if (s == 0) {\r\n            result.r = v * 255;\r\n            result.g = v * 255;\r\n            result.b = v * 255;\r\n        } else {\r\n            var_h = h * 6;\r\n            var_i = Math.floor(var_h);\r\n            var_1 = v * (1 - s);\r\n            var_2 = v * (1 - s * (var_h - var_i));\r\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\r\n\r\n            if (var_i == 0) {\r\n                var_r = v;\r\n                var_g = var_3;\r\n                var_b = var_1\r\n            } else if (var_i == 1) {\r\n                var_r = var_2;\r\n                var_g = v;\r\n                var_b = var_1\r\n            } else if (var_i == 2) {\r\n                var_r = var_1;\r\n                var_g = v;\r\n                var_b = var_3\r\n            } else if (var_i == 3) {\r\n                var_r = var_1;\r\n                var_g = var_2;\r\n                var_b = v\r\n            } else if (var_i == 4) {\r\n                var_r = var_3;\r\n                var_g = var_1;\r\n                var_b = v\r\n            } else {\r\n                var_r = v;\r\n                var_g = var_1;\r\n                var_b = var_2\r\n            }\r\n\r\n            result.r = var_r * 255;\r\n            result.g = var_g * 255;\r\n            result.b = var_b * 255;\r\n\r\n            result.r = Math.round(result.r);\r\n            result.g = Math.round(result.g);\r\n            result.b = Math.round(result.b);\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        const c = CMYK.c / 100;\r\n        const m = CMYK.m / 100;\r\n        const y = CMYK.y / 100;\r\n        const k = CMYK.k / 100;\r\n\r\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\r\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\r\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\r\n\r\n        result.r = Math.round(result.r * 255);\r\n        result.g = Math.round(result.g * 255);\r\n        result.b = Math.round(result.b * 255);\r\n\r\n        return result;\r\n    },\r\n\r\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\r\n        const result = new CMYK(0, 0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\r\n        result.c = (1 - r - result.k) / (1 - result.k);\r\n        result.m = (1 - g - result.k) / (1 - result.k);\r\n        result.y = (1 - b - result.k) / (1 - result.k);\r\n\r\n        result.c = Math.round(result.c * 100);\r\n        result.m = Math.round(result.m * 100);\r\n        result.y = Math.round(result.y * 100);\r\n        result.k = Math.round(result.k * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\r\n        if (o instanceof RGB) {\r\n            return o;\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._HSVtoRGB(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._CMYKtoRGB(o);\r\n        }\r\n    },\r\n\r\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\r\n        if (o instanceof HSV) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoHSV(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\r\n        }\r\n    },\r\n\r\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\r\n        if (o instanceof CMYK) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoCMYK(o);\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\r\n        }\r\n    },\r\n    toHexString: function (o: RGB): string {\r\n        if (o instanceof RGB || ('r' in o && 'g' in o && 'b' in o)) {\r\n            let ha = (parseInt('' + o.r)).toString(16);\r\n            let hb = (parseInt('' + o.g)).toString(16);\r\n            let hc = (parseInt('' + o.b)).toString(16);\r\n            if (ha.length == 1)\r\n                ha = '0' + ha;\r\n            if (hb.length == 1)\r\n                hb = '0' + hb;\r\n            if (hc.length == 1)\r\n                hc = '0' + hc;\r\n            return ha + hb + hc;\r\n        }\r\n    },\r\n    toRgbStr: function(rgbObj: {r: number, g: number, b: number}): string {\r\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\r\n    },\r\n    toRgbaStr: function(rgbaObj: {r: number, g: number, b: number, a: number}): string {\r\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\r\n    },\r\n    hexToRGB: function(hexStr: string): RGB | null {\r\n        hexStr = hexStr.trim();\r\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n        hexStr = hexStr.replace(shorthandRegex, function(m, r, g, b) {\r\n            return r + r + g + g + b + b;\r\n        });\r\n\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\r\n        return result ? new RGB(\r\n            parseInt(result[1], 16),\r\n            parseInt(result[2], 16),\r\n            parseInt(result[3], 16)\r\n        ) : null;\r\n    }\r\n\r\n};\r\n\r\nexport function testIsWhiteBestContrast(rgbObj: {r: number, g: number, b: number}): boolean {\r\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\r\n}","import {addEventListener} from '../input/event-listener';\r\nimport {css} from './base';\r\nimport {BB} from '../bb';\r\n\r\n\r\nexport function appendTextDiv(target: HTMLElement, text: string): HTMLDivElement {\r\n    const div = document.createElement('div');\r\n    div.innerHTML = text;\r\n    target.appendChild(div);\r\n    return div;\r\n}\r\n\r\n/**\r\n * Is an input element focused.\r\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\r\n *\r\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\r\n */\r\nexport function isInputFocused(getAll: boolean = false): boolean {\r\n    let result = document.activeElement && ['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName);\r\n    if (getAll) {\r\n        return result;\r\n    } else {\r\n        return result && !document.activeElement.getAttribute('data-ignore-focus');\r\n    }\r\n}\r\n\r\nexport function unfocusAnyInput(): void {\r\n    if (isInputFocused(true)) {\r\n        /*\r\n            Unfocus anything that is focused.\r\n\r\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\r\n            that isn't its direct parent, then Firefox will keep anything attached to this\r\n            Input in memory. It will not be garbage collected until a new Input is focused.\r\n\r\n            Workaround: Temporarily create an input, focus it, detach it.\r\n             */\r\n        const focusEl = BB.el({\r\n            parent: document.body,\r\n            tagName: 'input',\r\n            css: {\r\n                opacity: '0',\r\n                width: '0',\r\n                height: '0',\r\n            }\r\n        }) as HTMLInputElement;\r\n        setTimeout(() => {\r\n            focusEl.select();\r\n            focusEl.focus();\r\n            focusEl.parentNode.removeChild(focusEl);\r\n        }, 10);\r\n    }\r\n}\r\n\r\n/**\r\n * clears text selection in window\r\n */\r\nexport function clearSelection(): void {\r\n    if (window.getSelection) {\r\n        const sel = window.getSelection();\r\n        if (sel) {\r\n            if (sel.empty) {\r\n                sel.empty();\r\n            } else if (sel.removeAllRanges) {\r\n                sel.removeAllRanges();\r\n            }\r\n        }\r\n    } else if ('selection' in document) {\r\n        (document as any).selection.empty();\r\n    }\r\n}\r\n\r\n/**\r\n * prevents being able to focus element.\r\n * warning: it creates a listener\r\n *\r\n * @param el - dom element\r\n */\r\nexport const makeUnfocusable = (function() {\r\n\r\n    function preventFocus(event: MouseEvent) {\r\n        event.preventDefault();\r\n        let didFocusRelated = false;\r\n        if (event.relatedTarget) {\r\n            try {\r\n                (event.relatedTarget as HTMLElement).focus();\r\n                didFocusRelated = true;\r\n            } catch(e) {\r\n                console.error('failed to focus');\r\n            }\r\n        }\r\n        if (!didFocusRelated) {\r\n            (event.currentTarget as HTMLElement).blur();\r\n        }\r\n    }\r\n\r\n    return function(el) {\r\n        el.setAttribute('tabindex', '-1');\r\n        addEventListener(el, 'focus', preventFocus);\r\n    };\r\n})();\r\n\r\n\r\nconst els: {\r\n    el: HTMLElement;\r\n    listeners: [string, any][];\r\n}[] = [];\r\n// window['els'] = els;\r\n\r\n/**\r\n *\r\n * Create DOM element - div by default\r\n * params = {\r\n * \t    parent: someOtherDiv,\r\n * \t    css: {\r\n * \t\t    width: \"500px\",\r\n * \t\t    backgroundColor: \"#fff\"\r\n * \t    },\r\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\r\n * \t    className: \"bla\",\r\n *      id: \"bla\"\r\n * }\r\n *\r\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\r\n *  to prevent a memory leak.\r\n *\r\n * @param params\r\n */\r\nexport function el(\r\n    params: {\r\n        parent?: HTMLElement,\r\n        css?: { [key: string]: string },\r\n        custom?: { [key: string]: any },\r\n        content?: string | (HTMLElement | string | null)[] | HTMLElement | SVGElement,\r\n        textContent?: string,\r\n        className?: string,\r\n        title?: string,\r\n        id?: string,\r\n        tagName?: string,\r\n        onClick?: (e: Event) => void,\r\n        onChange?: (e: Event) => void,\r\n    }\r\n): HTMLElement {\r\n    const div = document.createElement(params.tagName ? params.tagName : 'div');\r\n    if (params.css) {\r\n        css(div, params.css);\r\n    }\r\n\r\n    if (params.content) {\r\n        if (typeof params.content === typeof 'aa') {\r\n            div.innerHTML = params.content as string;\r\n\r\n        } else if (Array.isArray(params.content)) {\r\n            BB.append(div, params.content);\r\n\r\n        } else {\r\n            div.appendChild(params.content as HTMLElement);\r\n\r\n        }\r\n    }\r\n    if (params.textContent) {\r\n        div.textContent = params.textContent;\r\n    }\r\n    if (params.className) {\r\n        div.className = params.className;\r\n    }\r\n    if (params.id) {\r\n        div.id = params.id;\r\n    }\r\n    if (params.parent) {\r\n        params.parent.appendChild(div);\r\n    }\r\n    if ('title' in params && params.title !== undefined) {\r\n        div.title = params.title;\r\n    }\r\n    const listeners = [];\r\n    if ('onClick' in params) {\r\n        addEventListener(div, 'click', params.onClick);\r\n        listeners.push(['click', params.onClick]);\r\n    }\r\n    if ('onChange' in params) {\r\n        addEventListener(div, 'change', params.onChange);\r\n        listeners.push(['change', params.onChange]);\r\n    }\r\n    if (listeners.length > 0) {\r\n        els.push({\r\n            el: div,\r\n            listeners: listeners,\r\n        })\r\n        /*div.style.backgroundColor = '#ff0';\r\n        div.style.border = '1px solid #ff0';*/\r\n    }\r\n    if ('custom' in params) {\r\n        const customKeyArr = Object.keys(params.custom);\r\n        for (let i = 0; i < customKeyArr.length; i++) {\r\n            div.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\r\n        }\r\n    }\r\n    return div;\r\n}\r\n\r\n/**\r\n * removes event listeners for Elements created via el()\r\n * @param el\r\n */\r\nexport function destroyEl(el: HTMLElement) {\r\n    for (let i = 0; i < els.length; i++) {\r\n        const item = els[i];\r\n        if (item.el === el) {\r\n            item.listeners.forEach(item => {\r\n                el.removeEventListener(item[0], item[1]);\r\n            });\r\n            els.splice(i, 1);\r\n            return;\r\n        }\r\n    }\r\n    // not found\r\n    return;\r\n}\r\n","\r\nexport class BbLog {\r\n\r\n    private static listeners: any[] = [];\r\n\r\n    constructor() {\r\n    }\r\n\r\n    static subscribe(listener) {\r\n        if (BbLog.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        BbLog.listeners.push(listener);\r\n    }\r\n\r\n    static unsubscribe(listener) {\r\n        for (let i = 0; i < BbLog.listeners.length; i++) {\r\n            if (listener === BbLog.listeners[i]) {\r\n                BbLog.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    static emit (msg) {\r\n        BbLog.listeners.forEach(item => {\r\n            item(msg);\r\n        });\r\n    }\r\n}",null,"/**\r\n * LocalStorage wrapper that does not throw exceptions.\r\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\r\n */\r\nexport class LocalStorage {\r\n\r\n    private static error;\r\n\r\n    static getItem (key: string): string {\r\n        let result = null;\r\n        try {\r\n            result = localStorage.getItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static setItem (key: string, value: string): void {\r\n        try {\r\n            localStorage.setItem(key, value);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static removeItem (key: string): void {\r\n        try {\r\n            localStorage.removeItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static getError (): any {\r\n        return this.error;\r\n    }\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"l7FYj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kbyFQ\");","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Checkbox - with label\r\n */\r\nexport class Checkbox {\r\n\r\n    private element: HTMLElement;\r\n    private check: HTMLInputElement;\r\n    private doHighlight: boolean;\r\n\r\n    // --- public ---\r\n\r\n    constructor (params: {\r\n        init?: boolean; // default false\r\n        label: string;\r\n        callback: (boolean) => void;\r\n        allowTab?: boolean; // default false\r\n        title?: string;\r\n        doHighlight?: boolean; // default false\r\n        css?: any;\r\n    }) {\r\n        this.doHighlight = params.doHighlight;\r\n\r\n        this.element = BB.el({\r\n            className: 'kl-checkbox'\r\n        });\r\n\r\n        const innerEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'label',\r\n            className: 'kl-checkbox__inner'\r\n        });\r\n\r\n        this.check = BB.el({\r\n            parent: innerEl,\r\n            tagName: 'input',\r\n            css: {\r\n                marginLeft: '0',\r\n                display: 'inline-block'\r\n            },\r\n            custom: {\r\n                type: 'checkbox'\r\n            }\r\n        }) as HTMLInputElement;\r\n        this.check.checked = params.init;\r\n        if (this.doHighlight && this.check.checked) {\r\n            this.element.classList.add('kl-checkbox--highlight');\r\n        }\r\n        if (!params.allowTab) {\r\n            this.check.tabIndex = -1;\r\n        }\r\n\r\n        if (params.title) {\r\n            innerEl.title = params.title;\r\n        }\r\n\r\n        const label = document.createElement('div');\r\n        label.style.display = 'inline-block';\r\n        label.innerHTML = params.label;\r\n        (label as any).allowClick = true;\r\n        innerEl.appendChild(label);\r\n\r\n        this.check.onchange = () => {\r\n            if (this.doHighlight) {\r\n                this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n            }\r\n            params.callback(this.check.checked);\r\n            setTimeout(() => {\r\n                this.check.blur();\r\n            }, 0);\r\n        };\r\n        if (params.css) {\r\n            BB.css(this.element, params.css);\r\n        }\r\n    }\r\n\r\n    getValue(): boolean {\r\n        return this.check.checked;\r\n    }\r\n\r\n    setValue(b: boolean) {\r\n        this.check.checked = !!b;\r\n        if (this.doHighlight) {\r\n            this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n        }\r\n    }\r\n\r\n    getElement(): HTMLElement {\r\n        return this.element;\r\n    }\r\n\r\n    destroy() {\r\n        this.check.onchange = null;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\nexport const input = function (params: {\r\n    type?: 'button' | 'checkbox' | 'number' | 'text' | 'color'; // default text\r\n    min?: number;\r\n    max?: number;\r\n    callback: (val: string) => void;\r\n    init: string | number;\r\n    css?: IKeyString;\r\n}) {\r\n    const result = document.createElement('input');\r\n    if (params.type) {\r\n        try {\r\n            result.type = params.type;\r\n        } catch(e) {} // ie can't deal with number\r\n    } else {\r\n        result.type = 'text';\r\n    }\r\n    if (params.min !== undefined) {\r\n        result.min = '' + params.min;\r\n    }\r\n    if (params.max !== undefined) {\r\n        result.max = '' + params.max;\r\n    }\r\n    result.value = '' + params.init;\r\n    if (params.callback) {\r\n        result.onchange = function() {\r\n            params.callback(result.value);\r\n        };\r\n    }\r\n    if (params.css) {\r\n        BB.css(result, params.css);\r\n    }\r\n\r\n    return result;\r\n};","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\n/**\r\n * A select dropdown\r\n */\r\nexport class Select {\r\n\r\n    private selectEl: HTMLSelectElement;\r\n    private optionArr: ([string, string] | null)[]; // [value, label]\r\n    private changeListener: (event) => void;\r\n    private onChange: (val: string) => void;\r\n\r\n    \r\n    // --- public ---\r\n    constructor (p: {\r\n        isFocusable?: boolean; // default false\r\n        optionArr: ([string, string] | null)[], // [value, label]\r\n        initValue?: string; // default null\r\n        onChange: (val: string) => void;\r\n        css?: IKeyString;\r\n        title?: string;\r\n    }) {\r\n        this.selectEl = BB.el({\r\n            tagName: 'select',\r\n            title: p.title,\r\n            css: {\r\n                cursor: 'pointer',\r\n                fontSize: '15px',\r\n                padding: '3px',\r\n                background: '#fff', // makes safari pay attention to font-size\r\n                //webkitAppearance: 'none'\r\n                colorScheme: 'only light', // chrome doesn't properly invert the text color\r\n            }\r\n        }) as HTMLSelectElement;\r\n        if (p.css) {\r\n            BB.css(this.selectEl, p.css);\r\n        }\r\n\r\n        const isFocusable = p.isFocusable;\r\n        if (!isFocusable) {\r\n            this.selectEl.tabIndex = -1;\r\n        }\r\n        this.optionArr = p.optionArr;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if (this.optionArr[i] === null) {\r\n                continue;\r\n            }\r\n            const option = document.createElement('option');\r\n            option.value = this.optionArr[i][0];\r\n            option.textContent = this.optionArr[i][1];\r\n            this.selectEl.append(option);\r\n        }\r\n        this.onChange = p.onChange;\r\n        this.changeListener = (e) => {\r\n            if (!isFocusable) {\r\n                this.selectEl.blur();\r\n            }\r\n            this.onChange(this.selectEl.value);\r\n        };\r\n        this.selectEl.addEventListener('change', this.changeListener);\r\n        this.selectEl.value = 'initValue' in p ? p.initValue : null;\r\n    }\r\n\r\n    setValue (val) {\r\n        this.selectEl.value = val;\r\n    }\r\n\r\n    getValue () {\r\n        return this.selectEl.value;\r\n    }\r\n\r\n    setDeltaValue (delta) {\r\n        let index = 0;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if ('' + this.optionArr[i][0] === this.selectEl.value) {\r\n                index = i;\r\n                break;\r\n            }\r\n        }\r\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\r\n        this.selectEl.value = this.optionArr[index][0];\r\n        this.onChange(this.selectEl.value);\r\n    }\r\n\r\n    getElement () {\r\n        return this.selectEl;\r\n    }\r\n\r\n    destroy = () => {\r\n        this.selectEl.removeEventListener('change', this.changeListener);\r\n    }\r\n    \r\n}\r\n","import {BB} from '../../../bb/bb';\r\n\r\n\r\n/**\r\n * Toggle button with an image\r\n *\r\n * p = {\r\n *     initValue: boolean,\r\n *     title: string,\r\n *     isRadio: boolean, // if true, can't click when active\r\n *     onChange: function(boolean)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const ImageToggle = function(p) {\r\n    let isActive = !!p.initValue;\r\n    const div = BB.el({\r\n        className: 'image-toggle',\r\n        title: p.title,\r\n        css: {\r\n            backgroundImage: \"url('\" + p.image + \"')\"\r\n        },\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            if (p.isRadio && isActive) {\r\n                return;\r\n            }\r\n            isActive = !isActive;\r\n            update();\r\n            p.onChange(isActive);\r\n        },\r\n    });\r\n\r\n    function update() {\r\n        div.classList.toggle('image-toggle-active', isActive);\r\n    }\r\n\r\n    update();\r\n\r\n    // --- interface ---\r\n    this.setValue = function(b) {\r\n        isActive = !!b;\r\n        update();\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return isActive;\r\n    };\r\n    this.destroy = () => {\r\n        BB.destroyEl(div);\r\n    };\r\n\r\n};","import {BB} from '../../../bb/bb';\r\nimport {ImageToggle} from './image-toggle';\r\n\r\n/**\r\n * Radio input group. each one has an image\r\n *\r\n * p = {\r\n *     optionArr: {\r\n *         id: string,\r\n *         title: string,\r\n *         image: string,\r\n *     }[],\r\n *     initId: string,\r\n *     sizePx: number,\r\n *     onChange: function(id: string): void\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport const ImageRadioList = function(p) {\r\n\r\n    const div = BB.el({\r\n        className: 'image-radio-wrapper',\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n\r\n    let activeIndex;\r\n    const optionArr = [];\r\n\r\n    function select(index, id) {\r\n        activeIndex = index;\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            optionArr[i].setValue(i === activeIndex);\r\n        }\r\n        p.onChange(id);\r\n    }\r\n\r\n    function createOption(index, o) {\r\n        if (o.id === p.initId) {\r\n            activeIndex = index;\r\n        }\r\n        const radioEl = new ImageToggle({\r\n            image: o.image,\r\n            title: o.title,\r\n            initValue: o.id === p.initId,\r\n            isRadio: true,\r\n            onChange: function() {\r\n                select(index, o.id);\r\n            }\r\n        });\r\n        div.appendChild(radioEl.getElement());\r\n\r\n        return radioEl;\r\n\r\n    }\r\n\r\n    for (let i = 0; i < p.optionArr.length; i++) {\r\n        optionArr.push(createOption(i, p.optionArr[i]));\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return p.optionArr[activeIndex].id;\r\n    };\r\n    this.destroy = () => {\r\n        optionArr.forEach(item => {\r\n            item.destroy();\r\n        })\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport iconImg from 'url:~/src/app/img/ui/brush-pressure.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * small toggle button with a pen icon - representing toggling pressure sensitivity\r\n * @param isChecked - boolean - initial value\r\n * @param changeCallback - function(isChecked boolean) - called on change\r\n * @returns {HTMLElement} - the toggle button\r\n */\r\nexport const penPressureToggle = function(isChecked, changeCallback) {\r\n\r\n    const toggleDiv = BB.el({\r\n        css: {\r\n            cssFloat: 'right',\r\n            borderRadius: '3px',\r\n            width: '18px',\r\n            height: '18px',\r\n            backgroundImage: 'url(\"' + iconImg + '\")',\r\n            backgroundSize: 'contain',\r\n            backgroundRepeat: 'no-repeat',\r\n            cursor: 'pointer',\r\n            boxSizing: 'border-box',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n\r\n    if (!BB.hasPointerEvents) {\r\n        toggleDiv.style.display = 'none';\r\n    }\r\n\r\n    function redraw() {\r\n        if (isChecked) {\r\n            BB.css(toggleDiv, {\r\n                backgroundColor: '#fff',\r\n                opacity: '0.9',\r\n                border: '1px solid var(--active-highlight-color)'\r\n            });\r\n        } else {\r\n            BB.css(toggleDiv, {\r\n                backgroundColor: 'transparent',\r\n                opacity: '0.5',\r\n                border: '1px solid #666'\r\n            });\r\n        }\r\n    }\r\n\r\n    toggleDiv.title = LANG('brush-toggle-pressure');\r\n    toggleDiv.onclick = function() {\r\n        isChecked = !isChecked;\r\n        redraw();\r\n        changeCallback(isChecked);\r\n    };\r\n\r\n    redraw();\r\n    changeCallback(isChecked);\r\n\r\n    return toggleDiv;\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"5H9IS\");","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport {IKlSliderConfig} from '../../kl.types';\r\nimport {languageStrings} from '../../../language/language';\r\nimport {DoubleTapper, EventChain} from '../../../bb/input/event-chain';\r\nimport {KlSliderManualInput} from './kl-slider-manual-input';\r\n\r\n/**\r\n * Horizontal slider, can be changed by dragging anywhere on it. Has a label & value.\r\n * e.g. used for brush size\r\n *\r\n * left mouse button - set absolute value\r\n * right mouse button - change relative value\r\n * drag mouse vertically away - high precision mode\r\n * double-click/tap slider -> manual input mode\r\n *\r\n * Values can be spline interpolated\r\n * On change callback can be debounced\r\n *\r\n */\r\nexport class KlSlider {\r\n\r\n    /*\r\n    Three types of values\r\n    - value - the actual value, when using setValue(), getValue(), and what is emitted\r\n    - displayValue - the number that the user sees on the slider and in the manual input field\r\n        - might be further formatted with formatFunc\r\n        - also might be the same as value, if no toDisplayValue function provided\r\n    - sliderValue - the draggable position of the slider, 0 - 1\r\n     */\r\n\r\n    private value: number;\r\n\r\n    private elementWidth: number;\r\n    private elementHeight: number;\r\n    private isEnabled: boolean;\r\n\r\n    private min: number; // min value\r\n    private max: number; // max value\r\n    private useSpline: boolean;\r\n    private splineInterpolator: any; // todo type\r\n    private resolution: number;\r\n\r\n    private isChangeOnFinal: boolean;\r\n    private formatFunc: null | ((val: number) => number);\r\n\r\n    private onChange: (val: number) => void;\r\n    private valueToDisplayValue: (value: number) => number;\r\n    private displayValueToValue: (displayValue: number) => number;\r\n\r\n\r\n    private roolEl: HTMLElement;\r\n    private sliderWrapperEl: HTMLElement;\r\n    private textEl: HTMLElement; // displays label, displayValue\r\n    private label: string;\r\n    private control: HTMLElement;\r\n    private manualInput: null | KlSliderManualInput;\r\n    private manualInputRoundDigits: number;\r\n\r\n    private pointerListener: any; // todo type\r\n    private pointerListenerTimeout: any;\r\n\r\n    private eventResMs: null | number;\r\n    private emitValue: null | number = null; // next value for interval\r\n    private emitInterval: null | any; // interval of eventResMs which calls onChange()\r\n\r\n    private valueToSliderValue(value: number): number {\r\n        if (this.useSpline) {\r\n            return this.splineInterpolator.findX(value, Math.floor(this.resolution));\r\n        }\r\n        return (value - this.min) / (this.max - this.min);\r\n    }\r\n\r\n    private sliderValuetoValue(sliderValue: number): number {\r\n        let result = this.min + sliderValue * (this.max - this.min);\r\n        if (this.useSpline) {\r\n            result = this.splineInterpolator.interpolate(sliderValue);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private updateLabel(): void {\r\n        let displayValue: number | string = this.valueToDisplayValue(this.value);\r\n        displayValue = this.formatFunc ? this.formatFunc(displayValue) : Math.round(displayValue);\r\n        displayValue = displayValue.toLocaleString(languageStrings.getCode());\r\n        this.textEl.innerHTML = this.label + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + displayValue + '</span>';\r\n\r\n        const sliderValue = this.valueToSliderValue(this.value);\r\n        this.control.style.width = (sliderValue * this.elementWidth) + 'px';\r\n    }\r\n\r\n    private emit(isFinal: boolean): void {\r\n        if (!isFinal && this.isChangeOnFinal) {\r\n            return;\r\n        }\r\n\r\n        if (isFinal || !this.eventResMs) {\r\n            this.onChange(this.value);\r\n            if (this.emitInterval) {\r\n                clearInterval(this.emitInterval);\r\n                this.emitInterval = null;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (this.emitInterval) {\r\n            this.emitValue = this.value;\r\n\r\n        } else {\r\n            this.onChange(this.value);\r\n\r\n            this.emitInterval = setInterval(() => {\r\n                if (this.emitValue === null) {\r\n                    clearInterval(this.emitInterval);\r\n                    this.emitInterval = null;\r\n                } else {\r\n                    this.onChange(this.emitValue);\r\n                    this.emitValue = null;\r\n                }\r\n            }, this.eventResMs);\r\n        }\r\n    }\r\n\r\n    private updateEnable(): void {\r\n        BB.css(this.sliderWrapperEl, {\r\n            opacity: this.isEnabled ? null : '0.5',\r\n            pointerEvents: this.isEnabled ? null : 'none',\r\n        });\r\n        if (this.manualInput) {\r\n            this.manualInput.setIsEnabled(this.isEnabled);\r\n        }\r\n    }\r\n\r\n    private showManualInput(): void {\r\n\r\n        this.manualInput = new KlSliderManualInput(\r\n            this.valueToDisplayValue(this.value),\r\n            this.valueToDisplayValue(this.min),\r\n            this.valueToDisplayValue(this.max),\r\n            this.sliderWrapperEl.getBoundingClientRect(),\r\n            (val) => {\r\n                val = this.displayValueToValue(val);\r\n                this.setValue(BB.clamp(val, this.min, this.max));\r\n                this.onChange(this.value);\r\n            },\r\n            () => {\r\n                BB.css(this.sliderWrapperEl, {\r\n                    display: null,\r\n                });\r\n                this.roolEl.removeChild(this.manualInput.getElement());\r\n                this.manualInput.destroy();\r\n                this.manualInput = null;\r\n            },\r\n            (this.manualInputRoundDigits && this.manualInputRoundDigits > 0) ? this.manualInputRoundDigits : 0,\r\n        );\r\n        this.roolEl.append(this.manualInput.getElement());\r\n        setTimeout(() => {\r\n            this.manualInput.focus();\r\n        });\r\n        BB.css(this.sliderWrapperEl, {\r\n            display: 'none',\r\n        });\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        p: {\r\n            label: string,\r\n            width: number, // px\r\n            height: number, // px\r\n            min: number, // min value\r\n            max: number,\r\n            value: number,\r\n            resolution?: number, // int, if you want spline.findX() to use a custom resolution\r\n            curve?: 'quadratic' | any[], // optional. array is BB.SplineInterpolator points. 0-1\r\n            formatFunc?: (val: number) => number, // function to display a different number than value\r\n            onChange?: (val: number) => void,\r\n            isChangeOnFinal?: boolean, // only fire onChange on pointerUp\r\n            eventResMs?: number, // frequency of change events\r\n            isEnabled?: boolean, // default = true\r\n            manualInputRoundDigits?: number, // default 0, how value should be rounded for manual input\r\n            toDisplayValue?: (value: number) => number,\r\n            toValue?: (displayValue: number) => number,\r\n        }\r\n    ) {\r\n        const _this = this;\r\n        this.isEnabled = p.isEnabled !== false;\r\n        this.manualInputRoundDigits = p.manualInputRoundDigits;\r\n        this.useSpline = !!p.curve;\r\n\r\n        if (!p.label) {\r\n            throw new Error('KlSlider missing params');\r\n        }\r\n        if (p.min != 0 && p.max != 0 && p.value != 0) {\r\n            if (!p.min || !p.max || !p.value) {\r\n                throw new Error('KlSlider broken params');\r\n            }\r\n        }\r\n        if (p.min >= p.max) {\r\n            throw new Error('KlSlider broken params');\r\n        }\r\n\r\n        this.min = p.min;\r\n        this.max = p.max;\r\n        this.value = BB.clamp(p.value, this.min, this.max);\r\n        this.elementWidth = p.width;\r\n        this.elementHeight = p.height;\r\n        this.resolution = p.resolution ? p.resolution : this.elementWidth * 2;\r\n\r\n        this.onChange = p.onChange ? p.onChange : () => {};\r\n        if (!this.displayValueToValue !== !this.valueToDisplayValue) {\r\n            throw new Error('both or neither have to be set, toValue and toDisplayValue');\r\n        }\r\n        this.displayValueToValue = p.toValue ? p.toValue : (displayValue) => displayValue;\r\n        this.valueToDisplayValue = p.toDisplayValue ? p.toDisplayValue : (value) => value;\r\n        this.isChangeOnFinal = !!p.isChangeOnFinal;\r\n        this.formatFunc = p.formatFunc;\r\n        this.eventResMs = p.eventResMs;\r\n\r\n        if (this.useSpline) {\r\n            const curveArr = p.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : p.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        }\r\n\r\n        this.roolEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n        this.sliderWrapperEl = BB.el({\r\n            parent: this.roolEl,\r\n            className: 'sliderWrapper',\r\n            css: {\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n                width: this.elementWidth + 'px',\r\n                height: this.elementHeight + 'px',\r\n                userSelect: 'none'\r\n            }\r\n        });\r\n        this.roolEl.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        this.label = p.label;\r\n        const labelFontSize = this.elementHeight - 14;\r\n        this.textEl = BB.el({\r\n            content: this.label,\r\n            css: {\r\n                position: 'absolute',\r\n                left: '7px',\r\n                top: (this.elementHeight / 2 - labelFontSize / 2 + 1) + 'px',\r\n                lineHeight: labelFontSize + 'px',\r\n                fontSize: labelFontSize + 'px',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        this.control = BB.el({\r\n            className: 'sliderInner',\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                width: (this.valueToSliderValue(this.value) * this.elementWidth) + 'px',\r\n                height: this.elementHeight + 'px',\r\n            }\r\n        });\r\n        const controlInner = document.createElement('div');\r\n\r\n        this.sliderWrapperEl.append(this.control, this.textEl);\r\n        this.control.append(controlInner);\r\n\r\n        this.updateEnable();\r\n\r\n\r\n        const doubleTapper = new DoubleTapper({\r\n            onDoubleTap: () => {\r\n                this.showManualInput();\r\n            }\r\n        })\r\n        doubleTapper.setAllowedButtonArr(['left', 'right']);\r\n        const eventChain = new EventChain({\r\n            chainArr: [\r\n                doubleTapper\r\n            ]\r\n        });\r\n\r\n        let virtualVal;\r\n        const onPointer = (event) => {\r\n            event.eventPreventDefault();\r\n\r\n            if (!this.isEnabled) {\r\n                return;\r\n            }\r\n\r\n            if (event.type === 'pointerdown') {\r\n\r\n                // unfocus manual slider input\r\n                BB.unfocusAnyInput();\r\n\r\n                this.sliderWrapperEl.className = 'sliderWrapper sliderWrapperActive';\r\n\r\n                if (event.button === 'left') {\r\n                    let sliderValue = event.relX / this.elementWidth;\r\n                    sliderValue = Math.max(0, Math.min(1, sliderValue));\r\n                    this.value = this.sliderValuetoValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.emit(false);\r\n                }\r\n                virtualVal = this.valueToSliderValue(this.value);\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                let deltaX = event.dX;\r\n                const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n                deltaX *= factor;\r\n                deltaX /= this.elementWidth;\r\n\r\n                virtualVal += deltaX;\r\n\r\n                let sliderValue = Math.max(0, Math.min(1, virtualVal));\r\n                this.value = this.sliderValuetoValue(sliderValue);\r\n                this.updateLabel();\r\n                this.emit(false);\r\n            }\r\n\r\n            if (event.type === 'pointerup') {\r\n                this.sliderWrapperEl.className = 'sliderWrapper';\r\n                this.emit(true);\r\n            }\r\n\r\n        }\r\n\r\n        this.pointerListenerTimeout = setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.sliderWrapperEl,\r\n                maxPointers: 1,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    onPointer(e);\r\n                    eventChain.chainIn(e);\r\n                },\r\n                onWheel: (event) => {\r\n                    let sliderValue = this.valueToSliderValue(this.value);\r\n                    sliderValue = BB.clamp(sliderValue - event.deltaY / 40, 0, 1);\r\n                    this.value = this.sliderValuetoValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.onChange(this.value);\r\n                }\r\n            });\r\n            this.updateLabel();\r\n        }, 1);\r\n    }\r\n\r\n    changeSliderValue(f: number): void {\r\n        if (!this.isEnabled) {\r\n            return;\r\n        }\r\n        let sliderValue = this.valueToSliderValue(this.value);\r\n        sliderValue = BB.clamp(sliderValue + f, 0, 1);\r\n        this.value = this.sliderValuetoValue(sliderValue);\r\n        this.updateLabel();\r\n        this.onChange(this.value);\r\n    }\r\n\r\n    setValue (v: number): void {\r\n        this.value = BB.clamp(v, this.min, this.max);\r\n        this.updateLabel();\r\n    }\r\n\r\n    getValue (): number {\r\n        return this.value;\r\n    }\r\n\r\n    update (config: IKlSliderConfig): void {\r\n        this.min = config.min;\r\n        this.max = config.max;\r\n        this.useSpline = !!config.curve;\r\n        if (this.useSpline) {\r\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : config.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        } else {\r\n            this.splineInterpolator = null;\r\n        }\r\n        this.setIsEnabled(!config.isDisabled);\r\n    }\r\n\r\n    setIsEnabled (e: boolean): void {\r\n        this.isEnabled = !!e;\r\n        this.updateEnable();\r\n    }\r\n\r\n    destroy (): void {\r\n        clearTimeout(this.pointerListenerTimeout);\r\n        if (this.pointerListener) {\r\n            this.pointerListener.destroy();\r\n        }\r\n        if (this.manualInput) {\r\n            this.manualInput.destroy();\r\n        }\r\n        if (this.emitInterval) {\r\n            clearInterval(this.emitInterval);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.roolEl;\r\n    }\r\n\r\n}\r\n","\r\n\r\n/**\r\n * to make sliders more finegrained.\r\n * @param deltaY number - how far pointer moved away vertically since down\r\n * @returns {number} the factor 0-1. 0 -> infinite movement for change of 1. 1 -> 1px for change of 1\r\n */\r\nexport const calcSliderFalloffFactor = function(deltaY, isRightButton) {\r\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\r\n    if (isRightButton) {\r\n        result *= 2;\r\n    }\r\n    return 1 / result;\r\n};\r\n","import {BB} from '../../../bb/bb';\r\nimport {input} from './input';\r\n\r\n/**\r\n * Used by KlSlider. Allows user to type in value in input (type=number) field, instead of dragging with mouse.\r\n * Input goes away when losing focus, or when pressing Enter/Escape.\r\n */\r\nexport class KlSliderManualInput {\r\n\r\n    private input: HTMLInputElement;\r\n    private isEnabled: boolean;\r\n    private scrollBefore: { x: number, y: number }; // window scroll position on creation\r\n    private lastValue: number; // last emitted value\r\n    private isClosed: boolean = false;\r\n\r\n    private emit(): void {\r\n        if (this.lastValue !== Number(this.input.value)) {\r\n            this.onChange(Number(this.input.value));\r\n            this.lastValue = Number(this.input.value);\r\n        }\r\n    }\r\n\r\n    private privateOnClose(): void {\r\n        if (this.isClosed) {\r\n            return;\r\n        }\r\n        this.isClosed = true;\r\n\r\n        this.emit();\r\n        this.onClose();\r\n        setTimeout(() => {\r\n            // because iPad keyboard changes the scroll position\r\n            window.scrollTo(this.scrollBefore.x, this.scrollBefore.y);\r\n            this.scrollBefore = null;\r\n        });\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor(\r\n        value: number, // initial value (displayValue)\r\n        min: number,\r\n        max: number,\r\n        rect: DOMRect, // size of input field\r\n        private onChange: (displayValue: number) => void,\r\n        private onClose: () => void,\r\n        roundDigits?: number,\r\n    ) {\r\n\r\n        this.input = input({\r\n            type: 'number',\r\n            init: value,\r\n            min,\r\n            max,\r\n            callback: (val) => {\r\n                this.emit();\r\n            },\r\n        });\r\n        if (roundDigits !== 0) {\r\n            this.input.setAttribute('step', 'any');\r\n        }\r\n        this.input.onblur = () => {\r\n            this.privateOnClose();\r\n        };\r\n        this.input.addEventListener('keyup', (e) => {\r\n            if (['Enter', 'Escape'].includes(e.key)) {\r\n                this.privateOnClose();\r\n            } else {\r\n                this.emit();\r\n            }\r\n        });\r\n        this.input.addEventListener('wheel', () => this.emit());\r\n\r\n        this.scrollBefore = {\r\n            x: window.scrollX,\r\n            y: window.scrollY,\r\n        };\r\n\r\n        let currentValue;\r\n        if (roundDigits || roundDigits === 0) {\r\n            currentValue = BB.round(value, roundDigits);\r\n        } else {\r\n            currentValue = value;\r\n        }\r\n        this.lastValue = currentValue;\r\n        this.input.value = '' + currentValue;\r\n\r\n        BB.css(this.input, {\r\n            width: rect.width + 'px',\r\n            height: rect.height + 'px',\r\n        });\r\n    }\r\n\r\n    getElement() {\r\n        return this.input;\r\n    }\r\n\r\n    setIsEnabled(b: boolean): void {\r\n        this.isEnabled = !!b;\r\n    }\r\n\r\n    focus(): void {\r\n        this.input.focus();\r\n        this.input.select();\r\n    }\r\n\r\n    destroy(): void {\r\n        BB.destroyEl(this.input);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {input} from '../base-components/input';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n// @ts-ignore\r\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\r\n\r\n/**\r\n * dialog for manually inputting the color\r\n * @param p {color: rgbObj, onClose: function(rgbObj | null)}\r\n * @constructor\r\n */\r\nexport const HexColorDialog = function (p) {\r\n\r\n    let lastValidRgb = new BB.RGB(p.color.r, p.color.g, p.color.b);\r\n\r\n    const div = BB.el({});\r\n\r\n    const previewEl = BB.el({\r\n        css: {\r\n            width: '20px',\r\n            height: '20px',\r\n            marginBottom: '10px',\r\n            boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\r\n            background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.appendChild(previewEl);\r\n\r\n\r\n    // --- Hex ---\r\n    const hexRowEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginBottom: '15px'\r\n        }\r\n    });\r\n    const hexLabel = BB.el({\r\n        content: LANG('mci-hex'),\r\n        css: {\r\n            width: '60px'\r\n        }\r\n    });\r\n    const hexInput = input({\r\n        init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n        css: {\r\n            width: '80px'\r\n        },\r\n        callback: function() {\r\n            let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\r\n            if (rgbObj === null) {\r\n                rgbObj = lastValidRgb;\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            } else {\r\n                lastValidRgb = rgbObj;\r\n            }\r\n            previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\r\n\r\n            for (let i = 0; i < rgbArr.length; i++) {\r\n                rgbArr[i].update();\r\n            }\r\n        }\r\n    });\r\n    const copyButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img src=\"' + copyImg + '\" height=\"20\"/>',\r\n        title: LANG('mci-copy'),\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            hexInput.select();\r\n            document.execCommand('copy');\r\n        }\r\n    });\r\n    hexRowEl.appendChild(hexLabel);\r\n    hexRowEl.appendChild(hexInput);\r\n    hexRowEl.appendChild(copyButton);\r\n    div.appendChild(hexRowEl);\r\n    setTimeout(function () {\r\n        hexInput.focus();\r\n        hexInput.select();\r\n    }, 0);\r\n\r\n\r\n    // --- R G B ---\r\n    function createRgbInputRow(labelStr, attributeStr) {\r\n        const result: any = {};\r\n\r\n        const rowEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n        const labelEl = BB.el({\r\n            content: labelStr,\r\n            css: {\r\n                width: '60px'\r\n            }\r\n        });\r\n\r\n        const inputEl = input({\r\n            init: lastValidRgb[attributeStr],\r\n            min: 0,\r\n            max: 255,\r\n            type: 'number',\r\n            css: {\r\n                width: '80px'\r\n            },\r\n            callback: function() {\r\n                if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\r\n                    result.update();\r\n                    return;\r\n                }\r\n                inputEl.value = '' + Math.round(parseFloat(inputEl.value));\r\n                lastValidRgb[attributeStr] = inputEl.value;\r\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            }\r\n        });\r\n\r\n        rowEl.appendChild(labelEl);\r\n        rowEl.appendChild(inputEl);\r\n        div.appendChild(rowEl);\r\n\r\n\r\n        result.update = function() {\r\n            inputEl.value = lastValidRgb[attributeStr];\r\n        };\r\n        result.destroy = () => {\r\n            inputEl.onchange = null;\r\n        };\r\n        return result;\r\n    }\r\n    const rgbArr = [];\r\n    rgbArr.push(createRgbInputRow(LANG('red'), 'r'));\r\n    rgbArr.push(createRgbInputRow(LANG('green'), 'g'));\r\n    rgbArr.push(createRgbInputRow(LANG('blue'), 'b'));\r\n\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('manual-color-input')}</b>`,\r\n        div: div,\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (resultStr) {\r\n            BB.destroyEl(copyButton);\r\n            rgbArr.forEach(item => item.destroy());\r\n            rgbArr.splice(0, rgbArr.length);\r\n\r\n            p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : null);\r\n        }\r\n    });\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"la7yv\");","import {BB} from '../../../bb/bb';\r\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\n// @ts-ignore\r\nimport eyedropperImg from 'url:~/src/app/img/ui/tool-picker.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * big main HS+V color slider\r\n * 2 elements: slider, and colorpreview(output) + eyedropper\r\n *\r\n * p = {\r\n *     width: number,\r\n *     height: number, // hue slider and output height\r\n *     svHeight: number,\r\n *     startValue: rgb, // 0-255\r\n *     onPick: function(rgb)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const KlColorSlider = function (p) {\r\n\r\n    const _this = this;\r\n    let pickCallback = function(result?) {};\r\n    const div = document.createElement('div');\r\n    div.style.position = 'relative';\r\n    div.className = 'colorSlider';\r\n    const outputDiv = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center'\r\n        }\r\n    });\r\n    const width = p.width;\r\n    let svHeight = p.svHeight;\r\n    const height = p.height;\r\n    const emitColor = p.onPick;\r\n\r\n    let primaryColorRGB = {\r\n        r: parseInt(p.startValue.r, 10),\r\n        g: parseInt(p.startValue.g, 10),\r\n        b: parseInt(p.startValue.b, 10)\r\n    };\r\n    let primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\r\n    let secondaryColorRGB = {r: 255, g: 255, b: 255};\r\n    let secondaryColorHSV = BB.ColorConverter._RGBtoHSV(secondaryColorRGB); // BB.HSV\r\n\r\n    const svWrapper = BB.el({});\r\n    const svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"> <defs> <linearGradient id=\"value\" gradientTransform=\"rotate(90)\"> <stop offset=\"0\" stop-color=\"rgba(0,0,0,0)\"/> <stop offset=\"100%\" stop-color=\"rgba(0,0,0,1)\"/> </linearGradient> <linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"> <stop offset=\"0\" stop-color=\"#fff\"/> <stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/> </linearGradient> </defs> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\"/></svg>', 'image/svg+xml').documentElement;\r\n    const hueStop = (svSvg as any).getElementById('hue-stop');\r\n    BB.setAttributes(hueStop, {\r\n        'stop-color': '#f0f'\r\n    });\r\n    BB.css(svSvg, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px'\r\n    });\r\n    svWrapper.appendChild(svSvg);\r\n\r\n    const divH = document.createElement('div');\r\n    BB.css(divH, {\r\n        position: 'relative',\r\n        height: height + 'px'\r\n    });\r\n    const divPreview = document.createElement('div');\r\n    const controlH = document.createElement('div');\r\n\r\n    const enabled = true;\r\n\r\n    function updatePrimaryHSV(hsv) {\r\n        if (hsv.s === 0) {\r\n            primaryColorHSV = new BB.HSV(primaryColorHSV.h, hsv.s, hsv.v);\r\n        } else {\r\n            primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\r\n        }\r\n    }\r\n\r\n    function createHueBg(targetEl) {\r\n        const im = new Image();\r\n        BB.css(im, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            display: 'none',\r\n            pointerEvents: 'none'\r\n        });\r\n        const cv = BB.canvas(width, height);\r\n        const ctx = cv.getContext('2d');\r\n        const gradH = ctx.createLinearGradient(0, 0, width, 0);\r\n        for (let i = 0; i < 1; i += 0.01) {\r\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n            let ha = (parseInt('' + col.r)).toString(16);\r\n            let hb = (parseInt('' + col.g)).toString(16);\r\n            let hc = (parseInt('' + col.b)).toString(16);\r\n            if (ha.length === 1)\r\n                ha = '0' + ha;\r\n            if (hb.length === 1)\r\n                hb = '0' + hb;\r\n            if (hc.length === 1)\r\n                hc = '0' + hc;\r\n            gradH.addColorStop(i, '#' + ha + hb + hc);\r\n        }\r\n        ctx.fillStyle = gradH;\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        targetEl.appendChild(im);\r\n        im.alt = 'hue';\r\n        im.src = cv.toDataURL('image/png');\r\n        im.style.display = 'block';\r\n    }\r\n\r\n\r\n    function updateSVCanvas() {\r\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(primaryColorHSV.h, 100, 100));\r\n        BB.setAttributes(hueStop, {\r\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb)\r\n        });\r\n    }\r\n\r\n    function updateSVPointer() {\r\n\r\n        const left = primaryColorHSV.s / 100 * width - 7;\r\n        const top = (1 - primaryColorHSV.v / 100) * svHeight - 6;\r\n        BB.css(pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px'\r\n        });\r\n    }\r\n\r\n    function setColPreview() {\r\n        divPreview.style.backgroundColor = 'rgb(' + primaryColorRGB.r + ',' + primaryColorRGB.g + ',' + primaryColorRGB.b + ')';\r\n\r\n        if (BB.testIsWhiteBestContrast(primaryColorRGB)) {\r\n            BB.css(pickerButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n        } else{\r\n            BB.css(pickerButton, {\r\n                filter: ''\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: ''\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    updateSVCanvas();\r\n    div.style.width = width + 'px';\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    const SVContainer = document.createElement('div');\r\n    BB.css(SVContainer, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px',\r\n        overflow: 'hidden',\r\n        display: 'block',\r\n        position: 'relative',\r\n        cursor: 'crosshair',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n    });\r\n\r\n    const pointerSV = document.createElement('div');\r\n    BB.css(pointerSV, {\r\n        width: '12px',\r\n        height: '12px',\r\n        borderRadius: '6px',\r\n        position: 'absolute',\r\n        pointerEvents: 'none',\r\n        boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff'\r\n    });\r\n\r\n    SVContainer.appendChild(svWrapper);\r\n    SVContainer.appendChild(pointerSV);\r\n    updateSVPointer();\r\n    div.appendChild(SVContainer);\r\n    div.appendChild(divH);\r\n    outputDiv.appendChild(divPreview);\r\n    BB.css(divPreview, {\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        width: (height * 2.5) + 'px',\r\n        height: height + 'px',\r\n        //position: \"relative\",\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        colorScheme: 'only light',\r\n    });\r\n\r\n    BB.css(divH, {\r\n        overflow: 'hidden',\r\n        position: 'relative',\r\n        width: width + 'px',\r\n        height: height + 'px',\r\n        cursor: 'ew-resize',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        marginTop: '1px',\r\n        marginBottom: '1px'\r\n    });\r\n\r\n    //divH.className = \"svSlider\";\r\n    BB.css(controlH, {\r\n        width: '1px',\r\n        height: height + 'px',\r\n        background: '#000',\r\n        borderLeft: '1px solid #fff',\r\n        position: 'absolute',\r\n        top: '0',\r\n        left: parseInt('' + (primaryColorHSV.h / 360 * width - 1)) + 'px'\r\n    });\r\n\r\n\r\n    const virtualHSV = {\r\n        h: 0,\r\n        s: 0,\r\n        v: 0\r\n    };\r\n    let svPointerListener;\r\n    let hPointerListener;\r\n\r\n\r\n    const pickerButton = BB.el({\r\n        title: LANG('eyedropper') + ' [Alt]',\r\n        className: 'color-picker-preview-button',\r\n        css: {\r\n            width: '30px',\r\n            height: '30px',\r\n            backgroundImage: 'url(' + eyedropperImg + ')',\r\n            backgroundRepeat:  'no-repeat',\r\n            backgroundSize: '70%',\r\n            backgroundPosition: 'center'\r\n        }\r\n    });\r\n    let isPicking = false;\r\n\r\n\r\n    pickerButton.onclick = function () {\r\n        if (isPicking === false) {\r\n            pickerButton.classList.remove('color-picker-preview-button-hover');\r\n            pickerButton.classList.add('color-picker-preview-button-active');\r\n            isPicking = true;\r\n            pickCallback(true);\r\n        } else {\r\n            pickCallback(false);\r\n            _this.pickingDone();\r\n        }\r\n    };\r\n    const pickerButtonPointerListener = new BB.PointerListener({\r\n        target: pickerButton,\r\n        onEnterLeave: function(isOver) {\r\n            if (isPicking) {\r\n                return;\r\n            }\r\n            pickerButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n        }\r\n    });\r\n    divPreview.appendChild(pickerButton);\r\n\r\n\r\n    const hexButton = BB.el({\r\n        content: '#',\r\n        className: 'color-picker-preview-button',\r\n        title: LANG('manual-color-input'),\r\n        css: {\r\n            height: '100%',\r\n            width: height + 'px',\r\n            lineHeight: height + 'px',\r\n            fontSize: (height * 0.65) + 'px'\r\n        },\r\n        onClick: function() {\r\n            HexColorDialog({\r\n                color: new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b),\r\n                onClose: function(rgbObj) {\r\n                    if (!rgbObj) {\r\n                        return;\r\n                    }\r\n                    _this.setColor(rgbObj);\r\n                    emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n                }\r\n            });\r\n        }\r\n    });\r\n    const hexButtonPointerListener = new BB.PointerListener({\r\n        target: hexButton,\r\n        onEnterLeave: function(isOver) {\r\n            hexButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n        }\r\n    });\r\n    divPreview.appendChild(hexButton);\r\n\r\n    setColPreview();\r\n\r\n\r\n    setTimeout(function() {\r\n        createHueBg(divH);\r\n        divH.appendChild(controlH);\r\n        svPointerListener = new BB.PointerListener({\r\n            target: svWrapper,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    BB.unfocusAnyInput();\r\n\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0px 0px 0px 1px rgb(255,255,255)',\r\n                        zIndex: '1'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.s = event.relX / width * 100;\r\n                        virtualHSV.v = 100 - event.relY / svHeight * 100;\r\n\r\n                        primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n\r\n                        updateSVPointer();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.s = primaryColorHSV.s;\r\n                        virtualHSV.v = primaryColorHSV.v;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    let factor = 1;\r\n                    if (event.button === 'right') {\r\n                        factor = 0.5;\r\n                    }\r\n\r\n                    virtualHSV.s += event.dX / width * 100 * factor;\r\n                    virtualHSV.v -= event.dY / svHeight * 100 * factor;\r\n\r\n                    primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    updateSVPointer();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0 0 0 1px rgb(188, 188, 188)',\r\n                        zIndex: '0'\r\n                    });\r\n                }\r\n\r\n            }\r\n        });\r\n        hPointerListener = new BB.PointerListener({\r\n            target: divH,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n\r\n                if (event.type === 'pointerdown') {\r\n\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    BB.unfocusAnyInput();\r\n\r\n                    BB.css(divH, {\r\n                        boxShadow: '0px 0px 0px 1px rgba(255,255,255,1)'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.h = event.relX / width * 359.99;\r\n\r\n                        primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                        controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                        updateSVCanvas();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.h = primaryColorHSV.h;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                    virtualHSV.h += event.dX / width * 359.99 * factor;\r\n\r\n                    if (event.button === 'right') {\r\n                        virtualHSV.h = virtualHSV.h % 359.99;\r\n                        if (virtualHSV.h < 0) {\r\n                            virtualHSV.h += 359.99;\r\n                        }\r\n                    }\r\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                    primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                    updateSVCanvas();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(divH, {\r\n                        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }, 1);\r\n\r\n\r\n    // --- second color ---\r\n\r\n    const secondaryColorBtn = BB.el({\r\n        parent: outputDiv,\r\n        title: LANG('secondary-color') + ' [X]',\r\n        css: {\r\n            cursor: 'pointer',\r\n            marginLeft: '5px',\r\n            width: '22px',\r\n            height: '22px',\r\n            boxShadow: 'rgb(188, 188, 188) 0px 0px 0px 1px',\r\n            colorScheme: 'only light',\r\n        },\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            swapColors();\r\n        }\r\n    });\r\n    function updateSecondaryColor() {\r\n        secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(secondaryColorRGB);\r\n    }\r\n    function swapColors() {\r\n        // swap hsv\r\n        let tmp: any = secondaryColorHSV;\r\n        secondaryColorHSV = primaryColorHSV;\r\n        updatePrimaryHSV(tmp);\r\n        // swap rgb\r\n        tmp = secondaryColorRGB;\r\n        secondaryColorRGB = primaryColorRGB;\r\n        primaryColorRGB = tmp;\r\n\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n        updateSecondaryColor();\r\n\r\n        emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n    }\r\n    updateSecondaryColor();\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setColor = function (c) {\r\n        primaryColorRGB = {r: parseInt(c.r, 10), g: parseInt(c.g, 10), b: parseInt(c.b, 10)};\r\n        updatePrimaryHSV(BB.ColorConverter.toHSV(c));\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n    };\r\n\r\n    this.getColor = function () {\r\n        return new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b);\r\n    };\r\n\r\n    this.getSecondaryRGB = function() {\r\n        return new BB.RGB(secondaryColorRGB.r, secondaryColorRGB.g, secondaryColorRGB.b);\r\n    };\r\n\r\n    this.setPickCallback = function (func) {\r\n        pickCallback = func;\r\n    };\r\n\r\n    this.pickingDone = function () {\r\n        if (!isPicking) {\r\n            return;\r\n        }\r\n        isPicking = false;\r\n        pickerButton.classList.remove('color-picker-preview-button-active');\r\n    };\r\n\r\n    this.enable = function (e) {\r\n        if (e) {\r\n            div.style.pointerEvents = '';\r\n            div.style.opacity = '1';\r\n            outputDiv.style.pointerEvents = '';\r\n            outputDiv.style.opacity = '1';\r\n        } else {\r\n            div.style.pointerEvents = 'none';\r\n            div.style.opacity = '0.5';\r\n            outputDiv.style.pointerEvents = 'none';\r\n            outputDiv.style.opacity = '0.5';\r\n        }\r\n    };\r\n\r\n    this.setHeight = function (h) {\r\n        h = parseInt('' +(h - height * 2 - 3), 10);\r\n        if (h === svHeight) {\r\n            return;\r\n        }\r\n        svHeight = h;\r\n        BB.css(svSvg, {\r\n            width: width + 'px',\r\n            height: svHeight + 'px'\r\n        });\r\n        SVContainer.style.height = svHeight + 'px';\r\n        updateSVPointer();\r\n    };\r\n\r\n    this.swapColors = function() {\r\n        swapColors();\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.getOutputElement = function() {\r\n        return outputDiv;\r\n    }\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cTtMO\");","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\n\r\n\r\n/**\r\n * a small color slider\r\n *\r\n * params {\r\n * \t width: 200,\r\n * \t heightSV: 200,\r\n * \t heightH: 10,\r\n * \t color: {r,g,b}\r\n * \t callback: function(c){}\r\n * }\r\n *\r\n * @param params\r\n * @constructor\r\n */\r\nexport const KlSmallColorSlider = function (params) {\r\n    const div = document.createElement('div');\r\n    div.oncontextmenu = function(e) {\r\n        e.preventDefault();\r\n    };\r\n    let color = BB.ColorConverter.toHSV(new BB.RGB(params.color.r, params.color.g, params.color.b));\r\n    BB.css(div, {\r\n        width: params.width + 'px',\r\n        position: 'relative',\r\n        overflow: 'hidden',\r\n        userSelect: 'none'\r\n    });\r\n\r\n    const canvasSV = BB.canvas(10, 10);\r\n    canvasSV.style.width = params.width + 'px';\r\n    canvasSV.style.height = params.heightSV + 'px';\r\n    canvasSV.style.cursor = 'crosshair';\r\n\r\n    function updateSV() {\r\n        const ctx = canvasSV.getContext('2d');\r\n        for (let i = 0; i < canvasSV.height; i += 1) {\r\n            const gradient1 = ctx.createLinearGradient(0, 0, canvasSV.width, 0);\r\n\r\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(color.h, 1, 100 - (i / canvasSV.height * 100.0)));\r\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(color.h, 100, 100 - (i / canvasSV.height * 100.0)));\r\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\r\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\r\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\r\n            ctx.fillStyle = gradient1;\r\n            ctx.fillRect(0, i, canvasSV.width, 1);\r\n        }\r\n    }\r\n\r\n    updateSV();\r\n\r\n    const canvasH = BB.canvas(params.width, params.heightH);\r\n    canvasH.style.cursor = 'ew-resize';\r\n    (function () {\r\n        const ctx = canvasH.getContext('2d');\r\n\r\n        const gradH = ctx.createLinearGradient(0, 0, params.width, 0);\r\n        for (let i = 0; i < 1; i += 0.01) {\r\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n            gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\r\n        }\r\n        ctx.fillStyle = gradH;\r\n        ctx.fillRect(0, 0, params.width, params.heightH);\r\n\r\n    })();\r\n    BB.css(canvasSV, {\r\n        width: params.width + 'px',\r\n        height: params.heightSV + 'px',\r\n        overflow: 'hidden',\r\n        position: 'relative'\r\n    });\r\n    canvasSV.style.cssFloat = 'left';\r\n    canvasH.style.cssFloat = 'left';\r\n\r\n    div.appendChild(canvasSV);\r\n    div.appendChild(canvasH);\r\n\r\n    const pointerSV = document.createElement('div');\r\n    BB.css(pointerSV, {\r\n        width: '8px',\r\n        height: '8px',\r\n        borderRadius: '8px',\r\n        position: 'absolute',\r\n        pointerEvents: 'none',\r\n        boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff'\r\n    });\r\n    div.appendChild(pointerSV);\r\n\r\n    const pointerH = document.createElement('div');\r\n    BB.css(pointerH, {\r\n        width: '0',\r\n        height: params.heightH + 'px',\r\n        borderLeft: '1px solid #fff',\r\n        borderRight: '1px solid #000',\r\n        position: 'absolute',\r\n        top: params.heightSV + 'px',\r\n        pointerEvents: 'none'\r\n    });\r\n    div.appendChild(pointerH);\r\n\r\n\r\n    function updateSVPointer() {\r\n        const left = color.s / 100 * params.width - 4;\r\n        const top = (1 - color.v / 100) * params.heightSV - 4;\r\n        BB.css(pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px'\r\n        });\r\n        /*if (top < params.heightSV/3) {\r\n        pointerSV.style.border = \"1px solid rgba(0,0,0,1)\";\r\n    } else {\r\n        pointerSV.style.border = \"1px solid rgba(255,255,255,1)\";\r\n    }*/\r\n    }\r\n\r\n    function updateHPointer() {\r\n        pointerH.style.left = (color.h / 359.999 * params.width - 1) + 'px';\r\n    }\r\n\r\n    updateSVPointer();\r\n    updateHPointer();\r\n\r\n    const virtualHSV = {\r\n        h: 0,\r\n        s: 0,\r\n        v: 0\r\n    };\r\n\r\n    let svPointerId = null;\r\n    const svPointerListener = new BB.PointerListener({\r\n        target: canvasSV,\r\n        maxPointers: 1,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n\r\n            if (event.type === 'pointerdown') {\r\n\r\n                // prevent manual slider input keeping focus on iPad\r\n                BB.unfocusAnyInput();\r\n\r\n                svPointerId = event.pointerId;\r\n                if (event.button === 'left') {\r\n\r\n                    virtualHSV.s = event.relX / params.width * 100;\r\n                    virtualHSV.v = 100 - event.relY / params.heightSV * 100;\r\n\r\n                    color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\r\n\r\n                    updateSVPointer();\r\n                    params.callback(BB.ColorConverter.toRGB(color));\r\n                } else {\r\n                    virtualHSV.s = color.s;\r\n                    virtualHSV.v = color.v;\r\n                }\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && svPointerId === event.pointerId) {\r\n\r\n                let factor = 1;\r\n                if (event.button === 'right') {\r\n                    factor = 0.5;\r\n                }\r\n\r\n                virtualHSV.s += event.dX / params.width * 100 * factor;\r\n                virtualHSV.v -= event.dY / params.heightSV * 100 * factor;\r\n\r\n                color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\r\n                updateSVPointer();\r\n                params.callback(BB.ColorConverter.toRGB(color));\r\n\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                svPointerId = null;\r\n            }\r\n\r\n        }\r\n    });\r\n\r\n    let hPointerId = null;\r\n    const hPointerListener = new BB.PointerListener({\r\n        target: canvasH,\r\n        maxPointers: 1,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n\r\n            if (event.type === 'pointerdown') {\r\n                hPointerId = event.pointerId;\r\n                if (event.button === 'left') {\r\n\r\n                    virtualHSV.h = event.relX / params.width * 359.99;\r\n\r\n                    color = new BB.HSV(virtualHSV.h, color.s, color.v);\r\n                    updateSV();\r\n                    updateHPointer();\r\n                    params.callback(BB.ColorConverter.toRGB(color));\r\n                } else {\r\n                    virtualHSV.h = color.h;\r\n                }\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && hPointerId === event.pointerId) {\r\n\r\n                const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                virtualHSV.h += event.dX / params.width * 359.99 * factor;\r\n\r\n                if (event.button === 'right') {\r\n                    virtualHSV.h = virtualHSV.h % 359.99;\r\n                    if (virtualHSV.h < 0) {\r\n                        virtualHSV.h += 359.99;\r\n                    }\r\n                }\r\n                virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                color = new BB.HSV(virtualHSV.h, color.s, color.v);\r\n                updateSV();\r\n                updateHPointer();\r\n                params.callback(BB.ColorConverter.toRGB(color));\r\n\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                hPointerId = null;\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    const cleardiv = document.createElement('div');\r\n    cleardiv.style.clear = 'both';\r\n    div.appendChild(cleardiv);\r\n\r\n    // --- interface ---\r\n    this.setColor = function (c) {\r\n        color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\r\n        updateSV();\r\n        updateSVPointer();\r\n        updateHPointer();\r\n    };\r\n    this.getColor = function () {\r\n        return BB.ColorConverter.toRGB(color);\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.destroy = function() {\r\n        svPointerListener.destroy();\r\n        hPointerListener.destroy();\r\n    };\r\n    this.end = function() {\r\n        svPointerId = null;\r\n        hPointerId = null;\r\n    };\r\n\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n\r\n/**\r\n * a slider that looks like this\r\n * ------O----\r\n *\r\n * param: {init, width, pointSize, callback(value, isFirst, isLast)}\r\n *\r\n * @param param\r\n * @constructor\r\n */\r\nexport const PointSlider = function(param) {\r\n\r\n    const div = document.createElement('div');\r\n    div.style.position = 'relative';\r\n    const sliderLine = BB.el({});\r\n    const sliderPoint = BB.el({\r\n        css: {\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.appendChild(sliderLine);\r\n    div.appendChild(sliderPoint);\r\n    let sliderPos;\r\n    let isDragging = false;\r\n\r\n    //sliderLine\r\n    {\r\n        BB.css(sliderLine, {\r\n            marginTop: parseInt('' + (param.pointSize / 2 - 1)) + 'px',\r\n            height: '2px',\r\n            background: '#aaa',\r\n            width: param.width + 'px'\r\n        });\r\n    }\r\n    //sliderPoint\r\n    const touchAreaEl = BB.el({ // expand clickable area\r\n        parent: sliderPoint,\r\n        css: {\r\n            // background: 'rgba(255,0,0,0.4)',\r\n            margin: '-7px 0 0 -7px',\r\n            width: 'calc(100% + 14px)',\r\n            height: 'calc(100% + 7px)',\r\n        }\r\n    });\r\n\r\n    function redrawPoint() {\r\n        sliderPoint.style.left = sliderPos + 'px';\r\n        if (isDragging) {\r\n            sliderPoint.style.boxShadow = '0 0 6px rgba(0,0,0,1)';\r\n        } else {\r\n            sliderPoint.style.boxShadow = '0 0 3px rgba(0,0,0,0.8)';\r\n        }\r\n    }\r\n    function getValue() {\r\n        return sliderPos /  (param.width - param.pointSize);\r\n    }\r\n\r\n    let pointerListener;\r\n    {\r\n        let isFirst;\r\n        sliderPos = BB.clamp(param.init * (param.width - param.pointSize), 0, param.width - param.pointSize);\r\n        BB.css(sliderPoint, {\r\n            position: 'absolute',\r\n            top: '0px',\r\n            backgroundColor: '#eaeaea',\r\n            boxShadow: '0 0 3px rgba(0,0,0,0.8)',\r\n            width: param.pointSize + 'px',\r\n            height: param.pointSize + 'px',\r\n            borderRadius: param.pointSize + 'px',\r\n            cursor: 'ew-resize',\r\n            transition: 'box-shadow 0.2s ease-in-out'\r\n        });\r\n        redrawPoint();\r\n        let imaginaryPos;\r\n        pointerListener = new BB.PointerListener({\r\n            target: sliderPoint,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    isFirst = true;\r\n                    isDragging = true;\r\n                    imaginaryPos = sliderPos;\r\n                    redrawPoint();\r\n                    event.eventStopPropagation();\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                    event.eventStopPropagation();\r\n                    imaginaryPos = imaginaryPos + event.dX;\r\n                    sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, param.width - param.pointSize));\r\n                    redrawPoint();\r\n                    param.callback(getValue(), isFirst, false);\r\n                    isFirst = false;\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    event.eventStopPropagation();\r\n                    isDragging = false;\r\n                    redrawPoint();\r\n                    param.callback(getValue(), false, true);\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getEl = function() {\r\n        return div;\r\n    };\r\n    this.setActive = function(isActive) {\r\n        if (isActive) {\r\n            sliderPoint.style.backgroundColor = '#fff';\r\n        } else {\r\n            sliderPoint.style.backgroundColor = '#eaeaea';\r\n        }\r\n    };\r\n    this.destroy = function() {\r\n        pointerListener.destroy();\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\r\n * Can't deal with 0.5 alpha.\r\n * Rectangular buttons.\r\n *\r\n * p = {\r\n *     colorArr: rgba[], // duplicates are removed\r\n *     onChange: func(rgbaObj),\r\n *     label: string,\r\n *     initialIndex: int// optional, index before duplicates were removed\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const ColorOptions = function(p) {\r\n    const div = BB.el({\r\n        content: p.label ? p.label : '',\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n\r\n    let selectedIndex = 0;\r\n    const colorArr = [];\r\n    const buttonArr = [];\r\n    const buttonSize = 22;\r\n    const checkerUrl = BB.createCheckerDataUrl(5);\r\n\r\n    // build colorArr while removing duplicates\r\n    for (let i = 0; i < p.colorArr.length; i++) {\r\n        const item = p.colorArr[i];\r\n        let found = false;\r\n        for (let e = 0; e < colorArr.length; e++) {\r\n            const sItem = colorArr[e];\r\n            if (sItem === null || item === null) {\r\n                continue;\r\n            }\r\n            if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\r\n                found = true;\r\n                break;\r\n            }\r\n        }\r\n        if (found) {\r\n            continue;\r\n        }\r\n        colorArr.push(item);\r\n        if ('initialIndex' in p && p.initialIndex === i) {\r\n            selectedIndex = colorArr.length - 1;\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < colorArr.length; i++) {\r\n        (function(i) {\r\n\r\n            const colorButton = BB.el({\r\n                content: colorArr[i] ? '' : 'X',\r\n                css: {\r\n                    width: buttonSize + 'px',\r\n                    height: buttonSize + 'px',\r\n                    backgroundColor: colorArr[i] ? BB.ColorConverter.toRgbaStr(colorArr[i]) : 'transparent',\r\n                    marginLeft: '7px',\r\n                    boxShadow: '0 0 0 1px #aaa',\r\n                    cursor: 'pointer',\r\n                    userSelect: 'none',\r\n                    textAlign: 'center',\r\n                    lineHeight: (buttonSize + 1) + 'px',\r\n                    color: '#aaa'\r\n                }\r\n            });\r\n            if (colorArr[i] && colorArr[i].a === 0) {\r\n                colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\r\n            }\r\n\r\n            colorButton.onclick = function(e) {\r\n                e.preventDefault();\r\n                selectedIndex = i;\r\n                update();\r\n                p.onChange(colorArr[i]);\r\n            };\r\n\r\n            (colorButton as any).setIsSelected = function(b) {\r\n                if (b) {\r\n                    BB.css(colorButton, {\r\n                        boxShadow: '0 0 0 2px var(--active-highlight-color), 0 0 5px 0 var(--active-highlight-color)',\r\n                        pointerEvents: 'none'\r\n                    });\r\n                } else {\r\n                    BB.css(colorButton, {\r\n                        boxShadow: '0 0 0 1px #aaa',\r\n                        pointerEvents: ''\r\n                    });\r\n                }\r\n            };\r\n\r\n\r\n            div.appendChild(colorButton);\r\n            buttonArr.push(colorButton);\r\n        })(i);\r\n    }\r\n\r\n\r\n    function update() {\r\n        for (let i = 0; i < buttonArr.length; i++) {\r\n            buttonArr[i].setIsSelected(i === selectedIndex);\r\n        }\r\n    }\r\n    update();\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.destroy = () => {\r\n        buttonArr.forEach(item => {\r\n            item.onclick = null;\r\n        });\r\n        buttonArr.splice(0, buttonArr.length);\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * selectable options\r\n * p = {\r\n *     optionArr: {\r\n *          id: string,\r\n *          label: string | HTMLElement\r\n *     }[],\r\n *     initialId?: string,\r\n *     onChange: function(id string): void,\r\n *     changeOnInit?: boolean, // trigger change on creation\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const Options = function(p) {\r\n    const div = BB.el({});\r\n\r\n    const wrapperEl = BB.el({\r\n        parent: div,\r\n        className: 'kl-option-wrapper',\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n\r\n    const optionArr: {\r\n        id: string;\r\n        el: HTMLElement;\r\n    }[] = [];\r\n    let selectedId = 'initialId' in p ? p.initialId : p.optionArr[0].id;\r\n\r\n    function createOption(o) {\r\n        const optionObj = {\r\n            id: o.id,\r\n            el: null,\r\n        };\r\n\r\n        const classArr = ['kl-option'];\r\n        if (p.isSmall) {\r\n            classArr.push('kl-option--small');\r\n        }\r\n        if (typeof o.label !== 'string') {\r\n            classArr.push('kl-option--custom-el');\r\n            BB.css(o.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n\r\n        optionObj.el = BB.el({\r\n            parent: wrapperEl,\r\n            content: o.label,\r\n            className: classArr.join(' '),\r\n            onClick: function() {\r\n                if (selectedId !== optionObj.id) {\r\n                    selectedId = optionObj.id;\r\n                    update();\r\n                    p.onChange(selectedId);\r\n                }\r\n            }\r\n        });\r\n\r\n        if (o.title) {\r\n            optionObj.el.title = o.title;\r\n        }\r\n\r\n        optionArr.push(optionObj);\r\n    }\r\n\r\n    function update() {\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            optionArr[i].el.classList.toggle('kl-option-selected', optionArr[i].id === selectedId);\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < p.optionArr.length; i++) {\r\n        createOption(p.optionArr[i]);\r\n    }\r\n\r\n    update();\r\n\r\n    if (p.changeOnInit) {\r\n        setTimeout(function() {\r\n            p.onChange(selectedId);\r\n        }, 0);\r\n    }\r\n\r\n    function getIndex() {\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            if (optionArr[i].id === selectedId) {\r\n                return i;\r\n            }\r\n        }\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return selectedId;\r\n    }\r\n    this.next = function() {\r\n        selectedId = optionArr[(getIndex() + 1) % optionArr.length].id;\r\n        update();\r\n        p.onChange(selectedId);\r\n    };\r\n    this.previous = function() {\r\n        selectedId = optionArr[(optionArr.length + getIndex() - 1) % optionArr.length].id;\r\n        update();\r\n        p.onChange(selectedId);\r\n    };\r\n    this.destroy = () => {\r\n        optionArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n        });\r\n        optionArr.splice(0, optionArr.length);\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport angleSvg from 'url:~/src/app/img/ui/angle.svg';\r\n\r\n\r\ntype TUiState = 'left' | 'right';\r\n\r\n/**\r\n * display little messages at the top of KlWorkspace\r\n */\r\nexport class StatusOverlay {\r\n\r\n    private el: HTMLDivElement;\r\n    private innerEl: HTMLDivElement;\r\n    private angleIm: HTMLImageElement;\r\n    private innerInnerEl: HTMLDivElement;\r\n    private isWide: boolean;\r\n    private uiState: TUiState;\r\n\r\n    private timeout: number;\r\n    private timeout2: number;\r\n    private timeout3: number;\r\n\r\n    private updateUiState() {\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n        setTimeout(()=>{}, 100);\r\n        if (this.uiState === 'left') {\r\n            this.el.style.left = '271px';\r\n        } else {\r\n            this.el.style.removeProperty('left');\r\n        }\r\n    }\r\n\r\n    private init() {\r\n        this.el = BB.el({\r\n            className: \"top-overlay g-root\",\r\n            onClick: BB.handleClick,\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n        }\r\n\r\n        this.updateUiState();\r\n\r\n        this.innerEl = BB.el({\r\n            className: 'top-overlay-inner',\r\n        }) as HTMLDivElement\r\n\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleSvg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginLeft: '5px',\r\n            borderRadius: '10px'\r\n        });\r\n\r\n        this.innerInnerEl = document.createElement('div');\r\n        this.innerInnerEl.style.display = 'inline-block';\r\n\r\n        this.innerEl.appendChild(this.innerInnerEl);\r\n        this.innerEl.appendChild(this.angleIm);\r\n        this.el.appendChild(this.innerEl);\r\n        document.body.appendChild(this.el);\r\n        this.el.style.display = \"none\";\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        this.init();\r\n    }\r\n\r\n    setWide(b: boolean) {\r\n        this.isWide = !!b;\r\n\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n            this.el.style.left = '';\r\n        } else {\r\n            this.el.style.removeProperty('width');\r\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\r\n        }\r\n    }\r\n\r\n    setUiState(state: TUiState) {\r\n        this.uiState = state;\r\n        this.updateUiState();\r\n    }\r\n\r\n    out(msg: string | {type: 'transform', angleDeg: number, scale: number}, doPulse?: boolean) {\r\n\r\n        if (msg && typeof msg === 'object') {\r\n\r\n            if (msg.type === 'transform') {\r\n                this.angleIm.style.display = 'inline-block';\r\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\r\n\r\n                if (msg.angleDeg % 90 === 0) {\r\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\r\n                } else {\r\n                    this.angleIm.style.boxShadow = '';\r\n                }\r\n\r\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + \"%\";\r\n\r\n\r\n            } else {\r\n                this.angleIm.style.display = 'none';\r\n            }\r\n\r\n\r\n\r\n        } else if (typeof msg === 'string') {\r\n            this.angleIm.style.display = 'none';\r\n            this.innerInnerEl.innerHTML = msg;\r\n        }\r\n\r\n        if (doPulse) {\r\n            this.innerEl.style.animation = '';\r\n            setTimeout(\r\n                () => this.innerEl.style.animation = 'top-overlay-pulse 0.5s ease-out',\r\n                20\r\n            );\r\n            if (this.timeout3) {\r\n                clearTimeout(this.timeout3);\r\n            }\r\n            this.timeout3 = window.setTimeout(\r\n                () => this.innerEl.style.animation = '',\r\n                520\r\n            );\r\n        }\r\n\r\n\r\n\r\n        if (this.timeout) {\r\n            clearTimeout(this.timeout);\r\n        }\r\n        if (this.timeout2) {\r\n            clearTimeout(this.timeout2);\r\n        }\r\n        this.el.style.animationName = doPulse ? 'consoleInFast' : \"consoleIn\";\r\n        this.el.style.opacity = \"1\";\r\n        this.timeout = window.setTimeout(() => {\r\n            this.el.style.opacity = \"0\";\r\n            this.el.style.animationName = \"consoleOut\";\r\n            this.timeout2 = window.setTimeout(() => {\r\n                this.el.style.display = \"none\";\r\n                this.timeout2 = 0;\r\n            }, 450);\r\n            this.timeout = 0;\r\n        }, 1200);\r\n        this.el.style.display = \"flex\";\r\n    }\r\n\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iQ1f0\");","import {BB} from '../../../bb/bb';\r\nimport {popup} from './popup';\r\n\r\nexport function exportDialog(parent, image) {\r\n    let boxSize, aboutCloseFunc, aboutDiv, closed, aniToggle, imageContainer, coverImage, coverSize,\r\n        text, holding, aniTimeout, halfBoxSize;\r\n    boxSize = 22 * 2;\r\n    halfBoxSize = 22;\r\n    aboutCloseFunc = function () {\r\n    };\r\n    closed = false;\r\n    aniToggle = false;\r\n    aboutDiv = document.createElement(\"div\");\r\n    BB.css(aboutDiv, {\r\n        width: (7 * boxSize) + \"px\"\r\n    });\r\n\r\n    imageContainer = document.createElement(\"div\");\r\n    coverImage = new Image();\r\n    coverImage.src = image.src;\r\n\r\n    imageContainer.appendChild(coverImage);\r\n    imageContainer.appendChild(image);\r\n\r\n    BB.css(imageContainer, {\r\n        width: (6 * boxSize) + \"px\",\r\n        height: (4 * boxSize) + \"px\",\r\n        marginTop: (boxSize / 2 - 1) + \"px\",\r\n        marginLeft: (boxSize / 2 - 1) + \"px\",\r\n        position: \"relative\",\r\n        overflow: \"hidden\",\r\n        boxShadow: \"0 0 10px 4px rgba(255,255,255, 0)\",\r\n        border: \"1px solid rgba(255, 255, 255, 1)\",\r\n        transition: \"box-shadow 0.7s linear\"\r\n    });\r\n    BB.css(image, {\r\n        position: \"absolute\",\r\n        left: '0',\r\n        top: '0',\r\n        width: (6 * boxSize) + \"px\",\r\n        height: (4 * boxSize) + \"px\",\r\n        opacity: '0'\r\n    });\r\n    coverSize = {\r\n        width: (6 * boxSize),\r\n        height: (6 * boxSize / image.width) * image.height\r\n    };\r\n    if (coverSize.height < (4 * boxSize)) {\r\n        coverSize.height = (4 * boxSize);\r\n        coverSize.width = (coverSize.height / image.height) * image.width;\r\n    }\r\n    BB.css(coverImage, {\r\n        position: \"absolute\",\r\n        top: (2 * boxSize) + \"px\",\r\n        left: (3 * boxSize) + \"px\",\r\n        width: coverSize.width + \"px\",\r\n        height: coverSize.height + \"px\",\r\n        marginLeft: (-coverSize.width / 2) + \"px\",\r\n        marginTop: (-coverSize.height / 2) + \"px\"\r\n    });\r\n\r\n    function animation() {\r\n        if (closed) {\r\n            return;\r\n        }\r\n        aniToggle = !aniToggle;\r\n        if (aniToggle) {\r\n            BB.css(imageContainer, {\r\n                border: \"1px solid rgba(0, 0, 0, 1)\"\r\n            });\r\n        } else {\r\n            BB.css(imageContainer, {\r\n                border: \"1px solid rgba(200, 200, 200, 1)\"\r\n            });\r\n        }\r\n        setTimeout(animation, 510);\r\n    }\r\n\r\n    animation();\r\n\r\n    text = document.createElement(\"div\");\r\n    text.innerHTML = \"Right-Click or Press-Hold on the image, then save.\";\r\n    text.ontouchstart = function () {\r\n        return false;\r\n    };\r\n    BB.css(text, {\r\n        fontSize: (boxSize / 2.5) + \"px\",\r\n        color: \"#666\",\r\n        padding: \"10px\",\r\n        textAlign: \"center\"\r\n    });\r\n\r\n    aboutDiv.appendChild(imageContainer);\r\n    aboutDiv.appendChild(text);\r\n\r\n    holding = false;\r\n    image.ontouchstart = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 8px rgba(0,255,255, 1)\"\r\n        });\r\n        holding = true;\r\n        aniTimeout = setTimeout(function () {\r\n            holding = false;\r\n            BB.css(imageContainer, {\r\n                boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n            });\r\n        }, 1500);\r\n    };\r\n    image.ontouchmove = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n        });\r\n        holding = false;\r\n        clearTimeout(aniTimeout);\r\n    };\r\n    image.ontouchend = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n        });\r\n        holding = false;\r\n        clearTimeout(aniTimeout);\r\n    };\r\n\r\n    popup({\r\n        target: parent,\r\n        message: \"<b>Save Image</b>\",\r\n        div: aboutDiv,\r\n        buttons: [\"Close\"],\r\n        callback: function (result) {\r\n            closed = true;\r\n        }\r\n    });\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * element that lets you crop an image and copy it via right click\r\n *\r\n * param = {\r\n *     width: number,\r\n *     height: number,\r\n *     canvas: image | canvas,\r\n *     isNotCopy: boolean,\r\n *     onChange: function(width, height)\r\n * }\r\n *\r\n * @param param object\r\n * @constructor\r\n */\r\nexport function CropCopy(param) {\r\n    const div = document.createElement('div');\r\n    BB.css(div, {\r\n        position: 'relative',\r\n        height: param.height + 'px',\r\n        width: param.width + 'px',\r\n        overflow: 'hidden',\r\n        colorScheme: 'only light',\r\n    });\r\n    div.style.position = 'relative';\r\n\r\n    let crop;\r\n    function resetCrop() {\r\n        crop = {\r\n            x: 0,\r\n            y: 0,\r\n            width: param.canvas.width,\r\n            height: param.canvas.height\r\n        };\r\n    }\r\n    resetCrop();\r\n\r\n\r\n    function updateCroppedCanvas() {\r\n        croppedCanvas.width = Math.round(crop.width);\r\n        croppedCanvas.height = Math.round(crop.height);\r\n        let ctx = croppedCanvas.getContext('2d');\r\n        ctx.drawImage(param.canvas, Math.round(-crop.x), Math.round(-crop.y));\r\n        if (croppedImage) {\r\n            croppedImage.src = croppedCanvas.toDataURL('image/png');\r\n        }\r\n\r\n        if (param.onChange) {\r\n            param.onChange(croppedCanvas.width, croppedCanvas.height);\r\n        }\r\n    }\r\n    function updateSelectionRect() {\r\n        BB.css(selectionRect, {\r\n            left: (thumbX + crop.x * scaleW) + 'px',\r\n            top: (thumbY + crop.y * scaleH) + 'px',\r\n            width: (crop.width * scaleW) + 'px',\r\n            height: (crop.height * scaleH) + 'px'\r\n        });\r\n        if (param.onChange) {\r\n            param.onChange(Math.round(crop.width), Math.round(crop.height));\r\n        }\r\n    }\r\n    function isInsideSelectionRect(p) {\r\n        let rect = {\r\n            x: Math.round(thumbX + crop.x * scaleW),\r\n            y: Math.round(thumbY + crop.y * scaleH),\r\n            width: Math.round(crop.width * scaleW),\r\n            height: Math.round(crop.height * scaleH)\r\n        };\r\n        return BB.isInsideRect(p, rect);\r\n    }\r\n\r\n    const croppedCanvas = BB.canvas();\r\n    let eventTarget = croppedCanvas;\r\n    let croppedImage = null;\r\n    if (!param.isNotCopy) { //navigator.appName === 'Microsoft Internet Explorer') { //i would prefer not using an image\r\n        croppedImage = new Image();\r\n        eventTarget = croppedImage;\r\n    }\r\n    BB.css(eventTarget, {\r\n        height: param.height + 'px',\r\n        width: param.width + 'px'\r\n    });\r\n    div.appendChild(eventTarget);\r\n    updateCroppedCanvas();\r\n\r\n    const padding = 20;\r\n    const previewWrapper = BB.el({\r\n        css: {\r\n            width: param.width + 'px',\r\n            height: param.height + 'px',\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    div.appendChild(previewWrapper);\r\n    BB.createCheckerDataUrl(4, function(v) {\r\n        previewWrapper.style.backgroundImage = 'url('+v+')';\r\n    });\r\n\r\n    const thumbSize = BB.fitInto(param.canvas.width, param.canvas.height, param.width - padding * 2, param.height - padding * 2, 1);\r\n    const thumbCanvas = BB.canvas(Math.round(thumbSize.width), Math.round(thumbSize.height));\r\n    thumbCanvas.style.imageRendering = 'pixelated';\r\n    const scaleW = thumbCanvas.width / param.canvas.width;\r\n    const scaleH = thumbCanvas.height / param.canvas.height;\r\n    const thumbCtx = thumbCanvas.getContext('2d');\r\n    thumbCtx.imageSmoothingEnabled = false;\r\n    thumbCtx.drawImage(param.canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);\r\n    previewWrapper.appendChild(thumbCanvas);\r\n    const thumbX = parseInt('' + ((param.width - thumbCanvas.width) / 2));\r\n    const thumbY = parseInt('' + ((param.height - thumbCanvas.height) / 2));\r\n    BB.css(thumbCanvas, {\r\n        position: 'absolute',\r\n        left: thumbX + \"px\",\r\n        top: thumbY + \"px\"\r\n    });\r\n\r\n    const selectionRect = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            boxShadow: '0 0 0 1px #fff, 0 0 0 2px #000, 0 0 40px 1px #000',\r\n        }\r\n    });\r\n    previewWrapper.appendChild(selectionRect);\r\n    updateSelectionRect();\r\n\r\n\r\n    function toOriginalSpace(p) {\r\n        return {\r\n            x: BB.clamp((p.x - thumbX) / scaleW, 0, param.canvas.width),\r\n            y: BB.clamp((p.y - thumbY) / scaleH, 0, param.canvas.height),\r\n        };\r\n    }\r\n    //gen crop from thumb-space points\r\n    function genCrop(p1, p2) {\r\n        let topLeftP = {\r\n            x: Math.min(p1.x, p2.x),\r\n            y: Math.min(p1.y, p2.y)\r\n        };\r\n        let bottomRightP = {\r\n            x: Math.max(p1.x, p2.x),\r\n            y: Math.max(p1.y, p2.y)\r\n        };\r\n        let origTopLeftP = toOriginalSpace(topLeftP);\r\n        let origBottomRightP = toOriginalSpace(bottomRightP);\r\n        origTopLeftP.x = Math.floor(origTopLeftP.x);\r\n        origTopLeftP.y = Math.floor(origTopLeftP.y);\r\n        origBottomRightP.x = Math.ceil(origBottomRightP.x);\r\n        origBottomRightP.y = Math.ceil(origBottomRightP.y);\r\n        return {\r\n            x: origTopLeftP.x,\r\n            y: origTopLeftP.y,\r\n            width: origBottomRightP.x - origTopLeftP.x,\r\n            height: origBottomRightP.y - origTopLeftP.y\r\n        };\r\n    }\r\n\r\n    function isReset() {\r\n        return crop.x === 0 && crop.y === 0 && crop.width === param.canvas.width && crop.height === param.canvas.height;\r\n    }\r\n\r\n    let startP;\r\n    let startCrop = null;\r\n    let isDragging = false;\r\n    let didMove = false;\r\n    let updateCropTimeout;\r\n    const pointerListener = new BB.PointerListener({\r\n        target: eventTarget,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n            let fullPos;\r\n            if (event.type === 'pointerdown' && event.button === 'left') {\r\n                event.eventPreventDefault();\r\n                isDragging = true;\r\n                startP = {\r\n                    x: event.relX,\r\n                    y: event.relY\r\n                };\r\n                if (!isReset() && isInsideSelectionRect(startP)) {\r\n                    startCrop = {\r\n                        x: crop.x,\r\n                        y: crop.y,\r\n                        width: crop.width,\r\n                        height: crop.height\r\n                    };\r\n                } else {\r\n                    crop = genCrop(startP, startP);\r\n                }\r\n            } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                event.eventPreventDefault();\r\n                didMove = true;\r\n                if (startCrop) {\r\n                    crop.x = startCrop.x + Math.round((event.relX - startP.x) / scaleW);\r\n                    crop.y = startCrop.y + Math.round((event.relY - startP.y) / scaleH);\r\n                    crop.x = BB.clamp(crop.x, 0, param.canvas.width - crop.width);\r\n                    crop.y = BB.clamp(crop.y, 0, param.canvas.height - crop.height);\r\n                } else {\r\n                    crop = genCrop(startP, {x: event.relX, y: event.relY});\r\n                }\r\n                updateSelectionRect();\r\n            } else if (event.type === 'pointerup' && startP) {\r\n                event.eventPreventDefault();\r\n                isDragging = false;\r\n                startCrop = null;\r\n                startP = null;\r\n                if (crop.width === 0 || crop.height === 0 || !didMove) {\r\n                    resetCrop();\r\n                    updateSelectionRect();\r\n                }\r\n                didMove = false;\r\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (isDragging) {\r\n                return;\r\n            }\r\n            let doUpdate = false;\r\n\r\n            let stepSize = Math.max(1, 1 / scaleW);\r\n            let shiftIsPressed = keyListener.isPressed('shift');\r\n\r\n            if (keyStr === 'left') {\r\n                if (shiftIsPressed) {\r\n                    crop.width = BB.clamp(crop.width - stepSize, 1, param.canvas.width - crop.x);\r\n                } else {\r\n                    crop.x = BB.clamp(crop.x - stepSize, 0, param.canvas.width - crop.width);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'right') {\r\n                if (shiftIsPressed) {\r\n                    crop.width = BB.clamp(crop.width + stepSize, 1, param.canvas.width - crop.x);\r\n                } else {\r\n                    crop.x = BB.clamp(crop.x + stepSize, 0, param.canvas.width - crop.width);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'up') {\r\n                if (shiftIsPressed) {\r\n                    crop.height = BB.clamp(crop.height - stepSize, 1, param.canvas.height - crop.y);\r\n                } else {\r\n                    crop.y = BB.clamp(crop.y - stepSize, 0, param.canvas.height - crop.height);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'down') {\r\n                if (shiftIsPressed) {\r\n                    crop.height = BB.clamp(crop.height + stepSize, 1, param.canvas.height - crop.y);\r\n                } else {\r\n                    crop.y = BB.clamp(crop.y + stepSize, 0, param.canvas.height - crop.height);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n\r\n            if (doUpdate) {\r\n                e.preventDefault();\r\n                updateSelectionRect();\r\n                clearTimeout(updateCropTimeout);\r\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 100);\r\n            }\r\n        }\r\n    });\r\n\r\n    this.getEl = function() {\r\n        return div;\r\n    };\r\n    this.reset = function() {\r\n        resetCrop();\r\n        updateCroppedCanvas();\r\n        updateSelectionRect();\r\n    };\r\n    this.destroy = function() {\r\n        eventTarget.style.removeProperty('width');\r\n        eventTarget.style.removeProperty('height');\r\n        keyListener.destroy();\r\n        pointerListener.destroy();\r\n    };\r\n    this.isReset = function() {\r\n        return isReset();\r\n    };\r\n    this.getRect = function() {\r\n        return JSON.parse(JSON.stringify(crop));\r\n    };\r\n    this.getCroppedImage = function() {\r\n        return croppedCanvas;\r\n    };\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {popup} from './popup';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/// <reference path=\"./types.d.ts\" />\r\n\r\n/**\r\n *\r\n * @param parent\r\n * @param fullCanvas\r\n * @param cropCallback\r\n * @param output - BB.Output\r\n * @param showCrop - boolean - show crop button\r\n */\r\nexport function clipboardDialog(parent, fullCanvas, cropCallback, output, showCrop) {\r\n\r\n    let clipboardItemIsSupported = false;\r\n    try {\r\n        clipboardItemIsSupported = !!ClipboardItem;\r\n    } catch (e) {}\r\n\r\n    const div = document.createElement(\"div\");\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n\r\n    let topWrapper = BB.el({\r\n        content: LANG('crop-drag-to-crop') + (clipboardItemIsSupported ? '' : '<br>' + LANG('cropcopy-click-hold')),\r\n        css: {\r\n            textAlign: 'center'\r\n        }\r\n    });\r\n    div.appendChild(topWrapper);\r\n\r\n\r\n    let cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 350,\r\n        canvas: fullCanvas,\r\n        clipboardItemIsSupported\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n    function toClipboard() {\r\n        const imgURL = cropCopy.getCroppedImage().toDataURL('image/png');\r\n        setTimeout(async function() {\r\n            try {\r\n                const data = await fetch(imgURL);\r\n                const blob = await data.blob();\r\n                await (navigator.clipboard as any).write([\r\n                    new ClipboardItem({\r\n                        [blob.type]: blob\r\n                    } as any) // todo check is possible?\r\n                ]);\r\n                setTimeout(function() {\r\n                    output.out(LANG('cropcopy-copied'), true);\r\n                }, 200);\r\n            } catch (err) {\r\n                console.error(err.name, err.message);\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, KeyEvent, comboStr) {\r\n            if (comboStr === 'ctrl+c') {\r\n                toClipboard();\r\n                closefunc();\r\n            }\r\n        }\r\n    });\r\n\r\n    let closefunc;\r\n    function blur() {\r\n        closefunc();\r\n    }\r\n    BB.addEventListener(window, \"blur\", blur);\r\n\r\n    const buttonArr = [];\r\n    if (clipboardItemIsSupported) {\r\n        buttonArr.push(LANG('cropcopy-btn-copy'));\r\n    }\r\n    if (showCrop) {\r\n        buttonArr.push(LANG('cropcopy-btn-crop'));\r\n    }\r\n    buttonArr.push('Cancel');\r\n\r\n    popup({\r\n        target: parent,\r\n        message: '<b>' + (showCrop ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\r\n        div: div,\r\n        style: isSmall ? {} : {\r\n            width: \"500px\"\r\n        },\r\n        buttons: buttonArr,\r\n        primaries: [LANG('cropcopy-btn-copy')],\r\n        callback: function (result) {\r\n            if (result === LANG('cropcopy-btn-copy')) {\r\n                toClipboard();\r\n            } else if (result === LANG('cropcopy-btn-crop')) {\r\n                let rectObj = cropCopy.getRect();\r\n                cropCallback({\r\n                    left: Math.round(-rectObj.x),\r\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\r\n                    top: Math.round(-rectObj.y),\r\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height)\r\n                });\r\n            }\r\n            BB.removeEventListener(window, \"blur\", blur);\r\n            cropCopy.destroy();\r\n            keyListener.destroy();\r\n        },\r\n        clickOnEnter: LANG('cropcopy-btn-copy'),\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        }\r\n    });\r\n}","import {BB} from '../../../bb/bb';\r\nimport {popup} from '../modals/popup';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {Options} from '../base-components/options';\r\nimport {Select} from '../base-components/select';\r\nimport {PointSlider} from '../base-components/point-slider';\r\n// @ts-ignore\r\nimport addLayerImg from 'url:~/src/app/img/ui/add-layer.svg';\r\n// @ts-ignore\r\nimport duplicateLayerImg from 'url:~/src/app/img/ui/duplicate-layer.svg';\r\n// @ts-ignore\r\nimport mergeLayerImg from 'url:~/src/app/img/ui/merge-layers.svg';\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\n// @ts-ignore\r\nimport renameLayerImg from 'url:~/src/app/img/ui/rename-layer.svg';\r\nimport {KlCanvas, MAX_LAYERS} from '../../canvas/kl-canvas';\r\nimport {IMixMode} from '../../kl.types';\r\nimport {LANG} from '../../../language/language';\r\nimport {translateBlending} from '../../canvas/translate-blending';\r\n\r\n\r\nexport function klLayerManager(p_canvas: KlCanvas, p_func, p_rootDiv) {\r\n    let klCanvas: KlCanvas = p_canvas;\r\n    let layerElArr = [];\r\n    let layerHeight = 35;\r\n    let layerSpacing = 0;\r\n    let width = 250;\r\n    let oldHistoryState;\r\n    let updatefunc = p_func;\r\n    let uiState = 'right'; // 'left | 'right'\r\n\r\n\r\n    let largeThumbDiv = BB.el({\r\n        onClick: BB.handleClick,\r\n        css: {\r\n            position: \"absolute\",\r\n            right: \"280px\",\r\n            top: \"500px\",\r\n            background: \"#aaa\",\r\n            boxShadow: \"1px 1px 3px rgba(0,0,0,0.3)\",\r\n            pointerEvents: \"none\",\r\n            padding: '0',\r\n            border: \"1px solid #aaa\",\r\n            transition: \"opacity 0.3s ease-out\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    BB.createCheckerDataUrl(4, function(url) {\r\n        largeThumbDiv.style.backgroundImage = \"url(\" + url + \")\";\r\n    });\r\n    let largeThumbCanvas = BB.canvas(200, 200);\r\n    largeThumbCanvas.style.display = \"block\";\r\n    largeThumbDiv.appendChild(largeThumbCanvas);\r\n    let largeThumbTimeout, largeThumbInTimeout;\r\n    let largeThumbInDocument = false;\r\n\r\n\r\n    let klCanvasLayerArr = klCanvas.getLayers();\r\n    let selectedSpotIndex = klCanvasLayerArr.length - 1;\r\n    let div = document.createElement(\"div\");\r\n    div.style.marginRight = \"10px\";\r\n    div.style.marginBottom = \"10px\";\r\n    div.style.marginLeft = \"10px\";\r\n    div.style.marginTop = \"10px\";\r\n    div.style.cursor = \"default\";\r\n\r\n    let listdiv = document.createElement(\"div\");\r\n    BB.css(listdiv, {\r\n        width: width + \"px\",\r\n        position: \"relative\"\r\n\r\n    });\r\n\r\n\r\n    function renameLayer(layer) {\r\n        let div = document.createElement('div');\r\n\r\n        let label = BB.el({\r\n            content: LANG('layers-rename-name') + ':',\r\n            css: {\r\n                marginRight: '5px'\r\n            }\r\n        });\r\n\r\n        const row = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n        let input = document.createElement('input');\r\n        input.value = klCanvas.getLayer(layer).name;\r\n        input.setAttribute('data-ignore-focus', 'true');\r\n        const clearBtn = BB.el({\r\n            tagName: 'Button',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\r\n            title: LANG('layers-rename-clear'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: () => {\r\n                input.value = '';\r\n                input.focus();\r\n            }\r\n        });\r\n        const suggestions = [\r\n            LANG('layers-rename-sketch'),\r\n            LANG('layers-rename-colors'),\r\n            LANG('layers-rename-lines'),\r\n            LANG('background'),\r\n            LANG('layers-rename-foreground'),\r\n        ];\r\n        const suggestionBtns = [];\r\n        const row2 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginTop: '5px',\r\n                marginLeft: '-5px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        suggestions.forEach(item => {\r\n            const btn = BB.el({\r\n                parent: row2,\r\n                tagName: 'Button',\r\n                content: item,\r\n                onClick: () => {\r\n                    input.value = btn.textContent;\r\n                },\r\n                css: {\r\n                    margin: '5px 0 0 5px',\r\n                }\r\n            });\r\n            suggestionBtns.push(btn);\r\n        });\r\n\r\n        div.appendChild(label);\r\n        label.append(row, row2);\r\n        row.append(input, clearBtn);\r\n\r\n        setTimeout(function() {\r\n            input.focus();\r\n            input.select();\r\n        }, 10);\r\n\r\n        popup({\r\n            target: p_rootDiv,\r\n            message: `<b>${LANG('layers-rename-title')}</b>`,\r\n            div: div,\r\n            buttons: [LANG('layers-rename'), 'Cancel'],\r\n            primaries: [LANG('layers-rename')],\r\n            callback: function (val) {\r\n                BB.destroyEl(clearBtn);\r\n                suggestionBtns.forEach(item => {\r\n                    BB.destroyEl(item);\r\n                });\r\n                suggestionBtns.splice(0, suggestionBtns.length);\r\n                if (val === LANG('layers-rename')) {\r\n                    if (input.value === klCanvas.getLayer(layer).name) {\r\n                        return;\r\n                    }\r\n                    klCanvas.renameLayer(layer, input.value);\r\n                    createLayerList();\r\n                    klHistory.pause(true);\r\n                    updatefunc(layer);\r\n                    klHistory.pause(false);\r\n                }\r\n            },\r\n            clickOnEnter: LANG('layers-rename')\r\n        });\r\n    }\r\n\r\n\r\n    let layerListEl = BB.el({});\r\n\r\n    (div as any).disableButtons = function(){}; //probably remove\r\n    (div as any).enableButtons = function(){}; //probably remove\r\n    let addnewBtn = document.createElement(\"button\");\r\n    let duplicateBtn = document.createElement(\"button\");\r\n    let mergeBtn = document.createElement(\"button\");\r\n    let removeBtn = document.createElement(\"button\");\r\n    let renameBtn = document.createElement(\"button\");\r\n\r\n    function createButtons() {\r\n        let div = document.createElement(\"div\");\r\n        function async() {\r\n            BB.makeUnfocusable(addnewBtn);\r\n            BB.makeUnfocusable(duplicateBtn);\r\n            BB.makeUnfocusable(mergeBtn);\r\n            BB.makeUnfocusable(removeBtn);\r\n            BB.makeUnfocusable(renameBtn);\r\n\r\n            addnewBtn.style.cssFloat = 'left';\r\n            duplicateBtn.style.cssFloat = 'left';\r\n            mergeBtn.style.cssFloat = 'left';\r\n            removeBtn.style.cssFloat = 'left';\r\n            renameBtn.style.cssFloat = 'left';\r\n\r\n            addnewBtn.title = LANG('layers-new');\r\n            duplicateBtn.title = LANG('layers-duplicate');\r\n            removeBtn.title = LANG('layers-remove');\r\n            mergeBtn.title = LANG('layers-merge');\r\n            renameBtn.title = LANG('layers-rename-title');\r\n\r\n            addnewBtn.style.paddingLeft = \"5px\";\r\n            addnewBtn.style.paddingRight = \"3px\";\r\n\r\n            removeBtn.style.paddingLeft = \"5px\";\r\n            removeBtn.style.paddingRight = \"3px\";\r\n\r\n            duplicateBtn.style.paddingLeft = \"5px\";\r\n            duplicateBtn.style.paddingRight = \"3px\";\r\n\r\n            mergeBtn.style.paddingLeft = \"5px\";\r\n            mergeBtn.style.paddingRight = \"3px\";\r\n\r\n            renameBtn.style.height = \"30px\";\r\n            renameBtn.style.lineHeight = \"20px\";\r\n\r\n            addnewBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\r\n            duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\r\n            mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\r\n            removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\r\n            renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\r\n            addnewBtn.style.marginRight = \"5px\";\r\n            removeBtn.style.marginRight = \"5px\";\r\n            duplicateBtn.style.marginRight = \"5px\";\r\n            mergeBtn.style.marginRight = \"5px\";\r\n            div.appendChild(addnewBtn);\r\n            div.appendChild(removeBtn);\r\n            div.appendChild(duplicateBtn);\r\n            div.appendChild(mergeBtn);\r\n            div.appendChild(renameBtn);\r\n            div.appendChild(BB.el({\r\n                css: {\r\n                    clear: 'both'\r\n                }\r\n            }));\r\n\r\n            let clearboth = document.createElement(\"div\");\r\n            clearboth.style.clear = \"both\";\r\n            clearboth.style.height = \"10px\";\r\n            div.appendChild(clearboth);\r\n\r\n\r\n            addnewBtn.onclick = function () {\r\n                if (klCanvas.addLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex = selectedSpotIndex + 1;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            duplicateBtn.onclick = function () {\r\n                if (klCanvas.duplicateLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex++;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            removeBtn.onclick = function () {\r\n                if (layerElArr.length <= 1) {\r\n                    return;\r\n                }\r\n\r\n                klCanvas.removeLayer(selectedSpotIndex);\r\n                if (selectedSpotIndex > 0) {\r\n                    selectedSpotIndex--;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n                if (klCanvasLayerArr.length === 1) {\r\n                    removeBtn.disabled = true;\r\n                }\r\n                if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                    addnewBtn.disabled = false;\r\n                    duplicateBtn.disabled = false;\r\n                }\r\n            };\r\n            mergeBtn.onclick = function () {\r\n                if (selectedSpotIndex <= 0) {\r\n                    return;\r\n                }\r\n\r\n                function mergeDialog(p) {\r\n                    let div = document.createElement(\"div\");\r\n                    div.innerHTML = LANG('layers-merge-description');\r\n\r\n                    let options = new Options({\r\n                        optionArr: [\r\n                            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\r\n                            {id: 'source-in', label: 'source-in'},\r\n                            {id: 'source-out', label: 'source-out'},\r\n                            {id: 'source-atop', label: 'source-atop'},\r\n                            {id: 'destination-in', label: 'destination-in'},\r\n                            {id: 'destination-out', label: 'destination-out'},\r\n                            {id: 'destination-atop', label: 'destination-atop'},\r\n                            {id: 'xor', label: 'xor'}\r\n                        ],\r\n                        initId: p.mixModeStr,\r\n                        onChange: function(id) {\r\n                            update();\r\n                        },\r\n                        isSmall: true\r\n                    });\r\n                    options.getElement().style.marginTop = '5px';\r\n                    div.appendChild(options.getElement());\r\n\r\n                    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\r\n                    let preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n                    preview.title = LANG('preview');\r\n                    let spacer = document.createElement(\"div\");\r\n                    spacer.innerHTML = \"<br/>\";\r\n                    spacer.style.clear = \"both\";\r\n                    div.appendChild(spacer);\r\n                    div.appendChild(preview);\r\n                    BB.css(preview, {\r\n                        display: \"block\",\r\n                        marginLeft: \"auto\",\r\n                        marginRight: \"auto\",\r\n                        colorScheme: 'only light',\r\n                    });\r\n                    preview.style.boxShadow = \"0 0 3px rgba(0,0,0,0.5)\";\r\n                    BB.createCheckerDataUrl(4, function(url) {\r\n                        preview.style.backgroundImage = \"url(\" + url + \")\";\r\n                    });\r\n\r\n                    let alphaCanvas = BB.copyCanvas(preview);\r\n                    alphaCanvas.getContext(\"2d\").drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\r\n                    BB.convertToAlphaChannelCanvas(alphaCanvas);\r\n\r\n                    function update() {\r\n                        let ctx = preview.getContext(\"2d\");\r\n                        ctx.save();\r\n                        ctx.clearRect(0, 0, preview.width, preview.height);\r\n                        if (preview.width > p.topCanvas.width) {\r\n                            ctx.imageSmoothingEnabled = false;\r\n                        }\r\n                        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\r\n\r\n                        if (options.getValue() === 'as-alpha') {\r\n                            ctx.globalCompositeOperation = 'destination-in';\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\r\n                        } else {\r\n                            ctx.globalCompositeOperation = options.getValue();\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\r\n                        }\r\n                        ctx.restore();\r\n                    }\r\n\r\n                    update();\r\n\r\n\r\n                    let keyListener = new BB.KeyListener({\r\n                        onDown: function(keyStr) {\r\n                            if (keyStr === 'right') {\r\n                                options.next();\r\n                            }\r\n                            if (keyStr === 'left') {\r\n                                options.previous();\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    popup({\r\n                        target: p_rootDiv,\r\n                        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\r\n                        div: div,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function (val) {\r\n                            keyListener.destroy();\r\n                            options.destroy();\r\n                            if (val === \"Ok\") {\r\n                                p.callback(options.getValue());\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                mergeDialog({\r\n                    topCanvas: klCanvasLayerArr[selectedSpotIndex].context.canvas,\r\n                    bottomCanvas: klCanvasLayerArr[selectedSpotIndex - 1].context.canvas,\r\n                    topOpacity: klCanvas.getLayer(selectedSpotIndex).opacity,\r\n                    mixModeStr: klCanvasLayerArr[selectedSpotIndex].mixModeStr,\r\n                    callback: function (mode) {\r\n                        klCanvas.mergeLayers(selectedSpotIndex, selectedSpotIndex - 1, mode);\r\n                        klCanvasLayerArr = klCanvas.getLayers();\r\n                        selectedSpotIndex--;\r\n                        if (klCanvasLayerArr.length === 1) {\r\n                            removeBtn.disabled = true;\r\n                        }\r\n                        if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                            addnewBtn.disabled = false;\r\n                            duplicateBtn.disabled = false;\r\n                        }\r\n                        createLayerList();\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                });\r\n            };\r\n\r\n            renameBtn.onclick = function () {\r\n                renameLayer(selectedSpotIndex);\r\n            };\r\n        }\r\n        setTimeout(async, 1);\r\n        return div;\r\n    }\r\n    div.appendChild(createButtons());\r\n\r\n    let modeWrapper;\r\n    let modeSelect;\r\n    {\r\n        modeWrapper = BB.el({\r\n            content: LANG('layers-blending') + '&nbsp;',\r\n            css: {\r\n                fontSize: '15px'\r\n            }\r\n        });\r\n\r\n        modeSelect = new Select({\r\n            optionArr: [\r\n                'source-over',\r\n                null,\r\n                'darken',\r\n                'multiply',\r\n                'color-burn',\r\n                null,\r\n                'lighten',\r\n                'screen',\r\n                'color-dodge',\r\n                null,\r\n                'overlay',\r\n                'soft-light',\r\n                'hard-light',\r\n                null,\r\n                'difference',\r\n                'exclusion',\r\n                null,\r\n                'hue',\r\n                'saturation',\r\n                'color',\r\n                'luminosity',\r\n            ].map((item: IMixMode) => {\r\n                return item ? [item, translateBlending(item)] : null;\r\n            }),\r\n            onChange: function(val) {\r\n                klCanvas.setMixMode(selectedSpotIndex, val as IMixMode);\r\n                (div as any).update(selectedSpotIndex);\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n\r\n        modeWrapper.appendChild(modeSelect.getElement());\r\n        div.appendChild(modeWrapper);\r\n\r\n    }\r\n\r\n\r\n    function createLayerList() {\r\n        oldHistoryState = klHistory.getState();\r\n        function createLayerEntry(index) {\r\n            let layerName = klCanvas.getLayer(index).name;\r\n            let opacity = klCanvasLayerArr[index].opacity;\r\n            let layercanvas = klCanvasLayerArr[index].context.canvas;\r\n\r\n            let layer = document.createElement(\"div\");\r\n            layer.className = \"layerBox\";\r\n            layerElArr[index] = layer;\r\n            (layer as any).posY = ((klCanvasLayerArr.length - 1) * 35 - index * 35);\r\n            BB.css(layer, {\r\n                width: \"250px\",\r\n                height: \"34px\",\r\n                backgroundColor: \"rgb( 220, 220, 220)\",\r\n                border: \"1px solid #aaa\",\r\n                position: \"absolute\",\r\n                left: \"0 px\",\r\n                top: (layer as any).posY + \"px\",\r\n                transition: \"all 0.1s linear\",\r\n                borderRadius: \"5px\",\r\n                boxSizing: 'border-box'\r\n            });\r\n            let innerLayer = document.createElement(\"div\");\r\n            BB.css(innerLayer, {\r\n                position: \"relative\"\r\n            });\r\n\r\n            let container1 = document.createElement(\"div\");\r\n            BB.css(container1, {\r\n                width: \"250px\",\r\n                height: \"34px\"\r\n            });\r\n            let container2 = document.createElement(\"div\");\r\n            layer.appendChild(innerLayer);\r\n            innerLayer.appendChild(container1);\r\n            innerLayer.appendChild(container2);\r\n\r\n            (layer as any).spot = index;\r\n\r\n            //thumb\r\n            {\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\r\n                let thumb = (layer as any).thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n\r\n                let thc = thumb.getContext(\"2d\");\r\n                thc.save();\r\n                if (thumb.width > layercanvas.width) {\r\n                    thc.imageSmoothingEnabled = false;\r\n                }\r\n                thc.drawImage(layercanvas, 0, 0, thumb.width, thumb.height);\r\n                thc.restore();\r\n                BB.css((layer as any).thumb, {\r\n                    position: \"absolute\",\r\n                    left: ((32 - (layer as any).thumb.width) / 2) + \"px\",\r\n                    top: ((32 - (layer as any).thumb.height) / 2) + \"px\",\r\n                    colorScheme: 'only light',\r\n                });\r\n                BB.createCheckerDataUrl(4, function(url) {\r\n                    thumb.style.backgroundImage = \"url(\" + url + \")\";\r\n                });\r\n            }\r\n\r\n            //layerlabel\r\n            {\r\n                (layer as any).label = document.createElement(\"div\");\r\n                (layer as any).lname = layerName;\r\n                (layer as any).label.append((layer as any).lname);\r\n\r\n                BB.css((layer as any).label, {\r\n                    position: \"absolute\",\r\n                    left: (1 + 32 + 5) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    width: \"170px\",\r\n                    height: \"20px\",\r\n                    overflow: \"hidden\",\r\n                    color: \"#666\",\r\n                    whiteSpace: 'nowrap'\r\n                });\r\n\r\n                (layer as any).label.ondblclick = function() {\r\n                    renameLayer((layer as any).spot);\r\n                };\r\n            }\r\n            //layerlabel\r\n            {\r\n                (layer as any).opacityLabel = document.createElement(\"div\");\r\n                (layer as any).opacity = opacity;\r\n                (layer as any).opacityLabel.append(parseInt('' + ((layer as any).opacity * 100)) + \"%\");\r\n\r\n                BB.css((layer as any).opacityLabel, {\r\n                    position: \"absolute\",\r\n                    left: (250 - 1 - 5 - 50) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    textAlign: \"right\",\r\n                    width: \"50px\",\r\n                    color: \"#666\",\r\n                    transition: \"color 0.2s ease-in-out\"\r\n                });\r\n            }\r\n\r\n            let oldOpacity;\r\n            let opacitySlider = new PointSlider({\r\n                init: (layer as any).opacity,\r\n                width: 204,\r\n                pointSize: 14,\r\n                callback: function(sliderValue, isFirst, isLast) {\r\n                    if (isFirst) {\r\n                        oldOpacity = klCanvas.getLayer((layer as any).spot).opacity;\r\n                        klHistory.pause(true);\r\n                        return;\r\n                    }\r\n                    if (isLast) {\r\n                        klHistory.pause(false);\r\n                        if (oldOpacity !== sliderValue) {\r\n                            klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                        }\r\n                        return;\r\n                    }\r\n                    (layer as any).opacityLabel.innerHTML = Math.round(sliderValue * 100) + \"%\";\r\n                    klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                }\r\n            });\r\n            BB.css(opacitySlider.getEl(), {\r\n                position: 'absolute',\r\n                left: '39px',\r\n                top: '17px'\r\n            });\r\n            (layer as any).opacitySlider = opacitySlider;\r\n\r\n            //larger layer preview - hover\r\n            BB.setEventListener((layer as any).thumb, 'onpointerover', function (e) {\r\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\r\n                    return;\r\n                }\r\n\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\r\n\r\n                if (largeThumbCanvas.width !== thumbDimensions.width || largeThumbCanvas.height !== thumbDimensions.height) {\r\n                    largeThumbCanvas.width = thumbDimensions.width;\r\n                    largeThumbCanvas.height = thumbDimensions.height;\r\n                }\r\n                let ctx = largeThumbCanvas.getContext(\"2d\");\r\n                ctx.save();\r\n                if (largeThumbCanvas.width > layercanvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.imageSmoothingQuality = 'high';\r\n                ctx.clearRect(0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.drawImage(layercanvas, 0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.restore();\r\n                BB.css(largeThumbDiv, {\r\n                    top: (e.clientY - largeThumbCanvas.height / 2) + \"px\",\r\n                    opacity: '0'\r\n                });\r\n                if (largeThumbInDocument === false) {\r\n                    document.body.appendChild(largeThumbDiv);\r\n                    largeThumbInDocument = true;\r\n                }\r\n                clearTimeout(largeThumbInTimeout);\r\n                largeThumbInTimeout = setTimeout(function () {\r\n                    BB.css(largeThumbDiv, {\r\n                        opacity: '1'\r\n                    });\r\n                }, 20);\r\n                clearTimeout(largeThumbTimeout);\r\n            });\r\n            BB.setEventListener((layer as any).thumb, 'onpointerout', function () {\r\n                clearTimeout(largeThumbInTimeout);\r\n                BB.css(largeThumbDiv, {\r\n                    opacity: '0'\r\n                });\r\n                clearTimeout(largeThumbTimeout);\r\n                largeThumbTimeout = setTimeout(function () {\r\n                    if (!largeThumbInDocument) {\r\n                        return;\r\n                    }\r\n                    document.body.removeChild(largeThumbDiv);\r\n                    largeThumbInDocument = false;\r\n                }, 300);\r\n            });\r\n\r\n            container1.appendChild((layer as any).thumb);\r\n            container1.appendChild((layer as any).label);\r\n            container1.appendChild((layer as any).opacityLabel);\r\n            container1.appendChild(opacitySlider.getEl());\r\n            let dragstart = false;\r\n            let freshSelection = false;\r\n\r\n            //events for moving layers up and down\r\n            function dragEventHandler(event) {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    BB.css(layer, {\r\n                        transition: \"box-shadow 0.3s ease-in-out\"\r\n                    });\r\n                    //dragContainer.appendChild(layer);\r\n                    layer.style.zIndex = '1';\r\n                    lastpos = (layer as any).spot;\r\n                    freshSelection = false;\r\n                    if (!(layer as any).isSelected) {\r\n                        freshSelection = true;\r\n                        (div as any).activateLayer((layer as any).spot);\r\n                    }\r\n                    dragstart = true;\r\n\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    if (dragstart) {\r\n                        dragstart = false;\r\n                        BB.css(layer, {\r\n                            boxShadow: \"1px 3px 5px rgba(0,0,0,0.4)\"\r\n                        });\r\n                    }\r\n                    (layer as any).posY += event.dY;\r\n                    let corrected = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    layer.style.top = corrected + \"px\";\r\n                    updateLayersVerticalPosition((layer as any).spot, posToSpot((layer as any).posY));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(layer, {\r\n                        transition: \"all 0.1s linear\"\r\n                    });\r\n                    setTimeout(function () {\r\n                        BB.css(layer, {\r\n                            boxShadow: \"\"\r\n                        });\r\n                    }, 20);\r\n                    (layer as any).posY = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    //regularContainer.appendChild(layer);\r\n                    layer.style.zIndex = \"\";\r\n                    let newSpot = posToSpot((layer as any).posY);\r\n                    let oldSpot = (layer as any).spot;\r\n                    move((layer as any).spot, newSpot);\r\n                    if (oldSpot != newSpot) {\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                    if (oldSpot === newSpot && freshSelection) {\r\n                        updatefunc(selectedSpotIndex);\r\n                    }\r\n                    freshSelection = false;\r\n                }\r\n            }\r\n\r\n            (layer as any).pointerListener = new BB.PointerListener({\r\n                target: container1,\r\n                maxPointers: 1,\r\n                onPointer: dragEventHandler\r\n            });\r\n\r\n            layerListEl.appendChild(layer);\r\n        }\r\n        layerElArr = [];\r\n        while (layerListEl.firstChild) {\r\n            let child = layerListEl.firstChild;\r\n            (child as any).pointerListener.destroy();\r\n            (child as any).opacitySlider.destroy();\r\n            layerListEl.removeChild(child);\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            createLayerEntry(i);\r\n        }\r\n        (div as any).activateLayer(selectedSpotIndex);\r\n        updateHeight();\r\n    }\r\n\r\n\r\n    listdiv.appendChild(layerListEl);\r\n    div.appendChild(listdiv);\r\n\r\n\r\n    function posToSpot(p) {\r\n        let result = parseInt('' + ((p) / (layerHeight + layerSpacing) + 0.5));\r\n        result = Math.min(klCanvasLayerArr.length - 1, Math.max(0, result));\r\n        result = klCanvasLayerArr.length - result - 1;\r\n        return result;\r\n    }\r\n\r\n    let lastpos = 0;\r\n\r\n    //update css position of all layers that are not being dragged, while dragging\r\n    function updateLayersVerticalPosition(id, newspot) {\r\n        newspot = Math.min(klCanvasLayerArr.length - 1, Math.max(0, newspot));\r\n        if (newspot === lastpos) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            if (layerElArr[i].spot === id) { // <- here\r\n                continue;\r\n            }\r\n            let posy = layerElArr[i].spot;\r\n            if (layerElArr[i].spot > id) {\r\n                posy--;\r\n            }\r\n            if (posy >= newspot) {\r\n                posy++;\r\n            }\r\n            layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n            layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n        }\r\n        lastpos = newspot;\r\n    }\r\n\r\n    function move(oldSpotIndex, newSpotIndex) {\r\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\r\n            throw 'layermanager - invalid move';\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            (function (i) {\r\n                let posy = layerElArr[i].spot; // <- here\r\n                if (layerElArr[i].spot === oldSpotIndex) {\r\n                    posy = newSpotIndex;\r\n                } else {\r\n                    if (layerElArr[i].spot > oldSpotIndex)\r\n                        posy--;\r\n                    if (posy >= newSpotIndex)\r\n                        posy++;\r\n                }\r\n                layerElArr[i].spot = posy;\r\n                layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n                layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n            }(i));\r\n        }\r\n        if (oldSpotIndex === newSpotIndex) {\r\n            return;\r\n        }\r\n        klCanvas.moveLayer(selectedSpotIndex, newSpotIndex - oldSpotIndex);\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        selectedSpotIndex = newSpotIndex;\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    }\r\n\r\n\r\n    //updating the thumbs in interval\r\n    //don't update when: manager not visible || layer didn't change || is drawing\r\n    let updateThumbsInterval = setInterval(function() {\r\n        if (div.style.display !== \"block\") {\r\n            return;\r\n        }\r\n\r\n        let historyState = klHistory.getState();\r\n        if (historyState === oldHistoryState) {\r\n            return;\r\n        }\r\n        oldHistoryState = historyState;\r\n\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot && klCanvasLayerArr[layerElArr[i].spot]) { // second check, because might be out of date\r\n                let ctx = layerElArr[i].thumb.getContext(\"2d\");\r\n                ctx.save();\r\n                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n                if (klCanvasLayerArr[layerElArr[i].spot].context.canvas.width < layerElArr[i].thumb.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.drawImage(klCanvasLayerArr[layerElArr[i].spot].context.canvas, 0, 0, layerElArr[i].thumb.width, layerElArr[i].thumb.height);\r\n                ctx.restore();\r\n            }\r\n        }\r\n\r\n    }, 1);\r\n\r\n    function updateHeight() {\r\n        layerListEl.style.height = (layerElArr.length * 35) + 'px';\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    (div as any).update = function (activeLayerSpotIndex) {\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\r\n            selectedSpotIndex = activeLayerSpotIndex;\r\n        }\r\n        removeBtn.disabled = klCanvasLayerArr.length === 1;\r\n        if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n            addnewBtn.disabled = true;\r\n            duplicateBtn.disabled = true;\r\n        } else {\r\n            addnewBtn.disabled = false;\r\n            duplicateBtn.disabled = false;\r\n        }\r\n        setTimeout(function() {\r\n            createLayerList();\r\n        }, 1);\r\n    };\r\n    (div as any).getSelected = function () {\r\n        return selectedSpotIndex;\r\n    };\r\n    (div as any).activateLayer = function (spotIndex) {\r\n        if (spotIndex < 0 || spotIndex > layerElArr.length - 1) {\r\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + layerElArr.length;\r\n        }\r\n        selectedSpotIndex = spotIndex;\r\n        modeSelect.setValue(klCanvasLayerArr[selectedSpotIndex].mixModeStr);\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot) {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 250, 250, 250)\";\r\n                layerElArr[i].label.style.color = \"#000\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid var(--active-highlight-color)\";\r\n                layerElArr[i].opacitySlider.setActive(true);\r\n                layerElArr[i].isSelected = true;\r\n            } else {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 220, 220, 220)\";\r\n                layerElArr[i].label.style.color = \"#666\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid rgb(158, 158, 158)\";\r\n                layerElArr[i].opacitySlider.setActive(false);\r\n                layerElArr[i].isSelected = false;\r\n            }\r\n        }\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    };\r\n    (div as any).setUiState = function(stateStr) {\r\n        uiState = '' + stateStr;\r\n\r\n        if (uiState === 'left') {\r\n            BB.css(largeThumbDiv, {\r\n                left: '280px',\r\n                right: ''\r\n            });\r\n        } else {\r\n            BB.css(largeThumbDiv, {\r\n                left: '',\r\n                right: '280px'\r\n            });\r\n        }\r\n    };\r\n\r\n    createLayerList();\r\n\r\n    return div;\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1mb1v\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"11KJK\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"floUo\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kino6\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hhQeq\");","import {BB} from '../../bb/bb';\r\nimport {floodFillBits} from '../image-operations/flood-fill';\r\nimport {drawShape} from '../image-operations/shape-tool';\r\nimport {IRenderTextParam, renderText} from '../image-operations/render-text';\r\nimport {IGradient, IKlProject, IMixMode, IRGB, IShapeToolObject} from '../kl.types';\r\nimport {DecoyKlHistory, KlHistoryInterface} from '../history/kl-history';\r\nimport {drawProject} from './draw-project';\r\nimport {LANG} from '../../language/language';\r\nimport {drawGradient} from '../image-operations/gradient-tool';\r\n\r\n\r\nconst allowedMixModes = [\r\n    'source-over',\r\n    'darken',\r\n    'multiply',\r\n    'color-burn',\r\n    'lighten',\r\n    'screen',\r\n    'color-dodge',\r\n    'overlay',\r\n    'soft-light',\r\n    'hard-light',\r\n    'difference',\r\n    'exclusion',\r\n    'hue',\r\n    'saturation',\r\n    'color',\r\n    'luminosity',\r\n];\r\n\r\nexport const MAX_LAYERS = 16;\r\n\r\ninterface KlCanvasLayer extends HTMLCanvasElement {\r\n    name: string;\r\n    mixModeStr: IMixMode;\r\n    opacity: number;\r\n    compositeObj?: {\r\n        draw: (ctx: CanvasRenderingContext2D) => void;\r\n    },\r\n    index: number; // certain brushes need to know\r\n}\r\n\r\n/**\r\n * The image/canvas that the user paints on\r\n * Has layers. layers have names and opacity.\r\n *\r\n * Interacts with the history you specify (for undo/redo)\r\n */\r\nexport class KlCanvas {\r\n\r\n    // todo changeListener consistent concept\r\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\r\n\r\n    private width: number;\r\n    private height: number;\r\n    private layerCanvasArr: KlCanvasLayer[];\r\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\r\n    private history: KlHistoryInterface;\r\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\r\n\r\n\r\n    private init (w: number, h: number): void {\r\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\r\n        }\r\n        this.width = w;\r\n        this.height = h;\r\n    }\r\n\r\n    private emitChange (): void {\r\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\r\n        this.changeListenerArr.forEach(item => item());\r\n    }\r\n\r\n    private updateIndices (): void {\r\n        this.layerCanvasArr.forEach((item, index) => {\r\n            item.index = index;\r\n        });\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        params: {\r\n            projectObj: {\r\n                width: number;\r\n                height: number;\r\n                layers: {\r\n                    name: string;\r\n                    opacity: number;\r\n                    image: HTMLImageElement | HTMLCanvasElement; // already loaded!\r\n                }[];\r\n            }\r\n        } | {\r\n            // creates blank KlCanvas, 0 layers\r\n            width: number;\r\n            height: number;\r\n        } | {\r\n            copy: KlCanvas;\r\n        },\r\n        private layerNrOffset: number = 0,\r\n    ) {\r\n        this.layerCanvasArr = [];\r\n        this.pickCanvas = BB.canvas(1, 1);\r\n        this.history = new DecoyKlHistory();\r\n        if ('copy' in params) {\r\n            this.width = 1;\r\n            this.height = 1;\r\n        } else {\r\n            if ('width' in params && 'height' in params) {\r\n                this.width = params.width;\r\n                this.height = params.height;\r\n            } else {\r\n                this.width = 1;\r\n                this.height = 1;\r\n            }\r\n        }\r\n        this.init(this.width, this.height);\r\n\r\n        this.changeListenerArr = [];\r\n\r\n        if ('copy' in params) {\r\n            try {\r\n                this.copy(params.copy);\r\n            } catch (e) {\r\n                this.destroy();\r\n                throw e;\r\n            }\r\n        } else if ('projectObj' in params) {\r\n            const origLayers = [].concat(params.projectObj.layers);\r\n            this.init(params.projectObj.width, params.projectObj.height);\r\n\r\n            if (!origLayers.length) {\r\n                throw new Error('project.layers needs at least 1 layer');\r\n            }\r\n\r\n            for (let i = 0; i < origLayers.length; i++) {\r\n                if (origLayers[i].mixModeStr && !allowedMixModes.includes(origLayers[i].mixModeStr)) {\r\n                    throw new Error('unknown mixModeStr ' + origLayers[i].mixModeStr);\r\n                }\r\n\r\n                this.addLayer();\r\n                this.layerOpacity(i, origLayers[i].opacity);\r\n                this.layerCanvasArr[i].name = origLayers[i].name;\r\n                this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr ? origLayers[i].mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    /**\r\n     * Resets canvas -> 1 layer, 100% opacity,\r\n     * unless layers provided.\r\n     * @param p\r\n     */\r\n    reset (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            color?: IRGB; // optional - fill color\r\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\r\n            layerName?: string; // if via image\r\n            layers?: {\r\n                name: string;\r\n                opacity: number;\r\n                mixModeStr: IMixMode;\r\n                image: HTMLCanvasElement;\r\n            }[];\r\n        }\r\n    ): void | number {\r\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        this.history.pause(true);\r\n\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\r\n\r\n        if (p.layers) {\r\n            for (let i = 0; i < p.layers.length; i++) {\r\n                let item = p.layers[i];\r\n                if (!this.layerCanvasArr[i]) {\r\n                    this.addLayer();\r\n                }\r\n                this.layerCanvasArr[i].name = item.name;\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(item.image, 0, 0);\r\n                this.layerOpacity(i, item.opacity);\r\n            }\r\n        } else {\r\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + \" 1\";\r\n            this.layerCanvasArr[0].width = this.width;\r\n            this.layerCanvasArr[0].height = this.height;\r\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\r\n            this.layerOpacity(0, 1);\r\n            if (p.color) {\r\n                this.layerFill(0, p.color);\r\n            } else if (p.image) {\r\n                this.layerCanvasArr[0].getContext(\"2d\").drawImage(p.image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n\r\n        this.history.pause(false);\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"reset\",\r\n            params: [p] // dont screw with p\r\n        });\r\n\r\n        return this.layerCanvasArr.length - 1;\r\n    }\r\n\r\n    isLayerLimitReached (): boolean {\r\n        return this.layerCanvasArr.length >= MAX_LAYERS;\r\n    }\r\n\r\n    getWidth (): number {\r\n        return this.width;\r\n    }\r\n\r\n    getHeight (): number {\r\n        return this.height;\r\n    }\r\n\r\n    copy (toCopyCanvas: KlCanvas): void {\r\n        if (\r\n            toCopyCanvas.getWidth() < 1 ||\r\n            toCopyCanvas.getHeight() < 1 ||\r\n            isNaN(toCopyCanvas.getWidth()) ||\r\n            isNaN(toCopyCanvas.getHeight())\r\n        ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        // keep existing canvases\r\n\r\n        let origLayers = toCopyCanvas.getLayers();\r\n\r\n        while (this.layerCanvasArr.length > origLayers.length) {\r\n            this.removeLayer(this.layerCanvasArr.length - 1);\r\n        }\r\n\r\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\r\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\r\n        }\r\n        for (let i = 0; i < origLayers.length; i++) {\r\n            if (i >= this.layerCanvasArr.length) {\r\n                this.addLayer();\r\n            } else {\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n            }\r\n            this.layerOpacity(i, origLayers[i].opacity);\r\n            this.layerCanvasArr[i].name = origLayers[i].name;\r\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].context.canvas, 0, 0);\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    getLayerCount (): number {\r\n        return this.layerCanvasArr.length;\r\n    }\r\n\r\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\r\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            return false;\r\n        }\r\n        w = Math.max(w, 1);\r\n        h = Math.max(h, 1);\r\n\r\n        let tmp1, tmp2;\r\n\r\n        if (algorithm === 'pixelated') {\r\n            tmp1 = BB.canvas(w, h);\r\n            let tmp1Ctx = tmp1.getContext('2d');\r\n            tmp1Ctx.imageSmoothingEnabled = false;\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                if (i > 0) {\r\n                    tmp1Ctx.clearRect(0, 0, w, h);\r\n                }\r\n                let layerCanvas = this.layerCanvasArr[i];\r\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\r\n                layerCanvas.width = w;\r\n                layerCanvas.height = h;\r\n                let layerContext = layerCanvas.getContext('2d');\r\n                layerContext.drawImage(tmp1, 0, 0);\r\n            }\r\n\r\n        } else if (algorithm === 'smooth') {\r\n            tmp1 = BB.canvas();\r\n            tmp2 = BB.canvas();\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\r\n            }\r\n        } else {\r\n            throw new Error('unknown resize algorithm');\r\n        }\r\n\r\n        this.width = w;\r\n        this.height = h;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * crop / extend\r\n     * @param p\r\n     */\r\n    resizeCanvas (p: {\r\n        left: number;\r\n        top: number;\r\n        right: number;\r\n        bottom: number;\r\n        fillColor?: IRGB\r\n    }): void {\r\n\r\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\r\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\r\n        const offX = Math.round(p.left);\r\n        const offY = Math.round(p.top);\r\n\r\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\r\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\r\n        }\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            const ctemp = BB.canvas(this.width, this.height);\r\n            let layerCanvas = this.layerCanvasArr[i];\r\n            let layerCtx = this.layerCanvasArr[i].getContext(\"2d\");\r\n            ctemp.getContext(\"2d\").drawImage(layerCanvas, 0, 0);\r\n\r\n            this.layerCanvasArr[i].width = newW;\r\n            this.layerCanvasArr[i].height = newH;\r\n\r\n            layerCtx.save();\r\n            if (i === 0 && p.fillColor) {\r\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\r\n                layerCtx.fillRect(0, 0, newW, newH);\r\n                layerCtx.clearRect(offX, offY, this.width, this.height);\r\n            }\r\n            layerCtx.drawImage(ctemp, offX, offY);\r\n            layerCtx.restore();\r\n        }\r\n        this.width = newW;\r\n        this.height = newH;\r\n    }\r\n\r\n    /**\r\n     * will be inserted on top of selected\r\n     * @param selected\r\n     */\r\n    addLayer (selected?: number): false | number {\r\n        if (this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        if (!canvas.getContext('2d')) {\r\n            throw new Error('kl-create-canvas-error');\r\n        }\r\n\r\n        (canvas as any).mixModeStr = 'source-over';\r\n\r\n        if (selected === undefined) {\r\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas as any;\r\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\r\n        } else {\r\n            this.layerCanvasArr.splice(selected + 1, 0, canvas as any);\r\n            selected++;\r\n        }\r\n\r\n        (canvas as any).name = LANG('layers-layer') + \" \" + (this.layerCanvasArr.length + this.layerNrOffset);\r\n        this.history.pause(true);\r\n        this.layerOpacity(selected, 1);\r\n        this.history.pause(false);\r\n        this.updateIndices();\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"addLayer\",\r\n            params: [selected - 1]\r\n        });\r\n        return selected;\r\n    }\r\n\r\n    duplicateLayer (i: number): false | number {\r\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        this.layerCanvasArr.splice(i + 1, 0, canvas as any);\r\n\r\n        (canvas as any).name = this.layerCanvasArr[i].name + \" \" + LANG('layers-copy');\r\n        (canvas as any).mixModeStr = this.layerCanvasArr[i].mixModeStr;\r\n        canvas.getContext(\"2d\").drawImage(this.layerCanvasArr[i], 0, 0);\r\n        this.history.pause(true);\r\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\r\n        this.history.pause(false);\r\n\r\n        this.updateIndices();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"duplicateLayer\",\r\n            params: [i]\r\n        });\r\n        return i + 1;\r\n    }\r\n\r\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\r\n        if (this.layerCanvasArr[i]) {\r\n            return this.layerCanvasArr[i].getContext(\"2d\");\r\n        }\r\n        if (doReturnNull) {\r\n            return null;\r\n        }\r\n        throw new Error(\"layer of index \" + i + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n    }\r\n\r\n    removeLayer (i: number): false | number {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr.splice(i, 1);\r\n            this.updateIndices();\r\n        } else {\r\n            return false;\r\n        }\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"removeLayer\",\r\n            params: [i]\r\n        });\r\n\r\n        return Math.max(0, i - 1);\r\n    }\r\n\r\n    renameLayer (i: number, name: string): boolean {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr[i].name = name;\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"renameLayer\",\r\n            params: [i, name]\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    layerOpacity (i: number, o: number): void {\r\n        if (!this.layerCanvasArr[i]) {\r\n            return;\r\n        }\r\n        o = Math.max(0, Math.min(1, o));\r\n        this.layerCanvasArr[i].opacity = o;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerOpacity\",\r\n            params: [i, o]\r\n        });\r\n\r\n        this.emitChange();\r\n    }\r\n\r\n    moveLayer (i: number, d: number): void | number {\r\n        if (d === 0) {\r\n            return;\r\n        }\r\n        if (this.layerCanvasArr[i]) {\r\n            const temp = this.layerCanvasArr[i];\r\n            this.layerCanvasArr.splice(i, 1);\r\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\r\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\r\n            this.updateIndices();\r\n            this.history.push({\r\n                tool: [\"canvas\"],\r\n                action: \"moveLayer\",\r\n                params: [i, d]\r\n            });\r\n            return targetIndex;\r\n        }\r\n    }\r\n\r\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: IMixMode | 'as-alpha'): void | number {\r\n        if (\r\n            !this.layerCanvasArr[layerBottomIndex] ||\r\n            !this.layerCanvasArr[layerTopIndex] ||\r\n            layerBottomIndex === layerTopIndex\r\n        ) {\r\n            return;\r\n        }\r\n        //order messed up\r\n        if (layerBottomIndex > layerTopIndex) {\r\n            let temp = layerBottomIndex;\r\n            layerBottomIndex = layerTopIndex;\r\n            layerTopIndex = temp;\r\n        }\r\n\r\n        let topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\r\n        if (topOpacity !== 0 && topOpacity) {\r\n            let ctx = this.layerCanvasArr[layerBottomIndex].getContext(\"2d\");\r\n            ctx.save();\r\n\r\n            if (mixModeStr === 'as-alpha') { // todo remove this?\r\n\r\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\r\n                ctx.globalCompositeOperation = 'destination-in';\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            } else {\r\n\r\n                if (mixModeStr) {\r\n                    ctx.globalCompositeOperation = mixModeStr;\r\n                }\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            }\r\n\r\n            ctx.restore();\r\n\r\n            // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n            // TODO remove if chrome updated\r\n            if (mixModeStr) {\r\n                ctx.save();\r\n                ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n                ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n                ctx.restore();\r\n            }\r\n        }\r\n        this.updateIndices();\r\n        this.history.pause(true);\r\n        this.removeLayer(layerTopIndex);\r\n        this.history.pause(false);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"mergeLayers\",\r\n            params: [layerBottomIndex, layerTopIndex, mixModeStr]\r\n        });\r\n\r\n        return layerBottomIndex;\r\n    }\r\n\r\n    rotate (deg: number): void {\r\n        while (deg < 0) {\r\n            deg += 360;\r\n        }\r\n        deg %= 360;\r\n        if (deg % 90 != 0 || deg === 0)\r\n            return;\r\n        let temp = BB.canvas();\r\n        if (deg === 0 || deg === 180) {\r\n            temp.width = this.width;\r\n            temp.height = this.height;\r\n        } else if (deg === 90 || deg === 270) {\r\n            temp.width = this.height;\r\n            temp.height = this.width;\r\n        }\r\n        let ctx = temp.getContext(\"2d\");\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.clearRect(0, 0, temp.width, temp.height);\r\n            ctx.save();\r\n            ctx.translate(temp.width / 2, temp.height / 2);\r\n            ctx.rotate(deg * Math.PI / 180);\r\n            if (deg === 180) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            } else if (deg === 90 || deg === 270) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\r\n            }\r\n            this.layerCanvasArr[i].width = temp.width;\r\n            this.layerCanvasArr[i].height = temp.height;\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n            ctx.restore();\r\n        }\r\n        this.width = temp.width;\r\n        this.height = temp.height;\r\n    }\r\n\r\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex: number): void {\r\n        if (!isHorizontal && !isVertical) {\r\n            return;\r\n        }\r\n\r\n        let temp = BB.canvas(this.width, this.height);\r\n        temp.width = this.width;\r\n        temp.height = this.height;\r\n        let tempCtx = temp.getContext(\"2d\");\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n\r\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\r\n                continue;\r\n            }\r\n\r\n            tempCtx.save();\r\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\r\n            tempCtx.translate(temp.width / 2, temp.height / 2);\r\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\r\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            tempCtx.restore();\r\n\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n        }\r\n    }\r\n\r\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        if (compositeOperation) {\r\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\r\n        }\r\n        ctx.fillStyle = \"rgba(\" + colorObj.r + \",\" + colorObj.g + \",\" + colorObj.b + \",1)\";\r\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n        // TODO remove if chrome updated\r\n        ctx.save();\r\n        ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n        ctx.restore();\r\n\r\n        /*if (!document.getElementById('testocanvas')) {\r\n            layerCanvasArr[layerIndex].id = 'testocanvas';\r\n            document.body.appendChild(layerCanvasArr[layerIndex]);\r\n            BB.css(layerCanvasArr[layerIndex], {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }\r\n        if (!document.getElementById('testocanvas')) {\r\n            let c = document.createElement('canvas');\r\n            c.width = 1000;\r\n            c.height = 1000;\r\n            let ctx2 = c.getContext('2d');\r\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\r\n            c.id = 'testocanvas';\r\n            document.body.appendChild(c);\r\n            BB.css(c, {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }*/\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerFill\",\r\n            params: [layerIndex, colorObj, compositeOperation]\r\n        });\r\n    }\r\n\r\n    floodFill (\r\n        layerIndex: number, // index of layer to be filled\r\n        x: number, // starting point\r\n        y: number,\r\n        rgb: IRGB | null, // fill color, if null -> erase\r\n        opacity: number,\r\n        tolerance: number,\r\n        sampleStr: 'current' | 'all' | 'above',\r\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\r\n        isContiguous: boolean,\r\n    ): void {\r\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\r\n            return;\r\n        }\r\n        tolerance = Math.round(tolerance);\r\n\r\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\r\n            throw new Error('invalid sampleStr');\r\n        }\r\n\r\n        let result;\r\n\r\n        let srcCtx;\r\n        let srcImageData;\r\n        let srcData;\r\n\r\n        let targetCtx;\r\n        let targetImageData;\r\n        let targetData;\r\n\r\n\r\n        if (sampleStr === 'all') {\r\n\r\n            let srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\r\n            srcCtx = srcCanvas.getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            srcCanvas = null;\r\n            srcCtx = null;\r\n            srcImageData = null;\r\n            srcData = null;\r\n\r\n            targetCtx = this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        } else {\r\n            let srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\r\n\r\n            if (srcIndex >= this.layerCanvasArr.length) {\r\n                return;\r\n            }\r\n\r\n            srcCtx = this.layerCanvasArr[srcIndex].getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            if (layerIndex !== srcIndex) {\r\n                srcCtx = null;\r\n                srcImageData = null;\r\n                srcData = null;\r\n            }\r\n\r\n            targetCtx = layerIndex === srcIndex ? srcCtx : this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        }\r\n\r\n        targetData = targetImageData.data;\r\n        if (rgb) {\r\n            if (opacity === 1) {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4] = rgb.r;\r\n                        targetData[i * 4 + 1] = rgb.g;\r\n                        targetData[i * 4 + 2] = rgb.b;\r\n                        targetData[i * 4 + 3] = 255;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\r\n                        targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\r\n                        targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\r\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\r\n                    }\r\n                }\r\n            }\r\n        } else { // erase\r\n            if (opacity === 1) {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4 + 3] = 0;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 0, opacity);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        targetCtx.putImageData(targetImageData, 0, 0);\r\n\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, targetImageData]\r\n        });\r\n    }\r\n\r\n    /**\r\n     * draw shape via BB.drawShape\r\n     * @param layerIndex\r\n     * @param shapeObj\r\n     */\r\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\r\n        if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) {\r\n            return;\r\n        }\r\n        drawShape(this.layerCanvasArr[layerIndex].getContext(\"2d\"), shapeObj);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"drawShape\",\r\n            params: [layerIndex, BB.copyObj(shapeObj)],\r\n        });\r\n    }\r\n\r\n    drawGradient(layerIndex: number, gradientObj: IGradient): void {\r\n        drawGradient(this.layerCanvasArr[layerIndex].getContext(\"2d\"), gradientObj);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"drawGradient\",\r\n            params: [layerIndex, BB.copyObj(gradientObj)],\r\n        });\r\n    }\r\n\r\n    text (layerIndex: number, p: IRenderTextParam): void {\r\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"text\",\r\n            params: [layerIndex, BB.copyObj(p)],\r\n        });\r\n    }\r\n\r\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.putImageData(imageData, 0, 0);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, imageData],\r\n        });\r\n    }\r\n\r\n    clearLayer (layerIndex: number): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"clearLayer\",\r\n            params: [layerIndex]\r\n        });\r\n    }\r\n\r\n    getLayers (): {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                context: item.getContext(\"2d\"),\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayersFast (): {\r\n        canvas: KlCanvasLayer;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                canvas: item,\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            if (this.layerCanvasArr[i] === canvasObj) {\r\n                return i;\r\n            }\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getLayer (index: number, doReturnNull?: boolean): null | {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        id: number;\r\n    } {\r\n        if (this.layerCanvasArr[index]) {\r\n            return {\r\n                context: this.layerCanvasArr[index].getContext(\"2d\"),\r\n                opacity: this.layerCanvasArr[index].opacity,\r\n                name: this.layerCanvasArr[index].name,\r\n                id: index,\r\n            };\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer of index \" + index + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getColorAt (x: number, y: number): IRGB {\r\n        x = Math.floor(x);\r\n        y = Math.floor(y);\r\n        let ctx = this.pickCanvas.getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.imageSmoothingEnabled = false;\r\n        ctx.clearRect(0, 0, 1, 1);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.globalAlpha = this.layerCanvasArr[i].opacity;\r\n            ctx.globalCompositeOperation = this.layerCanvasArr[i].mixModeStr;\r\n            ctx.drawImage(this.layerCanvasArr[i], -x, -y);\r\n        }\r\n        ctx.restore();\r\n        let imData = ctx.getImageData(0, 0, 1, 1);\r\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\r\n    }\r\n\r\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\r\n        return drawProject(this.getProject(), factor);\r\n    }\r\n\r\n    getProject (): IKlProject {\r\n        return {\r\n            width: this.width,\r\n            height: this.height,\r\n            layers: this.layerCanvasArr.map(layer => {\r\n                return {\r\n                    name: layer.name,\r\n                    opacity: layer.opacity,\r\n                    mixModeStr: layer.mixModeStr,\r\n                    image: layer,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    addChangeListener (func: () => void): void {\r\n        if (this.changeListenerArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.changeListenerArr.push(func);\r\n    }\r\n\r\n    removeChangeListener (func: () => void): void {\r\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\r\n            if (this.changeListenerArr[i] === func) {\r\n                this.changeListenerArr.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    setMixMode (layerIndex: number, mixModeStr: IMixMode): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"setMixMode\",\r\n            params: [layerIndex, '' + mixModeStr],\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Set composite drawing step for KlCanvasWorkspace.\r\n     * To apply temporary manipulations to a layer.\r\n     *\r\n     * @param layerIndex\r\n     * @param compositeObj\r\n     */\r\n    setComposite (\r\n        layerIndex: number,\r\n        compositeObj: null | {\r\n            draw: (ctx: CanvasRenderingContext2D) => void;\r\n        }\r\n    ): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].compositeObj = compositeObj;\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.layerCanvasArr === null) {\r\n            return;\r\n        }\r\n        this.layerCanvasArr.forEach(canvas => {\r\n            BB.freeCanvas(canvas);\r\n        });\r\n        this.layerCanvasArr = null;\r\n    }\r\n\r\n}\r\n","\r\n/**\r\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/ but it implemented tolerance wrong, and had bugs.\r\n * So, my own implementation. can handle tolerance, grow, opacity.\r\n * Needs to be optimized.\r\n */\r\n\r\n/**\r\n * Set values in data within rect to 254, unless they're 255\r\n *\r\n * @param data Uint8Array\r\n * @param width int\r\n * @param x0 int\r\n * @param y0 int\r\n * @param x1 int >x0\r\n * @param y1 int >y0\r\n */\r\nfunction fillRect(data, width, x0, y0, x1, y1) {\r\n    for (let x = x0; x <= x1; x++) {\r\n        for (let y = y0; y <= y1; y++) {\r\n            if (data[y * width + x] === 255) {\r\n                continue;\r\n            }\r\n            data[y * width + x] = 254;\r\n        }\r\n    }\r\n}\r\n\r\nlet mx, my;\r\n\r\n/**\r\n * Get index i moved by dX, dY. in array with dimensions width height.\r\n * Returns null if outside bounds.\r\n *\r\n * @param width int\r\n * @param height int\r\n * @param i int\r\n * @param dX int\r\n * @param dY int\r\n * @returns {null|*}\r\n */\r\nfunction moveIndex(width, height, i, dX, dY) {\r\n    mx = i % width + dX;\r\n    my = Math.floor(i / width) + dY;\r\n\r\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\r\n        return null;\r\n    }\r\n\r\n    return my * width + mx;\r\n}\r\n\r\n/**\r\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\r\n * returns false if already filled, or i is null\r\n *\r\n * @param srcArr Uint8Array rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param initRgba rgba\r\n * @param tolerance int 0 - 255\r\n * @param i int - srcArr index\r\n * @returns {boolean}\r\n */\r\nfunction testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i) {\r\n    if (i === null || targetArr[i] === 255) {\r\n        return false;\r\n    }\r\n\r\n    if (\r\n        srcArr[i * 4] === initRgba[0] &&\r\n        srcArr[i * 4 + 1] === initRgba[1] &&\r\n        srcArr[i * 4 + 2] === initRgba[2] &&\r\n        srcArr[i * 4 + 3] === initRgba[3]\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    if (\r\n        tolerance > 0 &&\r\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n *\r\n * @param srcArr Uint8Array rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param px int\r\n * @param py int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */\r\nfunction floodFill(srcArr, targetArr, width, height, px, py, tolerance, grow, isContiguous) {\r\n\r\n    let initRgba = [\r\n        srcArr[(py * width + px) * 4],\r\n        srcArr[(py * width + px) * 4 + 1],\r\n        srcArr[(py * width + px) * 4 + 2],\r\n        srcArr[(py * width + px) * 4 + 3]\r\n    ];\r\n\r\n    if (isContiguous) {\r\n        let q = [];\r\n        q.push(py * width + px);\r\n        targetArr[py * width + px] = 255;\r\n\r\n        let i, e;\r\n        while (q.length) {\r\n            i = q.pop();\r\n\r\n            // queue up unfilled neighbors\r\n            e = moveIndex(width, height, i, -1, 0); // left\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 1, 0); // right\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 0, -1); // up\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 0, 1); // bottom\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n        }\r\n    } else {\r\n        for (let i = 0; i < width * height; i++) {\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\r\n        }\r\n    }\r\n\r\n\r\n    // grow\r\n    if (grow === 0) {\r\n        return;\r\n    }\r\n\r\n    // how does it grow? it finds all pixel at the edge.\r\n    // then depending on what kind of edge it is, it draws a rectangle into target\r\n    // the rectangle has the value 254, or else it mess it all up.\r\n    // after it's all done, replaces it with 255\r\n    let x0, x1, y0, y1;\r\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\r\n    for (let x = 0; x < width; x++) {\r\n        for (let y = 0; y < height; y++) {\r\n            if (targetArr[y * width + x] !== 255) {\r\n                continue;\r\n            }\r\n\r\n            // bounds of rectangle\r\n            x0 = x;\r\n            x1 = x;\r\n            y0 = y;\r\n            y1 = y;\r\n\r\n            l = targetArr[(y) * width + x - 1] !== 255;\r\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\r\n            t = targetArr[(y - 1) * width + x] !== 255;\r\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\r\n            r = targetArr[(y) * width + x + 1] !== 255;\r\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\r\n            b = targetArr[(y + 1) * width + x] !== 255;\r\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\r\n\r\n            if (l) { // left\r\n                x0 = x - grow;\r\n            }\r\n            if (l && tl && t) { // top left\r\n                x0 = x - grow;\r\n                y0 = y - grow;\r\n            }\r\n            if (t) { // top\r\n                y0 = Math.min(y0, y - grow);\r\n            }\r\n            if (t && tr && r) { // top right\r\n                y0 = Math.min(y0, y - grow);\r\n                x1 = x + grow;\r\n            }\r\n            if (r) { // right\r\n                x1 = Math.max(x1, x + 1 * grow);\r\n            }\r\n            if (r && br && b) { // bottom right\r\n                x1 = Math.max(x1, x + 1 * grow);\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n            if (b) { // bottom\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n            if (b && bl && l) { // bottom left\r\n                x0 = Math.min(x0, x - 1 * grow);\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n\r\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\r\n                continue;\r\n            }\r\n\r\n            fillRect(\r\n                targetArr,\r\n                width,\r\n                Math.max(0, x0),\r\n                Math.max(0, y0),\r\n                Math.min(width - 1, x1),\r\n                Math.min(height - 1, y1)\r\n            );\r\n        }\r\n    }\r\n    for (let i = 0; i < width * height; i++) {\r\n        if (targetArr[i] === 254) {\r\n            targetArr[i] = 255;\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\r\n *\r\n * returns {\r\n *     data: Uint8Array\r\n * }\r\n *\r\n * @param rgbaArr Uint8Array rgba\r\n * @param width int\r\n * @param height int\r\n * @param x int\r\n * @param y int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n * @returns {{data: Uint8Array}}\r\n */\r\nexport function floodFillBits(rgbaArr, width, height, x, y, tolerance, grow, isContiguous) {\r\n    x = Math.round(x);\r\n    y = Math.round(y);\r\n\r\n    let resultArr = new Uint8Array(new ArrayBuffer(width * height));\r\n\r\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\r\n\r\n    return {\r\n        data: resultArr\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, IShapeToolObject} from '../kl.types';\r\n\r\n\r\n/**\r\n * Input processor for shape tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n *\r\n * @param p - {onShape: func(isDone, x1, y1, x2, y2, angleRad)}\r\n * @constructor\r\n */\r\nexport function ShapeTool(p) {\r\n\r\n    let downX, downY, downAngleRad;\r\n\r\n    this.onDown = function(x, y, angleRad) {\r\n        downX = x;\r\n        downY = y;\r\n        downAngleRad = angleRad;\r\n    };\r\n\r\n    this.onMove = function(x, y) {\r\n        p.onShape(false, downX, downY, x, y, downAngleRad);\r\n    };\r\n\r\n    this.onUp = function(x, y) {\r\n        p.onShape(true, downX, downY, x, y, downAngleRad);\r\n    };\r\n}\r\n\r\nfunction applyDefaults(obj: any, defaults: any): void {\r\n    for (const property in defaults) {\r\n        if (!(property in obj)) {\r\n            obj[property] = defaults[property];\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Draw a shape (rectangle, ellipse, line)\r\n *\r\n * @param ctx\r\n * @param shapeObj\r\n */\r\nexport function drawShape(\r\n    ctx: CanvasRenderingContext2D,\r\n    shapeObj: IShapeToolObject,\r\n) {\r\n    shapeObj = BB.copyObj(shapeObj);\r\n    applyDefaults(shapeObj, {\r\n        angleRad: 0,\r\n        isOutwards: false,\r\n        opacity: 1,\r\n        isEraser: false,\r\n        doLockAlpha: false,\r\n    });\r\n\r\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\r\n        const lineWidth = Math.round(shapeObj.lineWidth);\r\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\r\n\r\n        // --- prep color ---\r\n        let colorRGB: IRGB = shapeObj.isEraser ? {r: 255, g: 255, b: 255} : (shapeObj.fillRgb ? shapeObj.fillRgb : shapeObj.strokeRgb);\r\n\r\n\r\n        // --- prep canvas ---\r\n        ctx.save();\r\n        if (shapeObj.opacity) {\r\n            ctx.globalAlpha = shapeObj.opacity;\r\n        }\r\n        if (shapeObj.isEraser) {\r\n            ctx.globalCompositeOperation = 'destination-out';\r\n        }\r\n        if (shapeObj.doLockAlpha) {\r\n            ctx.globalCompositeOperation = 'source-atop';\r\n        }\r\n        ctx.rotate(-shapeObj.angleRad);\r\n        if (shapeObj.fillRgb) {\r\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(colorRGB);\r\n        } else if (shapeObj.strokeRgb) {\r\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(colorRGB);\r\n            ctx.lineWidth = lineWidth;\r\n        }\r\n\r\n        let x1 = shapeObj.x1;\r\n        let y1 = shapeObj.y1;\r\n        let x2 = shapeObj.x2;\r\n        let y2 = shapeObj.y2;\r\n\r\n        // --- angle snapping ---\r\n        if (shapeObj.isAngleSnap) {\r\n            let r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            let pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n            let pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n            let rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n            x2 = rotated.x;\r\n            y2 = rotated.y;\r\n\r\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                    x2 = x1;\r\n                } else { // left or right\r\n                    y2 = y1;\r\n                }\r\n            }\r\n        }\r\n\r\n        let x = x1;\r\n        let y = y1;\r\n        let dX = x2 - x1;\r\n        let dY = y2 - y1;\r\n\r\n        // --- 1:1 ratio ---\r\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\r\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            let rx = r1.x;\r\n            let ry = r1.y;\r\n            let rdX = r2.x - r1.x;\r\n            let rdY = r2.y - r1.y;\r\n\r\n            if (Math.abs(rdX) < Math.abs(rdY)) {\r\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\r\n            } else {\r\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\r\n            }\r\n            r2.x = rx + rdX;\r\n            r2.y = ry + rdY;\r\n\r\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\r\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\r\n\r\n            x1 = r1.x;\r\n            y1 = r1.y;\r\n            x2 = r2.x;\r\n            y2 = r2.y;\r\n\r\n            x = x1;\r\n            y = y1;\r\n            dX = x2 - x1;\r\n            dY = y2 - y1;\r\n        }\r\n\r\n        // outwards modifier\r\n        if (shapeObj.isOutwards) {\r\n            x -= dX;\r\n            y -= dY;\r\n            dX *= 2;\r\n            dY *= 2;\r\n\r\n            x1 = x;\r\n            y1 = y;\r\n            x2 = x + dX;\r\n            y2 = y + dY;\r\n        }\r\n\r\n        let p1;\r\n        let p2;\r\n        if (shapeObj.type === 'line') { // --- line ---\r\n\r\n            // rounded\r\n            const x1r = Math.round(x1);\r\n            const y1r = Math.round(y1);\r\n            const x2r = Math.round(x2);\r\n            const y2r = Math.round(y2);\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (lineWidth % 2 === 0) {\r\n\r\n                if (y1r === y2r) {\r\n                    p1 = {\r\n                        x: x1f,\r\n                        y: y1r,\r\n                    };\r\n                    p2 = {\r\n                        x: x2f,\r\n                        y: y2r,\r\n                    };\r\n\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                } else if (x1r === x2r) {\r\n                    p1 = {\r\n                        x: x1r,\r\n                        y: y1f,\r\n                    };\r\n                    p2 = {\r\n                        x: x2r,\r\n                        y: y2f,\r\n                    };\r\n\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                } else {\r\n                    p1 = {\r\n                        x: x1,\r\n                        y: y1,\r\n                    };\r\n                    p2 = {\r\n                        x: x2,\r\n                        y: y2,\r\n                    };\r\n                }\r\n\r\n            } else {\r\n                p1 = {\r\n                    x: x1f,\r\n                    y: y1f,\r\n                };\r\n                p2 = {\r\n                    x: x2f,\r\n                    y: y2f,\r\n                };\r\n                if (y1f === y2f) {\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                    p1.y += 0.5;\r\n                    p2.y += 0.5;\r\n                } else if (x1f === x2f) {\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                    p1.x += 0.5;\r\n                    p2.x += 0.5;\r\n                } else {\r\n                    p1.x = x1;\r\n                    p1.y = y1;\r\n                    p2.x = x2;\r\n                    p2.y = y2;\r\n                }\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(p1.x, p1.y);\r\n            ctx.lineTo(p2.x, p2.y);\r\n            ctx.stroke();\r\n\r\n        } else if (shapeObj.type === 'rect') { // --- rect ---\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (angleDeg % 90 === 0) {\r\n                if (shapeObj.fillRgb) {\r\n                    if (x1 % 1 === 0) {\r\n                        x1 += 1;\r\n                    }\r\n                    if (y1 % 1 === 0) {\r\n                        y1 += 1;\r\n                    }\r\n                    if (x2 % 1 === 0) {\r\n                        x2 += 1;\r\n                    }\r\n                    if (y2 % 1 === 0) {\r\n                        y2 += 1;\r\n                    }\r\n\r\n                    p1 = {\r\n                        x: x1 < x2 ? x1f : x2f,\r\n                        y: y1 < y2 ? y1f : y2f,\r\n                    };\r\n                    p2 = {\r\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\r\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\r\n                    };\r\n                    p2.x = p1.x + p2.x;\r\n                    p2.y = p1.y + p2.y;\r\n\r\n                } else {\r\n                    if (lineWidth % 2 === 0) {\r\n                        p1 = {\r\n                            x: x1f,\r\n                            y: y1f,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f,\r\n                            y: y2f,\r\n                        };\r\n                    } else {\r\n                        p1 = {\r\n                            x: x1f + 0.5,\r\n                            y: y1f + 0.5,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f + 0.5,\r\n                            y: y2f + 0.5,\r\n                        };\r\n                    }\r\n                }\r\n            } else {\r\n                p1 = {\r\n                    x: x1,\r\n                    y: y1,\r\n                };\r\n                p2 = {\r\n                    x: x2,\r\n                    y: y2,\r\n                };\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2.x = p2.x - p1.x;\r\n            p2.y = p2.y - p1.y;\r\n\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\r\n            } else {\r\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\r\n            }\r\n\r\n        } else {  // --- circle ---\r\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n            x = p1.x;\r\n            y = p1.y;\r\n            dX = p2.x - p1.x;\r\n            dY = p2.y - p1.y;\r\n\r\n            ctx.beginPath();\r\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fill();\r\n            } else {\r\n                ctx.stroke();\r\n            }\r\n        }\r\n\r\n\r\n        ctx.restore();\r\n\r\n    } else {\r\n        throw new Error('unknown shape');\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {IRect} from '../../bb/bb.types';\r\n\r\nexport interface IRenderTextParam {\r\n    textStr: string; // text to be drawn. can contain newlines\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n    align: 'left' | 'center' | 'right'; // default 'left'\r\n    isBold: boolean; // default false\r\n    isItalic: boolean; // default false\r\n    angleRad: number; // default 0 - rotates around x y\r\n    lineHeight?: number; // pixels\r\n    color: string;\r\n    isDebug?: boolean;\r\n}\r\n\r\n\r\n/**\r\n * Draw text on a canvas.\r\n *\r\n * @param canvas\r\n * @param p\r\n * @returns - bounds. coords relative to p.x p.y\r\n */\r\nexport function renderText(canvas: HTMLCanvasElement, p: IRenderTextParam): IRect {\r\n\r\n    // always at least a space. so bounds aren't just a dot\r\n    let textStr = p.textStr === '' ? ' ' : p.textStr;\r\n\r\n    // --- create el ---\r\n    // create an actual dom element. figure out where exactly each letter is positioned.\r\n    // that way multiline is feasible. canvas can't do multiline or text-align\r\n    let outer = BB.el({\r\n        css: {\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100000px',\r\n            fontSize: p.size + 'px',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n        }\r\n    });\r\n    let div = BB.el({\r\n        parent: outer,\r\n        css: {\r\n            display: 'inline-block',\r\n            textAlign: p.align ? p.align : 'left',\r\n            fontFamily: p.font ? p.font : 'sans-serif',\r\n            fontSize: p.size + 'px',\r\n            fontWeight: p.isBold ? 'bold' : 'normal',\r\n            fontStyle: p.isItalic ? 'italic' : 'normal',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n\r\n\r\n            opacity: '0',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    let spanStr = '';\r\n    let replaceObj = {\r\n        \"\\n\": '<br>',\r\n        \" \": '&nbsp;',\r\n        \"\t\": '&nbsp;&nbsp;&nbsp;&nbsp;',\r\n    };\r\n    for (let i = 0; i < textStr.length; i++) {\r\n        if (textStr[i] === \"\\n\") {\r\n            div.appendChild(BB.el({\r\n                tagName: 'span',\r\n                textContent: spanStr,\r\n                css: {\r\n                    whiteSpace: 'pre'\r\n                }\r\n            }));\r\n            spanStr = '';\r\n            div.appendChild(BB.el({\r\n                tagName: 'br'\r\n            }));\r\n            continue;\r\n        }\r\n        spanStr += textStr[i].replace(\"\\t\", '    ');\r\n    }\r\n    div.appendChild(BB.el({\r\n        tagName: 'span',\r\n        textContent: spanStr,\r\n        css: {\r\n            whiteSpace: 'pre'\r\n        }\r\n    }));\r\n    document.body.appendChild(outer);\r\n\r\n\r\n    // --- determine bounds ---\r\n    let bounds = {\r\n        x0: 99999999,\r\n        y0: 99999999,\r\n        x1: 0,\r\n        y1: 0\r\n    }\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        let el = div.children[i] as HTMLElement;\r\n        bounds.x0 = Math.min(bounds.x0, el.offsetLeft);\r\n        bounds.y0 = Math.min(bounds.y0, el.offsetTop);\r\n        bounds.x1 = Math.max(bounds.x1, el.offsetLeft + el.offsetWidth);\r\n        bounds.y1 = Math.max(bounds.y1, el.offsetTop + el.offsetHeight);\r\n    }\r\n\r\n    // --- draw ---\r\n    let ctx = canvas.getContext('2d');\r\n    ctx.save();\r\n\r\n    let font = [];\r\n    if (p.isItalic) {\r\n        font.push('italic');\r\n    }\r\n    if (p.isBold) {\r\n        font.push('bold');\r\n    }\r\n    font.push(p.size + 'px ' + (p.font ? p.font : 'sans-serif'));\r\n    ctx.font = font.join(' ');\r\n    ctx.fillStyle = p.color ? p.color : '#000';\r\n\r\n    let x = p.x;\r\n    let y = p.y;\r\n    if (p.align === 'right') {\r\n        x += -bounds.x1 + bounds.x0;\r\n    }\r\n    if (p.align === 'center') {\r\n        x += (-bounds.x1 + bounds.x0) / 2;\r\n    }\r\n    ctx.translate(p.x, p.y);\r\n    ctx.rotate(p.angleRad ? -p.angleRad : 0);\r\n    ctx.translate(-p.x, -p.y);\r\n    ctx.translate(x, y);\r\n\r\n    // fill\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        let el = div.children[i] as HTMLElement;\r\n\r\n        //ctx.fillText(el.innerText, 0, 0);\r\n        ctx.fillText(el.innerText, el.offsetLeft, el.offsetTop);\r\n    }\r\n\r\n    if (p.isDebug) {\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeRect(0, -p.size * 0.85, bounds.x1, bounds.y1);\r\n        ctx.restore();\r\n        ctx.fillRect(p.x - 1, p.y - 1, 2, 2);\r\n    } else {\r\n        ctx.restore();\r\n    }\r\n\r\n    document.body.removeChild(outer);\r\n\r\n    return {\r\n        x: x - p.x,\r\n        y: y - p.y -p.size * 0.85,\r\n        width: bounds.x1 - bounds.x0,\r\n        height: bounds.y1 - bounds.y0\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IKlProject} from '../kl.types';\r\n\r\nexport function drawProject(project: IKlProject, factor) {\r\n    let resultCanvas = BB.canvas(\r\n        Math.max(1, Math.round(project.width * factor)),\r\n        Math.max(1, Math.round(project.height * factor))\r\n    );\r\n    let ctx = resultCanvas.getContext(\"2d\");\r\n    ctx.save();\r\n    if (factor > 1) {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n    for (let i = 0; i < project.layers.length; i++) {\r\n        if (project.layers[i].opacity === 0) {\r\n            continue;\r\n        }\r\n        ctx.globalAlpha = project.layers[i].opacity;\r\n        ctx.globalCompositeOperation = project.layers[i].mixModeStr ? project.layers[i].mixModeStr : 'source-over';\r\n        ctx.drawImage(project.layers[i].image, 0, 0, resultCanvas.width, resultCanvas.height);\r\n    }\r\n    ctx.restore();\r\n    return resultCanvas;\r\n}","import {IGradient} from '../kl.types';\r\nimport {BB} from '../../bb/bb';\r\n\r\n\r\ntype TOnGradient = (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n\r\n/**\r\n * Input processor for gradient tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n */\r\nexport class GradientTool {\r\n    private downX: number;\r\n    private downY: number;\r\n    private downAngleRad: number;\r\n    private onGradient: TOnGradient;\r\n\r\n    // ---- public ----\r\n    constructor(\r\n        p: {\r\n            onGradient: TOnGradient;\r\n        }\r\n    ) {\r\n        this.onGradient = p.onGradient;\r\n    }\r\n\r\n    onDown(x: number, y: number, angleRad: number): void {\r\n        this.downX = x;\r\n        this.downY = y;\r\n        this.downAngleRad = angleRad;\r\n    }\r\n\r\n    onMove(x: number, y: number): void {\r\n        this.onGradient(false, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n\r\n    onUp(x: number, y: number): void {\r\n        this.onGradient(true, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n}\r\n\r\nexport function drawGradient(\r\n    ctx: CanvasRenderingContext2D,\r\n    gradientObj: IGradient,\r\n): void {\r\n    ctx.save();\r\n\r\n    let x1 = gradientObj.x1;\r\n    let y1 = gradientObj.y1;\r\n    let x2 = gradientObj.x2;\r\n    let y2 = gradientObj.y2;\r\n\r\n    if (gradientObj.doSnap) {\r\n        const angleDeg = gradientObj.angleRad * 180 / Math.PI;\r\n\r\n        let r1 = BB.rotate(x1, y1, gradientObj.angleRad / Math.PI * 180);\r\n        let r2 = BB.rotate(x2, y2, gradientObj.angleRad / Math.PI * 180);\r\n\r\n        let pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n        let pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n        let rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n        x2 = rotated.x;\r\n        y2 = rotated.y;\r\n\r\n        // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n        if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n            if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                x2 = x1;\r\n            } else { // left or right\r\n                y2 = y1;\r\n            }\r\n        }\r\n    }\r\n\r\n    let baseColor = gradientObj.color1;\r\n    if (gradientObj.isEraser && gradientObj.doLockAlpha) {\r\n        baseColor = {r: 255, g: 255, b: 255};\r\n    }\r\n    let color1 = BB.copyObj(baseColor);\r\n    color1.a = gradientObj.opacity;\r\n    let color2 = BB.copyObj(baseColor);\r\n    color2.a = 0;\r\n    if (gradientObj.isReversed) {\r\n        const temp = color1;\r\n        color1 = color2;\r\n        color2 = temp;\r\n    }\r\n\r\n    let gradient;\r\n    if (gradientObj.type === 'linear') {\r\n        gradient = ctx.createLinearGradient(x1, y1, x2, y2);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n\r\n    } else if (gradientObj.type === 'linear-mirror') {\r\n        const d = {\r\n            x: x2 - x1,\r\n            y: y2 - y1,\r\n        };\r\n        gradient = ctx.createLinearGradient(x1 - d.x,y1 - d.y, x2, y2);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color2));\r\n        gradient.addColorStop(0.5, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n\r\n    } else if (gradientObj.type === 'radial') {\r\n        const r = BB.Vec2.dist(\r\n            {x: x1, y: y1},\r\n            {x: x2, y: y2},\r\n        );\r\n        gradient = ctx.createRadialGradient(x1, y1, 0, x1, y1, r);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n    }\r\n\r\n    ctx.fillStyle = gradient;\r\n    if (gradientObj.isEraser) {\r\n        ctx.globalCompositeOperation = 'destination-out';\r\n    }\r\n    if (gradientObj.doLockAlpha) {\r\n        ctx.globalCompositeOperation = 'source-atop';\r\n    }\r\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n\r\n    ctx.restore();\r\n}","import {IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {TTranslationCode} from '../../../languages/languages';\r\n\r\nexport function translateBlending(blendMode?: IMixMode): string {\r\n    if (!blendMode) {\r\n        return LANG('layers-blend-normal');\r\n    }\r\n\r\n    const codes: {\r\n        [key: string]: TTranslationCode\r\n    } = {\r\n        'source-over': 'layers-blend-normal',\r\n        'darken': 'layers-blend-darken',\r\n        'multiply': 'layers-blend-multiply',\r\n        'color-burn': 'layers-blend-color-burn',\r\n        'lighten': 'layers-blend-lighten',\r\n        'screen': 'layers-blend-screen',\r\n        'color-dodge': 'layers-blend-color-dodge',\r\n        'overlay': 'layers-blend-overlay',\r\n        'soft-light': 'layers-blend-soft-light',\r\n        'hard-light': 'layers-blend-hard-light',\r\n        'difference': 'layers-blend-difference',\r\n        'exclusion': 'layers-blend-exclusion',\r\n        'hue': 'layers-blend-hue',\r\n        'saturation': 'layers-blend-saturation',\r\n        'color': 'layers-blend-color',\r\n        'luminosity': 'layers-blend-luminosity',\r\n    };\r\n\r\n    if (!(blendMode in codes)) {\r\n        throw new Error('unknown blend mode');\r\n    }\r\n    return LANG(codes[blendMode]);\r\n}","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl.types';\r\n\r\n/**\r\n * Overlay for KlCanvasWorkspace.\r\n * - brush circle\r\n * - eyedropper circle\r\n * - compass needle (rotation hud)\r\n */\r\nexport class WorkspaceSvgOverlay {\r\n    private rootElement: SVGElement;\r\n    private brushCircleOuter: SVGElement;\r\n    private brushCircleInner: SVGElement;\r\n    private pickerPreviewBorder: SVGElement;\r\n    private pickerPreviewCol: SVGElement;\r\n    private readonly compassSize: number;\r\n    private compass: SVGElement;\r\n    private compassInner: SVGElement;\r\n    private compassBaseCircle: SVGElement;\r\n    private compassLineCircle: SVGElement;\r\n    private compassUpperTriangle: SVGElement;\r\n    private compassLowerTriangle: SVGElement;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n        }\r\n    ) {\r\n        this.rootElement = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + p.width,\r\n            height: '' + p.height,\r\n        });\r\n        BB.css(this.rootElement, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none',\r\n            userSelect: 'none'\r\n        });\r\n\r\n        //brush circles\r\n        this.brushCircleOuter = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '10',\r\n            stroke: 'rgba(0,0,0,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.brushCircleInner = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '9',\r\n            stroke: 'rgba(255,255,255,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\r\n\r\n        //color picker preview circle\r\n        this.pickerPreviewBorder = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '22',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewBorder.style.opacity = '0';\r\n        this.pickerPreviewCol = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '20',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewCol.style.opacity = '0';\r\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\r\n\r\n\r\n        //rotation compass\r\n        this.compassSize = 30;\r\n        this.compass = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\r\n        });\r\n        BB.css(this.compass, {\r\n            transition: 'opacity 0.25s ease-in-out',\r\n            opacity: '0',\r\n        });\r\n        this.compassInner = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'rotate(45)',\r\n        });\r\n        this.compassBaseCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'rgba(0,0,0,0.9)',\r\n            stroke: 'none',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + this.compassSize,\r\n        });\r\n        this.compassLineCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'none',\r\n            stroke: 'rgba(255,255,255,0.75)',\r\n            'stroke-width': '1',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + (this.compassSize * 0.9),\r\n        });\r\n        this.compassUpperTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#f00',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\r\n        });\r\n        this.compassLowerTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#fff',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\r\n        });\r\n\r\n        this.compassInner.append(\r\n            this.compassBaseCircle,\r\n            this.compassLineCircle,\r\n            this.compassUpperTriangle,\r\n            this.compassLowerTriangle\r\n        );\r\n        this.compass.append(this.compassInner);\r\n        this.rootElement.append(this.compass);\r\n    }\r\n\r\n    getElement (): SVGElement {\r\n        return this.rootElement;\r\n    }\r\n\r\n    setSize (width: number, height: number): void {\r\n        this.rootElement.setAttribute('width', '' + width);\r\n        this.rootElement.setAttribute('height', '' + height);\r\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\r\n    }\r\n\r\n    updateCursor (p: {\r\n        x?: number;\r\n        y?: number;\r\n        radius?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('x' in p) {\r\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\r\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\r\n        }\r\n        if ('y' in p) {\r\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\r\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\r\n        }\r\n        if ('radius' in p) {\r\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\r\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\r\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateColorPreview (p: {\r\n        x?: number;\r\n        y?: number;\r\n        color?: IRGB;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('x' in p) {\r\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\r\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\r\n        }\r\n        if ('y' in p) {\r\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\r\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\r\n        }\r\n        if ('color' in p) {\r\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\r\n            let borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\r\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\r\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateCompass (p: {\r\n        angleDeg?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('angleDeg' in p) {\r\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\r\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, ITransform} from '../kl.types';\r\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\r\nimport {klHistory} from '../history/kl-history';\r\n// @ts-ignore\r\nimport pickerImg from 'url:~/src/app/img/ui/cursor-picker.png';\r\n// @ts-ignore\r\nimport zoomEwImg from 'url:~/src/app/img/ui/cursor-zoom-ew.png';\r\n// @ts-ignore\r\nimport fillImg from 'url:~/src/app/img/ui/cursor-fill.png';\r\n// @ts-ignore\r\nimport textImg from 'url:~/src/app/img/ui/cursor-text.png';\r\nimport {IPressureInput, IVector2D} from '../../bb/bb.types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {KeyListener} from '../../bb/input/key-listener';\r\nimport {KL} from '../kl';\r\n\r\nexport interface IViewChangeEvent {\r\n    changed: ('scale' | 'angle')[];\r\n    angle: number;\r\n    scale: number;\r\n}\r\n\r\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'gradient' | 'text'; // | 'transform' | 'select'\r\n\r\nconst MIN_SCALE = 1 / 16;\r\nconst MAX_SCALE = 64;\r\nenum TMode {\r\n    Draw,\r\n    Hand,\r\n    HandGrabbing,\r\n    Pick,\r\n    Zoom,\r\n    Rotate,\r\n    Rotating,\r\n    Fill,\r\n    Gradient,\r\n    Text,\r\n    Shape,\r\n}\r\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\r\n\r\n/**\r\n * Work area that displays the KlCanvas.\r\n * - pan, zoom, rotate (also via multi-touch)\r\n * - input modes: drawing, hand, pick, fill, text // transform, select\r\n * - drawing input events\r\n * - view change events\r\n * - eyedropper input events (pick)\r\n * - draws cursor, eyedropper overlay\r\n *\r\n * subscribes to klCanvas changes\r\n * listens to kl history for changes\r\n * and you can manually trigger redraw\r\n */\r\nexport class KlCanvasWorkspace {\r\n\r\n    private rootEl: HTMLElement;\r\n    private klCanvas: KlCanvas;\r\n    private renderTargetCanvas: HTMLCanvasElement;\r\n    private renderTargetCtx: CanvasRenderingContext2D;\r\n    private renderWidth: number;\r\n    private renderHeight: number;\r\n    private compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\r\n    private compositeCtx: CanvasRenderingContext2D;\r\n    private doResizeCanvas: boolean;\r\n    private oldTransformObj: ITransform;\r\n    private targetTransformObj: ITransform; // animation target\r\n    private highResTransformObj: ITransform; // animated, internal high res\r\n    private renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\r\n    private cursorPos: IVector2D;\r\n    private usesCssCursor: boolean;\r\n    private bgVisible: boolean;\r\n    private transformIsDirty: boolean;\r\n    private doAnimateTranslate: boolean;\r\n    private svgOverlay: WorkspaceSvgOverlay;\r\n    private emptyCanvas: HTMLCanvasElement;\r\n    private keyListener: KeyListener;\r\n    private currentMode: TMode;\r\n    private globalMode: TMode;\r\n    private renderTime: number; // for debugging - average ms per render()\r\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\r\n    private linetoolProcessor: any; // todo type - BB.EventChain.LinetoolProcessor\r\n    private pointer: IVector2D | null; // position of cursor\r\n    private isDrawing: boolean;\r\n    private inputProcessorObj: any; // todo type\r\n    private currentInputProcessor: any; // todo type\r\n    private angleIsExtraSticky: boolean;\r\n    private pinchZoomer: any; // todo type - BB.EventChain.PinchZoomer\r\n    private mainDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\r\n    private middleDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\r\n    private twoFingerTap: any; // todo type - BB.EventChain.NFingerTapper\r\n    private threeFingerTap: any; // todo type - BB.EventChain.NFingerTapper\r\n    private pointerEventChain: any; // todo type - BB.EventChain.EventChain\r\n    private pointerListener: any; // todo type - BB.PointerListener\r\n    private brushRadius: number;\r\n    private animationFrameRequested: boolean;\r\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\r\n    private lastRenderTime: number; // ms from performance.now()\r\n    private hideBrushCursorTimeout: number;\r\n    private onViewChange: (e:  IViewChangeEvent) => void;\r\n\r\n    private getRenderedTransform (): ITransform {\r\n        // rounded x & y so canvas is less blurry.\r\n        const result = this.renderedTransformObj;\r\n        result.x = this.highResTransformObj.x;\r\n        result.y = this.highResTransformObj.y;\r\n        result.scale = this.highResTransformObj.scale;\r\n        result.angle = this.highResTransformObj.angle;\r\n\r\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\r\n            result.x = Math.round(result.x);\r\n            result.y = Math.round(result.y);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private updateChangeListener (): void {\r\n        this.klCanvas.addChangeListener(() => {\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n        });\r\n    }\r\n\r\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\r\n        if (modeInt === this.currentMode && !doForce) {\r\n            return;\r\n        }\r\n        const oldMode = this.currentMode;\r\n        this.currentMode = modeInt;\r\n        this.lastRenderedState = -1;\r\n        if (this.currentMode === TMode.Draw) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Hand) {\r\n            this.rootEl.style.cursor = 'grab';\r\n        } else if (this.currentMode === TMode.HandGrabbing) {\r\n            this.rootEl.style.cursor = 'grabbing';\r\n        } else if (this.currentMode === TMode.Pick) {\r\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\r\n        } else if (this.currentMode === TMode.Zoom) {\r\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\r\n        } else if (this.currentMode === TMode.Rotate) {\r\n            this.rootEl.style.cursor = \"grab\";\r\n        } else if (this.currentMode === TMode.Rotating) {\r\n            this.rootEl.style.cursor = \"grabbing\";\r\n        } else if (this.currentMode === TMode.Fill) {\r\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Gradient) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Text) {\r\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Shape) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        }\r\n\r\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\r\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\r\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\r\n            if (!oldIsHand && currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n            }\r\n            if (oldIsHand && !currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n            }\r\n        }\r\n\r\n        if (this.currentMode !== TMode.Pick) {\r\n            this.svgOverlay.updateColorPreview({isVisible: false});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * returns false if no change of zoom\r\n     * @param stepNum\r\n     * @param centerX\r\n     * @param centerY\r\n     * @private\r\n     */\r\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\r\n        const step = Math.log2(this.targetTransformObj.scale);\r\n\r\n        let newStep = step / Math.abs(stepNum);\r\n        newStep += stepNum > 0 ? 1 : -1;\r\n        newStep = Math.round(newStep);\r\n        newStep *= Math.abs(stepNum);\r\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\r\n\r\n        //has zoomed?\r\n        if (newScale === this.targetTransformObj.scale) {\r\n            return false;\r\n        }\r\n\r\n\r\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\r\n        this.targetTransformObj.scale = newScale;\r\n\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.transformIsDirty = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * mixes two transform objects. modifies A\r\n     * @param transformA\r\n     * @param transformB\r\n     * @param blendFactor 0 -> A, 1 -> B\r\n     * @private\r\n     */\r\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\r\n        if (transformA.angle === transformB.angle) {\r\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\r\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\r\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n            return;\r\n        }\r\n\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        // --- determine centerPosA, centerPosB ---\r\n        const centerPosA = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2\r\n        }, transformA);\r\n        const centerPosB = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2\r\n        }, transformB);\r\n\r\n        // --- centerPosMixed ---\r\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\r\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\r\n\r\n        // --- scale and angle ---\r\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n\r\n        // --- x and y ---\r\n        const mixedPos = this.canvasToWorkspaceCoord({\r\n            x: -w / 2,\r\n            y: -h / 2\r\n        }, transformA);\r\n        transformA.x = mixedPos.x;\r\n        transformA.y = mixedPos.y;\r\n    }\r\n\r\n    private render (): void {\r\n        if (this.doResizeCanvas) {\r\n            this.doResizeCanvas = false;\r\n            this.renderTargetCanvas.width = this.renderWidth;\r\n            this.renderTargetCanvas.height = this.renderHeight;\r\n        }\r\n        this.renderContext(this.renderTargetCtx);\r\n    }\r\n\r\n    /**\r\n     * is the gray background that surrounds canvas visible?\r\n     * @private\r\n     */\r\n    private testBgVisible (): boolean {\r\n        //bring workspace points (corners of workspace) into canvas coordinate system\r\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\r\n\r\n        const workspacePointArr = [\r\n            [0, 0], // top left\r\n            [this.renderWidth, 0], // top right\r\n            [this.renderWidth, this.renderHeight], // bottom right\r\n            [0, this.renderHeight], // bottom left\r\n        ];\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        //transform points, then test if outside of canvas\r\n        for (let i = 0; i < workspacePointArr.length; i++) {\r\n            let coords = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n            if (\r\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\r\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\r\n            ){\r\n                //if not inside -> bg visible\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private renderContext (ctx: CanvasRenderingContext2D): void {\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\r\n            ctx.imageSmoothingEnabled = false;\r\n        } else {\r\n            ctx.imageSmoothingEnabled = true;\r\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\r\n        }\r\n        //ctx.imageSmoothingEnabled = false;\r\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\r\n\r\n\r\n\r\n        ctx.save();\r\n        {\r\n            if (this.bgVisible) {\r\n                ctx.fillStyle = 'rgb(158,158,158)'; // 'rgb(185,185,185)';\r\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\r\n            } else {\r\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\r\n            }\r\n\r\n\r\n\r\n            if (this.bgVisible) {\r\n                ctx.save();\r\n\r\n                ctx.translate(art.x, art.y);\r\n                ctx.scale(art.scale, art.scale);\r\n                ctx.rotate(art.angle);\r\n\r\n                ctx.imageSmoothingEnabled = false;\r\n\r\n                //outline\r\n                const borderSize = 1;\r\n                ctx.globalAlpha = 0.2;\r\n                ctx.drawImage(\r\n                    this.emptyCanvas,\r\n                    -borderSize / art.scale,\r\n                    -borderSize / art.scale,\r\n                    w + borderSize * 2 / art.scale,\r\n                    h + borderSize * 2 / art.scale\r\n                );\r\n                ctx.globalAlpha = 1;\r\n\r\n                //erase\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\r\n\r\n                ctx.restore();\r\n            }\r\n\r\n            /*const region = new Path2D();\r\n            region.rect(80, 10, 20, 130);\r\n            ctx.clip(region);*/\r\n\r\n            ctx.translate(art.x, art.y);\r\n            ctx.scale(art.scale, art.scale);\r\n            ctx.rotate(art.angle);\r\n\r\n            const layerArr = this.klCanvas.getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    ctx.globalAlpha = layerArr[i].opacity;\r\n                    ctx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n\r\n                    if (layerArr[i].canvas.compositeObj) {\r\n                        if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\r\n                            this.compositeCanvas.width = layerArr[i].canvas.width;\r\n                            this.compositeCanvas.height = layerArr[i].canvas.height;\r\n                        } else {\r\n                            this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\r\n                        }\r\n                        this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\r\n                        layerArr[i].canvas.compositeObj.draw(this.compositeCtx);\r\n                        ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\r\n                    } else {\r\n                        ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\r\n                    }\r\n                }\r\n            }\r\n            ctx.globalAlpha = 1;\r\n\r\n\r\n\r\n        }\r\n        ctx.restore();\r\n\r\n        // rotation hud\r\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: true,\r\n                angleDeg: art.angle / Math.PI * 180\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: false\r\n            });\r\n        }\r\n    }\r\n\r\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\r\n        const art = this.getRenderedTransform();\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\r\n        let angleDeg = angleRad * 180 / Math.PI;\r\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\r\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\r\n\r\n        if (dist <= maxDistDeg) {\r\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\r\n        }\r\n\r\n        return angleDeg / 180 * Math.PI;\r\n    }\r\n\r\n    /**\r\n     * angle always in range [-PI, PI]\r\n     * @param angleRad\r\n     * @private\r\n     */\r\n    private minimizeAngleRad (angleRad: number): number {\r\n        angleRad = angleRad % (2 * Math.PI);\r\n        if (angleRad > Math.PI) {\r\n            angleRad -= 2 * Math.PI;\r\n        } else if (angleRad < -Math.PI) {\r\n            angleRad += 2 * Math.PI;\r\n        }\r\n        return angleRad;\r\n    }\r\n\r\n    private resetInputProcessor (): void {\r\n        this.currentInputProcessor = null;\r\n        this.updateCursor(this.globalMode);\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    private reqFrame (doRedrawCanvas?: boolean): void {\r\n        this.animationFrameRequested = true;\r\n        if (doRedrawCanvas) {\r\n            this.lastRenderedState = -1;\r\n        }\r\n    }\r\n\r\n    private updateLoop (): void {\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState;\r\n\r\n        //handle variable framerate\r\n        const nowTime = performance.now();\r\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\r\n        this.lastRenderTime = nowTime;\r\n\r\n        if (this.animationFrameRequested || doRender) {\r\n            this.animationFrameRequested = false;\r\n            this.checkChange(elapsedFrames);\r\n        }\r\n    }\r\n\r\n    private checkChange (elapsedFrames: number): void {\r\n\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState ||\r\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\r\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\r\n            this.highResTransformObj.y !== this.targetTransformObj.y;\r\n\r\n        //update transform\r\n        if (\r\n            !this.doAnimateTranslate &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else if (\r\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\r\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            this. doAnimateTranslate = false;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else {\r\n            this.reqFrame(); //probably needs another frame\r\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\r\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\r\n            this.bgVisible = true; // spare yourself the calculation\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        }\r\n\r\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\r\n            this.svgOverlay.updateCursor({\r\n                x: this.pointer.x,\r\n                y: this.pointer.y,\r\n                isVisible: true\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCursor({isVisible: false});\r\n        }\r\n\r\n\r\n        if (doRender) {\r\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\r\n            this.lastRenderedState = newState;\r\n            const start = performance.now();\r\n            this.render();\r\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\r\n        }\r\n        //setTimeout(this.checkChange, 100);\r\n\r\n\r\n\r\n        if (doRender) {\r\n\r\n            //console.log('rendertime ms: ', this.renderTime);\r\n        }\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            klCanvas: any; // todo\r\n            width: number;\r\n            height: number;\r\n            onDraw: (val) => void; // todo\r\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\r\n            onFill: (canvasX: number, canvasY: number) => void;\r\n            onGradient: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onViewChange: (e:  IViewChangeEvent) => void;\r\n            onUndo: () => void;\r\n            onRedo: () => void;\r\n        }\r\n    ) {\r\n        const _this = this;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                right: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                cursor: 'crosshair',\r\n                userSelect: 'none',\r\n                colorScheme: 'only light',\r\n            }\r\n        });\r\n        this.klCanvas = p.klCanvas;\r\n        this.onViewChange = p.onViewChange;\r\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\r\n        this.renderTargetCtx = this.renderTargetCanvas.getContext('2d');\r\n        this.renderWidth = p.width;\r\n        this.renderHeight = p.height;\r\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\r\n        this.compositeCtx = this.compositeCanvas.getContext('2d');\r\n        this.doResizeCanvas = false;\r\n        this.oldTransformObj = null;\r\n        this.targetTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0\r\n        };\r\n        this.highResTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0\r\n        };\r\n        this.renderedTransformObj = {\r\n            x: null,\r\n            y: null,\r\n            scale: null,\r\n            angle: null\r\n        };\r\n        this.cursorPos = {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n        this.usesCssCursor = false;\r\n        this.bgVisible = true;\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n\r\n        this.svgOverlay = new WorkspaceSvgOverlay({\r\n            width: p.width,\r\n            height: p.height\r\n        });\r\n\r\n        BB.css(this.renderTargetCanvas, {\r\n            userSelect: 'none',\r\n            pointerEvents: 'none',\r\n        });\r\n        BB.createCheckerDataUrl(8, (url) => {\r\n            this.renderTargetCanvas.style.background = \"url(\" + url + \")\";\r\n        });\r\n        this.rootEl.appendChild(this.renderTargetCanvas);\r\n        this.rootEl.appendChild(this.svgOverlay.getElement());\r\n        BB.addEventListener(this.rootEl, 'touchend', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        BB.addEventListener(this.rootEl, 'contextmenu', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        BB.addEventListener(this.rootEl, 'dragstart', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n\r\n        this.emptyCanvas = BB.canvas(1, 1);\r\n        {\r\n            const ctx = this.emptyCanvas.getContext('2d');\r\n            ctx.fillRect(0, 0, 1, 1);\r\n        }\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n                if (isRepeat) {\r\n                    return;\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n\r\n                } else {\r\n\r\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if (['r', 'shift+r'].includes(comboStr)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ('z' === comboStr) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                }\r\n\r\n            },\r\n            onUp: (keyStr, event, oldComboStr) => {\r\n                // prevent menu bar in Firefox\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.currentMode = TMode.Draw;\r\n        this.globalMode = TMode.Draw;\r\n\r\n        this.renderTime = 0;\r\n\r\n        this.lastDrawEvent = null;\r\n\r\n        this.linetoolProcessor = new BB.EventChain.LinetoolProcessor({\r\n            onDraw: (event) => {\r\n                const getMatrix = () => {\r\n                    const art = this.getRenderedTransform();\r\n                    let matrix = BB.Matrix.getIdentity();\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n                    return matrix;\r\n                };\r\n\r\n                if (event.type === 'line' && !this.lastDrawEvent) {\r\n                    const matrix = getMatrix();\r\n                    let coords = [event.x1, event.y1, 0, 1];\r\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                    this.lastDrawEvent = {\r\n                        x: coords[0],\r\n                        y: coords[1],\r\n                        pressure: event.pressure1\r\n                    };\r\n                    return;\r\n                }\r\n\r\n                if ('x' in event || 'x0' in event) {\r\n\r\n                    const matrix = getMatrix();\r\n\r\n                    if ('x' in event) { //down or move\r\n                        let coords = [event.x, event.y, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x = coords[0];\r\n                        event.y = coords[1];\r\n                    }\r\n                    if ('x0' in event) { //line\r\n                        event.x0 = this.lastDrawEvent.x;\r\n                        event.y0 = this.lastDrawEvent.y;\r\n                        event.pressure0 = this.lastDrawEvent.pressure;\r\n                        let coords = [event.x1, event.y1, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x1 = coords[0];\r\n                        event.y1 = coords[1];\r\n\r\n                        this.lastDrawEvent = {\r\n                            x: event.x1,\r\n                            y: event.y1,\r\n                            pressure: event.pressure1,\r\n                        };\r\n                    }\r\n                }\r\n\r\n\r\n                if (['down', 'move'].includes(event.type)) {\r\n                    this.lastDrawEvent = event;\r\n                }\r\n                p.onDraw(event);\r\n            }\r\n        });\r\n\r\n        this.pointer = null;\r\n        this.isDrawing = false;\r\n\r\n\r\n        this.inputProcessorObj = {\r\n            draw: {\r\n                onPointer: (val) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Draw);\r\n\r\n                    const comboStr = this.keyListener.getComboStr();\r\n\r\n                    const event: any = {\r\n                        scale: this.highResTransformObj.scale\r\n                    };\r\n                    event.shiftIsPressed = comboStr === 'shift';\r\n                    event.pressure = val.pressure;\r\n                    event.isCoalesced = !!val.isCoalesced;\r\n\r\n                    if (val.type === 'pointerdown') {\r\n\r\n                        this.isDrawing = true;\r\n                        event.type = 'down';\r\n\r\n                    } else if (val.button) {\r\n                        event.type = 'move';\r\n\r\n                    } else if (val.type === 'pointerup') {\r\n\r\n                        this.isDrawing = false;\r\n                        event.type = 'up';\r\n\r\n                        this.linetoolProcessor.process(event);\r\n                        this.resetInputProcessor();\r\n                        return;\r\n                    } else {\r\n                        return;\r\n                    }\r\n\r\n                    event.x = val.relX;\r\n                    event.y = val.relY;\r\n\r\n                    this.linetoolProcessor.process(event);\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            fill: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Fill);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            gradient: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Gradient);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onGradient('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onGradient('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onGradient('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            text: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Text);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            shape: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Shape);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            hand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            spaceHand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'space') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            zoom: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Zoom);\r\n\r\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n\r\n                        this.internalZoomByStep(event.dX / 175, event.downPageX - offsetX, event.downPageY - offsetY);\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'z') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Zoom);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            picker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup'\r\n                        });\r\n\r\n                        if (event.type === 'pointerup') {\r\n                            this.resetInputProcessor();\r\n                        }\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            altPicker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup'\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'alt') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            rotate: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\r\n\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n                        //rotation done around center\r\n                        const centerObj = {\r\n                            x: this.renderWidth / 2,\r\n                            y: this.renderHeight / 2\r\n                        };\r\n\r\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX - offsetX, y: event.downPageY - offsetY});\r\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\r\n                        let dAngleRad = angleRad - startAngleRad;\r\n\r\n                        //apply angle\r\n                        this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\r\n                        this.targetTransformObj.angle += dAngleRad;\r\n\r\n                        if (this.keyListener.isPressed('shift')) {\r\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\r\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n                        }\r\n\r\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\r\n\r\n                        //rotate transform.xy\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n\r\n                        this.transformIsDirty = true;\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['angle'],\r\n                            scale: this.targetTransformObj.scale,\r\n                            angle: this.targetTransformObj.angle\r\n                        });\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    const comboStr = this.keyListener.getComboStr();\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        this.currentInputProcessor = null;\r\n\r\n\r\n        this.angleIsExtraSticky = false;\r\n        this.pinchZoomer = new BB.EventChain.PinchZoomer({\r\n            onPinch: (event) => {\r\n\r\n                if (event.type === 'move') {\r\n\r\n                    if (!this.oldTransformObj) {\r\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\r\n                    }\r\n\r\n                    this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\r\n\r\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\r\n\r\n                    this.targetTransformObj.scale *= event.scale;\r\n                    this.targetTransformObj.angle += event.angleRad;\r\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\r\n                        this.snapAngleRad(\r\n                            this.targetTransformObj.angle,\r\n                            90,\r\n                            this.angleIsExtraSticky ? 12 : 4\r\n                        )\r\n                    );\r\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\r\n                        this.angleIsExtraSticky = false;\r\n                    }\r\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\r\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n\r\n                    //calc translation\r\n                    {\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\r\n\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                    }\r\n\r\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n\r\n                    //if (event.scale !== 1) {\r\n                    this.onViewChange({\r\n                        changed: ['scale', 'angle'],\r\n                        scale: this.targetTransformObj.scale,\r\n                        angle: this.targetTransformObj.angle\r\n                    });\r\n                    //}\r\n                    this.reqFrame();\r\n                    this.transformIsDirty = true;\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                } else if (event.type === 'end') {\r\n                    this.oldTransformObj = null;\r\n                }\r\n\r\n\r\n            }\r\n        });\r\n\r\n        const onDoubleTap = () => {\r\n            let oldTransform = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n            _this.fitView();\r\n            //_this.resetView(true);\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n\r\n            if (\r\n                oldTransform.scale !== this.targetTransformObj.scale ||\r\n                oldTransform.angle !== this.targetTransformObj.angle\r\n            ) {\r\n                this.onViewChange({\r\n                    changed: ['scale', 'angle'],\r\n                    angle: this.targetTransformObj.angle,\r\n                    scale: this.targetTransformObj.scale\r\n                });\r\n            }\r\n        }\r\n\r\n        this.mainDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\r\n\r\n\r\n        this.twoFingerTap = new BB.EventChain.NFingerTapper({\r\n            fingers: 2,\r\n            onTap: () => {\r\n                p.onUndo();\r\n            }\r\n        });\r\n        this.threeFingerTap = new BB.EventChain.NFingerTapper({\r\n            fingers: 3,\r\n            onTap: () => {\r\n                p.onRedo();\r\n            }\r\n        });\r\n\r\n\r\n        this.pointerEventChain = new BB.EventChain.EventChain({\r\n            chainArr: [\r\n                this.twoFingerTap,\r\n                this.threeFingerTap,\r\n                this.mainDoubleTapper,\r\n                this.middleDoubleTapper,\r\n                this.pinchZoomer,\r\n                new BB.EventChain.OnePointerLimiter(),\r\n                new BB.EventChain.CoalescedExploder()\r\n            ]\r\n        });\r\n        this.pointerEventChain.setChainOut((event) => {\r\n\r\n            this.cursorPos.x = event.relX;\r\n            this.cursorPos.y = event.relY;\r\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\r\n                this.pointer = null;\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                if (!this.pointer) {\r\n                    this.pointer = { x: 0, y: 0 };\r\n                }\r\n                this.pointer.x = event.relX;\r\n                this.pointer.y = event.relY;\r\n            }\r\n\r\n            if (this.currentInputProcessor) {\r\n                this.currentInputProcessor.onPointer(event);\r\n\r\n            } else {\r\n\r\n                let comboStr = this.keyListener.getComboStr();\r\n\r\n                if (this.globalMode === TMode.Draw) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Draw);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Hand) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Pick) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Fill) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Fill);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Gradient) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.gradient;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Gradient);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Text) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.text;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Text);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Shape) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Shape);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        });\r\n\r\n        //prevent ctrl scroll -> zooming page\r\n        BB.addEventListener(this.rootEl, 'wheel', (event) => {\r\n            event.preventDefault();\r\n        });\r\n\r\n\r\n        setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.rootEl,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\r\n                        try {\r\n                            e.eventPreventDefault();\r\n                        } catch (e) {}\r\n                    }\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    if (e.type === 'pointerdown') {\r\n                        BB.unfocusAnyInput();\r\n                    }\r\n                    /*if (e.type === 'pointermove') {\r\n                        BB.throwOut(JSON.stringify(e));\r\n                    }*/\r\n\r\n                    this.pointerEventChain.chainIn(e)\r\n                },\r\n                onWheel: (wheelEvent) => {\r\n\r\n                    if (this.isDrawing) {\r\n                        return;\r\n                    }\r\n\r\n                    this.reqFrame();\r\n                    let didZoom = this.internalZoomByStep(\r\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\r\n                        wheelEvent.relX,\r\n                        wheelEvent.relY\r\n                    );\r\n                    if (didZoom) {\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale\r\n                        });\r\n                    }\r\n\r\n                    //updateCursor(TMode.Draw, true);\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                },\r\n                onEnterLeave: (isOver) => {\r\n                    if (!isOver) {\r\n                        if (!this.isDrawing) {\r\n                            this.pointer = null;\r\n                            this.lastRenderedState = -1;\r\n                        }\r\n                    }\r\n                },\r\n                maxPointers: 4\r\n            });\r\n        }, 1);\r\n\r\n        this.brushRadius = 1;\r\n\r\n        this.animationFrameRequested = false;\r\n\r\n\r\n\r\n\r\n        //setup rendering\r\n        this.lastRenderedState = -2;\r\n        this.lastRenderTime = performance.now();\r\n\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n\r\n        this.resetView();\r\n    }\r\n\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setCanvas (klC: KlCanvas): void {\r\n        this.klCanvas = klC;\r\n        this.lastDrawEvent = null;\r\n        this.resetView();\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    /**\r\n     * set size of workspace area in pixels\r\n     * @param width\r\n     * @param height\r\n     */\r\n    setSize (width: number, height: number): void {\r\n        const oldWidth = this.renderWidth;\r\n        const oldHeight = this.renderHeight;\r\n\r\n        if (width === oldWidth && height === oldHeight) {\r\n            return;\r\n        }\r\n\r\n        this.doResizeCanvas = true;\r\n        this.renderWidth = width;\r\n        this.renderHeight = height;\r\n\r\n        this.svgOverlay.setSize(width, height);\r\n\r\n        this.targetTransformObj.x += (width - oldWidth) / 2;\r\n        this.targetTransformObj.y += (height - oldHeight) / 2;\r\n\r\n        this.highResTransformObj.x = this.targetTransformObj.x;\r\n        this.highResTransformObj.y = this.targetTransformObj.y;\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setMode (modeStr: TModeStr): void {\r\n        //only sets the base mode\r\n        if (modeStr === 'draw') {\r\n            this.globalMode = TMode.Draw;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'fill') {\r\n            this.globalMode = TMode.Fill;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'gradient') {\r\n            this.globalMode = TMode.Gradient;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'text') {\r\n            this.globalMode = TMode.Text;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'shape') {\r\n            this.globalMode = TMode.Shape;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'hand') {\r\n            this.globalMode = TMode.Hand;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n        }\r\n        if (modeStr === 'pick') {\r\n            this.globalMode = TMode.Pick;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n    }\r\n\r\n    getMode(): TModeStr {\r\n        if (this.globalMode === TMode.Draw) {\r\n            return 'draw';\r\n        }\r\n        if (this.globalMode === TMode.Fill) {\r\n            return 'fill';\r\n        }\r\n        if (this.globalMode === TMode.Gradient) {\r\n            return 'gradient';\r\n        }\r\n        if (this.globalMode === TMode.Text) {\r\n            return 'text';\r\n        }\r\n        if (this.globalMode === TMode.Shape) {\r\n            return 'shape';\r\n        }\r\n        if (this.globalMode === TMode.Hand) {\r\n            return 'hand';\r\n        }\r\n        if (this.globalMode === TMode.Pick) {\r\n            return 'pick';\r\n        }\r\n    }\r\n\r\n    setEnabled (b: boolean): void {\r\n        // todo\r\n    }\r\n\r\n    setCursorSize (diameter: number): void {\r\n        this.brushRadius = diameter / 2;\r\n\r\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n\r\n        if (this.pointer === null) {\r\n            clearTimeout(this.hideBrushCursorTimeout);\r\n\r\n            this.svgOverlay.updateCursor({\r\n                x: this.renderWidth / 2,\r\n                y: this.renderHeight / 2,\r\n                isVisible: true\r\n            });\r\n\r\n            // @ts-ignore\r\n            this.hideBrushCursorTimeout = setTimeout(() => {\r\n                if (this.pointer !== null) {\r\n                    return;\r\n                }\r\n                this.svgOverlay.updateCursor({isVisible: false});\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    zoomByStep (stepNum: number): void {\r\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\r\n            return;\r\n        }\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale'],\r\n            angle: this.targetTransformObj.angle,\r\n            scale: this.targetTransformObj.scale\r\n        });\r\n    }\r\n\r\n    resetView (doAnimate?: boolean): void {\r\n        this.targetTransformObj.scale = 1;\r\n        this.targetTransformObj.angle = 0;\r\n\r\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\r\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\r\n\r\n        if (!doAnimate) {\r\n            this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n        } else {\r\n            this.doAnimateTranslate = true;\r\n            this.transformIsDirty = true;\r\n        }\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n        this.reqFrame();\r\n\r\n        if (doAnimate) {\r\n            this.onViewChange({\r\n                changed: ['scale', 'angle'],\r\n                scale: this.targetTransformObj.scale,\r\n                angle: this.targetTransformObj.angle\r\n            });\r\n        }\r\n    }\r\n\r\n    fitView (): void {\r\n        //fit into view. center. snap angle. margin of 10px\r\n\r\n        this.targetTransformObj.angle = this.snapAngleRad(this.targetTransformObj.angle, 90, 90);\r\n\r\n        //calc width and height of bounds\r\n        const canvasPointsArr = [\r\n            [0, 0], // top left\r\n            [this.klCanvas.getWidth(), 0], // top right\r\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\r\n            [0, this.klCanvas.getHeight()], // bottom left\r\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\r\n        ];\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle));\r\n\r\n        //rotate points\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            let coords = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n            canvasPointsArr[i][0] = coords[0];\r\n            canvasPointsArr[i][1] = coords[1];\r\n        }\r\n\r\n        const boundsObj = {\r\n            x0: null,\r\n            y0: null,\r\n            x1: null,\r\n            y1: null\r\n        };\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            if (boundsObj.x0 === null || canvasPointsArr[i][0] < boundsObj.x0) {\r\n                boundsObj.x0 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y0 === null || canvasPointsArr[i][1] < boundsObj.y0) {\r\n                boundsObj.y0 = canvasPointsArr[i][1];\r\n            }\r\n            if (boundsObj.x1 === null || canvasPointsArr[i][0] > boundsObj.x1) {\r\n                boundsObj.x1 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y1 === null || canvasPointsArr[i][1] > boundsObj.y1) {\r\n                boundsObj.y1 = canvasPointsArr[i][1];\r\n            }\r\n        }\r\n        const boundsWidth = boundsObj.x1 - boundsObj.x0;\r\n        const boundsHeight = boundsObj.y1 - boundsObj.y0;\r\n\r\n        //fit bounds\r\n        const padding = 40;\r\n        const { width: fitWidth } = BB.fitInto(\r\n            boundsWidth,\r\n            boundsHeight, \r\n            this.renderWidth - padding, \r\n            this.renderHeight - padding, \r\n            1\r\n        );\r\n\r\n        //determine scale\r\n        const factor = fitWidth / boundsWidth;\r\n\r\n        //center\r\n        this.targetTransformObj.x = (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor;\r\n        this.targetTransformObj.y = (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor;\r\n\r\n        this.targetTransformObj.scale = factor;\r\n        this.doAnimateTranslate = true;\r\n        this.transformIsDirty = true;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale', 'angle'],\r\n            scale: this.targetTransformObj.scale,\r\n            angle: this.targetTransformObj.angle\r\n        });\r\n    }\r\n\r\n    setAngle (angleDeg: number, isRelative?: boolean): void {\r\n        //rotation done around center\r\n        const centerObj = {\r\n            x: this.renderWidth / 2,\r\n            y: this.renderHeight / 2\r\n        };\r\n\r\n        const oldAngleRad = this.targetTransformObj.angle;\r\n        const angleRad = angleDeg / 180 * Math.PI;\r\n\r\n        if (isRelative) {\r\n            this.targetTransformObj.angle += angleRad;\r\n        } else {\r\n            this.targetTransformObj.angle = angleRad;\r\n        }\r\n\r\n        this.targetTransformObj.angle = this.minimizeAngleRad(\r\n            this.snapAngleRad(\r\n                this.targetTransformObj.angle,\r\n                90,\r\n                4\r\n            )\r\n        );\r\n\r\n        //rotate transform.xy\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n        this.transformIsDirty = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    /**\r\n     * translate canvas by viewport pixels\r\n     * @param tx\r\n     * @param ty\r\n     */\r\n    translateView (tx: number, ty: number): void {\r\n        const scale = 40;\r\n\r\n        this.targetTransformObj.x += tx * scale;\r\n        this.targetTransformObj.y += ty * scale;\r\n\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    getScale (): number {\r\n        return this.targetTransformObj.scale;\r\n    }\r\n\r\n    getAngleDeg (): number {\r\n        return this.targetTransformObj.angle * 180 / Math.PI;\r\n    }\r\n\r\n    getMaxScale (): number {\r\n        return MAX_SCALE;\r\n    }\r\n\r\n    getMinScale (): number {\r\n        return MIN_SCALE;\r\n    }\r\n\r\n    requestFrame (): void {\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setLastDrawEvent (x: number | null, y?: number, pressure?: number): void {\r\n        if (x === null) {\r\n            this.lastDrawEvent = null;\r\n            return;\r\n        }\r\n\r\n        if (!this.lastDrawEvent) {\r\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\r\n        }\r\n        this.lastDrawEvent.x = x;\r\n        this.lastDrawEvent.y = y;\r\n        this.lastDrawEvent.pressure = pressure;\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1dLwT\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"9wZxU\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hQSEH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"916ZI\");","import {BB} from '../../bb/bb';\r\nimport {IKlBasicLayer} from '../kl.types';\r\n\r\n/**\r\n * preview of image with layers. can do mix modes and opacity.\r\n * creates a canvas.\r\n *\r\n * p = {\r\n *     width: 123,\r\n *     height: 123,\r\n *     layers: [// can be changed after the fact\r\n *         {\r\n *             image: Canvas,\r\n *             opacity: 1,\r\n *             mixModeStr: 'source-over'\r\n *         }\r\n *     ]\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function KlCanvasPreview(\r\n    p: {\r\n        width: number;\r\n        height: number;\r\n        layers: IKlBasicLayer[];\r\n    }\r\n) {\r\n    const scale = p.width / p.layers[0].image.width;\r\n    const width = scale > 1 ? p.layers[0].image.width : p.width;\r\n    const height = scale > 1 ? p.layers[0].image.height : p.height;\r\n\r\n    let canvas = BB.canvas(width, height);\r\n    canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8) + ')';\r\n    let ctx = canvas.getContext('2d');\r\n\r\n    BB.css(canvas, {\r\n        width: '100%',\r\n        height: '100%',\r\n        imageRendering: scale > 1 ? 'pixelated' : null,\r\n    });\r\n\r\n    function render() {\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        for (let i = 0; i < p.layers.length; i++) {\r\n            ctx.globalAlpha = p.layers[i].opacity;\r\n            ctx.globalCompositeOperation = p.layers[i].mixModeStr;\r\n            if (canvas.width > p.layers[i].image.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(p.layers[i].image, 0, 0, canvas.width, canvas.height);\r\n        }\r\n        ctx.restore();\r\n    }\r\n\r\n    setTimeout(render, 0);\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return canvas;\r\n    };\r\n\r\n    this.render = function() {\r\n        render();\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/cursor-rotate.png';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {IVector2D} from '../../../bb/bb.types';\r\n\r\nexport interface ITransform {\r\n    x: number; // center of transform region. image space\r\n    y: number;\r\n    width: number; // size of transform region. image space\r\n    height: number;\r\n    angleDeg: number; // angle of transform region. degrees\r\n}\r\n\r\n\r\n/**\r\n * snap entire transform to pixel grid. changes transform\r\n *\r\n * for x y:\r\n * If a dimension has an even size, it be an integer.\r\n * If it's uneven, it's sits exactly half way between two pixels.\r\n *\r\n * @param transform\r\n */\r\nfunction snapToPixel(transform: ITransform): void {\r\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\r\n        return;\r\n    }\r\n\r\n    transform.width = Math.round(transform.width);\r\n    transform.height = Math.round(transform.height);\r\n    // 0° is original orientation.\r\n    // At 90° and 270° width and height become swapped due to different orientation.\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\r\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\r\n}\r\n\r\nfunction copyTransform(transform: ITransform): ITransform {\r\n    return {\r\n        x: transform.x,\r\n        y: transform.y,\r\n        width: transform.width,\r\n        height: transform.height,\r\n        angleDeg: transform.angleDeg,\r\n    };\r\n}\r\n\r\n/**\r\n * image space to transform space\r\n * - origin of transform space is at center of transform bounds.\r\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\r\n * - up is where transform points up\r\n * - x goes right\r\n * - y goes down\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nfunction toTransformSpace (x: number, y: number, transform: ITransform): IVector2D {\r\n    let px, py;\r\n    px = x - transform.x;\r\n    py = y - transform.y;\r\n\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: px, y: py},\r\n        -transform.angleDeg);\r\n    px = rot.x;\r\n    py = rot.y;\r\n\r\n    return {\r\n        x: px,\r\n        y: py,\r\n    };\r\n}\r\n\r\n/**\r\n * transform space to image space\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nfunction toImageSpace(x: number, y: number, transform: ITransform): IVector2D {\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: x, y: y},\r\n        transform.angleDeg);\r\n    return {\r\n        x: rot.x + transform.x,\r\n        y: rot.y + transform.y,\r\n    };\r\n}\r\n\r\n\r\n\r\n/**\r\n * Free Transform UI\r\n * rotate, scale, translate\r\n *\r\n * - if rotation is multiple of 90° it will snap to pixels, to be more useful for pixel art\r\n * - when rotation goes from non-multiple of 90° to a multiple, it will snap position and width height to pixels\r\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\r\n *      - this is what complicates things\r\n * - if transform region small, corner grips move out of the way\r\n *\r\n * iX iY, iP.x, iP.y - i indicates image space\r\n * tX tY, tP.x, tP.y - t indicates transform space\r\n *\r\n * Not sure if can be used for navigable canvas. (especially if canvas rotates view)\r\n * Probably can't be extended for distort. Needs a different approach.\r\n *\r\n * --- DOM structure ---\r\n * rootEl {\r\n * \ttransEl [\r\n * \t\tboundsEl\r\n * \t\tedges[]\r\n * \t\tcorners[] - round grips in the corner of transform region\r\n * \t\tangleGrip\r\n * \t]\r\n * }\r\n *\r\n */\r\nexport class FreeTransform {\r\n\r\n    // --- private ---\r\n    private readonly transform: ITransform; // coordinates and dimensions of transformation\r\n    private isConstrained: boolean;\r\n    private ratio: number; // aspect ratio of transform\r\n    private readonly scale: number;\r\n    private readonly scaled = { // scaled coordinates and dimensions for screenspace\r\n        x: 0,\r\n        y: 0,\r\n        width: 0,\r\n        height: 0,\r\n        corners: [{x: 0, y: 0}], // in transform space\r\n    };\r\n    private readonly minSnapDist = 7; // minimal snapping distance in px screenspace\r\n    private snappingEnabled: boolean;\r\n    private readonly snapX: number[];\r\n    private readonly snapY: number[];\r\n    private readonly callback: (transform: ITransform) => void;\r\n\r\n\r\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n    private readonly gripSize = 14;\r\n    private readonly edgeSize = 10;\r\n\r\n    private readonly rootEl: HTMLElement; // sits at origin of image\r\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\r\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\r\n    private readonly corners: {\r\n        i: number; // index in corners array\r\n        el: HTMLElement; // draggable corner circle in DOM\r\n        x: number; // unscaled position (transform space)\r\n        y: number;\r\n        virtualPos: IVector2D; // unscaled temporary position (image space)\r\n        updateDOM: () => void; // update styling in DOM\r\n        pointerListener: any;\r\n    }[] = [];\r\n    private keyListener: KeyListener;\r\n    private boundsPointerListener: any; // BB.PointerListener\r\n    private anglePointerListener: any; // BB.PointerListener\r\n    private readonly edges: { // derive position from corners\r\n        el: HTMLElement;\r\n        updateDOM: () => void;\r\n        pointerListener: any;\r\n    }[] = [];\r\n    private readonly angleGrip: {\r\n        el: HTMLElement,\r\n        x: number; // transform space\r\n        y: number;\r\n        snap: boolean,\r\n        updateDOM: () => void,\r\n    };\r\n\r\n    private updateScaled(): void {\r\n        this.scaled.x = this.transform.x * this.scale;\r\n        this.scaled.y = this.transform.y * this.scale;\r\n        this.scaled.width = this.transform.width * this.scale;\r\n        this.scaled.height = this.transform.height * this.scale;\r\n        this.scaled.corners = this.corners.map((item) => {\r\n            return {x: item.x * this.scale, y: item.y * this.scale};\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\r\n     * both in image space\r\n     *\r\n     * @param iX - image space\r\n     * @param iY - image space\r\n     * @private\r\n     */\r\n    private snapCorner (iX: number, iY: number): IVector2D {\r\n        if (!this.snappingEnabled) {\r\n            return {x: iX, y: iY};\r\n        }\r\n        let dist: number;\r\n        const snap: {\r\n            x: number;\r\n            y: number;\r\n            dist: {\r\n                x: number;\r\n                y: number;\r\n            }\r\n        } = {\r\n            x: null,\r\n            y: null,\r\n            dist: {\r\n                x: null,\r\n                y: null,\r\n            }\r\n        };\r\n        for (let e = 0; e < this.snapX.length; e++) {\r\n            dist = Math.abs(iX - this.snapX[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.x === null || dist < snap.dist.x) {\r\n                    snap.x = this.snapX[e];\r\n                    snap.dist.x = dist;\r\n                }\r\n            }\r\n        }\r\n        for (let e = 0; e < this.snapY.length; e++) {\r\n            dist = Math.abs(iY - this.snapY[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.y === null || dist < snap.dist.y) {\r\n                    snap.y = this.snapY[e];\r\n                    snap.dist.y = dist;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (snap.x === null && snap.y === null) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        return {\r\n            x: snap.x ?? iX,\r\n            y: snap.y ?? iY,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * If constrained return nearest corner pos that fits aspect ratio\r\n     *\r\n     * @param cornerIndex\r\n     * @param iX\r\n     * @param iY\r\n     * @private\r\n     */\r\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\r\n        if (!this.isConstrained) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        const flip = this.transform.width * this.transform.height < 0 ? -1 : 1;\r\n        return BB.projectPointOnLine(\r\n            {x: this.transform.x, y: this.transform.y},\r\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.transform),\r\n            {x: iX, y: iY}\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update corners according to width height.\r\n     * Not their DOM.\r\n     */\r\n    private updateCornerPositions (): void {\r\n        this.corners[0].x = (-this.transform.width / 2); // top left\r\n        this.corners[0].y = (-this.transform.height / 2);\r\n\r\n        this.corners[1].x = (this.transform.width / 2); // top right\r\n        this.corners[1].y = (-this.transform.height / 2);\r\n\r\n        this.corners[2].x = (this.transform.width / 2); // bottom right\r\n        this.corners[2].y = (this.transform.height / 2);\r\n\r\n        this.corners[3].x = (-this.transform.width / 2); // bottom left\r\n        this.corners[3].y = (this.transform.height / 2);\r\n    }\r\n\r\n    /**\r\n     * If constrained and dragging an edge, restore aspect ratio\r\n     * Updates corner positions.\r\n     *\r\n     * @param widthChanged\r\n     * @param heightChanged\r\n     * @private\r\n     */\r\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\r\n        if (!this.isConstrained) {\r\n            return;\r\n        }\r\n        const angle90 = Math.abs(this.transform.angleDeg) % 90 === 0;\r\n        const whSwapped = Math.abs(this.transform.angleDeg - 90) % 180 === 0;\r\n        if (heightChanged && !widthChanged) {\r\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\r\n            let newWidth = this.ratio * newHeight;\r\n            if (angle90) {\r\n                newWidth = (whSwapped ? this.transform.y % 1 : this.transform.x % 1) === 0 ?\r\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\r\n            }\r\n            if (this.corners[1].x - this.corners[0].x < 0) {\r\n                newWidth *= -1;\r\n            }\r\n            this.corners[0].x = -newWidth / 2;\r\n            this.corners[3].x = -newWidth / 2;\r\n            this.corners[1].x = newWidth / 2;\r\n            this.corners[2].x = newWidth / 2;\r\n        }\r\n        if (!heightChanged && widthChanged) {\r\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\r\n            let newHeight = newWidth / this.ratio;\r\n            if (angle90) {\r\n                newHeight = (whSwapped ? this.transform.x % 1 : this.transform.y % 1) === 0  ?\r\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\r\n            }\r\n            if (this.corners[3].y - this.corners[0].y < 0) {\r\n                newHeight *= -1;\r\n            }\r\n            this.corners[0].y = -newHeight / 2;\r\n            this.corners[1].y = -newHeight / 2;\r\n            this.corners[2].y = newHeight / 2;\r\n            this.corners[3].y = newHeight / 2;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * update transform based on corners\r\n     * @private\r\n     */\r\n    private updateTransformViaCorners (): void {\r\n\r\n        // calc transform center in image space\r\n        const rot = BB.rotateAround(\r\n            {x: 0, y: 0},\r\n            {\r\n                x: (this.corners[0].x + this.corners[1].x) / 2,\r\n                y: (this.corners[0].y + this.corners[3].y) / 2,\r\n            },\r\n            this.transform.angleDeg\r\n        );\r\n        this.transform.x = rot.x + this.transform.x;\r\n        this.transform.y = rot.y + this.transform.y;\r\n\r\n        // update size\r\n        this.transform.width = this.corners[1].x - this.corners[0].x;\r\n        this.transform.height = this.corners[3].y - this.corners[0].y;\r\n\r\n        // new center means corners changed their position\r\n        this.updateCornerPositions();\r\n\r\n        this.updateDOM();\r\n    }\r\n\r\n    /**\r\n     * updates DOM according to transform\r\n     * @param skipCallback\r\n     */\r\n    private updateDOM (skipCallback?: boolean) {\r\n        this.updateScaled();\r\n\r\n        BB.css(this.transEl, {\r\n            left: this.scaled.x + \"px\",\r\n            top: this.scaled.y + \"px\",\r\n            transformOrigin: \"0 0\",\r\n            transform: \"rotate(\" + this.transform.angleDeg + \"deg)\",\r\n        });\r\n\r\n        BB.css(this.boundsEl, {\r\n            width: Math.abs(this.scaled.width) + \"px\",\r\n            height: Math.abs(this.scaled.height) + \"px\",\r\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + \"px\",\r\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + \"px\"\r\n        });\r\n\r\n        this.corners[0].updateDOM();\r\n        this.corners[1].updateDOM();\r\n        this.corners[2].updateDOM();\r\n        this.corners[3].updateDOM();\r\n\r\n        this.edges[0].updateDOM();\r\n        this.edges[1].updateDOM();\r\n        this.edges[2].updateDOM();\r\n        this.edges[3].updateDOM();\r\n\r\n\r\n        this.angleGrip.x = 0;\r\n        this.angleGrip.y = (-Math.abs(this.transform.height * this.scale) / 2) - 20;\r\n        this.angleGrip.updateDOM();\r\n        if (!skipCallback) {\r\n            if (this.callback) { // why should updateDOM trigger the callback?\r\n                this.callback(copyTransform(this.transform));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // --- public ---\r\n    constructor (\r\n        params: {\r\n            x: number; // center of transform region. image space\r\n            y: number;\r\n            width: number; // size of transform region. image space\r\n            height: number;\r\n            angleDeg: number; // angle of transform region. degrees\r\n\r\n            isConstrained: boolean; // proportions constrained\r\n            snapX: number[]; // where snapping along X axis. image space\r\n            snapY: number[]; // where snapping along X axis. image space\r\n            scale: number; // ratio of screen-space / image-space\r\n            callback: (transform: ITransform) => void;\r\n        }\r\n    ) {\r\n        this.transform = { // coordinates and dimensions of transformation\r\n            x: params.x,\r\n            y: params.y,\r\n            width: params.width,\r\n            height: params.height,\r\n            angleDeg: params.angleDeg,\r\n        };\r\n\r\n        this.isConstrained = !!params.isConstrained;\r\n\r\n        this.snapX = params.snapX;\r\n        this.snapY = params.snapY;\r\n        this.callback = params.callback;\r\n        this.scale = params.scale;\r\n        this.snappingEnabled = true;\r\n        this.ratio = this.transform.width / this.transform.height;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-free-transform',\r\n            css: {\r\n                userSelect: 'none',\r\n            }\r\n        });\r\n        this.transEl = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'absolute',\r\n            }\r\n        });\r\n\r\n        this.boundsEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                cursor: 'move',\r\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\r\n            }\r\n        });\r\n\r\n        const pointerRemainder = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        function resetRemainder() {\r\n            pointerRemainder.x = 0;\r\n            pointerRemainder.y = 0;\r\n        }\r\n        this.keyListener = new BB.KeyListener({});\r\n\r\n        let boundsStartP = {\r\n            x: 0,\r\n            y: 0,\r\n        }\r\n        this.boundsPointerListener = new BB.PointerListener({\r\n            target: this.boundsEl,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointerdown') {\r\n                    boundsStartP = {x: this.transform.x, y: this.transform.y};\r\n                }\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    this.transform.x = boundsStartP.x + (event.pageX - event.downPageX) / this.scale;\r\n                    this.transform.y = boundsStartP.y + (event.pageY - event.downPageY) / this.scale;\r\n\r\n\r\n                    let dist;\r\n                    let snap: any = {};\r\n                    if (this.snappingEnabled) {\r\n                        let i;\r\n                        for (i = 0; i < this.snapX.length; i++) {\r\n                            dist = Math.abs(this.transform.x - this.snapX[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.x || dist < snap.distX) {\r\n                                    snap.x = this.snapX[i];\r\n                                    snap.distX = dist;\r\n                                }\r\n                            }\r\n                        }\r\n                        for (i = 0; i < this.snapY.length; i++) {\r\n                            dist = Math.abs(this.transform.y - this.snapY[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.y || dist < snap.distY) {\r\n                                    snap.y = this.snapY[i];\r\n                                    snap.distY = dist;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        let iP;\r\n                        for (i = 0; i < 4; i++) {\r\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n                            let j;\r\n                            for (j = 0; j < this.snapX.length; j++) {\r\n                                dist = Math.abs(iP.x - this.snapX[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.x || dist < snap.distX) {\r\n                                        snap.x = this.snapX[j] - (iP.x - this.transform.x);\r\n                                        snap.distX = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                            for (j = 0; j < this.snapY.length; j++) {\r\n                                dist = Math.abs(iP.y - this.snapY[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.y || dist < snap.distY) {\r\n                                        snap.y = this.snapY[j] - (iP.y - this.transform.y);\r\n                                        snap.distY = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        let projected = BB.projectPointOnLine(\r\n                            {x: 0, y: boundsStartP.y},\r\n                            {x: 10, y: boundsStartP.y},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        let dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        snap = {};\r\n                        snap.x = projected.x;\r\n                        snap.y = projected.y;\r\n                        snap.distX = dist;\r\n                        snap.distY = dist;\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: 0},\r\n                            {x: boundsStartP.x, y: 10},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n                    }\r\n                    if (snap.x != undefined) {\r\n                        this.transform.x = snap.x;\r\n                    }\r\n                    if (snap.y != undefined) {\r\n                        this.transform.y = snap.y;\r\n                    }\r\n\r\n                    // snap to pixels\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                    }\r\n\r\n                    this.updateDOM();\r\n                }\r\n            }\r\n        })\r\n\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                const g = this.corners[i] = {\r\n                    i: i,\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.gripSize + 'px',\r\n                            height: this.gripSize + 'px',\r\n                            background: '#fff',\r\n                            /*background: [\r\n                                '#ff0000',\r\n                                '#00ff00',\r\n                                '#0000ff',\r\n                                '#ff00ff',\r\n                            ][i],*/\r\n                            borderRadius: this.gripSize + 'px',\r\n                            position: 'absolute',\r\n                            boxShadow: 'inset 0 0 0 2px #000'\r\n                        }\r\n                    }),\r\n                    x: 0,\r\n                    y: 0,\r\n                    virtualPos: {\r\n                        x: 0,\r\n                        y: 0,\r\n                    },\r\n                    updateDOM: null,\r\n                    pointerListener: null,\r\n                };\r\n                g.updateDOM = () => {\r\n\r\n                    // grip position\r\n                    // if gets small, offset grips, so easier to handle\r\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\r\n                        item[0] *= this.transform.width > 0 ? 1 : -1;\r\n                        item[1] *= this.transform.height > 0 ? 1 : -1;\r\n                        return item;\r\n                    });\r\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\r\n\r\n                    BB.css(g.el, {\r\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\r\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px'\r\n                    });\r\n\r\n\r\n                    // cursor\r\n                    let angle = BB.pointsToAngleDeg(\r\n                        {\r\n                            x: this.transform.x,\r\n                            y: this.transform.y,\r\n                        },\r\n                        toImageSpace(g.x, g.y, this.transform),\r\n                    ) + 135; // offset so nw is 0\r\n                    while (angle < 0) {\r\n                        angle += 360;\r\n                    }\r\n                    let index = Math.round(angle / 45) % this.cornerCursors.length;\r\n                    BB.css(g.el, {\r\n                        cursor: this.cornerCursors[index] + '-resize',\r\n                    });\r\n                };\r\n\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.corners[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n\r\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                            this.corners[i].virtualPos.x += event.dX / this.scale;\r\n                            this.corners[i].virtualPos.y += event.dY / this.scale;\r\n\r\n                            let iP = {\r\n                                x: this.corners[i].virtualPos.x,\r\n                                y: this.corners[i].virtualPos.y,\r\n                            };\r\n                            iP = this.constrainCorner(i, iP.x, iP.y);\r\n                            if (!this.isConstrained) {\r\n                                iP = this.snapCorner(iP.x, iP.y);\r\n                            }\r\n\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                iP.x = Math.round(iP.x);\r\n                                iP.y = Math.round(iP.y);\r\n                            }\r\n\r\n                            const tP = toTransformSpace(iP.x, iP.y, this.transform);\r\n\r\n                            const dX = tP.x - this.corners[i].x;\r\n                            const dY = tP.y - this.corners[i].y;\r\n                            this.corners[i].x = tP.x;\r\n                            this.corners[i].y = tP.y;\r\n\r\n                            let indexes = [];\r\n                            if (i === 0) { // top left\r\n                                indexes = [3, 1, 2];\r\n                            } else if (i === 1) { // top right\r\n                                indexes = [2, 0, 3];\r\n                            } else if (i === 2) { // bottom right\r\n                                indexes = [1, 3, 0];\r\n                            } else if (i === 3) { // bottom left\r\n                                indexes = [0, 2, 1];\r\n                            }\r\n\r\n                            this.corners[indexes[0]].x = this.corners[i].x;\r\n                            this.corners[indexes[1]].y = this.corners[i].y;\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                this.corners[indexes[2]].x -= dX;\r\n                                this.corners[indexes[2]].y -= dY;\r\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\r\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    }\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.updateCornerPositions();\r\n        this.updateScaled();\r\n\r\n        let isInverted: boolean;\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                this.edges[i] = {\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.edgeSize + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                            /*background: [\r\n                                '#ff000044',\r\n                                '#00ff0044',\r\n                                '#0000ff44',\r\n                                '#ff00ff44',\r\n                            ][i],*/\r\n                            position: 'absolute',\r\n                        },\r\n                    }),\r\n                    updateDOM: null,\r\n                    pointerListener: null,\r\n                };\r\n                const g = this.edges[i];\r\n                g.updateDOM = () => {\r\n                    if (i === 0) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 1) {\r\n                        BB.css(g.el, {\r\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    } else if (i === 2) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\r\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 3) {\r\n                        BB.css(g.el, {\r\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\r\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    }\r\n                    let angleOffset = Math.round(this.transform.angleDeg / 45);\r\n                    while (angleOffset < 0)\r\n                        angleOffset += 8;\r\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\r\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\r\n\r\n                };\r\n\r\n                const isVertical = [0, 2].includes(i);\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.edges[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            if (isVertical) { // top bottom\r\n                                isInverted = this.corners[0].y >= this.corners[3].y;\r\n                            } else { // left right\r\n                                isInverted = this.corners[0].x >= this.corners[1].x;\r\n                            }\r\n                            resetRemainder();\r\n                        }\r\n                        if (event.type === 'pointermove' && event.button === 'left') {\r\n                            const tfD = BB.rotateAround({x: 0, y: 0},\r\n                                {x: event.dX / this.scale, y: event.dY / this.scale},\r\n                                -this.transform.angleDeg);\r\n                            let ti = {\r\n                                dX: tfD.x,\r\n                                dY: tfD.y,\r\n                            };\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\r\n                            }\r\n\r\n                            let indexes = [];\r\n                            if (i === 0) { // top\r\n                                indexes = [2, 3, 0, 1];\r\n                            } else if (i === 1) { // right\r\n                                indexes = [0, 3, 1, 2];\r\n                            } else if (i === 2) { // bottom\r\n                                indexes = [0, 1, 2, 3];\r\n                            } else if (i === 3) { // left\r\n                                indexes = [1, 2, 0, 3];\r\n                            }\r\n\r\n                            let dimension = isVertical ? 'y' : 'x';\r\n                            let d = isVertical ? ti.dY : ti.dX;\r\n\r\n                            if (isInverted) {\r\n                                this.corners[indexes[0]][dimension] += d;\r\n                                this.corners[indexes[1]][dimension] += d;\r\n                            } else {\r\n                                this.corners[indexes[2]][dimension] += d;\r\n                                this.corners[indexes[3]][dimension] += d;\r\n                            }\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                if (isInverted) {\r\n                                    this.corners[indexes[2]][dimension] -= d;\r\n                                    this.corners[indexes[3]][dimension] -= d;\r\n                                } else {\r\n                                    this.corners[indexes[0]][dimension] -= d;\r\n                                    this.corners[indexes[1]][dimension] -= d;\r\n                                }\r\n                            }\r\n\r\n                            if (isVertical) { // top bottom\r\n                                this.restoreRatio(false, true);\r\n                            } else { // left right\r\n                                this.restoreRatio(true, false);\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    }\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.angleGrip = {\r\n            el: BB.el({\r\n                css: {\r\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\r\n                    width: this.gripSize + 'px',\r\n                    height: this.gripSize + 'px',\r\n                    background: '#0ff',\r\n                    borderRadius: this.gripSize + 'px',\r\n                    position: 'absolute',\r\n                    boxShadow: 'inset 0 0 0 2px #000',\r\n                },\r\n            }),\r\n            x: 0,\r\n            y: 0,\r\n            snap: false,\r\n            updateDOM: () => {\r\n                BB.css(this.angleGrip.el, {\r\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\r\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\r\n                });\r\n            },\r\n        };\r\n        BB.el({\r\n            parent: this.angleGrip.el,\r\n            css: {\r\n                width: '2px',\r\n                height: '13px',\r\n                left: (this.gripSize / 2 - 1) + 'px',\r\n                top: this.gripSize + 'px',\r\n                background: '#0ff',\r\n                position: 'absolute'\r\n            }\r\n        });\r\n\r\n        this.anglePointerListener = new BB.PointerListener({\r\n            target: this.angleGrip.el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    const bounds = this.rootEl.getBoundingClientRect();\r\n                    const offset = {\r\n                        x: bounds.left - this.rootEl.scrollLeft,\r\n                        y: bounds.top - this.rootEl.scrollTop,\r\n                    };\r\n                    const iP = {x: (event.clientX - offset.x) / this.scale, y: (event.clientY - offset.y) / this.scale};\r\n\r\n                    const a = BB.pointsToAngleDeg({x: this.transform.x, y: this.transform.y}, iP) + 90;\r\n                    this.transform.angleDeg = a;\r\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    }\r\n                    this.updateDOM();\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                        this.updateDOM();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        snapToPixel(this.transform);\r\n        this.updateDOM(true);\r\n        BB.append(this.transEl, [\r\n            this.boundsEl,\r\n            this.edges[0].el,\r\n            this.edges[1].el,\r\n            this.edges[2].el,\r\n            this.edges[3].el,\r\n            this.corners[0].el,\r\n            this.corners[1].el,\r\n            this.corners[2].el,\r\n            this.corners[3].el,\r\n            this.angleGrip.el,\r\n        ]);\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    getTransform (): ITransform {\r\n        return copyTransform(this.transform);\r\n    }\r\n\r\n    setConstrained (b: boolean): void {\r\n        this.isConstrained = !!b;\r\n        if (b && this.transform.width !== 0 && this.transform.height !== 0) {\r\n            this.ratio = Math.abs(this.transform.width / this.transform.height);\r\n        }\r\n    }\r\n\r\n    setSnapping (s: boolean): void {\r\n        this.snappingEnabled = !!s;\r\n    }\r\n\r\n    setPos (p: IVector2D): void {\r\n        this.transform.x = p.x;\r\n        this.transform.y = p.y;\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    move (dX: number, dY: number): void {\r\n        this.transform.x += dX;\r\n        this.transform.y += dY;\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setSize (w: number, h: number): void {\r\n        this.transform.width = w;\r\n        this.transform.height = h;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n        }\r\n        this.updateCornerPositions();\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setAngleDeg (a: number): void {\r\n        this.transform.angleDeg = a;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n            this.updateCornerPositions();\r\n        }\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getRatio (): number {\r\n        return this.ratio;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.keyListener.destroy();\r\n        this.boundsPointerListener.destroy();\r\n        this.corners[0].pointerListener.destroy();\r\n        this.corners[1].pointerListener.destroy();\r\n        this.corners[2].pointerListener.destroy();\r\n        this.corners[3].pointerListener.destroy();\r\n        this.edges[0].pointerListener.destroy();\r\n        this.edges[1].pointerListener.destroy();\r\n        this.edges[2].pointerListener.destroy();\r\n        this.edges[3].pointerListener.destroy();\r\n        this.anglePointerListener.destroy();\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"045N6\");","import {BB} from '../../../bb/bb';\r\nimport {KlCanvasPreview} from '../../canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './free-transform';\r\nimport {IKlBasicLayer, IMixMode} from '../../kl.types';\r\n\r\n/**\r\n * a basic canvas where you can transform one layer(move around, rotate, scale)\r\n *\r\n * @param params\r\n * @returns {HTMLDivElement}\r\n * @constructor\r\n */\r\nexport function FreeTransformCanvas(params: {\r\n    elementWidth: number;\r\n    elementHeight: number;\r\n    imageWidth: number;\r\n    imageHeight: number;\r\n    layers: IKlBasicLayer[];\r\n    transformIndex: number;\r\n}) {\r\n    /*\r\n    div\r\n        innerWrapper\r\n            klCanvasPreview\r\n            transform.div\r\n    */\r\n\r\n    let previewFit = BB.fitInto(\r\n        params.imageWidth,\r\n        params.imageHeight,\r\n        params.elementWidth - 20,\r\n        params.elementHeight - 60,\r\n        1\r\n    );\r\n    let scale = previewFit.width / params.imageWidth;\r\n\r\n    let div = BB.el({\r\n        css: {\r\n            width: params.elementWidth + \"px\",\r\n            height: params.elementHeight + \"px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            userSelect: \"none\",\r\n            position: \"relative\",\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    let innerWrapper = BB.el({\r\n        css: {\r\n            position: 'relative',\r\n            boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n            width: previewFit.width + 'px',\r\n            height: previewFit.height + 'px'\r\n        }\r\n    });\r\n    div.appendChild(innerWrapper);\r\n\r\n    let previewLayerArr = params.layers.map(item => {\r\n        return {\r\n            image: item.image,\r\n            mixModeStr: item.mixModeStr,\r\n            opacity: item.opacity,\r\n        }\r\n    });\r\n    previewLayerArr[previewLayerArr.length - 1].image = BB.canvas(\r\n        scale > 1 ? params.imageWidth : previewFit.width,\r\n        scale > 1 ? params.imageHeight : previewFit.height,\r\n    );\r\n    let klCanvasPreview = new KlCanvasPreview({\r\n        width: previewFit.width,\r\n        height: previewFit.height,\r\n        layers: previewLayerArr\r\n    });\r\n    innerWrapper.appendChild(klCanvasPreview.getElement());\r\n\r\n    let freeTransform;\r\n    let initTransform;\r\n    function updatePreview() {\r\n        if (!freeTransform) {\r\n            return;\r\n        }\r\n\r\n        let transform = freeTransform.getTransform();\r\n        if (scale < 1) {\r\n            transform.x *= scale;\r\n            transform.y *= scale;\r\n            transform.width *= scale;\r\n            transform.height *= scale;\r\n        }\r\n\r\n        let destCanvas = previewLayerArr[params.transformIndex].image;\r\n        let ctx = (destCanvas as HTMLCanvasElement).getContext('2d');\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            ctx,\r\n            params.layers[params.transformIndex].image,\r\n            transform,\r\n            null,\r\n            BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n        );\r\n        ctx.restore();\r\n        klCanvasPreview.render();\r\n    }\r\n\r\n    {\r\n        let transformSize = {\r\n            width: params.layers[params.transformIndex].image.width * scale,\r\n            height: params.layers[params.transformIndex].image.height * scale\r\n        };\r\n        if (transformSize.width > previewFit.width || transformSize.height > previewFit.height) {\r\n            transformSize = BB.fitInto(\r\n                params.layers[params.transformIndex].image.width,\r\n                params.layers[params.transformIndex].image.height,\r\n                previewFit.width,\r\n                previewFit.height,\r\n                1\r\n            );\r\n        }\r\n        initTransform = {\r\n            x: params.imageWidth / 2,\r\n            y: params.imageHeight / 2,\r\n            width: params.layers[params.transformIndex].image.width,\r\n            height: params.layers[params.transformIndex].image.height,\r\n        };\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: 0,\r\n            isConstrained: true,\r\n            snapX: [0, params.imageWidth],\r\n            snapY: [0, params.imageHeight],\r\n            scale: scale,\r\n            callback: (transform) => {\r\n                updatePreview();\r\n            },\r\n        });\r\n    }\r\n    BB.css(freeTransform.getElement(), {\r\n        position: 'absolute',\r\n        left: '0',\r\n        top: '0'\r\n    });\r\n    innerWrapper.appendChild(freeTransform.getElement());\r\n    setTimeout(updatePreview, 0);\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.move = function(dX, dY) {\r\n        freeTransform.move(dX, dY);\r\n    };\r\n    this.reset = function() {\r\n        let w = params.layers[params.transformIndex].image.width;\r\n        let h = params.layers[params.transformIndex].image.height;\r\n\r\n        freeTransform.setSize(w, h);\r\n        freeTransform.setPos({x: w / 2, y: h / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    this.setTransformFit = function() {\r\n\r\n        let fit = BB.fitInto(\r\n            params.layers[params.transformIndex].image.width,\r\n            params.layers[params.transformIndex].image.height,\r\n            params.imageWidth,\r\n            params.imageHeight,\r\n            1\r\n        );\r\n\r\n        freeTransform.setSize(fit.width, fit.height);\r\n        freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    this.setTransformCenter = function() {\r\n        freeTransform.setPos({x: params.imageWidth / 2, y: params.imageHeight / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    //gives you the transformation in the original scale\r\n    this.getTransformation = function () {\r\n        if (!freeTransform) {\r\n            return false;\r\n        }\r\n        return freeTransform.getTransform();\r\n    };\r\n    this.getIsPixelated = () => {\r\n        const transform = freeTransform.getTransform();\r\n        return BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height);\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.destroy = function() {\r\n        freeTransform.destroy();\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/*\r\n\tCropper params\r\n\t{\r\n\t\tx: int, //pos in relation zum bild\r\n\t\ty: int,\r\n\t\tw: int,\r\n\t\th: int,\r\n\t\tscale: float, //zoom\r\n\t\tcallback: function //wenn sich was ändert\r\n\t}\r\n\tthe div that you append this to must be relative\r\n*/\r\nexport function Cropper (params) {\r\n    let x = params.x,\r\n        y = params.y,\r\n        width = params.width,\r\n        height = params.height,\r\n        scale = params.scale,\r\n        callback = params.callback,\r\n        maxW = params.maxW,\r\n        maxH = params.maxH;\r\n    let div = document.createElement(\"div\");\r\n    let gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n\r\n    let keyListener = new BB.KeyListener({});\r\n\r\n    BB.css(div, {\r\n        position: \"absolute\",\r\n        left: (x * scale) + \"px\",\r\n        top: (y * scale) + \"px\"\r\n    });\r\n\r\n    let outline = document.createElement(\"div\");\r\n    BB.css(outline, {\r\n        position: \"absolute\",\r\n        border: \"1px dashed #fff\",\r\n        cursor: \"move\"\r\n    });\r\n    (outline as any).update = function () {\r\n        BB.css(outline, {\r\n            left: (grips[0].x * scale - 1) + \"px\",\r\n            top: (grips[0].y * scale - 1) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\r\n        });\r\n    };\r\n    let pointerRemainder = { // needs to be reset after dragging complete\r\n        x: 0,\r\n        y: 0,\r\n    };\r\n    let outlinePointerListener = new BB.PointerListener({\r\n        target: outline,\r\n        onPointer: function(event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n\r\n                grips[0].x += dX;\r\n                grips[0].y += dY;\r\n                grips[1].x += dX;\r\n                grips[1].y += dY;\r\n                grips[2].x += dX;\r\n                grips[2].y += dY;\r\n                grips[3].x += dX;\r\n                grips[3].y += dY;\r\n\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n    let thirdsHorizontal = document.createElement(\"div\");\r\n    BB.css(thirdsHorizontal, {\r\n        position: \"absolute\",\r\n        borderTop: \"1px solid #0ff\",\r\n        borderBottom: \"1px solid #0ff\"\r\n    });\r\n    (thirdsHorizontal as any).update = function () {\r\n        BB.css(thirdsHorizontal, {\r\n            left: (grips[0].x * scale) + \"px\",\r\n            top: ((grips[0].y + (grips[2].y - grips[0].y) / 3) * scale) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) / 3 * scale) + \"px\"\r\n\r\n        });\r\n    };\r\n    let thirdsVertical = document.createElement(\"div\");\r\n    BB.css(thirdsVertical, {\r\n        position: \"absolute\",\r\n        borderLeft: \"1px solid #0ff\",\r\n        borderRight: \"1px solid #0ff\"\r\n    });\r\n    (thirdsVertical as any).update = function () {\r\n        BB.css(thirdsVertical, {\r\n            left: ((grips[0].x + (grips[2].x - grips[0].x) / 3) * scale) + \"px\",\r\n            top: (grips[0].y * scale) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) / 3 * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\r\n\r\n        });\r\n    };\r\n\r\n    const gripSize = 40;\r\n    const gripOverlay = 10;\r\n\r\n    let grips: {\r\n        x: number; // int\r\n        y: number;\r\n    }[] = [ // aka corner coordinates\r\n        {x: 0, y: 0}, // top left\r\n        {x: width, y: 0}, // top right\r\n        {x: width, y: height}, // bottom right\r\n        {x: 0, y: height}, //bottom left\r\n    ];\r\n\r\n    function transformTop(dY) {\r\n        grips[0].y += dY;\r\n        grips[0].y = Math.max(grips[3].y - maxH, Math.min(grips[3].y - 1, grips[0].y));\r\n        grips[1].y = grips[0].y;\r\n    }\r\n    function transformRight(dX) {\r\n        grips[1].x += dX;\r\n        grips[1].x = Math.min(grips[0].x + maxW, Math.max(grips[0].x + 1, grips[1].x));\r\n        grips[2].x = grips[1].x;\r\n    }\r\n    function transformBottom(dY) {\r\n        grips[2].y += dY;\r\n        grips[2].y = Math.min(grips[1].y + maxH, Math.max(grips[1].y + 1, grips[2].y));\r\n        grips[3].y = grips[2].y;\r\n    }\r\n    function transformLeft(dX) {\r\n        grips[0].x += dX;\r\n        grips[0].x = Math.max(grips[1].x - maxW, Math.min(grips[1].x - 1, grips[0].x));\r\n        grips[3].x = grips[0].x;\r\n    }\r\n\r\n    function commit() {\r\n        pointerRemainder.x = 0;\r\n        pointerRemainder.y = 0;\r\n        callback(getTransform());\r\n    }\r\n\r\n\r\n\r\n\r\n    let edges = [];\r\n    for (let i = 0; i < 4; i++) {\r\n        (function (i) {\r\n            edges[i] = document.createElement(\"div\");\r\n            let g = edges[i];\r\n            g.style.width = gripSize + \"px\";\r\n            g.style.height = gripSize + \"px\";\r\n            //g.style.background = \"#0f0\";\r\n            g.style.position = \"absolute\";\r\n            g.update = function () {\r\n                if (i === 0) { //top\r\n                    g.style.left = (grips[0].x * scale + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\";\r\n                    g.style.width = ((grips[1].x - grips[0].x) * scale - gripOverlay * 2) + \"px\";\r\n                    g.style.height = (gripSize * 2) + \"px\";\r\n                } else if (i === 1) { //right\r\n                    g.style.left = (grips[1].x * scale - gripOverlay) + \"px\";\r\n                    g.style.top = (grips[1].y * scale + gripOverlay) + \"px\";\r\n                    g.style.width = (gripSize * 2) + \"px\";\r\n                    g.style.height = ((grips[2].y - grips[1].y) * scale - gripOverlay * 2) + \"px\";\r\n                } else if (i === 2) { //bottom\r\n                    g.style.left = (grips[3].x * scale + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[3].y * scale - gripOverlay) + \"px\";\r\n                    g.style.width = ((grips[2].x - grips[3].x) * scale - gripOverlay * 2) + \"px\";\r\n                    g.style.height = (gripSize * 2) + \"px\";\r\n                } else if (i === 3) { //left\r\n                    g.style.left = (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[0].y * scale + gripOverlay) + \"px\";\r\n                    g.style.width = (gripSize * 2) + \"px\";\r\n                    g.style.height = ((grips[3].y - grips[0].y) * scale - gripOverlay * 2) + \"px\";\r\n                }\r\n                let angleOffset = i * 2 + 1;\r\n                g.style.cursor = gripCursors[angleOffset] + \"-resize\";\r\n\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    let darken = [];\r\n    for (let i = 0; i < 4; i++) {\r\n        (function (i) {\r\n            darken[i] = document.createElement(\"div\");\r\n            let g = darken[i];\r\n            g.style.position = \"absolute\";\r\n            g.style.background = \"#000\";\r\n            g.style.opacity = \"0.5\";\r\n            g.update = function () {\r\n                if (i === 0) {\r\n                    g.style.left = (grips[0].x * scale) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\r\n                    g.style.width = ((grips[1].x - grips[0].x) * scale) + \"px\";\r\n                    g.style.height = \"8000px\";\r\n                } else if (i === 1) {\r\n                    g.style.left = (grips[1].x * scale) + \"px\";\r\n                    g.style.top = (grips[1].y * scale - 8000) + \"px\";\r\n                    g.style.width = \"8000px\";\r\n                    g.style.height = 16000 + \"px\";\r\n                } else if (i === 2) {\r\n                    g.style.left = (grips[3].x * scale) + \"px\";\r\n                    g.style.top = (grips[3].y * scale) + \"px\";\r\n                    g.style.width = ((grips[2].x - grips[3].x) * scale) + \"px\";\r\n                    g.style.height = \"8000px\";\r\n                } else if (i === 3) {\r\n                    g.style.left = (grips[0].x * scale - 8000) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\r\n                    g.style.width = \"8000px\";\r\n                    g.style.height = 16000 + \"px\";\r\n                }\r\n\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    let edge0PointerListener = new BB.PointerListener({\r\n        target: edges[0],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge1PointerListener = new BB.PointerListener({\r\n        target: edges[1],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge2PointerListener = new BB.PointerListener({\r\n        target: edges[2],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge3PointerListener = new BB.PointerListener({\r\n        target: edges[3],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    let cornerElArr = [];\r\n    (function() {\r\n        for (let i = 0; i < 4; i++) {\r\n            (function (i) {\r\n                cornerElArr[i] = document.createElement(\"div\");\r\n                let g = cornerElArr[i];\r\n                BB.css(g, {\r\n                    //background: '#f00',\r\n                    width: (gripSize * 2) + 'px',\r\n                    height: (gripSize * 2) + 'px',\r\n                    position: 'absolute'\r\n                });\r\n                g.style.cursor = ['nwse-resize', 'nesw-resize'][i % 2];\r\n                g.update = function () {\r\n                    if (i === 0) { //top left\r\n                        BB.css(g, {\r\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\r\n                            top: (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 1) { //top right\r\n                        BB.css(g, {\r\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\r\n                            top: (grips[1].y * scale - gripSize * 2 + gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 2) { //bottom right\r\n                        BB.css(g, {\r\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\r\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 3) { //bottom left\r\n                        BB.css(g, {\r\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\r\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\r\n                        });\r\n                    }\r\n                };\r\n            })(i);\r\n        }\r\n    })();\r\n    //top left\r\n    let corner0PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[0],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //top right\r\n    let corner1PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[1],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //bottom right\r\n    let corner2PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[2],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //bottom left\r\n    let corner3PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[3],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n\r\n\r\n    function getTransform() {\r\n        grips[1].x -= grips[0].x;\r\n        grips[1].y -= grips[0].y;\r\n        grips[2].x -= grips[0].x;\r\n        grips[2].y -= grips[0].y;\r\n        grips[3].x -= grips[0].x;\r\n        grips[3].y -= grips[0].y;\r\n        x += grips[0].x;\r\n        y += grips[0].y;\r\n        grips[0].x = 0;\r\n        grips[0].y = 0;\r\n        return {\r\n            x: x,\r\n            y: y,\r\n            width: grips[1].x,\r\n            height: grips[2].y\r\n        };\r\n    }\r\n\r\n\r\n    div.append(\r\n        darken[1],\r\n        darken[0],\r\n        darken[2],\r\n        darken[3],\r\n        thirdsHorizontal,\r\n        thirdsVertical,\r\n        outline,\r\n\r\n        edges[1],\r\n        edges[0],\r\n        edges[2],\r\n        edges[3],\r\n\r\n        cornerElArr[0],\r\n        cornerElArr[1],\r\n        cornerElArr[2],\r\n        cornerElArr[3],\r\n    );\r\n\r\n\r\n    function update() {\r\n\r\n        edges[0].update();\r\n        edges[1].update();\r\n        edges[2].update();\r\n        edges[3].update();\r\n        cornerElArr[0].update();\r\n        cornerElArr[1].update();\r\n        cornerElArr[2].update();\r\n        cornerElArr[3].update();\r\n        darken[0].update();\r\n        darken[1].update();\r\n        darken[2].update();\r\n        darken[3].update();\r\n        (outline as any).update();\r\n        (thirdsHorizontal as any).update();\r\n        (thirdsVertical as any).update();\r\n    }\r\n\r\n    update();\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getTransform = getTransform;\r\n\r\n    this.setTransform = function (p) {\r\n        x = p.x;\r\n        y = p.y;\r\n        width = p.width;\r\n        height = p.height;\r\n\r\n        BB.css(div, {\r\n            left: (x * scale) + \"px\",\r\n            top: (y * scale) + \"px\"\r\n        });\r\n\r\n        grips[0].x = 0;\r\n        grips[0].y = 0;\r\n        grips[1].x = width;\r\n        grips[1].y = 0;\r\n        grips[2].x = width;\r\n        grips[2].y = height;\r\n        grips[3].x = 0;\r\n        grips[3].y = height;\r\n\r\n        update();\r\n        commit();\r\n    };\r\n\r\n    this.setScale = function (s) {\r\n        scale = s;\r\n        BB.css(div, {\r\n            left: (x * scale) + \"px\",\r\n            top: (y * scale) + \"px\"\r\n        });\r\n        update();\r\n    };\r\n\r\n    this.showThirds = function (b) {\r\n        if (b) {\r\n            thirdsHorizontal.style.display = \"block\";\r\n            thirdsVertical.style.display = \"block\";\r\n        } else {\r\n            thirdsHorizontal.style.display = \"none\";\r\n            thirdsVertical.style.display = \"none\";\r\n        }\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.destroy = function() {\r\n        keyListener.destroy();\r\n        outlinePointerListener.destroy();\r\n        corner0PointerListener.destroy();\r\n        corner1PointerListener.destroy();\r\n        corner2PointerListener.destroy();\r\n        corner3PointerListener.destroy();\r\n        edge0PointerListener.destroy();\r\n        edge1PointerListener.destroy();\r\n        edge2PointerListener.destroy();\r\n        edge3PointerListener.destroy();\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Previews currently active layer\r\n * thumbnail (hover shows bigger preview), layername, opacity\r\n *\r\n * internally listens to kl history. updates when there's a change.\r\n * but you need to update it when the active layer changed. (different canvas object)\r\n *\r\n * update visibility for performance\r\n *\r\n * p = {\r\n *     onClick: function() // when clicking on layer name\r\n *     klRootEl: klRootEl,\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function LayerPreview(p) {\r\n\r\n    // internally redraws with in an interval. checks history is something changed\r\n    // this update will be animated\r\n    // it will not be animated if the resolution changed\r\n    // also redraws when you call updateLayer - not animated\r\n\r\n    // syncs via updateLayer, and internally updates layer opacity via a hack\r\n\r\n    let div = BB.el({});\r\n    let layerObj;\r\n    let isVisible = true;\r\n    const height = 40;\r\n    const canvasSize = height - 10;\r\n    const largeCanvasSize = 300;\r\n    let lastDrawnState = -2;\r\n    let lastDrawnSize = {\r\n        width: 0,\r\n        height: 0\r\n    };\r\n    let animationCanvas = BB.canvas(); // to help animate the transition\r\n    let animationCanvasCtx = animationCanvas.getContext('2d');\r\n    const animationLength = 30;\r\n    let animationCount = 0; // >0 means it's animating\r\n    let largeCanvasIsVisible = false;\r\n    let largeCanvasAnimationTimeout;\r\n    const largeCanvasAnimationDurationMs = 300;\r\n    let uiState = 'right'; // 'left' | 'right'\r\n\r\n\r\n    // --- setup dom ---\r\n    let contentWrapperEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            height: height + 'px',\r\n            color: '#666',\r\n        }\r\n    });\r\n    let canvasWrapperEl = BB.el({\r\n        css: {\r\n            //background: '#f00',\r\n            minWidth: height + 'px',\r\n            height: height + 'px',\r\n            display: 'flex',\r\n            justifyContent: 'center',\r\n            alignItems: 'center'\r\n        }\r\n    });\r\n    let canvas = BB.canvas(canvasSize, canvasSize);\r\n    let canvasCtx = canvas.getContext('2d');\r\n    canvas.title = LANG('layers-active-layer');\r\n    BB.css(canvas, {\r\n        boxShadow: '0 0 0 1px #9e9e9e',\r\n        colorScheme: 'only light',\r\n    });\r\n    let nameWrapper = BB.el({\r\n        css: {\r\n            //background: '#ff0',\r\n            flexGrow: '1',\r\n            paddingLeft: '10px',\r\n            fontSize: '13px',\r\n            overflow: 'hidden',\r\n            position: 'relative'\r\n        }\r\n    });\r\n    let nameLabelEl = BB.el({\r\n        content: '',\r\n        css: {\r\n            cssFloat: 'left',\r\n            whiteSpace: 'nowrap'\r\n        }\r\n    });\r\n    let nameFadeEl = BB.el({\r\n        css: {\r\n            backgroundImage: 'linear-gradient(to right, rgba(221,221,221,0) 0%, rgba(221,221,221,0.8) 100%)',\r\n            position: 'absolute',\r\n            right: \"0\",\r\n            top: \"0\",\r\n            width: \"50px\",\r\n            height: '100%'\r\n        }\r\n    });\r\n    let clickableEl = BB.el({\r\n        css: {\r\n            //background: 'rgba(0,255,0,0.6)',\r\n            position: 'absolute',\r\n            left: \"10px\",\r\n            top: \"0\",\r\n            width: \"90px\",\r\n            height: '100%'\r\n        }\r\n    });\r\n    if (p.onClick) {\r\n        BB.addEventListener(clickableEl,'click', function() {\r\n            p.onClick();\r\n        });\r\n        BB.addEventListener(canvas,'click', function() {\r\n            p.onClick();\r\n        });\r\n    }\r\n    let opacityEl = BB.el({\r\n        content: LANG('opacity') + '<br>100%',\r\n        css: {\r\n            minWidth: '60px',\r\n            fontSize: '12px',\r\n            textAlign: 'center',\r\n            background: '#dddddd',\r\n            color: '#555'\r\n        }\r\n    });\r\n\r\n    const largeCanvasWrapper = BB.el({\r\n        onClick: BB.handleClick,\r\n        css: {\r\n            pointerEvents: 'none',\r\n            background: '#fff',\r\n            position: 'absolute',\r\n            right: '280px',\r\n            top: '10px',\r\n            border: '1px solid #aaa',\r\n            boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\r\n            transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\r\n            userSelect: 'none',\r\n            display: 'block',\r\n            webkitTouchCallout: 'none',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    let largeCanvas = BB.canvas(largeCanvasSize, largeCanvasSize);\r\n    largeCanvasWrapper.append(largeCanvas);\r\n    let largeCanvasCtx = largeCanvas.getContext('2d');\r\n    BB.css(largeCanvas, {\r\n        display: 'block',\r\n    });\r\n\r\n    div.appendChild(contentWrapperEl);\r\n    contentWrapperEl.appendChild(canvasWrapperEl);\r\n    canvasWrapperEl.appendChild(canvas);\r\n    contentWrapperEl.appendChild(nameWrapper);\r\n    nameWrapper.appendChild(nameLabelEl);\r\n    nameWrapper.appendChild(nameFadeEl);\r\n    nameWrapper.appendChild(clickableEl);\r\n    contentWrapperEl.appendChild(opacityEl);\r\n\r\n\r\n    let animationCanvasCheckerPattern = animationCanvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\r\n    let largeCanvasCheckerPattern = canvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\r\n\r\n\r\n\r\n    // --- update logic ---\r\n\r\n    // cross-fade done via 2 canvases (old and new state)\r\n    // both have checkerboard background drawn on them, both fully opaque\r\n    // -> no \"lighter\" is needed for accurate cross-fading\r\n\r\n    function animate() {\r\n        if (animationCount === 0) {\r\n            return;\r\n        }\r\n\r\n        animationCount--;\r\n\r\n        canvasCtx.save();\r\n        canvasCtx.globalAlpha = Math.pow((animationLength - animationCount) / animationLength, 2);\r\n        canvasCtx.drawImage(animationCanvas, 0, 0);\r\n        canvasCtx.restore();\r\n\r\n        if (animationCount > 0) {\r\n            requestAnimationFrame(animate);\r\n        }\r\n    }\r\n\r\n    function draw(isInstant) {\r\n\r\n        if (!isVisible) {\r\n            return;\r\n        }\r\n\r\n        nameLabelEl.textContent = layerObj.name;\r\n        opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(layerObj.opacity * 100) + '%';\r\n\r\n        let layerCanvas = layerObj.context.canvas;\r\n\r\n        if (layerCanvas.width !== lastDrawnSize.width || layerCanvas.height !== lastDrawnSize.height) {\r\n            let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, canvasSize, canvasSize, 1);\r\n            canvas.width = Math.round(canvasDimensions.width);\r\n            canvas.height = Math.round(canvasDimensions.height);\r\n\r\n            isInstant = true;\r\n        }\r\n\r\n        animationCanvas.width = canvas.width;\r\n        animationCanvas.height = canvas.height;\r\n\r\n        animationCanvasCtx.save();\r\n        animationCanvasCtx.imageSmoothingEnabled = false;\r\n        animationCanvasCtx.fillStyle = animationCanvasCheckerPattern;\r\n        animationCanvasCtx.fillRect(0, 0, animationCanvas.width, animationCanvas.height);\r\n        animationCanvasCtx.drawImage(layerCanvas, 0, 0, animationCanvas.width, animationCanvas.height);\r\n        animationCanvasCtx.restore();\r\n\r\n        if (isInstant) {\r\n            animationCount = 0;\r\n            canvasCtx.save();\r\n            canvasCtx.drawImage(animationCanvas, 0, 0);\r\n            canvasCtx.restore();\r\n\r\n        } else {\r\n            animationCount = animationLength;\r\n            animate();\r\n\r\n        }\r\n\r\n        drawLargeCanvas();\r\n\r\n        lastDrawnState = klHistory.getState();\r\n        lastDrawnSize.width = layerCanvas.width;\r\n        lastDrawnSize.height = layerCanvas.height;\r\n    }\r\n\r\n    function update() {\r\n        draw(true);\r\n    }\r\n\r\n    setInterval(function() {\r\n\r\n        if (!layerObj) {\r\n            return;\r\n        }\r\n\r\n        let currentState = klHistory.getState();\r\n        if (currentState === lastDrawnState) {\r\n            return;\r\n        }\r\n\r\n        //update opacity w hack\r\n        layerObj.opacity = layerObj.context.canvas.opacity;\r\n\r\n        draw(false);\r\n\r\n    }, 2000);\r\n\r\n\r\n    //is always instant\r\n    function drawLargeCanvas() {\r\n\r\n        if (!largeCanvasIsVisible || !layerObj) {\r\n            return;\r\n        }\r\n\r\n        let layerCanvas = layerObj.context.canvas;\r\n\r\n        let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, largeCanvasSize, largeCanvasSize, 1);\r\n        largeCanvas.width = Math.round(canvasDimensions.width);\r\n        largeCanvas.height = Math.round(canvasDimensions.height);\r\n        largeCanvasCtx.save();\r\n        if (largeCanvas.width > layerCanvas.width) {\r\n            largeCanvasCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            largeCanvasCtx.imageSmoothingEnabled = true;\r\n            largeCanvasCtx.imageSmoothingQuality = 'high';\r\n        }\r\n        largeCanvasCtx.fillStyle = largeCanvasCheckerPattern;\r\n        largeCanvasCtx.fillRect(0, 0, largeCanvas.width, largeCanvas.height);\r\n        largeCanvasCtx.drawImage(layerCanvas, 0, 0, largeCanvas.width, largeCanvas.height);\r\n        largeCanvasCtx.restore();\r\n\r\n        const bounds = div.getBoundingClientRect();\r\n        BB.css(largeCanvasWrapper, {\r\n            top: Math.max(10, (bounds.top + height / 2 - largeCanvas.height / 2)) + \"px\"\r\n        });\r\n\r\n    }\r\n\r\n    function removeLargeCanvas() {\r\n        try {\r\n            p.klRootEl.removeChild(largeCanvasWrapper);\r\n        } catch(e) {\r\n\r\n        }\r\n    }\r\n\r\n    function showLargeCanvas(b) {\r\n        if (largeCanvasIsVisible === b) {\r\n            return;\r\n        }\r\n\r\n        clearTimeout(largeCanvasAnimationTimeout);\r\n        largeCanvasIsVisible = b;\r\n\r\n        if (b) {\r\n            largeCanvasAnimationTimeout = setTimeout(function() {\r\n                drawLargeCanvas();\r\n                largeCanvasWrapper.style.opacity = '0';\r\n                p.klRootEl.appendChild(largeCanvasWrapper);\r\n                setTimeout(function() {\r\n                    largeCanvasWrapper.style.opacity = '1';\r\n                }, 20);\r\n            }, 250);\r\n\r\n        } else {\r\n            largeCanvasWrapper.style.opacity = '0';\r\n            largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\r\n        }\r\n\r\n    }\r\n\r\n    let pointerListener = new BB.PointerListener({\r\n        target: canvas,\r\n        onEnterLeave: function(b) {\r\n            showLargeCanvas(b);\r\n        }\r\n    });\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(b) {\r\n        if (isVisible === b) {\r\n            return;\r\n        }\r\n        isVisible = b;\r\n        contentWrapperEl.style.display = isVisible ? 'flex' : 'none';\r\n        div.style.marginBottom = isVisible ? '' : '10px';\r\n\r\n        let currentState = klHistory.getState();\r\n        if (b && lastDrawnState !== currentState) {\r\n            update();\r\n        }\r\n    };\r\n\r\n    //when the layer might have changed\r\n    this.setLayer = function(klCanvasLayerObj) {\r\n        layerObj = klCanvasLayerObj;\r\n        update();\r\n    };\r\n\r\n    this.setUiState = function(stateStr) {\r\n        uiState = '' + stateStr;\r\n\r\n        if (uiState === 'left') {\r\n            BB.css(largeCanvasWrapper, {\r\n                left: '280px',\r\n                right: ''\r\n            });\r\n        } else {\r\n            BB.css(largeCanvasWrapper, {\r\n                left: '',\r\n                right: '280px'\r\n            });\r\n        }\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * fits image into a size\r\n * params: {\r\n *    image: image,\r\n *    width: int,\r\n *    height: int\r\n * }\r\n *\r\n * methods:\r\n * getDiv()\r\n *\r\n * @param params\r\n * @constructor\r\n */\r\nexport function FittedImage(params) {\r\n    let fit = BB.fitInto(params.image.width, params.image.height, params.width, params.height, 1);\r\n    let w = parseInt('' + fit.width);\r\n    let h = parseInt('' + fit.height);\r\n\r\n    let canvas = BB.canvas(w, h);\r\n\r\n    canvas.getContext(\"2d\").drawImage(params.image, 0, 0, w, h);\r\n    BB.css(canvas, {\r\n        display: \"block\",\r\n        boxShadow: \"0 0 0 1px #aaa\"\r\n    });\r\n\r\n    this.getElement = function() {\r\n        return canvas;\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\nimport {FreeTransformCanvas} from '../components/free-transform-canvas';\r\nimport {popup} from './popup';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {IKlBasicLayer} from '../../kl.types';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showImportAsLayerDialog(\r\n    params: {\r\n        target: HTMLElement;\r\n        klCanvas: KlCanvas;\r\n        importImage: HTMLImageElement | HTMLCanvasElement;\r\n        callback: (\r\n            p?: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n            isPixelated?: boolean\r\n        ) => void;\r\n    }\r\n): void {\r\n\r\n    let div = document.createElement(\"div\");\r\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\r\n    if (params.klCanvas.isLayerLimitReached()) {\r\n        let noteEl = BB.el({\r\n            content: LANG('import-as-layer-limit-reached'),\r\n            css: {\r\n                background: '#ff0',\r\n                padding: '10px',\r\n                marginTop: '5px',\r\n                marginBottom: '5px',\r\n                border: '1px solid #e7d321',\r\n                borderRadius: '5px'\r\n            }\r\n        });\r\n        div.appendChild(noteEl);\r\n    }\r\n    let isSmall = window.innerWidth < 550;\r\n\r\n    let buttonRowEl = BB.el({\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n    let originalSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: '1:1',\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.reset();\r\n        }\r\n    });\r\n    let fitSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('import-as-layer-fit'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.setTransformFit();\r\n        }\r\n    });\r\n    let centerBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('center'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.setTransformCenter();\r\n        }\r\n    });\r\n    buttonRowEl.appendChild(originalSizeBtn);\r\n    buttonRowEl.appendChild(fitSizeBtn);\r\n    buttonRowEl.appendChild(centerBtn);\r\n    div.appendChild(buttonRowEl);\r\n\r\n\r\n\r\n    let layers: IKlBasicLayer[] = [];\r\n    {\r\n        let klCanvasLayerArr = params.klCanvas.getLayers();\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            layers.push({\r\n                image: klCanvasLayerArr[i].context.canvas,\r\n                opacity: klCanvasLayerArr[i].opacity,\r\n                mixModeStr: klCanvasLayerArr[i].mixModeStr\r\n            });\r\n        }\r\n    }\r\n    layers.push({\r\n        image: params.importImage,\r\n        opacity: 1,\r\n        mixModeStr: 'source-over'\r\n    });\r\n\r\n\r\n    let freeTransformCanvas = new FreeTransformCanvas({\r\n        elementWidth: isSmall ? 340 : 540,\r\n        elementHeight: isSmall ? 280 : 350,\r\n        imageWidth: params.klCanvas.getLayerContext(0).canvas.width,\r\n        imageHeight: params.klCanvas.getLayerContext(0).canvas.height,\r\n        layers: layers,\r\n        transformIndex: layers.length - 1,\r\n    });\r\n    BB.css(freeTransformCanvas.getElement(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.appendChild(freeTransformCanvas.getElement());\r\n\r\n    function move(x, y) {\r\n        freeTransformCanvas.move(x, y);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr) {\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    popup({\r\n        target: params.target,\r\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\r\n        div: div,\r\n        style: isSmall ? null : {\r\n            width: '500px'\r\n        },\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        clickOnEnter: 'Ok',\r\n        callback: function(buttonStr) {\r\n            keyListener.destroy();\r\n            freeTransformCanvas.destroy();\r\n            BB.destroyEl(originalSizeBtn);\r\n            BB.destroyEl(fitSizeBtn);\r\n            BB.destroyEl(centerBtn);\r\n            if (buttonStr === 'Ok') {\r\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\r\n            } else {\r\n                params.callback();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Not really generalized. UI when you drag/drop an image into window.\r\n * The moment you create it, it will listen.\r\n *\r\n * @param p object {onDrop: func(files, optionStr), target: DOM Element, enabledTest: func -> bool} - optionStr: 'default'|'layer'|'image'\r\n * @constructor\r\n */\r\nexport function KlImageDropper(p) {\r\n\r\n    //set up DOM\r\n    let rootEl = BB.el({\r\n        content: 'Drop to import',\r\n        css: {\r\n            paddingTop: '100px',\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n            background: 'rgba(50, 50, 50, 0.7)',\r\n            color: '#fff',\r\n            textShadow: '2px 2px #000',\r\n            textAlign: 'center',\r\n            fontSize: '25px'\r\n        }\r\n    });\r\n    let wrapperEl = BB.el({\r\n        css: {\r\n            'marginTop': '50px',\r\n            'display': 'flex',\r\n            'justifyContent': 'center'\r\n        }\r\n    });\r\n    let optionStyle = {\r\n        width: '200px',\r\n        padding: '50px',\r\n        margin: '10px',\r\n        //opacity: 0.5,\r\n        borderRadius: '20px',\r\n        border: '1px dashed #fff',\r\n        background: '#00aefe',\r\n        fontWeight: 'bold'\r\n    };\r\n    let optionLayerEl = BB.el({\r\n        content: 'As Layer',\r\n        css: optionStyle\r\n    });\r\n    let optionImageEl = BB.el({\r\n        content: 'As New Image',\r\n        css: optionStyle\r\n    });\r\n\r\n    rootEl.appendChild(wrapperEl);\r\n    wrapperEl.appendChild(optionLayerEl);\r\n    wrapperEl.appendChild(optionImageEl);\r\n\r\n\r\n    let rootCounter = 0;\r\n    let optionLayerCounter = 0;\r\n    let optionImageCounter = 0;\r\n\r\n    function destroy() {\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        try {\r\n            p.target.removeChild(rootEl);\r\n        } catch (e) { }\r\n    }\r\n\r\n    function testAcceptType(event) {\r\n        try {\r\n            return !event.dataTransfer.types.includes('text/plain');\r\n        } catch(e) {\r\n\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function updateOptions() {\r\n        let boxShadow = '0 0 20px 4px #fff';\r\n        if (optionLayerCounter > 0) {\r\n            optionLayerEl.style.boxShadow = boxShadow;\r\n            optionImageEl.style.boxShadow = '';\r\n        } else if (optionImageCounter > 0) {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = boxShadow;\r\n        } else {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = '';\r\n        }\r\n    }\r\n\r\n    BB.addEventListener(optionLayerEl,'dragenter', function() {\r\n        optionLayerCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionLayerEl,'dragleave', function() {\r\n        optionLayerCounter--;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragenter', function() {\r\n        optionImageCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragleave', function() {\r\n        optionImageCounter--;\r\n        updateOptions();\r\n    });\r\n\r\n\r\n    function rootDragOver(event) {\r\n        if (!testAcceptType(event)) {\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n    }\r\n    function rootDragEnter(event) {\r\n        if (!p.enabledTest() || !testAcceptType(event)) {\r\n            return;\r\n        }\r\n        if (rootCounter === 0) {\r\n            p.target.appendChild(rootEl);\r\n        }\r\n        rootCounter++;\r\n\r\n    }\r\n    function rootDragLeave(event) {\r\n        if (!testAcceptType(event) || rootCounter === 0) {\r\n            return;\r\n        }\r\n        rootCounter = Math.max(0, rootCounter - 1);\r\n        if (rootCounter === 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n\r\n    }\r\n    function rootDrop(event) {\r\n        if (!testAcceptType(event) || event.dataTransfer.files.length === 0) {\r\n            destroy();\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n\r\n        let optionStr = 'default';\r\n        if (optionLayerCounter > 0) {\r\n            optionStr = 'layer';\r\n        } else if (optionImageCounter > 0) {\r\n            optionStr = 'image';\r\n        }\r\n\r\n        p.onDrop(event.dataTransfer.files, optionStr);\r\n\r\n\r\n        if (rootCounter > 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        updateOptions();\r\n    }\r\n\r\n    BB.addEventListener(window,'dragover', rootDragOver, false);\r\n    BB.addEventListener(window,'dragenter', rootDragEnter, false);\r\n    BB.addEventListener(window,'dragleave', rootDragLeave, false);\r\n    BB.addEventListener(window,'drop', rootDrop, false);\r\n\r\n    // if something goes wrong and you're stuck with overlay\r\n    BB.addEventListener(rootEl, 'pointerdown', function() {\r\n        destroy();\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr) {\r\n            if (rootCounter > 0 && keyStr === 'esc') {\r\n                destroy();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KlSmallColorSlider} from '../base-components/kl-color-slider-small';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {BrushSettingService} from '../../brushes-ui/brush-setting-service';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Compressed HUD toolspace. When you hold ctrl+alt.\r\n * small color picker, brush settings\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function OverlayToolspace(\r\n    p: {\r\n        brushSettingService: BrushSettingService; // to sync with outside\r\n        enabledTest: () => boolean; // calls to see if it's allowed to show\r\n    }\r\n) {\r\n\r\n    const sizeObj = {\r\n        width: 150,\r\n        svHeight: 90,\r\n        hHeight: 20,\r\n        sliderHeight: 25\r\n    };\r\n\r\n    let isVisible = false;\r\n    const div = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            left: '500px',\r\n            top: '500px',\r\n            background: 'rgb(221, 221, 221)',\r\n            display: 'none',\r\n            border: '1px solid #fff',\r\n            boxShadow: '0 0 10px rgba(0,0,0,0.5)',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    const queuedObj = {\r\n        color: null,\r\n        size: null,\r\n        opacity: null\r\n    };\r\n\r\n\r\n    // --- inputs ---\r\n\r\n    //color selection\r\n    const colorSlider = new KlSmallColorSlider({\r\n        width: sizeObj.width,\r\n        heightSV: sizeObj.svHeight,\r\n        heightH: sizeObj.hHeight,\r\n        color: p.brushSettingService.getColor(),\r\n        callback: function (rgbObj) {\r\n            selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\r\n            p.brushSettingService.setColor(rgbObj, subscriptionFunc);\r\n        }\r\n    });\r\n    const selectedColorEl = BB.el({\r\n        css: {\r\n            width: sizeObj.width + 'px',\r\n            height: sizeObj.hHeight + 'px',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    {\r\n        const initialColor = p.brushSettingService.getColor();\r\n        selectedColorEl.style.backgroundColor = \"rgb(\" + initialColor.r + \",\" + initialColor.g + \",\" + initialColor.b + \")\";\r\n    }\r\n\r\n    div.appendChild(selectedColorEl);\r\n    div.appendChild(colorSlider.getElement());\r\n\r\n\r\n    function updateColor(rgbObj) {\r\n        colorSlider.setColor(rgbObj);\r\n        selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    //brushsize slider\r\n\r\n    const sizeSlider = new KlSlider({\r\n        label: LANG('brush-size'),\r\n        width: sizeObj.width,\r\n        height: sizeObj.sliderHeight,\r\n        min: 0,\r\n        max: 500,\r\n        value: 50,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        toDisplayValue: (val) => val * 2,\r\n        toValue: (displayValue) => displayValue / 2,\r\n        onChange: function(v) {\r\n            p.brushSettingService.setSize(v);\r\n        },\r\n        formatFunc: (displayValue) => {\r\n            if (displayValue < 10) {\r\n                return BB.round(displayValue, 1);\r\n            } else {\r\n                return Math.round(displayValue);\r\n            }\r\n        },\r\n    });\r\n    BB.css(sizeSlider.getElement(), {\r\n        marginTop: '2px'\r\n    });\r\n    div.appendChild(sizeSlider.getElement());\r\n\r\n    const opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: sizeObj.width,\r\n        height: sizeObj.sliderHeight,\r\n        min: 0,\r\n        max: 1,\r\n        value: 1,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        toDisplayValue: (val) => val * 100,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        onChange: function(v) {\r\n            p.brushSettingService.setOpacity(v);\r\n        },\r\n    });\r\n    BB.css(opacitySlider.getElement(), {\r\n        margin: '2px 0'\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n\r\n\r\n    // --- general setup ---\r\n\r\n    const subscriptionFunc = function(event) {\r\n        if (event.type === 'color') {\r\n            if (!isVisible) {\r\n                queuedObj.color = event.value;\r\n            } else {\r\n                updateColor(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'size') {\r\n            if (!isVisible) {\r\n                queuedObj.size = event.value;\r\n            } else {\r\n                sizeSlider.setValue(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'opacity') {\r\n            if (!isVisible) {\r\n                queuedObj.opacity = event.value;\r\n            } else {\r\n                opacitySlider.setValue(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'sliderConfig') {\r\n            sizeSlider.update(event.value.sizeSlider);\r\n            opacitySlider.update(event.value.opacitySlider);\r\n        }\r\n    };\r\n    p.brushSettingService.subscribe(subscriptionFunc);\r\n    {\r\n        const sliderConfig = p.brushSettingService.getSliderConfig();\r\n        sizeSlider.update(sliderConfig.sizeSlider);\r\n        opacitySlider.update(sliderConfig.opacitySlider);\r\n        sizeSlider.setValue(p.brushSettingService.getSize());\r\n        opacitySlider.setValue(p.brushSettingService.getOpacity());\r\n    }\r\n\r\n    function updateUI() {\r\n\r\n        // unfocus manual slider input\r\n        BB.unfocusAnyInput();\r\n\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible && mousePos) {\r\n            div.style.left = (mousePos.x - Math.round(sizeObj.width / 2)) + 'px';\r\n            div.style.top = (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px';\r\n        }\r\n    }\r\n\r\n    let mousePos = null;\r\n    BB.addEventListener(document, 'pointermove', function(event) {\r\n        mousePos = {\r\n            x: event.pageX,\r\n            y: event.pageY,\r\n        };\r\n    });\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, event, comboStr, isRepeat) {\r\n            if (isRepeat) {\r\n                return;\r\n            }\r\n            if (isVisible) {\r\n                isVisible = false;\r\n                updateUI();\r\n                return;\r\n            }\r\n\r\n            if (!p.enabledTest() || !mousePos) {\r\n                return;\r\n            }\r\n\r\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\r\n                event.preventDefault();\r\n                isVisible = true;\r\n\r\n                if (queuedObj.color !== null) {\r\n                    updateColor(queuedObj.color);\r\n                    queuedObj.color = null;\r\n                }\r\n                if (queuedObj.size !== null) {\r\n                    sizeSlider.setValue(queuedObj.size);\r\n                    queuedObj.size = null;\r\n                }\r\n                if (queuedObj.opacity !== null) {\r\n                    opacitySlider.setValue(queuedObj.opacity);\r\n                    queuedObj.opacity = null;\r\n                }\r\n\r\n                updateUI();\r\n            }\r\n\r\n        },\r\n        onUp: function(keyStr, event, oldComboStr) {\r\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\r\n                isVisible = false;\r\n                colorSlider.end();\r\n                updateUI();\r\n            }\r\n        },\r\n        onBlur: function() {\r\n            if (isVisible) {\r\n                isVisible = false;\r\n                colorSlider.end();\r\n                updateUI();\r\n            }\r\n        }\r\n    });\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * Topmost row of buttons in toolspace (with the app logo)\r\n *\r\n * p = { // button click callbacks\r\n *      logoImg: img,\r\n *     onLogo: function(),\r\n *     onNew: function(),\r\n *     onImport: function(),\r\n *     onSave: function(),\r\n *     onShare: function(),\r\n *     onHelp: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceTopRow(p) {\r\n    let div = document.createElement('div');\r\n    BB.css(div, {\r\n        height: '36px',\r\n        //background: '#f00',\r\n        display: 'flex',\r\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n    });\r\n\r\n    function createButton(p) {\r\n        let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n        let result = BB.el({\r\n            className: 'toolspace-row-button nohighlight',\r\n            title: p.title,\r\n            onClick: p.onClick,\r\n            css: {\r\n                padding: p.contain ? padding + 'px 0' : ''\r\n            }\r\n        });\r\n        let im = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: p.contain ? 'contain' : '',\r\n                //filter: 'grayscale(1)',\r\n                height: '100%'\r\n            }\r\n        });\r\n        im.style.pointerEvents = 'none';\r\n        result.appendChild(im);\r\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: result,\r\n            onEnterLeave: function(isOver) {\r\n                result.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n\r\n    let logoButton = createButton({\r\n        onClick: p.onLogo,\r\n        title: LANG('home'),\r\n        image: p.logoImg ? p.logoImg : klecksLogoImg,\r\n        contain: true\r\n    });\r\n    logoButton.style.width = '45px';\r\n    logoButton.style.borderRight = '1px solid rgb(212, 212, 212)';\r\n    let newButton = createButton({\r\n        onClick: p.onNew,\r\n        title: LANG('file-new'),\r\n        image: newImageImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n    let importButton = createButton({\r\n        onClick: p.onImport,\r\n        title: LANG('file-import'),\r\n        image: importImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n    let saveButton = createButton({\r\n        onClick: p.onSave,\r\n        title: LANG('file-save'),\r\n        image: exportImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n\r\n    let shareButton = null;\r\n    if (BB.canShareFiles()) {\r\n        shareButton = createButton({\r\n            onClick: p.onShare,\r\n            title: LANG('file-share'),\r\n            image: shareImg,\r\n            contain: true\r\n        });\r\n    }\r\n    let helpButton = createButton({\r\n        onClick: p.onHelp,\r\n        title: LANG('help'),\r\n        image: helpImg,\r\n        contain: true\r\n    });\r\n\r\n    div.appendChild(logoButton);\r\n    div.appendChild(newButton);\r\n    div.appendChild(importButton);\r\n    div.appendChild(saveButton);\r\n    if (shareButton) {\r\n        div.appendChild(shareButton);\r\n    }\r\n    div.appendChild(helpButton);\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    }\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eHdqz\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3x5dR\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hbDTd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"16iGk\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2ME3z\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hZnSk\");","import {BB} from '../../../bb/bb';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolGradientImg from 'url:~/src/app/img/ui/tool-gradient.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport caretDownImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\r\n *\r\n * p = {\r\n *     onChange: func(activeStr)\r\n * }\r\n *\r\n * activeStr = 'draw' | 'fill' | 'text' | 'shape' | 'gradient'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolDropdown(p) {\r\n\r\n    let optionArr = ['draw', 'fill', 'gradient', 'text', 'shape'];\r\n    let imArr = [\r\n        toolPaintImg,\r\n        toolFillImg,\r\n        toolGradientImg,\r\n        toolTextImg,\r\n        toolShapeImg\r\n    ];\r\n    let titleArr = [\r\n        `${LANG('tool-brush')} [B]`,\r\n        `${LANG('tool-paint-bucket')} [G]`,\r\n        `${LANG('tool-gradient')} [G]`,\r\n        `${LANG('tool-text')} [T]`,\r\n        `${LANG('tool-shape')} [U]`,\r\n    ];\r\n    let currentActiveIndex = 0;\r\n    let isActive = true;\r\n    let isOpen = false;\r\n\r\n    //preload images\r\n    setTimeout(function() {\r\n        for (let i = 1; i < imArr.length; i++) {\r\n            let im = new Image();\r\n            im.src = imArr[i];\r\n        }\r\n    }, 100);\r\n\r\n    let smallMargin = '6px 0';\r\n    let div = BB.el({\r\n        css: {\r\n            position: 'relative',\r\n            flexGrow: '1'\r\n        }\r\n    });\r\n\r\n    let openTimeout;\r\n    let isDragging = false;\r\n    let startX, startY;\r\n    let pointerListener;\r\n    if (BB.hasPointerEvents) {\r\n        pointerListener = new BB.PointerListener({\r\n            target: div,\r\n            maxPointers: 1,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n                    if (isOpen) {\r\n                        return;\r\n                    }\r\n\r\n                    openTimeout = setTimeout(function() {\r\n                        showDropdown();\r\n                    }, 400);\r\n                    isDragging = true;\r\n                    startX = event.pageX;\r\n                    startY = event.pageY;\r\n\r\n                } else if (event.type === 'pointermove') {\r\n                    if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\r\n                        clearTimeout(openTimeout);\r\n                        showDropdown();\r\n                    }\r\n\r\n                } else if (event.type === 'pointerup') {\r\n                    clearTimeout(openTimeout);\r\n                    if (isOpen && isDragging) {\r\n                        let target = document.elementFromPoint(event.pageX, event.pageY);\r\n                        for (let i = 0; i < dropdownBtnArr.length; i++) {\r\n                            if (target === dropdownBtnArr[i].wrapper) {\r\n                                closeDropdown();\r\n                                isActive = true;\r\n                                currentActiveIndex = i;\r\n                                updateButton();\r\n                                p.onChange(optionArr[currentActiveIndex]);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    isDragging = false;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    let activeButton = BB.el({\r\n        parent: div,\r\n        className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\r\n        title: titleArr[currentActiveIndex],\r\n        onClick: function(e) {\r\n            if (isActive && !isOpen) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                showDropdown();\r\n                return;\r\n            }\r\n\r\n            isActive = true;\r\n            p.onChange(optionArr[currentActiveIndex]);\r\n            if (isOpen) {\r\n                closeDropdown();\r\n            }\r\n        },\r\n        css: {\r\n            padding: '10px 0',\r\n            pointerEvents: 'auto',\r\n            height: '100%',\r\n            boxSizing: 'border-box'\r\n        }\r\n    });\r\n\r\n    let activeButtonIm = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: 'contain',\r\n            width: 'calc(100% - 7px)',\r\n            height: '100%',\r\n            pointerEvents: 'none',\r\n            opacity: '0.75',\r\n        }\r\n    });\r\n\r\n    let arrowButton = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            position: 'absolute',\r\n            right: '1px',\r\n            bottom: '1px',\r\n            width: '18px',\r\n            height: '18px',\r\n            //background: '#aaa',\r\n            //borderRadius: '2px',\r\n            cursor: 'pointer',\r\n\r\n            backgroundImage: 'url(\\'' + caretDownImg + '\\')',\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: '60%'\r\n        },\r\n        title: 'More Tools',\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            showDropdown();\r\n        }\r\n    });\r\n\r\n\r\n    let overlay = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            //background: 'rgba(255,0,0,0.5)',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0'\r\n        }\r\n    });\r\n    let overlayPointerListener = new BB.PointerListener({\r\n        target: overlay,\r\n        pointers: 1,\r\n        onPointer: function(e) {\r\n            if (e.type === 'pointerdown') {\r\n                e.eventPreventDefault();\r\n                closeDropdown();\r\n            }\r\n        }\r\n    });\r\n\r\n    let dropdownWrapper = BB.el({\r\n        className: 'tool-dropdown-wrapper',\r\n        css: {\r\n            position: 'absolute',\r\n            width: '100%',\r\n            height: (100 * (optionArr.length - 1)) + '%',\r\n            top: '100%',\r\n            left: '0',\r\n            zIndex: '1',\r\n            boxSizing: 'border-box',\r\n            cursor: 'pointer',\r\n            transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\r\n            borderBottomLeftRadius: '5px',\r\n            borderBottomRightRadius: '5px',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n\r\n    let dropdownBtnArr = [];\r\n\r\n    function createDropdownButton(p) {\r\n        let result = {};\r\n\r\n        let wrapper = BB.el({\r\n            parent: dropdownWrapper,\r\n            className: 'tool-dropdown-button',\r\n            title: p.title,\r\n            css: {\r\n                padding: '10px 0',\r\n                height: (100 / (optionArr.length - 1)) + '%',\r\n                boxSizing: 'border-box'\r\n            },\r\n            onClick: function(e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                p.onClick(p.index, p.id);\r\n            }\r\n        });\r\n        (result as any).wrapper = wrapper;\r\n        let im = BB.el({\r\n            parent: wrapper,\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: 'contain',\r\n                height: '100%',\r\n                pointerEvents: 'none',\r\n                opacity: '0.75'\r\n            }\r\n        });\r\n\r\n        // --- interface ---\r\n        (result as any).show = function(b) {\r\n            wrapper.style.display = b ? 'block' : 'none';\r\n        };\r\n\r\n        (result as any).setIsSmall = function(b) {\r\n            wrapper.style.padding = b ? smallMargin : '10px 0';\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function onClickDropdownBtn(index, id) {\r\n        closeDropdown();\r\n\r\n        isActive = true;\r\n        currentActiveIndex = index;\r\n\r\n        updateButton();\r\n\r\n        p.onChange(optionArr[currentActiveIndex]);\r\n    }\r\n\r\n    for (let i = 0; i < optionArr.length; i++) {\r\n        dropdownBtnArr.push(createDropdownButton({\r\n            index: i,\r\n            id: optionArr[i],\r\n            image: imArr[i],\r\n            title: titleArr[i],\r\n            onClick: onClickDropdownBtn\r\n        }));\r\n    }\r\n\r\n    function showDropdown() {\r\n        dialogCounter.increase(0.5);\r\n        isOpen = true;\r\n\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].show(currentActiveIndex !== i);\r\n        }\r\n\r\n        arrowButton.style.display = 'none';\r\n        div.style.zIndex = '1';\r\n        document.body.appendChild(overlay);\r\n        div.appendChild(dropdownWrapper);\r\n    }\r\n\r\n    function closeDropdown() {\r\n        dialogCounter.decrease(0.5);\r\n        isOpen = false;\r\n        arrowButton.style.removeProperty('display');\r\n        div.style.removeProperty('z-index');\r\n        document.body.removeChild(overlay);\r\n\r\n        div.removeChild(dropdownWrapper);\r\n    }\r\n\r\n    function updateButton() {\r\n        activeButton.title = titleArr[currentActiveIndex];\r\n        activeButtonIm.style.backgroundImage = 'url(\\'' + imArr[currentActiveIndex] + '\\')';\r\n    }\r\n    updateButton();\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setIsSmall = function(b) {\r\n        activeButton.style.padding = b ? smallMargin : '10px 0';\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].setIsSmall(b);\r\n        }\r\n        if (b) {\r\n            arrowButton.style.width = '14px';\r\n            arrowButton.style.height = '14px';\r\n        } else {\r\n            arrowButton.style.width = '18px';\r\n            arrowButton.style.height = '18px';\r\n        }\r\n    };\r\n\r\n    this.setActive = function(activeStr) {\r\n        if (optionArr.includes(activeStr)) {\r\n            isActive = true;\r\n            for (let i = 0; i < optionArr.length; i++) {\r\n                if (optionArr[i] === activeStr) {\r\n                    currentActiveIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n            activeButton.classList.add('toolspace-row-button-activated');\r\n            updateButton();\r\n        } else {\r\n            isActive = false;\r\n            activeButton.classList.remove('toolspace-row-button-activated');\r\n        }\r\n    };\r\n\r\n    this.getActive = function() {\r\n        return optionArr[currentActiveIndex];\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6mHrC\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hS5Hj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"4KGfM\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"doX4v\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7NqHO\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dz3mY\");","import {BB} from '../../../bb/bb';\r\nimport {ToolDropdown} from './tool-dropdown';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\n// @ts-ignore\r\nimport toolUndoImg from 'url:~/src/app/img/ui/tool-undo.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\r\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\r\n * heights: 54px tall, 36px small -> via setIsSmall\r\n *\r\n * p = {\r\n *     onActivate: function(activeStr), // clicking on tool button - activating it\r\n *     onZoomIn: function(),\r\n *     onZoomOut: function(),\r\n *     onUndo: function(),\r\n *     onRedo: function(),\r\n * }\r\n *\r\n * activeStr = 'draw' | 'hand' | 'fill' | 'text'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceToolRow(p) {\r\n    let div = document.createElement('div');\r\n    BB.css(div, {\r\n        height: '54px',\r\n        //height: '36px',\r\n        display: 'flex',\r\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n    });\r\n\r\n    let currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\r\n\r\n    function setActive(activeStr, doEmit?) {\r\n        if (currentActiveStr === activeStr) {\r\n            return;\r\n        }\r\n\r\n        currentActiveStr = activeStr;\r\n\r\n        toolDropdown.setActive(currentActiveStr);\r\n        handButton.classList.toggle('toolspace-row-button-activated', currentActiveStr === 'hand');\r\n\r\n        if (doEmit) {\r\n            p.onActivate(currentActiveStr);\r\n        }\r\n    }\r\n\r\n    function createButton(p) {\r\n\r\n        let smallMargin = p.doLighten ? '6px 0' : '8px 0';\r\n\r\n        let result = BB.el({\r\n            className: 'toolspace-row-button nohighlight',\r\n            //title: p.title,\r\n            onClick: p.onClick,\r\n            css: {\r\n                padding: p.contain ? '10px 0' : ''\r\n            }\r\n        });\r\n        let im = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: p.contain ? 'contain' : '',\r\n                //filter: 'grayscale(1)',\r\n                height: '100%',\r\n                transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none',\r\n                opacity: p.doLighten ? '0.75' : '1'\r\n            }\r\n        });\r\n        result.appendChild(im);\r\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: result,\r\n            onEnterLeave: function(isOver) {\r\n                result.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n        (result as any).setIsSmall = function(b) {\r\n            result.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\r\n        }\r\n        return result;\r\n    }\r\n\r\n\r\n    function createTriangleButton(p) { // because IE and Edge don't support clip path\r\n\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n        let svg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '67px', // can't think of a way doing with percentage\r\n            height: '54px',\r\n            viewBox: '0 0 100 100',\r\n            preserveAspectRatio: 'none'\r\n        });\r\n        BB.css(svg, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n\r\n        let blurRadius = 10;\r\n        let blurOffsetX = 2;\r\n        let blurOffsetY = 2;\r\n\r\n        let defs = BB.createSvg( { // inset shadow via svg\r\n            elementType: 'defs',\r\n            childrenArr: [\r\n                {\r\n                    elementType: 'filter',\r\n                    id: 'innershadow',\r\n                    x0: '-50%',\r\n                    y0: '-50%',\r\n                    width: '200%',\r\n                    height: '200%',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'SourceAlpha',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceAlpha',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceGraphic',\r\n                            operator: 'over',\r\n                            result: 'firstfilter'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'firstfilter',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur2'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'over'\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        });\r\n\r\n\r\n        let svgTriangleLeft = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M0,0 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleLeft.onclick = function() {\r\n            p.onLeft();\r\n            svgTriangleLeft.classList.remove('toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        let svgTriangleRight = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M100,100 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleRight.onclick = function() {\r\n            p.onRight();\r\n            svgTriangleRight.classList.remove('toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: svgTriangleLeft,\r\n            onEnterLeave: function(isOver) {\r\n                svgTriangleLeft.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: svgTriangleRight,\r\n            onEnterLeave: function(isOver) {\r\n                svgTriangleRight.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n            }\r\n        });\r\n\r\n\r\n        svg.appendChild(defs);\r\n        svg.appendChild(svgTriangleLeft);\r\n        svg.appendChild(svgTriangleRight);\r\n        result.appendChild(svg);\r\n\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(leftIm);\r\n\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(rightIm);\r\n\r\n\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            svgTriangleLeft.classList.toggle('toolspace-row-button-disabled', !b);\r\n            leftIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            svgTriangleRight.classList.toggle('toolspace-row-button-disabled', !b);\r\n            rightIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function createTriangleButtonViaClipPath(p) {\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n\r\n        let leftButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onLeft,\r\n            css: {\r\n                clipPath: 'polygon(0% 0%, 100% 0%, 100% 0%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        leftButton.appendChild(leftIm);\r\n\r\n\r\n\r\n        let rightButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onRight,\r\n            css: {\r\n                clipPath: 'polygon(0% 100%, 100% 0%, 100% 100%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        rightButton.appendChild(rightIm);\r\n\r\n\r\n\r\n        result.appendChild(leftButton);\r\n        result.appendChild(rightButton);\r\n\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: leftButton,\r\n            onEnterLeave: function(isOver) {\r\n                leftButton.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: rightButton,\r\n            onEnterLeave: function(isOver) {\r\n                rightButton.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            leftButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            rightButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n        return result;\r\n    }\r\n\r\n    let toolDropdown = new ToolDropdown({\r\n        onChange: function(activeStr) {\r\n            setActive(activeStr, true);\r\n        }\r\n    });\r\n    div.appendChild(toolDropdown.getElement());\r\n\r\n    let handButton = createButton({\r\n        onClick: function() {\r\n            setActive('hand', true);\r\n        },\r\n        image: toolHandImg,\r\n        contain: true,\r\n        doLighten: true\r\n    });\r\n    handButton.style.borderRight = '1px solid rgb(212, 212, 212)';\r\n    handButton.title = LANG('tool-hand');\r\n    div.appendChild(handButton);\r\n\r\n    let zoomInNOutButton = createTriangleButton({\r\n        onLeft: p.onZoomIn,\r\n        onRight: p.onZoomOut,\r\n        leftImage: toolZoomInImg,\r\n        rightImage: toolZoomOutImg,\r\n    });\r\n    zoomInNOutButton.title = LANG('tool-zoom');\r\n    div.appendChild(zoomInNOutButton);\r\n\r\n    let zoomInButton = createButton({\r\n        onClick: p.onZoomIn,\r\n        image: toolZoomInImg,\r\n        contain: true\r\n    });\r\n    zoomInButton.title = LANG('zoom-in');\r\n    div.appendChild(zoomInButton);\r\n\r\n    let zoomOutButton = createButton({\r\n        onClick: p.onZoomOut,\r\n        image: toolZoomOutImg,\r\n        contain: true\r\n    });\r\n    zoomOutButton.title = LANG('zoom-out');\r\n    div.appendChild(zoomOutButton);\r\n\r\n    let undoNRedoButton = createTriangleButton({\r\n        onLeft: p.onUndo,\r\n        onRight: p.onRedo,\r\n        leftImage: toolUndoImg,\r\n        rightImage: null,\r\n    });\r\n    undoNRedoButton.title = LANG('tool-undo-redo');\r\n    (undoNRedoButton as any).setIsEnabledLeft(false);\r\n    (undoNRedoButton as any).setIsEnabledRight(false);\r\n    div.appendChild(undoNRedoButton);\r\n\r\n    let undoButton = createButton({\r\n        onClick: p.onUndo,\r\n        image: toolUndoImg,\r\n        contain: true\r\n    });\r\n    undoButton.title = LANG('undo');\r\n    undoButton.classList.add('toolspace-row-button-disabled');\r\n    div.appendChild(undoButton);\r\n\r\n    let redoButton = createButton({\r\n        onClick: p.onRedo,\r\n        image: toolUndoImg,\r\n        contain: true,\r\n        doMirror: true\r\n    });\r\n    redoButton.title = LANG('redo');\r\n    redoButton.classList.add('toolspace-row-button-disabled');\r\n    div.appendChild(redoButton);\r\n\r\n    zoomInButton.style.display = 'none';\r\n    zoomOutButton.style.display = 'none';\r\n    undoButton.style.display = 'none';\r\n    redoButton.style.display = 'none';\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.setIsSmall = function(b) {\r\n        BB.css(div, {\r\n            height: b ? '36px' : '54px'\r\n        });\r\n\r\n        toolDropdown.setIsSmall(b);\r\n        (handButton as any).setIsSmall(b);\r\n        (zoomInButton as any).setIsSmall(b);\r\n        (zoomOutButton as any).setIsSmall(b);\r\n        (undoButton as any).setIsSmall(b);\r\n        (redoButton as any).setIsSmall(b);\r\n\r\n        if (b) {\r\n            zoomInNOutButton.style.display = 'none';\r\n            undoNRedoButton.style.display = 'none';\r\n            zoomInButton.style.display = 'block';\r\n            zoomOutButton.style.display = 'block';\r\n            undoButton.style.display = 'block';\r\n            redoButton.style.display = 'block';\r\n        } else {\r\n            zoomInNOutButton.style.display = 'block';\r\n            undoNRedoButton.style.display = 'block';\r\n            zoomInButton.style.display = 'none';\r\n            zoomOutButton.style.display = 'none';\r\n            undoButton.style.display = 'none';\r\n            redoButton.style.display = 'none';\r\n        }\r\n\r\n    };\r\n\r\n    this.setEnableZoomIn = function(b) {\r\n        zoomInButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (zoomInNOutButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableZoomOut = function(b) {\r\n        zoomOutButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (zoomInNOutButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setEnableUndo = function(b) {\r\n        undoButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (undoNRedoButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableRedo = function(b) {\r\n        redoButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (undoNRedoButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setActive = function(activeStr) {\r\n        setActive(activeStr);\r\n    };\r\n    this.getActive = function() {\r\n        return currentActiveStr;\r\n    };\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2gZH2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"04ZZm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"j9xio\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"AnO0a\");","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../base-components/select';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui to select stabilizer level. 4 options. returned as 0-3\r\n *\r\n * p = {\r\n *     smoothing: number, // initial level 0-3\r\n *     onSelect: function(level number) // 0-3, when level changes\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceStabilizerRow(p) {\r\n\r\n    let div = BB.el({\r\n        tagName: 'label',\r\n        content: LANG('stabilizer') + '&nbsp;',\r\n        title: LANG('stabilizer-title'),\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            fontSize: '13px',\r\n            color: 'rgba(0,0,0,0.6)'\r\n        }\r\n    });\r\n\r\n    let strengthSelect = new Select({\r\n        optionArr: [\r\n            ['0', '0'],\r\n            ['1', '1'],\r\n            ['2', '2'],\r\n            ['3', '3'],\r\n            ['4', '4'],\r\n            ['5', '5']\r\n        ],\r\n        initValue: p.smoothing,\r\n        onChange: function(val) {\r\n            p.onSelect(parseInt(val));\r\n        }\r\n    });\r\n    div.appendChild(strengthSelect.getElement());\r\n\r\n    let pointerListener = new BB.PointerListener({\r\n        target: div,\r\n        onWheel: function(e) {\r\n            strengthSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport invertedBorderImg from 'url:~/src/app/img/ui/inverted-border.svg';\r\n\r\n/**\r\n * row of tabs. uses css class .tabrow-tab\r\n *\r\n * p = {\r\n *     initialId: string, // e.g. 'draw'\r\n *     useAccent: boolean,\r\n *     tabArr: [\r\n *         {\r\n *             id: string, // e.g. 'draw',\r\n *             label: string, // optional\r\n *             image: string, // optional background image\r\n *             title: string, // optional\r\n *             isVisible: boolean, // optional - default is true\r\n *             onOpen: function(),\r\n *             onClose: function(),\r\n *             css: {...},\r\n *         }\r\n *     ]\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function TabRow(p) {\r\n    let _this = this;\r\n    let height = 35;\r\n    let div = BB.el({\r\n        className: 'tabrow',\r\n        css: {\r\n            height: height + 'px'\r\n        }\r\n    });\r\n\r\n    let tabArr = []; //creates its own internal arr\r\n    let openedTabObj = null;\r\n\r\n    const roundSize = 10;\r\n    const roundRight = BB.el({\r\n        css: {\r\n            width: roundSize + 'px',\r\n            height: roundSize + 'px',\r\n            backgroundImage: `url('${invertedBorderImg}')`,\r\n            backgroundSize: 'cover',\r\n            position: 'absolute',\r\n            right: -roundSize + 'px',\r\n            bottom: '0',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n    const roundLeft = BB.el({\r\n        css: {\r\n            width: roundSize + 'px',\r\n            height: roundSize + 'px',\r\n            backgroundImage: `url('${invertedBorderImg}')`,\r\n            backgroundSize: 'cover',\r\n            position: 'absolute',\r\n            left: -roundSize + 'px',\r\n            bottom: '0',\r\n            transform: 'scale(-1,1)',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n\r\n    function createTab(pTabObj, initialId, useAccent) {\r\n        let result: any = {\r\n            id: pTabObj.id,\r\n            isVisible: 'isVisible' in pTabObj ? pTabObj.isVisible : true,\r\n            onOpen: pTabObj.onOpen,\r\n            onClose: pTabObj.onClose,\r\n            update: function(openedTabObj) {\r\n                tabDiv.className = openedTabObj === result ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab';\r\n                tabDiv.style.display = result.isVisible ? 'block' : 'none';\r\n            }\r\n        };\r\n        let tabDiv = BB.el({\r\n            content: 'label' in pTabObj ? pTabObj.label : '',\r\n            title: 'title' in pTabObj ? pTabObj.title : undefined,\r\n            className: initialId === result.id ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab',\r\n            css: {\r\n                lineHeight: height + 'px',\r\n                display: result.isVisible ? 'block' : 'none',\r\n                zIndex: '0',\r\n            },\r\n            onClick: function() {\r\n                if (openedTabObj === result) {\r\n                    return;\r\n                }\r\n                _this.open(result.id);\r\n            }\r\n        });\r\n        result.div = tabDiv;\r\n        if ('image' in pTabObj) {\r\n            BB.css(tabDiv, {\r\n                backgroundImage: 'url(\\'' + pTabObj.image + '\\')',\r\n                backgroundSize: (height - 7) + 'px'\r\n            });\r\n        }\r\n        if ('css' in pTabObj) {\r\n            BB.css(tabDiv, pTabObj.css);\r\n        }\r\n        div.appendChild(tabDiv);\r\n\r\n        let pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: tabDiv,\r\n            onEnterLeave: function(isOver) {\r\n                tabDiv.classList.toggle('tabrow-tab-hover', isOver);\r\n            }\r\n        });\r\n\r\n        if (initialId === result.id) {\r\n            result.onOpen();\r\n            result.div.appendChild(roundRight);\r\n            result.div.appendChild(roundLeft);\r\n        } else {\r\n            result.onClose();\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    for (let i = 0; i < p.tabArr.length; i++) {\r\n        tabArr.push(createTab(p.tabArr[i], p.initialId, p.useAccent));\r\n    }\r\n\r\n    for (let i = 0; i < tabArr.length; i++) {\r\n        if (tabArr[i].id === p.initialId) {\r\n            openedTabObj = tabArr[i];\r\n        }\r\n    }\r\n    if (openedTabObj === null) {\r\n        throw 'invalid initialId';\r\n    }\r\n\r\n    function update() {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            tabArr[i].update(openedTabObj);\r\n        }\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.open = function(tabId) {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            if (tabArr[i].id === tabId) {\r\n                if (openedTabObj === tabArr[i]) { // already open\r\n                    return;\r\n                }\r\n                openedTabObj.onClose();\r\n                openedTabObj = tabArr[i];\r\n                openedTabObj.onOpen();\r\n                openedTabObj.div.appendChild(roundRight);\r\n                openedTabObj.div.appendChild(roundLeft);\r\n                update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.open - invalid tabId';\r\n    };\r\n\r\n    this.getOpenedTabId = function() {\r\n        return '' + openedTabObj.id;\r\n    };\r\n\r\n    this.setIsVisible = function(tabId, isVisible) {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            if (tabArr[i].id === tabId) {\r\n                tabArr[i].isVisible = !!isVisible;\r\n                update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.setIsVisible - invalid tabId';\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"nTvP2\");","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport angleImg from 'url:~/src/app/img/ui/angle.svg';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui, when hand tool tab is open.\r\n *\r\n * p = {\r\n *     scale: number, // initial value\r\n *     angleDeg: number, // initial value\r\n *     onReset: function(),\r\n *     onFit: function(),\r\n *     onAngleChange: function(angleDeg number, isRelative number)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function HandUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n    let scale = p.scale;\r\n    let angleDeg = p.angleDeg;\r\n\r\n    let row1 = BB.el({\r\n        css: {\r\n            marginBottom: '10px',\r\n            display: 'flex'\r\n        }\r\n    });\r\n    let row2 = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            marginBottom: '10px',\r\n        }\r\n    });\r\n    let row3 = BB.el({\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n    div.append(row1, row2, row3);\r\n\r\n\r\n    let scaleEl = BB.el({\r\n        css: {\r\n            width: '55px',\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    row1.appendChild(scaleEl);\r\n\r\n    let angleIm = new Image();\r\n    angleIm.src = angleImg;\r\n    BB.css(angleIm, {\r\n        verticalAlign: 'bottom',\r\n        width: '20px',\r\n        height: '20px',\r\n        marginRight: '5px',\r\n        borderRadius: '10px',\r\n        background: 'rgba(0,0,0,0.2)',\r\n        userSelect: 'none'\r\n    });\r\n    row1.appendChild(angleIm);\r\n\r\n    let angleEl = BB.el({\r\n        css: {\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    row1.appendChild(angleEl);\r\n\r\n\r\n    function update() {\r\n        scaleEl.innerHTML = Math.round(scale * 100) + '%';\r\n        angleEl.innerHTML =  Math.round(angleDeg) + '°';\r\n\r\n\r\n        angleIm.style.transform = 'rotate(' + angleDeg + 'deg)';\r\n        if (angleDeg % 90 === 0) {\r\n            angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\r\n        } else {\r\n            angleIm.style.boxShadow = '';\r\n        }\r\n    }\r\n    update();\r\n\r\n\r\n    let resetButton = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('hand-reset'),\r\n        onClick: p.onReset\r\n    });\r\n    BB.makeUnfocusable(resetButton);\r\n\r\n    let fitButton = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('hand-fit'),\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: p.onFit\r\n    });\r\n    BB.makeUnfocusable(fitButton);\r\n    row2.append(resetButton, fitButton);\r\n\r\n    let leftRotateButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\r\n        onClick: function() {\r\n            p.onAngleChange(-15, true);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(leftRotateButton);\r\n\r\n    let resetAngleButton = BB.el({\r\n        tagName: 'button',\r\n        content: '0°',\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            p.onAngleChange(0);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(resetAngleButton);\r\n\r\n    let rightRotateButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            p.onAngleChange(15, true);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(rightRotateButton);\r\n    row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\r\n\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            update();\r\n        }\r\n    };\r\n    this.update = function(pScale, pAngleDeg) {\r\n        scale = pScale;\r\n        angleDeg = pAngleDeg;\r\n        if (isVisible) {\r\n            update();\r\n        }\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6toXQ\");","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {Select} from '../base-components/select';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Paint Bucket tab contents (color slider, opacity slider, etc)\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function FillUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 1 / 100,\r\n        max: 1,\r\n        value: 1,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        toDisplayValue: (value) => value * 100,\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n    let toleranceSlider = new KlSlider({\r\n        label: LANG('bucket-tolerance'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 0,\r\n        max: 255,\r\n        value: 20 * (255 / 100),\r\n        toValue: (displayValue) => displayValue * (255 / 100),\r\n        toDisplayValue: (value) => value / (255 / 100),\r\n    });\r\n    BB.css(toleranceSlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(toleranceSlider.getElement());\r\n\r\n    let selectRow = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n\r\n    let modeWrapper;\r\n    let modeSelect;\r\n    modeWrapper = BB.el({\r\n        content: LANG('bucket-sample') + '&nbsp;',\r\n        title: LANG('bucket-sample-title'),\r\n        css: {\r\n            fontSize: '15px'\r\n        }\r\n    });\r\n    modeSelect = new Select({\r\n        optionArr: [\r\n            ['all', LANG('bucket-sample-all')],\r\n            ['current', LANG('bucket-sample-active')],\r\n            ['above', LANG('bucket-sample-above')]\r\n        ],\r\n        initValue: 'all',\r\n        onChange: function(val) {}\r\n    });\r\n    let modePointerListener = new BB.PointerListener({\r\n        target: modeSelect.getElement(),\r\n        onWheel: function(e) {\r\n            modeSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n    modeWrapper.appendChild(modeSelect.getElement());\r\n    selectRow.appendChild(modeWrapper);\r\n\r\n    let growWrapper;\r\n    let growSelect;\r\n    growWrapper = BB.el({\r\n        content: LANG('bucket-grow') + '&nbsp;',\r\n        title: LANG('bucket-grow-title'),\r\n        css: {\r\n            fontSize: '15px',\r\n            marginLeft: '10px'\r\n        }\r\n    });\r\n    growSelect = new Select({\r\n        optionArr: [\r\n            ['0', '0'],\r\n            ['1', '1'],\r\n            ['2', '2'],\r\n            ['3', '3'],\r\n            ['4', '4'],\r\n            ['5', '5'],\r\n            ['6', '6'],\r\n            ['7', '7'],\r\n        ],\r\n        initValue: '0',\r\n        onChange: function(val) {}\r\n    });\r\n    let growPointerListener = new BB.PointerListener({\r\n        target: growSelect.getElement(),\r\n        onWheel: function(e) {\r\n            growSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n    growWrapper.appendChild(growSelect.getElement());\r\n    selectRow.appendChild(growWrapper);\r\n\r\n\r\n    let isContiguous = true;\r\n    let contiguousToggle = new Checkbox({\r\n        init: true,\r\n        label: LANG('bucket-contiguous'),\r\n        title: LANG('bucket-contiguous-title'),\r\n        callback: function (b) {\r\n            isContiguous = b;\r\n        },\r\n        css: {\r\n            paddingRight: '5px',\r\n            display: 'inline-block',\r\n            width: '50%',\r\n        }\r\n    });\r\n\r\n    let eraserToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('eraser'),\r\n        callback: function (b) {},\r\n        css: {\r\n\r\n            paddingRight: '5px',\r\n            display: 'inline-block',\r\n            width: '50%',\r\n        }\r\n    });\r\n\r\n    div.append(BB.el({\r\n        content: [\r\n            contiguousToggle.getElement(),\r\n            eraserToggle.getElement(),\r\n        ],\r\n        css: {\r\n            display: 'flex',\r\n            marginTop: '10px',\r\n        }\r\n    }));\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n        }\r\n    };\r\n\r\n    this.getTolerance = function() {\r\n        return toleranceSlider.getValue();\r\n    };\r\n\r\n    this.getOpacity = function() {\r\n        return opacitySlider.getValue();\r\n    };\r\n\r\n    /**\r\n     * returns string 'current' | 'all' | 'above'\r\n     */\r\n    this.getSample = function() {\r\n        return modeSelect.getValue();\r\n    };\r\n\r\n    this.getGrow = function() {\r\n        return parseInt(growSelect.getValue(), 10);\r\n    }\r\n\r\n    this.getContiguous = () => isContiguous;\r\n\r\n    this.getIsEraser = () => eraserToggle.getValue();\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Text Tool tab contents (color slider)\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function TextUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let hint = BB.el({\r\n        parent: div,\r\n        content: LANG('text-instruction'),\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Options} from '../base-components/options';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Shape Tool tab contents\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ShapeUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let previewSize = 35;\r\n    let previewPadding = 8;\r\n    let shape; // 'rect'|'ellipse'|'line'\r\n    let mode; // 'stroke'|'fill'\r\n\r\n\r\n    let rectStrokeSvgRect = BB.createSvg({\r\n        elementType: 'rect',\r\n        x: '' + previewPadding,\r\n        width: '' + (previewSize - previewPadding * 2)\r\n    });\r\n    let rectStrokeSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    rectStrokeSvg.appendChild(rectStrokeSvgRect);\r\n    BB.css(rectStrokeSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    let rectFilledSvgRect = BB.createSvg({\r\n        elementType: 'rect',\r\n        x: '' + previewPadding,\r\n        width: '' + (previewSize - previewPadding * 2)\r\n    });\r\n    let rectFilledSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    rectFilledSvg.appendChild(rectFilledSvgRect);\r\n    BB.css(rectFilledSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n\r\n    let ellipseStrokeSvgEllipse = BB.createSvg({\r\n        elementType: 'ellipse',\r\n        cx: '' + (previewSize / 2),\r\n        cy: '' + (previewSize / 2),\r\n        rx: '' + (previewSize / 2 - previewPadding)\r\n    });\r\n    let ellipseStrokeSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize,\r\n    });\r\n    ellipseStrokeSvg.appendChild(ellipseStrokeSvgEllipse);\r\n    BB.css(ellipseStrokeSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    let ellipseFilledSvgEllipse = BB.createSvg({\r\n        elementType: 'ellipse',\r\n        cx: '' + (previewSize / 2),\r\n        cy: '' + (previewSize / 2),\r\n        rx: '' + (previewSize / 2 - previewPadding)\r\n    });\r\n    let ellipseFilledSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize,\r\n    });\r\n    ellipseFilledSvg.appendChild(ellipseFilledSvgEllipse);\r\n    BB.css(ellipseFilledSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n\r\n    let lineSvgLine = BB.createSvg({\r\n        elementType: 'line',\r\n        x1: '' + previewPadding,\r\n        x2: '' + (previewSize - previewPadding)\r\n    });\r\n    let lineSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    lineSvg.appendChild(lineSvgLine);\r\n    BB.css(lineSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    function updatePreviews() {\r\n        let strokeWidth = BB.clamp(Math.round(lineWidthSlider.getValue() / 10), 1, 10) + 'px';\r\n\r\n        let squish = 1.35;\r\n\r\n        BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n        BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\r\n\r\n        BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n        BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\r\n\r\n        BB.css(\r\n            lineSvgLine,\r\n            { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\r\n        );\r\n\r\n        if ((fixedToggle as any).getValue()) {\r\n            rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\r\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n            rectFilledSvgRect.setAttribute('y', '' + previewPadding);\r\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n\r\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n        } else {\r\n            rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n            rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n\r\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n        }\r\n\r\n        if ((snapToggle as any).getValue()) {\r\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\r\n            lineSvgLine.setAttribute('y2', '' + previewPadding);\r\n        } else {\r\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\r\n            lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\r\n        }\r\n    }\r\n\r\n    let row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'start'\r\n        }\r\n    });\r\n\r\n    let shapeOptions = new Options({\r\n        optionArr: [\r\n            {\r\n                id: 'rect-stroke',\r\n                label: rectStrokeSvg,\r\n                title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\r\n            },\r\n            {\r\n                id: 'ellipse-stroke',\r\n                label: ellipseStrokeSvg,\r\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\r\n            },\r\n            {\r\n                id: 'line',\r\n                label: lineSvg,\r\n                title: LANG('shape-line'),\r\n            },\r\n            {\r\n                id: 'rect-fill',\r\n                label: rectFilledSvg,\r\n                title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\r\n            },\r\n            {\r\n                id: 'ellipse-fill',\r\n                label: ellipseFilledSvg,\r\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\r\n            },\r\n        ],\r\n        initId: 'rect',\r\n        onChange: function(id) {\r\n            let split = id.split('-');\r\n            shape = split[0];\r\n            mode = split[1];\r\n\r\n            BB.css(fixedToggle.getElement(), {\r\n                display: shape === 'line' ? 'none' : null\r\n            });\r\n            BB.css(snapToggle.getElement(), {\r\n                display: shape === 'line' ? null : 'none'\r\n            });\r\n            BB.css(lineWidthSlider.getElement(), {\r\n                display: (shape !== 'line' && mode === 'fill') ? 'none' : null\r\n            });\r\n        },\r\n        changeOnInit: true\r\n    });\r\n    shapeOptions.getElement().style.width = '120px';\r\n    row1.appendChild(shapeOptions.getElement());\r\n\r\n    const eraserToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('eraser'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        }\r\n    });\r\n\r\n    const lockAlphaToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('lock-alpha'),\r\n        title: LANG('lock-alpha-title'),\r\n        callback: (b) => {\r\n        },\r\n        doHighlight: true,\r\n    });\r\n    lockAlphaToggle.getElement().style.marginTop = '10px';\r\n\r\n    row1.append(BB.el({\r\n        content: [\r\n            eraserToggle.getElement(),\r\n            lockAlphaToggle.getElement(),\r\n        ]\r\n    }));\r\n\r\n    let lineWidthSlider = new KlSlider({\r\n        label: LANG('shape-line-width'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 1,\r\n        max: 200,\r\n        value: 4,\r\n        curve: 'quadratic',\r\n        onChange: (val) => {\r\n            updatePreviews();\r\n        },\r\n    });\r\n    BB.css(lineWidthSlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(lineWidthSlider.getElement());\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 1 / 100,\r\n        max: 1,\r\n        value: 1,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        toDisplayValue: (value) => value * 100,\r\n    });\r\n    BB.css(opacitySlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n    let row2 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n\r\n    let outwardsToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('shape-outwards'),\r\n        callback: function(b) {},\r\n        css: {\r\n            width: '50%',\r\n            marginRight: '10px',\r\n        }\r\n    });\r\n    row2.appendChild(outwardsToggle.getElement());\r\n\r\n    let fixedToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('shape-fixed'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        },\r\n        css: {\r\n            flexGrow: '1',\r\n        }\r\n    });\r\n    row2.appendChild(fixedToggle.getElement());\r\n\r\n    let snapToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('angle-snap'),\r\n        title: LANG('angle-snap-title'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        },\r\n        css: {\r\n            flexGrow: '1',\r\n        }\r\n    });\r\n    row2.appendChild(snapToggle.getElement());\r\n\r\n\r\n    updatePreviews();\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    };\r\n\r\n    this.getShape = function() {\r\n        return shape;\r\n    };\r\n\r\n    this.getMode = function() {\r\n        return mode;\r\n    };\r\n\r\n    this.getIsEraser = function() {\r\n        return (eraserToggle as any).getValue();\r\n    };\r\n\r\n    this.getOpacity = function() {\r\n        return opacitySlider.getValue();\r\n    };\r\n\r\n    this.getLineWidth = function() {\r\n        return lineWidthSlider.getValue();\r\n    };\r\n\r\n    this.getIsOutwards = function() {\r\n        return (outwardsToggle as any).getValue();\r\n    };\r\n\r\n    this.getIsFixed = function() {\r\n        return (fixedToggle as any).getValue();\r\n    };\r\n\r\n    this.getIsSnap = function() {\r\n        return (snapToggle as any).getValue();\r\n    };\r\n\r\n    this.getDoLockAlpha = () => {\r\n        return lockAlphaToggle.getValue();\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../base-components/select';\r\nimport {ColorOptions} from '../base-components/color-options';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * P = {\r\n *     currentColor: RGB, // current color\r\n *     secondaryColor: RGB,\r\n *     maxCanvasSize: number,\r\n *     canvasWidth: number, // current canvas size\r\n *     canvasHeight: number, // current canvas size\r\n *     workspaceWidth: number,\r\n *     workspaceHeight: number,\r\n *     onConfirm: function(width number, height number, color RGBA),\r\n *     onCancel: function()\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function newImageDialog(p) {\r\n\r\n    let currentColor = p.currentColor;\r\n    let secondaryColor = p.secondaryColor;\r\n    let maxCanvasSize = p.maxCanvasSize;\r\n    let canvasWidth = p.canvasWidth;\r\n    let canvasHeight = p.canvasHeight;\r\n    let workspaceWidth = p.workspaceWidth;\r\n    let workspaceHeight = p.workspaceHeight;\r\n    let onConfirm = p.onConfirm;\r\n    let onCancel = p.onCancel;\r\n\r\n\r\n    function createRatioSize(ratioX, ratioY, width, height, padding) {\r\n        return BB.fitInto(ratioX, ratioY, Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding), 1);\r\n    }\r\n\r\n    let newImDiv = document.createElement(\"div\");\r\n    let widthWrapper = document.createElement(\"div\");\r\n    let heightWrapper = document.createElement(\"div\");\r\n    let widthInput = document.createElement(\"input\");\r\n    let widthUnit = document.createElement(\"div\");\r\n    let heightInput = document.createElement(\"input\");\r\n    let heightUnit = document.createElement(\"div\");\r\n    widthWrapper.style.position = \"relative\";\r\n    widthWrapper.style.width = \"145px\";\r\n    widthWrapper.style.height = \"35px\";\r\n    widthWrapper.style.lineHeight = \"30px\";\r\n    heightWrapper.style.width = \"145px\";\r\n    heightWrapper.style.height = \"35px\";\r\n    heightWrapper.style.lineHeight = \"30px\";\r\n\r\n    widthUnit.innerText = LANG('new-px');\r\n    widthUnit.style.color = '#888';\r\n    widthUnit.style.fontSize = \"12px\";\r\n    widthUnit.style.marginLeft = \"5px\";\r\n    widthUnit.style.cssFloat = \"right\";\r\n\r\n    heightUnit.innerText = LANG('new-px');\r\n    heightUnit.style.color = '#888';\r\n    heightUnit.style.fontSize = \"12px\";\r\n    heightUnit.style.marginLeft = \"5px\";\r\n    heightUnit.style.cssFloat = \"right\";\r\n\r\n    widthInput.setAttribute('data-ignore-focus', 'true');\r\n    heightInput.setAttribute('data-ignore-focus', 'true');\r\n\r\n    widthInput.type = 'number';\r\n    widthInput.min = '1';\r\n    widthInput.max = maxCanvasSize;\r\n    widthInput.style.cssFloat = \"right\";\r\n    widthInput.style.width = \"70px\";\r\n\r\n    heightInput.type = 'number';\r\n    heightInput.min = '1';\r\n    heightInput.max = maxCanvasSize;\r\n    heightInput.style.cssFloat = \"right\";\r\n    heightInput.style.width = \"70px\";\r\n    widthInput.value = canvasWidth;\r\n    heightInput.value = canvasHeight;\r\n    widthInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    heightInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    widthWrapper.appendChild(widthUnit);\r\n    widthWrapper.appendChild(widthInput);\r\n    BB.appendTextDiv(widthWrapper, LANG('width') + \": \");\r\n    heightWrapper.appendChild(heightUnit);\r\n    heightWrapper.appendChild(heightInput);\r\n    BB.appendTextDiv(heightWrapper, LANG('height') + \": \");\r\n    let ratioWrapper = document.createElement(\"div\");\r\n    ratioWrapper.style.marginTop = '5px';\r\n    ratioWrapper.style.color = '#888';\r\n\r\n    let templateWrapper = document.createElement(\"div\");\r\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\r\n    let presetFitBtn = document.createElement(\"button\");\r\n    templateWrapper.style.marginBottom = \"10px\";\r\n    let presetCurrentBtn = document.createElement(\"button\");\r\n    let presetSquareBtn = document.createElement(\"button\");\r\n    let presetLandscapeBtn = document.createElement(\"button\");\r\n    let presetPortraitBtn = document.createElement(\"button\");\r\n    let presetOversizeBtn = document.createElement(\"button\");\r\n\r\n    presetCurrentBtn.textContent = LANG('new-current');\r\n    presetFitBtn.textContent = LANG('new-fit');\r\n    presetOversizeBtn.textContent = LANG('new-oversize');\r\n    presetLandscapeBtn.textContent = LANG('new-landscape');\r\n    presetPortraitBtn.textContent = LANG('new-portrait');\r\n    presetSquareBtn.textContent = LANG('new-square');\r\n\r\n    presetCurrentBtn.style.marginRight = \"5px\";\r\n    presetFitBtn.style.marginRight = \"5px\";\r\n    presetOversizeBtn.style.marginRight = \"5px\";\r\n    presetLandscapeBtn.style.marginTop = \"5px\";\r\n    presetLandscapeBtn.style.marginRight = \"5px\";\r\n    presetPortraitBtn.style.marginTop = \"5px\";\r\n    presetPortraitBtn.style.marginRight = \"5px\";\r\n\r\n    templateWrapper.appendChild(presetCurrentBtn);\r\n    templateWrapper.appendChild(presetFitBtn);\r\n    templateWrapper.appendChild(presetOversizeBtn);\r\n    templateWrapper.appendChild(presetSquareBtn);\r\n    templateWrapper.appendChild(presetLandscapeBtn);\r\n    templateWrapper.appendChild(presetPortraitBtn);\r\n\r\n    let templatePadding = 50;\r\n\r\n    presetCurrentBtn.onclick = function () {\r\n        widthInput.value = canvasWidth;\r\n        heightInput.value = canvasHeight;\r\n        updateRatio();\r\n    };\r\n    presetFitBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth;\r\n        heightInput.value = workspaceHeight;\r\n        updateRatio();\r\n    };\r\n    presetOversizeBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth + 500;\r\n        heightInput.value = workspaceHeight + 500;\r\n        updateRatio();\r\n    };\r\n    presetSquareBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetLandscapeBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetPortraitBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n\r\n    let select = new Select({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['screen', LANG('new-screen')],\r\n            ['16 9', LANG('new-video') + ' 16:9'],\r\n            ['3 2', '3:2'],\r\n            ['5 3', '5:3'],\r\n            ['2 1', '2:1'],\r\n            ['paper', LANG('new-din-paper') + ' √2:1'],\r\n            ['9 16', '9:16'],\r\n            ['2 3', '2:3'],\r\n            ['3 5', '3:5'],\r\n            ['1 2', '1:2'],\r\n            ['1 1.4142135623730951', '1:√2']\r\n        ],\r\n        onChange: function(val) {\r\n            if (val === 'screen') {\r\n                widthInput.value = '' + window.screen.width;\r\n                heightInput.value = '' + window.screen.height;\r\n            } else if (val === 'paper') {\r\n                let sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            } else {\r\n                let split = val.split(' ');\r\n                let sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            }\r\n            updateRatio();\r\n            select.setValue(null);\r\n        }\r\n    });\r\n    setTimeout(() => {\r\n        // safari: not empty without also setting it to null via timeout\r\n        select.setValue(null);\r\n    }, 0);\r\n    BB.css(select.getElement(), {\r\n        width: '80px',\r\n    });\r\n    templateWrapper.appendChild(select.getElement());\r\n\r\n\r\n\r\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\r\n\r\n    let colorOptionsArr = [\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 0}\r\n    ];\r\n    colorOptionsArr.push({\r\n        r: currentColor.r,\r\n        g: currentColor.g,\r\n        b: currentColor.b,\r\n        a: 1\r\n    });\r\n    colorOptionsArr.push({\r\n        r: secondaryColor.r,\r\n        g: secondaryColor.g,\r\n        b: secondaryColor.b,\r\n        a: 1\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        onChange: function(rgbaObj) {\r\n            backgroundRGBA = rgbaObj;\r\n            preview.style.backgroundColor = \"rgba(\" + rgbaObj.r + \",\" + rgbaObj.g + \",\" + rgbaObj.b + \", \" + rgbaObj.a + \")\";\r\n        }\r\n    });\r\n\r\n    let previewWrapper = document.createElement(\"div\");\r\n    BB.css(previewWrapper, {\r\n        boxSizing: 'border-box',\r\n        width: '340px',\r\n        height: '140px',\r\n        display: 'table',\r\n        backgroundColor: '#9e9e9e',\r\n        padding: '10px',\r\n        marginTop: '10px',\r\n        boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n        marginLeft: '-20px',\r\n        colorScheme: 'only light',\r\n    });\r\n    let preview = document.createElement(\"div\");\r\n    BB.css(preview, {\r\n        width: 200 + \"px\",\r\n        height: 100 + \"px\",\r\n        backgroundColor: \"#fff\",\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        color: \"#aaa\",\r\n        fontSize: \"16px\",\r\n        fontWeight: \"bold\",\r\n        textAlign: \"center\",\r\n        verticalAlign: \"center\",\r\n        display: \"table\",\r\n        overflow: \"hidden\",\r\n        boxShadow: \"0px 0px 3px rgba(0,0,0,0.5)\"\r\n    });\r\n    let previewcell = document.createElement(\"div\");\r\n    previewcell.style.display = \"table-cell\";\r\n    previewcell.style.verticalAlign = \"middle\";\r\n    previewcell.appendChild(preview);\r\n    previewWrapper.appendChild(previewcell);\r\n    let cell = BB.appendTextDiv(preview, \"\");\r\n    //let ratio = BB.appendTextDiv(cell, \"1:2\");\r\n    cell.style.display = \"table-cell\";\r\n    cell.style.verticalAlign = \"middle\";\r\n    let prevW = parseInt(widthInput.value);\r\n    let prevH = parseInt(heightInput.value);\r\n\r\n    function updateRatio() {\r\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\r\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\r\n\r\n        function HCF(u, v) {\r\n            let U = u, V = v;\r\n            while (true) {\r\n                if (!(U %= V))\r\n                    return V;\r\n                if (!(V %= U))\r\n                    return U;\r\n            }\r\n        }\r\n\r\n        let w = parseInt(widthInput.value);\r\n        let h = parseInt(heightInput.value);\r\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\r\n            if (w > maxCanvasSize)\r\n                w = maxCanvasSize;\r\n            else if (h > maxCanvasSize)\r\n                h = maxCanvasSize;\r\n\r\n            widthInput.value = '' + w;\r\n            heightInput.value = '' + h;\r\n        }\r\n\r\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\r\n        let commonRatios = [\r\n            [1, 2], [2, 1],\r\n            [2, 3], [3, 2],\r\n            [3, 4], [4, 3],\r\n            [4, 5], [5, 4],\r\n            [16, 9], [9, 16],\r\n            [3, 2], [2, 3],\r\n            [5, 3], [3, 5],\r\n            [2, 1], [1, 2],\r\n            [1.414, 1], [1, 1.414],\r\n        ];\r\n        let reducedArr = BB.reduce(w, h);\r\n        let closestRatio = null;\r\n        let closestDistance = null;\r\n        for (let i = 0; i < commonRatios.length; i++) {\r\n            if (i === 0 || Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\r\n                closestRatio = commonRatios[i];\r\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\r\n            }\r\n        }\r\n        //display ratio\r\n        if (closestDistance > 0 && closestDistance < 0.005) {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\r\n        } else {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\r\n        }\r\n\r\n        prevW = w;\r\n        prevH = h;\r\n        let realw = w;\r\n        let T = HCF(w, h);\r\n        w /= T;\r\n        h /= T;\r\n        w *= 260;\r\n        h *= 260;\r\n        if (w > 260) {\r\n            h = 260 / w * h;\r\n            w = 260;\r\n        }\r\n        if (h > 100) {\r\n            w = 100 / h * w;\r\n            h = 100;\r\n\r\n        }\r\n\r\n        preview.style.width = w + \"px\";\r\n        preview.style.height = h + \"px\";\r\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\r\n            previewWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n    }\r\n\r\n    widthInput.onchange = function () {\r\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\r\n            widthInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    widthInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    heightInput.onchange = function () {\r\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\r\n            heightInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    heightInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    updateRatio();\r\n\r\n    newImDiv.appendChild(templateWrapper);\r\n    let secondRow = BB.el({\r\n        parent: newImDiv,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'flex-end'\r\n        }\r\n    });\r\n    let secondRowLeft = BB.el({\r\n        parent: secondRow\r\n    });\r\n    secondRowLeft.appendChild(widthWrapper);\r\n    secondRowLeft.appendChild(heightWrapper);\r\n    secondRowLeft.appendChild(ratioWrapper);\r\n    secondRow.appendChild(colorOptions.getElement());\r\n\r\n    newImDiv.appendChild(previewWrapper);\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('new-title')}</b>`,\r\n        div: newImDiv,\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (result) {\r\n            widthInput.onclick = null;\r\n            heightInput.onclick = null;\r\n            presetCurrentBtn.onclick = null;\r\n            presetFitBtn.onclick = null;\r\n            presetOversizeBtn.onclick = null;\r\n            presetSquareBtn.onclick = null;\r\n            presetLandscapeBtn.onclick = null;\r\n            presetPortraitBtn.onclick = null;\r\n            widthInput.onchange = null;\r\n            widthInput.onkeyup = null;\r\n            heightInput.onchange = null;\r\n            heightInput.onkeyup = null;\r\n            select.destroy();\r\n            colorOptions.destroy();\r\n\r\n            if (result === \"Cancel\" || parseInt(widthInput.value) <= 0 || parseInt(heightInput.value) <= 0 || isNaN(parseInt(widthInput.value)) || isNaN(parseInt(heightInput.value))) {\r\n                onCancel();\r\n                return;\r\n            }\r\n            onConfirm(parseInt(widthInput.value), parseInt(heightInput.value), backgroundRGBA);\r\n        },\r\n        clickOnEnter: 'Ok'\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport collapseImg from 'url:~/src/app/img/ui/ui-collapse.svg';\r\nimport {LANG} from \"../../../language/language\";\r\n\r\n/**\r\n * button that allows to collapse toolspace (for mobile)\r\n *\r\n * p = {\r\n *     onChange: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceCollapser(p) {\r\n    let isOpen = true;\r\n    let directionStr = 'right'; // 'left' | 'right'\r\n\r\n    function update() {\r\n        if (directionStr === 'left') {\r\n            icon.style.transform = isOpen ? 'rotate(180deg)' : '';\r\n        } else {\r\n            icon.style.transform = isOpen ? '' : 'rotate(180deg)';\r\n        }\r\n    }\r\n\r\n    let div = BB.el({\r\n        css: {\r\n            width: '36px',\r\n            height: '36px',\r\n            background: 'rgba(100, 100, 100, 0.9)',\r\n            color: '#fff',\r\n            position: 'absolute',\r\n            top: '0',\r\n            textAlign: 'center',\r\n            lineHeight: '36px',\r\n            cursor: 'pointer',\r\n            userSelect: 'none',\r\n            padding: '6px',\r\n            boxSizing: 'border-box'\r\n        },\r\n        title: LANG('toggle-show-tools'),\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            isOpen = !isOpen;\r\n            update();\r\n            p.onChange();\r\n        }\r\n    });\r\n\r\n    let icon = BB.el({\r\n        parent: div,\r\n        css: {\r\n            backgroundImage: `url(${collapseImg})`,\r\n            width: '100%',\r\n            height: '100%',\r\n            backgroundSize: 'contain',\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    // --- interface ---\r\n    this.isOpen = function() {\r\n        return isOpen;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param dirStr\r\n     */\r\n    this.setDirection = function(dirStr) {\r\n        directionStr = dirStr;\r\n        update();\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"b1UMP\");","import {BB} from '../../../bb/bb';\r\nimport {renderText} from '../../image-operations/render-text';\r\nimport {ColorOptions} from '../base-components/color-options';\r\nimport {Select} from '../base-components/select';\r\nimport {ImageRadioList} from '../base-components/image-radio-list';\r\nimport {ImageToggle} from '../base-components/image-toggle';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {popup} from './popup';\r\n// @ts-ignore\r\nimport alignLeftImg from 'url:~/src/app/img/ui/align-left.svg';\r\n// @ts-ignore\r\nimport alignCenterImg from 'url:~/src/app/img/ui/align-center.svg';\r\n// @ts-ignore\r\nimport alignRightImg from 'url:~/src/app/img/ui/align-right.svg';\r\n// @ts-ignore\r\nimport typoItalicImg from 'url:~/src/app/img/ui/typo-italic.svg';\r\n// @ts-ignore\r\nimport typoBoldImg from 'url:~/src/app/img/ui/typo-bold.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\nimport {IRGB} from '../../kl.types';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Text Tool dialog\r\n *\r\n * confirmP = {\r\n *     x: number,\r\n *     y: number,\r\n *     textStr: string,\r\n *     align: 'left' | 'center' | 'right',\r\n *     isItalic: boolean,\r\n *     isBold: boolean,\r\n *     color: rgb,\r\n *     size: number, // px\r\n *     font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy',\r\n *     opacity: number, // 0 - 1\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function textToolDialog(\r\n    p: {\r\n        klCanvas: KlCanvas;\r\n        layerIndex: number;\r\n        x: number;\r\n        y: number;\r\n        angleRad: number;\r\n        color: IRGB;\r\n        secondaryColor: IRGB;\r\n        size: number; // px\r\n        align: 'left' | 'center' | 'right'; // default 'left'\r\n        isBold: boolean; // default false\r\n        isItalic: boolean; // default false\r\n        font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n        opacity: number; // 0 - 1; default 1\r\n        onConfirm: (confirmP) => void;\r\n    }\r\n) {\r\n\r\n    let div = BB.el({});\r\n\r\n    let isSmallWidth = window.innerWidth < 550;\r\n    let isSmallHeight = window.innerHeight < 630;\r\n\r\n    // --- preview ---\r\n    // Text drawn on klCanvas-sized canvas: textCanvas\r\n    // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\r\n    //      they are transformed. canvas size of final preview\r\n    // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\r\n    // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\r\n\r\n    let width = isSmallWidth ? 340 : 540;\r\n    let height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\r\n    let scale = 1;\r\n\r\n    let layerArr = p.klCanvas.getLayersFast();\r\n    let textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\r\n    let textCtx = textCanvas.getContext('2d');\r\n    let targetCanvas = BB.canvas(width, height);\r\n    let targetCtx = targetCanvas.getContext('2d');\r\n    let layersCanvas = BB.canvas(width, height);\r\n    let layersCtx = layersCanvas.getContext('2d');\r\n    let previewCanvas = BB.canvas(width, height); // the one that is visible\r\n    let previewCtx = previewCanvas.getContext('2d');\r\n    BB.css(previewCanvas, {\r\n        display: 'block'\r\n    });\r\n    let previewWrapper = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'relative',\r\n            width: width + 'px',\r\n            marginLeft: '-20px',\r\n            cursor: 'move',\r\n            colorScheme: 'only light',\r\n            touchAction: 'none',\r\n        },\r\n        onClick: function() {\r\n            textInput.focus();\r\n        }\r\n    });\r\n    BB.el({ // inset shadow on preview\r\n        parent: previewWrapper,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n    previewWrapper.appendChild(previewCanvas);\r\n    let checkerPattern = previewCtx.createPattern(BB.createCheckerCanvas(8), 'repeat');\r\n    let emptyCanvas = BB.canvas(1, 1);\r\n    {\r\n        let ctx = emptyCanvas.getContext('2d');\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    }\r\n\r\n    function updatePreview() {\r\n\r\n        // try to draw very much like klCanvasWorkspace\r\n\r\n        // --- draw text ---\r\n        textCtx.clearRect(0, 0, textCanvas.width, textCanvas.height);\r\n        let colorRGBA = {\r\n            ...p.color,\r\n            a: opacitySlider.getValue(),\r\n        };\r\n        let bounds = renderText(textCanvas, {\r\n            x: p.x,\r\n            y: p.y,\r\n            textStr: textInput.value,\r\n            align: alignRadioList.getValue(),\r\n            isItalic: italicToggle.getValue(),\r\n            isBold: boldToggle.getValue(),\r\n            size: parseFloat(sizeInput.value),\r\n            font: fontSelect.getValue(),\r\n            color: BB.ColorConverter.toRgbaStr(colorRGBA),\r\n            angleRad: p.angleRad\r\n        });\r\n\r\n\r\n        // --- determine transformation of viewport ---\r\n        // text should always be visible\r\n        bounds.width = Math.max(bounds.width, 1);\r\n        bounds.height = Math.max(bounds.height, 1);\r\n        let rotatedXY = BB.rotate(bounds.x, bounds.y, -p.angleRad / Math.PI * 180);\r\n        let rotatedWH = BB.rotate(bounds.width, bounds.height, -p.angleRad / Math.PI * 180);\r\n        let centerX = p.x + rotatedXY.x + rotatedWH.x / 2;\r\n        let centerY = p.y + rotatedXY.y + rotatedWH.y / 2;\r\n\r\n        let padding = 100;\r\n        let fitBounds = BB.fitInto(bounds.width, bounds.height, width - padding, height - padding);\r\n        scale = Math.min(1, fitBounds.width / bounds.width);\r\n        scale = Math.min(4, scale * Math.pow(2, zoomFac));\r\n\r\n\r\n        // --- compose text and target layer ---\r\n        targetCtx.save();\r\n\r\n        if (scale >= 4) {\r\n            targetCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            targetCtx.imageSmoothingEnabled = true;\r\n            targetCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n        }\r\n\r\n        targetCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        targetCtx.translate(width / 2, height / 2);\r\n        targetCtx.scale(scale, scale);\r\n        targetCtx.rotate(p.angleRad);\r\n        targetCtx.drawImage(layerArr[p.layerIndex].canvas, -centerX, -centerY);\r\n        targetCtx.drawImage(textCanvas, -centerX, -centerY);\r\n        targetCtx.restore();\r\n\r\n\r\n        // --- layers ---\r\n        layersCtx.save();\r\n\r\n        layersCtx.fillStyle = 'rgb(158,158,158)';\r\n        layersCtx.fillRect(0, 0, width, height);\r\n\r\n        { // bg\r\n            layersCtx.save();\r\n\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n\r\n            layersCtx.imageSmoothingEnabled = false;\r\n\r\n            //outline\r\n            let borderSize = 1 / scale;\r\n            layersCtx.globalAlpha = 0.2;\r\n            layersCtx.drawImage(emptyCanvas, -centerX - borderSize, -centerY - borderSize, textCanvas.width + borderSize * 2, textCanvas.height + borderSize * 2);\r\n            layersCtx.globalAlpha = 1;\r\n\r\n            //erase\r\n            layersCtx.globalCompositeOperation = 'destination-out';\r\n            layersCtx.drawImage(emptyCanvas, -centerX, -centerY, textCanvas.width, textCanvas.height);\r\n\r\n            layersCtx.restore();\r\n        }\r\n\r\n        { // individual layers\r\n\r\n            if (scale >= 4) {\r\n                layersCtx.imageSmoothingEnabled = false;\r\n            } else {\r\n                layersCtx.imageSmoothingEnabled = true;\r\n                layersCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n            }\r\n\r\n            // layers below\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (var i = 0; i < p.layerIndex; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n            // target layer\r\n            layersCtx.globalAlpha = layerArr[p.layerIndex].opacity;\r\n            layersCtx.globalCompositeOperation = layerArr[p.layerIndex].mixModeStr;\r\n            layersCtx.drawImage(targetCanvas, 0, 0);\r\n\r\n            // layers above\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (let i = p.layerIndex + 1; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n        }\r\n\r\n        layersCtx.restore();\r\n\r\n\r\n\r\n        // --- final composite ---\r\n        previewCtx.save();\r\n        previewCtx.fillStyle = checkerPattern;\r\n        previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        previewCtx.drawImage(layersCanvas, 0, 0);\r\n        previewCtx.restore();\r\n\r\n        // bounds\r\n        previewCtx.save();\r\n        previewCtx.globalCompositeOperation = 'difference';\r\n        previewCtx.strokeStyle = '#fff';\r\n        previewCtx.lineWidth = 1;\r\n        // centerX = p.x + bounds.x + bounds.width / 2;\r\n        // centerY = p.y + bounds.y + bounds.height / 2;\r\n        previewCtx.strokeRect(\r\n            Math.round(width / 2 - (bounds.width / 2) * scale),\r\n            Math.round(height / 2 - (bounds.height / 2) * scale),\r\n            Math.round(bounds.width * scale),\r\n            Math.round(bounds.height * scale)\r\n        );\r\n        previewCtx.restore();\r\n\r\n    }\r\n\r\n    function move(x, y) {\r\n        let rotated = BB.rotate(x, y, -p.angleRad / Math.PI * 180);\r\n        p.x += rotated.x / scale;\r\n        p.y += rotated.y / scale;\r\n        updatePreview();\r\n    }\r\n\r\n    let previewPointerListener = new BB.PointerListener({\r\n        target: previewCanvas,\r\n        pointers: 1,\r\n        onPointer: function(e) {\r\n            if (e.type === 'pointermove' && e.button) {\r\n                e.eventPreventDefault();\r\n                move(-e.dX, -e.dY);\r\n            }\r\n        },\r\n        onWheel: function(e) {\r\n            changeZoomFac(-e.deltaY);\r\n        }\r\n    });\r\n\r\n    const wheelPrevent = (event) => {\r\n        event.preventDefault();\r\n    }\r\n    BB.addEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n\r\n\r\n\r\n    let row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n    let row2n3Wrapper = BB.el({\r\n        parent: div,\r\n        css: isSmallWidth ? {} : {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between'\r\n        }\r\n    });\r\n    let row2 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '5px'\r\n        }\r\n    });\r\n    let row3 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            marginTop: '5px',\r\n            width: isSmallWidth ? '' : '300px'\r\n        }\r\n    });\r\n\r\n    // --- row 1 ---\r\n\r\n    // color\r\n    let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n    let colorOptionsArr = [\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 255, g: 255, b: 255, a: 1}\r\n    ];\r\n    colorOptionsArr.unshift({\r\n        r: p.secondaryColor.r,\r\n        g: p.secondaryColor.g,\r\n        b: p.secondaryColor.b,\r\n        a: 1,\r\n    });\r\n    colorOptionsArr.unshift({\r\n        r: p.color.r,\r\n        g: p.color.g,\r\n        b: p.color.b,\r\n        a: 1,\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: 0,\r\n        onChange: function(rgbaObj) {\r\n            p.color = rgbaObj;\r\n            updatePreview();\r\n        }\r\n    });\r\n    colorOptions.getElement().title = LANG('text-color');\r\n    colorOptions.getElement().style.marginLeft = '-5px';\r\n    row1.appendChild(colorOptions.getElement());\r\n\r\n\r\n    let zoomFac = 0;\r\n    function changeZoomFac(d) {\r\n        zoomFac = Math.min(2, Math.max(-2, zoomFac + d));\r\n        updatePreview();\r\n        zoomInBtn.disabled = !canZoom(1);\r\n        zoomOutBtn.disabled = !canZoom(-1);\r\n    }\r\n    function canZoom(d) {\r\n        return zoomFac !== Math.min(2, Math.max(-2, zoomFac + d));\r\n    }\r\n\r\n    let zoomWrapper = BB.el({\r\n        parent: row1,\r\n        css: {\r\n\r\n        }\r\n    })\r\n\r\n    let zoomInBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\r\n        title: LANG('zoom-in'),\r\n        tagName: 'button',\r\n        onClick: function() {\r\n            changeZoomFac(1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold'\r\n        }\r\n    }) as HTMLButtonElement;\r\n    let zoomOutBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\r\n        title: LANG('zoom-out'),\r\n        tagName: 'button',\r\n        onClick: function() {\r\n            changeZoomFac(-1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold',\r\n            marginLeft: '5px'\r\n        }\r\n    }) as HTMLButtonElement;\r\n\r\n\r\n\r\n    // --- row 2 ---\r\n    let sizeInput = BB.el({\r\n        parent: row2,\r\n        tagName: 'input',\r\n        title: LANG('text-size'),\r\n        custom: {\r\n            type: 'number',\r\n            min: 1,\r\n            max: 10000,\r\n            value: p.size\r\n        },\r\n        css: {\r\n            width: '60px'\r\n        },\r\n        onChange: function() {\r\n            sizeInput.value = '' + Math.max(1, Math.min(10000, parseInt(sizeInput.value)));\r\n            updatePreview();\r\n        }\r\n    }) as HTMLInputElement;\r\n    let sizePointerListener = new BB.PointerListener({\r\n        target: sizeInput,\r\n        onWheel: function(e) {\r\n            sizeInput.value = '' + Math.max(1, Math.min(1000, parseInt(sizeInput.value) - e.deltaY));\r\n            updatePreview();\r\n        }\r\n    });\r\n\r\n    let modeWrapper;\r\n    let fontSelect;\r\n    let fontPointerListener;\r\n    {\r\n        modeWrapper = BB.el({\r\n            css: {\r\n                fontSize: '15px',\r\n                marginLeft: '10px'\r\n            }\r\n        });\r\n        fontSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['sans-serif', 'Sans-serif'],\r\n                ['serif', 'Serif'],\r\n                ['monospace', 'Monospace'],\r\n                ['cursive', 'Cursive'],\r\n                ['fantasy', 'Fantasy'],\r\n            ],\r\n            initValue: p.font,\r\n            onChange: function(val) {\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        modeWrapper.appendChild(fontSelect.getElement());\r\n        row2.appendChild(modeWrapper);\r\n\r\n        fontPointerListener = new BB.PointerListener({\r\n            target: fontSelect.getElement(),\r\n            onWheel: function(e) {\r\n                fontSelect.setDeltaValue(e.deltaY);\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    // --- row 3 ---\r\n\r\n    let alignRadioList = new ImageRadioList({\r\n        optionArr: [\r\n            {\r\n                id: 'left',\r\n                title: LANG('text-left'),\r\n                image: alignLeftImg,\r\n            },\r\n            {\r\n                id: 'center',\r\n                title: LANG('text-center'),\r\n                image: alignCenterImg,\r\n            },\r\n            {\r\n                id: 'right',\r\n                title: LANG('text-right'),\r\n                image: alignRightImg,\r\n            }\r\n        ],\r\n        initId: p.align,\r\n        onChange: function(id) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(alignRadioList.getElement());\r\n\r\n    let italicToggle = new ImageToggle({\r\n        image: typoItalicImg,\r\n        title: LANG('text-italic'),\r\n        initValue: p.isItalic,\r\n        onChange: function(b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(italicToggle.getElement());\r\n\r\n    let boldToggle = new ImageToggle({\r\n        image: typoBoldImg,\r\n        title: LANG('text-bold'),\r\n        initValue: p.isBold,\r\n        onChange: function(b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(boldToggle.getElement());\r\n\r\n\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 150,\r\n        height: 30,\r\n        min: 1 / 100,\r\n        max: 1,\r\n        value: p.opacity,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        toDisplayValue: (value) => value * 100,\r\n        onChange: function(v) {\r\n            updatePreview();\r\n        },\r\n    });\r\n    row3.appendChild(opacitySlider.getElement());\r\n\r\n\r\n\r\n    let textInput = BB.el({\r\n        parent: div,\r\n        tagName: 'textarea',\r\n        custom: {\r\n            placeholder: LANG('text-placeholder'),\r\n            'data-ignore-focus': 'true',\r\n        },\r\n        css: {\r\n            whiteSpace: 'pre',\r\n            overflow: 'auto',\r\n            width: '100%',\r\n            height: '70px',\r\n            resize: 'vertical',\r\n            marginTop: '10px'\r\n        },\r\n        onChange: function() {\r\n            updatePreview();\r\n        }\r\n    }) as HTMLTextAreaElement;\r\n    textInput.addEventListener('input', updatePreview);\r\n    setTimeout(function() {\r\n        textInput.focus();\r\n        textInput.select();\r\n    });\r\n    let closefunc;\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    // prevent mobile keyboards scrolling page\r\n    function onScroll() {\r\n        window.scrollTo(0, 0);\r\n    }\r\n    window.addEventListener('scroll', onScroll);\r\n\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('text-title')}</b>`,\r\n        div: div,\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        style: isSmallWidth ? {} : {\r\n            width: '500px'\r\n        },\r\n        callback: function(val) {\r\n            let result = {\r\n                x: p.x,\r\n                y: p.y,\r\n                textStr: textInput.value,\r\n                align: alignRadioList.getValue(),\r\n                isItalic: italicToggle.getValue(),\r\n                isBold: boldToggle.getValue(),\r\n                color: p.color,\r\n                size: sizeInput.value,\r\n                font: fontSelect.getValue(),\r\n                opacity: opacitySlider.getValue(),\r\n            };\r\n\r\n            window.removeEventListener('scroll', onScroll);\r\n            textInput.removeEventListener('input', updatePreview);\r\n            BB.destroyEl(textInput);\r\n            previewPointerListener.destroy();\r\n            sizePointerListener.destroy();\r\n            fontPointerListener.destroy();\r\n            BB.removeEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n            BB.destroyEl(previewWrapper);\r\n            BB.destroyEl(zoomInBtn);\r\n            BB.destroyEl(zoomOutBtn);\r\n            BB.destroyEl(sizeInput);\r\n            colorOptions.destroy();\r\n            fontSelect.destroy();\r\n            keyListener.destroy();\r\n            alignRadioList.destroy();\r\n            italicToggle.destroy();\r\n            boldToggle.destroy();\r\n            opacitySlider.destroy();\r\n            if (val === 'Ok') {\r\n                p.onConfirm(result);\r\n            }\r\n        },\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        ignoreBackground: true,\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        },\r\n    });\r\n\r\n    updatePreview();\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lvwQ5\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"imAvm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dC0sF\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h3hPo\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1pAeY\");","import {BB} from '../../../bb/bb';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n *\r\n * p = {\r\n *     image: convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas},\r\n *     maxSize: number,\r\n *     target: htmlElement,\r\n *     callback: func(\r\n *         {\r\n *             type: 'as-image',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'as-image-psd',\r\n *             image: convertedPsd,\r\n *             cropObj: {x: number, y: number, width: number, height: number}\r\n *         } | {\r\n *             type: 'as-layer',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'cancel',\r\n *         }\r\n *     )\r\n * }\r\n *\r\n * @param p {}\r\n */\r\nexport function showImportImageDialog(p) {\r\n    const div = BB.el({});\r\n\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n    const style = isSmall ? {} : { width: '500px' };\r\n    let resolutionEl;\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 400,\r\n        canvas: p.image.canvas,\r\n        isNotCopy: true,\r\n        onChange: function(width, height) {\r\n            if (!resolutionEl) {\r\n                return;\r\n            }\r\n            updateResolution(width, height);\r\n        }\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n\r\n    resolutionEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginTop: '10px',\r\n            textAlign: 'center',\r\n            color: '#888',\r\n            lineHeight: '20px',\r\n        }\r\n    });\r\n    function updateResolution(w: number, h: number) {\r\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\r\n\r\n        if (fit.width < w) {\r\n            resolutionEl.innerHTML = `<span style=\"color:#f00\">${w} X ${h}</span> ⟶ ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\r\n            resolutionEl.title = LANG('import-too-large');\r\n        } else {\r\n            resolutionEl.innerHTML = `${w} X ${h}`;\r\n            resolutionEl.title = '';\r\n        }\r\n    }\r\n    updateResolution(p.image.width, p.image.height);\r\n\r\n\r\n    let doFlatten = false;\r\n    function showWarnings(psdWarningArr) {\r\n        let contentArr = [];\r\n        let warningMap = {\r\n            'mask': 'Masks not supported. Mask was applied.',\r\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\r\n            'group': 'Groups not supported. Layers were ungrouped.',\r\n            'adjustment': 'Adjustment layers not supported.',\r\n            'layer-effect': 'Layer effects not supported.',\r\n            'smart-object': 'Smart objects not supported.',\r\n            'blend-mode': 'Unsupported layer blend mode.',\r\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\r\n        };\r\n        for (let i = 0; i < psdWarningArr.length; i++) {\r\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\r\n        }\r\n        alert(contentArr.join(\"\\n\"));\r\n    }\r\n\r\n    let flattenCheckbox;\r\n    if (p.image.type === 'psd') {\r\n        const noteStyle = {\r\n            background: 'rgba(255,255,0,0.5)',\r\n            padding: '10px',\r\n            marginTop: '5px',\r\n            marginBottom: '5px',\r\n            border: '1px solid #e7d321',\r\n            borderRadius: '5px'\r\n        };\r\n        if (p.image.layers) {\r\n            flattenCheckbox = new Checkbox({\r\n                init: doFlatten,\r\n                label: LANG('import-flatten'),\r\n                callback: function(b) {\r\n                    doFlatten = b;\r\n                }\r\n            });\r\n            div.appendChild(flattenCheckbox.getElement());\r\n\r\n            if (p.image.warningArr) {\r\n                const noteEl = BB.el({\r\n                    content: LANG('import-psd-limited-support'),\r\n                    css: noteStyle\r\n                });\r\n                noteEl.appendChild(BB.el({\r\n                    tagName: 'a',\r\n                    content: 'Details',\r\n                    onClick: function() {\r\n                        showWarnings(p.image.warningArr);\r\n                    }\r\n                }));\r\n                div.appendChild(noteEl);\r\n            }\r\n        } else {\r\n            const noteEl = BB.el({\r\n                content: LANG('import-psd-unsupported'),\r\n                css: noteStyle\r\n            });\r\n            div.appendChild(noteEl);\r\n        }\r\n    }\r\n\r\n    function callback(result) {\r\n        const croppedImage = cropCopy.getCroppedImage();\r\n        const cropRect = cropCopy.getRect();\r\n        cropCopy.destroy();\r\n        if (flattenCheckbox) {\r\n            flattenCheckbox.destroy();\r\n        }\r\n\r\n        if (result === LANG('import-btn-as-layer')) {\r\n            p.callback({\r\n                type: 'as-layer',\r\n                image: croppedImage\r\n            });\r\n\r\n        } else if (result === LANG('import-btn-as-image')) {\r\n            if (p.image.type === 'psd') {\r\n                if (doFlatten) {\r\n                    p.image.layers = null;\r\n                }\r\n                p.callback({\r\n                    type: 'as-image-psd',\r\n                    image: p.image,\r\n                    cropObj: cropRect\r\n                });\r\n            } else if (p.image.type === 'image') {\r\n                p.callback({\r\n                    type: 'as-image',\r\n                    image: croppedImage\r\n                });\r\n            }\r\n        } else {\r\n            p.callback({\r\n                type: 'cancel'\r\n            });\r\n        }\r\n    }\r\n    popup({\r\n        target: p.target,\r\n        message: `<b>${LANG('import-title')}</b>`,\r\n        div: div,\r\n        style,\r\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), \"Cancel\"],\r\n        callback: callback,\r\n        autoFocus: 'As Image'\r\n    });\r\n}","import {createCanvas} from '../../bb/base/create-canvas';\r\nimport {Psd} from 'ag-psd/dist/psd';\r\nimport {IKlProject, IKlPsd, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\r\n\r\nlet kl2PsdMap;\r\nlet psd2KlMap;\r\n\r\nfunction init() {\r\n    if (kl2PsdMap) {\r\n        return;\r\n    }\r\n\r\n    kl2PsdMap = {\r\n        'source-over': 'normal',\r\n\r\n        'darken': 'darken',\r\n        'multiply': 'multiply',\r\n        'color-burn': 'color burn',\r\n\r\n        'lighten': 'lighten',\r\n        'screen': 'screen',\r\n        'color-dodge': 'color dodge',\r\n\r\n        'overlay': 'overlay',\r\n        'soft-light': 'soft light',\r\n        'hard-light': 'hard light',\r\n\r\n        'difference': 'difference',\r\n        'exclusion': 'exclusion',\r\n\r\n        'hue': 'hue',\r\n        'saturation': 'saturation',\r\n        'color': 'color',\r\n        'luminosity': 'luminosity',\r\n    };\r\n\r\n    psd2KlMap = {};\r\n    let keys = Object.keys(kl2PsdMap);\r\n    for (let i = 0; i < keys.length; i++) {\r\n        psd2KlMap[kl2PsdMap[keys[i]]] = keys[i];\r\n    }\r\n}\r\n\r\nexport function blendPsdToKl(str: string): IMixMode {\r\n    init();\r\n    return psd2KlMap[str];\r\n}\r\n\r\nexport function blendKlToPsd(str: string): string {\r\n    init();\r\n    return kl2PsdMap[str];\r\n}\r\n\r\n\r\n/**\r\n * Converts ag-psd object into something that KlCanvas can represent\r\n * @param psdObj\r\n */\r\nexport function readPsd(psdObj: Psd): IKlPsd {\r\n    let result: IKlPsd = {\r\n        type: 'psd',\r\n        canvas: psdObj.canvas,\r\n        width: psdObj.width,\r\n        height: psdObj.height\r\n    };\r\n\r\n    function addWarning(warningStr) {\r\n        if (!result.warningArr) {\r\n            result.warningArr = [];\r\n        }\r\n        if (result.warningArr.includes(warningStr)) {\r\n            return;\r\n        }\r\n        result.warningArr.push(warningStr);\r\n    }\r\n\r\n    function getMixModeStr(blendMode): IMixMode {\r\n        let mixModeStr: IMixMode = blendPsdToKl(blendMode);\r\n        if (!mixModeStr) {\r\n            addWarning('blend-mode');\r\n            mixModeStr = 'source-over';\r\n        }\r\n        return mixModeStr;\r\n    }\r\n\r\n    if (psdObj.bitsPerChannel !== 8) {\r\n        addWarning('bits-per-channel');\r\n    }\r\n\r\n    if (!psdObj.children) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    // count resulting layers\r\n    let maxLayers = MAX_LAYERS;\r\n    let layerCount = 0;\r\n    function countWithinGroup(groupObj) {\r\n        let result = 0;\r\n        if (groupObj.blendMode) {\r\n            let mixModeStr = blendPsdToKl(groupObj.blendMode);\r\n            if (mixModeStr && mixModeStr !== 'source-over') {\r\n                return 1;\r\n            }\r\n        }\r\n        for (let i = 0; i < groupObj.children.length; i++) {\r\n            let item = groupObj.children[i];\r\n            if (item.clipping || item.adjustment) {\r\n                continue;\r\n            }\r\n\r\n            if (item.children) {\r\n                addWarning('group');\r\n                result += countWithinGroup(item);\r\n            } else {\r\n                result++;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    layerCount += countWithinGroup(psdObj);\r\n    if (layerCount > maxLayers) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    result.layers = [];\r\n\r\n    function prepareMask(maskCanvas, defaultColor) {\r\n        const groupMaskCtx = maskCanvas.getContext('2d');\r\n        let imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n        if (defaultColor === 0) {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = imData.data[i];\r\n            }\r\n        } else {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = 255 - imData.data[i];\r\n            }\r\n        }\r\n        groupMaskCtx.putImageData(imData, 0, 0);\r\n    }\r\n\r\n    function convertGroup(psdGroupObj): {\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n        opacity: number;\r\n        image: HTMLCanvasElement;\r\n    }[] {\r\n\r\n        let resultArr: {\r\n            name: string;\r\n            mixModeStr: IMixMode;\r\n            opacity: number;\r\n            image: HTMLCanvasElement;\r\n        }[] = [];\r\n        let groupOpacity = psdGroupObj.hidden ? 0 : psdGroupObj.opacity;\r\n        let groupMixModeStr = getMixModeStr(psdGroupObj.blendMode);\r\n        let groupCanvas;\r\n        let groupCtx;\r\n        if (groupMixModeStr !== 'source-over') {\r\n            groupCanvas = createCanvas(result.width, result.height);\r\n            groupCtx = groupCanvas.getContext('2d');\r\n        }\r\n\r\n\r\n        // prepare group mask\r\n        if (psdGroupObj.mask) {\r\n            addWarning('mask');\r\n            prepareMask(psdGroupObj.mask.canvas, psdGroupObj.mask.defaultColor);\r\n        }\r\n\r\n\r\n        for (let i = 0; i < psdGroupObj.children.length; i++) {\r\n            let item = psdGroupObj.children[i];\r\n            if (item.clipping) {\r\n                continue;\r\n            }\r\n            if (item.adjustment) {\r\n                addWarning('adjustment');\r\n                continue;\r\n            }\r\n\r\n            let hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\r\n            if (hasClipping) {\r\n                addWarning('clipping');\r\n            }\r\n\r\n            if (item.children) {\r\n                let innerArr = convertGroup(item);\r\n\r\n                for (let e = 0; e < innerArr.length; e++) {\r\n                    let innerItem = innerArr[e];\r\n                    let innerCtx = innerItem.image.getContext('2d');\r\n\r\n                    // clipping\r\n                    if (hasClipping) {\r\n                        let clippingCanvas = createCanvas(result.width, result.height);\r\n                        let clippingCtx = clippingCanvas.getContext('2d');\r\n                        clippingCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                        for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\r\n                            let clippingItem = psdGroupObj.children[f];\r\n                            if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                                continue;\r\n                            }\r\n                            clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                            clippingCtx.globalAlpha = clippingItem.opacity;\r\n                            clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\r\n                        }\r\n\r\n                        innerCtx.globalCompositeOperation = 'source-atop';\r\n                        innerCtx.drawImage(clippingCanvas, 0, 0);\r\n                    }\r\n\r\n\r\n\r\n                    // group mask\r\n                    if (psdGroupObj.mask) {\r\n                        innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                        innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n                    }\r\n\r\n                    if (groupCanvas) {\r\n                        groupCtx.globalCompositeOperation = innerItem.mixModeStr;\r\n                        groupCtx.globalAlpha = innerItem.opacity;\r\n                        groupCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                    } else {\r\n                        innerItem.opacity = innerItem.opacity * groupOpacity;\r\n                        resultArr.push(innerItem);\r\n                    }\r\n                }\r\n\r\n                continue;\r\n            }\r\n\r\n            let canvas = createCanvas(result.width, result.height);\r\n            let ctx = canvas.getContext('2d');\r\n            if (item.canvas) { // if a layer is empty it has no canvas\r\n                ctx.drawImage(item.canvas, item.left, item.top);\r\n            }\r\n\r\n            // effects\r\n            if (item.effects) {\r\n                addWarning('layer-effect');\r\n            }\r\n\r\n            // mask\r\n            if (item.mask) {\r\n                addWarning('mask');\r\n                prepareMask(item.mask.canvas, item.mask.defaultColor);\r\n\r\n                ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\r\n            }\r\n\r\n            // clipping\r\n            if (hasClipping) {\r\n                let clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\r\n                let clippingCtx = clippingCanvas.getContext('2d');\r\n                clippingCtx.drawImage(item.canvas, 0, 0);\r\n\r\n                for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\r\n                    let clippingItem = psdGroupObj.children[e];\r\n                    if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                        continue;\r\n                    }\r\n                    clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                    clippingCtx.globalAlpha = clippingItem.opacity;\r\n                    clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\r\n                }\r\n\r\n                ctx.globalCompositeOperation = 'source-atop';\r\n                ctx.drawImage(clippingCanvas, item.left, item.top);\r\n            }\r\n\r\n            // group mask\r\n            if (psdGroupObj.mask) {\r\n                ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n            }\r\n\r\n            if (groupCanvas) {\r\n                if (groupOpacity > 0) {\r\n                    groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\r\n                    groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\r\n                    groupCtx.drawImage(canvas, 0, 0);\r\n                }\r\n\r\n            } else {\r\n                resultArr.push({\r\n                    name: item.name,\r\n                    opacity: (item.hidden ? 0 : item.opacity) * groupOpacity,\r\n                    mixModeStr: getMixModeStr(item.blendMode),\r\n                    image: canvas,\r\n                });\r\n            }\r\n        }\r\n\r\n        if (groupCanvas) {\r\n            resultArr = [\r\n                {\r\n                    name: psdGroupObj.name,\r\n                    opacity: groupOpacity,\r\n                    mixModeStr: groupMixModeStr,\r\n                    image: groupCanvas,\r\n                }\r\n            ];\r\n        }\r\n\r\n        return resultArr;\r\n    }\r\n\r\n    result.layers = convertGroup({\r\n        name: 'root',\r\n        opacity: 1,\r\n        blendMode: 'normal',\r\n        children: psdObj.children\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\nexport function klPsdToKlProject(klPsd: IKlPsd): IKlProject {\r\n    // only share references to Canvas elements\r\n    const result: IKlProject = {\r\n        width: klPsd.width,\r\n        height: klPsd.height,\r\n        layers: [],\r\n    };\r\n    if (klPsd.layers) {\r\n        result.layers = result.layers.concat(klPsd.layers.map(item => {\r\n            return {\r\n                name: item.name,\r\n                opacity: item.opacity,\r\n                mixModeStr: item.mixModeStr,\r\n                image: item.image,\r\n            };\r\n        }));\r\n    } else {\r\n        // flattened\r\n        result.layers.push({\r\n            name: LANG('background'),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over',\r\n            image: klPsd.canvas,\r\n        });\r\n    }\r\n    return result;\r\n}","//browser storage indexedDB\r\n\r\n\r\nimport {IKlStorageProject} from '../kl.types';\r\n\r\nconst indexedDbIsSupported = !!window.indexedDB;\r\nlet dbNameStr = 'Klecks';\r\nconst storageNameStr = 'ProjectStore';\r\n\r\nexport function setDbName(name: string) {\r\n    dbNameStr = '' + name;\r\n}\r\n\r\n/**\r\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\r\n * with index 'id'\r\n *\r\n * @param actionFunction function(storeObj) - what you want to execute during transaction\r\n * @param successCallback function() - on succesful transaction\r\n * @param errorCallback function(errorStr) - on error\r\n */\r\nfunction execIndexedDBTransaction(actionFunction, successCallback, errorCallback) {\r\n\r\n    let hasFinished = false;\r\n\r\n    function onSuccess() {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        successCallback();\r\n    }\r\n\r\n    function onError(errorStr) {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        errorCallback(errorStr);\r\n    }\r\n\r\n    if (!indexedDbIsSupported) {\r\n        setTimeout(function () {\r\n            onError('no indexed db available');\r\n        }, 0);\r\n        return;\r\n    }\r\n    let requestObj;\r\n\r\n    try {\r\n        requestObj = window.indexedDB.open(dbNameStr, 1);\r\n    } catch (e) {\r\n        onError(e.message);\r\n        return;\r\n    }\r\n\r\n    requestObj.onupgradeneeded = function (e) {\r\n        try {\r\n            let db = requestObj.result;\r\n            let store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\r\n            store.createIndex('id', 'id', {unique: true});\r\n        } catch (e) {\r\n            onError(e.message);\r\n        }\r\n    };\r\n    requestObj.onerror = function (e) {\r\n        onError('indexedDB.open failed, ' + requestObj.error);\r\n    };\r\n    requestObj.onsuccess = function (e) {\r\n        let databaseObj;\r\n        let transactionObj;\r\n        let storeObj;\r\n\r\n        try {\r\n            databaseObj = requestObj.result;\r\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\r\n                //someone maybe messed with the db, or creation failed earlier\r\n                //it's broken -> destroy\r\n                window.indexedDB.deleteDatabase(dbNameStr);\r\n                onError('object store ' + storageNameStr + ' missing. destroying db');\r\n                return;\r\n            }\r\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\r\n            storeObj = transactionObj.objectStore(storageNameStr);\r\n            storeObj.index('id');\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        databaseObj.onerror = function (e) {\r\n            onError('database error, ' + databaseObj.error);\r\n        };\r\n\r\n        try {\r\n            actionFunction(storeObj);\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        transactionObj.oncomplete = function () {\r\n            onSuccess();\r\n            databaseObj.close();\r\n        };\r\n        transactionObj.onerror = function () {\r\n            onError('transaction error, ' + transactionObj.error);\r\n        };\r\n    };\r\n}\r\n\r\n/**\r\n * getKlProjectObj {\r\n *     width: int,\r\n *     height: int,\r\n *     layers: {\r\n *        name: string,\r\n *        opacity: float (0 - 1),\r\n *        mixModeStr: string,\r\n *        image: image object                <--------- image already loaded!\r\n *     }[]\r\n * }\r\n *\r\n * @param successCallback function - called when succesfully queried. passes KlProjectObj\r\n * @param errorCallback - function(errorStr) - called when error during query\r\n */\r\nexport function getKlProjectObj(successCallback, errorCallback) {\r\n    if (indexedDbIsSupported) {\r\n        let query;\r\n        execIndexedDBTransaction(function (storeObj) {\r\n            query = storeObj.get(1);\r\n        }, function () {\r\n            successCallback(query.result);\r\n        }, function (errorStr) {\r\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\r\n        });\r\n    } else {\r\n        successCallback(null);\r\n    }\r\n}\r\n\r\n/**\r\n * stores a klProjectObj into id = 1 in database:dbNameStr > storage: storageNameStr\r\n *\r\n * KlProjectObj {\r\n *     width: int,\r\n *     height: int,\r\n *     layers: {\r\n *        name: string,\r\n *        opacity: float (0 - 1),\r\n *        mixModeStr: string,\r\n *        blob: blob object                 <--------- blob!\r\n *     }[]\r\n * }\r\n *\r\n * @param storageProject IKlStorageProject - project to be stored\r\n * @param successCallback function() - on successful transaction\r\n * @param errorCallback function(errorStr) - on error\r\n */\r\nexport function storeKlProjectObj(storageProject: IKlStorageProject, successCallback, errorCallback) {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.put(storageProject);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (errorStr) {\r\n        errorCallback(errorStr);\r\n    });\r\n\r\n}\r\n\r\n/**\r\n * removes id = 1 from database:dbNameStr > storage: storageNameStr\r\n *\r\n * @param successCallback function() - on successful transaction\r\n * @param errorCallback function(error) - on error\r\n */\r\nexport function clear(successCallback, errorCallback) {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.delete(1);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (error) {\r\n        errorCallback(error);\r\n    });\r\n\r\n}\r\n","import {IFilter} from '../kl.types';\r\n// @ts-ignore\r\nimport glBrightnessContrastImg from 'url:~/src/app/img/ui/edit-brightness-contrast.svg';\r\n// @ts-ignore\r\nimport cropExtendImg from 'url:~/src/app/img/ui/edit-crop.svg';\r\n// @ts-ignore\r\nimport glCurvesImg from 'url:~/src/app/img/ui/edit-curves.svg';\r\n// @ts-ignore\r\nimport flipImg from 'url:~/src/app/img/ui/edit-flip.svg';\r\n// @ts-ignore\r\nimport glHueSaturationImg from 'url:~/src/app/img/ui/edit-hue-saturation.svg';\r\n// @ts-ignore\r\nimport invertImg from 'url:~/src/app/img/ui/edit-invert.png';\r\n// @ts-ignore\r\nimport glPerspectiveImg from 'url:~/src/app/img/ui/edit-perspective.svg';\r\n// @ts-ignore\r\nimport resizeImg from 'url:~/src/app/img/ui/edit-resize.svg';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\r\n// @ts-ignore\r\nimport glTiltShiftImg from 'url:~/src/app/img/ui/edit-tilt-shift.png';\r\n// @ts-ignore\r\nimport toAlphaImg from 'url:~/src/app/img/ui/edit-to-alpha.svg';\r\n// @ts-ignore\r\nimport transformImg from 'url:~/src/app/img/ui/edit-transform.svg';\r\n// @ts-ignore\r\nimport glBlurImg from 'url:~/src/app/img/ui/edit-triangle-blur.png';\r\n// @ts-ignore\r\nimport glUnsharpMaskImg from 'url:~/src/app/img/ui/edit-unsharp-mask.png';\r\n// @ts-ignore\r\nimport gridImg from 'url:~/src/app/img/ui/edit-grid.svg';\r\n// @ts-ignore\r\nimport noiseImg from 'url:~/src/app/img/ui/edit-noise.svg';\r\n// @ts-ignore\r\nimport patternImg from 'url:~/src/app/img/ui/edit-pattern.svg';\r\n// @ts-ignore\r\nimport vanishPointImg from 'url:~/src/app/img/ui/edit-vanish-point.svg';\r\n// @ts-ignore\r\nimport distortImg from 'url:~/src/app/img/ui/edit-distort.svg';\r\n\r\n\r\nexport const filterLibStatus = {\r\n    isLoaded: false,\r\n};\r\nexport const filterLib: {\r\n    [key:string]: IFilter;\r\n} = {\r\n    brightnessContrast: {\r\n        lang: {name: 'filter-bright-contrast-title', button: 'filter-bright-contrast'},\r\n        icon: glBrightnessContrastImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    cropExtend: {\r\n        lang: {name: 'filter-crop-title', button: 'filter-crop-extend'},\r\n        icon: cropExtendImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    curves: {\r\n        lang: {name: 'filter-curves-title', button: 'filter-curves'},\r\n        icon: glCurvesImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    distort: {\r\n        lang: {name: 'filter-distort', button: 'filter-distort'},\r\n        icon: distortImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    flip: {\r\n        lang: {name: 'filter-flip-title', button: 'filter-flip'},\r\n        icon: flipImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    hueSaturation: {\r\n        lang: {name: 'filter-hue-sat-title', button: 'filter-hue-sat'},\r\n        icon: glHueSaturationImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    invert: {\r\n        lang: {name: 'filter-invert', button: 'filter-invert'},\r\n        icon: invertImg,\r\n        updatePos: false,\r\n        isInstant: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    perspective: {\r\n        lang: {name: 'filter-perspective-title', button: 'filter-perspective'},\r\n        icon: glPerspectiveImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    resize: {\r\n        lang: {name: 'filter-resize-title', button: 'filter-resize'},\r\n        icon: resizeImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    rotate: {\r\n        lang: {name: 'filter-rotate-title', button: 'filter-rotate'},\r\n        icon: rotateImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    tiltShift: {\r\n        lang: {name: 'filter-tilt-shift-title', button: 'filter-tilt-shift'},\r\n        icon: glTiltShiftImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    toAlpha: {\r\n        lang: {name: 'filter-to-alpha-title', button: 'filter-to-alpha'},\r\n        icon: toAlphaImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    transform: {\r\n        lang: {name: 'filter-transform-title', button: 'filter-transform'},\r\n        icon: transformImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    blur: {\r\n        lang: {name: 'filter-triangle-blur-title', button: 'filter-triangle-blur'},\r\n        icon: glBlurImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    unsharpMask: {\r\n        lang: {name: 'filter-unsharp-mask-title', button: 'filter-unsharp-mask'},\r\n        icon: glUnsharpMaskImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    grid: {\r\n        lang: {name: 'filter-grid', button: 'filter-grid'},\r\n        icon: gridImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    noise: {\r\n        lang: {name: 'filter-noise', button: 'filter-noise'},\r\n        icon: noiseImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    pattern: {\r\n        lang: {name: 'filter-pattern', button: 'filter-pattern'},\r\n        icon: patternImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    vanishPoint: {\r\n        lang: {name: 'filter-vanish-point-title', button: 'filter-vanish-point'},\r\n        icon: vanishPointImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n};\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"5tPq3\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cazOx\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"245NA\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1hkCG\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"k2eFf\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"krKGd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ehfxY\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"beOjS\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"Gk9bV\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"csed7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"equSE\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h1dN3\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"LfAXI\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cB6q6\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"S9ano\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"4eqRj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8mvSV\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kbc0v\");","import {PenBrush} from './pen-brush';\r\nimport {BlendBrush} from './blend-brush';\r\nimport {SketchyBrush} from './sketchy-brush';\r\nimport {PixelBrush} from './pixel-brush';\r\nimport {EraserBrush} from './eraser-brush';\r\nimport {SmudgeBrush} from './smudge-brush';\r\nimport {ChemyBrush} from './chemy-brush';\r\n\r\nexport const brushes = {\r\n    PenBrush,\r\n    BlendBrush,\r\n    SketchyBrush,\r\n    PixelBrush,\r\n    ChemyBrush,\r\n    SmudgeBrush,\r\n    EraserBrush,\r\n}","import {BB} from '../../bb/bb';\r\nimport {alphaImArr} from './brushes-common';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\n\r\nexport function PenBrush() {\r\n\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let settingColor, settingSize = 2, settingSpacing = 0.8489, settingOpacity = 1;\r\n    let settingColorStr;\r\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\r\n    let settingLockLayerAlpha = false;\r\n    let ALPHA_CIRCLE = 0, ALPHA_CHALK = 1, ALPHA_CAL = 2, ALPHA_SQUARE = 3;\r\n    let settingAlphaId = ALPHA_CIRCLE;\r\n\r\n    let lineToolLastDot;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n\r\n    let isDrawing = false;\r\n    let alphaOpacityArr = [1, 0.9, 1, 1];\r\n\r\n    //mipmapping\r\n    let alphaCanvas128 = BB.canvas(128, 128);\r\n    let alphaCanvas64 = BB.canvas(64, 64);\r\n    let alphaCanvas32 = BB.canvas(32, 32);\r\n\r\n    let bezierLine = null;\r\n\r\n    let twoPI = Math.PI * 2;\r\n    let hasDrawnDot = false; // current stroke has drawn at least one dot\r\n    let inputArr: {x: number, y: number, pressure: number}[];\r\n\r\n    // pressure: 0-1\r\n    function calcOpacity(pressure: number) {\r\n        return settingOpacity * (settingHasOpacityPressure ? pressure * pressure : 1);\r\n    }\r\n\r\n    function updateAlphaCanvas() {\r\n        if (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE) {\r\n            return;\r\n        }\r\n\r\n        let instructionArr = [\r\n            [alphaCanvas128, 128],\r\n            [alphaCanvas64, 64],\r\n            [alphaCanvas32, 32]\r\n        ];\r\n\r\n        let ctx;\r\n\r\n        for (let i = 0; i < instructionArr.length; i++) {\r\n            ctx = (instructionArr[i][0] as any).getContext(\"2d\");\r\n\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.fillStyle = \"rgba(\" + settingColor.r + \", \" + settingColor.g + \", \" + settingColor.b + \", \" + alphaOpacityArr[settingAlphaId] + \")\";\r\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.globalCompositeOperation = \"destination-in\";\r\n            ctx.imageSmoothingQuality = 'high';\r\n            ctx.drawImage(alphaImArr[settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.restore();\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     * @param angle\r\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\r\n     */\r\n    function drawDot(x, y, size, opacity, angle?, before?) {\r\n        if (size <= 0) {\r\n            return;\r\n        }\r\n\r\n        if (settingLockLayerAlpha) {\r\n            context.globalCompositeOperation = \"source-atop\";\r\n        }\r\n\r\n        if (!before || before[3] !== opacity) {\r\n            context.globalAlpha = opacity;\r\n        }\r\n\r\n        if (!before && (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE)) {\r\n            context.fillStyle = settingColorStr;\r\n        }\r\n\r\n        if (settingAlphaId === ALPHA_CIRCLE) {\r\n            context.beginPath();\r\n            context.arc(x, y, size, 0, twoPI);\r\n            context.closePath();\r\n            context.fill();\r\n            hasDrawnDot = true;\r\n\r\n        } else if (settingAlphaId === ALPHA_SQUARE) {\r\n            if (angle !== undefined) {\r\n                context.save();\r\n                context.translate(x, y);\r\n                context.rotate(angle / 180 * Math.PI);\r\n                context.fillRect(-size, -size, size * 2, size * 2);\r\n                context.restore();\r\n                hasDrawnDot = true;\r\n            }\r\n\r\n        } else { // other brush alphas\r\n            context.save();\r\n            context.translate(x, y);\r\n            let targetMipmap = alphaCanvas128;\r\n            if (size <= 32 && size > 16) {\r\n                targetMipmap = alphaCanvas64;\r\n            } else if (size <= 16) {\r\n                targetMipmap = alphaCanvas32;\r\n            }\r\n            context.scale(size, size);\r\n            if (settingAlphaId === ALPHA_CHALK) {\r\n                context.rotate(((x + y) * 53123) % twoPI); // without mod it sometimes looks different\r\n            }\r\n            context.drawImage(targetMipmap, -1, -1, 2, 2);\r\n\r\n            context.restore();\r\n            hasDrawnDot = true;\r\n        }\r\n    }\r\n\r\n    function continueLine(x, y, size, pressure) {\r\n        if (bezierLine === null) {\r\n            bezierLine = new BB.BezierLine();\r\n            bezierLine.add(lastInput.x, lastInput.y, 0, function(){});\r\n        }\r\n\r\n        let drawArr = []; //draw instructions. will be all drawn at once\r\n\r\n        function dotCallback(val) {\r\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\r\n            let localOpacity = calcOpacity(localPressure);\r\n            let localSize = Math.max(0.1, settingSize * (settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        }\r\n\r\n        let localSpacing = size * settingSpacing;\r\n        if (x === null) {\r\n            bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        context.save();\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            let item = drawArr[i];\r\n            drawDot(item[0], item[1], item[2], item[3], item[4], before);\r\n            before = item;\r\n        }\r\n        context.restore();\r\n    }\r\n\r\n    //------------------ interface ---------------------------------------------------\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"PenBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [settingHasOpacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setAlpha\",\r\n            params: [settingAlphaId]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        let localOpacity = calcOpacity(p);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, p * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        hasDrawnDot = false;\r\n\r\n        isDrawing = true;\r\n        context.save();\r\n        drawDot(x, y, localSize, localOpacity);\r\n        context.restore();\r\n\r\n        lineToolLastDot = localSize * settingSpacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2.pressure = p;\r\n\r\n        inputArr = [{\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        }];\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n\r\n    this.goLine = function (x, y, p) {\r\n        if (!isDrawing) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        let pressure = BB.clamp(p, 0, 1);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        context.save();\r\n        continueLine(x, y, localSize, lastInput.pressure);\r\n\r\n        /*context.fillStyle = 'red';\r\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\r\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\r\n\r\n        context.restore();\r\n\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput2.pressure = lastInput.pressure;\r\n        lastInput.pressure = pressure;\r\n\r\n        inputArr.push({\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        });\r\n    };\r\n\r\n    this.endLine = function (x, y) {\r\n\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n        context.save();\r\n        continueLine(null, null, localSize, lastInput.pressure);\r\n        context.restore();\r\n\r\n        isDrawing = false;\r\n\r\n        if (settingAlphaId === ALPHA_SQUARE && !hasDrawnDot) {\r\n            // find max pressure input, use that one\r\n            let maxInput = inputArr[0];\r\n            inputArr.forEach(item => {\r\n                if (item.pressure > maxInput.pressure) {\r\n                    maxInput = item;\r\n                }\r\n            })\r\n\r\n            context.save();\r\n            let p = BB.clamp(maxInput.pressure, 0, 1);\r\n            let localOpacity = calcOpacity(p);\r\n            drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\r\n            context.restore();\r\n        }\r\n\r\n        bezierLine = null;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: [x, y]\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n\r\n        hasDrawnDot = false;\r\n        inputArr = [];\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        context.save();\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\r\n        }\r\n        context.restore();\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"PenBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [settingHasOpacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setAlpha\",\r\n            params: [settingAlphaId]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n    //SET\r\n    this.setAlpha = function (a) {\r\n        if (settingAlphaId === a) {\r\n            return;\r\n        }\r\n        settingAlphaId = a;\r\n        updateAlphaCanvas();\r\n    };\r\n    this.setColor = function (c) {\r\n        if (settingColor === c) {\r\n            return;\r\n        }\r\n        settingColor = {r: c.r, g: c.g, b: c.b};\r\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\r\n        updateAlphaCanvas();\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = s;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.setSpacing = function (s) {\r\n        settingSpacing = s;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        settingHasSizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        settingHasOpacityPressure = b;\r\n    };\r\n    this.setLockAlpha = function (b) {\r\n        settingLockLayerAlpha = b;\r\n    };\r\n    //GET\r\n    this.getSpacing = function () {\r\n        return settingSpacing;\r\n    };\r\n    this.getSize = function () {\r\n        return settingSize;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.getLockAlpha = function (b) {\r\n        return settingLockLayerAlpha;\r\n    };\r\n}","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\r\n\r\nexport const alphaImArr = []; //used by default brush\r\nalphaImArr[1] = genBrushAlpha01(128);\r\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\r\nimport {noise} from '../../../bb/math/perlin';\r\nimport {IVector2D} from '../../../bb/bb.types';\r\n\r\n// chalk\r\nexport function genBrushAlpha01(w: number): HTMLCanvasElement {\r\n\r\n    const scaleFac = w / 500;\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    const ctx = canvas.getContext('2d');\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            let i = (y * w + x) * 4;\r\n\r\n            // base noise\r\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\r\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\r\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\r\n\r\n            // fade out in circular shape\r\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\r\n            let falloff = BB.clamp(\r\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\r\n                0,\r\n                1);\r\n            noisePattern = noisePattern * falloff;\r\n\r\n            // make the middle darker\r\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\r\n            noisePattern = noisePattern * falloff2;\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}\r\n\r\n// https://www.shadertoy.com/view/3tdSDj\r\nfunction udSegment( p: IVector2D, a: IVector2D, b: IVector2D ) {\r\n    let ba = BB.Vec2.sub(b, a);\r\n    let pa = BB.Vec2.sub(p, a);\r\n    let h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\r\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\r\n}\r\n\r\n// calligraphy\r\nexport function genBrushAlpha02(w: number): HTMLCanvasElement {\r\n\r\n    const pDist = 1 / 4;\r\n    let centerSize = 2 / 3;\r\n    let transitionSize = 1 / 3;\r\n    centerSize *= pDist;\r\n    transitionSize *= pDist;\r\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\r\n    const p2 = {x: w - (w * pDist), y: pDist * w};\r\n\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    let ctx = canvas.getContext('2d');\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            const i = (y * w + x) * 4;\r\n\r\n            let col = udSegment({x: x, y: y}, p1, p2);\r\n\r\n            col = BB.clamp(\r\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\r\n                0,\r\n                255\r\n            );\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = col;\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}","/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *\r\n */\r\n\r\nconst myModule = {} as any;\r\n\r\n\r\nfunction Grad(x, y, z) {\r\n    this.x = x; this.y = y; this.z = z;\r\n}\r\n\r\nGrad.prototype.dot2 = function(x, y) {\r\n    return this.x*x + this.y*y;\r\n};\r\n/*\r\nGrad.prototype.dot3 = function(x, y, z) {\r\n    return this.x*x + this.y*y + this.z*z;\r\n};*/\r\n\r\nlet grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\r\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\r\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\r\n\r\nlet p = [151,160,137,91,90,15,\r\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\r\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\r\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\r\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\r\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\r\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\r\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\r\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\r\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\r\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\r\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\r\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\r\n// To remove the need for index wrapping, double the permutation table length\r\nlet perm = new Array(512);\r\nlet gradP = new Array(512);\r\n\r\n// This isn't a very good seeding function, but it works ok. It supports 2^16\r\n// different seed values. Write something better if you need more seeds.\r\nmyModule.seed = function(seed) {\r\n    if (seed > 0 && seed < 1) {\r\n        // Scale the seed out\r\n        seed *= 65536;\r\n    }\r\n\r\n    seed = Math.floor(seed);\r\n    if (seed < 256) {\r\n        seed |= seed << 8;\r\n    }\r\n\r\n    for (let i = 0; i < 256; i++) {\r\n        let v;\r\n        if (i & 1) {\r\n            v = p[i] ^ (seed & 255);\r\n        } else {\r\n            v = p[i] ^ ((seed>>8) & 255);\r\n        }\r\n\r\n        perm[i] = perm[i + 256] = v;\r\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\r\n    }\r\n};\r\n\r\nmyModule.seed(0);\r\n\r\n/*\r\nfor (let i=0; i<256; i++) {\r\n  perm[i] = perm[i + 256] = p[i];\r\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\r\n}*/\r\n\r\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\r\nlet F2 = 0.5*(Math.sqrt(3)-1);\r\nlet G2 = (3-Math.sqrt(3))/6;\r\n\r\n/*let F3 = 1/3;\r\nlet G3 = 1/6;*/\r\n\r\n// 2D simplex noise\r\nmyModule.simplex2 = function(xin, yin) {\r\n    let n0, n1, n2; // Noise contributions from the three corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin)*F2; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let t = (i+j)*G2;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n        i1=1; j1=0;\r\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n        i1=0; j1=1;\r\n    }\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    let x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    let y1 = y0 - j1 + G2;\r\n    let x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    let y2 = y0 - 1 + 2 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    let gi0 = gradP[i+perm[j]];\r\n    let gi1 = gradP[i+i1+perm[j+j1]];\r\n    let gi2 = gradP[i+1+perm[j+1]];\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0*x0-y0*y0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1*x1-y1*y1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\r\n    }\r\n    let t2 = 0.5 - x2*x2-y2*y2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70 * (n0 + n1 + n2);\r\n};\r\n/*\r\n// 3D simplex noise\r\nmyModule.simplex3 = function(xin, yin, zin) {\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let k = Math.floor(zin+s);\r\n\r\n    let t = (i+j+k)*G3;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    let z0 = zin-k+t;\r\n\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\r\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\r\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\r\n    } else {\r\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\r\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\r\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    let x1 = x0 - i1 + G3; // Offsets for second corner\r\n    let y1 = y0 - j1 + G3;\r\n    let z1 = z0 - k1 + G3;\r\n\r\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\r\n    let y2 = y0 - j2 + 2 * G3;\r\n    let z2 = z0 - k2 + 2 * G3;\r\n\r\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\r\n    let y3 = y0 - 1 + 3 * G3;\r\n    let z3 = z0 - 1 + 3 * G3;\r\n\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    k &= 255;\r\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\r\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\r\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\r\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\r\n\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\r\n    }\r\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\r\n    }\r\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\r\n    if (t3<0) {\r\n        n3 = 0;\r\n    } else {\r\n        t3 *= t3;\r\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 32 * (n0 + n1 + n2 + n3);\r\n\r\n};\r\n*/\r\n// ##### Perlin noise stuff\r\n/*\r\nfunction fade(t) {\r\n    return t*t*t*(t*(t*6-15)+10);\r\n}\r\n\r\nfunction lerp(a, b, t) {\r\n    return (1-t)*a + t*b;\r\n}\r\n\r\n// 2D Perlin Noise\r\nmyModule.perlin2 = function(x, y) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y);\r\n    // Get relative xy coordinates of point within that cell\r\n    x = x - X; y = y - Y;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255;\r\n\r\n    // Calculate noise contributions from each of the four corners\r\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\r\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\r\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\r\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\r\n\r\n    // Compute the fade curve value for x\r\n    let u = fade(x);\r\n\r\n    // Interpolate the four results\r\n    return lerp(\r\n        lerp(n00, n10, u),\r\n        lerp(n01, n11, u),\r\n        fade(y));\r\n};*/\r\n/*\r\n// 3D Perlin Noise\r\nmyModule.perlin3 = function(x, y, z) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\r\n    // Get relative xyz coordinates of point within that cell\r\n    x = x - X; y = y - Y; z = z - Z;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255; Z = Z & 255;\r\n\r\n    // Calculate noise contributions from each of the eight corners\r\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\r\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\r\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\r\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\r\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\r\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\r\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\r\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\r\n\r\n    // Compute the fade curve value for x, y, z\r\n    let u = fade(x);\r\n    let v = fade(y);\r\n    let w = fade(z);\r\n\r\n    // Interpolate\r\n    return lerp(\r\n        lerp(\r\n            lerp(n000, n100, u),\r\n            lerp(n001, n101, u), w),\r\n        lerp(\r\n            lerp(n010, n110, u),\r\n            lerp(n011, n111, u), w),\r\n        v);\r\n};*/\r\n\r\nexport const noise = myModule;","import {BB} from '../../bb/bb';\r\nimport {IRGB, IRGBA} from '../kl.types';\r\nimport {IBounds, IPressureInput} from '../../bb/bb.types';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\n\r\nconst cellSize = 256;\r\n\r\ninterface IDrawBufferItem {\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    opacity: number;\r\n    x1: number;\r\n    y1: number;\r\n    x2: number;\r\n    y2: number;\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n}\r\n\r\n// faster than using BB.clamp somehow (in chrome)\r\nfunction clamp(num, min, max) {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num\r\n}\r\n\r\nexport class BlendBrush {\r\n\r\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private color: IRGB;\r\n    private size: number = 29; // radius - 0.5 - 99999\r\n    private opacity: number = 0.6; // 0-1\r\n    private blending: number = 0.65; // 0-1\r\n\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingSizePressure: boolean = true;\r\n    private settingOpacityPressure: boolean = false;\r\n\r\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\r\n    private blendMix: number = 0.45; // todo docs\r\n    private mixr: number; // todo docs\r\n    private mixg: number; // todo docs\r\n    private mixb: number; // todo docs\r\n    private localColOld: IRGBA; // todo docs\r\n\r\n    private isDrawing: boolean = false;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private bezierLine: any; // todo type\r\n\r\n    private history: KlHistoryInterface | null;\r\n    private historyEntry: IHistoryEntry;\r\n    private redrawBounds: IBounds;\r\n    private cells: (ImageData | null)[];\r\n    private drawBuffer: IDrawBufferItem[];\r\n\r\n    private updateRedrawBounds (bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    private getCellsWidth(): number {\r\n        return Math.ceil(this.context.canvas.width / cellSize);\r\n    }\r\n\r\n    /**\r\n     * draw changed cells (changed by brushstroke) onto context\r\n     * @private\r\n     */\r\n    private drawChangedCells(): void {\r\n        const cells = this.cells.map(item => null);\r\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\r\n        touchedCells.forEach((isTouched, index) => {\r\n            if (isTouched) {\r\n                cells[index] = this.cells[index];\r\n            }\r\n        });\r\n        this.drawCells(cells);\r\n        this.redrawBounds = null;\r\n    }\r\n\r\n    private getTouchedCells(bounds: IBounds): boolean[] {\r\n        const touchedCells = this.cells.map(item => false);\r\n        const cellsW = this.getCellsWidth();\r\n        bounds = {\r\n            x1: Math.floor(bounds.x1 / cellSize),\r\n            y1: Math.floor(bounds.y1 / cellSize),\r\n            x2: Math.floor(bounds.x2 / cellSize),\r\n            y2: Math.floor(bounds.y2 / cellSize),\r\n        };\r\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\r\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\r\n                touchedCells[e * cellsW + i] = true;\r\n            }\r\n        }\r\n        return touchedCells;\r\n    }\r\n\r\n    /**\r\n     * Slice up bounds accordings to cells\r\n     * @param bounds\r\n     * @private\r\n     */\r\n    private sliceBounds(bounds: IBounds): {index: number; bounds: IBounds}[] {\r\n        const cellsW = this.getCellsWidth();\r\n        const result: {index: number; bounds: IBounds}[] = [];\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n\r\n        touchedCells.forEach((cell, i) => {\r\n            if (!cell) {\r\n                return;\r\n            }\r\n\r\n            const cellOffsetX = (i % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\r\n            const cellWidth = this.cells[i].width;\r\n            const cellHeight = this.cells[i].height;\r\n\r\n            const inCellBounds = {\r\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\r\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\r\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\r\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\r\n            }\r\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\r\n                return;\r\n            }\r\n            result.push({\r\n                index: i,\r\n                bounds: inCellBounds,\r\n            });\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    private copyFromCanvas(bounds: IBounds) {\r\n        if (!bounds) {\r\n            return;\r\n        }\r\n\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n        const cellsW = this.getCellsWidth();\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.cells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\r\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = tmpCanvas.getContext('2d');\r\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\r\n\r\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\r\n        });\r\n    }\r\n\r\n    private getAverage (x, y, size): IRGBA {\r\n\r\n        size = Math.max(0.5, size * 0.75);\r\n        const x1 = Math.max(0, Math.floor(x - size));\r\n        const y1 = Math.max(0, Math.floor(y - size));\r\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return {\r\n                r: 0,\r\n                g: 0,\r\n                b: 0,\r\n                a: 0,\r\n            };\r\n        }\r\n\r\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\r\n\r\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\r\n        slicedBounds.forEach(slice => {\r\n            const width = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n            const bounds = slice.bounds;\r\n\r\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\r\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\r\n                    alpha = data[e2 + 3];\r\n                    ar += data[e2] * alpha;\r\n                    ag += data[e2 + 1] * alpha;\r\n                    ab += data[e2 + 2] * alpha;\r\n                    aa += alpha;\r\n                }\r\n            }\r\n        });\r\n\r\n        if (aa !== 0) {\r\n            ar /= aa;\r\n            ag /= aa;\r\n            ab /= aa;\r\n            aa = Math.min(1, aa);\r\n        }\r\n        return {\r\n            r: ar,\r\n            g: ag,\r\n            b: ab,\r\n            a: aa\r\n        };\r\n    }\r\n\r\n    private prepDot (x: number, y: number, size: number): IBounds {\r\n        size = Math.max(0.5, size);\r\n        let x1 = Math.max(0, Math.floor(x - size));\r\n        let y1 = Math.max(0, Math.floor(y - size));\r\n        let x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        let y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return null;\r\n        }\r\n        return { x1, y1, x2, y2 };\r\n    }\r\n\r\n    private drawDot (params: IDrawBufferItem): void {\r\n        // array with random numbers. faster than Math.random()\r\n        let randI = 0;\r\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n        const randArr = [];\r\n        for (let i = 0; i < randLen; i++) {\r\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n        }\r\n\r\n        // thin lines take more than just 1 sample\r\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\r\n        const samples = sampleArr[Math.floor(params.size * 2)];\r\n        const samplesSquared: number = samples ? samples * samples : 0;\r\n        const sampleOffsets = [];\r\n        if (samples) {\r\n            let i = 0;\r\n            for (let n = 0; n < samples; n++) {\r\n                for (let m = 0; m < samples; m++, i += 2) {\r\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\r\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\r\n                }\r\n            }\r\n        }\r\n\r\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\r\n        // to optimize calculations\r\n        const invSharpness = 1 - sharpness;\r\n        const sharpnessSubtrahend = sharpness / invSharpness;\r\n        const sizeSquared = params.size * params.size;\r\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\r\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\r\n\r\n\r\n        const slicedBounds = this.sliceBounds({\r\n            x1: params.x1,\r\n            y1: params.y1,\r\n            x2: params.x2,\r\n            y2: params.y2,\r\n        });\r\n\r\n        const cellsW = this.getCellsWidth();\r\n        slicedBounds.forEach(slice => {\r\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\r\n            const cellWidth = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n\r\n            // i - y index within cell\r\n            // e - x index within cell\r\n\r\n            // e2 - index in image data\r\n\r\n            // ri - y index within image relative to dot-center\r\n            // re - x index within image relative to dot-center\r\n\r\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\r\n                for (\r\n                    let e = slice.bounds.x1,\r\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\r\n                        re = e + cellOffsetX - params.x;\r\n                    e <= slice.bounds.x2;\r\n                    e++,\r\n                        e2 += 4,\r\n                        re++\r\n                ) {\r\n                    // O = over -> brush-dot\r\n                    // U = under -> image\r\n\r\n                    let alphaO = 0;\r\n                    if (samplesSquared) {\r\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\r\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\r\n                            if (dist >= sizeSquared) {\r\n                                continue;\r\n                            }\r\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                        }\r\n                        if (!alphaO) {\r\n                            continue;\r\n                        }\r\n                        alphaO /= samplesSquared;\r\n                    } else {\r\n                        // technically needs + 0.5 offset, but not noticeable with large brush\r\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\r\n                        if (dist >= sizeSquared) {\r\n                            continue;\r\n                        }\r\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                    }\r\n\r\n                    const invAlphaO = 1 - alphaO;\r\n                    const alphaU =data[e2 + 3] / 255;\r\n\r\n                    if (this.settingLockLayerAlpha) {\r\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\r\n                        if (alphaU) {\r\n                            data[e2] = Math.floor(underR + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\r\n                        }\r\n                    } else {\r\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\r\n\r\n                        let newAlpha = 1 - invAlphaO * (1 - alphaU);\r\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\r\n                        if (newAlpha) {\r\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\r\n                        }\r\n                    }\r\n                    randI = (randI + 1) % randLen;\r\n\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    private calcSpacing (size: number): number {\r\n        return BB.mix(\r\n            (size * 2) / 2, // until size 5.3\r\n            (size * 2) / 9, // at size 24\r\n            BB.clamp((size - 2.7) / (12 - 2.7), 0, 1)\r\n        );\r\n    }\r\n\r\n    private continueLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n\r\n        this.drawBuffer = [];\r\n\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\r\n\r\n        let bdist = this.calcSpacing(localSize);\r\n\r\n        let avgX = x;\r\n        let avgY = y;\r\n        if (x === null) {\r\n            avgX = this.lastInput.x;\r\n            avgY = this.lastInput.y;\r\n        }\r\n\r\n        let localColNew;\r\n\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            let average;\r\n            if (isCoalesced) {\r\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\r\n            } else {\r\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\r\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\r\n                this.copyFromCanvas(bounds);\r\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\r\n            }\r\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\r\n\r\n            if (average.a > 0 && this.blendCol.a === 0) {\r\n                this.blendCol.r = average.r;\r\n                this.blendCol.g = average.g;\r\n                this.blendCol.b = average.b;\r\n                this.blendCol.a = average.a;\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n\r\n            } else {\r\n                if (average.a === 0) {\r\n                    average.r = this.color.r;\r\n                    average.g = this.color.g;\r\n                    average.b = this.color.b;\r\n                    average.a = 1 - this.blending;\r\n                }\r\n\r\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\r\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\r\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\r\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        const bezierCallback = (val) => {\r\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\r\n                return;\r\n            }\r\n            let factor = val.t;\r\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\r\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\r\n            if (this.blending != 0) {\r\n                this.mixr = BB.mix(this.localColOld.r, localColNew.r, factor);\r\n                this.mixg = BB.mix(this.localColOld.g, localColNew.g, factor);\r\n                this.mixb = BB.mix(this.localColOld.b, localColNew.b, factor);\r\n            }\r\n            if (this.blending === 1 && this.localColOld.a === 0) {\r\n                this.mixr = localColNew.r;\r\n                this.mixg = localColNew.g;\r\n                this.mixb = localColNew.b;\r\n            }\r\n            const bounds = this.prepDot(val.x, val.y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: val.x,\r\n                    y: val.y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        };\r\n\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.localColOld = localColNew;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.size;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.size = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.opacity = o;\r\n    }\r\n\r\n    getBlending (): number {\r\n        return this.blending;\r\n    }\r\n\r\n    setBlending (b: number) {\r\n        this.blending = b;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.color = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setSizePressure (b: boolean): void {\r\n        this.settingSizePressure = !!b;\r\n    }\r\n\r\n    setOpacityPressure (b: boolean): void {\r\n        this.settingOpacityPressure = !!b;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setIsTesting (b: boolean): void {\r\n        this.isTesting = !!b;\r\n    }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: [\"brush\", \"BlendBrush\"],\r\n            actions: []\r\n        };\r\n\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n\r\n        this.isDrawing = true;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\r\n\r\n            let average = this.getAverage(\r\n                x,\r\n                y,\r\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\r\n            );\r\n            if (average.a === 0) {\r\n                this.blendCol = {\r\n                    r: this.color.r,\r\n                    g: this.color.g,\r\n                    b: this.color.b,\r\n                    a: 1 - this.blending,\r\n                };\r\n            } else {\r\n                this.blendCol = {\r\n                    r: average.r,\r\n                    g: average.g,\r\n                    b: average.b,\r\n                    a: average.a,\r\n                };\r\n            }\r\n\r\n            this.mixr = this.blendCol.r;\r\n            this.mixg = this.blendCol.g;\r\n            this.mixb = this.blendCol.b;\r\n        }\r\n\r\n        this.localColOld = {r: this.mixr, g: this.mixg, b: this.mixb, a: this.blendCol.a};\r\n\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        if (this.blending < 1 || this.blendCol.a > 0) {\r\n            const bounds = this.prepDot(x, y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x,\r\n                    y: y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.bezierLine = new BB.BezierLine();\r\n        this.bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    endLine (): void {\r\n        if (this.bezierLine) {\r\n            this.continueLine(null, null, this.lastInput.pressure, false);\r\n        }\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.drawChangedCells();\r\n        }\r\n\r\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\r\n            this.historyEntry.actions.push({\r\n                action: \"drawCells\",\r\n                params: [this.cells],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n\r\n    /**\r\n     * draw cells onto context\r\n     * @param cells\r\n     */\r\n    drawCells (cells: (ImageData | null)[]): void {\r\n        const cellsW = this.getCellsWidth();\r\n        cells.forEach((imageData, index) => {\r\n            if (!imageData) {\r\n                return;\r\n            }\r\n            const cellOffsetX = (index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\r\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\r\n        });\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\r\n        let average = this.getAverage(x1, y1, Math.max(0.1, this.size));\r\n\r\n        if (average.a === 0) {\r\n            this.blendCol = {\r\n                r: this.color.r,\r\n                g: this.color.g,\r\n                b: this.color.b,\r\n                a: 1 - this.blending,\r\n            };\r\n        } else {\r\n            this.blendCol = {\r\n                r: average.r,\r\n                g: average.g,\r\n                b: average.b,\r\n                a: average.a,\r\n            };\r\n        }\r\n\r\n        this.mixr = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixg = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixb = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\r\n\r\n\r\n        const p = 1;\r\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        const bdist = this.calcSpacing(localSize);\r\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bdist) {\r\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\r\n            if (bounds) {\r\n                this.copyFromCanvas(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x1 + eX * loopDist,\r\n                    y: y1 + eY * loopDist,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        }\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        if (this.history && this.cells.find(item => !!item)) {\r\n            this.drawCells(this.cells);\r\n            this.historyEntry = {\r\n                tool: [\"brush\", \"BlendBrush\"],\r\n                actions: [{\r\n                    action: \"drawCells\",\r\n                    params: [this.cells],\r\n                }],\r\n            };\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nconst sampleCanvas = BB.canvas(32, 32);\r\nconst sampleCtx = sampleCanvas.getContext('2d');\r\n\r\nexport function SketchyBrush() {\r\n    let context;\r\n    let settingColor;\r\n\r\n    let settingSize = 1, settingOpacity = 0.2;\r\n    let settingBlending = 0.5;\r\n    let settingScale = 1;\r\n\r\n    let lastX, lastY;\r\n    let isDrawing = false;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n    let sketchySeed = 0;\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSeed = function (s) {\r\n        sketchySeed = parseInt(s);\r\n    };\r\n    this.getSeed = function () {\r\n        return parseInt('' + sketchySeed);\r\n    };\r\n\r\n    function rand() {\r\n        sketchySeed++;\r\n        return Math.sin(6324634.2345 * Math.cos(sketchySeed * 5342.3423)) * 0.5 + 0.5;\r\n    }\r\n\r\n    let points = [];\r\n    let count = 0;\r\n    let mixmode = [\r\n        function (c1, c2) {\r\n            return c1;\r\n        },\r\n        function (c1, c2) {\r\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        },\r\n        function (c1, c2) {\r\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        }\r\n    ];\r\n\r\n    this.getSize = function () {\r\n        return settingSize / 2;\r\n    };\r\n    this.setColor = function (c) {\r\n        settingColor = c;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.getBlending = function () {\r\n        return settingBlending;\r\n    };\r\n    this.setBlending = function (b) {\r\n        settingBlending = b;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = s * 2;\r\n    };\r\n    this.getScale = function () {\r\n        return settingScale;\r\n    };\r\n    this.setScale = function (s) {\r\n        settingScale = s;\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.startLine = function (x, y, pressure, shift) {\r\n        if (shift && lastInput.x) {\r\n            let lx = lastInput.x, ly = lastInput.y;\r\n            isDrawing = true;\r\n            //this.goLine(x,y,pressure);\r\n            this.endLine();\r\n        } else {\r\n            isDrawing = true;\r\n            lastX = x;\r\n            lastY = y;\r\n            lastInput.x = x;\r\n            lastInput.y = y;\r\n            historyEntry = {\r\n                tool: [\"brush\", \"SketchyBrush\"],\r\n                actions: []\r\n            };\r\n            historyEntry.actions.push({\r\n                action: \"setScale\",\r\n                params: [settingScale]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setSize\",\r\n                params: [settingSize / 2]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setOpacity\",\r\n                params: [settingOpacity]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setColor\",\r\n                params: [settingColor]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setBlending\",\r\n                params: [settingBlending]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"startLine\",\r\n                params: [x, y, pressure]\r\n            });\r\n        }\r\n\r\n    };\r\n    this.goLine = function (p_x, p_y, pressure, preMixedColor) {\r\n        if (!isDrawing || (p_x === lastInput.x && p_y === lastInput.y)) {\r\n            return;\r\n        }\r\n\r\n        let e, b, a, g;\r\n        let x = parseInt(p_x);\r\n        let y = parseInt(p_y);\r\n        points.push([x, y]);\r\n\r\n        let mixr = settingColor.r;\r\n        let mixg = settingColor.g;\r\n        let mixb = settingColor.b;\r\n\r\n        if (preMixedColor !== null) {\r\n            mixr = preMixedColor.r;\r\n            mixg = preMixedColor.g;\r\n            mixb = preMixedColor.b;\r\n        } else {\r\n            if (settingBlending !== 0) {\r\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < context.canvas.width - 1 && y - 5 < context.canvas.height - 1) {\r\n                    mixr = 0;\r\n                    mixg = 0;\r\n                    mixb = 0;\r\n                    let mixx = Math.min(context.canvas.width - 1, Math.max(0, x - 5));\r\n                    let mixy = Math.min(context.canvas.height - 1, Math.max(0, y - 5));\r\n                    let mixw = Math.min(context.canvas.width - 1, Math.max(0, x + 5));\r\n                    let mixh = Math.min(context.canvas.height - 1, Math.max(0, y + 5));\r\n                    mixw -= mixx;\r\n                    mixh -= mixy;\r\n\r\n                    if (mixw > 0 && mixh > 0) {\r\n                        let imdat = context.getImageData(mixx, mixy, mixw, mixh);\r\n                        let countmix = 0;\r\n                        for (let i = 0; i < imdat.data.length; i += 4) {\r\n                            mixr += imdat.data[i + 0];\r\n                            mixg += imdat.data[i + 1];\r\n                            mixb += imdat.data[i + 2];\r\n                            countmix++;\r\n                        }\r\n                        mixr /= countmix;\r\n                        mixg /= countmix;\r\n                        mixb /= countmix;\r\n                    }\r\n\r\n                    let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\r\n                    mixr = parseInt('' + BB.mix(settingColor.r, mixed.r, settingBlending));\r\n                    mixg = parseInt('' + BB.mix(settingColor.g, mixed.g, settingBlending));\r\n                    mixb = parseInt('' + BB.mix(settingColor.b, mixed.b, settingBlending));\r\n                }\r\n            }\r\n        }\r\n\r\n        context.save();\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.lineWidth = settingSize;\r\n\r\n        context.beginPath();\r\n        context.moveTo(lastX, lastY);\r\n        context.lineTo(x, y);\r\n\r\n        for (e = 0; e < points.length; e++) {\r\n            b = points[e][0] - points[count][0];\r\n            a = points[e][1] - points[count][1];\r\n            g = b * b + a * a;\r\n            if (g < 4000 * settingScale * settingScale && rand() > g / 2000 / settingScale / settingScale) {\r\n                context.moveTo(points[count][0] + (b * 0.3), points[count][1] + (a * 0.3));\r\n                context.lineTo(points[e][0] - (b * 0.3), points[e][1] - (a * 0.3));\r\n            }\r\n        }\r\n\r\n        context.stroke();\r\n        context.restore();\r\n\r\n\r\n        count++;\r\n        lastX = x;\r\n        lastY = y;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}]\r\n        });\r\n    };\r\n    this.endLine = function () {\r\n        isDrawing = false;\r\n        count = 0;\r\n        points = [];\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: []\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n\r\n        context.save();\r\n        context.lineWidth = settingSize;\r\n\r\n        let mixr = settingColor.r, mixg = settingColor.g, mixb = settingColor.b;\r\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < context.canvas.width - 1 && y1 - 5 < context.canvas.height - 1) {\r\n            mixr = 0;\r\n            mixg = 0;\r\n            mixb = 0;\r\n            let mixx = Math.min(context.canvas.width - 1, Math.max(0, x1 - 5));\r\n            let mixy = Math.min(context.canvas.height - 1, Math.max(0, y1 - 5));\r\n            let mixw = Math.min(context.canvas.width - 1, Math.max(0, x1 + 5));\r\n            let mixh = Math.min(context.canvas.height - 1, Math.max(0, y1 + 5));\r\n            mixw -= mixx;\r\n            mixh -= mixy;\r\n            if (mixw > 0 && mixh > 0) {\r\n                let w = Math.min(sampleCanvas.width, mixw);\r\n                let h = Math.min(sampleCanvas.height, mixh);\r\n                sampleCtx.save();\r\n                sampleCtx.globalCompositeOperation = 'copy';\r\n                sampleCtx.drawImage(context.canvas, mixx, mixy, mixw, mixh, 0, 0, w, h);\r\n                sampleCtx.restore();\r\n\r\n                let imdat = sampleCtx.getImageData(mixx, mixy, mixw, mixh);\r\n                let countmix = 0;\r\n                for (let i = 0; i < imdat.data.length; i += 4) {\r\n                    mixr += imdat.data[i + 0];\r\n                    mixg += imdat.data[i + 1];\r\n                    mixb += imdat.data[i + 2];\r\n                    countmix++;\r\n                }\r\n                mixr /= countmix;\r\n                mixg /= countmix;\r\n                mixb /= countmix;\r\n            }\r\n        }\r\n        let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\r\n        mixr = parseInt('' + (settingBlending * mixed.r + settingColor.r * (1 - settingBlending)));\r\n        mixg = parseInt('' + (settingBlending * mixed.g + settingColor.g * (1 - settingBlending)));\r\n        mixb = parseInt('' + (settingBlending * mixed.b + settingColor.b * (1 - settingBlending)));\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.beginPath();\r\n        context.moveTo(x1, y1);\r\n        context.lineTo(x2, y2);\r\n        context.stroke();\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.restore();\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SketchyBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"setScale\",\r\n            params: [settingScale]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize / 2]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setBlending\",\r\n            params: [settingBlending]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nexport function PixelBrush() {\r\n\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let settingColor, settingSize = 0.5, settingSpacing = 0.9, settingOpacity = 1;\r\n    let settingColorStr;\r\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\r\n    let settingLockLayerAlpha = false;\r\n    let settingIsEraser = false;\r\n    let settingUseDither = true;\r\n\r\n    let lineToolLastDot;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n\r\n    let isDrawing = false;\r\n    let bezierLine = null;\r\n    let twoPI = Math.PI * 2;\r\n\r\n\r\n    let ditherCanvas = BB.canvas(4, 4);\r\n    let ditherCtx = ditherCanvas.getContext('2d');\r\n    let ditherPattern;\r\n    let ditherArr = [\r\n        [3, 2],\r\n        [1, 0],\r\n        [3, 0],\r\n        [1, 2],\r\n        [2, 1],\r\n        [0, 3],\r\n        [0, 1],\r\n        [2, 3],\r\n\r\n        [2, 0],\r\n        [0, 2],\r\n        [0, 0],\r\n        [2, 2],\r\n        [1, 1],\r\n        [3, 3],\r\n        [3, 1],\r\n        [1, 3]\r\n    ];\r\n\r\n    function updateDither() {\r\n        ditherCtx.clearRect(0, 0, 4, 4);\r\n        ditherCtx.fillStyle = settingIsEraser ? '#fff' : settingColorStr;\r\n        for (let i = 0; i < Math.max(1, Math.round(settingOpacity * ditherArr.length)); i++) {\r\n            ditherCtx.fillRect(ditherArr[i][0], ditherArr[i][1], 1, 1);\r\n        }\r\n        ditherPattern = context.createPattern(ditherCanvas, 'repeat');\r\n    }\r\n\r\n\r\n    /**\r\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\r\n     * @param p1\r\n     * @param p2\r\n     * @param p3\r\n     * @param p4\r\n     * @param maxAngleRad\r\n     */\r\n    function cubicCurveOverThreshold(p1, p2, p3, p4, max) {\r\n        let d = BB.Vec2.nor({\r\n            x: p4.x - p1.x,\r\n            y: p4.y - p1.y\r\n        });\r\n        let d2 = BB.Vec2.nor({\r\n            x: p2.x - p1.x,\r\n            y: p2.y - p1.y\r\n        });\r\n        let d3 = BB.Vec2.nor({\r\n            x: p4.x - p3.x,\r\n            y: p4.y - p3.y\r\n        });\r\n        let a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\r\n        let a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\r\n\r\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > max;\r\n    }\r\n\r\n    //bresenheim line drawing\r\n    function plotLine(x0, y0, x1, y1, skipFirst) {\r\n        context.save();\r\n\r\n        if (settingIsEraser) {\r\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n        context.globalAlpha = settingUseDither ? 1 : settingOpacity;\r\n\r\n        x0 = Math.floor(x0);\r\n        y0 = Math.floor(y0);\r\n        x1 = Math.floor(x1);\r\n        y1 = Math.floor(y1);\r\n\r\n        let dX = Math.abs(x1 - x0);\r\n        let sX = x0 < x1 ? 1 : -1;\r\n        let dY = -Math.abs(y1 - y0);\r\n        let sY = y0 < y1 ? 1 : -1;\r\n        let err = dX + dY;\r\n        while (true) {\r\n            if (skipFirst) {\r\n                skipFirst = false;\r\n            } else {\r\n                context.fillRect(x0, y0, 1, 1);\r\n            }\r\n            if (x0 === x1 && y0 === y1) {\r\n                break;\r\n            }\r\n            let e2 = 2 * err;\r\n            if (e2 >= dY) {\r\n                err += dY;\r\n                x0 += sX;\r\n            }\r\n            if (e2 <= dX) {\r\n                err += dX;\r\n                y0 += sY;\r\n            }\r\n        }\r\n\r\n        context.restore();\r\n    }\r\n\r\n    function plotCubicBezierLine(p1, p2, p3, p4) {\r\n\r\n        let isOverThreshold = cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\r\n\r\n        p1.x = Math.floor(p1.x);\r\n        p1.y = Math.floor(p1.y);\r\n        p4.x = Math.floor(p4.x);\r\n        p4.y = Math.floor(p4.y);\r\n\r\n        let dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\r\n        if (!isOverThreshold || dist < 7) {\r\n            plotLine(p1.x, p1.y, p4.x, p4.y, true);\r\n            return;\r\n        }\r\n\r\n        let n = Math.max(2, Math.round(dist / 4));\r\n        let pointArr = [];\r\n        for (let i = 0; i <= n; i++) {\r\n            let t = i / n;\r\n            let a = Math.pow(1 - t, 3);\r\n            let b = 3 * t * Math.pow(1 - t, 2);\r\n            let c = 3 * Math.pow(t, 2) * (1 - t);\r\n            let d = Math.pow(t, 3);\r\n            pointArr.push({\r\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\r\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            plotLine(\r\n                Math.round(pointArr[i].x),\r\n                Math.round(pointArr[i].y),\r\n                Math.round(pointArr[i + 1].x),\r\n                Math.round(pointArr[i + 1].y),\r\n                true\r\n            );\r\n        }\r\n    }\r\n\r\n    function drawDot(x, y, size, opacity, angle?) {\r\n        context.save();\r\n        if (settingIsEraser) {\r\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n        context.globalAlpha = settingUseDither ? 1 : opacity;\r\n        context.fillRect(\r\n            Math.round(x + -size),\r\n            Math.round(y + -size),\r\n            Math.round(size * 2),\r\n            Math.round(size * 2)\r\n        );\r\n        context.restore();\r\n    }\r\n\r\n\r\n    function continueLine(x, y, size, pressure) {\r\n        if (bezierLine === null) {\r\n            bezierLine = new BB.BezierLine();\r\n            bezierLine.add(lastInput.x, lastInput.y, 0, function () {\r\n            });\r\n        }\r\n\r\n        context.save();\r\n\r\n        function dotCallback(val) {\r\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\r\n            let localOpacity = settingOpacity * (settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            let localSize = Math.max(0.5, settingSize * (settingHasSizePressure ? localPressure : 1));\r\n            drawDot(val.x, val.y, localSize, localOpacity, val.angle);\r\n        }\r\n\r\n        function controlCallback(controlObj) {\r\n            plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\r\n        }\r\n\r\n        if (Math.round(settingSize * 2) === 1) {\r\n            if (x === null) {\r\n                bezierLine.addFinal(4, null, controlCallback);\r\n            } else {\r\n                bezierLine.add(x, y, 4, null, controlCallback);\r\n            }\r\n\r\n        } else {\r\n            let localSpacing = size * settingSpacing;\r\n\r\n            if (x === null) {\r\n                bezierLine.addFinal(localSpacing, dotCallback);\r\n            } else {\r\n                bezierLine.add(x, y, localSpacing, dotCallback);\r\n            }\r\n        }\r\n\r\n        context.restore();\r\n    }\r\n\r\n    //------------------ interface ---------------------------------------------------\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"PixelBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setIsEraser\",\r\n            params: [settingIsEraser]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setUseDither\",\r\n            params: [settingUseDither]\r\n        });\r\n\r\n        if (settingUseDither) {\r\n            updateDither();\r\n        }\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = settingHasOpacityPressure ? (settingOpacity * p * p) : settingOpacity;\r\n        let localSize = settingHasSizePressure ? Math.max(0.5, p * settingSize) : Math.max(0.5, settingSize);\r\n\r\n        isDrawing = true;\r\n        drawDot(x, y, localSize, localOpacity);\r\n        lineToolLastDot = localSize * settingSpacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2 = BB.copyObj(lastInput);\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n\r\n    this.goLine = function (x, y, p) {\r\n        if (!isDrawing) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        //debug\r\n        //drawDot(x, y, 1, 0.5);\r\n\r\n        let pressure = BB.clamp(p, 0, 1);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        continueLine(x, y, localSize, lastInput.pressure);\r\n\r\n        lastInput2 = BB.copyObj(lastInput);\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = pressure;\r\n    };\r\n\r\n    this.endLine = function (x, y) {\r\n\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n        continueLine(null, null, localSize, lastInput.pressure);\r\n\r\n        //debug\r\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\r\n        //drawDot(x, y, 10, 0.1);\r\n\r\n        isDrawing = false;\r\n\r\n        bezierLine = null;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: [x, y]\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (settingUseDither) {\r\n            updateDither();\r\n        }\r\n\r\n        if (Math.round(settingSize * 2) === 1) {\r\n            plotLine(x1, y1, x2, y2, true);\r\n        } else {\r\n            let angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\r\n            let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n            let eX = (x2 - x1) / mouseDist;\r\n            let eY = (y2 - y1) / mouseDist;\r\n            let loopDist;\r\n            let bdist = settingSize * settingSpacing;\r\n            lineToolLastDot = settingSize * settingSpacing;\r\n            for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n                drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\r\n            }\r\n        }\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"PixelBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setIsEraser\",\r\n            params: [settingIsEraser]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setUseDither\",\r\n            params: [settingUseDither]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n    //SET\r\n    this.setColor = function (c) {\r\n        if (settingColor === c) {\r\n            return;\r\n        }\r\n        settingColor = c;\r\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = Math.round(s * 2) / 2;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.setSpacing = function (s) {\r\n        settingSpacing = s;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        settingHasSizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        settingHasOpacityPressure = b;\r\n    };\r\n    this.setLockAlpha = function (b) {\r\n        settingLockLayerAlpha = b;\r\n    };\r\n    this.setIsEraser = function (b) {\r\n        settingIsEraser = !!b;\r\n    };\r\n    this.setUseDither = function (b) {\r\n        settingUseDither = !!b;\r\n    };\r\n    //GET\r\n    this.getSpacing = function () {\r\n        return settingSpacing;\r\n    };\r\n    this.getSize = function () {\r\n        return settingSize;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.getLockAlpha = function () {\r\n        return settingLockLayerAlpha;\r\n    };\r\n    this.getIsEraser = function () {\r\n        return settingIsEraser;\r\n    };\r\n    this.getUseDither = function () {\r\n        return settingUseDither;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nexport function EraserBrush() {\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let size = 30, spacing = 0.4, opacity = 1;\r\n    let sizePressure = true, opacityPressure = false;\r\n    let lastDot, lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n    let started = false;\r\n\r\n    let bezierLine;\r\n    let isBaseLayer = false;\r\n    let isTransparentBG = false;\r\n\r\n    function drawDot(x, y, size, opacity) {\r\n\r\n        context.save();\r\n        if (isBaseLayer) {\r\n            if (isTransparentBG) {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            } else {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        } else {\r\n            context.globalCompositeOperation = \"destination-out\";\r\n        }\r\n        let radgrad = context.createRadialGradient(size, size, 0, size, size, size);\r\n        let sharpness = Math.pow(opacity, 2);\r\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\r\n        let oFac = Math.max(0, Math.min(1, opacity));\r\n        let localOpacity = 2 * oFac - oFac * oFac;\r\n        radgrad.addColorStop(sharpness, \"rgba(255, 255, 255, \" + localOpacity + \")\");\r\n        radgrad.addColorStop(1, \"rgba(255, 255, 255, 0)\");\r\n        context.fillStyle = radgrad;\r\n        context.translate(x - size, y - size);\r\n        context.fillRect(0, 0, size * 2, size * 2);\r\n        context.restore();\r\n    }\r\n\r\n    function continueLine(x, y, p) {\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\r\n\r\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * localSize * spacing);\r\n\r\n        function bezierCallback(val) {\r\n            let factor = val.t;\r\n            localPressure = lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (opacityPressure) ? (opacity * localPressure * localPressure) : opacity;\r\n            localSize = (sizePressure) ? Math.max(0.1, localPressure * size) : Math.max(0.1, size);\r\n\r\n            drawDot(val.x, val.y, localSize, localOpacity);\r\n        }\r\n\r\n        if (x === null) {\r\n            bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n    }\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"EraserBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [opacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [sizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [size]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [opacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setTransparentBG\",\r\n            params: [isTransparentBG]\r\n        });\r\n\r\n        isBaseLayer = 0 === context.canvas.index;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = (opacityPressure) ? (opacity * p * p) : opacity;\r\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\r\n\r\n        started = true;\r\n        if (localSize > 1) {\r\n            drawDot(x, y, localSize, localOpacity);\r\n        }\r\n        lastDot = localSize * spacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2 = BB.copyObj(lastInput);\r\n\r\n        bezierLine = new BB.BezierLine();\r\n        bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n    this.goLine = function (x, y, p) {\r\n        if (!started) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        continueLine(x, y, lastInput.pressure);\r\n\r\n        lastInput2 = BB.copyObj(lastInput);\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n    };\r\n    this.endLine = function () {\r\n\r\n        if (bezierLine) {\r\n            continueLine(null, null, lastInput.pressure);\r\n        }\r\n\r\n        started = false;\r\n        bezierLine = undefined;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: []\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n\r\n        isBaseLayer = 0 === context.canvas.index;\r\n\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n\r\n        if (started || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * size * spacing);\r\n        lastDot = 0;\r\n        for (loopDist = lastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, size, opacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"EraserBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [opacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [sizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [size]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [opacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setTransparentBG\",\r\n            params: [isTransparentBG]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return started;\r\n    };\r\n    //SET\r\n    /*this.setAlpha = function(a) {\r\n        lastInput = {};\r\n        alpha = a;\r\n        updateAlphaCanvas();\r\n    };*/\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        size = s;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        opacity = o;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        sizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        opacityPressure = b;\r\n    };\r\n    this.setTransparentBG = function (b) {\r\n        isTransparentBG = b == true;\r\n    };\r\n    //GET\r\n    this.getSize = function () {\r\n        return size;\r\n    };\r\n    this.getOpacity = function () {\r\n        return opacity;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb.types';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB} from '../kl.types';\r\n\r\n// let statCount = 1;\r\n// let statAcc = 0;\r\n// stats on win10, chrome, size 100, opacity 80, smudge()\r\n// unoptimized: 1 ms\r\n// minimal: 0.09 ms\r\n// minimal + circle: 0.5ms\r\n// minimal + circle + ix, iy: 0.23ms\r\n// unoptimized + ix, iy: 0.64 ms\r\n// unoptimized + ix, iy + sans rounding: 0.61 ms\r\n// ix, iy + sans rounding + sans random: 0.32ms\r\n// ix, iy + sans rounding + fast random: 0.46 ms\r\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\r\n\r\nconst CELL_SIZE = 256;\r\n\r\ninterface ISmudgeParams {\r\n    aP: IVector2D;\r\n    bP: IVector2D;\r\n    size: {\r\n        w: number;\r\n        h: number;\r\n    };\r\n    brush: {\r\n        center: IVector2D,\r\n        size: number;\r\n        opacity: number;\r\n        alphaLock: boolean;\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * determine bounds of smudge\r\n * @param imWidth\r\n * @param imHeight\r\n * @param aP\r\n * @param bP\r\n * @param size\r\n */\r\nfunction prepSmudge(\r\n    imWidth: number,\r\n    imHeight: number,\r\n    aP: IVector2D, // top left of source, integers\r\n    bP: IVector2D, // top left of dest, integers\r\n    size: {w: number; h: number}, // size of both rectangles, integers\r\n): {\r\n    aP: IVector2D,\r\n    bP: IVector2D,\r\n    size: {w: number; h: number},\r\n} {\r\n\r\n    if (aP.x === bP.x && aP.y === bP.y) {\r\n        return null;\r\n    }\r\n\r\n    aP = BB.copyObj(aP);\r\n    bP = BB.copyObj(bP);\r\n    size = BB.copyObj(size);\r\n\r\n    // corner behavior\r\n    // cut down rectangles, if a or b go outside\r\n    // i.e. if user drags partially or fully outside the canvas\r\n    {\r\n        let top = 0;\r\n        let right = 0;\r\n        let bottom = 0;\r\n        let left = 0;\r\n\r\n        if (aP.x < 0) {\r\n            left = -aP.x;\r\n        }\r\n        if (aP.y < 0) {\r\n            top = -aP.y;\r\n        }\r\n        if (bP.x < 0) {\r\n            left = Math.max(left, -bP.x);\r\n        }\r\n        if (bP.y < 0) {\r\n            top = Math.max(top, -bP.y);\r\n        }\r\n        if (aP.x + size.w > imWidth) {\r\n            right = aP.x + size.w - imWidth;\r\n        }\r\n        if (aP.y + size.h > imHeight) {\r\n            bottom = aP.y + size.h - imHeight;\r\n        }\r\n        if (bP.x + size.w > imWidth) {\r\n            right = Math.max(right, bP.x + size.w - imWidth);\r\n        }\r\n        if (bP.y + size.h > imHeight) {\r\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\r\n        }\r\n\r\n        aP.x += left;\r\n        bP.x += left;\r\n        aP.y += top;\r\n        bP.y += top;\r\n\r\n        size.w = size.w - left - right;\r\n        size.h = size.h - top - bottom;\r\n        if (size.w <= 0 || size.h <= 0) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    return {\r\n        aP: {\r\n            x: aP.x,\r\n            y: aP.y,\r\n        },\r\n        bP: {\r\n            x: bP.x,\r\n            y: bP.y,\r\n        },\r\n        size: {\r\n            w: size.w,\r\n            h: size.h,\r\n        }\r\n    };\r\n}\r\n\r\n// faster than using BB.clamp somehow (in chrome)\r\nfunction clamp(num, min, max) {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num\r\n}\r\n\r\n/**\r\n * Pixel operations that do the smudging via ImageData\r\n * @param imageData\r\n * @param p\r\n */\r\nfunction smudge(imageData: ImageData, p : ISmudgeParams): void {\r\n\r\n    p = BB.copyObj(p);\r\n\r\n    const cSize = p.brush.size;\r\n    const cX = p.brush.center.x;\r\n    const cY = p.brush.center.y;\r\n\r\n    /*if (statCount % 1000 === 0) {\r\n        console.log(statAcc / 1000);\r\n        statAcc = 0;\r\n    }\r\n    let start = performance.now();*/\r\n\r\n\r\n    // determine offset\r\n    let aIndex = p.aP.y * imageData.width + p.aP.x;\r\n    let bIndex = p.bP.y * imageData.width + p.bP.x;\r\n    const offset = (bIndex - aIndex) * 4;\r\n\r\n    // array with random numbers. faster than Math.random()\r\n    let randI = 0;\r\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n    const randArr = [];\r\n    for (let i = 0; i < randLen; i++) {\r\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n    }\r\n\r\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\r\n\r\n    const pixel = (ai, bi, ix, iy) => {\r\n\r\n        const dist = BB.dist(cX, cY, ix, iy);\r\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\r\n\r\n        if (fac === 1) {\r\n            return;\r\n        }\r\n\r\n        if (!imageData.data[ai + 3]) {\r\n\r\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\r\n            imageData.data[bi] = imageData.data[ai + 0];\r\n            imageData.data[bi + 1] = imageData.data[ai + 1];\r\n            imageData.data[bi + 2] = imageData.data[ai + 2];\r\n        } else {\r\n\r\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\r\n            // not totally accurate. TODO same compositing as blend brush\r\n            let fac2;\r\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\r\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\r\n            } else {\r\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\r\n            }\r\n\r\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\r\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\r\n            // No +0.5, because it cancels out with rand.\r\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\r\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\r\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\r\n\r\n            randI = (randI + 1) % randLen;\r\n        }\r\n        // Always mix alpha. unless alpha lock\r\n        if (!p.brush.alphaLock) {\r\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\r\n        }\r\n\r\n    };\r\n\r\n    const bx1 = p.bP.x * 4;\r\n    const bx2 = bx1 + (p.size.w - 1) * 4;\r\n\r\n    // transfer of pixels depends on direction of smudging if there is overlap\r\n    if (p.aP.y < p.bP.y) {\r\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else if (p.aP.y > p.bP.y) {\r\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else {\r\n        if (p.aP.x < p.bP.x) {\r\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        } else {\r\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //statCount++;\r\n    //statAcc += performance.now() - start;\r\n}\r\n\r\nexport class SmudgeBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IHistoryEntry;\r\n\r\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\r\n    private settingSize: number = 35;\r\n    private settingSpacing: number = 0.20446882736951905;\r\n    private settingOpacity: number = 0.8;\r\n    private settingColorStr: string;\r\n    private settingHasSizePressure: boolean = false;\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingLockLayerAlpha: boolean = false;\r\n\r\n    private lineToolLastDot: number;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastDot: IVector2D;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private bezierLine: any = null; // todo type BezierLine\r\n\r\n    private redrawBounds: IBounds;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    private copyImageData: ImageData;\r\n\r\n    private drawBuffer: ISmudgeParams[] = [];\r\n\r\n    private copiedCells: boolean[];\r\n\r\n    updateRedrawBounds(bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    updateCompleteRedrawBounds (x1, y1, x2, y2): void {\r\n        this.completeRedrawBounds = BB.updateBounds(\r\n            this.completeRedrawBounds,\r\n            { x1, y1, x2, y2 }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    copyFromCanvas(): void {\r\n\r\n        const touchedCells = this.copiedCells.map(item => false);\r\n\r\n        const bounds: IBounds[] = [];\r\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\r\n\r\n        if (!this.redrawBounds) {\r\n            return;\r\n        }\r\n        bounds.push({\r\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\r\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\r\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\r\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\r\n        });\r\n        bounds.forEach(item => {\r\n            for (let i = item.x1; i <= item.x2; i++) {\r\n                for (let e = item.y1; e <= item.y2; e++) {\r\n                    touchedCells[e * cellsW + i] = true;\r\n                }\r\n            }\r\n        });\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.copiedCells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            this.copiedCells[i] = true;\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\r\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = tmpCanvas.getContext('2d');\r\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\r\n\r\n            const data = tmpCtx.getImageData(0, 0, w, h);\r\n\r\n            for (let i = 0; i < h; i++) {\r\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\r\n                    this.copyImageData.data[e3] = data.data[e2];\r\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\r\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\r\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * fill drawBuffer with params about to be drawn\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     */\r\n    prepDot (x: number, y: number, size: number, opacity: number): void {\r\n        if (!this.lastDot) {\r\n            this.lastDot = {\r\n                x: x,\r\n                y: y,\r\n            };\r\n            return;\r\n        }\r\n\r\n        size = Math.round(size);\r\n\r\n\r\n        const w = Math.round(size * 2);\r\n        const h = Math.round(size * 2);\r\n\r\n        const bounds = prepSmudge(\r\n            this.copyImageData.width,\r\n            this.copyImageData.height,\r\n            {\r\n                x: Math.round(this.lastDot.x - size),\r\n                y: Math.round(this.lastDot.y - size),\r\n            },\r\n            {\r\n                x: Math.round(x - size),\r\n                y: Math.round(y - size),\r\n            },\r\n            {\r\n                w,\r\n                h,\r\n            },\r\n        );\r\n\r\n        if (bounds) {\r\n            const params: ISmudgeParams = {\r\n                aP: bounds.aP,\r\n                bP: bounds.bP,\r\n                size: bounds.size,\r\n                brush: {\r\n                    center: { x, y },\r\n                    size,\r\n                    opacity,\r\n                    alphaLock: this.settingLockLayerAlpha,\r\n                }\r\n            };\r\n            this.updateRedrawBounds({\r\n                x1: params.bP.x,\r\n                y1: params.bP.y,\r\n                x2: params.bP.x + params.brush.size * 2,\r\n                y2: params.bP.y + params.brush.size * 2,\r\n            });\r\n            this.drawBuffer.push(params);\r\n        }\r\n\r\n        this.lastDot = {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    }\r\n\r\n    continueLine (x: number, y: number, size: number, pressure: number): void {\r\n        this.drawBuffer = [];\r\n\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function(){});\r\n        }\r\n\r\n        const drawArr = []; //draw instructions. will be all drawn at once\r\n\r\n        const dotCallback = (val): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        };\r\n\r\n        const localSpacing = size * this.settingSpacing / 3;\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            const item = drawArr[i];\r\n            this.prepDot(item[0], item[1], item[2], item[3]);\r\n            before = item;\r\n        }\r\n\r\n        this.copyFromCanvas();\r\n\r\n        for (let i = 0; i < this.drawBuffer.length; i++) {\r\n            smudge(this.copyImageData, this.drawBuffer[i]);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor () { }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.lastDot = null;\r\n        this.isDrawing = true;\r\n\r\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\r\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\r\n        this.copiedCells = '0'.repeat(totalCells).split('').map(item => false);\r\n\r\n        this.prepDot(x, y, localSize, localOpacity);\r\n\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2.pressure = p;\r\n\r\n        this.completeRedrawBounds = null;\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        this.redrawBounds = null;\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput2.pressure = this.lastInput.pressure;\r\n        this.lastInput.pressure = pressure;\r\n    }\r\n\r\n    endLine (): void {\r\n        this.redrawBounds = null;\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.context.save();\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n        this.context.restore();\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        if (this.historyEntry && this.completeRedrawBounds) {\r\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\r\n            if (!(\r\n                this.completeRedrawBounds.x1 === 0 &&\r\n                this.completeRedrawBounds.y1 === 0 &&\r\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\r\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\r\n            )) {\r\n\r\n                // temp canvas to prevent main canvas from getting slowed down in chrome\r\n                const tmpCanvas = BB.canvas(\r\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n                );\r\n                const tmpCtx = tmpCanvas.getContext('2d');\r\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\r\n            }\r\n            this.historyEntry.actions.push({\r\n                action: \"drawImage\",\r\n                params: [\r\n                    historyIm,\r\n                    this.completeRedrawBounds.x1,\r\n                    this.completeRedrawBounds.y1,\r\n                ],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n        this.copyImageData = null;\r\n    }\r\n\r\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\r\n        if (im instanceof ImageData) {\r\n            this.context.putImageData(im, x, y);\r\n        } else {\r\n            this.context.clearRect(x, y, im.width, im.height);\r\n            this.context.drawImage(im, x, y);\r\n        }\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        return;\r\n        /*\r\n        // todo\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n        // todo\r\n        history.add(historyEntry);*/\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\r\n            return;\r\n        }\r\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\r\n        this.settingColorStr = BB.ColorConverter.toRgbStr(this.settingColor);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = !!b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = !!b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl.types';\r\nimport {IBounds} from '../../bb/bb.types';\r\nimport {KlHistoryInterface} from '../history/kl-history';\r\n\r\ntype TChemyMode = 'fill' | 'stroke';\r\n\r\nexport class ChemyBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private settingColor: IRGB;\r\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\r\n    private settingOpacity: number = 1; // 0-1\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingIsEraser: boolean = false;\r\n    private settingMode: TChemyMode = 'fill';\r\n    private settingDistort: number = 0; // 0 - 1\r\n    private settingXSymmetry: boolean = false;\r\n    private settingYSymmetry: boolean = false;\r\n    private settingGradient: boolean = false;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private history: KlHistoryInterface;\r\n\r\n    private copyCanvas: HTMLCanvasElement;\r\n    private path: {x: number, y: number}[];\r\n    private minY: number;\r\n    private maxY: number;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    updateCompleteRedrawBounds (x, y): void {\r\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\r\n        if (this.settingXSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: -x + this.copyCanvas.width,\r\n                    y1: y,\r\n                    x2: -x + this.copyCanvas.width,\r\n                    y2: y,\r\n                }\r\n                );\r\n        }\r\n        if (this.settingYSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: x,\r\n                    y1: -y + this.copyCanvas.height,\r\n                    x2: x,\r\n                    y2: -y + this.copyCanvas.height,\r\n                }\r\n            );\r\n        }\r\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\r\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\r\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\r\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\r\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\r\n\r\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\r\n    }\r\n\r\n    private drawShape (): void {\r\n        this.context.save();\r\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\r\n        this.context.drawImage(this.copyCanvas, 0, 0);\r\n\r\n        let color = {...this.settingColor};\r\n        if (this.settingIsEraser) {\r\n            color.r = 255;\r\n            color.g = 255;\r\n            color.b = 255;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                this.context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n\r\n        if (this.path) {\r\n\r\n            // path\r\n            const path = new Path2D();\r\n            this.path.forEach((item, index) => {\r\n                if (index === 0) {\r\n                    path.moveTo(item.x, item.y);\r\n                } else {\r\n                    path.lineTo(item.x, item.y);\r\n                }\r\n            });\r\n\r\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\r\n                r: color.r,\r\n                g: color.g,\r\n                b: color.b,\r\n                a: this.settingOpacity,\r\n            });\r\n            if (this.settingGradient) {\r\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\r\n                const gradient = this.context.createLinearGradient(\r\n                    0, startAtTop ? this.minY : this.maxY,\r\n                    0, startAtTop ? this.maxY : this.minY,\r\n                );\r\n                gradient.addColorStop(\r\n                    0,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: this.settingOpacity,\r\n                    })\r\n                );\r\n                gradient.addColorStop(\r\n                    1,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: 0,\r\n                    })\r\n                );\r\n                style = gradient;\r\n            }\r\n\r\n            // setup params\r\n            if (this.settingMode === 'fill') {\r\n                this.context.fillStyle = style;\r\n\r\n            } else {\r\n                this.context.lineWidth = this.settingSize * 2;\r\n                this.context.lineJoin = 'bevel';\r\n                this.context.strokeStyle = style;\r\n            }\r\n\r\n            // draw\r\n            const draw = () => {\r\n                if (this.settingMode === 'fill') {\r\n                    this.context.fill(path);\r\n                } else {\r\n                    this.context.stroke(path);\r\n                }\r\n            };\r\n\r\n            draw();\r\n            if (this.settingXSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(this.context.canvas.width / 2, 0);\r\n                this.context.scale(-1, 1);\r\n                this.context.translate(-this.context.canvas.width / 2, 0);\r\n                draw();\r\n                this.context.restore();\r\n            }\r\n            if (this.settingYSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(0, this.context.canvas.height / 2);\r\n                this.context.scale(1, -1);\r\n                this.context.translate(0, -this.context.canvas.height / 2);\r\n                draw();\r\n                this.context.restore();\r\n                if (this.settingXSymmetry) {\r\n                    this.context.save();\r\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\r\n                    this.context.scale(-1, -1);\r\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\r\n                    draw();\r\n                    this.context.restore();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.settingColor = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setMode (mode: TChemyMode): void {\r\n        this.settingMode = mode;\r\n    }\r\n\r\n    getMode (): TChemyMode {\r\n        return this.settingMode;\r\n    }\r\n\r\n    setDistort (distort: number): void {\r\n        this.settingDistort = BB.clamp(distort, 0, 1);\r\n    }\r\n\r\n    getDistort (): number {\r\n        return this.settingDistort;\r\n    }\r\n\r\n    setXSymmetry (b: boolean): void {\r\n        this.settingXSymmetry = !!b;\r\n    }\r\n\r\n    getXSymmetry (): boolean {\r\n        return this.settingXSymmetry;\r\n    }\r\n\r\n    setYSymmetry (b: boolean): void {\r\n        this.settingYSymmetry = !!b;\r\n    }\r\n\r\n    getYSymmetry (): boolean {\r\n        return this.settingYSymmetry;\r\n    }\r\n\r\n    setGradient (b: boolean): void {\r\n        this.settingGradient = !!b;\r\n    }\r\n\r\n    getGradient (): boolean {\r\n        return this.settingGradient;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.settingIsEraser;\r\n    }\r\n\r\n    setIsEraser (b: boolean): void {\r\n        this.settingIsEraser = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    startLine (x: number, y: number): void {\r\n        this.isDrawing = true;\r\n        this.path = [{x, y}];\r\n        this.minY = y;\r\n        this.maxY = y;\r\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\r\n        this.copyCanvas.getContext('2d').drawImage(this.context.canvas, 0, 0);\r\n        this.completeRedrawBounds = null;\r\n        this.updateCompleteRedrawBounds(x, y);\r\n    }\r\n\r\n    goLine (x: number, y: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        let pos = { x, y };\r\n        if (this.settingDistort > 0) {\r\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\r\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\r\n        }\r\n\r\n        this.minY = Math.min(this.minY, pos.y);\r\n        this.maxY = Math.max(this.maxY, pos.y);\r\n        this.path.push(pos);\r\n        this.updateCompleteRedrawBounds(x, y);\r\n        this.drawShape();\r\n    }\r\n\r\n    endLine (): void {\r\n        this.isDrawing = false;\r\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\r\n        if (this.path.length > 1 && this.completeRedrawBounds) {\r\n            const historyCanvas = BB.canvas(\r\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n            );\r\n            const historyCtx = historyCanvas.getContext('2d');\r\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n            this.history.push({\r\n                tool: [\"brush\", \"ChemyBrush\"],\r\n                actions: [\r\n                    {\r\n                        action: \"drawImage\",\r\n                        params: [\r\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\r\n                            this.completeRedrawBounds.x1,\r\n                            this.completeRedrawBounds.y1,\r\n                        ],\r\n                    }\r\n                ]\r\n            });\r\n        }\r\n        this.path = null;\r\n        this.copyCanvas = null;\r\n    }\r\n\r\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\r\n        this.context.save();\r\n        this.context.clearRect(x, y, im.width, im.height);\r\n        this.context.drawImage(im, x, y);\r\n        this.context.restore();\r\n    }\r\n\r\n    drawLineSegment (x1, y1, x2, y2): void {\r\n        // might make sense for stroke\r\n    }\r\n}\r\n","import {penBrushUi} from './pen-brush-ui';\r\nimport {blendBrushUi} from './blend-brush-ui';\r\nimport {sketchyBrushUi} from './sketchy-brush-ui';\r\nimport {pixelBrushUi} from './pixel-brush-ui';\r\nimport {eraserBrushUi} from './eraser-brush-ui';\r\nimport {smudgeBrushUi} from './smudge-brush-ui';\r\nimport {chemyBrushUi} from './chemy-brush-ui';\r\nimport {IBrushUi} from '../kl.types';\r\n\r\n/**\r\n * UI for brushes.\r\n * Each brush ui carries the brush with it.\r\n * So if you want to draw, you do it through the UI. should be changed sometime.\r\n */\r\n\r\nexport const brushesUI: {\r\n    [key: string]: IBrushUi;\r\n} = {\r\n    penBrush: penBrushUi,\r\n    blendBrush: blendBrushUi,\r\n    sketchyBrush: sketchyBrushUi,\r\n    pixelBrush: pixelBrushUi,\r\n    chemyBrush: chemyBrushUi,\r\n    smudgeBrush: smudgeBrushUi,\r\n    eraserBrush: eraserBrushUi,\r\n};\r\n","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pen.svg';\r\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {input} from '../ui/base-components/input';\r\n\r\nexport const penBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pen'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1/100,\r\n            max: 1,\r\n            curve: [[0, 1/100], [0.5, 30/100], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    let alphaNames = [\r\n        LANG('brush-pen-circle'),\r\n        LANG('brush-pen-chalk'),\r\n        LANG('brush-pen-calligraphy'),\r\n        LANG('brush-pen-square'),\r\n    ];\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pen');\r\n        alphaNames = [\r\n            LANG('brush-pen-circle'),\r\n            LANG('brush-pen-chalk'),\r\n            LANG('brush-pen-calligraphy'),\r\n            LANG('brush-pen-square'),\r\n        ];\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.PenBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let alphas = [];\r\n        let currentAlpha = 0;\r\n        for (let i = 0; i < 4; i++) {\r\n            (function (i) {\r\n                let alpha = BB.el({\r\n                    title: alphaNames[i],\r\n                    onClick: () => {\r\n                        alphaClick(i);\r\n                    }\r\n                });\r\n                let canvas = BB.canvas(70, 70);\r\n                let ctx = canvas.getContext('2d');\r\n                if (i === 0 || i === 3) {\r\n                    if (i === 0) {\r\n                        ctx.beginPath();\r\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\r\n                        ctx.closePath();\r\n                        ctx.fill();\r\n                    } else {\r\n                        ctx.fillRect(5, 5, 60, 60);\r\n                    }\r\n                } else if (i === 1) {\r\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\r\n                } else if (i === 2) {\r\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\r\n                }\r\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\r\n\r\n                alphas.push(alpha);\r\n            }(i));\r\n        }\r\n\r\n        function updateAlphas() {\r\n            for (let i = 0; i < alphas.length; i++) {\r\n                if (i === currentAlpha) {\r\n                    alphas[i].className = 'brush-alpha-selected';\r\n                } else {\r\n                    alphas[i].className = 'brush-alpha';\r\n                }\r\n            }\r\n        }\r\n\r\n        updateAlphas();\r\n\r\n        function alphaClick(id) {\r\n            currentAlpha = id;\r\n            brush.setAlpha(id);\r\n            updateAlphas();\r\n        }\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n            css: {\r\n                cssFloat: 'right',\r\n                textAlign: 'right',\r\n            }\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let alphaWrapper = document.createElement(\"div\");\r\n            for (let i = 0; i < alphas.length; i++) {\r\n                alphaWrapper.appendChild(alphas[i]);\r\n            }\r\n            alphaWrapper.style.marginTop = \"10px\";\r\n            div.appendChild(alphaWrapper);\r\n            alphaWrapper.appendChild(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","\r\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iiCd6\");","import {BB} from '../../bb/bb';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-blend.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const blendBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-blend'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-blend');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.BlendBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 58,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            let blendingSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 225,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            blendingSlider.getElement().style.marginTop = \"10px\";\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.setSizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.setOpacityPressure(b);\r\n            });\r\n\r\n            let lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                    display: 'inline-block',\r\n                }\r\n            });\r\n\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                }),\r\n                blendingSlider.getElement(),\r\n                lockAlphaToggle.getElement()\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y, p, isCoalesced);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6fRlX\");","import {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-sketchy.png';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {BB} from '../../bb/bb';\r\n\r\nexport const sketchyBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-sketchy'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 10\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-sketchy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.SketchyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize() * 2,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: function (val) {\r\n                    brush.setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            let blendSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            let scaleSlider = new KlSlider({\r\n                label: LANG('brush-sketchy-scale'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 1,\r\n                max: 20,\r\n                value: brush.getScale(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setScale(val);\r\n                },\r\n            });\r\n            opacitySlider.getElement().style.marginTop = \"10px\";\r\n            blendSlider.getElement().style.marginTop = \"10px\";\r\n            scaleSlider.getElement().style.marginTop = \"10px\";\r\n            div.appendChild(sizeSlider.getElement());\r\n            div.appendChild(opacitySlider.getElement());\r\n            div.appendChild(blendSlider.getElement());\r\n            div.appendChild(scaleSlider.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, pressure) {\r\n            brush.startLine(x, y, pressure);\r\n        };\r\n        this.goLine = function (x, y, pressure) {\r\n            brush.goLine(x, y, pressure, null);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getSeed = function () {\r\n            return parseInt(brush.getSeed());\r\n        };\r\n        this.setSeed = function (s) {\r\n            brush.setSeed(parseInt(s));\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hC7PC\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pixel.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const pixelBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pixel'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pixel');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.PixelBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n            css: {\r\n                marginRight: '10px',\r\n            }\r\n        });\r\n\r\n        let eraserToggle = new Checkbox({\r\n            init: brush.getIsEraser(),\r\n            label: LANG('eraser'),\r\n            callback: function (b) {\r\n                brush.setIsEraser(b);\r\n            },\r\n            css: {\r\n                marginRight: '10px',\r\n            }\r\n        });\r\n\r\n        let ditherToggle = new Checkbox({\r\n            init: brush.getUseDither(),\r\n            label: LANG('brush-pixel-dither'),\r\n            callback: function (b) {\r\n                brush.setUseDither(b);\r\n            }\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                opacitySlider.getElement()\r\n            );\r\n\r\n            let toggleRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px'\r\n                }\r\n            });\r\n\r\n            toggleRow.appendChild(lockAlphaToggle.getElement());\r\n            toggleRow.appendChild(eraserToggle.getElement());\r\n            toggleRow.appendChild(ditherToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size * 2);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity * 100);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eZgVv\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-eraser.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const eraserBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('eraser') + ' [E]',\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 200,\r\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.EraserBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n        let isTransparentBg = false;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 30,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let transparencyToggle = new Checkbox({\r\n                init: false,\r\n                label: LANG('brush-eraser-transparent-bg'),\r\n                callback: function (b) {\r\n                    isTransparentBg = b;\r\n                    brush.setTransparentBG(b);\r\n                },\r\n                css: {\r\n                    marginTop: \"10px\",\r\n                }\r\n            });\r\n            div.appendChild(transparencyToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        function drawDot(x, y) {\r\n            brush.drawDot(x, y);\r\n        }\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            //brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.getIsTransparentBg = function () {\r\n            return isTransparentBg;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        }\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fPZin\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-smudge.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const smudgeBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-smudge'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-smudge');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.SmudgeBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(false, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let bottomRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            bottomRow.append(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fp7H1\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-chemy.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {BoxToggle} from '../ui/base-components/box-toggle';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const chemyBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-chemy'),\r\n        sizeSlider: {\r\n            min: 0.25,\r\n            max: 25,\r\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\r\n            isDisabled: true,\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-chemy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement(\"div\"); // the gui\r\n        const brush = new brushes.ChemyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider: KlSlider;\r\n        let opacitySlider: KlSlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                isEnabled: brush.getMode() === 'stroke',\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 5) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            BB.css(opacitySlider.getElement(), {\r\n                marginTop: '10px',\r\n            });\r\n\r\n            let eraserToggle = new Checkbox({\r\n                init: brush.getIsEraser(),\r\n                label: LANG('eraser'),\r\n                callback: function (b) {\r\n                    brush.setIsEraser(b);\r\n                },\r\n                css: {\r\n                    marginTop: '10px',\r\n                    marginLeft: '10px',\r\n                }\r\n            });\r\n\r\n            const lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n\r\n            const toggleRow = BB.el({\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n\r\n            const iconSize = 35;\r\n            const padding = 8;\r\n            const actualIconSize = iconSize - padding * 2;\r\n            const halfSize = actualIconSize / 2;\r\n\r\n            const modeOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'fill',\r\n                        label: BB.createSvg({\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: '#000',\r\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-fill'),\r\n                    },\r\n                    {\r\n                        id: 'stroke',\r\n                        label: BB.createSvg({\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: 'none',\r\n                                    stroke: '#000',\r\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-stroke'),\r\n                    }\r\n                ],\r\n                initId: brush.getMode(),\r\n                onChange: (id: string): void => {\r\n                    brush.setMode(id as 'stroke' | 'fill');\r\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\r\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\r\n\r\n                    const brushSize = brush.getSize();\r\n                    sizeSlider.setValue(brushSize);\r\n                    p.onSizeChange(brushSize);\r\n                    p.onConfigChange();\r\n                }\r\n            });\r\n\r\n            const mirrorXToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-mirror-x'),\r\n                init: brush.getXSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setXSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const mirrorYToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-mirror-y'),\r\n                init: brush.getYSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setYSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const gradientToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'defs',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'linearGradient',\r\n                                    id: 'gradient',\r\n                                    x1: '0',\r\n                                    y1: '0',\r\n                                    x2: '0',\r\n                                    y2: '1',\r\n                                    childrenArr: [\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '0%',\r\n                                            'stop-color': 'rgba(0,0,0,0)',\r\n                                        },\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '100%',\r\n                                            'stop-color': 'rgba(0,0,0,1)',\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            elementType: 'rect',\r\n                            fill: \"url('#gradient')\",\r\n                            x: '' + padding,\r\n                            y: '' + padding,\r\n                            width: '' + actualIconSize,\r\n                            height: '' + actualIconSize,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-gradient'),\r\n                init: brush.getGradient(),\r\n                onChange: (b) => {\r\n                    brush.setGradient(b);\r\n                },\r\n            });\r\n\r\n            BB.css(mirrorXToggle.getElement(), {\r\n                marginLeft: '10px',\r\n            });\r\n            {\r\n                const margin = {\r\n                    marginLeft: '4px',\r\n                };\r\n                BB.css(mirrorYToggle.getElement(), margin);\r\n                BB.css(gradientToggle.getElement(), margin);\r\n            }\r\n\r\n            toggleRow.append(\r\n                modeOptions.getElement(),\r\n                mirrorXToggle.getElement(),\r\n                mirrorYToggle.getElement(),\r\n                gradientToggle.getElement(),\r\n            );\r\n\r\n            div.append(\r\n                sizeSlider.getElement(),\r\n                opacitySlider.getElement(),\r\n                toggleRow,\r\n                BB.el({\r\n                    content: [\r\n                        lockAlphaToggle.getElement(),\r\n                        eraserToggle.getElement(),\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                    }\r\n                })\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eX098\");","import {BB} from '../../../bb/bb';\r\n\r\nexport class BoxToggle {\r\n    el: HTMLElement;\r\n    value: boolean;\r\n\r\n    update (): void {\r\n        this.el.classList.toggle('kl-box-toggle--active', this.value);\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            label: string | HTMLElement | SVGElement;\r\n            title?: string;\r\n            init?: boolean;\r\n            onChange: (b: boolean) => void;\r\n        }\r\n    ) {\r\n        this.value = !!p.init;\r\n        this.el = BB.el({\r\n            content: p.label,\r\n            title: p.title,\r\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\r\n            onClick: () => {\r\n                this.value = !this.value;\r\n                this.update();\r\n                p.onChange(this.value);\r\n            },\r\n            css: {\r\n                cursor: 'pointer',\r\n            }\r\n        });\r\n        if (typeof p.label !== 'string') {\r\n            BB.css(p.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n        this.update();\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.value;\r\n    }\r\n\r\n    setValue (b: boolean): void {\r\n        this.value = !!b;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.el);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showIframePopup(url, isEmbed) {\r\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\r\n        window.open(url);\r\n        return;\r\n    }\r\n\r\n    let iframe = BB.el({\r\n        tagName: 'iframe',\r\n        custom: {\r\n            src: url,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            height: '100%'\r\n        }\r\n    }) as HTMLIFrameElement;\r\n    let titleEl = BB.el({});\r\n\r\n    let linkEl;\r\n    if (!isEmbed) {\r\n        linkEl = BB.el({\r\n            tagName: 'a',\r\n            parent: titleEl,\r\n            content: LANG('modal-new-tab'),\r\n            custom: {\r\n                href: 'help',\r\n                target: '_blank',\r\n            },\r\n            onClick: function() {\r\n                popup.close();\r\n            }\r\n        }) as HTMLAnchorElement;\r\n        iframe.onload = function() {\r\n            BB.setAttributes(linkEl, {\r\n                href: '' + iframe.contentWindow.location,\r\n            });\r\n        };\r\n    }\r\n\r\n\r\n    let popup = new Popup({\r\n        title: titleEl,\r\n        content: iframe,\r\n        width: 880,\r\n        isMaxHeight: true,\r\n        onClose: () => {\r\n            if (linkEl) {\r\n                BB.destroyEl(linkEl);\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nexport class RadioList {\r\n\r\n    el: HTMLDivElement;\r\n    inputs: HTMLInputElement[] = [];\r\n\r\n    constructor({name, init, items, ignoreFocus}: {\r\n        name: string;\r\n        init?: string;\r\n        items: {\r\n            label: string;\r\n            value: string;\r\n        }[],\r\n        ignoreFocus?: boolean; // default false\r\n    }) {\r\n        this.el = BB.el({\r\n            className: 'kl-radio'\r\n        }) as HTMLDivElement;\r\n\r\n        items.forEach(item => {\r\n            let label = BB.el({\r\n                tagName: 'label'\r\n            });\r\n            let input = BB.el({\r\n                tagName: 'input',\r\n                parent: label,\r\n                custom: {\r\n                    name: name,\r\n                    value: item.value,\r\n                    type: 'radio',\r\n                }\r\n            }) as HTMLInputElement;\r\n            if (ignoreFocus) {\r\n                input.setAttribute('data-ignore-focus', 'true');\r\n            }\r\n            if (init === item.value) {\r\n                input.checked = true;\r\n            }\r\n            label.append(item.label);\r\n            this.el.append(label);\r\n            this.inputs.push(input);\r\n        });\r\n    }\r\n\r\n\r\n    getValue(): string {\r\n        for (let i = 0; i < this.inputs.length; i++) {\r\n            if (this.inputs[i].checked) {\r\n                return this.inputs[i].value;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getElement() {\r\n        return this.el;\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\nimport {IKlProject} from '../../kl.types';\r\nimport {showIframePopup} from '../modals/show-iframe-popup';\r\nimport {SaveReminder} from './save-reminder';\r\nimport {IProjectStoreListener, ProjectStore} from '../../storage/project-store';\r\nimport {KL} from '../../kl';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport class BrowserStorageUi {\r\n\r\n    private previewEl: HTMLDivElement;\r\n    private infoEl: HTMLDivElement;\r\n    private ageEl: HTMLDivElement;\r\n    private storeButtonEl: HTMLButtonElement;\r\n    private clearButtonEl: HTMLButtonElement;\r\n    private storeListener: IProjectStoreListener;\r\n\r\n    private timestamp: number;\r\n\r\n    private updateAge() {\r\n        if (!this.timestamp) {\r\n            return;\r\n        }\r\n        let age = new Date().getTime() - this.timestamp;\r\n        let ageStr;\r\n        age = Math.floor(age / 1000 / 60);\r\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\r\n        if (age > 60) {\r\n            age = Math.floor(age / 60);\r\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\r\n            if (age > 24) {\r\n                age = Math.floor(age / 24);\r\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\r\n                if (age > 31) {\r\n                    ageStr = LANG('file-storage-month-ago');\r\n                }\r\n            }\r\n        }\r\n        this.ageEl.textContent = ageStr;\r\n    }\r\n\r\n    private resetButtons() {\r\n        if (this.timestamp) {\r\n            this.storeButtonEl.textContent = LANG('file-storage-overwrite');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = false;\r\n        } else {\r\n            this.storeButtonEl.textContent = LANG('file-storage-store');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = true;\r\n        }\r\n    }\r\n\r\n    private updateThumb(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.timestamp = timestamp;\r\n        if (this.timestamp) {\r\n            BB.css(thumbnail, {\r\n                display: 'block',\r\n                maxWidth: 'calc(100% - 2px)',\r\n                maxHeight: 'calc(100% - 2px)',\r\n                margin: '0 auto',\r\n                background: \"url('\" + BB.createCheckerCanvas(4).toDataURL('image/png') + \"')\",\r\n                boxShadow: '0 0 0 1px #aaa',\r\n                pointerEvents: 'none',\r\n            });\r\n            this.previewEl.innerHTML = '';\r\n            this.updateAge();\r\n            this.previewEl.append(thumbnail, this.ageEl);\r\n        } else {\r\n            this.previewEl.innerHTML = LANG('file-storage-empty');\r\n        }\r\n        this.resetButtons();\r\n    }\r\n\r\n    private async store() {\r\n        this.storeButtonEl.textContent = LANG('file-storage-storing');\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        await new Promise((resolve) => {\r\n            setTimeout(() => resolve(null), 20);\r\n        });\r\n        try {\r\n            await this.projectStore.store(this.getProject());\r\n            this.saveReminder.reset();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: [\r\n                    `${LANG('file-storage-failed-1')}<ul>`,\r\n                    `<li>${LANG('file-storage-failed-2')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-3')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-4')}</li>`,\r\n                    `</ul>`,\r\n                ].join(''),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to store browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    private async clear() {\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        try {\r\n            await this.projectStore.clear();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: LANG('file-storage-failed-clear'),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    element: HTMLDivElement;\r\n\r\n    constructor (\r\n        private projectStore: ProjectStore,\r\n        private getProject: () => IKlProject,\r\n        private saveReminder: SaveReminder,\r\n        private klRootEl: HTMLDivElement,\r\n        private options?: { hideClearButton?: boolean; isFocusable?: boolean }, // isFocusable default = false\r\n    ) {\r\n        this.element = BB.el({\r\n            css: {\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 0fr',\r\n                gridTemplateRows: '0fr 0fr 0fr',\r\n                gap: '0 0',\r\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n\r\n        const title = BB.el({\r\n            parent: this.element,\r\n            content: LANG('file-storage'),\r\n            css: {\r\n                gridArea: 'title',\r\n                display: 'flex',\r\n                margin: '-5px 0',\r\n                //background: '#f00',\r\n            }\r\n        });\r\n\r\n        this.infoEl = BB.el({\r\n            parent: title,\r\n            content: '?',\r\n            title: LANG('file-storage-about'),\r\n            css: {\r\n                cursor: 'pointer',\r\n                marginLeft: '5px',\r\n                width: '19px',\r\n                height: '19px',\r\n                borderRadius: '100%',\r\n                textAlign: 'center',\r\n                lineHeight: '19px',\r\n                fontWeight: 'bold',\r\n                boxShadow: 'inset 0 0 0 1px #000',\r\n            },\r\n            onClick: () => {\r\n                showIframePopup('./help/#help-browser-storage', false);\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.projectStore.isBroken()) {\r\n            BB.el({\r\n                parent: this.element,\r\n                content: \"🔴 \" + LANG('file-storage-cant-access'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.previewEl = BB.el({\r\n            parent: this.element,\r\n            title: LANG('file-storage-thumb-title'),\r\n            css: {\r\n                gridArea: 'preview',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                marginTop: '10px',\r\n                position: 'relative',\r\n                boxShadow: 'inset 0 0 0 1px #aaa',\r\n                background: '#cdcdcd',\r\n                color: '#545454',\r\n                colorScheme: 'only light',\r\n                minHeight: '67px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        this.ageEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                right: '0',\r\n                bottom: '0',\r\n                width: '100%',\r\n                textAlign: 'center',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                color: '#fff',\r\n                textSize: '13px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        const btnCustom = options?.isFocusable ?  {} : {\r\n            tabIndex: -1,\r\n        };\r\n        this.storeButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: LANG('file-storage-store'),\r\n            css: {\r\n                gridArea: 'store',\r\n                //background: '#00f',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.store(),\r\n        }) as HTMLButtonElement;\r\n        this.clearButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\r\n            css: {\r\n                gridArea: 'clear',\r\n                //background: '#ff0',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.clear(),\r\n        }) as HTMLButtonElement;\r\n\r\n        if (this.options?.hideClearButton) {\r\n            this.clearButtonEl.style.visibility = 'hidden';\r\n        }\r\n\r\n        this.storeListener = {\r\n            onUpdate: (timestamp, thumbnail) => {\r\n                this.updateThumb(timestamp, thumbnail);\r\n            },\r\n        };\r\n        this.projectStore.subscribe(this.storeListener);\r\n\r\n        setInterval(() => this.updateAge(), 1000 * 60);\r\n\r\n        (async () => {\r\n            try {\r\n                const readResult = await this.projectStore.read();\r\n                if (readResult) {\r\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\r\n                } else {\r\n                    this.updateThumb();\r\n                }\r\n            } catch (e) {\r\n                setTimeout(() => {\r\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\r\n                }, 0);\r\n            }\r\n        })();\r\n    }\r\n\r\n\r\n    getElement() {\r\n        return this.element;\r\n    }\r\n\r\n    show () {\r\n        // todo\r\n    }\r\n\r\n    hide () {\r\n        // todo\r\n    }\r\n\r\n    destroy() {\r\n        BB.destroyEl(this.infoEl);\r\n        BB.destroyEl(this.storeButtonEl);\r\n        BB.destroyEl(this.clearButtonEl);\r\n        this.projectStore.unsubscribe(this.storeListener);\r\n    }\r\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\r\nimport {ProjectConverter} from './project-converter';\r\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\r\nimport {LocalStorage} from '../../bb/base/local-storage';\r\n\r\n\r\nexport interface IProjectStoreListener {\r\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void,\r\n}\r\n\r\nfunction makeAsync(func): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n        func(resolve, reject);\r\n    });\r\n}\r\n\r\n/**\r\n * simplified interface for storing projects into browser storage\r\n */\r\nexport class ProjectStore {\r\n\r\n    private listeners: IProjectStoreListener[] = [];\r\n    private accessHasFailed: boolean = false;\r\n\r\n    async lowLevelStore (project: IKlStorageProject): Promise<any> {\r\n        await new Promise((resolve, reject) => {\r\n            storeKlProjectObj(project, resolve, reject);\r\n        });\r\n    }\r\n\r\n    async lowLevelRead (): Promise<IKlStorageProject> {\r\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\r\n    }\r\n\r\n    async lowLevelClear (): Promise<any> {\r\n        await makeAsync(clear);\r\n    }\r\n\r\n\r\n\r\n    private emit(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.listeners.forEach(item => {\r\n            item.onUpdate(timestamp, thumbnail);\r\n        });\r\n    }\r\n\r\n    private updateTimestamp() {\r\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\r\n                return;\r\n            }\r\n            try {\r\n                ( async () => {\r\n                    const readResult = await this.read();\r\n                    if (readResult) {\r\n                        this.emit(readResult.timestamp, readResult.thumbnail);\r\n                    } else {\r\n                        this.emit();\r\n                    }\r\n                })();\r\n            } catch (e) {\r\n                if (e.message.indexOf('db-error') === 0) {\r\n                    this.accessHasFailed = true;\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    async read(): Promise<{\r\n        project: IKlProject,\r\n        timestamp: number,\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement\r\n    } | null> {\r\n        let storageProject;\r\n        try {\r\n            storageProject = await this.lowLevelRead();\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        if (!storageProject) {\r\n            return null;\r\n        }\r\n        let result;\r\n        try {\r\n            result = await ProjectConverter.readStorageProject(storageProject);\r\n        } catch (e) {\r\n            throw new Error('format-error: ' + e);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    async store(project: IKlProject): Promise<void> {\r\n        try {\r\n            const storageProject = ProjectConverter.createStorageProject(project);\r\n            await this.lowLevelStore(storageProject);\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        {\r\n            // immediately test if it can be read\r\n            const storageProject = await this.lowLevelRead();\r\n            let readResult = null;\r\n            try {\r\n                readResult = await ProjectConverter.readStorageProject(storageProject);\r\n            } catch (e) {\r\n                await this.lowLevelClear();\r\n                this.updateTimestamp();\r\n                setTimeout(() => this.emit(), 0);\r\n                throw new Error('format-error: ' + e);\r\n            }\r\n            this.updateTimestamp();\r\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\r\n        }\r\n    }\r\n\r\n    async clear(): Promise<void> {\r\n        await this.lowLevelClear();\r\n        this.updateTimestamp();\r\n        setTimeout(() => this.emit(), 0);\r\n    }\r\n\r\n    subscribe(listener: IProjectStoreListener) {\r\n        if (this.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        this.listeners.push(listener);\r\n    }\r\n\r\n    unsubscribe(listener: IProjectStoreListener) {\r\n        for (let i = 0; i < this.listeners.length; i++) {\r\n            if (listener === this.listeners[i]) {\r\n                this.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    isBroken() {\r\n        return this.accessHasFailed;\r\n    }\r\n\r\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\r\nimport {BB} from '../../bb/bb';\r\nimport {drawProject} from '../canvas/draw-project';\r\nimport {base64ToBlob} from './base-64-to-blob';\r\n\r\n\r\nconst thumbSize = 240;\r\n\r\nfunction loadImage(blob: Blob): Promise<HTMLImageElement> {\r\n    return new Promise<HTMLImageElement>((resolve, reject) => {\r\n        const im = new Image();\r\n        try {\r\n            im.src = BB.imageBlobToUrl(blob);\r\n        } catch (e) {\r\n            reject('imageBlobToUrl, ' + e.message);\r\n            return;\r\n        }\r\n        im.onload = () => {\r\n            URL.revokeObjectURL(im.src);\r\n            resolve(im);\r\n        }\r\n        im.onabort = function () {\r\n            reject('layer image failed loading');\r\n        };\r\n        im.onerror = function () {\r\n            reject('layer image failed loading');\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * for:\r\n * - preparing project to be stored in ProjectStore\r\n * - reading a project that came out of the ProjectStore\r\n */\r\nexport class ProjectConverter {\r\n\r\n    private static createThumbnail(project): HTMLCanvasElement {\r\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\r\n        const factor = size.width / project.width;\r\n        return drawProject(project, factor);\r\n    }\r\n\r\n    static createStorageProject(project: IKlProject): IKlStorageProject {\r\n        return {\r\n            id: 1,\r\n            timestamp: new Date().getTime(),\r\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\r\n            width: project.width,\r\n            height: project.height,\r\n            layers: project.layers.map(item => {\r\n                let blob;\r\n                if (item.image instanceof HTMLCanvasElement) {\r\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\r\n                } else {\r\n                    // todo image\r\n                    throw new Error('Not implemented');\r\n                }\r\n                return {\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                    blob,\r\n                }\r\n            }),\r\n        };\r\n    }\r\n\r\n    static async readStorageProject(storageProject: IKlStorageProject): Promise<{\r\n        project: IKlProject,\r\n        timestamp: number,\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement\r\n    }> {\r\n        if (\r\n            !storageProject.width || !storageProject.height ||\r\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\r\n            storageProject.width < 1 || storageProject.height < 1\r\n        ) {\r\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\r\n        }\r\n        const project: IKlProject = {\r\n            width: storageProject.width,\r\n            height: storageProject.height,\r\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\r\n                .map((image, i) => {\r\n                    return {\r\n                        name: storageProject.layers[i].name,\r\n                        opacity: storageProject.layers[i].opacity,\r\n                        mixModeStr: storageProject.layers[i].mixModeStr,\r\n                        image,\r\n                    };\r\n                }),\r\n        };\r\n\r\n        let thumbnail;\r\n        if (storageProject.thumbnail) {\r\n            thumbnail = await loadImage(storageProject.thumbnail);\r\n        } else {\r\n            thumbnail = ProjectConverter.createThumbnail(project);\r\n        }\r\n\r\n        return {\r\n            project: project,\r\n            timestamp: storageProject.timestamp,\r\n            thumbnail: thumbnail,\r\n        };\r\n    }\r\n\r\n}","\r\nexport function base64ToBlob(base64Str: string): Blob {\r\n    let parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n    let binStr = atob(parts[3]);\r\n    let buf = new ArrayBuffer(binStr.length);\r\n    let view = new Uint8Array(buf);\r\n    for (let i = 0; i < view.length; i++) {\r\n        view[i] = binStr.charCodeAt(i);\r\n    }\r\n    return new Blob([view], {'type': parts[1]});\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\n// @ts-ignore\r\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\r\nimport {BrowserStorageUi} from '../components/browser-storage-ui';\r\nimport {IKlProject} from '../../kl.types';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport type exportType = 'png' | 'layers' | 'psd';\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport class FileTab {\r\n\r\n    private readonly div: HTMLDivElement;\r\n    private importButton: HTMLInputElement;\r\n    private fileBrowserStorage: BrowserStorageUi;\r\n\r\n    constructor(\r\n        klRootEl,\r\n        projectStore: ProjectStore,\r\n        getProject: () => IKlProject,\r\n        private exportType,\r\n        onExportTypeChange,\r\n        onFileSelect,\r\n        onSaveImageToComputer,\r\n        onNewImage,\r\n        onShareImage,\r\n        onUpload,\r\n        onCopyToClipboard,\r\n        saveReminder: SaveReminder,\r\n    ) {\r\n        const _this = this;\r\n        this.div = document.createElement(\"div\");\r\n\r\n        const asyncCreation = () => {\r\n            let filemenu = document.createElement(\"div\");\r\n            let newButton = document.createElement(\"button\");\r\n            let saveButton = document.createElement(\"button\");\r\n            let shareButton = document.createElement(\"button\");\r\n            let uploadImgurButton = document.createElement(\"button\");\r\n            let clipboardButton = document.createElement(\"button\");\r\n\r\n            newButton.style.cssFloat = 'left';\r\n            BB.css(saveButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n            BB.css(clipboardButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n\r\n            newButton.tabIndex = -1;\r\n            saveButton.tabIndex = -1;\r\n            shareButton.tabIndex = -1;\r\n            uploadImgurButton.tabIndex = -1;\r\n            clipboardButton.tabIndex = -1;\r\n\r\n            newButton.innerHTML = `<img src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\r\n            saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\r\n            shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\r\n            uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\r\n            clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\r\n            clipboardButton.title = LANG('file-copy-title');\r\n            newButton.className = \"gridButton\";\r\n            saveButton.className = \"gridButton\";\r\n            shareButton.className = \"gridButton\";\r\n            uploadImgurButton.className = \"gridButton\";\r\n            clipboardButton.className = \"gridButton\";\r\n\r\n\r\n            this.importButton = document.createElement(\"input\");\r\n            this.importButton.tabIndex = -1;\r\n            this.importButton.type = \"file\";\r\n            this.importButton.multiple = true;\r\n            this.importButton.accept = \"image\";\r\n            (this.importButton as any).size = \"71\";\r\n            this.importButton.textContent = \"Import\";\r\n            let importWrapper: any = this.importButton;\r\n\r\n            function createImportButton() {\r\n                importWrapper = document.createElement(\"div\");\r\n                importWrapper.className = \"gridButton\";\r\n                importWrapper.style.position = \"relative\";\r\n                importWrapper.style.cursor = \"pointer\";\r\n                importWrapper.style.cssFloat = \"left\";\r\n\r\n                let innerMask = document.createElement(\"div\");\r\n                innerMask.style.width = \"120px\";\r\n                innerMask.style.height = \"28px\";\r\n                innerMask.style.overflow = \"hidden\";\r\n                innerMask.style.cursor = \"pointer\";\r\n                innerMask.style.position = \"relative\";\r\n\r\n                importWrapper.appendChild(innerMask);\r\n                innerMask.appendChild(_this.importButton);\r\n\r\n                let importFakeButton = document.createElement(\"button\");\r\n                importFakeButton.innerHTML = \"<img style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import');\r\n                importFakeButton.tabIndex = -1;\r\n\r\n                BB.css(importFakeButton, {\r\n                    width: \"120px\",\r\n                    display: \"box\",\r\n                    position: \"absolute\",\r\n                    left: '0',\r\n                    top: '0',\r\n                    cursor: \"pointer\"\r\n                });\r\n                BB.css(_this.importButton, {\r\n                    display: 'none'\r\n                });\r\n                importWrapper.appendChild(importFakeButton);\r\n\r\n                importFakeButton.onclick = function() {\r\n                    _this.importButton.click();\r\n                }\r\n            }\r\n\r\n            createImportButton();\r\n\r\n            this.importButton.onchange = function (e) {\r\n                onFileSelect(_this.importButton.files, 'default');\r\n                _this.importButton.value = \"\";\r\n\r\n            };\r\n\r\n\r\n            // --- export filetype dropdown ---\r\n            let exportTypeWrapper;\r\n            let exportTypeSelect;\r\n            {\r\n                exportTypeWrapper = BB.el({\r\n                    css: {\r\n                        fontSize: '15px',\r\n                        marginLeft: '10px',\r\n                        marginTop: '10px',\r\n                        cssFloat: 'left',\r\n                        width: 'calc(50% - 15px)',\r\n                        height: '30px'\r\n                    }\r\n                });\r\n                exportTypeSelect = new KL.Select({\r\n                    optionArr: [\r\n                        ['png', LANG('file-save-png')],\r\n                        ['psd', LANG('file-save-psd')],\r\n                        ['layers', LANG('file-save-layers')],\r\n                    ],\r\n                    initValue: exportType,\r\n                    onChange: function(val) {\r\n                        exportType = val;\r\n                        onExportTypeChange(exportType);\r\n                        onSaveImageToComputer();\r\n                    }\r\n                });\r\n                BB.css(exportTypeSelect.getElement(), {\r\n                    width: '120px',\r\n                    height: '30px'\r\n                });\r\n                exportTypeWrapper.appendChild(exportTypeSelect.getElement());\r\n\r\n            }\r\n\r\n\r\n\r\n            newButton.onclick = onNewImage;\r\n            saveButton.onclick = function () {\r\n                onSaveImageToComputer();\r\n            };\r\n            shareButton.onclick = function() {\r\n                shareButton.disabled = true;\r\n                onShareImage(() => {\r\n                    shareButton.disabled = false;\r\n                });\r\n            };\r\n            uploadImgurButton.onclick = function () {\r\n                onUpload();\r\n            };\r\n\r\n            clipboardButton.onclick = function() {\r\n                clipboardButton.blur();\r\n                onCopyToClipboard();\r\n            };\r\n\r\n            let saveNote = document.createElement(\"div\");\r\n            saveNote.textContent = \"⚠️ \" + LANG('file-no-autosave');\r\n            BB.css(saveNote, {\r\n                textAlign: \"center\",\r\n                marginTop: \"10px\",\r\n                background: \"rgb(243, 243, 161)\",\r\n                padding: \"5px 0px\",\r\n                color: 'rgba(0,0,0,0.65)',\r\n                fontSize: '15px',\r\n            });\r\n\r\n            function createSpacer() {\r\n                let el = document.createElement(\"div\");\r\n                let clearer = document.createElement(\"div\");\r\n                let line = document.createElement(\"div\");\r\n                el.appendChild(clearer);\r\n                el.appendChild(line);\r\n                BB.css(clearer, {\r\n                    clear: 'both'\r\n                });\r\n                BB.css(line, {\r\n                    marginLeft: \"10px\",\r\n                    marginRight: \"10px\",\r\n                    marginTop: \"10px\",\r\n                    borderBottom: \"1px solid rgba(0,0,0,0.2)\",\r\n                    clear: 'both'\r\n                });\r\n                return el;\r\n            }\r\n\r\n            _this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder, klRootEl);\r\n            BB.css(_this.fileBrowserStorage.getElement(), {\r\n                //background: 'red',\r\n                margin: '10px',\r\n            });\r\n\r\n\r\n            //actual structure\r\n            BB.append(filemenu, [\r\n                saveNote,\r\n                newButton,\r\n                importWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                saveButton,\r\n                exportTypeWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                clipboardButton,\r\n                BB.canShareFiles() ? shareButton : null,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                createSpacer(),\r\n                _this.fileBrowserStorage.getElement(),\r\n                createSpacer(),\r\n                uploadImgurButton,\r\n            ]);\r\n\r\n            this.div.appendChild(filemenu);\r\n        };\r\n\r\n        setTimeout(asyncCreation, 1);\r\n    }\r\n\r\n    refresh() {\r\n    }\r\n\r\n    getElement() {\r\n        return this.div;\r\n    }\r\n\r\n    setIsVisible(isVisible: boolean) {\r\n        if (isVisible) {\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    triggerImport() {\r\n        this.importButton.click();\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2oHM2\");","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\nimport {StatusOverlay} from '../components/status-overlay';\r\nimport {KlCanvasWorkspace} from '../../canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../../kl.types';\r\n\r\n\r\nexport class FilterTab {\r\n\r\n    private readonly div: HTMLDivElement;\r\n    private isInit = false;\r\n\r\n    constructor (\r\n        private klRootEl,\r\n        private klColorSlider,\r\n        private layerManager,\r\n        // private setCurrentLayer,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private handUi,\r\n        private getCurrentColor,\r\n        private getKlMaxCanvasSize,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx,\r\n        private isEmbed: boolean,\r\n        private statusOverlay: StatusOverlay,\r\n    ) {\r\n        this.div = document.createElement(\"div\");\r\n    }\r\n\r\n    private init() {\r\n        const _this = this;\r\n        let filters = KL.filterLib;\r\n        let buttons = [];\r\n\r\n        BB.BbLog.emit({\r\n            type: 'init-filters',\r\n        });\r\n\r\n        if (!KL.filterLibStatus.isLoaded) {\r\n            throw new Error('filters not loaded');\r\n        }\r\n\r\n        function createButton(filterKey, filterArr) {\r\n            let button = document.createElement(\"button\");\r\n            let buttonLabel = LANG(filterArr[filterKey].lang.button);\r\n            let im = '<img height=\"20\" width=\"18\" src=\"' + filterArr[filterKey].icon + '\" alt=\"icon\" />';\r\n            button.innerHTML = im + buttonLabel;\r\n            button.className = \"gridButton\";\r\n            BB.css(button, {\r\n                lineHeight: '20px',\r\n                fontSize: '12px',\r\n            });\r\n            button.tabIndex = -1;\r\n\r\n            const filterName = LANG(filterArr[filterKey].lang.name);\r\n\r\n            button.onclick = function () {\r\n\r\n                function finishedDialog(result, filterDialog) {\r\n                    if (result == \"Cancel\") {\r\n                        if (filterDialog.destroy) {\r\n                            filterDialog.destroy();\r\n                        }\r\n                        return;\r\n                    }\r\n                    let input;\r\n                    try {\r\n                        input = filterDialog.getInput(); // also destroys\r\n                    } catch (e) {\r\n                        if (e.message.indexOf('.getInput is not a function') !== -1) {\r\n                            throw 'filterDialog.getInput is not a function, filter: ' + filterName;\r\n                        } else {\r\n                            throw e;\r\n                        }\r\n                    }\r\n                    applyFilter(input);\r\n                }\r\n\r\n                if (!('apply' in filterArr[filterKey])) {\r\n                    alert('Application not fully loaded');\r\n                    return;\r\n                }\r\n\r\n                function applyFilter(input) {\r\n                    let filterResult = filterArr[filterKey].apply({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        klCanvas: _this.getKlCanvas(),\r\n                        history: klHistory,\r\n                        input: input\r\n                    } as IFilterApply);\r\n                    if (filterResult === false) {\r\n                        alert(\"Couldn't apply the edit action\");\r\n                    }\r\n                    /*\r\n                     _this.setCurrentLayer(_this.getKlCanvas().getLayer(_this.layerManager.getSelected()));\r\n                    */\r\n                    if (filterArr[filterKey].updatePos === true) {\r\n                        _this.klCanvasWorkspace.resetView();\r\n                        _this.handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    _this.layerManager.update();\r\n                }\r\n\r\n                if (filterArr[filterKey].isInstant){\r\n                    button.blur();\r\n                    applyFilter(null);\r\n                    _this.statusOverlay.out('\"' + filterName + '\" ' + LANG('filter-applied'), true);\r\n                } else {\r\n                    let secondaryColorRGB = _this.klColorSlider.getSecondaryRGB();\r\n                    let filterDialog = filterArr[filterKey].getDialog({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        klCanvas: _this.getKlCanvas(),\r\n                        maxWidth: _this.getKlMaxCanvasSize(),\r\n                        maxHeight: _this.getKlMaxCanvasSize(),\r\n                        currentColorRgb: {r: _this.getCurrentColor().r, g: _this.getCurrentColor().g, b: _this.getCurrentColor().b},\r\n                        secondaryColorRgb: {r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b}\r\n                    } as IFilterGetDialogParam) as IFilterGetDialogResult;\r\n\r\n                    if (!filterDialog) {\r\n                        return;\r\n                        //alert('Error: could not perform action');\r\n                        //throw('filter['+filterKey+'].getDialog returned '+filterDialog+'. ctx:' + currentLayerCtx + ' klCanvas:' + klCanvas);\r\n                    }\r\n\r\n                    let closefunc;\r\n                    // Todo should move into getDialogParams\r\n                    filterDialog.errorCallback = function(e) {\r\n                        setTimeout(function() {\r\n                            alert('Error: could not perform action');\r\n                            throw e;\r\n                        }, 0);\r\n                        closefunc();\r\n                    };\r\n\r\n\r\n                    let style: IKeyString = {};\r\n                    if ('width' in filterDialog) {\r\n                        style.width = filterDialog.width + 'px'\r\n                    }\r\n\r\n                    KL.popup({\r\n                        target: _this.klRootEl,\r\n                        message: \"<b>\" + filterName + \"</b>\",\r\n                        div: filterDialog.element,\r\n                        style: style,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function(result) {\r\n                            finishedDialog(result, filterDialog);\r\n                        },\r\n                        closefunc: function (func) {\r\n                            closefunc = func;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            buttons[buttons.length] = button;\r\n            return button;\r\n        }\r\n\r\n        function addGroup(groupArr, filterArr, targetEl) {\r\n            for (let filterKey in filterArr) {\r\n                if (filterArr.hasOwnProperty[filterKey] || !groupArr.includes(filterKey)) {\r\n                    continue;\r\n                }\r\n                if (_this.isEmbed && !filterArr[filterKey].inEmbed) {\r\n                    continue;\r\n                }\r\n                targetEl.appendChild(createButton(filterKey, filterArr));\r\n            }\r\n        }\r\n\r\n        const groupA = [\r\n            'cropExtend',\r\n            'flip',\r\n            'perspective',\r\n            'resize',\r\n            'rotate',\r\n            'transform',\r\n        ];\r\n        const groupB = [\r\n            'brightnessContrast',\r\n            'curves',\r\n            'distort',\r\n            'hueSaturation',\r\n            'invert',\r\n            'tiltShift',\r\n            'toAlpha',\r\n            'blur',\r\n            'unsharpMask',\r\n        ];\r\n        const groupC = [\r\n            'grid',\r\n            'noise',\r\n            'pattern',\r\n            'vanishPoint'\r\n        ];\r\n\r\n        addGroup(groupA, filters, _this.div);\r\n\r\n        _this.div.appendChild(BB.el({className: 'gridHr'}));\r\n        addGroup(groupB, filters, _this.div);\r\n        _this.div.appendChild(BB.el({className: 'gridHr'}));\r\n        addGroup(groupC, filters, _this.div);\r\n\r\n        this.isInit = true;\r\n    }\r\n\r\n    getElement() {\r\n        return this.div;\r\n    }\r\n\r\n    show() {\r\n        if (!this.isInit) {\r\n            this.init();\r\n        }\r\n        this.div.style.display = 'block';\r\n    }\r\n\r\n    hide() {\r\n        this.div.style.display = 'none';\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\n// @ts-ignore\r\nimport loadingImg from 'url:~/src/app/img/ui/loading.gif';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\nasync function upload(canvas, title, description, type: 'png' | 'jpeg', imgurKey: string): Promise<{deletehash: string}> {\r\n    let img = base64ToBlob(canvas.toDataURL(\"image/\" + type));\r\n\r\n    let w = window.open();\r\n    let label = w.document.createElement(\"div\");\r\n    let gif = w.document.createElement(\"img\");\r\n    gif.src = loadingImg;\r\n    label.appendChild(gif);\r\n    BB.css(gif, {\r\n        filter: \"invert(1)\"\r\n    });\r\n    w.document.body.style.backgroundColor = \"#121211\";\r\n    w.document.body.style.backgroundImage = \"linear-gradient(#2b2b2b 0%, #121211 50%)\";\r\n    w.document.body.style.backgroundRepeat = \"no-repeat\";\r\n    let labelText = w.document.createElement(\"div\");\r\n    labelText.style.marginTop = \"10px\";\r\n    label.appendChild(labelText);\r\n    labelText.textContent = LANG('upload-uploading');\r\n\r\n    w.document.body.appendChild(label);\r\n    BB.css(label, {\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        marginTop: \"100px\",\r\n        fontFamily: \"Arial, sans-serif\",\r\n        fontSize: \"20px\",\r\n        textAlign: \"center\",\r\n        transition: \"opacity 0.3s ease-in-out\",\r\n        opacity: '0',\r\n        color: \"#ccc\"\r\n    });\r\n    setTimeout(function () {\r\n        label.style.opacity = '1';\r\n    }, 20);\r\n\r\n    let response;\r\n    try {\r\n        const formData = new FormData();\r\n        formData.append('title', title);\r\n        formData.append('description', description);\r\n        formData.append('image', img);\r\n        response = await fetch('https://api.imgur.com/3/image',  {\r\n            method: 'POST',\r\n            headers: {\r\n                Authorization: 'Client-ID ' + imgurKey,\r\n            },\r\n            body: formData\r\n        });\r\n\r\n    } catch (e) {\r\n        w.close();\r\n        throw new Error(e);\r\n    }\r\n    if (!response.ok) {\r\n        w.close();\r\n        throw new Error();\r\n    }\r\n    let data = (await response.json()).data;\r\n\r\n    w.location.href = (data as any).link.replace(/\\.(jpg|png)/, '');\r\n\r\n    return data;\r\n}\r\n\r\n\r\nexport function imgurUpload(klCanvas: KlCanvas, klRootEl, saveReminder: SaveReminder, imgurKey: string) {\r\n    if (!imgurKey) {\r\n        throw new Error('imgur key missing');\r\n    }\r\n\r\n    let inputTitle = document.createElement(\"input\");\r\n    inputTitle.type = \"text\";\r\n    inputTitle.value = LANG('upload-title-untitled');\r\n    let inputDescription = BB.el({\r\n        tagName: 'textarea',\r\n        custom: {\r\n            rows: 2,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            maxWidth: '100%',\r\n        },\r\n    }) as HTMLTextAreaElement;\r\n\r\n    let labelTitle = document.createElement(\"div\");\r\n    labelTitle.textContent = LANG('upload-name') + \":\";\r\n    let labelDescription = BB.el({\r\n        content: LANG('upload-caption') + ':',\r\n        css: {\r\n            marginTop: '10px',\r\n        }\r\n    });\r\n\r\n    let tos = document.createElement(\"div\");\r\n    tos.innerHTML = `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('upload-tos')}</a> ${LANG('upload-tos-2')}`;\r\n\r\n    const typeRadio = new KL.RadioList({\r\n        name: 'filetype',\r\n        init: 'jpeg',\r\n        items: [\r\n            { label: 'JPG', value: 'jpeg' },\r\n            { label: 'PNG', value: 'png' },\r\n        ],\r\n        ignoreFocus: true,\r\n    });\r\n    BB.css(typeRadio.getElement(), {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    let outDiv = document.createElement(\"div\");\r\n    let infoHint = document.createElement(\"div\");\r\n    infoHint.className = \"info-hint\";\r\n    infoHint.textContent = LANG('upload-link-notice');\r\n    outDiv.append(\r\n        infoHint,\r\n        typeRadio.getElement(),\r\n        labelTitle,\r\n        inputTitle,\r\n        labelDescription,\r\n        inputDescription,\r\n        tos\r\n    );\r\n    KL.popup({\r\n        target: klRootEl,\r\n        message: `<b>${LANG('upload-title')}</b>`,\r\n        type: \"upload\",\r\n        div: outDiv,\r\n        buttons: [LANG('upload-submit'), \"Cancel\"],\r\n        clickOnEnter: LANG('upload-submit'),\r\n        primaries: [LANG('upload-submit')],\r\n        autoFocus: LANG('upload-submit'),\r\n        callback: async function (val) {\r\n            if (val === LANG('upload-submit') || val === \"Yes\" || val === \"Ok\") {\r\n                try {\r\n                    const result = await upload(\r\n                        klCanvas.getCompleteCanvas(1),\r\n                        inputTitle.value,\r\n                        inputDescription.value,\r\n                        typeRadio.getValue() as 'png' | 'jpeg',\r\n                        imgurKey,\r\n                    );\r\n\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"ok\",\r\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/delete/${result.deletehash}</a><br><br>`,\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                    saveReminder.reset();\r\n\r\n                } catch(e) {\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"error\",\r\n                        message: LANG('upload-failed'),\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iGeXe\");","import {BB} from '../../bb/bb';\r\n\r\nlet agPsdLazy;\r\nexport async function loadAgPsd() {\r\n    if (!agPsdLazy) {\r\n        agPsdLazy = await import('ag-psd');\r\n        BB.BbLog.emit({\r\n            type: 'loaded-agpsd',\r\n        });\r\n    }\r\n    return agPsdLazy;\r\n}","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kNYzr\"))).then(() => parcelRequire('2m2jt'));","import {KL} from '../../kl';\r\nimport {BB} from '../../../bb/bb';\r\nimport {KlHistoryInterface} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\nimport {BrowserStorageUi} from './browser-storage-ui';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {IKlProject} from '../../kl.types';\r\n\r\n\r\nconst reminderTimelimitMs = 1000 * 60 * 20; // 20 minutes\r\nconst unsavedActionsLimit = 100; // number of actions user did since last save\r\n\r\n\r\n/**\r\n * remind user of saving, keep user aware of save state\r\n */\r\nexport class SaveReminder {\r\n    private lastSavedActionNumber: number = null;\r\n    private lastSavedAt: number;\r\n\r\n    private lastReminderShownAt: number;\r\n    private unsavedInterval;\r\n    private closeFunc: () => void;\r\n\r\n    showPopup (): void {\r\n        if (!this.projectStore || !this.getProject) {\r\n            throw new Error('projectStore and getProject need to be set');\r\n        }\r\n\r\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\r\n\r\n        const contentEl = BB.el({});\r\n\r\n        contentEl.append(\r\n            BB.el({\r\n                content: LANG(\r\n                    'save-reminder-text',\r\n                    {\r\n                        a: '<strong>' + min,\r\n                        b: '</strong>',\r\n                    }\r\n                ),\r\n                css: {\r\n                    marginBottom: '20px',\r\n                }\r\n            }),\r\n        );\r\n\r\n        const psdWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n            }\r\n        });\r\n        const storageWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n                paddingBottom: '0',\r\n            }\r\n        });\r\n        contentEl.append(psdWrapper, storageWrapper);\r\n\r\n\r\n        const psdBtn = BB.el({\r\n            tagName: 'button',\r\n            className: 'kl-button',\r\n            content: LANG('save-reminder-save-psd'),\r\n            onClick: () => this.onSaveAsPsd(),\r\n        });\r\n        psdWrapper.append(\r\n            psdBtn,\r\n            BB.el({\r\n                content: LANG('save-reminder-psd-layers'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            }),\r\n        );\r\n\r\n\r\n        const storageUi = new BrowserStorageUi(\r\n            this.projectStore,\r\n            this.getProject,\r\n            this,\r\n            document.body as any,\r\n            {\r\n                hideClearButton: true,\r\n                isFocusable: true,\r\n            }\r\n        );\r\n        storageWrapper.append(storageUi.getElement());\r\n\r\n\r\n        KL.popup({\r\n            target: document.body,\r\n            message: `<b>${LANG('save-reminder-title')}</b>`,\r\n            div: contentEl,\r\n            ignoreBackground: true,\r\n            callback: () => {\r\n                storageUi.destroy();\r\n                BB.destroyEl(psdBtn);\r\n                this.closeFunc = null;\r\n                this.lastReminderShownAt = performance.now();\r\n            },\r\n            closefunc: (f) => {\r\n                this.closeFunc = f;\r\n            }\r\n        });\r\n        setTimeout(() => {\r\n            psdBtn.focus();\r\n        }, 40);\r\n    }\r\n\r\n    constructor (\r\n        private history: KlHistoryInterface,\r\n        private showReminder: boolean,\r\n        private changeTitle: boolean,\r\n        private onSaveAsPsd: () => void,\r\n        private isDrawing: () => boolean,\r\n        private projectStore: ProjectStore | null, // needed if showReminder\r\n        private getProject: (() => IKlProject) | null, // needed if showReminder\r\n        private title: string = 'Klecks',\r\n    ) { }\r\n\r\n    init (): void {\r\n        if (this.lastSavedActionNumber !== null) { // already initialized\r\n            return;\r\n        }\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n\r\n        if (this.showReminder) {\r\n            setInterval(() => {\r\n                if (document.visibilityState !== 'visible') {\r\n                    return;\r\n                }\r\n\r\n                let unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber);\r\n\r\n                if (\r\n                    KL.dialogCounter.get() === 0 &&\r\n                    !this.isDrawing() &&\r\n                    this.lastReminderShownAt + reminderTimelimitMs < performance.now() &&\r\n                    unsavedActions >= unsavedActionsLimit\r\n                ) {\r\n                    this.showPopup();\r\n                }\r\n            }, 1000 * 5);\r\n        }\r\n\r\n        // confirmation dialog when closing tab\r\n        function onBeforeUnload(e) {\r\n            e.preventDefault();\r\n            e.returnValue = '';\r\n        }\r\n\r\n        this.history.addListener(() => {\r\n            let actionNumber = this.history.getActionNumber();\r\n            if (this.lastSavedActionNumber !== actionNumber) {\r\n                BB.setEventListener(window, 'onbeforeunload', onBeforeUnload);\r\n            } else {\r\n                BB.setEventListener(window, 'onbeforeunload', null);\r\n            }\r\n        });\r\n\r\n        if (this.changeTitle) {\r\n            document.addEventListener(\"visibilitychange\", () => {\r\n                if (document.visibilityState === 'visible') {\r\n                    document.title = this.title;\r\n                    clearInterval(this.unsavedInterval);\r\n                } else {\r\n                    let actionNumber = this.history.getActionNumber();\r\n                    if (this.lastSavedActionNumber !== actionNumber) {\r\n                        document.title = LANG('unsaved') + ' - ' + this.title;\r\n                        let state = 0;\r\n                        this.unsavedInterval = setInterval(() => {\r\n                            state = (state + 1) % 2;\r\n                            if (state === 1) {\r\n                                document.title = LANG('unsaved') + ' · ' + this.title;\r\n                            } else {\r\n                                document.title = LANG('unsaved') + ' - ' + this.title;\r\n                            }\r\n                        }, 1000 * 60 * 3);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    reset (): void {\r\n        if (this.lastSavedActionNumber === null) { // not initialized\r\n            return;\r\n        }\r\n\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n        BB.setEventListener(window, 'onbeforeunload', null);\r\n\r\n        if (this.closeFunc) {\r\n            this.closeFunc();\r\n        }\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {KL} from '../kl';\r\nimport {saveAs} from 'file-saver';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport class SaveToComputer {\r\n\r\n    constructor(\r\n        private saveReminder,\r\n        private klRootEl,\r\n        private getExportType,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private filenameBase: string,\r\n    ) {}\r\n\r\n    save(format?: 'psd' | 'layers' | 'png') {\r\n        const _this = this;\r\n\r\n        _this.saveReminder.reset();\r\n\r\n\r\n        function saveImage(canvas, filename, mimeType) {\r\n            let parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n            //assume base64 encoding\r\n            let binStr = atob(parts[3]);\r\n            //convert to binary in ArrayBuffer\r\n            let buf = new ArrayBuffer(binStr.length);\r\n            let view = new Uint8Array(buf);\r\n            for (let i = 0; i < view.length; i++) {\r\n                view[i] = binStr.charCodeAt(i);\r\n            }\r\n            let blob = new Blob([view], {'type': parts[1]});\r\n            saveAs(blob, filename);\r\n        }\r\n\r\n        if (!format) {\r\n            format = _this.getExportType();\r\n        }\r\n\r\n        if (format === 'png') {\r\n            let extension = 'png';\r\n            let mimeType = 'image/png';\r\n            let filename = BB.getDate() + this.filenameBase + \".\" + extension;\r\n            let fullCanvas = _this.getKlCanvas().getCompleteCanvas(1);\r\n\r\n            /*fullCanvas.toBlob(function(blob) {\r\n                if (blob === null) {\r\n                    throw 'save image error, blob is null';\r\n                }\r\n                saveAs(blob, filename);\r\n            }, mimetype);*/\r\n\r\n            //using old code, because saving somehow doesn't work for ipad before ios 13\r\n            //and it doesn't even throw an exception\r\n            try {\r\n                saveImage(fullCanvas, filename, mimeType);\r\n            } catch (error) { //fallback for old browsers\r\n                let im = new Image();\r\n                im.width = _this.getKlCanvas().getWidth();\r\n                im.height = _this.getKlCanvas().getHeight();\r\n                im.src = fullCanvas.toDataURL(mimeType);\r\n                KL.exportDialog(_this.klRootEl, im);\r\n            }\r\n        } else if (format === 'layers') {\r\n            let extension = 'png';\r\n            let mimeType = 'image/png';\r\n            let fileBase = BB.getDate() + this.filenameBase;\r\n            let layerArr = _this.getKlCanvas().getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                let item = layerArr[i];\r\n                let fnameArr = [\r\n                    fileBase,\r\n                    '_',\r\n                    ('' + (i + 1)).padStart(2, '0'),\r\n                    '_',\r\n                    item.name,\r\n                    '.',\r\n                    extension\r\n                ];\r\n                saveImage(item.canvas, fnameArr.join(''), mimeType);\r\n            }\r\n        } else if (format === 'psd') {\r\n\r\n            let layerArr = _this.getKlCanvas().getLayersFast();\r\n\r\n            let psdConfig = {\r\n                width: _this.getKlCanvas().getWidth(),\r\n                height: _this.getKlCanvas().getHeight(),\r\n                children: [],\r\n                canvas: _this.getKlCanvas().getCompleteCanvas(1)\r\n            };\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                let item = layerArr[i];\r\n                psdConfig.children.push({\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    canvas: item.canvas,\r\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n                    left: 0,\r\n                    top: 0\r\n                });\r\n            }\r\n\r\n            KL.loadAgPsd().then((agPsdLazy) => {\r\n                let buffer = agPsdLazy.writePsdBuffer(psdConfig);\r\n                let blob = new Blob([buffer], { type: 'application/octet-stream' });\r\n                saveAs(blob, BB.getDate() + this.filenameBase + '.psd');\r\n            }).catch(() => {\r\n                alert('Error: failed to load PSD library');\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n}","/*\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n*\n* By Eli Grey, http://eligrey.com\n*\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n* source  : http://purl.eligrey.com/github/FileSaver.js\n*/\n\n// The one and only way of getting global scope in all environments\n// https://stackoverflow.com/q/3277182/1008999\nvar _global = typeof window === 'object' && window.window === window\n  ? window : typeof self === 'object' && self.self === self\n  ? self : typeof global === 'object' && global.global === global\n  ? global\n  : this\n\nfunction bom (blob, opts) {\n  if (typeof opts === 'undefined') opts = { autoBom: false }\n  else if (typeof opts !== 'object') {\n    console.warn('Deprecated: Expected third argument to be a object')\n    opts = { autoBom: !opts }\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\n  }\n  return blob\n}\n\nfunction download (url, name, opts) {\n  var xhr = new XMLHttpRequest()\n  xhr.open('GET', url)\n  xhr.responseType = 'blob'\n  xhr.onload = function () {\n    saveAs(xhr.response, name, opts)\n  }\n  xhr.onerror = function () {\n    console.error('could not download file')\n  }\n  xhr.send()\n}\n\nfunction corsEnabled (url) {\n  var xhr = new XMLHttpRequest()\n  // use sync to avoid popup blocker\n  xhr.open('HEAD', url, false)\n  try {\n    xhr.send()\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click (node) {\n  try {\n    node.dispatchEvent(new MouseEvent('click'))\n  } catch (e) {\n    var evt = document.createEvent('MouseEvents')\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\n                          20, false, false, false, false, 0, null)\n    node.dispatchEvent(evt)\n  }\n}\n\n// Detect WebView inside a native macOS app by ruling out all browsers\n// We just need to check for 'Safari' because all other browsers (besides Firefox) include that too\n// https://www.whatismybrowser.com/guides/the-latest-user-agent/macos\nvar isMacOSWebView = _global.navigator && /Macintosh/.test(navigator.userAgent) && /AppleWebKit/.test(navigator.userAgent) && !/Safari/.test(navigator.userAgent)\n\nvar saveAs = _global.saveAs || (\n  // probably in some web worker\n  (typeof window !== 'object' || window !== _global)\n    ? function saveAs () { /* noop */ }\n\n  // Use download attribute first if possible (#193 Lumia mobile) unless this is a macOS WebView\n  : ('download' in HTMLAnchorElement.prototype && !isMacOSWebView)\n  ? function saveAs (blob, name, opts) {\n    var URL = _global.URL || _global.webkitURL\n    var a = document.createElement('a')\n    name = name || blob.name || 'download'\n\n    a.download = name\n    a.rel = 'noopener' // tabnabbing\n\n    // TODO: detect chrome extensions & packaged apps\n    // a.target = '_blank'\n\n    if (typeof blob === 'string') {\n      // Support regular links\n      a.href = blob\n      if (a.origin !== location.origin) {\n        corsEnabled(a.href)\n          ? download(blob, name, opts)\n          : click(a, a.target = '_blank')\n      } else {\n        click(a)\n      }\n    } else {\n      // Support blobs\n      a.href = URL.createObjectURL(blob)\n      setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\n      setTimeout(function () { click(a) }, 0)\n    }\n  }\n\n  // Use msSaveOrOpenBlob as a second approach\n  : 'msSaveOrOpenBlob' in navigator\n  ? function saveAs (blob, name, opts) {\n    name = name || blob.name || 'download'\n\n    if (typeof blob === 'string') {\n      if (corsEnabled(blob)) {\n        download(blob, name, opts)\n      } else {\n        var a = document.createElement('a')\n        a.href = blob\n        a.target = '_blank'\n        setTimeout(function () { click(a) })\n      }\n    } else {\n      navigator.msSaveOrOpenBlob(bom(blob, opts), name)\n    }\n  }\n\n  // Fallback to using FileReader and a popup\n  : function saveAs (blob, name, opts, popup) {\n    // Open a popup immediately do go around popup blocker\n    // Mostly only available on user interaction and the fileReader is async so...\n    popup = popup || open('', '_blank')\n    if (popup) {\n      popup.document.title =\n      popup.document.body.innerText = 'downloading...'\n    }\n\n    if (typeof blob === 'string') return download(blob, name, opts)\n\n    var force = blob.type === 'application/octet-stream'\n    var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\n    var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\n\n    if ((isChromeIOS || (force && isSafari) || isMacOSWebView) && typeof FileReader !== 'undefined') {\n      // Safari doesn't allow downloading of blob URLs\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        var url = reader.result\n        url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n        if (popup) popup.location.href = url\n        else location = url\n        popup = null // reverse-tabnabbing #460\n      }\n      reader.readAsDataURL(blob)\n    } else {\n      var URL = _global.URL || _global.webkitURL\n      var url = URL.createObjectURL(blob)\n      if (popup) popup.location = url\n      else location.href = url\n      popup = null // reverse-tabnabbing #460\n      setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\n    }\n  }\n)\n\n_global.saveAs = saveAs.saveAs = saveAs\n\nif (typeof module !== 'undefined') {\n  module.exports = saveAs;\n}\n","import {KL} from '../kl';\r\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\r\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\r\nimport {IFilterApply, IInitState} from '../kl.types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport class UndoRedoCatchup {\r\n\r\n    private doIgnore = false;\r\n\r\n    /**\r\n     * Prevent multiple undo / redo getting triggered at once.\r\n     * Might be confusing if main thread is choking.\r\n     */\r\n    private ignoreTest (): boolean {\r\n        if (this.doIgnore) {\r\n            return false;\r\n        }\r\n        this.doIgnore = true;\r\n        setTimeout(() => {\r\n            this.doIgnore = false;\r\n        }, 0);\r\n        return true;\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        private brushUiObj,\r\n        private layerPreview,\r\n        private layerManager,\r\n        private handUi,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private getInitState: () => IInitState,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx,\r\n        private setCurrentLayerCtx,\r\n        private getCurrentBrush,\r\n    ) { }\r\n\r\n    undo (): boolean {\r\n        if (!this.ignoreTest()) {\r\n            return false;\r\n        }\r\n\r\n        if (!klHistory.canUndo()) { // || workspace.isPainting()) {\r\n            return false;\r\n        }\r\n        const actions: IHistoryEntry[] = klHistory.undo();\r\n        const klCanvas = this.getKlCanvas();\r\n        klHistory.pause(true);\r\n        const initState: IInitState = this.getInitState();\r\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\r\n        klCanvas.copy(initState.canvas);\r\n        let layerIndex = initState.focus;\r\n        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\r\n        const brushes: any = {};\r\n        for (let b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\r\n        for (let i = 0; i < actions.length; i++) {\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    const b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = klCanvas[actions[i].action].apply(klCanvas, p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: this.getCurrentLayerCtx(),\r\n                        klCanvas,\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    this.setCurrentLayerCtx(klCanvas.getLayerContext(actions[i].params[0]));\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(this.getCurrentLayerCtx());\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = klCanvas.addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            klCanvas.renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(i);\r\n        }\r\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        this.layerManager.update(layerIndex);\r\n        this.layerPreview.setLayer(klCanvas.getLayer(layerIndex));\r\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n\r\n        klHistory.pause(false);\r\n        return true;\r\n    }\r\n\r\n    redo (): boolean {\r\n        if (!this.ignoreTest()) {\r\n            return false;\r\n        }\r\n\r\n        if (!klHistory.canRedo()) {\r\n            return false;\r\n        }\r\n        const actions = klHistory.redo();\r\n        const klCanvas = this.getKlCanvas();\r\n        klHistory.pause(true);\r\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\r\n        let layerIndex;\r\n        const brushes: any = {};\r\n        for (let b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(this.brushUiObj.sketchyBrush.getSeed());\r\n        for (let i = 0; i < actions.length; i++) {\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    const b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = klCanvas[actions[i].action].apply(klCanvas, p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: this.getCurrentLayerCtx(),\r\n                        klCanvas,\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    this.setCurrentLayerCtx(klCanvas.getLayerContext(actions[i].params[0]));\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(this.getCurrentLayerCtx());\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = klCanvas.addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            klCanvas.renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(i);\r\n        }\r\n\r\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        const currentLayerIndex = klCanvas.getLayerIndex(this.getCurrentLayerCtx().canvas);\r\n        this.layerManager.update(currentLayerIndex);\r\n        this.layerPreview.setLayer(klCanvas.getLayer(currentLayerIndex));\r\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n        klHistory.pause(false);\r\n\r\n        return true;\r\n    }\r\n\r\n    catchup (logParam: IHistoryBroadcast | null): void {\r\n        // const start = performance.now();\r\n        //play catch up (the version that is a few steps behind)\r\n        if (logParam && logParam.bufferUpdate) {\r\n            const initState: IInitState = this.getInitState();\r\n\r\n            const brushes = initState.brushes;\r\n            const actions = [logParam.bufferUpdate];\r\n            let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\r\n            const klCanvas = initState.canvas;\r\n            let layerIndex = initState.focus;\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    let b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = klCanvas[actions[i].action].apply(klCanvas, p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        localCurrentLayerCtx = klCanvas.getLayerContext(layerIndex);\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(localCurrentLayerCtx);\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: localCurrentLayerCtx,\r\n                        klCanvas,\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    localCurrentLayerCtx = klCanvas.getLayerContext(actions[i].params[0]);\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(localCurrentLayerCtx);\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = klCanvas.addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            klCanvas.renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        localCurrentLayerCtx = klCanvas.getLayerContext(layerIndex);\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(localCurrentLayerCtx);\r\n                            }\r\n                        }\r\n                    }\r\n                    localCurrentLayerCtx.drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(0);\r\n            initState.focus = layerIndex;\r\n        }\r\n        // console.log('catchup', performance.now() - start);\r\n    }\r\n\r\n\r\n}","import {IRGB, ISliderConfig} from '../kl.types';\r\n\r\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\r\n    { type: 'opacity'; value: number } |\r\n    { type: 'size'; value: number } |\r\n    { type: 'sliderConfig'; value: ISliderConfig };\r\n\r\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\r\n\r\n/**\r\n * Central place to update brush settings, and to subscribe to changes.\r\n */\r\nexport class BrushSettingService {\r\n\r\n    private static instance: BrushSettingService;\r\n    subscriberArr: TBrushSettingSubscriber[] = [];\r\n\r\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (this.subscriberArr[i] === skipSubscriber) {\r\n                continue;\r\n            }\r\n            this.subscriberArr[i](obj);\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        private onSetColor: (rgb: IRGB) => void,\r\n        private onSetSize: (size: number) => void,\r\n        private onSetOpacity: (opacity: number) => void,\r\n        private onGetColor: () => IRGB,\r\n        private onGetSize: () => number,\r\n        private onGetOpacity: () => number,\r\n        private onGetSliderConfig: () => ISliderConfig,\r\n    ) {\r\n        if (BrushSettingService.instance) {\r\n            throw new Error('BrushSettingService already instantiated');\r\n        }\r\n        BrushSettingService.instance = this;\r\n    }\r\n\r\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'color',\r\n                value: color\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'size',\r\n                value: size\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'opacity',\r\n                value: opacity\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.emit(\r\n            {\r\n                type: 'sliderConfig',\r\n                value: sliderConfig\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    /**\r\n     * set current brush color\r\n     * @param color\r\n     * @param skipSubscriber\r\n     */\r\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetColor(color);\r\n        this.emitColor(color, skipSubscriber);\r\n    }\r\n\r\n    /**\r\n     * set current brush size\r\n     * @param size\r\n     * @param skipSubscriber\r\n     */\r\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetSize(size);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * set current opacity\r\n     * @param opacity\r\n     * @param skipSubscriber\r\n     */\r\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetOpacity(opacity);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * get current brush color\r\n     */\r\n    getColor (): IRGB {\r\n        return this.onGetColor();\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.onGetSize();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.onGetOpacity();\r\n    }\r\n\r\n    getSliderConfig (): ISliderConfig {\r\n        return this.onGetSliderConfig();\r\n    }\r\n\r\n    /**\r\n     * subscribe to changes\r\n     * @param func\r\n     */\r\n    subscribe (func: TBrushSettingSubscriber): void {\r\n        if (this.subscriberArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.subscriberArr.push(func);\r\n    }\r\n\r\n    unsubscribe (func: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (func === this.subscriberArr[i]) {\r\n                this.subscriberArr.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\r\nimport {KL} from '../../kl';\r\nimport {languages} from '../../../../languages/languages';\r\nimport {Popup} from '../modals/popup';\r\n// @ts-ignore\r\nimport bitbofLogoImg from 'url:~/src/app/img/bitbof-logo.svg';\r\n// @ts-ignore\r\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\nimport {LocalStorage} from '../../../bb/base/local-storage';\r\n\r\nexport class SettingsTab {\r\n\r\n    private el: HTMLElement;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        onLeftRight: () => void,\r\n        customAbout?: HTMLElement,\r\n    ) {\r\n\r\n        // ---- language ----\r\n        const language = languageStrings.getLanguage();\r\n\r\n        this.el = BB.el({\r\n            content: `\r\n${LANG('settings-language')}: ${language.name} (${language.code})\r\n            `,\r\n            css: {\r\n                margin: '10px',\r\n            }\r\n        });\r\n\r\n        const preferredLanguageRow = BB.el({\r\n            content: LANG('settings-preferred-language') + ':<br>',\r\n            css: {\r\n                marginTop: '10px',\r\n            }\r\n        });\r\n        const options: [string, string][] = [\r\n            ['auto', LANG('auto')] as [string, string]\r\n        ].concat(\r\n            languages.map(item => {\r\n                return [item.code, item.name + ` (${item.code})`];\r\n            })\r\n        );\r\n        const languageSelect = new KL.Select({\r\n            initValue: LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto',\r\n            optionArr: options,\r\n            onChange: (val) => {\r\n                if (val === 'auto') {\r\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\r\n                } else {\r\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\r\n                }\r\n                languageHint.style.display = 'block';\r\n            },\r\n        });\r\n        const languageHint = BB.el({\r\n            content: LANG('settings-language-reload'),\r\n            css: {\r\n                display: 'none',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n\r\n        preferredLanguageRow.append(\r\n            languageSelect.getElement(),\r\n            languageHint,\r\n        );\r\n\r\n        this.el.append(preferredLanguageRow);\r\n\r\n        // ---- flip ui ----\r\n        BB.el({\r\n            tagName: 'button',\r\n            parent: this.el,\r\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\r\n            onClick: () => onLeftRight(),\r\n            css: {\r\n                marginTop: '20px',\r\n            },\r\n            custom: {\r\n                tabIndex: '-1',\r\n            }\r\n        });\r\n\r\n\r\n        // ---- about ----\r\n        this.el.append(BB.el({className: 'gridHr', css: {margin: '10px 0'}}));\r\n\r\n        function makeLicenses() {\r\n            return BB.el({\r\n                tagName: 'a',\r\n                content: LANG('licenses'),\r\n                onClick: () => {\r\n                    import('./licenses').then(result => {\r\n                        new Popup({\r\n                            title: BB.el({\r\n                                content: LANG('licenses'),\r\n                            }),\r\n                            content: BB.el({\r\n                                content: BB.el({\r\n                                    content: result.licenses.replace(/\\n/g, '<br>'),\r\n                                    css: {\r\n                                        padding: '20px',\r\n                                    }\r\n                                }),\r\n                                css: {\r\n                                    height: '100%',\r\n                                    overflowY: 'scroll',\r\n                                }\r\n                            }),\r\n                            width: 800,\r\n                            isMaxHeight: true,\r\n                        });\r\n                    });\r\n                },\r\n            });\r\n        }\r\n\r\n        if (customAbout) {\r\n            this.el.append(customAbout);\r\n            if (!customAbout.innerHTML) {\r\n                const minimalAbout = BB.el({\r\n                    parent: customAbout,\r\n                    css: {\r\n                       textAlign: 'center',\r\n                   }\r\n                });\r\n                minimalAbout.append(\r\n                    BB.el({\r\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a> © 2022<br>`,\r\n                    }),\r\n                    makeLicenses(),\r\n                );\r\n            }\r\n        } else {\r\n            const versionEl = BB.el({\r\n                parent: this.el,\r\n                css: {\r\n                    textAlign: 'center',\r\n                },\r\n                content: `\r\n<img alt=\"Klecks\" height=\"25\" src=\"${klecksLogoImg}\"><br>\r\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a> © 2022<br>`\r\n            });\r\n\r\n            versionEl.append(\r\n                makeLicenses(),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('donate'),\r\n                    custom: {\r\n                        href: 'https://kleki.com/donate/',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('source-code'),\r\n                    custom: {\r\n                        href: 'https://klecks.org',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n            );\r\n\r\n\r\n        }\r\n\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== LS_LANGUAGE_KEY) {\r\n                return;\r\n            }\r\n            languageSelect.setValue(\r\n                LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'\r\n            );\r\n        });\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kSWIa\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"4FMUg\");","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"79hnx\"))).then(() => parcelRequire('jNQF2'));","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport caretImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\nimport {LANG} from '../../../language/language';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n\r\n/**\r\n * Scroll buttons at the top and bottom of toolspace\r\n * Show up when window is very small.\r\n * Allow user to scroll up and down toolspace.\r\n */\r\nexport class ToolspaceScroller {\r\n\r\n    private toolspace: HTMLElement;\r\n    private upBtn: HTMLElement;\r\n    private downBtn: HTMLElement;\r\n    private downInterval: any;\r\n    private upInterval: any;\r\n\r\n    private update(): void {\r\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\r\n            if (!this.upInterval) {\r\n                this.upBtn.style.display = this.toolspace.scrollTop === 0 ? 'none' : 'block';\r\n            }\r\n            if (!this.downInterval) {\r\n                this.downBtn.style.display = (\r\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\r\n                        'none' : 'block'\r\n                );\r\n            }\r\n        } else {\r\n            this.upBtn.style.display = 'none';\r\n            this.downBtn.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n    constructor(p: {toolspace: HTMLElement, uiState: 'left' | 'right'}) {\r\n        this.toolspace = p.toolspace;\r\n        this.upBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                top: '0',\r\n                transform: 'rotate(180deg)',\r\n            }\r\n        });\r\n        this.downBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                bottom: '0',\r\n            }\r\n        });\r\n        this.updateUiState(p.uiState);\r\n\r\n        const upListener = new BB.PointerListener({\r\n            target: this.upBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.upInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, -13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.upInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.upInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n        const downListener = new BB.PointerListener({\r\n            target: this.downBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.downInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, 13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.downInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.downInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            }\r\n        });\r\n\r\n        const wheelListener = (e: WheelEvent) => {\r\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\r\n            this.update();\r\n        };\r\n        this.upBtn.addEventListener('wheel', wheelListener);\r\n        this.downBtn.addEventListener('wheel', wheelListener);\r\n\r\n        this.update();\r\n\r\n        const observer = new MutationObserver(() => this.update());\r\n        observer.observe(\r\n            this.toolspace,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n        window.addEventListener('resize', () => this.update());\r\n\r\n        // hide if in dialog because that can have its own scrollbar\r\n        dialogCounter.subscribe((v) => {\r\n            // ignores the 0.5 by tool dropdown\r\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\r\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\r\n        });\r\n    }\r\n\r\n    updateUiState (uiState: 'left' | 'right'): void {\r\n        BB.css(this.upBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n        BB.css(this.downBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {Options} from '../base-components/options';\r\n\r\n\r\ninterface IGradientUiSettings {\r\n    opacity: number;\r\n    type: 'linear' | 'linear-mirror' | 'radial';\r\n    doLockAlpha: boolean;\r\n    doSnap: boolean;\r\n    isReversed: boolean;\r\n    isEraser: boolean;\r\n}\r\n\r\n/**\r\n * Gradient Tool tab contents\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport class GradientUi {\r\n\r\n    private rootEl: HTMLElement;\r\n    private colorDiv: HTMLElement;\r\n    private colorSlider: any; // todo type\r\n    private isVisible: boolean;\r\n    private iconArr: HTMLElement[];\r\n\r\n    private settings: IGradientUiSettings = {\r\n        opacity: 1,\r\n        type: 'linear',\r\n        doLockAlpha: false,\r\n        doSnap: false,\r\n        isReversed: false,\r\n        isEraser: false,\r\n    };\r\n\r\n    private updateIcons(): void {\r\n        const col1 = this.settings.isReversed ? '#0000' : '#000';\r\n        const col2 = this.settings.isReversed ? '#000' : '#0000';\r\n        this.iconArr[0].style.background = `linear-gradient(${col1}, ${col2})`;\r\n        this.iconArr[1].style.background = `linear-gradient(${col2}, ${col1}, ${col2})`;\r\n        this.iconArr[2].style.background = `radial-gradient(${col1}, ${col2})`;\r\n    }\r\n\r\n    // ----- public -------\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: any; // KlColorSlider - when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.colorSlider = p.colorSlider;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px'\r\n            }\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n\r\n        this.iconArr = [];\r\n        {\r\n            const size = 33;\r\n            [0, 1, 2].forEach(item => {\r\n                const el = BB.el({\r\n                    css: {\r\n                        width: size + 'px',\r\n                        height: size + 'px',\r\n                        borderRadius: '3px',\r\n                        margin: '1px',\r\n                    }\r\n                });\r\n                this.iconArr.push(el);\r\n            });\r\n        }\r\n        this.updateIcons();\r\n\r\n        const typeOptions = new Options({\r\n            optionArr: [\r\n                {\r\n                    id: 'linear',\r\n                    label: this.iconArr[0],\r\n                    title: LANG('gradient-linear'),\r\n                },\r\n                {\r\n                    id: 'linear-mirror',\r\n                    label: this.iconArr[1],\r\n                    title: LANG('gradient-linear-mirror'),\r\n                },\r\n                {\r\n                    id: 'radial',\r\n                    label: this.iconArr[2],\r\n                    title: LANG('gradient-radial'),\r\n                }\r\n            ],\r\n            initId: 'linear',\r\n            onChange: (id) => {\r\n                this.settings.type = id;\r\n            },\r\n        });\r\n        this.rootEl.append(typeOptions.getElement());\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: this.settings.opacity,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: (val) => {\r\n                this.settings.opacity = val;\r\n            }\r\n        });\r\n        BB.css(opacitySlider.getElement(), {\r\n            marginTop: '10px'\r\n        });\r\n        this.rootEl.append(opacitySlider.getElement());\r\n\r\n\r\n\r\n        const row1 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px'\r\n            }\r\n        });\r\n\r\n        const reverseToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('reverse'),\r\n            callback: (b) => {\r\n                this.settings.isReversed = b;\r\n                this.updateIcons();\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            }\r\n        });\r\n\r\n        const doSnapToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('angle-snap'),\r\n            title: LANG('angle-snap-title'),\r\n            callback: (b) => {\r\n                this.settings.doSnap = b;\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            }\r\n        });\r\n\r\n        row1.append(\r\n            reverseToggle.getElement(),\r\n            doSnapToggle.getElement(),\r\n        );\r\n\r\n\r\n        const row2 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px'\r\n            }\r\n        });\r\n\r\n        const eraserToggle = new Checkbox({\r\n            init: this.settings.isEraser,\r\n            label: LANG('eraser'),\r\n            callback: (b) => {\r\n                this.settings.isEraser = b;\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            }\r\n        });\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('lock-alpha'),\r\n            title: LANG('lock-alpha-title'),\r\n            callback: (b) => {\r\n                this.settings.doLockAlpha = b;\r\n            },\r\n            doHighlight: true,\r\n            css: {\r\n                width: '50%',\r\n            }\r\n        });\r\n\r\n        row2.append(\r\n            eraserToggle.getElement(),\r\n            lockAlphaToggle.getElement(),\r\n        );\r\n\r\n\r\n    }\r\n\r\n    getElement(): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible(isVisible: boolean): void {\r\n        this.isVisible = !!isVisible;\r\n        this.rootEl.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            this.colorDiv.appendChild(this.colorSlider.getElement());\r\n            this.colorDiv.appendChild(this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n\r\n    getSettings(): IGradientUiSettings {\r\n        return BB.copyObj(this.settings);\r\n    }\r\n\r\n}","/**\r\n * Topmost row of buttons in toolspace\r\n *\r\n * p = { // button click callbacks\r\n *     onSubmit: function(),\r\n *     onLeftRight: function(),\r\n *     onHelp: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nimport {BB} from \"../bb/bb\";\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\n// @ts-ignore\r\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\r\nimport {LANG} from '../language/language';\r\n\r\nexport class ToolspaceTopRow {\r\n    el: HTMLDivElement;\r\n\r\n    constructor(p: {onSubmit: () => void, onLeftRight: () => void, onHelp: () => void}) {\r\n        let div = document.createElement('div');\r\n        this.el = div;\r\n        BB.css(div, {\r\n            height: '36px',\r\n            //background: '#f00',\r\n            display: 'flex',\r\n            backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n        });\r\n\r\n        function createButton(p) {\r\n            let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n            let result = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\r\n                }\r\n            });\r\n            if (p.content) {\r\n                result.appendChild(p.content);\r\n            } else {\r\n                let im = BB.el({\r\n                    css: {\r\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        backgroundPosition: 'center',\r\n                        backgroundSize: p.contain ? 'contain' : '',\r\n                        //filter: 'grayscale(1)',\r\n                        height: '100%'\r\n                    }\r\n                });\r\n                im.style.pointerEvents = 'none';\r\n                result.appendChild(im);\r\n            }\r\n            (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: result,\r\n                onEnterLeave: function(isOver) {\r\n                    result.classList.toggle('toolspace-row-button-hover', isOver);\r\n                }\r\n            });\r\n            return result;\r\n        }\r\n\r\n        let submitButton = createButton({\r\n            onClick: p.onSubmit,\r\n            title: LANG('submit-title'),\r\n            content: BB.el({\r\n                content: LANG('submit'),\r\n                className: 'toolspace-row-button__submit',\r\n                css: {\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    width: '100%',\r\n                    height: '100%'\r\n                }\r\n            }),\r\n            contain: true\r\n        });\r\n        submitButton.style.width = '45px';\r\n\r\n        let helpButton = createButton({\r\n            onClick: p.onHelp,\r\n            title: LANG('help'),\r\n            image: helpImg,\r\n            contain: true\r\n        });\r\n\r\n        let leftRightButton = createButton({\r\n            onClick: p.onLeftRight,\r\n            title: LANG('switch-ui-left-right'),\r\n            image: uiSwapImg,\r\n            contain: true\r\n        });\r\n\r\n        div.appendChild(submitButton);\r\n        div.appendChild(leftRightButton);\r\n        div.appendChild(helpButton);\r\n    }\r\n\r\n    getElement() {\r\n        return this.el;\r\n    }\r\n}\r\n","import {filterLib, filterLibStatus} from './filters';\r\nimport {filterBrightnessContrast} from './filter-brightness-contrast';\r\nimport {filterCropExtend} from './filter-crop-extend';\r\nimport {filterCurves} from './filter-curves';\r\nimport {filterFlip} from './filter-flip';\r\nimport {filterHueSaturation} from './filter-hue-saturation';\r\nimport {filterInvert} from './filter-invert';\r\nimport {filterPerspective} from './filter-perspective';\r\nimport {filterResize} from './filter-resize';\r\nimport {filterRotate} from './filter-rotate';\r\nimport {filterTiltShift} from './filter-tilt-shift';\r\nimport {filterTransform} from './filter-transform';\r\nimport {filterBlur} from './filter-blur';\r\nimport {filterUnsharpMask} from './filter-unsharp-mask';\r\nimport {filterToAlpha} from './filter-to-alpha';\r\nimport {filterGrid} from './filter-grid';\r\nimport {filterNoise} from './filter-noise';\r\nimport {filterPattern} from './filter-pattern';\r\nimport {filterDistort} from './filter-distort';\r\nimport {filterVanishPoint} from \"./filter-vanish-point\";\r\n\r\nlet embed: boolean;\r\nfunction importFilter(libObj, moduleObj): void {\r\n    if (moduleObj.getDialog) {\r\n        libObj.getDialog = moduleObj.getDialog;\r\n    }\r\n    libObj.apply = moduleObj.apply;\r\n}\r\n\r\n\r\nexport function importFilters(isEmbed?: boolean) {\r\n    if (filterLibStatus.isLoaded) {\r\n        return;\r\n    }\r\n    embed = isEmbed\r\n\r\n    importFilter(filterLib.brightnessContrast, filterBrightnessContrast);\r\n    importFilter(filterLib.cropExtend, filterCropExtend);\r\n    importFilter(filterLib.curves, filterCurves);\r\n    importFilter(filterLib.flip, filterFlip);\r\n    importFilter(filterLib.hueSaturation, filterHueSaturation);\r\n    importFilter(filterLib.invert, filterInvert);\r\n    importFilter(filterLib.perspective, filterPerspective);\r\n    importFilter(filterLib.resize, filterResize);\r\n    importFilter(filterLib.rotate, filterRotate);\r\n    importFilter(filterLib.tiltShift, filterTiltShift);\r\n    importFilter(filterLib.transform, filterTransform);\r\n    importFilter(filterLib.blur, filterBlur);\r\n    importFilter(filterLib.unsharpMask, filterUnsharpMask);\r\n    importFilter(filterLib.toAlpha, filterToAlpha);\r\n    importFilter(filterLib.grid, filterGrid);\r\n    importFilter(filterLib.noise, filterNoise);\r\n    importFilter(filterLib.pattern, filterPattern);\r\n    importFilter(filterLib.distort, filterDistort);\r\n    importFilter(filterLib.vanishPoint, filterVanishPoint);\r\n\r\n    filterLibStatus.isLoaded = true;\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterBrightnessContrast = {\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n\r\n        function finishInit() {\r\n\r\n            let brightness = 0, contrast = 0;\r\n            div.innerHTML = LANG('filter-bright-contrast-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let brightnessSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-brightness'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (brightness + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brightness = val / 50 - 1;\r\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            let contrastSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-contrast'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (contrast + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    contrast = val / 50 - 1;\r\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            brightnessSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(brightnessSlider.getElement());\r\n            div.appendChild(contrastSlider.getElement());\r\n\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                brightnessSlider.destroy();\r\n                contrastSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    brightness: brightness,\r\n                    contrast: contrast\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let brightness = params.input.brightness;\r\n        let contrast = params.input.contrast;\r\n        let history = params.history;\r\n        if (!context || brightness === null || contrast === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"brightnessContrast\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n\r\n        return true;\r\n    }\r\n}","\r\nexport const eventResMs = 60;","import {fx} from '../../../script-vendor/glfx';\r\n\r\nlet fxCanvas = null\r\ntry {\r\n    fxCanvas = fx.canvas();\r\n} catch (e) {\r\n}\r\n\r\nexport function getSharedFx() {\r\n    if (!fxCanvas || fxCanvas._.gl.isContextLost()) {\r\n        try {\r\n            fxCanvas = fx.canvas();\r\n        } catch (e) {\r\n        }\r\n    }\r\n    return fxCanvas;\r\n}","\r\n// @ts-ignore\r\nimport shaderNoise from './shader-noise.glsl';\r\n\r\n/*\r\n * glfx.script\r\n * http://evanw.github.com/glfx.js/\r\n *\r\n * Copyright 2011 Evan Wallace\r\n * Released under the MIT license\r\n *\r\n * modifications by bitbof\r\n */\r\nexport const fx = (function () {\r\n    let exports: any = {};\r\n\r\n// src/OES_texture_float_linear-polyfill.script\r\n// From: https://github.com/evanw/OES_texture_float_linear-polyfill\r\n    (function () {\r\n        // Uploads a 2x2 floating-point texture where one pixel is 2 and the other\r\n        // three pixels are 0. Linear filtering is only supported if a sample taken\r\n        // from the center of that texture is (2 + 0 + 0 + 0) / 4 = 0.5.\r\n        function supportsOESTextureFloatLinear(gl) {\r\n            // Need floating point textures in the first place\r\n            if (!gl.getExtension('OES_texture_float')) {\r\n                return false;\r\n            }\r\n\r\n            // Create a render target\r\n            let framebuffer = gl.createFramebuffer();\r\n            let byteTexture = gl.createTexture();\r\n            gl.bindTexture(gl.TEXTURE_2D, byteTexture);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, byteTexture, 0);\r\n\r\n            // Create a simple floating-point texture with value of 0.5 in the center\r\n            let rgba = [\r\n                2, 0, 0, 0,\r\n                0, 0, 0, 0,\r\n                0, 0, 0, 0,\r\n                0, 0, 0, 0\r\n            ];\r\n            let floatTexture = gl.createTexture();\r\n            gl.bindTexture(gl.TEXTURE_2D, floatTexture);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, gl.FLOAT, new Float32Array(rgba));\r\n\r\n            // Create the test shader\r\n            let program = gl.createProgram();\r\n            let vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n            let fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n            gl.shaderSource(vertexShader, '\\\r\n      attribute vec2 vertex;\\\r\n      void main() {\\\r\n        gl_Position = vec4(vertex, 0.0, 1.0);\\\r\n      }\\\r\n    ');\r\n            gl.shaderSource(fragmentShader, '\\\r\n      uniform sampler2D texture;\\\r\n      void main() {\\\r\n        gl_FragColor = texture2D(texture, vec2(0.5));\\\r\n      }\\\r\n    ');\r\n            gl.compileShader(vertexShader);\r\n            gl.compileShader(fragmentShader);\r\n            gl.attachShader(program, vertexShader);\r\n            gl.attachShader(program, fragmentShader);\r\n            gl.linkProgram(program);\r\n\r\n            // Create a buffer containing a single point\r\n            let buffer = gl.createBuffer();\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0]), gl.STREAM_DRAW);\r\n            gl.enableVertexAttribArray(0);\r\n            gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\r\n\r\n            // Render the point and read back the rendered pixel\r\n            let pixel = new Uint8Array(4);\r\n            gl.useProgram(program);\r\n            gl.viewport(0, 0, 1, 1);\r\n            gl.bindTexture(gl.TEXTURE_2D, floatTexture);\r\n            gl.drawArrays(gl.POINTS, 0, 1);\r\n            gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel);\r\n\r\n            // The center sample will only have a value of 0.5 if linear filtering works\r\n            return pixel[0] === 127 || pixel[0] === 128;\r\n        }\r\n\r\n        // The constructor for the returned extension object\r\n        function OESTextureFloatLinear() {\r\n        }\r\n\r\n        // Cache the extension so it's specific to each context like extensions should be\r\n        function getOESTextureFloatLinear(gl) {\r\n            if (gl.$OES_texture_float_linear$ === void 0) {\r\n                Object.defineProperty(gl, '$OES_texture_float_linear$', {\r\n                    enumerable: false,\r\n                    configurable: false,\r\n                    writable: false,\r\n                    value: new OESTextureFloatLinear()\r\n                });\r\n            }\r\n            return gl.$OES_texture_float_linear$;\r\n        }\r\n\r\n        // This replaces the real getExtension()\r\n        function getExtension(name) {\r\n            return name === 'OES_texture_float_linear'\r\n                ? getOESTextureFloatLinear(this)\r\n                : oldGetExtension.call(this, name);\r\n        }\r\n\r\n        // This replaces the real getSupportedExtensions()\r\n        function getSupportedExtensions() {\r\n            let extensions = oldGetSupportedExtensions.call(this);\r\n            if (extensions.indexOf('OES_texture_float_linear') === -1) {\r\n                extensions.push('OES_texture_float_linear');\r\n            }\r\n            return extensions;\r\n        }\r\n\r\n        // Get a WebGL context\r\n        try {\r\n            let gl = document.createElement('canvas').getContext('experimental-webgl');\r\n        } catch (e) {\r\n        }\r\n\r\n        // Don't install the polyfill if the browser already supports it or doesn't have WebGL\r\n        if (!gl || (gl as any).getSupportedExtensions().indexOf('OES_texture_float_linear') !== -1) {\r\n            return;\r\n        }\r\n\r\n        // Install the polyfill if linear filtering works with floating-point textures\r\n        let oldGetExtension;\r\n        let oldGetSupportedExtensions;\r\n        if (supportsOESTextureFloatLinear(gl)) {\r\n            oldGetExtension = WebGLRenderingContext.prototype.getExtension;\r\n            oldGetSupportedExtensions = WebGLRenderingContext.prototype.getSupportedExtensions;\r\n            WebGLRenderingContext.prototype.getExtension = getExtension;\r\n            WebGLRenderingContext.prototype.getSupportedExtensions = getSupportedExtensions;\r\n        }\r\n    }());\r\n\r\n// src/core\\canvas.script\r\n    var gl;\r\n\r\n    function clamp(lo, value, hi) {\r\n        return Math.max(lo, Math.min(value, hi));\r\n    }\r\n\r\n    function wrapTexture(texture) {\r\n        return {\r\n            _: texture,\r\n            loadContentsOf: function (element) {\r\n                // Make sure that we're using the correct global WebGL context\r\n                gl = this._.gl;\r\n                this._.loadContentsOf(element);\r\n            },\r\n            destroy: function () {\r\n                // Make sure that we're using the correct global WebGL context\r\n                gl = this._.gl;\r\n                this._.destroy();\r\n            }\r\n        };\r\n    }\r\n\r\n    function texture(element) {\r\n        return wrapTexture(Texture.fromElement(element));\r\n    }\r\n\r\n    function initialize(width, height) {\r\n        let type = gl.UNSIGNED_BYTE;\r\n\r\n        // Go for floating point buffer textures if we can, it'll make the bokeh\r\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\r\n        // render to a floating-point texture when linear filtering is enabled.\r\n        // See http://crbug.com/172278 for more information.\r\n        if (gl.getExtension('OES_texture_float') && gl.getExtension('OES_texture_float_linear')) {\r\n            let testTexture = new Texture(100, 100, gl.RGBA, gl.FLOAT);\r\n            try {\r\n                // Only use gl.FLOAT if we can render to it\r\n                testTexture.drawTo(function () {\r\n                    type = gl.FLOAT;\r\n                });\r\n            } catch (e) {\r\n            }\r\n            testTexture.destroy();\r\n        }\r\n\r\n        if (this._.texture) this._.texture.destroy();\r\n        if (this._.spareTexture) this._.spareTexture.destroy();\r\n        this.width = width;\r\n        this.height = height;\r\n        this._.texture = new Texture(width, height, gl.RGBA, type);\r\n        this._.spareTexture = new Texture(width, height, gl.RGBA, type);\r\n        this._.extraTexture = this._.extraTexture || new Texture(0, 0, gl.RGBA, type);\r\n        this._.flippedShader = this._.flippedShader || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\\\r\n        }\\\r\n    ', 'flippedShader');\r\n        this._.isInitialized = true;\r\n    }\r\n\r\n    /*\r\n       Draw a texture to the canvas, with an optional width and height to scale to.\r\n       If no width and height are given then the original texture width and height\r\n       are used.\r\n    */\r\n    function draw(texture, width, height) {\r\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\r\n            initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\r\n        }\r\n\r\n        texture._.use();\r\n        this._.texture.drawTo(function () {\r\n            Shader.getDefaultShader().drawRect();\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    function update() {\r\n        this._.texture.use();\r\n        this._.flippedShader.drawRect();\r\n        return this;\r\n    }\r\n\r\n    function simpleShader(shader, uniforms, textureIn, textureOut) {\r\n        (textureIn || this._.texture).use();\r\n        this._.spareTexture.drawTo(function () {\r\n            shader.uniforms(uniforms).drawRect();\r\n        });\r\n        this._.spareTexture.swapWith(textureOut || this._.texture);\r\n    }\r\n\r\n    function replace(node) {\r\n        node.parentNode.insertBefore(this, node);\r\n        node.parentNode.removeChild(node);\r\n        return this;\r\n    }\r\n\r\n    function contents() {\r\n        let texture = new Texture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        this._.texture.use();\r\n        texture.drawTo(function () {\r\n            Shader.getDefaultShader().drawRect();\r\n        });\r\n        return wrapTexture(texture);\r\n    }\r\n\r\n    /*\r\n       Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\r\n       Length of the array will be width * height * 4.\r\n    */\r\n    function getPixelArray() {\r\n        let w = this._.texture.width;\r\n        let h = this._.texture.height;\r\n        let array = new Uint8Array(w * h * 4);\r\n        this._.texture.drawTo(function () {\r\n            gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\r\n        });\r\n        return array;\r\n    }\r\n\r\n    function wrap(func) {\r\n        return function () {\r\n            // Make sure that we're using the correct global WebGL context\r\n            gl = this._.gl;\r\n\r\n            // Now that the context has been switched, we can call the wrapped function\r\n            return func.apply(this, arguments);\r\n        };\r\n    }\r\n\r\n    exports.canvas = function () {\r\n        let canvas: any = document.createElement('canvas');\r\n        try {\r\n            gl = canvas.getContext('experimental-webgl', {premultipliedAlpha: false});\r\n        } catch (e) {\r\n            gl = null;\r\n        }\r\n        if (!gl) {\r\n            throw 'This browser does not support WebGL';\r\n        }\r\n        canvas._ = {\r\n            gl: gl,\r\n            isInitialized: false,\r\n            texture: null,\r\n            spareTexture: null,\r\n            flippedShader: null\r\n        };\r\n\r\n        // Core methods\r\n        canvas.texture = wrap(texture);\r\n        canvas.draw = wrap(draw);\r\n        canvas.update = wrap(update);\r\n        canvas.replace = wrap(replace);\r\n        canvas.contents = wrap(contents);\r\n        canvas.getPixelArray = wrap(getPixelArray);\r\n\r\n        // Filter methods\r\n        canvas.brightnessContrast = wrap(brightnessContrast);\r\n        canvas.hexagonalPixelate = wrap(hexagonalPixelate);\r\n        canvas.hueSaturation = wrap(hueSaturation);\r\n        canvas.colorHalftone = wrap(colorHalftone);\r\n        canvas.triangleBlur = wrap(triangleBlur);\r\n        canvas.unsharpMask = wrap(unsharpMask);\r\n        canvas.perspective = wrap(perspective);\r\n        canvas.matrixWarp = wrap(matrixWarp);\r\n        canvas.bulgePinch = wrap(bulgePinch);\r\n        canvas.tiltShift = wrap(tiltShift);\r\n        canvas.dotScreen = wrap(dotScreen);\r\n        canvas.edgeWork = wrap(edgeWork);\r\n        canvas.lensBlur = wrap(lensBlur);\r\n        canvas.zoomBlur = wrap(zoomBlur);\r\n        canvas.noise = wrap(noise);\r\n        canvas.denoise = wrap(denoise);\r\n        canvas.curves = wrap(curves);\r\n        canvas.swirl = wrap(swirl);\r\n        canvas.ink = wrap(ink);\r\n        canvas.vignette = wrap(vignette);\r\n        canvas.vibrance = wrap(vibrance);\r\n        canvas.sepia = wrap(sepia);\r\n        canvas.invert = wrap(invert);\r\n        canvas.multiplyAlpha = wrap(multiplyAlpha);\r\n        canvas.unmultiplyAlpha = wrap(unmultiplyAlpha);\r\n        canvas.toAlpha = wrap(toAlpha);\r\n        canvas.distort = wrap(distort);\r\n\r\n        return canvas;\r\n    };\r\n    exports.splineInterpolate = splineInterpolate;\r\n\r\n// src/core\\matrix.script\r\n// from javax.media.jai.PerspectiveTransform\r\n\r\n    function getSquareToQuad(x0, y0, x1, y1, x2, y2, x3, y3) {\r\n        let dx1 = x1 - x2;\r\n        let dy1 = y1 - y2;\r\n        let dx2 = x3 - x2;\r\n        let dy2 = y3 - y2;\r\n        let dx3 = x0 - x1 + x2 - x3;\r\n        let dy3 = y0 - y1 + y2 - y3;\r\n        let det = dx1 * dy2 - dx2 * dy1;\r\n        let a = (dx3 * dy2 - dx2 * dy3) / det;\r\n        let b = (dx1 * dy3 - dx3 * dy1) / det;\r\n        return [\r\n            x1 - x0 + a * x1, y1 - y0 + a * y1, a,\r\n            x3 - x0 + b * x3, y3 - y0 + b * y3, b,\r\n            x0, y0, 1\r\n        ];\r\n    }\r\n\r\n    function getInverse(m) {\r\n        let a = m[0], b = m[1], c = m[2];\r\n        let d = m[3], e = m[4], f = m[5];\r\n        let g = m[6], h = m[7], i = m[8];\r\n        let det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n        return [\r\n            (e * i - f * h) / det, (c * h - b * i) / det, (b * f - c * e) / det,\r\n            (f * g - d * i) / det, (a * i - c * g) / det, (c * d - a * f) / det,\r\n            (d * h - e * g) / det, (b * g - a * h) / det, (a * e - b * d) / det\r\n        ];\r\n    }\r\n\r\n    function multiply(a, b) {\r\n        return [\r\n            a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\r\n            a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\r\n            a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\r\n            a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\r\n            a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\r\n            a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\r\n            a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\r\n            a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\r\n            a[6] * b[2] + a[7] * b[5] + a[8] * b[8]\r\n        ];\r\n    }\r\n\r\n// src/core\\shader.script\r\n    var Shader = (function () {\r\n        function isArray(obj) {\r\n            return Object.prototype.toString.call(obj) == '[object Array]';\r\n        }\r\n\r\n        function isNumber(obj) {\r\n            return Object.prototype.toString.call(obj) == '[object Number]';\r\n        }\r\n\r\n        function compileSource(type, source, nameStr) {\r\n            let shader = gl.createShader(type);\r\n            gl.shaderSource(shader, source.replace(/#define.*/, '')); // glslify adds a line add the beginning that breaks it\r\n            gl.compileShader(shader);\r\n            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n                throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\r\n            }\r\n            return shader;\r\n        }\r\n\r\n        let defaultVertexSource = '\\\r\n    attribute vec2 vertex;\\\r\n    attribute vec2 _texCoord;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        texCoord = _texCoord;\\\r\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\r\n    }';\r\n\r\n        let defaultFragmentSource = '\\\r\n    uniform sampler2D texture;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        gl_FragColor = texture2D(texture, texCoord);\\\r\n    }';\r\n\r\n        // added test 2020-04-27 bitbof\r\n        let floatPrecision = null;\r\n\r\n        function testPrecisionSupport(precisionType) {\r\n            let format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\r\n            return format !== null && format.precision !== 0;\r\n        }\r\n\r\n        function Shader(vertexSource?, fragmentSource?, nameStr?) {\r\n            this.vertexAttribute = null;\r\n            this.texCoordAttribute = null;\r\n            this.program = gl.createProgram();\r\n            vertexSource = vertexSource || defaultVertexSource;\r\n            fragmentSource = fragmentSource || defaultFragmentSource;\r\n            if (floatPrecision === null) {\r\n                floatPrecision = testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\r\n            }\r\n            fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\r\n            gl.attachShader(this.program, compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\r\n            gl.attachShader(this.program, compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\r\n            gl.linkProgram(this.program);\r\n            if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\r\n                throw 'link error: ' + gl.getProgramInfoLog(this.program);\r\n            }\r\n        }\r\n\r\n        Shader.prototype.destroy = function () {\r\n            gl.deleteProgram(this.program);\r\n            this.program = null;\r\n        };\r\n\r\n        Shader.prototype.uniforms = function (uniforms) {\r\n            gl.useProgram(this.program);\r\n            for (var name in uniforms) {\r\n                if (!uniforms.hasOwnProperty(name)) continue;\r\n                let location = gl.getUniformLocation(this.program, name);\r\n                if (location === null) continue; // will be null if the uniform isn't used in the shader\r\n                let value = uniforms[name];\r\n                if (isArray(value)) {\r\n                    switch (value.length) {\r\n                        case 1:\r\n                            gl.uniform1fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 2:\r\n                            gl.uniform2fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 3:\r\n                            gl.uniform3fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 4:\r\n                            gl.uniform4fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 9:\r\n                            gl.uniformMatrix3fv(location, false, new Float32Array(value));\r\n                            break;\r\n                        case 16:\r\n                            gl.uniformMatrix4fv(location, false, new Float32Array(value));\r\n                            break;\r\n                        default:\r\n                            throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\r\n                    }\r\n                } else if (isNumber(value)) {\r\n                    gl.uniform1f(location, value);\r\n                } else {\r\n                    throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || 'undefined').toString();\r\n                }\r\n            }\r\n            // allow chaining\r\n            return this;\r\n        };\r\n\r\n        // textures are uniforms too but for some reason can't be specified by gl.uniform1f,\r\n        // even though floating point numbers represent the integers 0 through 7 exactly\r\n        Shader.prototype.textures = function (textures) {\r\n            gl.useProgram(this.program);\r\n            for (var name in textures) {\r\n                if (!textures.hasOwnProperty(name)) continue;\r\n                gl.uniform1i(gl.getUniformLocation(this.program, name), textures[name]);\r\n            }\r\n            // allow chaining\r\n            return this;\r\n        };\r\n\r\n        Shader.prototype.drawRect = function (left, top, right, bottom) {\r\n            let undefined;\r\n            let viewport = gl.getParameter(gl.VIEWPORT);\r\n            top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\r\n            left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\r\n            right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\r\n            bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\r\n            if (gl.vertexBuffer == null) {\r\n                gl.vertexBuffer = gl.createBuffer();\r\n            }\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([left, top, left, bottom, right, top, right, bottom]), gl.STATIC_DRAW);\r\n            if (gl.texCoordBuffer == null) {\r\n                gl.texCoordBuffer = gl.createBuffer();\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\r\n            }\r\n            if (this.vertexAttribute == null) {\r\n                this.vertexAttribute = gl.getAttribLocation(this.program, 'vertex');\r\n                gl.enableVertexAttribArray(this.vertexAttribute);\r\n            }\r\n            if (this.texCoordAttribute == null) {\r\n                this.texCoordAttribute = gl.getAttribLocation(this.program, '_texCoord');\r\n                gl.enableVertexAttribArray(this.texCoordAttribute);\r\n            }\r\n            gl.useProgram(this.program);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n            gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n            gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\r\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        };\r\n\r\n        Shader.getDefaultShader = function () {\r\n            gl.defaultShader = gl.defaultShader || new Shader();\r\n            return gl.defaultShader;\r\n        };\r\n\r\n        return Shader;\r\n    })();\r\n\r\n// src/core\\spline.script\r\n// from SplineInterpolator.cs in the Paint.NET source code\r\n\r\n    function SplineInterpolator(points) {\r\n        let n = points.length;\r\n        this.xa = [];\r\n        this.ya = [];\r\n        this.u = [];\r\n        this.y2 = [];\r\n\r\n        points.sort(function (a, b) {\r\n            return a[0] - b[0];\r\n        });\r\n        for (var i = 0; i < n; i++) {\r\n            this.xa.push(points[i][0]);\r\n            this.ya.push(points[i][1]);\r\n        }\r\n\r\n        this.u[0] = 0;\r\n        this.y2[0] = 0;\r\n\r\n        for (var i = 1; i < n - 1; ++i) {\r\n            // This is the decomposition loop of the tridiagonal algorithm.\r\n            // y2 and u are used for temporary storage of the decomposed factors.\r\n            let wx = this.xa[i + 1] - this.xa[i - 1];\r\n            let sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n            let p = sig * this.y2[i - 1] + 2.0;\r\n\r\n            this.y2[i] = (sig - 1.0) / p;\r\n\r\n            let ddydx =\r\n                (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\r\n                (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n        }\r\n\r\n        this.y2[n - 1] = 0;\r\n\r\n        // This is the backsubstitution loop of the tridiagonal algorithm\r\n        for (var i = n - 2; i >= 0; --i) {\r\n            this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n        }\r\n    }\r\n\r\n    SplineInterpolator.prototype.interpolate = function (x) {\r\n        let n = this.ya.length;\r\n        let klo = 0;\r\n        let khi = n - 1;\r\n\r\n        // We will find the right place in the table by means of\r\n        // bisection. This is optimal if sequential calls to this\r\n        // routine are at random values of x. If sequential calls\r\n        // are in order, and closely spaced, one would do better\r\n        // to store previous values of klo and khi.\r\n        while (khi - klo > 1) {\r\n            let k = (khi + klo) >> 1;\r\n\r\n            if (this.xa[k] > x) {\r\n                khi = k;\r\n            } else {\r\n                klo = k;\r\n            }\r\n        }\r\n\r\n        let h = this.xa[khi] - this.xa[klo];\r\n        let a = (this.xa[khi] - x) / h;\r\n        let b = (x - this.xa[klo]) / h;\r\n\r\n        // Cubic spline polynomial is now evaluated.\r\n        return a * this.ya[klo] + b * this.ya[khi] +\r\n            ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n    };\r\n\r\n// src/core\\texture.script\r\n    var Texture = (function () {\r\n        Texture.fromElement = function (element) {\r\n            let texture = new Texture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\r\n            texture.loadContentsOf(element);\r\n            return texture;\r\n        };\r\n\r\n        function Texture(width, height, format, type) {\r\n            this.gl = gl;\r\n            this.id = gl.createTexture();\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = format;\r\n            this.type = type;\r\n\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            if (width && height) gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n\r\n        Texture.prototype.loadContentsOf = function (element) {\r\n            this.width = element.width || element.videoWidth;\r\n            this.height = element.height || element.videoHeight;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\r\n        };\r\n\r\n        Texture.prototype.initFromBytes = function (width, height, data) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = gl.RGBA;\r\n            this.type = gl.UNSIGNED_BYTE;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\r\n        };\r\n\r\n        Texture.prototype.destroy = function () {\r\n            gl.deleteTexture(this.id);\r\n            this.id = null;\r\n        };\r\n\r\n        Texture.prototype.use = function (unit) {\r\n            gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        };\r\n\r\n        Texture.prototype.unuse = function (unit) {\r\n            gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n            gl.bindTexture(gl.TEXTURE_2D, null);\r\n        };\r\n\r\n        Texture.prototype.ensureFormat = function (width, height, format, type) {\r\n            // allow passing an existing texture instead of individual arguments\r\n            if (arguments.length == 1) {\r\n                let texture = arguments[0];\r\n                width = texture.width;\r\n                height = texture.height;\r\n                format = texture.format;\r\n                type = texture.type;\r\n            }\r\n\r\n            // change the format only if required\r\n            if (width != this.width || height != this.height || format != this.format || type != this.type) {\r\n                this.width = width;\r\n                this.height = height;\r\n                this.format = format;\r\n                this.type = type;\r\n                gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n                gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n            }\r\n        };\r\n\r\n        Texture.prototype.drawTo = function (callback) {\r\n            // start rendering to this texture\r\n            gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\r\n            if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\r\n                throw new Error('incomplete framebuffer');\r\n            }\r\n            gl.viewport(0, 0, this.width, this.height);\r\n\r\n            // do the drawing\r\n            callback();\r\n\r\n            // stop rendering to this texture\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n        };\r\n\r\n        let canvas = null;\r\n\r\n        function getCanvas(texture) {\r\n            if (canvas == null) canvas = document.createElement('canvas');\r\n            canvas.width = texture.width;\r\n            canvas.height = texture.height;\r\n            let c = canvas.getContext('2d');\r\n            c.clearRect(0, 0, canvas.width, canvas.height);\r\n            return c;\r\n        }\r\n\r\n        Texture.prototype.fillUsingCanvas = function (callback) {\r\n            callback(getCanvas(this));\r\n            this.format = gl.RGBA;\r\n            this.type = gl.UNSIGNED_BYTE;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvas);\r\n            return this;\r\n        };\r\n\r\n        Texture.prototype.toImage = function (image) {\r\n            this.use();\r\n            Shader.getDefaultShader().drawRect();\r\n            let size = this.width * this.height * 4;\r\n            let pixels = new Uint8Array(size);\r\n            let c = getCanvas(this);\r\n            let data = c.createImageData(this.width, this.height);\r\n            gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n            for (var i = 0; i < size; i++) {\r\n                data.data[i] = pixels[i];\r\n            }\r\n            c.putImageData(data, 0, 0);\r\n            image.src = canvas.toDataURL();\r\n        };\r\n\r\n        Texture.prototype.swapWith = function (other) {\r\n            let temp;\r\n            temp = other.id;\r\n            other.id = this.id;\r\n            this.id = temp;\r\n            temp = other.width;\r\n            other.width = this.width;\r\n            this.width = temp;\r\n            temp = other.height;\r\n            other.height = this.height;\r\n            this.height = temp;\r\n            temp = other.format;\r\n            other.format = this.format;\r\n            this.format = temp;\r\n        };\r\n\r\n        return Texture;\r\n    })();\r\n\r\n// src/filters\\common.script\r\n    function warpShader(uniforms, warp) {\r\n        return new Shader(null, uniforms + '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        vec2 coord = texCoord * texSize;\\\r\n        ' + warp + '\\\r\n        gl_FragColor = texture2D(texture, coord / texSize);\\\r\n    }', 'warp');\r\n    }\r\n\r\n// returns a random number between 0 and 1\r\n    var randomShaderFunc = '\\\r\n    float random(vec3 scale, float seed) {\\\r\n        /* use the fragment position for a different seed per-pixel */\\\r\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\r\n    }\\\r\n';\r\n\r\n// src/filters\\adjust\\brightnesscontrast.script\r\n    /**\r\n     * @filter           Brightness / Contrast\r\n     * @description      Provides additive brightness and multiplicative contrast control.\r\n     * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\r\n     * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n     */\r\n    function brightnessContrast(brightness, contrast) {\r\n        gl.brightnessContrast = gl.brightnessContrast || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float brightness;\\\r\n        uniform float contrast;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.rgb += brightness;\\\r\n            if (contrast > 0.0) {\\\r\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\r\n            } else {\\\r\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\r\n            }\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'brightnessContrast');\r\n\r\n        simpleShader.call(this, gl.brightnessContrast, {\r\n            brightness: clamp(-1, brightness, 1),\r\n            contrast: clamp(-1, contrast, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\curves.script\r\n    function splineInterpolate(points) {\r\n        let interpolator = new SplineInterpolator(points);\r\n        let array = [];\r\n        for (var i = 0; i < 256; i++) {\r\n            array.push(clamp(0, Math.floor(interpolator.interpolate(i / 255) * 256), 255));\r\n        }\r\n        return array;\r\n    }\r\n\r\n    /**\r\n     * @filter      Curves\r\n     * @description A powerful mapping tool that transforms the colors in the image\r\n     *              by an arbitrary function. The function is interpolated between\r\n     *              a set of 2D points using splines. The curves filter can take\r\n     *              either one or three arguments which will apply the mapping to\r\n     *              either luminance or RGB values, respectively.\r\n     * @param red   A list of points that define the function for the red channel.\r\n     *              Each point is a list of two values: the value before the mapping\r\n     *              and the value after the mapping, both in the range 0 to 1. For\r\n     *              example, [[0,1], [1,0]] would invert the red channel while\r\n     *              [[0,0], [1,1]] would leave the red channel unchanged. If green\r\n     *              and blue are omitted then this argument also applies to the\r\n     *              green and blue channels.\r\n     * @param green (optional) A list of points that define the function for the green\r\n     *              channel (just like for red).\r\n     * @param blue  (optional) A list of points that define the function for the blue\r\n     *              channel (just like for red).\r\n     */\r\n    function curves(red, green, blue) {\r\n        // Create the ramp texture\r\n        red = splineInterpolate(red);\r\n        if (arguments.length == 1) {\r\n            green = blue = red;\r\n        } else {\r\n            green = splineInterpolate(green);\r\n            blue = splineInterpolate(blue);\r\n        }\r\n        let array = [];\r\n        for (var i = 0; i < 256; i++) {\r\n            array.splice(array.length, 0, red[i], green[i], blue[i], 255);\r\n        }\r\n        this._.extraTexture.initFromBytes(256, 1, array);\r\n        this._.extraTexture.use(1);\r\n\r\n        gl.curves = gl.curves || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform sampler2D map;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.r = texture2D(map, vec2(color.r)).r;\\\r\n            color.g = texture2D(map, vec2(color.g)).g;\\\r\n            color.b = texture2D(map, vec2(color.b)).b;\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'curves');\r\n\r\n        gl.curves.textures({\r\n            map: 1\r\n        });\r\n        simpleShader.call(this, gl.curves, {});\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\denoise.script\r\n    /**\r\n     * @filter         Denoise\r\n     * @description    Smooths over grainy noise in dark images using an 9x9 box filter\r\n     *                 weighted by color intensity, similar to a bilateral filter.\r\n     * @param exponent The exponent of the color intensity difference, should be greater\r\n     *                 than zero. A value of zero just gives an 9x9 box blur and high values\r\n     *                 give the original image, but ideal values are usually around 10-20.\r\n     */\r\n    function denoise(exponent) {\r\n        // Do a 9x9 bilateral box filter\r\n        gl.denoise = gl.denoise || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float exponent;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 center = texture2D(texture, texCoord);\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            for (float x = -4.0; x <= 4.0; x += 1.0) {\\\r\n                for (float y = -4.0; y <= 4.0; y += 1.0) {\\\r\n                    vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);\\\r\n                    float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));\\\r\n                    weight = pow(weight, exponent);\\\r\n                    color += sample * weight;\\\r\n                    total += weight;\\\r\n                }\\\r\n            }\\\r\n            gl_FragColor = color / total;\\\r\n        }\\\r\n    ', 'denoise');\r\n\r\n        // Perform two iterations for stronger results\r\n        for (var i = 0; i < 2; i++) {\r\n            simpleShader.call(this, gl.denoise, {\r\n                exponent: Math.max(0, exponent),\r\n                texSize: [this.width, this.height]\r\n            });\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\huesaturation.script\r\n    /**\r\n     * @filter           Hue / Saturation\r\n     * @description      Provides rotational hue and multiplicative saturation control. RGB color space\r\n     *                   can be imagined as a cube where the axes are the red, green, and blue color\r\n     *                   values. Hue changing works by rotating the color vector around the grayscale\r\n     *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\r\n     *                   Saturation is implemented by scaling all color channel values either toward\r\n     *                   or away from the average color channel value.\r\n     * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\r\n     *                   and 1 is 180 degree rotation in the positive direction)\r\n     * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n     */\r\n    function hueSaturation(hue, saturation) {\r\n        gl.hueSaturation = gl.hueSaturation || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float hue;\\\r\n        uniform float saturation;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\r\n            float angle = hue * 3.14159265;\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\r\n            float len = length(color.rgb);\\\r\n            color.rgb = vec3(\\\r\n                dot(color.rgb, weights.xyz),\\\r\n                dot(color.rgb, weights.zxy),\\\r\n                dot(color.rgb, weights.yzx)\\\r\n            );\\\r\n            \\\r\n            /* saturation adjustment */\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            if (saturation > 0.0) {\\\r\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\r\n            } else {\\\r\n                color.rgb += (average - color.rgb) * (-saturation);\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'hueSaturation');\r\n\r\n        simpleShader.call(this, gl.hueSaturation, {\r\n            hue: clamp(-1, hue, 1),\r\n            saturation: clamp(-1, saturation, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\noise.script\r\n    /**\r\n     * @filter         Noise\r\n     * @description    draws noise, completely replaces original image\r\n     * @param seed\r\n     * @param type\r\n     * @param scale\r\n     * @param offset\r\n     * @param octaves\r\n     * @param samples\r\n     * @param peaks\r\n     * @param brightness\r\n     * @param contrast\r\n     * @param isReversed\r\n     * @param colA\r\n     * @param colB\r\n     * @param channels\r\n     */\r\n    function noise(\r\n        seed: number, // float, any value okay\r\n        type: number, // 1 value, 2 simplex, 3 cellular\r\n        scale: [number, number], // float, small scale will show repeating patterns\r\n        offset: [number, number], // offset x, y - large offsets will show repeating patterns\r\n        octaves: number, // int 0 - 4\r\n        samples: number, // 1 | 4 | 8 -> super-sampling\r\n        peaks: number, // how often it will ramp *additionally* from 0 to 1\r\n        brightness: number, // range [-1, 1]\r\n        contrast: number, // range [-1, 1]\r\n        isReversed: boolean, // reverse 0-1 range\r\n        colA: {r: number, g: number, b: number}, // which color at 0, if rgb\r\n        colB: {r: number, g: number, b: number}, // which color at 1, if rgb\r\n        channels: 'rgb' | 'alpha', // which channel to target\r\n    ) {\r\n        gl.noise = gl.noise || new Shader(null, shaderNoise.replace(/#define.*/, ''), 'noise');\r\n        simpleShader.call(this, gl.noise, {\r\n            seed,\r\n            type,\r\n            scale: [scale[0], scale[1]],\r\n            offset,\r\n            octaves,\r\n            samples,\r\n            texSize: [this.width, this.height],\r\n            peaks,\r\n            brightness,\r\n            contrast,\r\n            isReversed: isReversed ? 1.0 : 0.0,\r\n            colA: colA ? [colA.r / 255, colA.g / 255, colA.b / 255] : [0, 0, 0],\r\n            colB: colB ? [colB.r / 255, colB.g / 255, colB.b / 255] : [1, 1, 1],\r\n            channels: channels === 'rgb' ? 0 : 1,\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\sepia.script\r\n    /**\r\n     * @filter         Sepia\r\n     * @description    Gives the image a reddish-brown monochrome tint that imitates an old photograph.\r\n     * @param amount   0 to 1 (0 for no effect, 1 for full sepia coloring)\r\n     */\r\n    function sepia(amount) {\r\n        gl.sepia = gl.sepia || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float r = color.r;\\\r\n            float g = color.g;\\\r\n            float b = color.b;\\\r\n            \\\r\n            color.r = min(1.0, (r * (1.0 - (0.607 * amount))) + (g * (0.769 * amount)) + (b * (0.189 * amount)));\\\r\n            color.g = min(1.0, (r * 0.349 * amount) + (g * (1.0 - (0.314 * amount))) + (b * 0.168 * amount));\\\r\n            color.b = min(1.0, (r * 0.272 * amount) + (g * 0.534 * amount) + (b * (1.0 - (0.869 * amount))));\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'sepia');\r\n\r\n        simpleShader.call(this, gl.sepia, {\r\n            amount: clamp(0, amount, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\unsharpmask.script\r\n    /**\r\n     * @filter         Unsharp Mask\r\n     * @description    A form of image sharpening that amplifies high-frequencies in the image. It\r\n     *                 is implemented by scaling pixels away from the average of their neighbors.\r\n     * @param radius   The blur radius that calculates the average of the neighboring pixels.\r\n     * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\r\n     */\r\n    function unsharpMask(radius, strength) {\r\n        gl.unsharpMask = gl.unsharpMask || new Shader(null, '\\\r\n        uniform sampler2D blurredTexture;\\\r\n        uniform sampler2D originalTexture;\\\r\n        uniform float strength;\\\r\n        uniform float threshold;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\r\n            vec4 original = texture2D(originalTexture, texCoord);\\\r\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\r\n        }\\\r\n    ', 'unsharpMask');\r\n\r\n        // Store a copy of the current texture in the second texture unit\r\n        this._.extraTexture.ensureFormat(this._.texture);\r\n        this._.texture.use();\r\n        this._.extraTexture.drawTo(function () {\r\n            Shader.getDefaultShader().drawRect();\r\n        });\r\n\r\n        // Blur the current texture, then use the stored texture to detect edges\r\n        this._.extraTexture.use(1);\r\n        this.triangleBlur(radius);\r\n        gl.unsharpMask.textures({\r\n            originalTexture: 1\r\n        });\r\n        simpleShader.call(this, gl.unsharpMask, {\r\n            strength: strength\r\n        });\r\n        this._.extraTexture.unuse(1);\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\vibrance.script\r\n    /**\r\n     * @filter       Vibrance\r\n     * @description  Modifies the saturation of desaturated colors, leaving saturated colors unmodified.\r\n     * @param amount -1 to 1 (-1 is minimum vibrance, 0 is no change, and 1 is maximum vibrance)\r\n     */\r\n    function vibrance(amount) {\r\n        gl.vibrance = gl.vibrance || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            float mx = max(color.r, max(color.g, color.b));\\\r\n            float amt = (mx - average) * (-amount * 3.0);\\\r\n            color.rgb = mix(color.rgb, vec3(mx), amt);\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'vibrance');\r\n\r\n        simpleShader.call(this, gl.vibrance, {\r\n            amount: clamp(-1, amount, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\vignette.script\r\n    /**\r\n     * @filter         Vignette\r\n     * @description    Adds a simulated lens edge darkening effect.\r\n     * @param size     0 to 1 (0 for center of frame, 1 for edge of frame)\r\n     * @param amount   0 to 1 (0 for no effect, 1 for maximum lens darkening)\r\n     */\r\n    function vignette(size, amount) {\r\n        gl.vignette = gl.vignette || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float size;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            float dist = distance(texCoord, vec2(0.5, 0.5));\\\r\n            color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount + size));\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'vignette');\r\n\r\n        simpleShader.call(this, gl.vignette, {\r\n            size: clamp(0, size, 1),\r\n            amount: clamp(0, amount, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\blur\\lensblur.script\r\n    /**\r\n     * @filter           Lens Blur\r\n     * @description      Imitates a camera capturing the image out of focus by using a blur that generates\r\n     *                   the large shapes known as bokeh. The polygonal shape of real bokeh is due to the\r\n     *                   blades of the aperture diaphragm when it isn't fully open. This blur renders\r\n     *                   bokeh from a 6-bladed diaphragm because the computation is more efficient. It\r\n     *                   can be separated into three rhombi, each of which is just a skewed box blur.\r\n     *                   This filter makes use of the floating point texture WebGL extension to implement\r\n     *                   the brightness parameter, so there will be severe visual artifacts if brightness\r\n     *                   is non-zero and the floating point texture extension is not available. The\r\n     *                   idea was from John White's SIGGRAPH 2011 talk but this effect has an additional\r\n     *                   brightness parameter that fakes what would otherwise come from a HDR source.\r\n     * @param radius     the radius of the hexagonal disk convolved with the image\r\n     * @param brightness -1 to 1 (the brightness of the bokeh, negative values will create dark bokeh)\r\n     * @param angle      the rotation of the bokeh in radians\r\n     */\r\n    function lensBlur(radius, brightness, angle) {\r\n        // All averaging is done on values raised to a power to make more obvious bokeh\r\n        // (we will raise the average to the inverse power at the end to compensate).\r\n        // Without this the image looks almost like a normal blurred image. This hack is\r\n        // obviously not realistic, but to accurately simulate this we would need a high\r\n        // dynamic range source photograph which we don't have.\r\n        gl.lensBlurPrePass = gl.lensBlurPrePass || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float power;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color = pow(color, vec4(power));\\\r\n            gl_FragColor = vec4(color);\\\r\n        }\\\r\n    ', 'lensBlurPrePass');\r\n\r\n        let common = '\\\r\n        uniform sampler2D texture0;\\\r\n        uniform sampler2D texture1;\\\r\n        uniform vec2 delta0;\\\r\n        uniform vec2 delta1;\\\r\n        uniform float power;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        vec4 sample(vec2 delta) {\\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(delta, 151.7182), 0.0);\\\r\n            \\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            for (float t = 0.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset) / 30.0;\\\r\n                color += texture2D(texture0, texCoord + delta * percent);\\\r\n                total += 1.0;\\\r\n            }\\\r\n            return color / total;\\\r\n        }\\\r\n    ';\r\n\r\n        gl.lensBlur0 = gl.lensBlur0 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            gl_FragColor = sample(delta0);\\\r\n        }\\\r\n    ', 'lensBlur0');\r\n        gl.lensBlur1 = gl.lensBlur1 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            gl_FragColor = (sample(delta0) + sample(delta1)) * 0.5;\\\r\n        }\\\r\n    ', 'lensBlur1');\r\n        gl.lensBlur2 = gl.lensBlur2 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            vec4 color = (sample(delta0) + 2.0 * texture2D(texture1, texCoord)) / 3.0;\\\r\n            gl_FragColor = pow(color, vec4(power));\\\r\n        }\\\r\n    ', 'lensBlur2').textures({texture1: 1});\r\n\r\n        // Generate\r\n        let dir = [];\r\n        for (var i = 0; i < 3; i++) {\r\n            let a = angle + i * Math.PI * 2 / 3;\r\n            dir.push([radius * Math.sin(a) / this.width, radius * Math.cos(a) / this.height]);\r\n        }\r\n        let power = Math.pow(10, clamp(-1, brightness, 1));\r\n\r\n        // Remap the texture values, which will help make the bokeh effect\r\n        simpleShader.call(this, gl.lensBlurPrePass, {\r\n            power: power\r\n        });\r\n\r\n        // Blur two rhombi in parallel into extraTexture\r\n        this._.extraTexture.ensureFormat(this._.texture);\r\n        simpleShader.call(this, gl.lensBlur0, {\r\n            delta0: dir[0]\r\n        }, this._.texture, this._.extraTexture);\r\n        simpleShader.call(this, gl.lensBlur1, {\r\n            delta0: dir[1],\r\n            delta1: dir[2]\r\n        }, this._.extraTexture, this._.extraTexture);\r\n\r\n        // Blur the last rhombus and combine with extraTexture\r\n        simpleShader.call(this, gl.lensBlur0, {\r\n            delta0: dir[1]\r\n        });\r\n        this._.extraTexture.use(1);\r\n        simpleShader.call(this, gl.lensBlur2, {\r\n            power: 1 / power,\r\n            delta0: dir[2]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\blur\\tiltshift.script\r\n    /**\r\n     * @filter               Tilt Shift\r\n     * @description          Simulates the shallow depth of field normally encountered in close-up\r\n     *                       photography, which makes the scene seem much smaller than it actually\r\n     *                       is. This filter assumes the scene is relatively planar, in which case\r\n     *                       the part of the scene that is completely in focus can be described by\r\n     *                       a line (the intersection of the focal plane and the scene). An example\r\n     *                       of a planar scene might be looking at a road from above at a downward\r\n     *                       angle. The image is then blurred with a blur radius that starts at zero\r\n     *                       on the line and increases further from the line.\r\n     * @param startX         The x coordinate of the start of the line segment.\r\n     * @param startY         The y coordinate of the start of the line segment.\r\n     * @param endX           The x coordinate of the end of the line segment.\r\n     * @param endY           The y coordinate of the end of the line segment.\r\n     * @param blurRadius     The maximum radius of the pyramid blur.\r\n     * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\r\n     */\r\n    function tiltShift(startX, startY, endX, endY, blurRadius, gradientRadius) {\r\n        gl.tiltShift = gl.tiltShift || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float blurRadius;\\\r\n        uniform float gradientRadius;\\\r\n        uniform vec2 start;\\\r\n        uniform vec2 end;\\\r\n        uniform vec2 delta;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\r\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'tiltShift');\r\n\r\n        let dx = endX - startX;\r\n        let dy = endY - startY;\r\n        let d = Math.sqrt(dx * dx + dy * dy);\r\n        simpleShader.call(this, gl.tiltShift, {\r\n            blurRadius: blurRadius,\r\n            gradientRadius: gradientRadius,\r\n            start: [startX, startY],\r\n            end: [endX, endY],\r\n            delta: [dx / d, dy / d],\r\n            texSize: [this.width, this.height]\r\n        });\r\n        simpleShader.call(this, gl.tiltShift, {\r\n            blurRadius: blurRadius,\r\n            gradientRadius: gradientRadius,\r\n            start: [startX, startY],\r\n            end: [endX, endY],\r\n            delta: [-dy / d, dx / d],\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\blur\\triangleblur.script\r\n    /**\r\n     * @filter       Triangle Blur\r\n     * @description  This is the most basic blur filter, which convolves the image with a\r\n     *               pyramid filter. The pyramid filter is separable and is applied as two\r\n     *               perpendicular triangle filters.\r\n     * @param radius The radius of the pyramid convolved with the image.\r\n     */\r\n    function triangleBlur(radius) {\r\n        gl.triangleBlur = gl.triangleBlur || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'triangleBlur');\r\n\r\n        simpleShader.call(this, gl.triangleBlur, {\r\n            delta: [radius / this.width, 0]\r\n        });\r\n        simpleShader.call(this, gl.triangleBlur, {\r\n            delta: [0, radius / this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\blur\\zoomblur.script\r\n    /**\r\n     * @filter         Zoom Blur\r\n     * @description    Blurs the image away from a certain point, which looks like radial motion blur.\r\n     * @param centerX  The x coordinate of the blur origin.\r\n     * @param centerY  The y coordinate of the blur origin.\r\n     * @param strength The strength of the blur. Values in the range 0 to 1 are usually sufficient,\r\n     *                 where 0 doesn't change the image and 1 creates a highly blurred image.\r\n     */\r\n    function zoomBlur(centerX, centerY, strength) {\r\n        gl.zoomBlur = gl.zoomBlur || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            vec2 toCenter = center - texCoord * texSize;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = 0.0; t <= 40.0; t++) {\\\r\n                float percent = (t + offset) / 40.0;\\\r\n                float weight = 4.0 * (percent - percent * percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + toCenter * percent * strength / texSize);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'zoomBlur');\r\n\r\n        simpleShader.call(this, gl.zoomBlur, {\r\n            center: [centerX, centerY],\r\n            strength: strength,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\colorhalftone.script\r\n    /**\r\n     * @filter        Color Halftone\r\n     * @description   Simulates a CMYK halftone rendering of the image by multiplying pixel values\r\n     *                with a four rotated 2D sine wave patterns, one each for cyan, magenta, yellow,\r\n     *                and black.\r\n     * @param centerX The x coordinate of the pattern origin.\r\n     * @param centerY The y coordinate of the pattern origin.\r\n     * @param angle   The rotation of the pattern in radians.\r\n     * @param size    The diameter of a dot in pixels.\r\n     */\r\n    function colorHalftone(centerX, centerY, angle, size) {\r\n        gl.colorHalftone = gl.colorHalftone || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float angle;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        \\\r\n        float pattern(float angle) {\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec2 tex = texCoord * texSize - center;\\\r\n            vec2 point = vec2(\\\r\n                c * tex.x - s * tex.y,\\\r\n                s * tex.x + c * tex.y\\\r\n            ) * scale;\\\r\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\r\n        }\\\r\n        \\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            vec3 cmy = 1.0 - color.rgb;\\\r\n            float k = min(cmy.x, min(cmy.y, cmy.z));\\\r\n            cmy = (cmy - k) / (1.0 - k);\\\r\n            cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(angle + 0.26179), pattern(angle + 1.30899), pattern(angle)), 0.0, 1.0);\\\r\n            k = clamp(k * 10.0 - 5.0 + pattern(angle + 0.78539), 0.0, 1.0);\\\r\n            gl_FragColor = vec4(1.0 - cmy - k, color.a);\\\r\n        }\\\r\n    ', 'colorHalftone');\r\n\r\n        simpleShader.call(this, gl.colorHalftone, {\r\n            center: [centerX, centerY],\r\n            angle: angle,\r\n            scale: Math.PI / size,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\dotscreen.script\r\n    /**\r\n     * @filter        Dot Screen\r\n     * @description   Simulates a black and white halftone rendering of the image by multiplying\r\n     *                pixel values with a rotated 2D sine wave pattern.\r\n     * @param centerX The x coordinate of the pattern origin.\r\n     * @param centerY The y coordinate of the pattern origin.\r\n     * @param angle   The rotation of the pattern in radians.\r\n     * @param size    The diameter of a dot in pixels.\r\n     */\r\n    function dotScreen(centerX, centerY, angle, size) {\r\n        gl.dotScreen = gl.dotScreen || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float angle;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        \\\r\n        float pattern() {\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec2 tex = texCoord * texSize - center;\\\r\n            vec2 point = vec2(\\\r\n                c * tex.x - s * tex.y,\\\r\n                s * tex.x + c * tex.y\\\r\n            ) * scale;\\\r\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\r\n        }\\\r\n        \\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\\\r\n        }\\\r\n    ', 'dotScreen');\r\n\r\n        simpleShader.call(this, gl.dotScreen, {\r\n            center: [centerX, centerY],\r\n            angle: angle,\r\n            scale: Math.PI / size,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\edgework.script\r\n    /**\r\n     * @filter       Edge Work\r\n     * @description  Picks out different frequencies in the image by subtracting two\r\n     *               copies of the image blurred with different radii.\r\n     * @param radius The radius of the effect in pixels.\r\n     */\r\n    function edgeWork(radius) {\r\n        gl.edgeWork1 = gl.edgeWork1 || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec2 color = vec2(0.0);\\\r\n            vec2 total = vec2(0.0);\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec3 sample = texture2D(texture, texCoord + delta * percent).rgb;\\\r\n                float average = (sample.r + sample.g + sample.b) / 3.0;\\\r\n                color.x += average * weight;\\\r\n                total.x += weight;\\\r\n                if (abs(t) < 15.0) {\\\r\n                    weight = weight * 2.0 - 1.0;\\\r\n                    color.y += average * weight;\\\r\n                    total.y += weight;\\\r\n                }\\\r\n            }\\\r\n            gl_FragColor = vec4(color / total, 0.0, 1.0);\\\r\n        }\\\r\n    ', 'edgeWork1');\r\n        gl.edgeWork2 = gl.edgeWork2 || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec2 color = vec2(0.0);\\\r\n            vec2 total = vec2(0.0);\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec2 sample = texture2D(texture, texCoord + delta * percent).xy;\\\r\n                color.x += sample.x * weight;\\\r\n                total.x += weight;\\\r\n                if (abs(t) < 15.0) {\\\r\n                    weight = weight * 2.0 - 1.0;\\\r\n                    color.y += sample.y * weight;\\\r\n                    total.y += weight;\\\r\n                }\\\r\n            }\\\r\n            float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);\\\r\n            gl_FragColor = vec4(c, c, c, 1.0);\\\r\n        }\\\r\n    ', 'edgeWork2');\r\n\r\n        simpleShader.call(this, gl.edgeWork1, {\r\n            delta: [radius / this.width, 0]\r\n        });\r\n        simpleShader.call(this, gl.edgeWork2, {\r\n            delta: [0, radius / this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\hexagonalpixelate.script\r\n    /**\r\n     * @filter        Hexagonal Pixelate\r\n     * @description   Renders the image using a pattern of hexagonal tiles. Tile colors\r\n     *                are nearest-neighbor sampled from the centers of the tiles.\r\n     * @param centerX The x coordinate of the pattern center.\r\n     * @param centerY The y coordinate of the pattern center.\r\n     * @param scale   The width of an individual tile, in pixels.\r\n     */\r\n    function hexagonalPixelate(centerX, centerY, scale) {\r\n        gl.hexagonalPixelate = gl.hexagonalPixelate || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec2 tex = (texCoord * texSize - center) / scale;\\\r\n            tex.y /= 0.866025404;\\\r\n            tex.x -= tex.y * 0.5;\\\r\n            \\\r\n            vec2 a;\\\r\n            if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) a = vec2(floor(tex.x), floor(tex.y));\\\r\n            else a = vec2(ceil(tex.x), ceil(tex.y));\\\r\n            vec2 b = vec2(ceil(tex.x), floor(tex.y));\\\r\n            vec2 c = vec2(floor(tex.x), ceil(tex.y));\\\r\n            \\\r\n            vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\\\r\n            vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\\\r\n            vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\\\r\n            vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\\\r\n            \\\r\n            float alen = length(TEX - A);\\\r\n            float blen = length(TEX - B);\\\r\n            float clen = length(TEX - C);\\\r\n            \\\r\n            vec2 choice;\\\r\n            if (alen < blen) {\\\r\n                if (alen < clen) choice = a;\\\r\n                else choice = c;\\\r\n            } else {\\\r\n                if (blen < clen) choice = b;\\\r\n                else choice = c;\\\r\n            }\\\r\n            \\\r\n            choice.x += choice.y * 0.5;\\\r\n            choice.y *= 0.866025404;\\\r\n            choice *= scale / texSize;\\\r\n            gl_FragColor = texture2D(texture, choice + center / texSize);\\\r\n        }\\\r\n    ', 'hexagonalPixelate');\r\n\r\n        simpleShader.call(this, gl.hexagonalPixelate, {\r\n            center: [centerX, centerY],\r\n            scale: scale,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\ink.script\r\n    /**\r\n     * @filter         Ink\r\n     * @description    Simulates outlining the image in ink by darkening edges stronger than a\r\n     *                 certain threshold. The edge detection value is the difference of two\r\n     *                 copies of the image, each blurred using a blur of a different radius.\r\n     * @param strength The multiplicative scale of the ink edges. Values in the range 0 to 1\r\n     *                 are usually sufficient, where 0 doesn't change the image and 1 adds lots\r\n     *                 of black edges. Negative strength values will create white ink edges\r\n     *                 instead of black ones.\r\n     */\r\n    function ink(strength) {\r\n        gl.ink = gl.ink || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec2 dx = vec2(1.0 / texSize.x, 0.0);\\\r\n            vec2 dy = vec2(0.0, 1.0 / texSize.y);\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float bigTotal = 0.0;\\\r\n            float smallTotal = 0.0;\\\r\n            vec3 bigAverage = vec3(0.0);\\\r\n            vec3 smallAverage = vec3(0.0);\\\r\n            for (float x = -2.0; x <= 2.0; x += 1.0) {\\\r\n                for (float y = -2.0; y <= 2.0; y += 1.0) {\\\r\n                    vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\\\r\n                    bigAverage += sample;\\\r\n                    bigTotal += 1.0;\\\r\n                    if (abs(x) + abs(y) < 2.0) {\\\r\n                        smallAverage += sample;\\\r\n                        smallTotal += 1.0;\\\r\n                    }\\\r\n                }\\\r\n            }\\\r\n            vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\\\r\n            gl_FragColor = vec4(color.rgb - dot(edge, edge) * strength * 100000.0, color.a);\\\r\n        }\\\r\n    ', 'ink');\r\n\r\n        simpleShader.call(this, gl.ink, {\r\n            strength: strength * strength * strength * strength * strength,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\warp\\bulgepinch.script\r\n    /**\r\n     * @filter         Bulge / Pinch\r\n     * @description    Bulges or pinches the image in a circle.\r\n     * @param centerX  The x coordinate of the center of the circle of effect.\r\n     * @param centerY  The y coordinate of the center of the circle of effect.\r\n     * @param radius   The radius of the circle of effect.\r\n     * @param strength -1 to 1 (-1 is strong pinch, 0 is no effect, 1 is strong bulge)\r\n     */\r\n    function bulgePinch(centerX, centerY, radius, strength) {\r\n        gl.bulgePinch = gl.bulgePinch || warpShader('\\\r\n        uniform float radius;\\\r\n        uniform float strength;\\\r\n        uniform vec2 center;\\\r\n    ', '\\\r\n        coord -= center;\\\r\n        float distance = length(coord);\\\r\n        if (distance < radius) {\\\r\n            float percent = distance / radius;\\\r\n            if (strength > 0.0) {\\\r\n                coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\\\r\n            } else {\\\r\n                coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\\\r\n            }\\\r\n        }\\\r\n        coord += center;\\\r\n    ');\r\n\r\n        simpleShader.call(this, gl.bulgePinch, {\r\n            radius: radius,\r\n            strength: clamp(-1, strength, 1),\r\n            center: [centerX, centerY],\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\warp\\matrixwarp.script\r\n    /**\r\n     * @filter                Matrix Warp\r\n     * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\r\n     *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\r\n     *                        3x3 matrix, where x and y are in units of pixels.\r\n     * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\r\n     *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\r\n     *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\r\n     * @param inverse         A boolean value that, when true, applies the inverse transformation\r\n     *                        instead. (optional, defaults to false)\r\n     * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\r\n     *                        instead of screen-space coordinates. Texture-space coordinates range\r\n     *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\r\n     *                        to use for simple operations like flipping and rotating.\r\n     */\r\n    function matrixWarp(matrix, inverse, useTextureSpace) {\r\n        gl.matrixWarp = gl.matrixWarp || warpShader('\\\r\n        uniform mat3 matrix;\\\r\n        uniform bool useTextureSpace;\\\r\n    ', '\\\r\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\r\n        vec3 warp = matrix * vec3(coord, 1.0);\\\r\n        coord = warp.xy / warp.z;\\\r\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\r\n    ');\r\n\r\n        // Flatten all members of matrix into one big list\r\n        matrix = Array.prototype.concat.apply([], matrix);\r\n\r\n        // Extract a 3x3 matrix out of the arguments\r\n        if (matrix.length == 4) {\r\n            matrix = [\r\n                matrix[0], matrix[1], 0,\r\n                matrix[2], matrix[3], 0,\r\n                0, 0, 1\r\n            ];\r\n        } else if (matrix.length != 9) {\r\n            throw 'can only warp with 2x2 or 3x3 matrix';\r\n        }\r\n\r\n        simpleShader.call(this, gl.matrixWarp, {\r\n            matrix: inverse ? getInverse(matrix) : matrix,\r\n            texSize: [this.width, this.height],\r\n            useTextureSpace: useTextureSpace | 0\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\warp\\perspective.script\r\n    /**\r\n     * @filter       Perspective\r\n     * @description  Warps one quadrangle to another with a perspective transform. This can be used to\r\n     *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\r\n     * @param before The x and y coordinates of four points before the transform in a flat list. This\r\n     *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\r\n     *               (cx, cy), and (dx, dy).\r\n     * @param after  The x and y coordinates of four points after the transform in a flat list, just\r\n     *               like the other argument.\r\n     */\r\n    function perspective(before, after) {\r\n        let a = getSquareToQuad.apply(null, after);\r\n        let b = getSquareToQuad.apply(null, before);\r\n        let c = multiply(getInverse(a), b);\r\n        return this.matrixWarp(c);\r\n    }\r\n\r\n// src/filters\\warp\\swirl.script\r\n    /**\r\n     * @filter        Swirl\r\n     * @description   Warps a circular region of the image in a swirl.\r\n     * @param centerX The x coordinate of the center of the circular region.\r\n     * @param centerY The y coordinate of the center of the circular region.\r\n     * @param radius  The radius of the circular region.\r\n     * @param angle   The angle in radians that the pixels in the center of\r\n     *                the circular region will be rotated by.\r\n     */\r\n    function swirl(centerX, centerY, radius, angle) {\r\n        gl.swirl = gl.swirl || warpShader('\\\r\n        uniform float radius;\\\r\n        uniform float angle;\\\r\n        uniform vec2 center;\\\r\n    ', '\\\r\n        coord -= center;\\\r\n        float distance = length(coord);\\\r\n        if (distance < radius) {\\\r\n            float percent = (radius - distance) / radius;\\\r\n            float theta = percent * percent * angle;\\\r\n            float s = sin(theta);\\\r\n            float c = cos(theta);\\\r\n            coord = vec2(\\\r\n                coord.x * c - coord.y * s,\\\r\n                coord.x * s + coord.y * c\\\r\n            );\\\r\n        }\\\r\n        coord += center;\\\r\n    ');\r\n\r\n        simpleShader.call(this, gl.swirl, {\r\n            radius: radius,\r\n            center: [centerX, centerY],\r\n            angle: angle,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @filter        Invert\r\n     * @description   Inverts color of each pixel\r\n     */\r\n    function invert() {\r\n        gl.invert = gl.invert || new Shader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        color.rgb = 1.0 - color.rgb;\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'invert');\r\n\r\n        simpleShader.call(this, gl.invert, {\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @filter        multiplyAlpha\r\n     * @description   applies alpha multiply\r\n     */\r\n    function multiplyAlpha() {\r\n        gl.multiplyAlpha = gl.multiplyAlpha || new Shader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        color.rgb *= color.a;\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'multiplyAlpha');\r\n\r\n        simpleShader.call(this, gl.multiplyAlpha, {\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @filter        unmultiplyAlpha\r\n     * @description   reverses alpha multiply\r\n     */\r\n    function unmultiplyAlpha() {\r\n        gl.unmultiplyAlpha = gl.unmultiplyAlpha || new Shader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        if(color.a > 0.0) {\\\r\n            color.rgb /= color.a;\\\r\n        }\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'unmultiplyAlpha');\r\n\r\n        simpleShader.call(this, gl.unmultiplyAlpha, {\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @filter        To Alpha\r\n     * @description   Generates alpha channel from luminance (r+g+b)\r\n     * @param isInverted    boolean - invert luminance\r\n     * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\r\n     */\r\n    function toAlpha(isInverted, replaceRGBA) {\r\n        gl.toAlpha = gl.toAlpha || new Shader(null, '\\\r\n    uniform bool isInverted;\\\r\n    uniform vec4 replace;\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\r\n        if (isInverted) alpha = 1.0 - alpha;\\\r\n        alpha = min(color.a, alpha);\\\r\n        if (replace.a > 0.0) color = replace;\\\r\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\r\n    }\\\r\n', 'toAlpha');\r\n\r\n        simpleShader.call(this, gl.toAlpha, {\r\n            isInverted: isInverted ? 1 : 0,\r\n            replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0, 0, 0, 0],\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @filter        Distort\r\n     * @description   Distorts image (moves pixels around)\r\n     */\r\n    function distort(settings: {\r\n        stepSize: number; // [1, inf]\r\n        distortType: 0 | 1 | 2;\r\n        scale: { x: number; y: number };\r\n        strength: { x: number; y: number };\r\n        phase: { x: number; y: number };\r\n    }) {\r\n        gl.distort = gl.distort || warpShader('\\\r\n        uniform float stepSize;\\\r\n        uniform vec2 scale;\\\r\n        uniform vec2 strength;\\\r\n        uniform vec2 phase;\\\r\n        uniform float type;\\\r\n        ', '\\\r\n        const float PI = 3.14159265;\\\r\n        float x = coord.x;\\\r\n        float y = coord.y;\\\r\n        if (stepSize > 1.0) {\\\r\n            x = floor(x / stepSize) * stepSize;\\\r\n            y = floor(y / stepSize) * stepSize;\\\r\n        }\\\r\n        float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;\\\r\n        float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;\\\r\n        if (type == 0.0) {\\\r\n            coord.y += distortX;\\\r\n            coord.x += distortY;\\\r\n        } else if (type == 1.0) {\\\r\n            coord.x += distortX;\\\r\n            coord.y += distortY;\\\r\n        } else if (type == 2.0) {\\\r\n            gl_FragColor = texture2D(texture, vec2(x, y) / texSize);\\\r\n            coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;\\\r\n            coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;\\\r\n        }\\\r\n        coord.x = mod(coord.x, texSize.x);\\\r\n        coord.y = mod(coord.y, texSize.y);\\\r\n        \\\r\n        ');\r\n\r\n        simpleShader.call(this, gl.distort, {\r\n            stepSize: settings.stepSize,\r\n            type: settings.distortType,\r\n            scale: [settings.scale.x, settings.scale.y],\r\n            strength: [settings.strength.x, settings.strength.y],\r\n            phase: [settings.phase.x, settings.phase.y],\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    return exports;\r\n})();\r\n","uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nuniform vec2 texSize;\r\n\r\nuniform float seed;\r\nuniform float type;\r\nuniform vec2 scale;\r\nuniform vec2 offset;\r\nuniform float octaves;\r\nuniform float samples;\r\n\r\nuniform float peaks;\r\nuniform float contrast;\r\nuniform float brightness;\r\nuniform float isReversed;\r\n\r\nuniform vec3 colA;\r\nuniform vec3 colB;\r\n\r\nuniform float channels; // 0 - rgb, 1 - alpha\r\n\r\n// fbm, cellular_noise based on\r\n// https://github.com/Gonkee/Gonkees-Shaders\r\n// MIT, Copyright © Gonkee\r\n\r\n// hash & simplex based on\r\n// https://www.shadertoy.com/view/Msf3WH\r\n// MIT, Copyright © 2013 Inigo Quilez\r\n// https://www.youtube.com/c/InigoQuilez\r\n// https://iquilezles.org\r\n\r\n\r\n\r\nfloat rand(vec2 co) {\r\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\r\n}\r\n\r\nfloat value_noise(vec2 coord){\r\n    return rand(floor(coord) / 100.0);\r\n}\r\n\r\nfloat cellular_noise(vec2 coord) {\r\n    vec2 i = floor(coord);\r\n    vec2 f = fract(coord);\r\n\r\n    float min_dist = 99999.0;\r\n    for (float x = -1.0; x <= 1.0; x++) {\r\n        for (float y = -1.0; y <= 1.0; y++) {\r\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\r\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\r\n            min_dist = min(min_dist, dist);\r\n        }\r\n    }\r\n    return min_dist;\r\n}\r\n\r\n// ---------- Simplex Alternative _--------------------\r\n\r\nvec3 hash(vec3 p)\r\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\r\n, dot(p, vec3(269.5, 183.3, 246.1))\r\n, dot(p, vec3(113.5, 271.9, 124.6)))\r\n;return fract(sin(p)*43758.5453123)*2.-1.; }\r\n\r\nmat3 hash(mat3 p)\r\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\r\n\r\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\r\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\r\n\r\n//return noiseGra13dx as .x, and its derivatives as .yzw\r\n// https://www.shadertoy.com/view/llByD1\r\nvec3 noiseGra13dx(in vec3 x) {\r\n    vec3 p=floor(x), w=fract(x)\r\n    #if 1\r\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\r\n    #else\r\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\r\n    #endif\r\n    //gradients\r\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\r\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\r\n    //projections\r\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\r\n    //interpolations\r\n    float g=dot(G, w), f=dot(F, w-vec3(1));\r\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\r\n    mat3 S=D-mat3(G, G, G), W=D-E;\r\n    a.x=(a.x+a.y+a.z)+f-g;\r\n    ;float b=u.x*u.y*u.z;\r\n\r\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\r\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\r\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\r\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\r\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\r\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\r\n    return 0.5 + 0.5 * result.xxx;\r\n}\r\n\r\nfloat fbm(vec2 coord) {\r\n    float normalize_factor = 0.0;\r\n    float value = 0.0;\r\n    float scale = 0.5;\r\n\r\n    for (float i = 0.0; i < 7.0; i++){\r\n        if (i < octaves) {\r\n            if (type == 0.0) {\r\n                value += value_noise(coord) * scale;\r\n            } else if (type == 1.0) {\r\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\r\n            } else if (type == 2.0) {\r\n                value += cellular_noise(coord) * scale;\r\n            }\r\n            normalize_factor += scale;\r\n            coord *= 2.0;\r\n            scale *= 0.5;\r\n        }\r\n    }\r\n    return value / normalize_factor;\r\n}\r\n\r\nfloat render (vec2 pos) {\r\n    float result = fbm(pos);\r\n    //\r\n\r\n    if (peaks > 0.0) {\r\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\r\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\r\n    }\r\n\r\n    result += brightness;\r\n    if (contrast > 0.0) {\r\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\r\n    } else if (contrast < 0.0) {\r\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\r\n    }\r\n\r\n    if (isReversed == 1.0) {\r\n        result = 1.0 - result;\r\n    }\r\n    return result;\r\n}\r\n\r\n\r\nvoid main() {\r\n    vec4 color;\r\n\r\n    vec2 seedOffset;\r\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\r\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\r\n\r\n    float val = 0.0;\r\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\r\n\r\n    if (samples == 1.0) {\r\n        val = render(basePos);\r\n\r\n    }/* else if (samples == 4.0) {\r\n        for (float i = 0.0; i < 2.0; i++) {\r\n            for (float e = 0.0; e < 2.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\r\n            }\r\n        }\r\n        val /= 4.0;\r\n\r\n    }*/ else if (samples == 16.0) {\r\n        for (float i = 0.0; i < 4.0; i++) {\r\n            for (float e = 0.0; e < 4.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\r\n            }\r\n        }\r\n        val /= 16.0;\r\n    }\r\n\r\n    if (channels == 0.0) {\r\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\r\n    } else {\r\n        gl_FragColor = vec4(vec3(1.0), val);\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {input} from '../ui/base-components/input';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {Cropper} from '../ui/components/cropper';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterCropExtend = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas)\r\n            return false;\r\n        const tempCanvas = BB.canvas();\r\n        {\r\n            let fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 560, 400, 1);\r\n            let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n            let previewFactor = w / klCanvas.getWidth();\r\n            tempCanvas.width = w;\r\n            tempCanvas.height = h;\r\n            tempCanvas.style.display = 'block';\r\n            tempCanvas.getContext(\"2d\").drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n        }\r\n\r\n        const div = document.createElement(\"div\");\r\n        const result: any = {\r\n            element: div\r\n        };\r\n        div.innerHTML = LANG('filter-crop-description') + \"<br/><br/>\";\r\n        let left = 0, right = 0, top = 0, bottom = 0;\r\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\r\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n        let scale;\r\n\r\n\r\n\r\n        // --- input elements ---\r\n\r\n        const lrWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'}\r\n        });\r\n        const tbWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'}\r\n        });\r\n        div.appendChild(lrWrapper);\r\n        div.appendChild(tbWrapper);\r\n\r\n        const leftInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                leftChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const rightInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px'},\r\n            callback: function(v) {\r\n                rightChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const topInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                topChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const bottomInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px'},\r\n            callback: function(v) {\r\n                bottomChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            width: '60px'\r\n        };\r\n        lrWrapper.append(\r\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\r\n            leftInput,\r\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\r\n            rightInput\r\n        );\r\n        tbWrapper.append(\r\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\r\n            topInput,\r\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\r\n            bottomInput\r\n        );\r\n\r\n        function updateInput() {\r\n            left = parseInt(leftInput.value);\r\n            right = parseInt(rightInput.value);\r\n            top = parseInt(topInput.value);\r\n            bottom = parseInt(bottomInput.value);\r\n            let newWidth = klCanvas.getWidth() + left + right;\r\n            let newHeight = klCanvas.getHeight() + top + bottom;\r\n\r\n            if (newWidth <= 0) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + 1;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + 1;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = 1;\r\n            }\r\n            if (newWidth > maxWidth) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + maxWidth;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + maxWidth;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = maxWidth;\r\n            }\r\n            if (newHeight <= 0) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + 1;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + 1;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = 1;\r\n            }\r\n            if (newHeight > maxHeight) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + maxHeight;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + maxHeight;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = maxHeight;\r\n            }\r\n            cropper.setTransform({\r\n                x: -left,\r\n                y: -top,\r\n                width: newWidth,\r\n                height: newHeight\r\n            });\r\n\r\n\r\n            leftChanged = false;\r\n            rightChanged = false;\r\n            topChanged = false;\r\n            bottomChanged = false;\r\n        }\r\n\r\n        let useRuleOfThirds = true;\r\n        let ruleOThirdsCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-crop-rule-thirds'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                useRuleOfThirds = b;\r\n                cropper.showThirds(useRuleOfThirds);\r\n            }\r\n        });\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both'\r\n            }\r\n        }));\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 0},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n            {r: 0, g: 0, b: 0, a: 1}\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('filter-crop-fill'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function(rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                updateBg(rgbaObj);\r\n            }\r\n        });\r\n\r\n\r\n        const flexRow = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between'\r\n            }\r\n        });\r\n        div.appendChild(flexRow);\r\n        flexRow.appendChild(ruleOThirdsCheckbox.getElement());\r\n        flexRow.appendChild(colorOptions.getElement());\r\n\r\n\r\n        // when input field changed, or dragging in preview finished\r\n        // adjusts the zoom\r\n        function update(transform) {\r\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\r\n            scale = fit.width / transform.width;\r\n\r\n            const offset = BB.centerWithin(340, 220, fit.width, fit.height);\r\n\r\n            tempCanvas.style.width = klCanvas.getWidth() * scale + \"px\";\r\n            tempCanvas.style.height = klCanvas.getHeight() * scale + \"px\";\r\n\r\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + \"px\";\r\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + \"px\";\r\n\r\n            left = parseInt('' + -transform.x);\r\n            top = parseInt('' + -transform.y);\r\n            right = parseInt('' + (transform.x + transform.width - klCanvas.getWidth()));\r\n            bottom = parseInt('' + (transform.y + transform.height - klCanvas.getHeight()));\r\n            leftInput.value = '' + left;\r\n            topInput.value = '' + top;\r\n            rightInput.value = '' + right;\r\n            bottomInput.value = '' + bottom;\r\n\r\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                previewWrapper.style.background = \"url(\" + url + \")\";\r\n                if (selectedRgbaObj.a !== 0) {\r\n                    tempCanvas.style.background = \"url(\" + url + \")\";\r\n                }\r\n            });\r\n            previewWrapper.style.backgroundPosition = (offset.x) + \"px \" + (offset.y) + \"px\";\r\n\r\n            cropper.setScale(scale);\r\n        }\r\n\r\n        const previewWrapper = BB.el({\r\n            css: {\r\n                width: \"340px\",\r\n                marginTop: '10px',\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                position: \"relative\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                userSelect: 'none',\r\n                colorScheme: 'only light',\r\n                touchAction: 'none',\r\n            }\r\n        });\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        const bgColorOverlay = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0'\r\n            }\r\n        });\r\n        previewWrapper.appendChild(bgColorOverlay);\r\n\r\n        const offsetWrapper = document.createElement(\"div\");\r\n        offsetWrapper.style.position = \"absolute\";\r\n        offsetWrapper.style.left = \"0px\";\r\n        offsetWrapper.style.top = \"0px\";\r\n        previewWrapper.appendChild(offsetWrapper);\r\n\r\n\r\n        const canvasWrapper = BB.appendTextDiv(offsetWrapper, \"\");\r\n        canvasWrapper.appendChild(tempCanvas);\r\n        //tempCanvas.style.width = w + \"px\";\r\n        //tempCanvas.style.height = h + \"px\";\r\n        tempCanvas.style.boxShadow = \"0 0 3px 1px rgba(0,0,0,0.5)\";\r\n        tempCanvas.style.position = \"absolute\";\r\n        tempCanvas.style.left = \"0px\";\r\n        tempCanvas.style.top = \"0px\";\r\n\r\n        div.appendChild(previewWrapper);\r\n        const cropper = new Cropper({\r\n            x: 0,\r\n            y: 0,\r\n            width: klCanvas.getWidth(),\r\n            height: klCanvas.getHeight(),\r\n            scale: scale,\r\n            callback: update,\r\n            maxW: maxWidth,\r\n            maxH: maxHeight\r\n        });\r\n        update(cropper.getTransform());\r\n        offsetWrapper.appendChild(cropper.getElement());\r\n\r\n        function updateBg(rgbaObj) {\r\n\r\n            let borderColor;\r\n            if (rgbaObj.a === 0) {\r\n                borderColor = 'rgba(0,0,0,0.5)';\r\n                bgColorOverlay.style.background = '';\r\n                tempCanvas.style.background = '';\r\n            } else {\r\n                borderColor = (rgbaObj.r + rgbaObj.g + rgbaObj.b < 255 * 3 / 2) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\r\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(rgbaObj);\r\n\r\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                    tempCanvas.style.background = \"url(\" + url + \")\";\r\n                });\r\n            }\r\n            tempCanvas.style.boxShadow = \"0 0 3px 1px \" + borderColor;\r\n        }\r\n\r\n        result.destroy = () => {\r\n            cropper.destroy();\r\n            ruleOThirdsCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                left: left,\r\n                right: right,\r\n                top: top,\r\n                bottom: bottom,\r\n                fillColor: selectedRgbaObj.a === 0 ? null : selectedRgbaObj\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!klCanvas || !history || isNaN(params.input.left) || isNaN(params.input.right) || isNaN(params.input.top) || isNaN(params.input.bottom)) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resizeCanvas(params.input);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"cropExtend\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: JSON.parse(JSON.stringify(params.input))\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterCurves = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div,\r\n        };\r\n        let klCanvasPreview;\r\n\r\n        function finishInit() {\r\n\r\n            let previewFactor = w / context.canvas.width;\r\n            let brightness = 0, contrast = 0;\r\n\r\n            div.innerHTML = LANG('filter-curves-description') + \"<br/><br/>\";\r\n\r\n            let curves = {\r\n                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n            };\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n                    if (klCanvasPreview) {\r\n                        klCanvasPreview.render();\r\n                    }\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            let modeButtons;\r\n\r\n            function CurvesInput(p) {\r\n                let div = document.createElement(\"div\");\r\n                div.oncontextmenu = function () {\r\n                    return false;\r\n                };\r\n                div.style.position = \"relative\";\r\n                div.style.marginBottom = \"10px\";\r\n                let mode = \"All\";\r\n                let curves = p.curves;\r\n                modeButtons = new Options( {\r\n                    optionArr: [\r\n                        {\r\n                            id: 'All',\r\n                            label: LANG('filter-curves-all')\r\n                        },\r\n                        {\r\n                            id: 'Red',\r\n                            label: LANG('red')\r\n                        },\r\n                        {\r\n                            id: 'Green',\r\n                            label: LANG('green')\r\n                        },\r\n                        {\r\n                            id: 'Blue',\r\n                            label: LANG('blue')\r\n                        },\r\n                    ],\r\n                    initialId: 'All',\r\n                    onChange: function(id) {\r\n                        mode = id;\r\n                        if (mode === \"All\") {\r\n                            curves = {\r\n                                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                            };\r\n                        }\r\n                        let curve = curves.r;\r\n                        if (mode === \"Green\") {\r\n                            curve = curves.g;\r\n                        }\r\n                        if (mode === \"Blue\") {\r\n                            curve = curves.b;\r\n                        }\r\n                        (p0 as any).setPos(0, areah - curve[0][1] * areah);\r\n                        (p1 as any).setPos(curve[1][0] * areaw, areah - curve[1][1] * areah);\r\n                        (p2 as any).setPos(curve[2][0] * areaw, areah - curve[2][1] * areah);\r\n                        (p3 as any).setPos(areaw, areah - curve[3][1] * areah);\r\n\r\n                        update();\r\n                    }\r\n                });\r\n                div.appendChild(modeButtons.getElement());\r\n\r\n                let curveArea = document.createElement(\"div\");\r\n                BB.css(curveArea, {\r\n                    position: 'relative',\r\n                    marginTop: '10px',\r\n                    colorScheme: 'only light',\r\n                })\r\n                div.appendChild(curveArea);\r\n\r\n                let areaw = 300, areah = 100;\r\n                let canvas = BB.canvas(areaw, areah);\r\n                BB.css(canvas, {\r\n                    background: \"#c6c6c6\",\r\n                    boxShadow: \"0 0 0 1px rgba(0,0,0,0.3)\"\r\n                });\r\n                let ctx = canvas.getContext(\"2d\");\r\n                curveArea.appendChild(canvas);\r\n\r\n                let points = {\r\n                    r: [],\r\n                    g: [],\r\n                    b: []\r\n                };\r\n\r\n                function fit(v) {\r\n                    return Math.max(0, Math.min(1, v));\r\n                }\r\n\r\n                function createPoint(x, y, callback, lock?) {\r\n                    let gripSize = 14;\r\n                    let internalY = y, internalX = x;\r\n                    let point = document.createElement(\"div\");\r\n                    BB.css(point, {\r\n                        position: \"absolute\",\r\n                        left: (x - gripSize / 2) + \"px\",\r\n                        top: (y - gripSize / 2) + \"px\",\r\n                        width: gripSize + \"px\",\r\n                        height: gripSize + \"px\",\r\n                        background: \"#fff\",\r\n                        cursor: \"move\",\r\n                        borderRadius: gripSize + \"px\",\r\n                        boxShadow: \"inset 0 0 0 2px #000\",\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    });\r\n\r\n                    function update() {\r\n                        BB.css(point, {\r\n                            left: (x - gripSize / 2) + \"px\",\r\n                            top: (y - gripSize / 2) + \"px\"\r\n                        });\r\n                    }\r\n\r\n                    (point as any).pointerListener = new BB.PointerListener({\r\n                        target: point,\r\n                        maxPointers: 1,\r\n                        onPointer: function(event) {\r\n                            event.eventPreventDefault();\r\n                            if (event.type === 'pointerdown') {\r\n                                internalX = x;\r\n                                internalY = y;\r\n                            }\r\n                            if (event.button === 'left' && event.type === 'pointermove') {\r\n                                if (!lock) {\r\n                                    internalX += event.dX;\r\n                                }\r\n                                x = Math.max(0, Math.min(areaw, internalX));\r\n                                internalY += event.dY;\r\n                                y = Math.max(0, Math.min(areah, internalY));\r\n                                update();\r\n                                callback({\r\n                                    x: x,\r\n                                    y: y\r\n                                });\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    curveArea.appendChild(point);\r\n\r\n                    (point as any).setPos = function (newX, newY) {\r\n                        x = newX;\r\n                        y = newY;\r\n                        internalY = y;\r\n                        internalX = x;\r\n                        BB.css(point, {\r\n                            left: (x - gripSize / 2) + \"px\",\r\n                            top: (y - gripSize / 2) + \"px\"\r\n                        });\r\n                    };\r\n\r\n                    return point;\r\n                }\r\n\r\n                function updateControl(i, x, y) {\r\n                    if (mode === \"All\") {\r\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Red\") {\r\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Green\") {\r\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Blue\") {\r\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                }\r\n\r\n                let p0 = createPoint(0, areah, function (val) {\r\n                    updateControl(0, val.x, val.y);\r\n                    update();\r\n                }, true);\r\n                let p1 = createPoint(areaw / 3, areah / 3 * 2, function (val) {\r\n                    updateControl(1, val.x, val.y);\r\n                    update();\r\n                });\r\n                let p2 = createPoint(areaw / 3 * 2, areah / 3, function (val) {\r\n                    updateControl(2, val.x, val.y);\r\n                    update();\r\n                });\r\n                let p3 = createPoint(areaw, 0, function (val) {\r\n                    updateControl(3, val.x, val.y);\r\n                    update();\r\n                }, true);\r\n\r\n\r\n                function update() {\r\n                    canvas.width = canvas.width;\r\n                    ctx = canvas.getContext(\"2d\");\r\n\r\n                    let outCurves = {\r\n                        r: [],\r\n                        g: [],\r\n                        b: []\r\n                    };\r\n                    for (let i = 0; i < curves.r.length; i++) {\r\n                        outCurves.r.push(curves.r[i]);\r\n                        outCurves.g.push(curves.g[i]);\r\n                        outCurves.b.push(curves.b[i]);\r\n                    }\r\n\r\n                    function drawCurve(curve) {\r\n                        ctx.beginPath();\r\n                        let spline = new BB.SplineInterpolator(curve);\r\n                        for (let i = 0; i < 100; i++) {\r\n                            let y = spline.interpolate(i / 100);\r\n                            y = Math.max(0, Math.min(1, y));\r\n\r\n                            if (i === 0) {\r\n                                ctx.moveTo(i / 100 * areaw, areah - y * areah);\r\n                            } else {\r\n                                ctx.lineTo(i / 100 * areaw, areah - y * areah);\r\n                            }\r\n                        }\r\n                        ctx.stroke();\r\n                    }\r\n\r\n                    ctx.save();\r\n                    if (mode === \"All\") {\r\n                        ctx.strokeStyle = \"black\";\r\n                        drawCurve(outCurves.r);\r\n                    } else {\r\n                        ctx.globalAlpha = 0.5;\r\n                        ctx.strokeStyle = \"red\";\r\n                        drawCurve(outCurves.r);\r\n                        ctx.strokeStyle = \"green\";\r\n                        drawCurve(outCurves.g);\r\n                        ctx.strokeStyle = \"blue\";\r\n                        drawCurve(outCurves.b);\r\n                    }\r\n                    ctx.restore();\r\n                    p.callback(outCurves);\r\n                }\r\n\r\n                update();\r\n\r\n\r\n                this.getDiv = function () {\r\n                    return div;\r\n                };\r\n                this.destroy = function() {\r\n                    (p0 as any).pointerListener.destroy();\r\n                    (p1 as any).pointerListener.destroy();\r\n                    (p2 as any).pointerListener.destroy();\r\n                    (p3 as any).pointerListener.destroy();\r\n                };\r\n            }\r\n\r\n            let input = new CurvesInput({\r\n                curves: curves,\r\n                callback: function (val) {\r\n                    curves = val;\r\n                    update();\r\n                }\r\n            });\r\n\r\n\r\n            div.appendChild(input.getDiv());\r\n\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            result.destroy = () => {\r\n                input.destroy();\r\n                texture.destroy();\r\n                modeButtons.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    curves: curves\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let curves = params.input.curves;\r\n        let history = params.history;\r\n        if (!context || curves === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"curves\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterFlip = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let isHorizontal = true;\r\n        let isVertical = false;\r\n        let doFlipCanvas = true;\r\n        div.innerHTML = LANG('filter-flip-description') + \"<br/><br/>\";\r\n\r\n\r\n        let horizontalCheckbox = new Checkbox({\r\n            init: isHorizontal,\r\n            label: LANG('filter-flip-horizontal') + ' ⟷',\r\n            allowTab: true,\r\n            callback: function(v) {\r\n                isHorizontal = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n        let verticalCheckbox = new Checkbox({\r\n            init: isVertical,\r\n            label: LANG('filter-flip-vertical') + ' ↕',\r\n            allowTab: true,\r\n            callback: function(v) {\r\n                isVertical = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n        div.appendChild(horizontalCheckbox.getElement());\r\n        div.appendChild(verticalCheckbox.getElement());\r\n\r\n\r\n\r\n\r\n\r\n        let fcOption = document.createElement(\"div\");\r\n        BB.setEventListener(fcOption, 'onpointerdown', function () {\r\n            return false;\r\n        });\r\n        fcOption.textContent = LANG('filter-flip-image');\r\n        fcOption.style.width = \"150px\";\r\n        fcOption.style.height = \"30px\";\r\n        fcOption.style.paddingTop = \"10px\";\r\n        fcOption.style.textAlign = \"center\";\r\n        fcOption.style.cssFloat = \"left\";\r\n        fcOption.style.paddingBottom = \"0px\";\r\n        fcOption.style.borderTopLeftRadius = \"10px\";\r\n        fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n        fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n        fcOption.style.backgroundSize = '8%';\r\n        fcOption.style.backgroundColor = \"#9e9e9e\";\r\n\r\n        let flOption = document.createElement(\"div\");\r\n        BB.setEventListener(flOption, 'onpointerdown', function () {\r\n            return false;\r\n        });\r\n        flOption.textContent = LANG('filter-flip-layer');\r\n        flOption.style.width = \"150px\";\r\n        flOption.style.height = \"30px\";\r\n        flOption.style.paddingTop = \"10px\";\r\n        flOption.style.textAlign = \"center\";\r\n        flOption.style.cssFloat = \"left\";\r\n        flOption.style.paddingBottom = \"0px\";\r\n        flOption.style.borderTopRightRadius = \"10px\";\r\n        flOption.style.cursor = \"pointer\";\r\n        flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        flOption.style.backgroundSize = '8%';\r\n\r\n        BB.setEventListener(fcOption, 'onpointerover', function () {\r\n            if (doFlipCanvas === false)\r\n                fcOption.style.backgroundColor = \"#ccc\";\r\n        });\r\n        BB.setEventListener(fcOption, 'onpointerout', function () {\r\n            if (doFlipCanvas === false)\r\n                fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        });\r\n        BB.setEventListener(flOption, 'onpointerover', function () {\r\n            if (doFlipCanvas === true)\r\n                flOption.style.backgroundColor = \"#ccc\";\r\n        });\r\n        BB.setEventListener(flOption, 'onpointerout', function () {\r\n            if (doFlipCanvas === true)\r\n                flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        });\r\n\r\n        fcOption.onclick = function () {\r\n            doFlipCanvas = true;\r\n\r\n            flOption.style.background = \"\";\r\n            flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            flOption.style.boxShadow = \"\";\r\n            flOption.style.cursor = \"pointer\";\r\n\r\n            fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            fcOption.style.backgroundSize = '8%';\r\n            fcOption.style.backgroundColor = \"#9e9e9e\";\r\n            fcOption.style.cursor = \"default\";\r\n            fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n\r\n            updatePreview();\r\n        };\r\n        flOption.onclick = function () {\r\n            doFlipCanvas = false;\r\n\r\n            fcOption.style.background = \"\";\r\n            fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            fcOption.style.boxShadow = \"\";\r\n            fcOption.style.cursor = \"pointer\";\r\n\r\n            flOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            flOption.style.backgroundSize = '8%';\r\n            flOption.style.backgroundColor = \"#9e9e9e\";\r\n            flOption.style.cursor = \"default\";\r\n            flOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n\r\n            updatePreview();\r\n        };\r\n\r\n        let optionWrapper = document.createElement(\"div\");\r\n        optionWrapper.appendChild(fcOption);\r\n        optionWrapper.appendChild(flOption);\r\n        div.appendChild(optionWrapper);\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(Math.round(w), Math.round(h)),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over' as IMixMode,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: [previewLayer]\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\r\n\r\n            if (doFlipCanvas) {\r\n                if (isHorizontal) {\r\n                    ctx.translate(previewLayer.image.width, 0);\r\n                    ctx.scale(-1, 1);\r\n                }\r\n                if (isVertical) {\r\n                    ctx.translate(0, previewLayer.image.height);\r\n                    ctx.scale(1, -1);\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < layers.length; i++) {\r\n                ctx.save();\r\n                if (!doFlipCanvas && selectedLayerIndex === i) {\r\n                    if (isHorizontal) {\r\n                        ctx.translate(previewLayer.image.width, 0);\r\n                        ctx.scale(-1, 1);\r\n                    }\r\n                    if (isVertical) {\r\n                        ctx.translate(0, previewLayer.image.height);\r\n                        ctx.scale(1, -1);\r\n                    }\r\n                }\r\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.globalAlpha = layers[i].opacity;\r\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\r\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\r\n                ctx.restore();\r\n            }\r\n            klCanvasPreview.render();\r\n            ctx.restore();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            horizontalCheckbox.destroy();\r\n            verticalCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                horizontal: isHorizontal,\r\n                vertical: isVertical,\r\n                flipCanvas: doFlipCanvas\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        let horizontal = params.input.horizontal;\r\n        let vertical = params.input.vertical;\r\n        let flipCanvas = params.input.flipCanvas;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        klCanvas.flip(horizontal, vertical, flipCanvas ? null : klCanvas.getLayerIndex(context.canvas));\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"filter\", \"flip\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eFiVD\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterHueSaturation = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height,280, 200,  1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let hue = 0, saturation = 0;\r\n            div.innerHTML = LANG('filter-hue-sat-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let hueSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-hue'),\r\n                width: 300,\r\n                height: 30,\r\n                min: -100,\r\n                max: 100,\r\n                value: hue * 100,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    hue = val / 100;\r\n                    glCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            let saturationSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-saturation'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (saturation + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    saturation = val / 50 - 1;\r\n                    glCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            hueSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(hueSlider.getElement());\r\n            div.appendChild(saturationSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                hueSlider.destroy();\r\n                saturationSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    hue: hue,\r\n                    Saturation: saturation\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let hue = params.input.hue;\r\n        let history = params.history;\r\n        let Saturation = params.input.Saturation;\r\n        if (!context || hue === null || Saturation === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"hueSaturation\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply} from '../kl.types';\r\n\r\nexport const filterInvert = {\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false;\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).invert().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"invert\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {TwoTabs} from '../ui/components/two-tabs';\r\n\r\nexport const filterPerspective = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = window.innerWidth < 550;\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n\r\n        let pointerListenerArr = [];\r\n\r\n        function finishInit() {\r\n            div.innerHTML = LANG('filter-perspective-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            let ba, bb, bc, bd; //before\r\n            let aa, ab, ac, ad; //after\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).multiplyAlpha().perspective(\r\n                        [ba.x, ba.y, bb.x, bb.y, bc.x, bc.y, bd.x, bd.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        }),\r\n                        [aa.x, aa.y, ab.x, ab.y, ac.x, ac.y, ad.x, ad.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        })\r\n                    ).unmultiplyAlpha().update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob(x, y, callback?) {\r\n                let nobSize = 14;\r\n                let div = document.createElement(\"div\");\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                BB.css(div, {\r\n                    width: nobSize + \"px\",\r\n                    height: nobSize + \"px\",\r\n                    backgroundColor: \"#fff\",\r\n                    boxShadow: \"inset 0 0 0 2px #000\",\r\n                    borderRadius: nobSize + \"px\",\r\n                    position: \"absolute\",\r\n                    cursor: \"move\",\r\n                    left: ((div as any).x - nobSize / 2) + \"px\",\r\n                    top: ((div as any).y - nobSize / 2) + \"px\",\r\n                    userSelect: 'none',\r\n                    touchAction: 'none',\r\n                });\r\n\r\n                let pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    maxPointers: 1,\r\n                    onPointer: function(event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                            if (callback) {\r\n                                callback();\r\n                            }\r\n                            update();\r\n                        }\r\n                    }\r\n                });\r\n                (div as any).copy = function (p) {\r\n                    (div as any).x = p.x;\r\n                    (div as any).y = p.y;\r\n                    div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                    div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                };\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            function updateAfter() {\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            }\r\n\r\n            ba = nob(0, 0, updateAfter);\r\n            bb = nob(displayW, 0, updateAfter);\r\n            bc = nob(displayW, displayH, updateAfter);\r\n            bd = nob(0, displayH, updateAfter);\r\n            aa = nob(0, 0);\r\n            ab = nob(displayW, 0);\r\n            ac = nob(displayW, displayH);\r\n            ad = nob(0, displayH);\r\n\r\n            let before = false;\r\n\r\n            const beforeAfterTabs = new TwoTabs({\r\n                left: LANG('compare-before'),\r\n                right: LANG('compare-after'),\r\n                init: 1,\r\n                onChange: (val: number) => {\r\n                    before = val === 0;\r\n                    if (before) {\r\n                        aa.style.display = \"none\";\r\n                        ab.style.display = \"none\";\r\n                        ac.style.display = \"none\";\r\n                        ad.style.display = \"none\";\r\n\r\n                        ba.style.display = \"block\";\r\n                        bb.style.display = \"block\";\r\n                        bc.style.display = \"block\";\r\n                        bd.style.display = \"block\";\r\n                        ba.copy(aa);\r\n                        bb.copy(ab);\r\n                        bc.copy(ac);\r\n                        bd.copy(ad);\r\n                    } else {\r\n                        ba.style.display = \"none\";\r\n                        bb.style.display = \"none\";\r\n                        bc.style.display = \"none\";\r\n                        bd.style.display = \"none\";\r\n\r\n                        aa.style.display = \"block\";\r\n                        ab.style.display = \"block\";\r\n                        ac.style.display = \"block\";\r\n                        ad.style.display = \"block\";\r\n                        aa.copy(ba);\r\n                        ab.copy(bb);\r\n                        ac.copy(bc);\r\n                        ad.copy(bd);\r\n                    }\r\n                    update();\r\n                },\r\n            });\r\n            div.append(beforeAfterTabs.getElement());\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n            BB.css(previewWrapper, {\r\n                width: isSmall ? '340px' : '540px',\r\n                marginLeft: \"-20px\",\r\n                height: isSmall ? '260px' : '300px',\r\n                backgroundColor: \"#9e9e9e\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    let canvas = i === selectedLayerIndex ? glCanvas : layers[i].context.canvas;\r\n                    previewLayerArr.push({\r\n                        image: canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.appendChild(aa);\r\n            previewInnerWrapper.appendChild(ab);\r\n            previewInnerWrapper.appendChild(ac);\r\n            previewInnerWrapper.appendChild(ad);\r\n\r\n            ba.style.display = \"none\";\r\n            bb.style.display = \"none\";\r\n            bc.style.display = \"none\";\r\n            bd.style.display = \"none\";\r\n            previewInnerWrapper.appendChild(ba);\r\n            previewInnerWrapper.appendChild(bb);\r\n            previewInnerWrapper.appendChild(bc);\r\n            previewInnerWrapper.appendChild(bd);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n            update();\r\n            result.destroy = () => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    before: [\r\n                        ba.x / displayPreviewFactor,\r\n                        ba.y / displayPreviewFactor,\r\n\r\n                        bb.x / displayPreviewFactor,\r\n                        bb.y / displayPreviewFactor,\r\n\r\n                        bc.x / displayPreviewFactor,\r\n                        bc.y / displayPreviewFactor,\r\n\r\n                        bd.x / displayPreviewFactor,\r\n                        bd.y / displayPreviewFactor,\r\n                    ],\r\n                    after: [\r\n                        aa.x / displayPreviewFactor,\r\n                        aa.y / displayPreviewFactor,\r\n\r\n                        ab.x / displayPreviewFactor,\r\n                        ab.y / displayPreviewFactor,\r\n\r\n                        ac.x / displayPreviewFactor,\r\n                        ac.y / displayPreviewFactor,\r\n\r\n                        ad.x / displayPreviewFactor,\r\n                        ad.y / displayPreviewFactor,\r\n                    ]\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let before = params.input.before;\r\n        let after = params.input.after;\r\n        if (!context || !before || !after || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).multiplyAlpha().perspective(before, after).unmultiplyAlpha().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"perspective\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\r\n\r\nconst activeColor = '#9e9e9e';\r\nconst inactiveColor = 'rgba(0,0,0,0.1)';\r\nconst hoverColor = '#ccc';\r\n\r\nexport class TwoTabs {\r\n\r\n    private rootEl: HTMLElement;\r\n    private leftTab: HTMLElement;\r\n    private rightTab: HTMLElement;\r\n    private value: number;\r\n\r\n    private update(): void {\r\n        if (this.value === 0) {\r\n            BB.css(this.leftTab, {\r\n                background: \"url(\" + checkmarkImg + \") no-repeat 12px 16px\",\r\n                backgroundColor: activeColor,\r\n                backgroundSize: '8%',\r\n                boxShadow: 'inset 0px 5px 10px rgba(0,0,0,0.5)',\r\n                cursor: 'default',\r\n            });\r\n            BB.css(this.rightTab, {\r\n                background: '',\r\n                backgroundColor: inactiveColor,\r\n                backgroundSize: '8%',\r\n                boxShadow: '',\r\n                cursor: 'pointer',\r\n            });\r\n        } else {\r\n            BB.css(this.rightTab, {\r\n                background: \"url(\" + checkmarkImg + \") no-repeat 12px 16px\",\r\n                backgroundColor: activeColor,\r\n                backgroundSize: '8%',\r\n                boxShadow: 'inset 0px 5px 10px rgba(0,0,0,0.5)',\r\n                cursor: 'default',\r\n            });\r\n            BB.css(this.leftTab, {\r\n                background: '',\r\n                backgroundColor: inactiveColor,\r\n                backgroundSize: '8%',\r\n                boxShadow: '',\r\n                cursor: 'pointer',\r\n            });\r\n        }\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor(params: {\r\n        left: string;\r\n        right: string;\r\n        init: number; //0, 1\r\n        onChange: (val: number) => void;\r\n    }) {\r\n        this.value = params.init;\r\n\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n            }\r\n        });\r\n\r\n        this.leftTab = BB.el({\r\n            parent: this.rootEl,\r\n            content: params.left,\r\n            css: {\r\n                width: '150px',\r\n                height: '30px',\r\n                paddingTop: '10px',\r\n                textAlign: 'center',\r\n                paddingBottom: '0',\r\n                borderTopLeftRadius: '10px',\r\n                backgroundSize: '8%',\r\n            }\r\n        });\r\n        BB.setEventListener(this.leftTab, 'onpointerdown', function () {\r\n            return false;\r\n        });\r\n\r\n        this.rightTab = BB.el({\r\n            parent: this.rootEl,\r\n            content: params.right,\r\n            css: {\r\n                width: '150px',\r\n                height: '30px',\r\n                paddingTop: '10px',\r\n                textAlign: 'center',\r\n                paddingBottom: '0',\r\n                borderTopRightRadius: '10px',\r\n                backgroundSize: '8%',\r\n            }\r\n        });\r\n        BB.setEventListener(this.rightTab, 'onpointerdown', () => {\r\n            return false;\r\n        });\r\n\r\n        this.update();\r\n\r\n        BB.setEventListener(this.leftTab, 'onpointerover', () => {\r\n            if (this.value !== 0) {\r\n                this.leftTab.style.backgroundColor = hoverColor;\r\n            }\r\n        });\r\n        BB.setEventListener(this.leftTab, 'onpointerout', () => {\r\n            if (this.value !== 0) {\r\n                this.leftTab.style.backgroundColor = inactiveColor;\r\n            }\r\n        });\r\n        BB.setEventListener(this.rightTab, 'onpointerover', () => {\r\n            if (this.value !== 1) {\r\n                this.rightTab.style.backgroundColor = hoverColor;\r\n            }\r\n        });\r\n        BB.setEventListener(this.rightTab, 'onpointerout', () => {\r\n            if (this.value !== 1) {\r\n                this.rightTab.style.backgroundColor = inactiveColor;\r\n            }\r\n        });\r\n\r\n        this.leftTab.onclick = () => {\r\n            if (this.value === 0) {\r\n                return;\r\n            }\r\n            this.value = 0;\r\n            this.update();\r\n            params.onChange(this.value);\r\n        };\r\n\r\n        this.rightTab.onclick = () => {\r\n            if (this.value === 1) {\r\n                return;\r\n            }\r\n            this.value = 1;\r\n            this.update();\r\n            params.onChange(this.value);\r\n        };\r\n    }\r\n\r\n    getElement(): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {Select} from '../ui/base-components/select';\r\n// @ts-ignore\r\nimport constrainImg from 'url:~/src/app/img/ui/constrain.svg';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterResize = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        //BB.centerWithin\r\n        let klCanvas = params.klCanvas;\r\n        if (!klCanvas)\r\n            return false;\r\n\r\n        let fit = BB.fitInto( klCanvas.getWidth(), klCanvas.getHeight(), 280, 200,1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / klCanvas.getWidth();\r\n        let tempCanvas = klCanvas.getCompleteCanvas(1);\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let newWidth = klCanvas.getWidth(), newHeight = klCanvas.getHeight();\r\n\r\n        div.innerHTML = LANG('filter-resize-description') + \"<br/><br/>\";\r\n\r\n\r\n        let maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n\r\n        let widthWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            }\r\n        });\r\n        let heightWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            }\r\n        });\r\n        let widthInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxWidth,\r\n                value: '' + klCanvas.getWidth(),\r\n            }\r\n        }) as HTMLInputElement;\r\n        let heightInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxHeight,\r\n                value: '' + klCanvas.getHeight(),\r\n            }\r\n        }) as HTMLInputElement;\r\n        widthInput.onclick = function () {\r\n            (this as any).focus();\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onclick = function () {\r\n            (this as any).focus();\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthInput.onchange = function () {\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onchange = function () {\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthWrapper.append(LANG('width') + \": \", widthInput);\r\n        heightWrapper.append(LANG('height') + \": \", heightInput);\r\n        let inputWrapper = BB.el({\r\n            css: {\r\n                background: \"url(\" + constrainImg + \") no-repeat 140px 5px\",\r\n                backgroundSize: '50px 52px',\r\n            }\r\n        });\r\n        inputWrapper.append(widthWrapper, heightWrapper);\r\n        div.appendChild(inputWrapper);\r\n\r\n        //contrain checkbox\r\n        let heightChanged = false, widthChanged = false;\r\n        let ratio = klCanvas.getWidth() / klCanvas.getHeight();\r\n\r\n        function updateConstrain() {\r\n            if (isConstrained) {\r\n                widthInput.value = '' + klCanvas.getWidth();\r\n                heightInput.value = '' + klCanvas.getHeight();\r\n                inputWrapper.style.background = \"url(\" + constrainImg + \") no-repeat 140px 5px\";\r\n                inputWrapper.style.backgroundSize = '50px 52px';\r\n                update();\r\n            } else {\r\n                inputWrapper.style.background = \"\";\r\n            }\r\n        }\r\n\r\n        let isConstrained = true;\r\n        let constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isConstrained = b;\r\n                updateConstrain();\r\n            }\r\n        });\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both'\r\n            }\r\n        }));\r\n\r\n\r\n        let algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')]\r\n            ],\r\n            title: LANG('scaling-algorithm'),\r\n            initValue: 'smooth',\r\n            onChange: function() {\r\n                update();\r\n            },\r\n        });\r\n\r\n        let secondRowElement = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between'\r\n            }\r\n        });\r\n        secondRowElement.appendChild(constrainCheckbox.getElement());\r\n        secondRowElement.appendChild(algorithmSelect.getElement());\r\n\r\n        let previewCanvas = BB.canvas(w, h);\r\n        previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n\r\n        let previewCtx = previewCanvas.getContext('2d');\r\n\r\n\r\n        function draw() {\r\n            if (algorithmSelect.getValue() === 'smooth') {\r\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\r\n\r\n                previewCanvas.width = klCanvas.getWidth();\r\n                previewCanvas.height = klCanvas.getHeight();\r\n\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingQuality = 'high';\r\n                previewCtx.drawImage(tempCanvas, 0, 0);\r\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\r\n                previewCtx.restore();\r\n\r\n            } else {\r\n                previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n                previewCanvas.width = newWidth;\r\n                previewCanvas.height = newHeight;\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingEnabled = false;\r\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\r\n                previewCtx.restore();\r\n            }\r\n\r\n        }\r\n\r\n        function update() {\r\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\r\n                heightChanged = false;\r\n                widthChanged = false;\r\n                return;\r\n            }\r\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\r\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\r\n            if (isConstrained) {\r\n                if (heightChanged) {\r\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\r\n                }\r\n                if (widthChanged) {\r\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\r\n                }\r\n\r\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\r\n                    let fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\r\n                    widthInput.value = '' + parseInt('' + fit.width);\r\n                    heightInput.value = '' + parseInt('' + fit.height);\r\n                }\r\n            }\r\n\r\n            if (parseInt(widthInput.value) > maxWidth) {\r\n                widthInput.value = '' + maxWidth;\r\n            }\r\n            if (parseInt(heightInput.value) > maxHeight) {\r\n                heightInput.value = '' + maxHeight;\r\n            }\r\n\r\n            heightChanged = false;\r\n            widthChanged = false;\r\n\r\n            newWidth = parseInt(widthInput.value);\r\n            newHeight = parseInt(heightInput.value);\r\n\r\n            let preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\r\n            let previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\r\n            previewFactor = previewW / newWidth;\r\n\r\n            let offset = BB.centerWithin(340, 220, previewW, previewH);\r\n\r\n            draw();\r\n\r\n            previewCanvas.style.width = Math.max(1, previewW) + \"px\";\r\n            previewCanvas.style.height = Math.max(1, previewH) + \"px\";\r\n            canvasWrapper.style.left = offset.x + \"px\";\r\n            canvasWrapper.style.top = offset.y + \"px\";\r\n            canvasWrapper.style.width = Math.max(1, previewW) + \"px\";\r\n            canvasWrapper.style.height = Math.max(1, previewH) + \"px\";\r\n        }\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            display: \"table\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n\r\n        let canvasWrapper = BB.appendTextDiv(previewWrapper, \"\");\r\n        canvasWrapper.appendChild(previewCanvas);\r\n        canvasWrapper.style.width = w + \"px\";\r\n        canvasWrapper.style.height = h + \"px\";\r\n        canvasWrapper.style.position = \"absolute\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        BB.createCheckerDataUrl(8, function (url) {\r\n            previewWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n\r\n        div.appendChild(previewWrapper);\r\n        update();\r\n\r\n        result.destroy = () => {\r\n            constrainCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                width: newWidth,\r\n                height: newHeight,\r\n                algorithm: algorithmSelect.getValue()\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        let width = params.input.width;\r\n        let height = params.input.height;\r\n        let algorithm = params.input.algorithm;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resize(width, height, algorithm);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"resize\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2BZYe\");","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterRotate = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let klCanvas = params.klCanvas;\r\n        if (!klCanvas)\r\n            return false;\r\n\r\n        let fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / klCanvas.getWidth();\r\n        let tempCanvas = BB.canvas(w, h);\r\n        tempCanvas.style.display = 'block';\r\n        tempCanvas.getContext(\"2d\").drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let deg = 0;\r\n        div.innerHTML = LANG('filter-rotate-description') + \"<br/><br/>\";\r\n\r\n        let first = true;\r\n\r\n        function update() {\r\n            (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg)\";\r\n            if (Math.abs(deg % 180) === 90) {\r\n                //height has to fit width because of rotation\r\n                let fit = BB.fitInto(h, w, 280, 200, 1);\r\n                let scale = parseInt('' + fit.height) / w;\r\n                (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n            }\r\n        }\r\n\r\n        let btnPlus = document.createElement(\"button\");\r\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'>⟳</span> 90°\";\r\n        let btnMinus = document.createElement(\"button\");\r\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'>⟲</span> 90°\";\r\n        btnMinus.style.marginRight = '5px';\r\n\r\n\r\n        btnPlus.onclick = function () {\r\n            deg += 90;\r\n            update();\r\n        };\r\n        btnMinus.onclick = function () {\r\n            deg -= 90;\r\n            update();\r\n        };\r\n\r\n        div.appendChild(btnMinus);\r\n        div.appendChild(btnPlus);\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            display: \"table\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewcell = document.createElement(\"div\");\r\n        previewcell.style.display = \"table-cell\";\r\n        previewcell.style.verticalAlign = \"middle\";\r\n        let canvasWrapper = BB.appendTextDiv(previewcell, \"\");\r\n        canvasWrapper.appendChild(tempCanvas);\r\n        previewWrapper.appendChild(previewcell);\r\n        canvasWrapper.style.width = w + \"px\";\r\n        canvasWrapper.style.height = h + \"px\";\r\n        canvasWrapper.style.marginLeft = \"auto\";\r\n        canvasWrapper.style.marginRight = \"auto\";\r\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        BB.createCheckerDataUrl(4, function (url) {\r\n            canvasWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n        canvasWrapper.style.transition = \"all 0.2s ease-out\";\r\n\r\n        div.appendChild(previewWrapper);\r\n        update();\r\n\r\n        result.getInput = function () {\r\n            return {\r\n                deg: deg\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        let deg = params.input.deg;\r\n        if (!klCanvas || !history)\r\n            return false;\r\n        history.pause(true);\r\n        klCanvas.rotate(deg);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"rotate\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterTiltShift = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        let pointerListenerArr = [];\r\n\r\n        function finishInit() {\r\n            let blur = 20, gradient = 200;\r\n            div.innerHTML = LANG('filter-tilt-shift-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            let fa, fb; // focus line\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).tiltShift(\r\n                        fa.x / displayPreviewFactor * previewFactor,\r\n                        fa.y / displayPreviewFactor * previewFactor,\r\n                        fb.x / displayPreviewFactor * previewFactor,\r\n                        fb.y / displayPreviewFactor * previewFactor,\r\n                        blur * previewFactor,\r\n                        gradient * previewFactor\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob(x, y) {\r\n                let nobSize = 14;\r\n                let div = BB.el({\r\n                    css: {\r\n                        width: nobSize + \"px\",\r\n                        height: nobSize + \"px\",\r\n                        backgroundColor: '#fff',\r\n                        boxShadow: \"inset 0 0 0 2px #000\",\r\n                        borderRadius: nobSize + \"px\",\r\n                        position: \"absolute\",\r\n                        cursor: 'move',\r\n                        left: (x - nobSize / 2) + \"px\",\r\n                        top: (y - nobSize / 2) + \"px\",\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    }\r\n                });\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                let pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    maxPointers: 1,\r\n                    onPointer: function(event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                            update();\r\n                        }\r\n                    }\r\n                });\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            fa = nob(parseInt('' + (displayW / 6)), parseInt('' + (displayH / 2)));\r\n            fb = nob(parseInt('' + (displayW - displayW / 6)), parseInt('' + (displayH - displayH / 3)));\r\n\r\n            let blurSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-blur'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: blur,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    blur = val;\r\n                    update();\r\n                },\r\n            });\r\n            blurSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(blurSlider.getElement());\r\n            let gradientSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-gradient'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1000,\r\n                value: gradient,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    gradient = val;\r\n                    update();\r\n                },\r\n            });\r\n            div.appendChild(gradientSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.appendChild(fa);\r\n            previewInnerWrapper.appendChild(fb);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n            update();\r\n            result.destroy = () => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                blurSlider.destroy();\r\n                gradientSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    a: {x: fa.x / displayPreviewFactor, y: fa.y / displayPreviewFactor},\r\n                    b: {x: fb.x / displayPreviewFactor, y: fb.y / displayPreviewFactor},\r\n                    blur: blur,\r\n                    gradient: gradient\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let a = params.input.a;\r\n        let b = params.input.b;\r\n        let blur = params.input.blur;\r\n        let gradient = params.input.gradient;\r\n        if (!context || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).tiltShift(a.x, a.y, b.x, b.y, blur, gradient).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"tiltShift\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {FreeTransform, ITransform} from '../ui/components/free-transform';\r\nimport {Select} from '../ui/base-components/select';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {IRect} from '../../bb/bb.types';\r\n\r\ninterface IFilterTransformInput {\r\n    bounds: {x: number, y: number, width: number, height: number};\r\n    transform: ITransform;\r\n    isPixelated: boolean;\r\n}\r\n\r\nexport const filterTransform = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = window.innerWidth < 550;\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n        let freeTransform: FreeTransform;\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        // determine bounds and initial transformation\r\n        const boundsObj: IRect = BB.canvasBounds(context);\r\n        if (boundsObj === null) {\r\n            alert(LANG('filter-transform-empty'));\r\n            return false;\r\n        }\r\n        const initTransform = {\r\n            x: boundsObj.x + boundsObj.width / 2,\r\n            y: boundsObj.y + boundsObj.height / 2,\r\n            width: boundsObj.width,\r\n            height: boundsObj.height,\r\n            angleDeg: 0,\r\n        };\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        div.innerHTML = LANG('filter-transform-description');\r\n\r\n        let keyListener = new BB.KeyListener({\r\n            onDown: function(keyStr) {\r\n                if (BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                if (keyStr === 'left') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'right') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'up') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'down') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n            }\r\n\r\n        });\r\n\r\n        let leftWrapper = document.createElement(\"div\");\r\n        let rightWrapper = document.createElement(\"div\");\r\n        let rotWrapper = document.createElement(\"div\");\r\n        let inputY = document.createElement(\"input\");\r\n        let inputX = document.createElement(\"input\");\r\n        let inputR = document.createElement(\"input\");\r\n        leftWrapper.style.width = \"100px\";\r\n        leftWrapper.style.height = \"30px\";\r\n        rightWrapper.style.width = \"100px\";\r\n        rightWrapper.style.height = \"30px\";\r\n        rightWrapper.style.display = \"inline-block\";\r\n        leftWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.width = \"150px\";\r\n        rotWrapper.style.height = \"30px\";\r\n        inputY.type = \"number\";\r\n        inputX.type = \"number\";\r\n        inputR.type = \"number\";\r\n        inputX.style.width = 70 + \"px\";\r\n        inputY.style.width = 70 + \"px\";\r\n        inputR.style.width = 70 + \"px\";\r\n        inputY.value = '0';\r\n        inputX.value = '0';\r\n        inputR.value = '0';\r\n        inputY.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputX.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputR.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputY.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputY.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        leftWrapper.append(\"X: \", inputX);\r\n        rightWrapper.append(\"Y: \", inputY);\r\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\r\n        if (!isSmall) {\r\n            const inputRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\r\n        }\r\n\r\n        // buttons\r\n        const actionBtnCss = {\r\n            marginLeft: '10px',\r\n            marginTop: '10px',\r\n        };\r\n        const buttonRow = BB.el ({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginLeft: '-10px',\r\n            }\r\n        });\r\n        const flipXBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' X',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(-t.width, t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const flipYBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' Y',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(t.width, -t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotLeftBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '-90°',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg -= 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotRightBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '+90°',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg += 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleDoubleBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                if (constrainCheckbox.getValue()) {\r\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\r\n                } else {\r\n                    freeTransform.setSize(t.width * 2, t.height * 2);\r\n                }\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleHalfBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '1/2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const centerBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('center'),\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n        let isConstrained = true;\r\n        let constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-constrain'),\r\n            title: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isConstrained = b;\r\n                freeTransform.setConstrained(isConstrained);\r\n            },\r\n            css: {\r\n                display: 'inline-block'\r\n            }\r\n        });\r\n        let isSnapping = false;\r\n        let snappingCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-snap'),\r\n            title: LANG('filter-transform-snap-title'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isSnapping = b;\r\n                freeTransform.setSnapping(isSnapping);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n                marginLeft: '10px',\r\n            }\r\n        });\r\n        const checkboxWrapper = BB.el({});\r\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\r\n\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n                height: '10px'\r\n            }\r\n        }));\r\n\r\n        const bottomRow = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n            }\r\n        });\r\n\r\n        let algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')]\r\n            ],\r\n            initValue: 'smooth',\r\n            title: LANG('scaling-algorithm'),\r\n            onChange: function() {\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        BB.css(previewWrapper, {\r\n            width: isSmall ? '340px' : '540px',\r\n            marginLeft: \"-20px\",\r\n            height: isSmall ? '260px' : '300px',\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayerArr: IKlBasicLayer[] = [];\r\n        {\r\n            for (let i = 0; i < layers.length; i++) {\r\n                let canvas;\r\n                if (i === selectedLayerIndex) {\r\n                    canvas = BB.canvas(parseInt('' + w), parseInt('' + h));\r\n                    let ctx = canvas.getContext('2d');\r\n                    ctx.drawImage(layers[i].context.canvas, 0, 0, canvas.width, canvas.height);\r\n                } else {\r\n                    canvas = layers[i].context.canvas;\r\n                }\r\n                previewLayerArr.push({\r\n                    image: canvas,\r\n                    opacity: layers[i].opacity,\r\n                    mixModeStr: layers[i].mixModeStr\r\n                });\r\n            }\r\n        }\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: parseInt('' + displayW),\r\n            height: parseInt('' + displayH),\r\n            layers: previewLayerArr\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + displayW) + 'px',\r\n                height: parseInt('' + displayH) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        let lastDrawnTransformStr;\r\n        function updatePreview(doForce: boolean = false) {\r\n            if (!freeTransform) {\r\n                return;\r\n            }\r\n            let transform = freeTransform.getTransform();\r\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\r\n                return;\r\n            }\r\n            lastDrawnTransformStr = JSON.stringify(transform);\r\n            if (displayPreviewFactor < 1) {\r\n                transform.x *= displayPreviewFactor;\r\n                transform.y *= displayPreviewFactor;\r\n                transform.width *= displayPreviewFactor;\r\n                transform.height *= displayPreviewFactor;\r\n            }\r\n            let transformLayerCanvas = previewLayerArr[selectedLayerIndex].image as HTMLCanvasElement;\r\n            let ctx = transformLayerCanvas.getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, transformLayerCanvas.width, transformLayerCanvas.height);\r\n            BB.drawTransformedImageWithBounds(\r\n                ctx,\r\n                layers[selectedLayerIndex].context.canvas,\r\n                transform,\r\n                boundsObj,\r\n                algorithmSelect.getValue() === 'pixelated' ||\r\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            );\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: initTransform.angleDeg,\r\n            isConstrained: true,\r\n            snapX: [0, context.canvas.width],\r\n            snapY: [0, context.canvas.height],\r\n            callback: function (t) {\r\n                inputX.value = '' + Math.round(t.x - initTransform.x);\r\n                inputY.value = '' + Math.round(t.y - initTransform.y);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            scale: displayPreviewFactor\r\n        });\r\n        BB.css(freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n        previewInnerWrapper.appendChild(freeTransform.getElement());\r\n\r\n        function onInputsChanged() {\r\n            freeTransform.setPos({\r\n                x: parseInt(inputX.value) + initTransform.x,\r\n                y: parseInt(inputY.value) + initTransform.y}\r\n            );\r\n            freeTransform.setAngleDeg(parseInt(inputR.value));\r\n            updatePreview();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            keyListener.destroy();\r\n            freeTransform.destroy();\r\n            constrainCheckbox.destroy();\r\n            snappingCheckbox.destroy();\r\n            BB.destroyEl(flipXBtn);\r\n            BB.destroyEl(flipYBtn);\r\n            BB.destroyEl(scaleRotLeftBtn);\r\n            BB.destroyEl(scaleRotRightBtn);\r\n            BB.destroyEl(scaleDoubleBtn);\r\n            BB.destroyEl(scaleHalfBtn);\r\n            BB.destroyEl(centerBtn);\r\n        };\r\n        result.getInput = function () {\r\n            const transform = freeTransform.getTransform();\r\n            let input = {\r\n                transform,\r\n                bounds: boundsObj,\r\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\r\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            } as IFilterTransformInput;\r\n            result.destroy();\r\n            return JSON.parse(JSON.stringify(input));\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const input: IFilterTransformInput = params.input;\r\n\r\n        let copyCanvas = BB.copyCanvas(context.canvas);\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            context,\r\n            copyCanvas,\r\n            input.transform,\r\n            input.bounds,\r\n            input.isPixelated,\r\n        );\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"transform\"],\r\n            action: \"apply\",\r\n            params: [{input}],\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterBlur = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let klCanvas = params.klCanvas;\r\n        let context = params.context;\r\n        if (!klCanvas || !context) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n\r\n        function finishInit() {\r\n            let radius = 10;\r\n            div.innerHTML = LANG('filter-triangle-blur-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 1,\r\n                max: 200,\r\n                value: radius,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            div.appendChild(radiusSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                texture.destroy();\r\n                radiusSlider.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let radius = params.input.radius;\r\n        if (!context || !radius || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).triangleBlur(radius).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"blur\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterUnsharpMask = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.innerHTML = LANG('filter-unsharp-mask-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: 2,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]],\r\n            });\r\n            let strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 50,\r\n                value: 5.1,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    strength = val / 10;\r\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]],\r\n            });\r\n            radiusSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(radiusSlider.getElement());\r\n            div.appendChild(strengthSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                radiusSlider.destroy();\r\n                strengthSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius,\r\n                    strength: strength\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let radius = params.input.radius;\r\n        let strength = params.input.strength;\r\n        if (!context || radius === null || strength === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).unsharpMask(radius, strength).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"unsharpMask\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterToAlpha = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.appendChild(BB.el({\r\n                content: LANG('filter-to-alpha-description'),\r\n                css: {\r\n                    marginBottom: '5px'\r\n                }\r\n            }));\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            function updatePreview() {\r\n                glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n                klCanvasPreview.render();\r\n            }\r\n\r\n            // source\r\n            let sourceId = 'inverted-luminance';\r\n            let sourceOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'inverted-luminance',\r\n                        label: LANG('filter-to-alpha-inverted-lum')\r\n                    },\r\n                    {\r\n                        id: 'luminance',\r\n                        label: LANG('filter-to-alpha-lum')\r\n                    }\r\n                ],\r\n                initialId: sourceId,\r\n                onChange: function(id) {\r\n                    sourceId = id;\r\n                    updatePreview();\r\n                }\r\n            });\r\n            div.appendChild(sourceOptions.getElement());\r\n\r\n            // color\r\n            let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n            let colorOptionsArr = [\r\n                null,\r\n                {r: 0, g: 0, b: 0, a: 1},\r\n                {r: 255, g: 255, b: 255, a: 1}\r\n            ];\r\n            colorOptionsArr.push({\r\n                r: params.currentColorRgb.r,\r\n                g: params.currentColorRgb.g,\r\n                b: params.currentColorRgb.b,\r\n                a: 1,\r\n            });\r\n            colorOptionsArr.push({\r\n                r: params.secondaryColorRgb.r,\r\n                g: params.secondaryColorRgb.g,\r\n                b: params.secondaryColorRgb.b,\r\n                a: 1,\r\n            });\r\n\r\n            let colorOptions = new ColorOptions({\r\n                label: LANG('filter-to-alpha-replace'),\r\n                colorArr: colorOptionsArr,\r\n                initialIndex: 1,\r\n                onChange: function(rgbaObj) {\r\n                    selectedRgbaObj = rgbaObj;\r\n                    updatePreview();\r\n                }\r\n            });\r\n            colorOptions.getElement().style.marginTop = '10px';\r\n            div.appendChild(colorOptions.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            setTimeout(function() { //ie has a problem otherwise...\r\n                try {\r\n                    updatePreview();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }, 1);\r\n\r\n            result.destroy = () => {\r\n                texture.destroy();\r\n                sourceOptions.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    sourceId: sourceId,\r\n                    selectedRgbaObj: selectedRgbaObj\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let sourceId = params.input.sourceId;\r\n        let selectedRgbaObj = params.input.selectedRgbaObj;\r\n        if (!context || !sourceId || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"toAlpha\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/base-components/input';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {drawGrid} from '../image-operations/draw-grid';\r\n\r\n\r\n\r\nexport const filterGrid = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        div.innerHTML = LANG('filter-grid-description') + \"<br/><br/>\";\r\n\r\n        const settingsObj = {\r\n            x: 2,\r\n            y: 2,\r\n            thickness: 2,\r\n            color: '#000',\r\n            opacity: 1,\r\n        };\r\n\r\n        let line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            }\r\n        });\r\n        let line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px'\r\n            }\r\n        });\r\n        const xInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const yInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function(rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            })\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawGrid(ctx, settingsObj.x, settingsObj.y, Math.max(settingsObj.thickness * renderFactor, 1), settingsObj.color, settingsObj.opacity);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawGrid(context, params.input.x, params.input.y, params.input.thickness, params.input.color, params.input.opacity);\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"filter\", \"grid\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","\r\n// ideas: padding, gutter, other shapes\r\n\r\nexport function drawGrid(\r\n    ctx: CanvasRenderingContext2D,\r\n    cellsX: number,\r\n    cellsY: number,\r\n    thickness: number, // px\r\n    color: string,\r\n    opacity: number, // 0 - 1\r\n) {\r\n    ctx.save();\r\n    const w = ctx.canvas.width;\r\n    const h = ctx.canvas.height;\r\n    thickness = Math.round(thickness);\r\n    const thickIsRound = thickness % 2 === 0;\r\n\r\n    ctx.beginPath();\r\n    ctx.lineWidth = thickness;\r\n    ctx.strokeStyle = color;\r\n    ctx.globalAlpha = opacity;\r\n\r\n    for(let i = 0; i < cellsX - 1; i++) {\r\n        const cw = w / (cellsX);\r\n        let pos = cw * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n        ctx.moveTo(pos, 0);\r\n        ctx.lineTo(pos, h);\r\n\r\n    }\r\n    for(let i = 0; i < cellsY - 1; i++) {\r\n        const ch = h / (cellsY);\r\n        let pos = ch * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n\r\n        ctx.moveTo(0, pos);\r\n        ctx.lineTo(w, pos);\r\n    }\r\n\r\n    ctx.stroke();\r\n    ctx.restore();\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode, IRGB} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {eventResMs} from './filters-consts';\r\nimport {Select} from '../ui/base-components/select';\r\nimport {translateBlending} from '../canvas/translate-blending';\r\nimport {KL} from '../kl';\r\nimport {ColorConverter} from '../../bb/color/color';\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\n\r\n// see noise(...) in glfx.ts\r\ninterface INoisePreset {\r\n    type: number;\r\n    scaleX: number;\r\n    scaleY: number;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    octaves: number;\r\n    samples: number;\r\n    peaks: number;\r\n    brightness: number;\r\n    contrast: number;\r\n    isReversed: boolean;\r\n}\r\n\r\ntype TNoiseChannels = 'rgb' | 'alpha';\r\n\r\ninterface INoiseSettings extends INoisePreset {\r\n    seed: number;\r\n    colA: IRGB;\r\n    colB: IRGB;\r\n    channels: TNoiseChannels;\r\n}\r\n\r\ninterface INoiseFilterInput {\r\n    seed: number;\r\n    presetIndex: number; // which preset from presetArr\r\n    scale: number; // applies to both scaleX and scaleX\r\n    opacity: number; // aka strength\r\n    isReversed: boolean; // reverse direction of color gradient\r\n    channels: TNoiseChannels;\r\n\r\n    // only for channels = rgb\r\n    mixModeStr: GlobalCompositeOperation; // how mixed with image\r\n    colA: IRGB;\r\n    colB: IRGB;\r\n}\r\n\r\nconst presetArr: INoisePreset[] = [\r\n    // each pixel random value\r\n    {type: 0, scaleX: 1, scaleY: 1, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: true},\r\n\r\n    // cloud\r\n    {type: 1, scaleX: 166, scaleY: 164, offsetX: 105, offsetY: 30, octaves: 6, samples: 1, peaks: 0, brightness: 0.055, contrast: 0.23, isReversed: true},\r\n\r\n    // thin lines\r\n    {type: 1, scaleX: 235, scaleY: 190, offsetX: 3227, offsetY: 2156, octaves: 4, samples: 16, peaks: 22, brightness: -0.375, contrast: 1, isReversed: false},\r\n\r\n    // soft large simplex, only 1 octave\r\n    {type: 1, scaleX: 40, scaleY: 40, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: false},\r\n\r\n    // two value large pixels\r\n    {type: 0, scaleX: 26, scaleY: 26, offsetX: 557, offsetY: 365, octaves: 1, samples: 1, peaks: 0, brightness: 0.02, contrast: 1, isReversed: true},\r\n\r\n    // zebra\r\n    {type: 1, scaleX: 1500, scaleY: 1500, offsetX: 745, offsetY: 2871, octaves: 5, samples: 16, peaks: 156.02, brightness: 0.03, contrast: 1, isReversed: true},\r\n\r\n    // sparse dots / stars\r\n    {type: 1, scaleX: 11, scaleY: 11, offsetX: 2940, offsetY: 2045, octaves: 1, samples: 16, peaks: 1, brightness: -0.045, contrast: 1, isReversed: true},\r\n\r\n    // pseudo marble\r\n    {type: 2, scaleX: 74, scaleY: 74, offsetX: 4816, offsetY: 1304, octaves: 3, samples: 1, peaks: 2.78, brightness: 0, contrast: 0, isReversed: false},\r\n];\r\n\r\nfunction drawNoise(glCanvas, settings: INoiseSettings): void {\r\n    glCanvas.noise(\r\n        settings.seed  ? settings.seed : 0,\r\n        settings.type,\r\n        [settings.scaleX, settings.scaleY],\r\n        [glCanvas.width / 2, glCanvas.height / 2],\r\n        settings.octaves,\r\n        settings.samples,\r\n        settings.peaks,\r\n        settings.brightness,\r\n        settings.contrast,\r\n        settings.isReversed,\r\n        settings.colA,\r\n        settings.colB,\r\n        settings.channels ? settings.channels : 'rgb',\r\n    ).update();\r\n}\r\n\r\n\r\nexport const filterNoise = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return; // todo throw?\r\n        }\r\n        let texture;\r\n\r\n        const thumbImgArr = [];\r\n        const thumbSize = 32;\r\n        {\r\n            const canvas = BB.canvas(thumbSize, thumbSize);\r\n            const ctx = canvas.getContext('2d');\r\n            texture = glCanvas.texture(canvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            texture.destroy();\r\n\r\n            presetArr.forEach((preset, index) => {\r\n                const thumbImg = new Image();\r\n                const presetCopy = BB.copyObj(preset);\r\n                presetCopy.scaleX /= 10;\r\n                presetCopy.scaleY /= 10;\r\n                drawNoise(glCanvas, presetCopy);\r\n                ctx.drawImage(glCanvas, 0, 0);\r\n                thumbImg.src = canvas.toDataURL('image/png');\r\n                thumbImgArr.push(thumbImg);\r\n            });\r\n\r\n        }\r\n\r\n        let tempCanvas = BB.canvas(renderW, renderH);\r\n        texture = glCanvas.texture(tempCanvas);\r\n        glCanvas.draw(texture).update(); // update glCanvas size\r\n        tempCanvas = null;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        div.innerHTML = LANG('filter-noise-description') + \"<br/><br/>\";\r\n\r\n        const settingsObj: INoiseFilterInput = {\r\n            seed: Math.random() * 300,\r\n            presetIndex: 0,\r\n            scale: 50,\r\n            opacity: 0.5,\r\n            isReversed: false,\r\n            channels: 'rgb',\r\n            mixModeStr: 'source-over' as GlobalCompositeOperation,\r\n            colA: {r: 0, g: 0, b: 0},\r\n            colB: {r: 255, g: 255, b: 255},\r\n        };\r\n\r\n\r\n        const presetOptions = new Options({\r\n            optionArr: thumbImgArr.map((img, index) => {\r\n                BB.css(img, {\r\n                    margin: '1px',\r\n                    borderRadius: '3px',\r\n                    transition: 'all 0.1s ease-in-out',\r\n                })\r\n                return {\r\n                    id: '' + index,\r\n                    label: img,\r\n                };\r\n            }),\r\n            initialId: '0',\r\n            onChange: (id) => {\r\n                settingsObj.presetIndex = Number(id);\r\n                updatePreview();\r\n            }\r\n        });\r\n        presetOptions.getElement().style.marginBottom = '10px';\r\n        div.append(presetOptions.getElement());\r\n\r\n        const scaleSlider = new KlSlider({\r\n            label: LANG('filter-noise-scale'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1,\r\n            max: 1000,\r\n            value: settingsObj.scale,\r\n            eventResMs: eventResMs,\r\n            curve: BB.quadraticSplineInput(1, 1000, 0.1),\r\n            onChange: (value) => {\r\n                settingsObj.scale = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        scaleSlider.getElement().style.marginBottom = \"10px\";\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: settingsObj.opacity,\r\n            eventResMs: eventResMs,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: (value) => {\r\n                settingsObj.opacity = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        opacitySlider.getElement().style.marginBottom = \"10px\";\r\n\r\n        const row1El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginBottom: '10px',\r\n            }\r\n        });\r\n\r\n        const row2El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n\r\n        const channelsOptions = new Options({\r\n            optionArr: [\r\n                {id: 'rgb', label: 'RGB'},\r\n                {id: 'alpha', label: LANG('filter-noise-alpha')},\r\n            ],\r\n            initialId: 'rgb',\r\n            onChange: (id: TNoiseChannels) => {\r\n                settingsObj.channels = id;\r\n                if (id === 'rgb') {\r\n                    row2El.style.visibility = '';\r\n                } else {\r\n                    row2El.style.visibility = 'hidden';\r\n                }\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const reverseToggle = new Checkbox({\r\n            label: LANG('reverse'),\r\n            callback: (val) => {\r\n                settingsObj.isReversed = val;\r\n                updatePreview();\r\n            },\r\n            allowTab: true,\r\n        });\r\n\r\n        const blendSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                'source-over',\r\n                null,\r\n                'darken',\r\n                'multiply',\r\n                'color-burn',\r\n                null,\r\n                'lighten',\r\n                'screen',\r\n                'color-dodge',\r\n                null,\r\n                'overlay',\r\n                'soft-light',\r\n                'hard-light',\r\n                null,\r\n                'difference',\r\n                'exclusion',\r\n                null,\r\n                'hue',\r\n                'saturation',\r\n                'color',\r\n                'luminosity',\r\n            ].map((item: IMixMode) => {\r\n                return item ? [item, translateBlending(item)] : null;\r\n            }),\r\n            initValue: settingsObj.mixModeStr,\r\n            onChange: (val: GlobalCompositeOperation) => {\r\n                settingsObj.mixModeStr = val;\r\n                updatePreview();\r\n            },\r\n        });\r\n        blendSelect.getElement().title = LANG('layers-blending');\r\n\r\n        const colorWrapper = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n\r\n        const colInputStyle = {\r\n            width: '34px',\r\n            height: '34px',\r\n            marginRight: '5px',\r\n        }\r\n        const colAInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colA),\r\n            callback: (val) => {\r\n                settingsObj.colA = ColorConverter.hexToRGB(val);\r\n                updatePreview();\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        const colBInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colB),\r\n            callback: (val) => {\r\n                settingsObj.colB = ColorConverter.hexToRGB(val);\r\n                updatePreview();\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        colorWrapper.append(\r\n            colAInput,\r\n            colBInput,\r\n        );\r\n\r\n\r\n        row1El.append(\r\n            channelsOptions.getElement(),\r\n            BB.el({css:{flexGrow: '1',}}),\r\n            reverseToggle.getElement(),\r\n        );\r\n\r\n        row2El.append(\r\n            blendSelect.getElement(),\r\n            BB.el({css:{flexGrow: '1',}}),\r\n            colorWrapper,\r\n        );\r\n\r\n        div.append(\r\n            scaleSlider.getElement(),\r\n            opacitySlider.getElement(),\r\n            row1El,\r\n            row2El,\r\n        );\r\n\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            })\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n\r\n            ctx.globalAlpha = settingsObj.opacity;\r\n\r\n            const presetCopy = BB.copyObj(presetArr[settingsObj.presetIndex]);\r\n            presetCopy.seed = settingsObj.seed;\r\n            presetCopy.scaleX = presetCopy.scaleX  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.scaleY = presetCopy.scaleY  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.colA = settingsObj.colA;\r\n            presetCopy.colB = settingsObj.colB;\r\n            presetCopy.isReversed = settingsObj.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\r\n            presetCopy.channels  = settingsObj.channels;\r\n            drawNoise(glCanvas, presetCopy);\r\n\r\n            if (settingsObj.channels === 'alpha') {\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n            } else {\r\n                ctx.globalCompositeOperation = settingsObj.mixModeStr;\r\n            }\r\n\r\n            ctx.drawImage(glCanvas, 0, 0);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            presetOptions.destroy();\r\n            scaleSlider.destroy();\r\n            opacitySlider.destroy();\r\n            reverseToggle.destroy();\r\n            channelsOptions.destroy();\r\n            texture.destroy();\r\n            blendSelect.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).update();\r\n        texture.destroy();\r\n\r\n        const input: INoiseFilterInput = params.input;\r\n\r\n        const presetCopy = BB.copyObj(presetArr[input.presetIndex]);\r\n        presetCopy.seed = input.seed;\r\n        presetCopy.scaleX = presetCopy.scaleX  * input.scale / 50;\r\n        presetCopy.scaleY = presetCopy.scaleY  * input.scale / 50;\r\n        presetCopy.colA = input.colA;\r\n        presetCopy.colB = input.colB;\r\n        presetCopy.isReversed = input.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\r\n        presetCopy.channels  = input.channels;\r\n        drawNoise(glCanvas, presetCopy);\r\n\r\n        context.save();\r\n        context.globalAlpha = input.opacity;\r\n        if (input.channels === 'alpha') {\r\n            context.globalCompositeOperation = 'destination-out';\r\n        } else {\r\n            context.globalCompositeOperation = input.mixModeStr;\r\n        }\r\n        context.drawImage(glCanvas, 0, 0);\r\n        context.restore();\r\n\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [\r\n                klCanvas.getLayerIndex(context.canvas),\r\n                context.getImageData(0, 0, context.canvas.width, context.canvas.height),\r\n            ]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl.types';\r\nimport {input} from '../ui/base-components/input';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {LANG} from '../../language/language';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {TwoTabs} from '../ui/components/two-tabs';\r\nimport {IVector2D} from '../../bb/bb.types';\r\n\r\n\r\ninterface IPatternSettings {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n    blend?: number; // [0, 1] - 1 will blend linearly across whole length\r\n    offsetX: number;\r\n    offsetY: number;\r\n}\r\n\r\n/**\r\n * Draws pattern onto context. Pattern generated from context.\r\n * Can use blending for smoother transition. Will use area outside of bounds for blending.\r\n *\r\n * @param context\r\n * @param settings\r\n */\r\nfunction drawPattern(context: CanvasRenderingContext2D, settings: IPatternSettings): void {\r\n\r\n    // keep bounds in center via offset\r\n    // because blending done towards bottom right\r\n    const blendOffsetX = settings.blend ? Math.round(settings.blend * settings.width / 2) : 0;\r\n    const blendOffsetY = settings.blend ? Math.round(settings.blend * settings.height / 2) : 0;\r\n\r\n    const finalPatternCanvas = BB.canvas(settings.width, settings.height);\r\n\r\n    if (settings.blend) {\r\n        // construct pattern via linear blending\r\n\r\n        const blendCanvas = BB.canvas(settings.width * 2, settings.height * 2);\r\n        const blendCtx = blendCanvas.getContext('2d');\r\n        const colTransparent = '#0000';\r\n        const colOpaque = '#000';\r\n\r\n        // transfer source to blendCanvas\r\n        blendCtx.drawImage(\r\n            context.canvas,\r\n            -settings.x + blendOffsetX,\r\n            -settings.y + blendOffsetY,\r\n        );\r\n\r\n        // --- 1 cross-fade vertical ------------------------\r\n\r\n        // erase vertical gradient bottom half\r\n        blendCtx.save();\r\n        let blendGradient = blendCtx.createLinearGradient(0, settings.height, 0, settings.height * 2);\r\n        blendGradient.addColorStop(0, colOpaque);\r\n        blendGradient.addColorStop(settings.blend, colTransparent);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\r\n        blendCtx.restore();\r\n\r\n        // erase vertical gradient top half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(0, 0, 0, settings.height);\r\n        blendGradient.addColorStop(0, colTransparent);\r\n        blendGradient.addColorStop(settings.blend, colOpaque);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\r\n        blendCtx.restore();\r\n\r\n        // draw bottom half over top half\r\n        blendCtx.save();\r\n        // lighter needed for accurate cross-fade\r\n        blendCtx.globalCompositeOperation = 'lighter';\r\n        blendCtx.drawImage(blendCanvas, 0, -settings.height);\r\n        blendCtx.restore();\r\n\r\n\r\n\r\n        // --- 2 cross-fade horizontal ------------------------\r\n\r\n        // erase horizontal gradient right half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(settings.width, 0, settings.width * 2, 0);\r\n        blendGradient.addColorStop(0, colOpaque);\r\n        blendGradient.addColorStop(settings.blend, colTransparent);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\r\n        blendCtx.restore();\r\n\r\n        // erase horizontal gradient left half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(0, 0, settings.width, 0);\r\n        blendGradient.addColorStop(0, colTransparent);\r\n        blendGradient.addColorStop(settings.blend, colOpaque);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\r\n        blendCtx.restore();\r\n\r\n        // draw right half over left half\r\n        blendCtx.save();\r\n        // lighter needed for accurate cross-fade\r\n        blendCtx.globalCompositeOperation = 'lighter';\r\n        blendCtx.drawImage(blendCanvas, -settings.width, 0);\r\n        blendCtx.restore();\r\n\r\n        // transfer to pattern canvas\r\n        finalPatternCanvas.getContext('2d').drawImage(blendCanvas, 0, 0);\r\n\r\n    } else {\r\n        finalPatternCanvas.getContext('2d').drawImage(\r\n            context.canvas,\r\n            -settings.x,\r\n            -settings.y,\r\n        );\r\n    }\r\n\r\n    context.save();\r\n\r\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n    context.translate(settings.offsetX - blendOffsetX, settings.offsetY - blendOffsetY);\r\n    context.fillStyle = context.createPattern(finalPatternCanvas, 'repeat');\r\n    context.fillRect(-settings.offsetX + blendOffsetX, -settings.offsetY + blendOffsetY, context.canvas.width, context.canvas.height);\r\n\r\n    context.restore();\r\n}\r\n\r\n\r\nexport const filterPattern = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const maxSize = 1024;\r\n        const rootEl = BB.el({\r\n            content: LANG('filter-pattern-description') + '<br><br>',\r\n        });\r\n        const context = params.context;\r\n        const width = context.canvas.width;\r\n        const height = context.canvas.height;\r\n\r\n        let settings: IPatternSettings = {\r\n            x: 0,\r\n            y: 0,\r\n            width: width <= 250 ? Math.round(width / 4) : 200,\r\n            height: height <= 250 ? Math.round(height / 4) : 200,\r\n            blend: 0,\r\n            offsetX: 0,\r\n            offsetY: 0,\r\n        };\r\n        let lastDrawnSettings = null;\r\n\r\n        // determine bounds\r\n        const bounds = BB.canvasBounds(context);\r\n        // adjust settings according to bounds\r\n        if ( // use layer bounds if:\r\n            bounds &&\r\n            (bounds.width <= maxSize && bounds.height <= maxSize) && // don't exceed max size\r\n            (bounds.width < width * 0.75 || bounds.height < height * 0.75) // aren't too large (heuristic)\r\n        ) {\r\n            settings.x = bounds.x;\r\n            settings.y = bounds.y;\r\n            settings.width = bounds.width;\r\n            settings.height = bounds.height;\r\n        } else { // otherwise use default size in center\r\n            settings.x = Math.round(width / 2 - settings.width / 2);\r\n            settings.y = Math.round(height / 2 - settings.height / 2);\r\n        }\r\n\r\n        // ---- controls ----\r\n\r\n        const xInput = input({\r\n            init: settings.x,\r\n            type: 'number',\r\n            min: 0,\r\n            max: width,\r\n            css: {width: '100%'},\r\n            callback: function(v) {\r\n                settings.x = Number(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const yInput = input({\r\n            init: settings.y,\r\n            type: 'number',\r\n            min: 0,\r\n            max: height,\r\n            css: {width: '100%'},\r\n            callback: function(v) {\r\n                settings.y = Number(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const widthInput = input({\r\n            init: settings.width,\r\n            type: 'number',\r\n            min: 1,\r\n            max: Math.min(maxSize, width),\r\n            css: {width: '100%'},\r\n            callback: function(v) {\r\n                settings.width = Number(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const heightInput = input({\r\n            init: settings.height,\r\n            type: 'number',\r\n            min: 1,\r\n            max: Math.min(maxSize, height),\r\n            css: {width: '100%'},\r\n            callback: function(v) {\r\n                settings.height = Number(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        const inputStyle = {\r\n            marginLeft: '5px',\r\n            flex: '1',\r\n        };\r\n        rootEl.append(\r\n            BB.el({\r\n               content: [\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           'X:',\r\n                           xInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           'Y:',\r\n                           yInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           LANG('width') + ':',\r\n                           widthInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           LANG('height') + ':',\r\n                           heightInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n               ],\r\n               css: {\r\n                   display: 'flex',\r\n                   marginLeft: '-5px',\r\n               }\r\n            }),\r\n        );\r\n\r\n\r\n        const blendSlider = new KlSlider({\r\n            label: LANG('brush-blending'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 0,\r\n            max: 1,\r\n            value: settings.blend,\r\n            eventResMs: eventResMs,\r\n            onChange: function (val) {\r\n                settings.blend = val;\r\n                updatePreview();\r\n            },\r\n            formatFunc: (val) => {\r\n                return BB.round(val, 2);\r\n            },\r\n            manualInputRoundDigits: 2,\r\n        });\r\n        BB.css(blendSlider.getElement(), {\r\n            margin: '10px 0',\r\n        })\r\n\r\n        rootEl.append(\r\n            blendSlider.getElement(),\r\n        );\r\n\r\n        // ---- preview tabs ----\r\n        let previewMode = 1; // 0 before, 1 after\r\n        const beforeAfterTabs = new TwoTabs({\r\n            left: LANG('compare-before'),\r\n            right: LANG('compare-after'),\r\n            init: previewMode,\r\n            onChange: (val) => {\r\n                previewMode = val;\r\n                overlayCanvas.style.display = val === 0 ? 'block' : 'none';\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        rootEl.append(beforeAfterTabs.getElement());\r\n\r\n        // ---- previews ----\r\n\r\n        const klCanvas = params.klCanvas;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const previewWrapper = BB.el({\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                marginLeft: \"-20px\",\r\n                height: isSmall ? '260px' : '300px',\r\n                backgroundColor: \"#9e9e9e\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            }\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const previewLayerArr = layers.map((item, i) => {\r\n            if (i === selectedLayerIndex) {\r\n                return previewLayer;\r\n            } else {\r\n                return {\r\n                    image: item.context.canvas,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                };\r\n            }\r\n        });\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const overlayCanvas = BB.canvas(w, h);\r\n        BB.css(overlayCanvas, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            mixBlendMode: 'difference',\r\n            imageRendering: 'pixelated',\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.append(\r\n            klCanvasPreview.getElement(),\r\n            overlayCanvas\r\n        );\r\n        previewWrapper.append(previewInnerWrapper);\r\n        rootEl.append(previewWrapper);\r\n\r\n\r\n        // ---- preview input processing ----\r\n        const inputs: {\r\n            start: IVector2D;\r\n            end: IVector2D;\r\n            oldSettings: IPatternSettings;\r\n            state: null | 'move' | 'select';\r\n        } = {\r\n            start: null,\r\n            end: null,\r\n            oldSettings: null,\r\n            state: null,\r\n        };\r\n\r\n        function syncInputs(): void {\r\n            xInput.value = '' + settings.x;\r\n            yInput.value = '' + settings.y;\r\n            widthInput.value = '' + settings.width;\r\n            heightInput.value = '' + settings.height;\r\n        }\r\n\r\n        const keyListener = new BB.KeyListener({\r\n        });\r\n\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        previewInnerWrapper.style.touchAction = 'none';\r\n        const pointerListener = new BB.PointerListener({\r\n            target: previewInnerWrapper,\r\n            onPointer: (event) => {\r\n                if (previewMode === 0) {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (!inputs.state) {\r\n                            inputs.oldSettings = BB.copyObj(settings);\r\n\r\n                            const x = event.relX / previewFactor;\r\n                            const y = event.relY / previewFactor;\r\n\r\n                            if (BB.isInsideRect(\r\n                                {x, y},\r\n                                {x: settings.x, y: settings.y, width: settings.width, height: settings.height},\r\n                            )) {\r\n                                inputs.state = 'move';\r\n                            } else {\r\n                                inputs.state = 'select';\r\n                            }\r\n                            inputs.start = {x, y};\r\n                        }\r\n                    } else if (event.type === 'pointermove') {\r\n\r\n                        const x = event.relX / previewFactor;\r\n                        const y = event.relY / previewFactor;\r\n\r\n                        if (inputs.state === 'select') {\r\n                            inputs.end = {x, y};\r\n\r\n                            const x1 = Math.max(0, Math.min(inputs.start.x, inputs.end.x));\r\n                            const y1 = Math.max(0, Math.min(inputs.start.y, inputs.end.y));\r\n                            const x2 = Math.min(width, Math.max(inputs.start.x, inputs.end.x));\r\n                            const y2 = Math.min(height, Math.max(inputs.start.y, inputs.end.y));\r\n\r\n                            settings.x = Math.floor(x1);\r\n                            settings.y = Math.floor(y1);\r\n                            settings.width = Math.min(maxSize, Math.ceil(x2 - settings.x));\r\n                            settings.height = Math.min(maxSize, Math.ceil(y2 - settings.y));\r\n\r\n                            if (keyListener.isPressed('shift')) {\r\n                                settings.width = Math.min(settings.width, settings.height);\r\n                                settings.height = Math.min(settings.width, settings.height);\r\n                            }\r\n\r\n                            if (settings.width === 0 || settings.height === 0) {\r\n                                settings = BB.copyObj(inputs.oldSettings);\r\n                            }\r\n\r\n                            syncInputs();\r\n                            updatePreview();\r\n                        } else if (inputs.state === 'move') {\r\n                            const dX = Math.round(x - inputs.start.x);\r\n                            const dY = Math.round(y - inputs.start.y);\r\n\r\n                            settings.x = BB.clamp(inputs.oldSettings.x + dX, 0, width - settings.width);\r\n                            settings.y = BB.clamp(inputs.oldSettings.y + dY, 0, height - settings.height);\r\n\r\n                            syncInputs();\r\n                            updatePreview();\r\n                        }\r\n                    } else if (event.type === 'pointerup') {\r\n                        if (inputs.state) {\r\n                            inputs.state = null;\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (!inputs.state) {\r\n                            inputs.state = 'move';\r\n                            inputs.oldSettings = BB.copyObj(settings);\r\n                            inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n                            inputs.end = null;\r\n                        }\r\n                    } else if (event.type === 'pointermove') {\r\n                        if (inputs.state) {\r\n                            inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n\r\n                            settings.offsetX = Math.round(inputs.end.x - inputs.start.x) + inputs.oldSettings.offsetX;\r\n                            settings.offsetY = Math.round(inputs.end.y - inputs.start.y) + inputs.oldSettings.offsetY;\r\n\r\n                            updatePreview();\r\n                        }\r\n                    } else if (event.type === 'pointerup') {\r\n                        if (inputs.state) {\r\n                            if (!inputs.end) {\r\n                                settings.offsetX = 0;\r\n                                settings.offsetY = 0;\r\n                                updatePreview();\r\n                            }\r\n                            inputs.state = null;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        // ---------- rendering ---------------------\r\n        const fullSizeCanvas = BB.canvas(width, height);\r\n        const fullSizeCtx = fullSizeCanvas.getContext('2d');\r\n\r\n        function sharpStrokeRect(\r\n            context: CanvasRenderingContext2D,\r\n            x: number,\r\n            y: number,\r\n            width: number,\r\n            height: number\r\n        ): void {\r\n            const drawX = Math.round(x + 0.5) - 0.5;\r\n            const drawY = Math.round(y + 0.5) - 0.5;\r\n            const drawWidth = Math.round(x + width - drawX);\r\n            const drawHeight = Math.round(y + height - drawY);\r\n            context.strokeRect(drawX, drawY, drawWidth, drawHeight);\r\n        }\r\n\r\n        function updatePreview(doForce?: boolean) {\r\n            if (!doForce && lastDrawnSettings && JSON.stringify(lastDrawnSettings) === JSON.stringify(settings)) {\r\n                return;\r\n            }\r\n\r\n            if (previewMode === 0) { // before\r\n                fullSizeCtx.clearRect(0, 0, width, height);\r\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\r\n\r\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\r\n                const previewCtx = previewCanvas.getContext('2d');\r\n                previewCtx.save();\r\n                previewCtx.clearRect(0, 0, renderW, renderH);\r\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\r\n                previewCtx.restore();\r\n\r\n                const pW = settings.width * previewFactor;\r\n                const pH = settings.height * previewFactor;\r\n\r\n                const overlayCtx = overlayCanvas.getContext('2d');\r\n                overlayCtx.save();\r\n                overlayCtx.clearRect(0, 0, w, h);\r\n                overlayCtx.strokeStyle = '#fff';\r\n                sharpStrokeRect(\r\n                    overlayCtx,\r\n                    settings.x * previewFactor,\r\n                    settings.y * previewFactor,\r\n                    pW,\r\n                    pH\r\n                );\r\n                if (settings.blend > 0.05) {\r\n                    overlayCtx.strokeStyle = '#f0f';\r\n                    sharpStrokeRect(\r\n                        overlayCtx,\r\n                        settings.x * previewFactor - pW / 2 * settings.blend,\r\n                        settings.y * previewFactor - pH / 2 * settings.blend,\r\n                        pW * (1 + settings.blend),\r\n                        pH * (1 + settings.blend),\r\n                    );\r\n                }\r\n                overlayCtx.restore();\r\n\r\n\r\n\r\n            } else { // after\r\n                fullSizeCtx.clearRect(0, 0, width, height);\r\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\r\n                drawPattern(fullSizeCtx, settings);\r\n\r\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\r\n                const previewCtx = previewCanvas.getContext('2d');\r\n                previewCtx.clearRect(0, 0, renderW, renderH);\r\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\r\n            }\r\n\r\n\r\n            klCanvasPreview.render();\r\n            lastDrawnSettings = BB.copyObj(settings);\r\n        }\r\n\r\n        updatePreview();\r\n\r\n\r\n        // ----- result -------------------\r\n        const result: IFilterGetDialogResult = {\r\n            element: rootEl,\r\n            destroy: () => {\r\n                blendSlider.destroy();\r\n                keyListener.destroy();\r\n                pointerListener.destroy();\r\n            },\r\n            getInput: () => BB.copyObj(settings),\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const klCanvas = params.klCanvas;\r\n        const ctx = params.context;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        drawPattern(ctx, params.input);\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"pattern\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl.types';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {LANG} from '../../language/language';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\n\r\n\r\n// see glfx distort\r\ninterface IDistortSettings {\r\n    stepSize: number; // [0, inf]\r\n    distortType: 0 | 1 | 2;\r\n    scale: { x: number; y: number };\r\n    strength: { x: number; y: number };\r\n    phase: { x: number; y: number };\r\n}\r\n\r\n\r\n\r\nexport const filterDistort = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const rootEl = BB.el({\r\n            content: LANG('filter-distort-description') + '<br><br>',\r\n        });\r\n        const context = params.context;\r\n        const width = context.canvas.width;\r\n        const height = context.canvas.height;\r\n\r\n        let isSynced = true;\r\n        let settings: IDistortSettings = {\r\n            distortType: 0,\r\n            scale: {x: 100, y: 100},\r\n            strength: {x: 20, y: 20},\r\n            phase: {x: 0, y: 0},\r\n            stepSize: 1,\r\n        };\r\n        // let lastDrawnSettings = null;\r\n\r\n        // ---- thumb -------\r\n        const thumbImgArr = [];\r\n        const thumbSize = 32;\r\n        {\r\n            const canvas = BB.canvas(thumbSize, thumbSize);\r\n            const ctx = canvas.getContext('2d');\r\n\r\n            ctx.beginPath();\r\n            ctx.arc(thumbSize / 2, thumbSize / 2, thumbSize / 2.5, 0, Math.PI * 2);\r\n            ctx.fill();\r\n\r\n            let gradient = ctx.createLinearGradient(0, 0, thumbSize, thumbSize);\r\n            gradient.addColorStop(0, '#00f');\r\n            gradient.addColorStop(0.5, '#f00');\r\n            gradient.addColorStop(1, '#fff');\r\n            ctx.fillStyle = gradient;\r\n            ctx.globalCompositeOperation = 'source-atop';\r\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\r\n\r\n            gradient = ctx.createLinearGradient(thumbSize, 0, 0, thumbSize);\r\n            gradient.addColorStop(0, '#000');\r\n            gradient.addColorStop(1, '#000');\r\n            ctx.fillStyle = gradient;\r\n            ctx.globalCompositeOperation = 'destination-atop';\r\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\r\n\r\n            const glCanvas = getSharedFx();\r\n            const texture = glCanvas.texture(canvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            const scaleFactor = 20;\r\n\r\n            [0, 1, 2].forEach(item => {\r\n                const thumbImg = new Image();\r\n                const settingsCopy = BB.copyObj(settings);\r\n                settingsCopy.distortType = item;\r\n                settingsCopy.scale.x /= scaleFactor;\r\n                settingsCopy.scale.y /= scaleFactor;\r\n                settingsCopy.strength.x /= scaleFactor;\r\n                settingsCopy.strength.y /= scaleFactor;\r\n                glCanvas.draw(texture).multiplyAlpha().distort(settingsCopy).unmultiplyAlpha().update();\r\n                ctx.clearRect(0, 0, thumbSize, thumbSize);\r\n                ctx.drawImage(glCanvas, 0, 0);\r\n                thumbImg.src = canvas.toDataURL('image/png');\r\n                thumbImgArr.push(thumbImg);\r\n            });\r\n\r\n            texture.destroy();\r\n        }\r\n\r\n\r\n        // ---- controls ----\r\n\r\n        const topRowEl = BB.el({\r\n            parent: rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            }\r\n        });\r\n\r\n        const typeOptions = new Options({\r\n            optionArr: thumbImgArr.map((img, index) => {\r\n                BB.css(img, {\r\n                    margin: '1px',\r\n                    borderRadius: '3px',\r\n                    transition: 'all 0.1s ease-in-out',\r\n                })\r\n                return {\r\n                    id: '' + index,\r\n                    label: img,\r\n                };\r\n            }),\r\n            initialId: '0',\r\n            onChange: (id) => {\r\n                settings.distortType = Number(id) as any;\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        function sync(from: 'x' | 'y') {\r\n            if (from === 'x') {\r\n                settings.scale.y = settings.scale.x;\r\n                settings.strength.y = settings.strength.x;\r\n                settings.phase.y = settings.phase.x;\r\n\r\n                sliderArr[3].setValue(settings.scale.y);\r\n                sliderArr[4].setValue(settings.strength.y);\r\n                sliderArr[5].setValue(settings.phase.y);\r\n            } else {\r\n                settings.scale.x = settings.scale.y;\r\n                settings.strength.x = settings.strength.y;\r\n                settings.phase.x = settings.phase.y;\r\n\r\n                sliderArr[0].setValue(settings.scale.x);\r\n                sliderArr[1].setValue(settings.strength.x);\r\n                sliderArr[2].setValue(settings.phase.x);\r\n            }\r\n            updatePreview();\r\n        }\r\n\r\n        const syncToggle = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-distort-sync-xy'),\r\n            callback: (val) => {\r\n                isSynced = val;\r\n                if (isSynced) {\r\n                    sync('x');\r\n                }\r\n            },\r\n        });\r\n\r\n        topRowEl.append(\r\n            typeOptions.getElement(),\r\n            BB.el({css: {flexGrow: '1'}}),\r\n            syncToggle.getElement(),\r\n        );\r\n\r\n        const xyRowEl = BB.el({\r\n            parent: rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n            }\r\n        });\r\n        const leftCol = BB.el({\r\n            parent: xyRowEl,\r\n            css: {\r\n                marginRight: '10px',\r\n            }\r\n        });\r\n        const rightCol = BB.el({parent: xyRowEl});\r\n\r\n        const sliderWidth = isSmall ? 300 : 245;\r\n        const sliderArr: KlSlider[] = [];\r\n\r\n        ['x', 'y'].forEach((item, index) => {\r\n            const targetEl = index === 0 ? leftCol : rightCol;\r\n\r\n            const scaleSlider = new KlSlider({\r\n                label: LANG('filter-noise-scale') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 1,\r\n                max: 1000,\r\n                curve: 'quadratic',\r\n                value: settings.scale[item],\r\n                eventResMs: eventResMs,\r\n                onChange: (val) => {\r\n                    settings.scale[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                }\r\n            });\r\n            scaleSlider.getElement().style.marginTop = '20px';\r\n            targetEl.append(scaleSlider.getElement());\r\n\r\n            const strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                curve: 'quadratic',\r\n                value: settings.strength[item],\r\n                eventResMs: eventResMs,\r\n                onChange: (val) => {\r\n                    settings.strength[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                }\r\n            });\r\n            strengthSlider.getElement().style.marginTop = '10px';\r\n            targetEl.append(strengthSlider.getElement());\r\n\r\n            const phaseSlider = new KlSlider({\r\n                label: LANG('filter-distort-phase') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: settings.phase[item],\r\n                manualInputRoundDigits: 2,\r\n                eventResMs: eventResMs,\r\n                formatFunc: (val) => BB.round(val, 2),\r\n                onChange: (val) => {\r\n                    settings.phase[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                }\r\n            });\r\n            phaseSlider.getElement().style.marginTop = '10px';\r\n            targetEl.append(phaseSlider.getElement());\r\n\r\n            sliderArr.push(scaleSlider);\r\n            sliderArr.push(strengthSlider);\r\n            sliderArr.push(phaseSlider);\r\n        });\r\n\r\n        const stepSlider = new KlSlider({\r\n            label: LANG('filter-distort-stepsize'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1,\r\n            max: 300,\r\n            curve: 'quadratic',\r\n            value: settings.stepSize,\r\n            eventResMs: eventResMs,\r\n            onChange: (val) => {\r\n                settings.stepSize = Math.round(val);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        stepSlider.getElement().style.marginTop = '20px';\r\n        rootEl.append(stepSlider.getElement());\r\n\r\n\r\n        // ---- preview ----\r\n\r\n        const klCanvas = params.klCanvas;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const previewWrapper = BB.el({\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                marginLeft: \"-20px\",\r\n                height: isSmall ? '260px' : '300px',\r\n                backgroundColor: \"#9e9e9e\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n                marginTop: '10px',\r\n            }\r\n        });\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return; // todo throw?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: glCanvas,\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const previewLayerArr = layers.map((item, i) => {\r\n            if (i === selectedLayerIndex) {\r\n                return previewLayer;\r\n            } else {\r\n                return {\r\n                    image: item.context.canvas,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                };\r\n            }\r\n        });\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n        rootEl.append(previewWrapper);\r\n\r\n        // ---------- rendering ---------------------\r\n\r\n        function updatePreview() {\r\n            glCanvas.draw(texture).multiplyAlpha().distort(settings).unmultiplyAlpha().update();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n\r\n        // ----- result -------------------\r\n        const result: IFilterGetDialogResult = {\r\n            element: rootEl,\r\n            destroy: () => {\r\n                typeOptions.destroy();\r\n                sliderArr.forEach(item => item.destroy());\r\n                stepSlider.destroy();\r\n                syncToggle.destroy();\r\n                texture.destroy();\r\n            },\r\n            getInput: () => BB.copyObj(settings),\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const klCanvas = params.klCanvas;\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).multiplyAlpha().distort(params.input).unmultiplyAlpha().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"distort\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/base-components/input';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {drawVanishPoint} from \"../image-operations/draw-vanish-point\";\r\nimport {KlSlider} from \"../ui/base-components/kl-slider\";\r\nimport {eventResMs} from \"./filters-consts\";\r\nimport {IVector2D} from \"../../bb/bb.types\";\r\n\r\n\r\n\r\nexport const filterVanishPoint = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        div.innerHTML = LANG('filter-vanish-point-description') + \"<br/><br/>\";\r\n\r\n        const settingsObj = {\r\n            x: context.canvas.width / 2,\r\n            y: context.canvas.height / 2,\r\n            lines: 8,\r\n            thickness: 2,\r\n            color: {r: 0, g: 0, b: 0},\r\n            opacity: 1,\r\n        };\r\n\r\n        const linesSlider = new KlSlider({\r\n            label: LANG('filter-vanish-point-lines'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 2,\r\n            max: 20,\r\n            value: settingsObj.lines,\r\n            curve: 'quadratic',\r\n            eventResMs: eventResMs,\r\n            onChange: function (val) {\r\n                settingsObj.lines = Math.round(val);\r\n                updatePreview();\r\n            },\r\n        });\r\n        linesSlider.getElement().style.marginBottom = '10px';\r\n        div.append(linesSlider.getElement());\r\n\r\n        let line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            }\r\n        });\r\n        let line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px'\r\n            }\r\n        });\r\n        const xInput = input({\r\n            init: settingsObj.x,\r\n            type: 'number',\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const yInput = input({\r\n            init: settingsObj.y,\r\n            type: 'number',\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.copyObj(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function(rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                settingsObj.color = BB.copyObj(selectedRgbaObj);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            })\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n                cursor: 'move',\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n\r\n        // ---- preview input processing ----\r\n        const inputs: {\r\n            start: IVector2D;\r\n            end: IVector2D;\r\n            state: null | 'move';\r\n            oldSettings: any;\r\n        } = {\r\n            start: null,\r\n            end: null,\r\n            state: null,\r\n            oldSettings: null,\r\n        };\r\n        function syncInputs(): void {\r\n            xInput.value = '' + settingsObj.x;\r\n            yInput.value = '' + settingsObj.y;\r\n        }\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        previewInnerWrapper.style.touchAction = 'none';\r\n        const pointerListener = new BB.PointerListener({\r\n            target: previewInnerWrapper,\r\n            onPointer: (event) => {\r\n                if (event.type === 'pointerdown') {\r\n                    if (!inputs.state) {\r\n                        inputs.state = 'move';\r\n                        inputs.oldSettings = BB.copyObj(settingsObj);\r\n                        inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n                        inputs.end = null;\r\n                    }\r\n                } else if (event.type === 'pointermove') {\r\n                    if (inputs.state) {\r\n                        inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n\r\n                        settingsObj.x = Math.round(inputs.end.x - inputs.start.x + inputs.oldSettings.x);\r\n                        settingsObj.y = Math.round(inputs.end.y - inputs.start.y + inputs.oldSettings.y);\r\n\r\n                        syncInputs();\r\n                        updatePreview();\r\n                    }\r\n                } else if (event.type === 'pointerup') {\r\n                    if (inputs.state) {\r\n                        inputs.state = null;\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawVanishPoint(\r\n                ctx,\r\n                settingsObj.x * renderFactor,\r\n                settingsObj.y * renderFactor,\r\n                settingsObj.lines,\r\n                Math.max(settingsObj.thickness * renderFactor, 1),\r\n                settingsObj.color,\r\n                settingsObj.opacity,\r\n            );\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            linesSlider.destroy();\r\n            pointerListener.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawVanishPoint(\r\n            context,\r\n            params.input.x,\r\n            params.input.y,\r\n            params.input.lines,\r\n            params.input.thickness,\r\n            params.input.color,\r\n            params.input.opacity\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"filter\", \"vanishPoint\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","import {drawShape} from \"./shape-tool\";\r\nimport {BB} from \"../../bb/bb\";\r\nimport {IRGB} from \"../kl.types\";\r\n\r\nexport function drawVanishPoint(\r\n    ctx: CanvasRenderingContext2D,\r\n    x: number,\r\n    y: number,\r\n    lines: number, // int, [2, inf]\r\n    thickness: number, // px\r\n    color: IRGB,\r\n    opacity: number, // 0 - 1\r\n): void {\r\n    ctx.save();\r\n\r\n    const degIncrement = 180 / lines;\r\n    for (let deg = 0; deg < 180; deg += degIncrement) {\r\n        const p2 = BB.rotateAround({x, y}, {x: x + 9999, y}, deg);\r\n        drawShape(\r\n            ctx,\r\n            {\r\n                type: 'line',\r\n                x1: x,\r\n                y1: y,\r\n                x2: p2.x,\r\n                y2: p2.y,\r\n                //angleRad: 0,\r\n                isOutwards: true,\r\n                opacity,\r\n                //isEraser: false,\r\n                strokeRgb: color,\r\n                lineWidth: thickness,\r\n                //doLockAlpha: false,\r\n            }\r\n        );\r\n    }\r\n\r\n    ctx.restore();\r\n}","import {KL} from '../kl';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport async function klCanvasToPsdBlob(klCanvas: KlCanvas): Promise<Blob> {\r\n    let layerArr = klCanvas.getLayersFast();\r\n\r\n    let psdConfig = {\r\n        width: klCanvas.getWidth(),\r\n        height: klCanvas.getHeight(),\r\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\r\n        children: []\r\n    };\r\n    for (let i = 0; i < layerArr.length; i++) {\r\n        // todo - can be optimized if layer mostly empty\r\n        let item = layerArr[i];\r\n        psdConfig.children.push({\r\n            name: item.name,\r\n            opacity: item.opacity,\r\n            canvas: item.canvas,\r\n            blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n            left: 0,\r\n            top: 0\r\n        });\r\n    }\r\n\r\n    let agPsd = await import('ag-psd');\r\n    let buffer = agPsd.writePsdBuffer(psdConfig);\r\n    return new Blob([buffer], { type: 'application/octet-stream' });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"k9Nks\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"bBxqy\");"],"names":["$3kC7t","parcelRequire","$d2fa9a947070c225$export$a84540bc8b694b2d","p","klApp","agPsd","onProjectReady","project","isInitialized","Error","saveReminder","$5ngYX","SaveReminder","$gWfkn","klHistory","isDrawing","$3C7jC","KlApp","bottomBar","aboutEl","embed","url","embedUrl","onSubmit","init","loadingScreenEl","parentNode","removeChild","loadingScreenTextEl","document","body","appendChild","getEl","e","textContent","className","console","error","psdQueue","getElementById","$1mH1z","LANG","this","openProject","initError","getPNG","getPSD","default","$parcel$interopDefault","$cijLd","mark","_callee","readPSDs","psds","length","readItem","item","psd","readPsd","blob","$941rU","klPsdToKlProject","callback","forEach","_ctx","sent","shift","push","Element","prototype","Object","defineProperty","value","x","y","scrollLeft","scrollTop","window","getItem","setItem","removeItem","t","Array","slice","call","arguments","n","createDocumentFragment","Node","createTextNode","String","Document","DocumentFragment","hasOwnProperty","configurable","enumerable","writable","insertBefore","firstChild","padStart","repeat","$cf5d938ee512ebca$export$96f6458b62e4c2c","pProject","pOptions","ref","translateSmoothing","s","sizeWatcher","val","brushSettingService","emitSize","klCanvasWorkspace","setCursorSize","importFinishedLoading","importedImage","filename","optionStr","getResizedDimensions","width","height","w","parseInt","h","klMaxCanvasSize","importAsImage","canvas","resizedDimensions","tempCanvas","$eWjiX","BB","getContext","drawImage","resizeCanvas","reset","image","layerName","layerManager","update","setCurrentLayer","klCanvas","getLayer","resetView","handUi","getScale","getAngleDeg","importAsImagePsd","convertedPsdObj","cropObj","crop","targetCanvas","cropCanvas","layers","i","layerIndex","i1","item1","KL","showImportAsLayerDialog","klRootEl","transformObj","isPixelated","pause","addLayer","getLayers","renameLayer","activeLayerIndex","activeLayerContext","getLayerContext","drawTransformedImageWithBounds","tool","action","params","copyCanvas","isNaN","popup","type","message","buttons","$hrnUX","showImportImageDialog","target","maxSize","res","importAsLayer","files","showWarningPsdFlattened","file","name","split","extension","toLowerCase","f","size","loaderIsOpen","result","closeLoader","FileReader","readerResult","loadAgPsd","then","agPsdLazy","doShowLoader","maxResolution","replace","convertedPsd","PSD","skipLayerImageData","skipThumbnail","e1","catch","alert","match","URL","webkitURL","createObjectURL","im","Image","src","loadImage","hasUnsupportedFile","collapseThreshold","getElement","style","display","setDirection","uiState","isOpen","css","toolspaceCollapser","left","right","setSize","Math","max","uiWidth","toolWidth","uiHeight","setWide","statusOverlay","toolspace","borderLeft","borderRight","setUiState","updateCollapse","toolspaceScroller","updateUiState","layer","currentLayerCtx","context","currentBrush","setContext","layerPreview","setLayer","newImageDialog","currentColor","klColorSlider","getSecondaryRGB","getWidth","getHeight","innerWidth","color","a","onCancel","shareImage","shareCanvas","getCompleteCanvas","fileName","getDate","filenameBase","title","mainTabRow","activeStr","toolspaceToolRow","getActive","oldTabId","getOpenedTabId","keysArr","keys","draw","hand","gradient","text","shape","setIsVisible","open","showCrop","clipboardDialog","inputObj","top","bottom","filterLib","cropExtend","apply","input","history","updateBottomBar","isVisible","innerHeight","toolspaceInner","scrollHeight","bottomBarWrapper","min","screen","$6l0gQ","LocalStorage","app","projectStore","createElement","exportType","KlCanvas","projectObj","setHistory","layerFill","b","initState","copy","focus","getLayerCount","brushes","destroy","currentBrushId","RGB","lastNonEraserBrushId","BrushSettingService","setColor","copyObj","opacity","setOpacity","getColor","brushUiObj","getSize","getOpacity","sizeSlider","brushesUI","opacitySlider","lineSmoothing","EventChain","LineSmoothing","smoothing","LineSanitizer","lineSanitizer","setChainOut","event","pointerEvents","startLine","pressure","requestFrame","goLine","isCoalesced","setLastDrawEvent","endLine","getBrush","drawLineSegment","x0","y0","x1","y1","textToolSettings","align","isBold","isItalic","KlCanvasWorkspace","drawEventChain","chainIn","rgbObj","isDragDone","pickingDone","setMode","canvasX","canvasY","getLayerIndex","floodFill","fillUi","getIsEraser","getTolerance","getSample","getGrow","getContiguous","typeStr","angleRad","gradientTool","onDown","onMove","onUp","dialogCounter","get","textToolDialog","font","colorRGBA","textStr","ColorConverter","toRgbaStr","shapeTool","viewChangeObj","changed","includes","out","scale","angleDeg","angle","PI","setEnableZoomIn","getMaxScale","setEnableZoomOut","getMinScale","canUndo","undoRedoCatchup","undo","canRedo","redo","KeyListener","keyStr","comboStr","isInputFocused","getIsDrawing","zoomByStep","keyListener","isPressed","fitView","preventDefault","sameKeys","prev","next","store","getProject","t0","stop","copyToClipboard","comboOnlyContains","translateView","setAngle","decreaseSize","increaseSize","eraserBrush","getIsTransparentBg","clearLayer","r","g","setActive","updateMainTabVisibility","brushTabRow","newMode","getMode","swapColors","KlImageDropper","onDrop","handleFileSelect","enabledTest","addEventListener","pasteEvent","clipboardData","undefined","items","indexOf","getAsFile","retrieveImageFromClipboardAsBlob","imageBlob","img","onload","revokeObjectURL","URLObj","getAsString","pasteStr","trim","onerror","log","crossOrigin","hexToRGB","b1","Ui","onOpacityChange","emitOpacity","onConfigChange","emitSliderConfig","ui","padding","position","StatusOverlay","el","oncontextmenu","onclick","handleClick","overlayToolspace","ToolspaceCollapser","setTimeout","OverlayToolspace","append","toolspaceTopRow","$85H3x","ToolspaceTopRow","showIframePopup","wrap","abrupt","parent","overlay","_ref","updateUi","logoImg","onLogo","$5ebUJ","onNew","showNewImageDialog","onImport","fileTab","triggerImport","onSave","saveToComputer","save","onShare","classList","add","marginBottom","ToolspaceToolRow","onZoomIn","onZoomOut","onUndo","onRedo","setIsSmall","addListener","setEnableUndo","setEnableRedo","KlColorSlider","onPick","p_color","emitColor","setHeight","setPickCallback","doPick","brushDiv","colorDiv","flexWrap","justifyContent","alignItems","toolspaceStabilizerRow","ToolspaceStabilizerRow","onSelect","v","setSmoothing","getOutputElement","TabRow","tooltip","brushId","enable","onClose","keyArr","createTab","b2","HandUi","onFit","onAngleChange","isRelative","FillUi","colorSlider","gradientUi","GradientUi","TextUi","ShapeUi","GradientTool","isDone","x2","y2","settings","getSettings","gradientObj","color1","isReversed","doLockAlpha","isEraser","doSnap","setComposite","drawGradient","ctx","ShapeTool","shapeObj","shapeUi","getShape","isOutwards","getIsOutwards","getDoLockAlpha","strokeRgb","lineWidth","getLineWidth","isAngleSnap","getIsSnap","isFixedRatio","getIsFixed","fillRgb","drawShape","klLayerManager","LayerPreview","onClick","filterTab","FilterTab","UndoRedoCatchup","clctx","catchup","SaveToComputer","FileTab","imgurUpload","imgurKey","SettingsTab","$fxAg2","onOpen","minWidth","$2dTGs","$fuF9j","$3N9oF","$adBnR","textUi","$cafM1","$23J3k","show","hide","id","$eIlXd","settingsTab","MutationObserver","observe","attributes","childList","subtree","ToolspaceScroller","resize","scrollY","scrollTo","$3WOmu","klCanvasToPsdBlob","swapUiLeftRight","saveAsPsd","_this","zIndex","userSelect","ResizeObserver","windowResizeWatcher","$iUR3L","importFilters","$9cbe98d1fb398012$export$6e4a713ddcda1e5e","$dAXbp","$3P46L","$7pyBK","$705qg","drawProject","$aSJRf","WorkspaceSvgOverlay","$7bo3M","$lV6Vy","KlCanvasPreview","$i5nyl","filterLibStatus","$kyVjY","$6rdi0","renderText","$h20yl","floodFillBits","$30Cml","$3ujzu","$7EG77","setDbName","$9BlwZ","indexedDb","ProjectStore","$6mTnI","$lkluh","$eyygR","calcSliderFalloffFactor","$l4PqG","Checkbox","$lXqiv","$c4LUw","Select","$21VAD","ImageToggle","$jKOQl","ImageRadioList","$gmlbk","RadioList","$bHZQg","penPressureToggle","$fCJWy","KlSlider","$llzZ0","HexColorDialog","$lfHl9","$h7i9r","KlSmallColorSlider","$kzhsD","PointSlider","$bd9hB","ColorOptions","$9A7OD","Options","$iskOY","BoxToggle","$iDHln","$bmB93","CropCopy","$hRdOL","FreeTransform","$cNhNm","FreeTransformCanvas","$kEeSq","Cropper","$32CBv","$kqmpc","FittedImage","$j1kEL","$13r5y","$9p4Zp","$8jqzp","ToolDropdown","$84zxV","$9Kxky","$1Ax5m","$e4sAN","$1uc3b","BrowserStorageUi","$9pcu9","$iVHpg","$i8UFO","$ekHRj","Popup","exportDialog","$auloj","$isYih","$8ebuX","$76Qvv","$keKW3","$kDGzx","$5ENro","$khi8I","$dJXmR","$5Gc7M","$iS9xS","$9J17G","$eK8ID","$2umOB","$bIgqE","$5rdL4","DecoyKlHistory","$gFgFC","$b60fce38973759d6$var$historyInstance","$b60fce38973759d6$export$2a772a91f059c0f9","key","l","KlHistory","$7U0Ew","state","dataArr","listeners","pauseStack","maxState","actionNumber","pop","maxBefore","broadcast","bufferUpdate","$9fd01211d0fde0a8$export$63b4813c5280c707","close","isClosed","clearSelection","unfocusAnyInput","rootRootEl","decrease","destroyEl","xButton","bgEl","removeEventListener","rootEl","wheelPrevent","btnElArr","splice","increase","overflow","scrollContent","minHeight","flexDirection","ignoreBackground","tagName","content","concat","$fh18w","titleHeight","lineHeight","background","boxShadow","boxClasses","boxEl","div","marginRight","join","flex","clickOnEnterBtn","stopPropagation","click","autoFocus","buttonRowEl","marginTop","marginLeft","buttonName","iconUrl","btnClasses","primaries","label","$c0kqC","iconImg","custom","btn","clickOnEnter","closefunc","onscroll","$9fd01211d0fde0a8$export$129a32eedafa97c5","clearInterval","updateInterval","updatePos","elW","popupEl","offsetWidth","elH","offsetHeight","animationName","animationDuration","animationTimingFunction","isCssMinMaxSupported","borderRadius","titleEl","paddingLeft","tabindex","contentEl","$dd0d395ff14a3e11$export$17eb8275e0c4cab8","DialogCounter","count","emit","listener","$h4olN","$05ec456c8871d48f$export$921068d8846a1559","eventUsesHighResTimeStamp","$6J2My","mouseEventHasMovement","hasPointerEvents","hasWebGl","getVisitor","canShareFiles","insertAfter","$7jh4K","setAttributes","fitInto","centerWithin","gcd","reduce","decToFraction","imageBlobToUrl","dateDayDifference","createSvg","BbLog","$i0uIf","mix","$eg83P","dist","distSquared","lenSquared","pointsToAngleRad","pointsToAngleDeg","isInsideRect","clamp","rotate","rotateAround","Matrix","$kVHNC","Vec2","$4toIY","intDxy","roundEven","roundUneven","round","updateBounds","boundsInArea","projectPointOnLine","$af1iA","PointLine","BezierLine","SplineInterpolator","quadraticSplineInput","$eelgW","createCanvas","$eIcQa","testShouldPixelate","drawTransformedImageOnCanvas","createCheckerCanvas","createCheckerDataUrl","convertToAlphaChannelCanvas","freeCanvas","canvasBounds","HSV","$dJ1E2","CMYK","testIsWhiteBestContrast","appendTextDiv","$72Jv0","makeUnfocusable","setEventListener","$idV3L","PointerListener","$04lDo","$exufe","$cdd5ef6b176accd6$export$d031894fc27e45","DomEl","$cdd5ef6b176accd6$export$3f65cefe8380dbea","options","$cdd5ef6b176accd6$export$8ff9f68337b520c0","hasWebgl","visitor","test","$878b1f179a521546$export$b7d78993b74f766d","navigator","userAgent","$878b1f179a521546$export$4ec3bfbae69fbb50","Event","timeStamp","$878b1f179a521546$export$ebcc19037a7ab076","mouseEvent","MouseEvent","$878b1f179a521546$export$b7b64c480b083ae0","PointerEvent","$878b1f179a521546$export$9cbe517943afd6db","premultipliedAlpha","$878b1f179a521546$export$96cd70eaafd80100","chrome","gl","JSON","parse","stringify","$878b1f179a521546$export$fe0a7220ab4eecad","offsetLeft","$878b1f179a521546$export$558f5e20caee48c2","$44dda2e48e48a872$export$cd3d1f114b139967","$2bd9b7b9bc92046d$export$c4f94c8b3850a5a9","referenceNode","newNode","nextSibling","$2bd9b7b9bc92046d$export$fe58198efe02b173","counter","check","complete","$2bd9b7b9bc92046d$export$dbf350e5966cf602","styleObj","alignContent","webkitUserSelect","$2bd9b7b9bc92046d$export$74da2cba014bdc09","attrObj","setAttribute","$2bd9b7b9bc92046d$export$10d8903dec122b9d","els","fragment","$2bd9b7b9bc92046d$export$fa55905620c22535","aw","ah","bw","bh","$2bd9b7b9bc92046d$export$76d0c1a172b67a61","$2bd9b7b9bc92046d$export$aa350b96d91cd94","date","Date","getFullYear","getMonth","toString","getHours","getMinutes","$2bd9b7b9bc92046d$export$f81847884871263e","$2bd9b7b9bc92046d$export$533b26079ad0b4b","numerator","denominator","$2bd9b7b9bc92046d$export$8215e6b900906daa","decimalNumber","len","pow","$2bd9b7b9bc92046d$export$5063ec57a23c4f2e","blobObj","Blob","constructor","fauxBlob","encoding","data","$2bd9b7b9bc92046d$export$1093707c159148e8","dateA","dateB","setHours","getTime","$2bd9b7b9bc92046d$export$af0d87255f3cfd7e","obj","$2bd9b7b9bc92046d$export$331c30fd60da0115","mimetype","err","toBlob","filesArray","File","share","$2bd9b7b9bc92046d$export$b981489921ee18cd","clickEvent","allowClick","$2bd9b7b9bc92046d$export$c54fe3b9ecaa84cf","createElementNS","elementType","childrenArr","$74d1f29ad2137b2c$var$globalKey","emitDown","c","d","listenerArr","emitUp","keyDown","code","keyCode","keyToKeyStrObj","isDownObj","comboArr","codeIsDownObj","keyUp","oldComboStr","blur","eventArr","keyToKeyStrArr","keyStrToKeyObj","space","alt","ctrl","cmd","enter","esc","backspace","delete","sqbr_open","sqbr_close","u","z","plus","minus","up","down","home","end","first","remove","last","getIsDown","getCombo","$74d1f29ad2137b2c$export$f17908c5de22d32e","onBlur","keyStrArr","$74d1f29ad2137b2c$export$e9f65b0175de4c03","comboAStr","comboBStr","sort","pointerArr","pressureNormalizeAvgCount","pressureNormalizeAvgPressure","pressureNormalizeIsComplete","pressureNormalizeFactor","$893e90c2dcf687ac$var$WheelCleaner","endSequenceTimeout","delta","deltaY","sequenceUnit","pageX","pageY","clientX","clientY","endSequence","toEmitDelta","knownUnitArr","sequenceLength","process","clearTimeout","deltaMode","absDelta","abs","$893e90c2dcf687ac$export$9371bd96776f4e82","getDragObj","pointerId","dragObjArr","removeDragObj","removedDragObj","dragPointerIdArr","normalizePressure","correctPointerEvent","corrected","correctedObj","pointerType","movementX","movementY","timeStampOffset","button","eventStopPropagation","customPressure","isFirefox","coalescedEventArr","getCoalescedEvents","getPointer","pointerObj","lastPageX","lastPageY","addPointer","totalLastY","eventItem","coalescedArr","totalLastX","correctedEvent","targetElement","getBoundingClientRect","bounds","eventPreventDefault","coalescedItem","relX","relY","dX","dY","time","createTouchOutEvent","touchListItem","touchEvent","identifier","destroyDocumentListeners","onGlobalPointerMove","onGlobalPointerUp","onGlobalPointerLeave","onPointerEnter","isOverCounter","onEnterLeaveCallback","onPointerLeave","onPointermove","tempLastPointerType","lastPointerType","maxPointers","didSkip","outEvent","createPointerOutEvent","dragObj","downPageX","downPageY","buttonsToStr","clearTouchTimeout","setTouchTimeout","lastTimeStamp","outEvent1","onPointerCallback","touchTimeout","fakeEvent","performance","now","onTouchTimeout","onPointer","onWheelCallback","onWheel","onEnterLeave","wheelEvent","timing","navigationStart","onPointerdown","wheelCleaner","touchArr","changedTouches","touchObj","onTouchmove","onTouchend","$9a5bdb07e7a7c42f$export$2c9e8a9632a706b2","$9a5bdb07e7a7c42f$export$6c4a311cc157c764","ax","ay","bx","by","sqrt","$9a5bdb07e7a7c42f$export$499eb56409f6cbc2","$9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa","$9a5bdb07e7a7c42f$export$627023b405ba5028","p1","p2","atan2","$9a5bdb07e7a7c42f$export$c03a8450eabc2532","$9a5bdb07e7a7c42f$export$151bd845d70e2099","rect","$9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4","num","$9a5bdb07e7a7c42f$export$bb628a54ab399bc9","deg","theta","cs","cos","sn","sin","$9a5bdb07e7a7c42f$export$95ec0760d3d00713","center","point","rot","$9a5bdb07e7a7c42f$export$bbf9af158036c5e9","remainder","fDx","fDy","$9a5bdb07e7a7c42f$export$94cce7adf2ec2d08","above","ceil","below","floor","$9a5bdb07e7a7c42f$export$f373b6a7b0c159a","$9a5bdb07e7a7c42f$export$2077e0241d6afd3c","digits","digitMult","$9a5bdb07e7a7c42f$export$f4467a4f41373bc7","$9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac","$12950380ec51f25d$export$649a211db9812745","continueChain","chainArr","chainOut","func","$12950380ec51f25d$export$db3963a21c01d803","fail","sequenceArr","timeoutObj","maxUntilSecondDown","success","eventQueueArr","lastSequenceItem","onDoubleTap","setupTimeout","timeoutStr","targetFunc","timeMS","diff","nowTime","minSilenceBeforeDurationMs","maxPressedDurationMs","maxPressedDistancePx","maxInbetweenDistancePx","maxUpToUpDurationMs","maxUntilSecondDownDurationMs","minSilenceAfterMs","allowedPointerTypeArr","allowedButtonArr","pointersDownIdArr","lastUpTime","isDown","isUp","processEvent","setAllowedPointerTypeArr","arr","setAllowedButtonArr","firstDownTime","firstLastDownTimeout","tapTimeout","fingerArr","lastEventTime","fingers","maxFirstLastFingerDownMs","downTime","tempLastEventTime","maxTapMs","fingerObj","fingerObj1","i2","allAreUp","i3","onTap","gestureObj","doSwallow","secondFingerTimeout","touchPointerArr","isInProgress","continuePinch","index","otherPointerIdArr","downRelX","downRelY","untilSecondFingerDurationMs","endPinch","touchPointerObj","firstFingerMaxDistancePx","pincherArr","actionObj","startDist","distance","startAngle","onPinch","beginPinch","$12950380ec51f25d$export$fe11e0afe623a677","eventCopy","pointers","downPointerId","ignorePointerIdArr","pressure0","pressure1","eventQueue","shiftIsPressed","direction","downEvent","onDraw","$12950380ec51f25d$export$91dcf4209534d21f","lastMixedInput","inputX","inputY","inputPressure","$3f0e2f35371c9852$export$dd0873c0fb3ccff6","resultCanvas","$3f0e2f35371c9852$export$1555f643cc9a976","transform","scaleX","scaleY","whSwapped","$3f0e2f35371c9852$export$ded2b43392504635","destCtx","transformImage","pixelated","imageSmoothingEnabled","imageSmoothingQuality","translate","restore","$3f0e2f35371c9852$export$425a419ef9fc761f","baseCanvas","angleDegree","cache","$3f0e2f35371c9852$export$754559b36e94ea2f","fillStyle","fillRect","$3f0e2f35371c9852$export$42af33c76b681867","create","toDataURL","$3f0e2f35371c9852$export$59b33278b5b2fc8a","tmp1","tmp2","oldW","oldH","newW","newH","ew","eh","base2","oldWidthEx","log2","oldHeightEx","newWidthEx","newHeightEx","buffer1","buffer2","bufferCtx","globalCompositeOperation","currentWidth","currentHeight","newWidth","newHeight","tmp","canvasCtx","tmp1Ctx","$3f0e2f35371c9852$export$5a7576952c826b4f","imdat","getImageData","putImageData","$3f0e2f35371c9852$export$2384aff49c9b73c2","clearRect","$3f0e2f35371c9852$export$3db033c6ee0b8700","boundsObj","tempBounds","multiplyMatrixAndPoint","$e4df33b4b16105d5$export$5b12bf1653c0dd85","getIdentity","matrix","multiplyMatrices","matrixA","matrixB","row0","row1","row2","row3","result0","result1","result2","result3","createTranslationMatrix","createRotationMatrix","createScaleMatrix","$531c9f41f98b7ec0$export$ac4bca90992eed1","sub","nor","mul","dot","aArr","bArr","map","m","$77ae015f37ebe4f1$export$b4c5b177db876445","lineStart","lineEnd","$77ae015f37ebe4f1$export$8b36a4a83269a640","segmentArr","points","getAtDist","getLength","fac","pointArr","lastSpacing","spacing","controlsCallback","lastPoint","dir","lastDot","pointM1","pointM2","pointM3","curvePoints","p3","p4","resolution","getBezierPoints","pointLine","tempSpacing","lastCallbackPoint","dAngle","lastAngle","addFinal","newP","xa","ya","wx","sig","ddydx","getFirstX","getLastX","interpolate","klo","khi","k","$77ae015f37ebe4f1$export$80967b1eb9fd6eb4","findX","$5e7aac2fa49b6b1f$export$d2edaecd208aed43","$5e7aac2fa49b6b1f$export$8f9ece5a47764b93","$5e7aac2fa49b6b1f$export$89d3f85304bf0767","$5e7aac2fa49b6b1f$export$fb7efcd2e153af6e","_RGBtoHSV","minVal","maxVal","del_R","del_G","del_B","_HSVtoRGB","var_h","var_i","var_1","var_2","var_3","var_r","var_g","var_b","_CMYKtoRGB","_RGBtoCMYK","toRGB","o","toHSV","toCMYK","toHexString","ha","hb","hc","toRgbStr","rgbaObj","hexStr","exec","$5e7aac2fa49b6b1f$export$5cf396345d1238ae","$cfe3aa45a75894cc$export$7868464f598ba79d","innerHTML","$cfe3aa45a75894cc$export$906dfdb7df31ccfc","getAll","activeElement","getAttribute","$cfe3aa45a75894cc$export$e05240ca9e0b8bd9","focusEl","select","$cfe3aa45a75894cc$export$a3d02541b0ebf605","getSelection","sel","empty","removeAllRanges","selection","didFocusRelated","relatedTarget","currentTarget","preventFocus","$cfe3aa45a75894cc$export$c3da0dad1b44eea9","isArray","onChange","$cfe3aa45a75894cc$var$els","customKeyArr","$0d0e99c175410ac4$export$9860cd9e09e6f8ba","msg","$9e5fd8359d8b22f2$export$19fffca37ef3e106","localStorage","module","exports","getBundleURL","resolve","$d82e0c66c1aaca81$export$48513f6b9f8ce62d","doHighlight","element","innerEl","checked","allowTab","tabIndex","onchange","toggle","$aa0ec58519fa7d10$export$b7e3ae3d7c15e42e","$eb01976a4bab51ce$export$ef9b1a59e592288f","selectEl","changeListener","cursor","fontSize","colorScheme","isFocusable","optionArr","option","initValue","$5cde84e643fb89d6$export$b6d053cded550773","isActive","backgroundImage","isRadio","setValue","getValue","$459eb3dcb08ae3f8$export$7cc1012a658e6ad8","activeIndex","createOption","initId","radioEl","$12a3b74a8702bb1f$export$77219f67585650fa","isChecked","changeCallback","redraw","toggleDiv","backgroundColor","border","cssFloat","$e1Rnq","backgroundSize","backgroundRepeat","boxSizing","$cf8be10874d1afb1$export$a1855b925e534de7","isEnabled","manualInputRoundDigits","useSpline","curve","elementWidth","elementHeight","displayValueToValue","valueToDisplayValue","toValue","displayValue","toDisplayValue","isChangeOnFinal","formatFunc","eventResMs","curveArr","splineInterpolator","roolEl","sliderWrapperEl","labelFontSize","textEl","control","valueToSliderValue","controlInner","updateEnable","doubleTapper","DoubleTapper","showManualInput","virtualVal","eventChain","pointerListenerTimeout","pointerListener","fixScribble","sliderValue","sliderValuetoValue","updateLabel","deltaX","sliderValue1","toLocaleString","languageStrings","getCode","isFinal","emitInterval","emitValue","setInterval","manualInput","setIsEnabled","$348ou","KlSliderManualInput","config","isDisabled","$0c2dd884393cffca$export$f8e41e222e32615d","isRightButton","$a36067096711f77d$export$db3d4fde05db9a5e","roundDigits","currentValue","onblur","privateOnClose","scrollBefore","scrollX","lastValue","Number","$dada52d673c8c4ac$export$cc42e119007cb939","createRgbInputRow","labelStr","attributeStr","rowEl","labelEl","inputEl","lastValidRgb","parseFloat","previewEl","hexInput","hexRowEl","hexLabel","rgbArr","copyButton","$fcsnL","execCommand","resultStr","$9eeb6c00ea2d3242$export$4e5102252876c5d7","updatePrimaryHSV","hsv","primaryColorHSV","updateSVCanvas","rgb","hueStop","updateSVPointer","svHeight","pointerSV","setColPreview","divPreview","primaryColorRGB","pickerButton","filter","hexButton","updateSecondaryColor","secondaryColorBtn","secondaryColorRGB","secondaryColorHSV","controlH","pickCallback","outputDiv","startValue","svWrapper","svSvg","DOMParser","parseFromString","documentElement","divH","SVContainer","virtualHSV","$1nsGS","backgroundPosition","isPicking","isOver","targetEl","cv","gradH","createLinearGradient","col","addColorStop","createHueBg","factor","$3ac3f56275b45315$export$dcd33f7653c95f09","updateSV","canvasSV","gradient1","colleft","colright","heightSV","updateHPointer","pointerH","canvasH","heightH","svPointerId","svPointerListener","hPointerId","hPointerListener","cleardiv","clear","$0b17443c34517974$export$ac00cea56cec3037","param","redrawPoint","sliderPoint","sliderPos","isDragging","pointSize","sliderLine","isFirst","imaginaryPos","margin","transition","$a19b2655062f09b7$export$24ba9b81662d4366","buttonArr","setIsSelected","selectedIndex","colorArr","checkerUrl","found","sItem","initialIndex","colorButton","buttonSize","textAlign","$c8511e371b1e3768$export$c019608e5b5bb4cb","optionObj","classArr","isSmall","wrapperEl","selectedId","getIndex","initialId","changeOnInit","previous","$c1a93a3cd82636c9$export$5ee0af1d5c87e856","removeProperty","isWide","angleIm","$bv5Zj","verticalAlign","innerInnerEl","doPulse","animation","timeout3","timeout","timeout2","$81ac8fccf3fa43c3$export$8e17099f54853f0e","aboutDiv","closed","aniToggle","imageContainer","coverImage","coverSize","aniTimeout","boxSize","ontouchstart","ontouchmove","ontouchend","$01fcd0ed15aa4018$export$40175a5948a88a57","resetCrop","updateCroppedCanvas","croppedCanvas","croppedImage","updateSelectionRect","selectionRect","thumbX","scaleW","thumbY","scaleH","toOriginalSpace","genCrop","topLeftP","bottomRightP","origTopLeftP","origBottomRightP","isReset","eventTarget","isNotCopy","previewWrapper","thumbSize","thumbCanvas","imageRendering","thumbCtx","startP","updateCropTimeout","startCrop","didMove","doUpdate","stepSize","getRect","getCroppedImage","$ffd40240385bb9f9$export$32b89bc9bb92706a","fullCanvas","cropCallback","output","toClipboard","imgURL","cropCopy","fetch","clipboard","write","ClipboardItem","clipboardItemIsSupported","topWrapper","borderTop","borderBottom","KeyEvent","rectObj","$aacd8170d7ccb1c6$export$56cc6eb0b4c43d97","p_canvas","p_func","p_rootDiv","oldHistoryState","row","clearBtn","$8yL1I","suggestions","suggestionBtns","createLayerList","updatefunc","createLayerEntry","klCanvasLayerArr","layercanvas","layerElArr","posY","innerLayer","container1","container2","spot","oldOpacity","thumbDimensions","thumb","thc","lname","whiteSpace","ondblclick","opacityLabel","isLast","layerOpacity","largeThumbCanvas","largeThumbDiv","largeThumbInDocument","largeThumbInTimeout","largeThumbTimeout","dragstart","freshSelection","lastpos","isSelected","activateLayer","updateLayersVerticalPosition","posToSpot","newSpot","oldSpot","move","selectedSpotIndex","layerListEl","getState","child","updateHeight","layerHeight","layerSpacing","newspot","posy","oldSpotIndex","newSpotIndex","moveLayer","mergeBtn","disabled","listdiv","disableButtons","enableButtons","modeWrapper","modeSelect","addnewBtn","duplicateBtn","removeBtn","renameBtn","paddingRight","$d42vI","$dKwR8","$3VpTB","$g91IK","clearboth","MAX_LAYERS","duplicateLayer","removeLayer","mixModeStr","$bBcC4","translateBlending","topCanvas","preview","spacer","alphaCanvas","bottomCanvas","globalAlpha","topOpacity","mergeDialog","mode","mergeLayers","createButtons","setMixMode","historyState","activeLayerSpotIndex","getSelected","spotIndex","stateStr","$0621fc8724f6bfac$var$allowedMixModes","$0621fc8724f6bfac$export$9f4f73b1bd7c2f26","$0621fc8724f6bfac$export$4a819bde91671014","layerNrOffset","layerCanvasArr","pickCanvas","changeListenerArr","origLayers","updateIndices","toCopyCanvas","algorithm","layerCanvas","layerContext","offX","offY","ctemp","layerCtx","fillColor","selected","isLayerLimitReached","doReturnNull","emitChange","temp","targetIndex","layerBottomIndex","layerTopIndex","isHorizontal","isVertical","tempCtx","colorObj","compositeOperation","tolerance","sampleStr","grow","isContiguous","srcCanvas","srcData","srcCtx","srcImageData","targetImageData","targetCtx","srcIndex","targetData","imageData","canvasObj","$7069db2f5e23d00f$var$fillRect","$7069db2f5e23d00f$var$mx","$7069db2f5e23d00f$var$my","$7069db2f5e23d00f$var$moveIndex","$7069db2f5e23d00f$var$testAndFill","srcArr","targetArr","initRgba","px","py","q","tl","tr","br","bl","$01d7180c5d1d0fdf$export$27550cc14d7ae85a","downX","downY","downAngleRad","onShape","$01d7180c5d1d0fdf$export$71b514a25c47df50","defaults","property","$01d7180c5d1d0fdf$var$applyDefaults","colorRGB","strokeStyle","r1","r2","pAngleDeg","pAngleDegSnapped","rotated","r11","r21","rx","ry","rdX","rdY","x1r","y1r","x2r","y2r","x1f","y1f","x2f","y2f","beginPath","moveTo","lineTo","stroke","x1f1","y1f1","x2f1","y2f1","strokeRect","ellipse","fill","$fdc12d72a3df9be9$export$482c90f94eb9717c","outer","fontFamily","fontWeight","fontStyle","spanStr","children","offsetTop","el1","fillText","innerText","isDebug","$089586a542a12f27$export$5f63a7b18dc4503a","$5e45fa121ba5050f$export$74d12f09ff9f1956","onGradient","$5e45fa121ba5050f$export$b1f70a113e3b5c1b","baseColor","color2","createRadialGradient","$2f1281ced73ab1dc$export$6e1bedb2a6cdff30","blendMode","codes","darken","multiply","lighten","difference","exclusion","hue","saturation","luminosity","$d256278b259ca979$export$6b9252711ea5997f","rootElement","brushCircleOuter","brushCircleInner","pickerPreviewBorder","pickerPreviewCol","compassSize","compass","compassInner","compassBaseCircle","cx","cy","compassLineCircle","compassUpperTriangle","compassLowerTriangle","radius","borderColor","$d492af58f4721011$var$TMode","TMode","$d492af58f4721011$var$MIN_SCALE","$d492af58f4721011$export$6eaf6f7c0cc177fc","_this1","onViewChange","renderTargetCanvas","renderTargetCtx","renderWidth","renderHeight","compositeCanvas","compositeCtx","doResizeCanvas","oldTransformObj","targetTransformObj","highResTransformObj","renderedTransformObj","cursorPos","usesCssCursor","bgVisible","transformIsDirty","doAnimateTranslate","svgOverlay","emptyCanvas","isRepeat","currentInputProcessor","onKeyDown","Draw","Pick","Fill","Gradient","Text","Shape","globalMode","inputProcessorObj","spaceHand","Hand","altPicker","zoom","onKeyUp","updateChangeListener","currentMode","renderTime","lastDrawEvent","linetoolProcessor","LinetoolProcessor","getMatrix","art","getRenderedTransform","coords","matrix1","coords1","coords2","pointer","reqFrame","updateCursor","getComboStr","resetInputProcessor","coord","workspaceToCanvasCoord","onFill","onText","HandGrabbing","Zoom","offsetX","offsetY","internalZoomByStep","lastRenderedState","picker","pickedColor","getColorAt","updateColorPreview","Rotating","Rotate","centerObj","startAngleRad","dAngleRad","minimizeAngleRad","origin","angleIsExtraSticky","pinchZoomer","PinchZoomer","snapAngleRad","oldTransform","mainDoubleTapper","middleDoubleTapper","twoFingerTap","NFingerTapper","threeFingerTap","pointerEventChain","OnePointerLimiter","CoalescedExploder","brushRadius","animationFrameRequested","requestAnimationFrame","updateLoop","addChangeListener","modeInt","doForce","oldMode","$hNEwm","$iOLNv","$3zTyb","$kFdtJ","oldIsHand","currentIsHand","stepNum","centerX","centerY","newStep","newScale","effectiveFactor","transformA","transformB","blendFactor","centerPosA","canvasToWorkspaceCoord","centerPosB","mixedPos","workspacePointArr","borderSize","layerArr","getLayersFast","compositeObj","updateCompass","snapDegIncrement","maxDistDeg","modDeg","doRedrawCanvas","newState","elapsedFrames","lastRenderTime","doRender","checkChange","testBgVisible","start","klC","oldWidth","oldHeight","modeStr","diameter","hideBrushCursorTimeout","doAnimate","canvasPointsArr","boundsWidth","boundsHeight","oldAngleRad","tx","ty","$6faa9d948ec87f40$export$e258ade1648009b7","render","$0370167ee97a20d9$var$snapToPixel","$0370167ee97a20d9$var$copyTransform","$0370167ee97a20d9$var$toTransformSpace","$0370167ee97a20d9$var$toImageSpace","corners","isConstrained","snapX","snapY","snappingEnabled","ratio","transEl","boundsEl","boundsStartP","iP","minSnapDist","snap","distX","distY","j","projected","dist1","updateCornerPositions","updateDOM","gripSize","offsetArr","scaled","tinyOffset","cornerCursors","virtualPos","constrainCorner","snapCorner","tP","indexes","updateTransformViaCorners","edgeSize","edges","angleOffset","isInverted","pointerRemainder","tfD","ti","dimension","restoreRatio","angleGrip","$lQMok","anglePointerListener","offset","snapDeg","iX","iY","_x","_y","cornerIndex","flip","widthChanged","heightChanged","angle90","newHeight1","skipCallback","transformOrigin","$48f5d87739d28bf9$export$205c2dd29f8a66b5","updatePreview","freeTransform","getTransform","destCanvas","previewLayerArr","transformIndex","initTransform","klCanvasPreview","imageWidth","imageHeight","previewFit","innerWrapper","transformSize","setPos","setAngleDeg","fit","setTransformCenter","getTransformation","getIsPixelated","$de496a1759b04ed9$export$71ed2b85d4ca43d3","transformTop","grips","maxH","transformRight","maxW","transformBottom","transformLeft","commit","cornerElArr","outline","thirdsHorizontal","thirdsVertical","gripCursors","outlinePointerListener","gripOverlay","edge0PointerListener","edge1PointerListener","edge2PointerListener","edge3PointerListener","corner0PointerListener","corner1PointerListener","corner2PointerListener","corner3PointerListener","setTransform","setScale","showThirds","$18e69c7d4cb991e8$export$d25420b53e16716f","layerObj","largeCanvasAnimationTimeout","isInstant","nameLabelEl","opacityEl","lastDrawnSize","canvasDimensions","canvasSize","animationCanvas","animationCanvasCtx","animationCanvasCheckerPattern","animationCount","animationLength","animate","drawLargeCanvas","lastDrawnState","largeCanvasIsVisible","largeCanvasSize","largeCanvas","largeCanvasCtx","largeCanvasCheckerPattern","largeCanvasWrapper","removeLargeCanvas","largeCanvasAnimationDurationMs","contentWrapperEl","canvasWrapperEl","nameWrapper","flexGrow","nameFadeEl","clickableEl","webkitTouchCallout","createPattern","showLargeCanvas","currentState","klCanvasLayerObj","$a29ff52bf33e0691$export$83ae33786c7b4ee5","$e3dfa43019bc3f08$export$962af7e240721d88","freeTransformCanvas","noteEl","originalSizeBtn","fitSizeBtn","setTransformFit","centerBtn","importImage","buttonStr","$01cb8095758db224$export$e789742143ba5b1","rootCounter","optionLayerCounter","optionImageCounter","testAcceptType","dataTransfer","types","updateOptions","optionLayerEl","optionImageEl","paddingTop","textShadow","optionStyle","$d6fe881e8fc421ac$export$9f0da9b942594e99","updateColor","selectedColorEl","updateUI","mousePos","sizeObj","hHeight","sliderHeight","queuedObj","subscriptionFunc","initialColor","subscribe","sliderConfig","getSliderConfig","$6003e73b8cbb69e2$export$665d2c76b1eb8459","createButton","extraPadding","contain","logoButton","$8oUiM","newButton","$1gUFn","importButton","$gswMe","saveButton","$lLh5u","shareButton","$5xpQb","helpButton","onHelp","$kS5uZ","$18c597dee53260ff$export$a0a40f8a0b8fee15","createDropdownButton","wrapper","dropdownWrapper","smallMargin","onClickDropdownBtn","closeDropdown","currentActiveIndex","updateButton","showDropdown","dropdownBtnArr","arrowButton","activeButton","titleArr","activeButtonIm","imArr","openTimeout","startX","startY","elementFromPoint","$gzZrf","borderBottomLeftRadius","borderBottomRightRadius","$a372d78c806cd0cc$export$c744a22bef9e0b97","doEmit","currentActiveStr","toolDropdown","handButton","onActivate","doLighten","doMirror","createTriangleButton","svg","viewBox","preserveAspectRatio","defs","in","stdDeviation","dx","dy","in2","operator","k2","k3","svgTriangleLeft","class","onLeft","svgTriangleRight","onRight","leftPointerListener","rightPointerListener","leftIm","leftImage","rightIm","rightImage","setIsEnabledLeft","setIsEnabledRight","zoomInNOutButton","$3KoFh","$eWf2I","zoomInButton","zoomOutButton","undoNRedoButton","$fc34V","undoButton","redoButton","$90c04b5ac185bf3d$export$8162a66cd18867a7","strengthSelect","setDeltaValue","$d04d72b97d637d65$export$3c6d17ed0106bfb9","pTabObj","useAccent","openedTabObj","tabDiv","roundRight","roundLeft","tabArr","roundSize","$4m0AU","tabId","$9934467c988b088a$export$cf20160367bae46c","scaleEl","angleEl","resetButton","onReset","fitButton","leftRotateButton","$2n4Fs","resetAngleButton","rightRotateButton","pIsVisible","pScale","$51d47356d698ffec$export$1e63e3b0645421a2","toleranceSlider","selectRow","growWrapper","growSelect","contiguousToggle","eraserToggle","$d06987f550ff485e$export$32a22540e4b2f123","$45c003c723de07b5$export$a9387b1d4260d39c","updatePreviews","strokeWidth","lineWidthSlider","squish","rectStrokeSvgRect","rectFilledSvgRect","ellipseStrokeSvgEllipse","ellipseFilledSvgEllipse","lineSvgLine","fixedToggle","previewPadding","previewSize","snapToggle","rectStrokeSvg","rectFilledSvg","ellipseStrokeSvg","ellipseFilledSvg","lineSvg","shapeOptions","lockAlphaToggle","outwardsToggle","$4fb68589de8a8c9a$export$f77a89101d7d6586","createRatioSize","ratioX","ratioY","maxCanvasSize","updateRatio","widthInput","heightInput","commonRatios","reducedArr","closestRatio","closestDistance","ratioWrapper","realw","T","U","V","HCF","secondaryColor","canvasWidth","canvasHeight","workspaceWidth","workspaceHeight","onConfirm","newImDiv","widthWrapper","heightWrapper","widthUnit","heightUnit","templateWrapper","presetFitBtn","presetCurrentBtn","presetSquareBtn","presetLandscapeBtn","presetPortraitBtn","presetOversizeBtn","sizeObj1","backgroundRGBA","colorOptionsArr","colorOptions","previewcell","cell","onkeyup","secondRow","secondRowLeft","$3f73fb4b1b574d52$export$5b91f641162972fc","icon","directionStr","$jiQkU","dirStr","$3Rl3W","$cd9e7df6e228ea45$export$e263e067d6140649","textCtx","textCanvas","$a7ch7","textInput","alignRadioList","italicToggle","boldToggle","sizeInput","fontSelect","rotatedXY","rotatedWH","fitBounds","zoomFac","previewCanvas","layersCtx","previewCtx","checkerPattern","layersCanvas","changeZoomFac","zoomInBtn","canZoom","zoomOutBtn","onScroll","isSmallWidth","isSmallHeight","touchAction","previewPointerListener","row2n3Wrapper","unshift","fontPointerListener","zoomWrapper","sizePointerListener","$2dqOY","$rk4vM","$hucjG","$cZa2s","$03Zd8","placeholder","$c8d2eb7d799b314c$export$1bf16d9bd59fd8f9","resolutionEl","updateResolution","flattenCheckbox","doFlatten","noteStyle","warningArr","psdWarningArr","contentArr","warningMap","mask","clipping","group","adjustment","showWarnings","noteEl1","cropRect","$4c230b0de5e1a470$var$kl2PsdMap","$4c230b0de5e1a470$var$psd2KlMap","$4c230b0de5e1a470$var$init","$4c230b0de5e1a470$export$6df36f0c42d2440f","str","$4c230b0de5e1a470$export$4e3b1f7d3ad623b4","$4c230b0de5e1a470$export$3d649861c4b13fa2","psdObj","addWarning","warningStr","getMixModeStr","prepareMask","maskCanvas","defaultColor","groupMaskCtx","imData","bitsPerChannel","maxLayers","layerCount","countWithinGroup","groupObj","convertGroup","psdGroupObj","groupCanvas","groupCtx","resultArr","groupOpacity","hidden","groupMixModeStr","hasClipping","innerArr","innerItem","innerCtx","clippingCanvas","clippingCtx","clippingItem","effects","clippingCanvas1","clippingCtx1","clippingItem1","$4c230b0de5e1a470$export$56493bf279c387b3","klPsd","$41164c8aeaf53227$var$indexedDbIsSupported","indexedDB","$41164c8aeaf53227$var$dbNameStr","$41164c8aeaf53227$var$storageNameStr","$41164c8aeaf53227$export$1347f8be1f25c479","$41164c8aeaf53227$var$execIndexedDBTransaction","actionFunction","successCallback","errorCallback","onError","errorStr","hasFinished","requestObj","createObjectStore","keyPath","createIndex","unique","objectStoreNames","contains","deleteDatabase","storeObj","transactionObj","databaseObj","transaction","objectStore","e2","oncomplete","$41164c8aeaf53227$export$1448a0dd0d3fde8e","query","$41164c8aeaf53227$export$21ade4eb935254aa","storageProject","put","$41164c8aeaf53227$export$42ffd38884aecdac","$8k5kH","$805be15a1e91c0ee$export$7a4e0b62a5d854bc","isLoaded","$805be15a1e91c0ee$export$395d33c8e06b92c9","brightnessContrast","lang","getDialog","inEmbed","$4UkHZ","curves","$e7LnL","distort","$bt9IQ","$iI5sC","hueSaturation","$eySuj","invert","$iPRwU","perspective","$krmR4","$92iBR","tiltShift","$bFASM","toAlpha","$9m6gZ","$4fkq2","$dPWA8","unsharpMask","$cQHFd","grid","$9vOYE","noise","$as29q","pattern","$mMv4g","vanishPoint","$5UWr6","$68QTJ","$42ac5b30ad65dabb$export$7d68cd8857639377","PenBrush","BlendBrush","$5PSXS","SketchyBrush","$ewgr9","PixelBrush","$kic4a","ChemyBrush","$6Nq1H","SmudgeBrush","$ltaBP","EraserBrush","$7cUpm","$3f0923cd3c55ea92$export$6f96c8f9e6ae7341","historyEntry","settingColor","settingColorStr","lineToolLastDot","calcOpacity","settingOpacity","settingHasOpacityPressure","updateAlphaCanvas","settingAlphaId","ALPHA_CIRCLE","ALPHA_SQUARE","instructionArr","alphaCanvas128","alphaCanvas64","alphaCanvas32","alphaOpacityArr","$5CF7D","alphaImArr","drawDot","before","settingLockLayerAlpha","arc","twoPI","closePath","hasDrawnDot","targetMipmap","ALPHA_CHALK","bezierLine","lastInput","dotCallback","localPressure","lastInput2","localOpacity","localSize","settingSize","settingHasSizePressure","drawArr","localSpacing","settingSpacing","actions","inputArr","maxInput","loopDist","mouseDist","bdist","eX","eY","setAlpha","setSpacing","sizePressure","opacityPressure","setLockAlpha","getSpacing","$74D3O","$ff6c1f784f50f5d5$export$d116ae91f77f1f19","genBrushAlpha01","genBrushAlpha02","$f875015ce1aeb4d3$export$74a44bbc21d06a28","scaleFac","createImageData","sFac2","$gZSR2","simplex2","noisePattern","centerDist","$f875015ce1aeb4d3$var$udSegment","ba","pa","$f875015ce1aeb4d3$export$eaa218d5d17c8f1c","pDist","centerSize","transitionSize","$dfc47a34ad9bc378$var$myModule","$dfc47a34ad9bc378$var$Grad","dot2","$dfc47a34ad9bc378$var$grad3","$dfc47a34ad9bc378$var$p","$dfc47a34ad9bc378$var$perm","$dfc47a34ad9bc378$var$gradP","seed","$dfc47a34ad9bc378$var$G2","xin","yin","j1","$dfc47a34ad9bc378$var$F2","gi0","gi1","gi2","$02d77b8dd5755328$var$cellSize","$02d77b8dd5755328$var$clamp","$02d77b8dd5755328$export$9659db8d01dd5313","redrawBounds","cells","getTouchedCells","isTouched","touchedCells","cellsW","getCellsWidth","cellOffsetX","cellOffsetY","cellWidth","cellHeight","inCellBounds","tmpCtx","alpha","ar","ag","ab","aa","sliceBounds","randI","randLen","randArr","random","samples","samplesSquared","sampleOffsets","sharpness","invSharpness","sharpnessSubtrahend","sizeSquared","distDivisor","alphaMinuend","slicedBounds","ri","re","alphaO","underR","invAlphaO","underG","underB","alphaU","underR1","underG1","underB1","newAlpha","drawBuffer","settingSizePressure","calcSpacing","avgX","avgY","blending","mixr","mixg","mixb","average","localColOld","avgParams","prepDot","copyFromCanvas","getAverage","blendCol","localColNew","blendMix","settingOpacityPressure","updateRedrawBounds","totalCells","isTesting","drawChangedCells","continueLine","find","$c214fbe9e4fc15b0$var$sampleCanvas","$c214fbe9e4fc15b0$var$sampleCtx","$c214fbe9e4fc15b0$export$566f9061f0f5ba33","lastX","lastY","settingBlending","settingScale","sketchySeed","setSeed","getSeed","mixmode","c1","c2","getBlending","setBlending","p_x","p_y","preMixedColor","mixx","mixy","mixw","mixh","countmix","mixed","$58b45953679baa4a$export$4de5ef8eecde6f12","ditherPattern","updateDither","ditherCtx","settingIsEraser","ditherArr","ditherCanvas","skipFirst","settingUseDither","sX","sY","plotCubicBezierLine","isOverThreshold","d2","d3","cubicCurveOverThreshold","plotLine","controlCallback","controlObj","setIsEraser","setUseDither","getLockAlpha","$fc1a683099fb2d61$export$fe52c90afd1cf5ba","isBaseLayer","isTransparentBG","radgrad","oFac","bezierCallback","started","setTransparentBG","$78ad817c60f81b7c$var$CELL_SIZE","$78ad817c60f81b7c$var$smudge","cSize","brush","cX","cY","aP","bP","aIndex","ai","bi","ix","iy","softnessPx","fac2","alphaLock","bx1","yStart","bx2","pixel","iy1","yStart1","x21","ix1","yStart2","x3","x22","ix2","iy2","y3","iy3","yStart3","x4","x23","ix3","completeRedrawBounds","copiedCells","copyImageData","_$i","e3","imWidth","imHeight","$78ad817c60f81b7c$var$prepSmudge","ImageData","updateCompleteRedrawBounds","historyIm","tmpCanvas","$348fcce123898af9$export$38b08aa4ea8f61c6","settingXSymmetry","settingYSymmetry","buffer","settingMode","path","Path2D","settingGradient","startAtTop","minY","maxY","lineJoin","settingDistort","pos","historyCanvas","$cVFne","$7de2f0eab7a9ead7$export$f1561c72be54c6a7","penBrush","penBrushUi","blendBrush","$9mjXI","blendBrushUi","sketchyBrush","$iYbUv","sketchyBrushUi","pixelBrush","$brjBD","pixelBrushUi","chemyBrush","$vCnsd","chemyBrushUi","smudgeBrush","$dS2qM","smudgeBrushUi","$9rc5F","eraserBrushUi","brushInterface","alphaNames","$8b6ca25eb0830594$export$a0d4983f3b0b5c8e","$7gVvp","updateAlphas","alphas","currentAlpha","spacingSpline","onSizeChange","$7NTKy","pressureSizeToggle","pressureOpacityToggle","alphaWrapper","changeSliderValue","$e8a5c017c49bb311$export$5ec472fd0ce20d84","$2e3c50106ba150d5$export$156bb4fe8f4bcb4b","$cQSIC","blendingSlider","setSizePressure","setOpacityPressure","$94537af75923b9e3$export$ffae56164d1bde68","$bteky","blendSlider","scaleSlider","$9519e739bc9666ee$export$d001f3406562d07","$4PDnu","ditherToggle","getUseDither","toggleRow","$d6fc2ded7d9d56db$export$cf481ecf227135a8","$984eq","isTransparentBg","transparencyToggle","$1045b9bae2ffbbb4$export$84831662ba707e7a","$3QgTy","$18456e8104a5a825$export$80819a93636ebb04","$18kre","actualIconSize","iconSize","modeOptions","brushSize","mirrorXToggle","halfSize","getXSymmetry","setXSymmetry","mirrorYToggle","getYSymmetry","setYSymmetry","gradientToggle","getGradient","setGradient","$14dc4cf18966a4f4$export$2358c75ad3c15b2d","$6f92981a32875bca$export$5334e08b3589fc5c","isEmbed","linkEl","iframe","href","contentWindow","location","isMaxHeight","$142eacf53b1eb43d$export$3dff5655255b5729","ignoreFocus","inputs","$0e681e75eb3cab30$export$9c72cf485ef46673","gridTemplateColumns","gridTemplateRows","gap","gridTemplateAreas","gridArea","infoEl","isBroken","ageEl","textSize","btnCustom","storeButtonEl","clearButtonEl","hideClearButton","visibility","storeListener","onUpdate","timestamp","thumbnail","updateThumb","updateAge","readResult","read","ageStr","age","maxWidth","maxHeight","resetButtons","Promise","unsubscribe","$14b343f2c12ca9c5$var$makeAsync","reject","$14b343f2c12ca9c5$export$93d91060b9af7e2a","accessHasFailed","storeKlProjectObj","getKlProjectObj","lowLevelRead","$3hwQ7","ProjectConverter","readStorageProject","t1","storageProject1","createStorageProject","lowLevelStore","lowLevelClear","updateTimestamp","$3ee249752703e788$var$loadImage","onabort","$3ee249752703e788$export$f3c1ac6650038646","$2wCWz","base64ToBlob","createThumbnail","HTMLCanvasElement","all","t2","$e3587a28373f51f9$export$b3fb17ae4345ac8f","base64Str","parts","binStr","atob","buf","ArrayBuffer","view","Uint8Array","charCodeAt","$01ce2e23a2667e77$export$a2647fbf5f056b0a","onExportTypeChange","onFileSelect","onSaveImageToComputer","onNewImage","onShareImage","onUpload","onCopyToClipboard","createSpacer","clearer","line","filemenu","uploadImgurButton","clipboardButton","$4xKQD","multiple","accept","exportTypeWrapper","exportTypeSelect","importWrapper","innerMask","importFakeButton","createImportButton","saveNote","fileBrowserStorage","refresh","$0d10046ca7f6fbd0$export$3f17d740ad471e50","getCurrentColor","getKlMaxCanvasSize","getKlCanvas","getCurrentLayerCtx","isInit","filterKey","filterArr","buttonLabel","filterName","applyFilter","filterDialog","getInput","finishedDialog","groupArr","filters","addGroup","$6349b006a6604e1b$var$upload","description","$6349b006a6604e1b$var$_upload","gif","labelText","response","formData","$j8sUl","FormData","method","headers","Authorization","ok","json","link","$6349b006a6604e1b$export$b1dd62fa0b5f32f5","inputTitle","inputDescription","rows","labelTitle","labelDescription","tos","typeRadio","outDiv","infoHint","deletehash","$ae23cd0c3e53f398$var$agPsdLazy","$ae23cd0c3e53f398$export$ab3d838b1d336b38","$ae23cd0c3e53f398$var$_loadAgPsd","$06e8423858d08972$export$befc6437ad34b28a","showReminder","changeTitle","onSaveAsPsd","lastSavedActionNumber","lastSavedAt","psdWrapper","storageWrapper","paddingBottom","psdBtn","storageUi","closeFunc","lastReminderShownAt","onBeforeUnload","returnValue","getActionNumber","visibilityState","unsavedActions","showPopup","unsavedInterval","$956d06d740fc5053$export$75e7b60500bb415b","getExportType","format","saveImage","mimeType","$98ax7","saveAs","fnameArr","fileBase","layerArr1","psdConfig","blendKlToPsd","writePsdBuffer","XMLHttpRequest","responseType","send","a1","status","dispatchEvent","createEvent","initMouseEvent","self","$parcel$global","global","HTMLAnchorElement","download","rel","msSaveOrOpenBlob","autoBom","warn","HTMLElement","safari","onloadend","readAsDataURL","define","amd","$48534f13b7192dff$export$5cebd3bb2d68229a","getInitState","setCurrentLayerCtx","getCurrentBrush","doIgnore","ignoreTest","oldSize","id1","b3","currentLayerIndex","logParam","localCurrentLayerCtx","$53cc60fd413705d6$export$272bfd3ef9ef2f48","onSetColor","onSetSize","onSetOpacity","onGetColor","onGetSize","onGetOpacity","onGetSliderConfig","subscriberArr","instance","skipSubscriber","$5562b5b6c391a7ca$export$5d396b237bd33221","onLeftRight","customAbout","makeLicenses","licenses","overflowY","language","getLanguage","preferredLanguageRow","$fgfvl","languages","languageSelect","LS_LANGUAGE_KEY","languageHint","$7OLuX","$6qSiv","$951e508110f8a437$export$42a534af7eb650e8","upBtn","downBtn","upInterval","scrollBy","downInterval","wheelListener","$f244572c1923a3ac$export$7fa03d1ef9d3489e","iconArr","updateIcons","typeOptions","reverseToggle","doSnapToggle","col1","col2","$b37f5cd553722692$export$665d2c76b1eb8459","submitButton","leftRightButton","$4bb0d03ef02dc0c0$var$importFilter","libObj","moduleObj","$4bb0d03ef02dc0c0$export$4283b00eae4a6956","$iiVKq","filterBrightnessContrast","$lorQQ","filterCropExtend","$8Ri8I","filterCurves","$fADXF","filterFlip","$bIns5","filterHueSaturation","$30jcG","filterInvert","$cCks8","filterPerspective","$huXOx","filterResize","$dsRff","filterRotate","$lhchB","filterTiltShift","$lXpcU","filterTransform","$1CjeM","filterBlur","$dNWKZ","filterUnsharpMask","$94Tq7","filterToAlpha","$d8Fqy","filterGrid","$gtdB1","filterNoise","$lQzx7","filterPattern","$10iZP","filterDistort","$dteOZ","filterVanishPoint","$024aabab8b30bbfd$export$af433fb90aa90a38","selectedLayerIndex","brightness","contrast","glCanvas","$5RaQo","getSharedFx","texture","brightnessSlider","$cH2YE","contrastSlider","previewInnerWrapper","$fca35583bfaa35b6$export$5ec472fd0ce20d84","$TEtAx","$0e6e34a2063e157d$var$fxCanvas","fx","$0e6e34a2063e157d$export$8c4423af32b21158","_","isContextLost","$dVkJn","$5eb53faa48338ac6$export$68ae324f2f6c6252","lo","hi","wrapTexture","loadContentsOf","Texture","fromElement","initialize","UNSIGNED_BYTE","getExtension","testTexture","RGBA","FLOAT","drawTo","spareTexture","extraTexture","flippedShader","Shader","use","getDefaultShader","drawRect","shader","uniforms","textureIn","textureOut","swapWith","node","getPixelArray","array","readPixels","getSquareToQuad","dx1","dy1","dx2","dy2","dx3","dy3","det","warpShader","warp","simpleShader","interpolator","red","green","blue","splineInterpolate","initFromBytes","textures","exponent","denoise","texSize","octaves","peaks","colA","colB","channels","amount","sepia","strength","ensureFormat","triangleBlur","originalTexture","unuse","vibrance","vignette","lensBlurPrePass","common","randomShaderFunc","lensBlur0","lensBlur1","lensBlur2","texture1","power","delta0","delta1","endX","endY","blurRadius","gradientRadius","zoomBlur","colorHalftone","dotScreen","edgeWork","edgeWork1","edgeWork2","hexagonalPixelate","ink","bulgePinch","inverse","useTextureSpace","matrixWarp","getInverse","after","swirl","multiplyAlpha","unmultiplyAlpha","replaceRGBA","distortType","phase","oldGetExtension","oldGetSupportedExtensions","getSupportedExtensions","createFramebuffer","createTexture","TEXTURE_2D","byteTexture","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","FRAMEBUFFER","framebuffer","COLOR_ATTACHMENT0","floatTexture","bindTexture","texParameteri","LINEAR","texImage2D","Float32Array","program","createProgram","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","attachShader","linkProgram","createBuffer","ARRAY_BUFFER","bufferData","STREAM_DRAW","enableVertexAttribArray","vertexAttribPointer","viewport","POINTS","supportsOESTextureFloatLinear","WebGLRenderingContext","$OES_texture_float_linear$","OESTextureFloatLinear","getOESTextureFloatLinear","extensions","contents","lensBlur","isNumber","source","nameStr","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","testPrecisionSupport","precisionType","getShaderPrecisionFormat","precision","vertexSource","fragmentSource","vertexAttribute","texCoordAttribute","defaultVertexSource","defaultFragmentSource","floatPrecision","HIGH_FLOAT","MEDIUM_FLOAT","compileSource","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","useProgram","getUniformLocation","uniform1fv","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","uniformMatrix4fv","$2680b5781517cb67$export$e5937df51b9e1d86","updateInput","leftInput","rightInput","topInput","bottomInput","leftChanged","rightChanged","topChanged","bottomChanged","cropper","offsetWrapper","selectedRgbaObj","previewFactor","lrWrapper","tbWrapper","labelStyle","useRuleOfThirds","ruleOThirdsCheckbox","currentColorRgb","secondaryColorRgb","bgColorOverlay","updateBg","flexRow","$4c948640eb8ef791$export$309483fcb6d5c7ca","modeButtons","p0","areah","areaw","curveArea","createPoint","lock","internalY","internalX","newX","newY","updateControl","outCurves","drawCurve","spline","getDiv","$6b01e1931d168e01$export$9b1b7b3985b9625a","previewLayer","doFlipCanvas","horizontalCheckbox","verticalCheckbox","fcOption","borderTopLeftRadius","$1RI49","flOption","borderTopRightRadius","optionWrapper","horizontal","vertical","flipCanvas","$041c656037c77a96$export$2aa46bd5587f0eb","hueSlider","saturationSlider","Saturation","$82b3d1ba61b3412f$export$b7ebcfbdc840ef76","$460859cbeb601dec$export$a76d798fa7d85e4e","displayW","displayH","displayPreviewFactor","pointerListenerArr","bb","bc","bd","ac","ad","nob","updateAfter","beforeAfterTabs","$5vheV","TwoTabs","nobSize","$8b4f5ae4fe73ff76$var$activeColor","$8b4f5ae4fe73ff76$var$inactiveColor","$8b4f5ae4fe73ff76$var$hoverColor","$8b4f5ae4fe73ff76$export$b1241e74876d9bbe","leftTab","rightTab","$63d62a20f3ba2c7d$export$5705240d31427a82","previewW","previewH","algorithmSelect","canvasWrapper","inputWrapper","$jfTWC","constrainCheckbox","secondRowElement","$878715182dcd377b$export$ac7e9efc751d5791","WebkitTransform","MozTransform","OTransform","msTransform","btnPlus","btnMinus","$aa97ed406a9700f0$export$1b8796b18b7c19ed","fa","fb","blurSlider","gradientSlider","$31a0dd41d7428d32$export$dc15474d94cdc2b3","lastDrawnTransformStr","transformLayerCanvas","onInputsChanged","inputR","leftWrapper","rightWrapper","rotWrapper","actionBtnCss","buttonRow","flipXBtn","flipYBtn","scaleRotLeftBtn","scaleRotRightBtn","scaleDoubleBtn","getRatio","scaleHalfBtn","setConstrained","isSnapping","snappingCheckbox","setSnapping","checkboxWrapper","bottomRow","$95b95646154e8218$export$55e7eb2ebd0db869","radiusSlider","$82f12ab116cea855$export$62ac74a5ea43bd5c","strengthSlider","$a535e7a374deb8f5$export$6158ed2b22ebf4d9","sourceId","sourceOptions","$bad33651972f8d2c$export$50020de79e1bc23","renderW","renderH","$1xi6g","drawGrid","settingsObj","thickness","renderFactor","line1","line2","xInput","yInput","thicknessInput","$74df8e8cd35bce4e$export$20d2db9c68afeac","cellsX","cellsY","thickIsRound","pos1","$595c9469b8f94062$var$presetArr","$595c9469b8f94062$var$drawNoise","$595c9469b8f94062$export$1dab0536099042f5","presetCopy","presetIndex","thumbImgArr","preset","thumbImg","presetOptions","row1El","row2El","channelsOptions","blendSelect","colorWrapper","colInputStyle","colAInput","colBInput","$ebbf7e5d844153e5$var$drawPattern","blendOffsetX","blend","blendOffsetY","finalPatternCanvas","blendCanvas","blendCtx","colTransparent","colOpaque","blendGradient","syncInputs","sharpStrokeRect","drawX","drawY","drawWidth","drawHeight","lastDrawnSettings","previewMode","fullSizeCtx","fullSizeCanvas","pW","pH","overlayCtx","overlayCanvas","previewCtx1","inputStyle","oldSettings","x11","y11","$67bee9819cf9d9ba$export$77c344cc65ad0ed2","sync","from","sliderArr","glCanvas1","isSynced","settingsCopy","topRowEl","syncToggle","xyRowEl","leftCol","rightCol","sliderWidth","toUpperCase","phaseSlider","stepSlider","$9939d5f20537fa4b$export$a77e8ecd2a7fa9a5","$jsIPR","drawVanishPoint","lines","linesSlider","$cd59789add31bb97$export$8f57d6bdbceb36d0","degIncrement","$40b8cea12adf584e$export$92433b641be3f7a","$40b8cea12adf584e$var$_klCanvasToPsdBlob"],"version":3,"file":"main-embed.ee3237c0.js.map"}
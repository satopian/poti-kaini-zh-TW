!function(){function e(e,t,i,n){Object.defineProperty(e,t,{get:i,set:n,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var i=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire94c2,n=i.register;n("6NgYC",function(t,n){e(t.exports,"Embed",function(){return g});var r=i("1LaJZ"),s=i("cx0mh"),a=i("7h4XF"),o=i("2gUX3");i("15wZT");var l=i("3C7jC"),h=i("5ngYX"),c=i("941rU"),u=i("1mH1z"),p=i("iVf04"),d=i("hAS38"),g=/*#__PURE__*/function(){function e(t){var i=this;(0,s._)(this,e),this.p=t,this.isInitialized=!1,this.psdQueue=[],this.openProject=function(e){i.onProjectReady(e)},this.loadingScreenEl=document.getElementById("loading-screen"),this.loadingScreenTextEl=document.getElementById("loading-screen-text"),this.loadingScreenTextEl&&(this.loadingScreenTextEl.textContent=(0,u.LANG)("embed-init-waiting")),t.disableAutoFit&&(d.klConfig.disableAutoFit=!0),t.project&&this.onProjectReady(t.project)}return(0,a._)(e,[{key:"onProjectReady",value:function(e){var t=this;try{if(this.isInitialized)throw Error("Already called openProject");this.isInitialized=!0;var i=new h.SaveReminder(!1,!1,function(){},function(){return!!t.klApp&&t.klApp.isDrawing()},null,null);this.klApp=new l.KlApp({project:e,saveReminder:i,bottomBar:this.p.bottomBar,aboutEl:this.p.aboutEl,embed:{url:this.p.embedUrl,onSubmit:this.p.onSubmit}}),i.init(),this.loadingScreenEl&&this.loadingScreenEl.remove(),this.loadingScreenEl=null,this.loadingScreenTextEl=null,document.body.append(this.klApp.getEl())}catch(e){this.loadingScreenTextEl&&(this.loadingScreenTextEl.textContent="❌ "+e),this.loadingScreenEl&&(this.loadingScreenEl.className+="loading-screen-error"),console.error(e)}}},{key:"initError",value:function(e){this.loadingScreenTextEl&&(this.loadingScreenTextEl.textContent="❌ "+e),this.loadingScreenEl&&(this.loadingScreenEl.className+="loading-screen-error")}},{key:"getPNG",value:function(){if(!this.klApp)throw Error("App not initialized");return this.klApp.getPNG()}},{key:"getPSD",value:function(){var e=this;return(0,r._)(function(){return(0,o.__generator)(this,function(t){switch(t.label){case 0:if(!e.klApp)throw Error("App not initialized");return[4,e.klApp.getPSD()];case 1:return[2,t.sent()]}})})()}},{key:"readPSDs",value:function(e){var t=this;if(0!==e.length){var i=function(e){try{var i=t.agPsd.readPsd(e.blob),n=(0,c.klPsdToKlProject)((0,c.readPsd)(i));e.callback(n)}catch(t){console.error("failed to read psd",t),e.callback(null)}};if(this.agPsd)e.forEach(i);else{var n=this;0===this.psdQueue.length&&(0,r._)(function(){return(0,o.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(0,p.loadAgPsd)()];case 1:return n.agPsd=e.sent(),[3,3];case 2:return e.sent(),n.agPsd="error",[3,3];case 3:for(;n.psdQueue.length;)i(n.psdQueue.shift());return[2]}})})(),e.forEach(function(e){t.psdQueue.push(e)})}}}}]),e}()}),n("15wZT",function(e,t){var n=i("8N5YG");if(i("k3KW8"),"scrollTo"in Element.prototype||Object.defineProperty(Element.prototype,"scrollTo",{value:function(e,t){this.scrollLeft=e,this.scrollTop=t}}),"scrollBy"in Element.prototype||Object.defineProperty(Element.prototype,"scrollBy",{value:function(e,t){this.scrollLeft+=e,this.scrollTop+=t}}),Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=isNaN(i[0])?1:Number(i[0]);return r?Array.prototype.reduce.call(this,function(t,i){return Array.isArray(i)?t.push.apply(t,e.call(i,r-1)):t.push(i),t},[]):Array.prototype.slice.call(this)},writable:!0}),String.prototype.replaceAll||Object.defineProperty(String.prototype,"replaceAll",{value:function(e,t){if("function"==typeof t)throw Error("replaceAll polyfill does not support replaceValue: function");return this.replace(RegExp(e,"g"),t)}}),"at"in Array.prototype||Object.defineProperty(Array.prototype,"at",{value:function(e){return e>0?this[e]:e<0?this[e+this.length]:void 0}}),Object.fromEntries||Object.defineProperty(Object,"fromEntries",{value(e){if(!e||!e[Symbol.iterator])throw Error("Object.fromEntries() requires a single iterable argument");var t={};return Object.keys(e).forEach(function(i){var r=(0,n._)(e[i],2),s=r[0],a=r[1];t[s]=a}),t}}),!("localStorage"in window))try{window.localStorage={getItem:function(){return null},setItem:function(){},removeItem:function(){}}}catch(e){}}),n("k3KW8",function(e,t){i("5dg4B"),i("izcMZ"),i("iD0Yt"),i("fIU0v")}),n("5dg4B",function(e,t){!function(){function e(){var e=Array.prototype.slice.call(arguments),t=document.createDocumentFragment();e.forEach(function(e){var i=e instanceof Node;t.appendChild(i?e:document.createTextNode(String(e)))}),this.appendChild(t)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(t){t.hasOwnProperty("append")||Object.defineProperty(t,"append",{configurable:!0,enumerable:!0,writable:!0,value:e})})}()}),n("izcMZ",function(e,t){!function(){function e(){var e=Array.prototype.slice.call(arguments),t=document.createDocumentFragment();e.forEach(function(e){var i=e instanceof Node;t.appendChild(i?e:document.createTextNode(String(e)))}),this.insertBefore(t,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(t){t.hasOwnProperty("prepend")||Object.defineProperty(t,"prepend",{configurable:!0,enumerable:!0,writable:!0,value:e})})}()}),n("iD0Yt",function(e,t){String.prototype.padStart||(String.prototype.padStart=function(e,t){return e>>=0,t=String(t||" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),t.slice(0,e)+String(this))})}),n("fIU0v",function(e,t){Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw TypeError('"this" is null or not defined');var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw TypeError("predicate must be a function");for(var n=arguments[1],r=0;r<i;){var s=t[r];if(e.call(n,s,r,t))return r;r++}return -1}})}),n("3C7jC",function(n,r){e(n.exports,"KlApp",function(){return en});var s=i("1LaJZ"),a=i("cx0mh"),o=i("7h4XF"),l=i("cL71g"),h=i("4EWN2"),c=i("8N5YG"),u=i("bX4ja"),p=i("2gUX3"),d=i("hrnUX"),g=i("gWfkn"),f=i("eWjiX"),v=i("h62LS"),m=i("jmL5A"),y=i("iUR3L"),x=i("2wCWz"),b=i("3WOmu"),B=i("1mH1z"),w=i("6l0gQ"),k=i("iuTWx"),C=i("57YJz"),S=i("aId1u"),E=i("4hRms"),L=i("beDft"),A=i("fJXlf"),I=i("fOpTP"),T=i("51i5Z"),P=i("hnyNy"),R=i("a5L8I"),M=i("gzQkL"),D=i("gJS5i"),O=i("O7B1d"),_=i("qur3y"),N=i("fohxs"),z=i("7jh4K"),G=i("hAS38"),j=i("8I3X7"),F=i("8TwnO"),H=i("8AUlO"),U=i("iXbuc"),X=i("63yUO"),V=i("4tNj6"),W=i("gAXzN"),Y=i("9Q2gk"),K=i("15tXE"),q=i("2jK1Y"),Z=i("3hiBf"),$=i("6dnxC"),Q=i("kwvlO"),J=i("age0w"),ee=i("c3rQS"),et=i("bB2ML"),ei=i("7JyFK");(0,y.importFilters)();var en=/*#__PURE__*/function(){function e(i){var n,r,o,y,x,en,er=this;(0,a._)(this,e),this.collapseThreshold=820,this.toolWidth=271;var es=this;this.getPSD=/*#__PURE__*/(0,s._)(function(){return(0,p.__generator)(this,function(e){switch(e.label){case 0:return[4,(0,b.klCanvasToPsdBlob)(es.klCanvas)];case 1:return[2,e.sent()]}})}),this.embed=i.embed;var ea=Math.min(4096,Math.max(2048,Math.max(window.screen.width,window.screen.height)));this.uiState=this.embed?"left":(0,w.LocalStorage).getItem("uiState")?(0,w.LocalStorage).getItem("uiState"):"right";var eo=i.projectStore;this.klRootEl=(0,f.BB).el({className:"g-root",css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0"}}),this.uiWidth=Math.max(0,window.innerWidth),this.uiHeight=Math.max(0,window.innerHeight);var el="png";this.klCanvas=new d.KL.KlCanvas(i.project?{projectObj:i.project}:{width:Math.max(10,Math.min(ea,window.innerWidth<this.collapseThreshold?this.uiWidth:this.uiWidth-this.toolWidth)),height:Math.max(10,Math.min(ea,this.uiHeight))},this.embed?-1:0);var eh=new g.KlHistory;this.klCanvas.setHistory(eh);var ec=new J.KlTempHistory,eu=void 0;i.saveReminder||(i.saveReminder={init:function(){},reset:function(){}}),i.project?(i.project.layers.forEach(function(e){e.image=null}),i.project=void 0):(eh.pause(!0),this.klCanvas.addLayer(),this.klCanvas.layerFill(0,{r:N.ERASE_COLOR,g:N.ERASE_COLOR,b:N.ERASE_COLOR}),eh.pause(!1));try{n={canvas:new d.KL.KlCanvas({copy:this.klCanvas},this.embed?-1:0),focus:this.klCanvas.getLayerCount()-1,brushes:{}}}catch(e){throw"kl-create-canvas-error"===e.message&&this.klCanvas.destroy(),e}Object.entries(d.KL.brushes).forEach(function(e){var t=(0,c._)(e,2),i=t[0],r=t[1];n.brushes[i]=new r,n.canvas&&n.brushes[i].setContext(n.canvas.getLayerContext(n.focus))});var ep=new f.BB.RGB(0,0,0),ed=(0,z.throwIfNull)(this.klCanvas.getLayerContext(this.klCanvas.getLayerCount()-1)),eg=function(){if("eraserBrush"===o)return y;var e=Object.keys(eL).filter(function(e){return"eraserBrush"!==e}),t=e.findIndex(function(e){return e===o});return e[(t+1)%e.length]},ef=function(e){ev.emitSize(e),er.easelBrush&&er.easelBrush.setBrush({radius:e})},ev=new d.KL.BrushSettingService({onSetColor:function(e){er.klColorSlider.setColor(e),r.setColor(e),ep=(0,f.BB).copyObj(e)},onSetSize:function(e){r.setSize(e),er.easelBrush.setBrush({radius:e})},onSetOpacity:function(e){r.setOpacity(e)},onGetColor:function(){return er.klColorSlider.getColor()},onGetSize:function(){return eL[o].getSize()},onGetOpacity:function(){return eL[o].getOpacity()},onGetSliderConfig:function(){return{sizeSlider:d.KL.brushesUI[o].sizeSlider,opacitySlider:d.KL.brushesUI[o].opacitySlider}}}),em=new k.LineSmoothing({smoothing:(0,S.translateSmoothing)(1)});this.lineSanitizer=new C.LineSanitizer;var ey=new f.BB.EventChain({chainArr:[this.lineSanitizer,em]});ey.setChainOut(function(e){"down"===e.type&&(er.toolspace.style.pointerEvents="none",r.startLine(e.x,e.y,e.pressure),er.easelBrush.setLastDrawEvent({x:e.x,y:e.y}),er.easel.requestRender()),"move"===e.type&&(r.goLine(e.x,e.y,e.pressure,!1,e.isCoalesced),er.easelBrush.setLastDrawEvent({x:e.x,y:e.y}),er.easel.requestRender()),"up"===e.type&&(er.toolspace.style.pointerEvents="",r.endLine(),er.easel.requestRender()),"line"===e.type&&(r.getBrush().drawLineSegment(e.x0,e.y0,e.x1,e.y1),er.easelBrush.setLastDrawEvent({x:e.x1,y:e.y1}),er.easel.requestRender())});var ex={size:20,align:"left",isBold:!1,isItalic:!1,font:"sans-serif",letterSpacing:0,lineHeight:1,fill:{color:{r:0,g:0,b:0,a:1}}},eb=function(){var e=!1;return"select"===er.easel.getTool()&&(e=eC.commitTransform()),e},eB=function(){"select"===er.easel.getTool()&&eC.discardTransform()},ew=function(e){ec.canDecreaseIndex()||eB(),eH.undo(),e&&er.statusOverlay.out((0,B.LANG)("undo"),!0)},ek=function(e){eH.redo(),e&&er.statusOverlay.out((0,B.LANG)("redo"),!0)};this.statusOverlay=new d.KL.StatusOverlay;var eC=new Q.KlAppSelect({klCanvas:this.klCanvas,getCurrentLayerCtx:function(){return ed},onUpdateProject:function(){return er.easelProjectUpdater.update()},klHistory:eh,tempHistory:ec,statusOverlay:this.statusOverlay,onFill:function(){er.klCanvas.layerFill((0,z.throwIfNull)(er.klCanvas.getLayerIndex(ed.canvas)),er.klColorSlider.getColor(),void 0,!0),er.statusOverlay.out(er.klCanvas.getSelection()?(0,B.LANG)("filled-selected-area"):(0,B.LANG)("filled"),!0)},onErase:function(){var e=(0,z.throwIfNull)(er.klCanvas.getLayerIndex(ed.canvas));er.klCanvas.eraseLayer({layerIndex:e,useAlphaLock:0===e&&!eL.eraserBrush.getIsTransparentBg(),useSelection:!0}),er.statusOverlay.out(er.klCanvas.getSelection()?(0,B.LANG)("cleared-selected-area"):(0,B.LANG)("cleared-layer"),!0)}});this.easelBrush=new H.EaselBrush({radius:5,onLineStart:function(e){ey.chainIn({type:"down",scale:er.easel.getTransform().scale,shiftIsPressed:eE.isPressed("shift"),pressure:e.pressure,isCoalesced:e.isCoalesced,x:e.x,y:e.y})},onLineGo:function(e){ey.chainIn({type:"move",scale:er.easel.getTransform().scale,shiftIsPressed:eE.isPressed("shift"),pressure:e.pressure,isCoalesced:e.isCoalesced,x:e.x,y:e.y})},onLineEnd:function(){ey.chainIn({type:"up",scale:er.easel.getTransform().scale,shiftIsPressed:eE.isPressed("shift"),isCoalesced:!1})},onLine:function(e,t){ey.chainIn({type:"line",x0:e.x,y0:e.y,x1:t.x,y1:t.y,pressure0:1,pressure1:1})}}),this.easel=new j.Easel({width:Math.max(0,this.uiWidth-this.toolWidth),height:this.uiHeight,project:{width:this.klCanvas.getWidth(),height:this.klCanvas.getHeight(),layers:[]},tools:{brush:this.easelBrush,hand:new F.EaselHand({}),select:eC.getEaselSelect(),eyedropper:new V.EaselEyedropper({onPick:function(e){var t=er.klCanvas.getColorAt(e.x,e.y);return ev.setColor(t),t},onPickEnd:function(){er.klColorSlider.getIsPicking()&&(er.klColorSlider.pickingDone(),er.easel.setTool(er.toolspaceToolRow.getActive()))}}),paintBucket:new W.EaselPaintBucket({onFill:function(e){var t=(0,z.throwIfNull)(er.klCanvas.getLayerIndex(ed.canvas));er.klCanvas.floodFill(t,e.x,e.y,eO.getIsEraser()?null:er.klColorSlider.getColor(),eO.getOpacity(),eO.getTolerance(),eO.getSample(),eO.getGrow(),eO.getContiguous()),er.easel.requestRender()}}),gradient:new Y.EaselGradient({onDown:function(e,t){eG.onDown(e.x,e.y,t)},onMove:function(e){eG.onMove(e.x,e.y)},onUp:function(e){eG.onUp(e.x,e.y)}}),text:new K.EaselText({onDown:function(e,t){(0,d.KL).dialogCounter.get()>0||(0,d.KL).textToolDialog({klCanvas:er.klCanvas,layerIndex:(0,z.throwIfNull)(er.klCanvas.getLayerIndex(ed.canvas)),primaryColor:er.klColorSlider.getColor(),secondaryColor:er.klColorSlider.getSecondaryRGB(),text:(0,h._)((0,l._)({},ex),{text:"",x:e.x,y:e.y,angleRad:t,fill:ex.fill?{color:(0,h._)((0,l._)({},er.klColorSlider.getColor()),{a:ex.fill.color.a})}:void 0,stroke:ex.stroke?(0,h._)((0,l._)({},ex.stroke),{color:(0,h._)((0,l._)({},er.klColorSlider.getSecondaryRGB()),{a:ex.stroke.color.a})}):void 0}),onConfirm:function(e){ex=(0,h._)((0,l._)({},e),{text:""});var t=(0,z.throwIfNull)(er.klCanvas.getLayerIndex(ed.canvas));er.klCanvas.text(t,e)}})}}),shape:new q.EaselShape({onDown:function(e,t){ej.onDown(e.x,e.y,t)},onMove:function(e){ej.onMove(e.x,e.y)},onUp:function(e){ej.onUp(e.x,e.y)}}),rotate:new Z.EaselRotate({}),zoom:new $.EaselZoom({})},tool:"brush",onTransformChange:function(e,t){eD.update(e.scale,e.angleDeg),er.toolspaceToolRow.setEnableZoomIn(e.scale!==ei.EASEL_MAX_SCALE),er.toolspaceToolRow.setEnableZoomOut(e.scale!==ei.EASEL_MIN_SCALE),t&&er.statusOverlay.out({type:"transform",scale:e.scale,angleDeg:e.angleDeg})},onUndo:function(){ew(!0)},onRedo:function(){ek(!0)}}),(0,f.BB).css(this.easel.getElement(),{position:"absolute",left:"0",top:"0"}),this.easelProjectUpdater=new U.EaselProjectUpdater({klCanvas:this.klCanvas,easel:this.easel}),eh.addListener(function(){er.easelProjectUpdater.update()}),(0,d.KL).dialogCounter.subscribe(function(e){er.easel.setIsFrozen(e>0)});var eS=function(){if(eu)for(var e=er.toolspaceToolRow.getActive(),t=eu.getOpenedTabId(),i=["brush","hand","paintBucket","gradient","text","shape","select"],n=0;n<i.length;n++)e===i[n]?eu.setIsVisible(i[n],!0):(eu.setIsVisible(i[n],!1),t===i[n]&&eu.open(e))},eE=new f.BB.KeyListener({onDown:function(e,t,n){if(!((0,d.KL).dialogCounter.get()>0||(0,f.BB).isInputFocused(!0))&&!(er.lineSanitizer.getIsDrawing()||er.easel.getIsLocked())){if("home"===n&&er.easel.fitTransform(),"end"===n&&er.easel.resetTransform(),["ctrl+z","cmd+z"].includes(n)&&(t.preventDefault(),ew()),(["ctrl+y","cmd+y"].includes(n)||((0,f.BB).sameKeys("ctrl+shift+z",n)||(0,f.BB).sameKeys("cmd+shift+z",n))&&"z"===e)&&(t.preventDefault(),ek()),!er.embed&&(["ctrl+s","cmd+s"].includes(n)&&(t.preventDefault(),eb(),er.saveToComputer.save()),["ctrl+shift+s","cmd+shift+s"].includes(n)&&(t.preventDefault(),eb(),(0,s._)(function(){var e,t;return(0,p.__generator)(this,function(n){switch(n.label){case 0:e=!0,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,eo.store(er.klCanvas.getProject())];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),e=!1,setTimeout(function(){throw Error("keyboard-shortcut: failed to store browser storage, "+t)},0),er.statusOverlay.out("❌ "+(0,B.LANG)("file-storage-failed"),!0),[3,4];case 4:return e&&(i.saveReminder.reset(),er.statusOverlay.out((0,B.LANG)("file-storage-stored"),!0)),[2]}})})()),["ctrl+c","cmd+c"].includes(n)&&(t.preventDefault(),eb(),eV(!0))),["ctrl+a","cmd+a"].includes(n)&&t.preventDefault(),"sqbr_open"===n&&r.decreaseSize(Math.max(.005,.03/er.easel.getTransform().scale)),"sqbr_close"===n&&r.increaseSize(Math.max(.005,.03/er.easel.getTransform().scale)),"enter"!==n||eb()||(er.klCanvas.layerFill((0,z.throwIfNull)(er.klCanvas.getLayerIndex(ed.canvas)),er.klColorSlider.getColor(),void 0,!0),er.statusOverlay.out(er.klCanvas.getSelection()?(0,B.LANG)("filled-selected-area"):(0,B.LANG)("filled"),!0)),"esc"===n&&eB(),["delete","backspace"].includes(n)){eb();var a=(0,z.throwIfNull)(er.klCanvas.getLayerIndex(ed.canvas));er.klCanvas.eraseLayer({layerIndex:a,useAlphaLock:0===a&&!eL.eraserBrush.getIsTransparentBg(),useSelection:!0}),er.statusOverlay.out(er.klCanvas.getSelection()?(0,B.LANG)("cleared-selected-area"):(0,B.LANG)("cleared-layer"),!0)}if("shift+e"===n?(t.preventDefault(),r.toggleEraser&&r.toggleEraser()):"e"===n&&(t.preventDefault(),eb(),er.easel.setTool("brush"),er.toolspaceToolRow.setActive("brush"),eu&&eu.open("brush"),eS(),eM.open("eraserBrush")),"b"===n){t.preventDefault(),eb();var l=er.easel.getTool();er.easel.setTool("brush"),er.toolspaceToolRow.setActive("brush"),eu&&eu.open("brush"),eS(),eM.open("brush"===l?eg():o)}if("g"===n){t.preventDefault(),eb();var h="paintBucket"===er.easel.getTool()?"gradient":"paintBucket";er.easel.setTool(h),er.toolspaceToolRow.setActive(h),eu&&eu.open(h),eS()}"t"===n&&(t.preventDefault(),eb(),er.easel.setTool("text"),er.toolspaceToolRow.setActive("text"),eu&&eu.open("text"),eS()),"u"===n&&(t.preventDefault(),eb(),er.easel.setTool("shape"),er.toolspaceToolRow.setActive("shape"),eu&&eu.open("shape"),eS()),"l"===n&&(t.preventDefault(),eb(),er.easel.setTool("select"),er.toolspaceToolRow.setActive("select"),eu&&eu.open("select"),eS()),"x"===n&&(t.preventDefault(),er.klColorSlider.swapColors())}},onUp:function(e,t){}}),eL={};Object.entries(d.KL.brushesUI).forEach(function(e){var t=(0,c._)(e,2),i=t[0],n=new t[1].Ui({history:eh,onSizeChange:ef,onOpacityChange:function(e){ev.emitOpacity(e)},onConfigChange:function(){ev.emitSliderConfig({sizeSlider:d.KL.brushesUI[o].sizeSlider,opacitySlider:d.KL.brushesUI[o].opacitySlider})}});eL[i]=n,n.getElement().style.padding="10px"}),this.toolspace=(0,f.BB).el({className:"kl-toolspace",css:{position:"absolute",right:"0",top:"0",bottom:"0",width:this.toolWidth+"px",overflow:"hidden",userSelect:"none",touchAction:"none"}}),this.toolspaceInner=(0,f.BB).el({parent:this.toolspace}),this.toolspace.oncontextmenu=function(){return!1},this.toolspace.onclick=f.BB.handleClick,this.toolspaceCollapser=new d.KL.ToolspaceCollapser({onChange:function(){er.updateCollapse()}}),this.updateCollapse(),setTimeout(function(){x=new d.KL.OverlayToolspace({enabledTest:function(){return 0===(0,d.KL).dialogCounter.get()&&!er.easel.getIsLocked()},brushSettingService:ev}),er.klRootEl.append(x.getElement())},0),(0,f.BB).append(this.klRootEl,[this.easel.getElement(),this.toolspace,this.toolspaceCollapser.getElement()]),(en=this.embed?new m.EmbedToolspaceTopRow({onHelp:function(){(0,v.showIframeModal)(er.embed.url+"/help.html",!!er.embed)},onSubmit:function(){eb();var e,t=function(){var e,t=(0,f.BB).el({tagName:"button",textContent:(0,B.LANG)("save-reminder-save-psd"),css:{display:"block"}});t.onclick=function(){er.saveAsPsd(),e()},(0,d.KL).popup({target:er.klRootEl,message:"<b>"+(0,B.LANG)("upload-failed")+"</b>",div:(0,f.BB).el({content:[(0,f.BB).el({content:(0,B.LANG)("backup-drawing"),css:{marginBottom:"10px"}}),t]}),ignoreBackground:!0,closeFunc:function(t){e=t}})};(0,d.KL).popup({target:er.klRootEl,message:(0,B.LANG)("submit-prompt"),buttons:[(0,B.LANG)("submit"),"Cancel"],callback:(e=(0,s._)(function(e){var n;return(0,p.__generator)(this,function(r){return e!==(0,B.LANG)("submit")||(n=(0,f.BB).el({parent:er.klRootEl,className:"upload-overlay",content:'<div class="spinner"></div> '+(0,B.LANG)("submit-submitting")}),er.embed.onSubmit(function(){i.saveReminder.reset(),n.remove()},function(){n.remove(),t()})),[2]})}),function(t){return e.apply(this,arguments)})})},onLeftRight:function(){er.uiState="left"===er.uiState?"right":"left",er.updateUi()}}):new d.KL.ToolspaceTopRow({logoImg:i.logoImg,onLogo:function(){(0,v.showIframeModal)("./home/",!!er.embed)},onNew:function(){eU()},onImport:function(){eW.triggerImport()},onSave:function(){er.saveToComputer.save()},onShare:function(){eX()},onHelp:function(){(0,v.showIframeModal)("./help/",!!er.embed)}})).getElement().style.marginBottom="10px",this.toolspaceInner.append(en.getElement()),this.toolspaceToolRow=new d.KL.ToolspaceToolRow({onActivate:function(e){if("hand"!==e&&eb(),"brush"===e)er.easel.setTool("brush");else if("hand"===e)er.easel.setTool("hand");else if("paintBucket"===e)er.easel.setTool("paintBucket");else if("gradient"===e)er.easel.setTool("gradient");else if("text"===e)er.easel.setTool("text");else if("shape"===e)er.easel.setTool("shape");else if("select"===e)er.easel.setTool("select");else throw Error("unknown activeStr");eu&&eu.open(e),eS(),er.klColorSlider.pickingDone()},onZoomIn:function(){var e=er.easel.getTransform().scale,t=(0,X.zoomByStep)(e,eE.isPressed("shift")?1/8:.5);er.easel.scale(t/e)},onZoomOut:function(){var e=er.easel.getTransform().scale,t=(0,X.zoomByStep)(e,eE.isPressed("shift")?-1/8:-.5);er.easel.scale(t/e)},onUndo:function(){ew()},onRedo:function(){ek()}}),this.toolspaceToolRow.setIsSmall(this.uiHeight<540),this.toolspaceInner.append(this.toolspaceToolRow.getElement()),this.klColorSlider=new d.KL.KlColorSlider({width:250,height:30,svHeight:100,startValue:new f.BB.RGB(0,0,0),onPick:function(e){ep=e,r.setColor(e),ev.emitColor(e),er.klColorSlider.pickingDone()},onEyedropper:function(e){e?er.easel.setTool("eyedropper"):er.easel.setTool(er.toolspaceToolRow.getActive())}}),this.klColorSlider.setHeight(Math.max(163,Math.min(400,this.uiHeight-505)));var eA=function(e){"eraserBrush"!==e&&(y=e),er.klColorSlider&&("eraserBrush"===e?er.klColorSlider.enable(!1):er.klColorSlider.enable(!0)),o=e,(r=eL[e]).setColor(ep),r.setContext(ed),er.easelBrush.setBrush({type:"pixelBrush"===o?"pixel-square":"round"}),er.toolspaceToolRow.setActive("brush"),eS()},eI=function(e){ed=e.context,r.setContext(e.context),er.layerPreview.setLayer(e)},eT=(0,f.BB).el(),eP=(0,f.BB).el({css:{margin:"10px",display:"flex",flexWrap:"wrap",justifyContent:"space-between",alignItems:"flex-end"}}),eR=new d.KL.ToolspaceStabilizerRow({smoothing:1,onSelect:function(e){em.setSmoothing((0,S.translateSmoothing)(e))}});eT.append(eP),(0,f.BB).append(eP,[this.klColorSlider.getElement(),this.klColorSlider.getOutputElement(),eR.getElement()]);var eM=new d.KL.TabRow({initialId:"penBrush",useAccent:!0,tabArr:function(){for(var e=[],t=function(e){return{id:e,image:d.KL.brushesUI[e].image,title:d.KL.brushesUI[e].tooltip,onOpen:function(){eL[e].getElement().style.display="block",eA(e),er.klColorSlider.pickingDone(),ev.emitSliderConfig({sizeSlider:d.KL.brushesUI[e].sizeSlider,opacitySlider:d.KL.brushesUI[e].opacitySlider}),ef(eL[e].getSize()),ev.emitOpacity(eL[e].getOpacity())},onClose:function(){eL[e].getElement().style.display="none"}}},i=Object.keys(eL),n=0;n<i.length;n++)e.push(t(i[n]));return e}()});(0,f.BB).append(eT,[eM.getElement()].concat((0,u._)(Object.entries(d.KL.brushesUI).map(function(e){return eL[(0,c._)(e,1)[0]].getElement()}))));var eD=new d.KL.HandUi({scale:this.easel.getTransform().scale,angleDeg:0,onReset:function(){er.easel.resetTransform()},onFit:function(){er.easel.fitTransform()},onAngleChange:function(e,t){er.easel.setAngleDeg(e,t)}}),eO=new d.KL.FillUi({colorSlider:this.klColorSlider}),e_=new d.KL.GradientUi({colorSlider:this.klColorSlider}),eN=new d.KL.TextUi({colorSlider:this.klColorSlider}),ez=new d.KL.ShapeUi({colorSlider:this.klColorSlider}),eG=new d.KL.GradientTool({onGradient:function(e,t,i,n,r,s){var a=(0,z.throwIfNull)(er.klCanvas.getLayerIndex(ed.canvas)),o=e_.getSettings(),l={type:o.type,color1:er.klColorSlider.getColor(),isReversed:o.isReversed,opacity:o.opacity,doLockAlpha:o.doLockAlpha,isEraser:o.isEraser,doSnap:eE.isPressed("shift")||o.doSnap,x1:t,y1:i,x2:n,y2:r,angleRad:s};e?(er.klCanvas.setComposite(a,void 0),er.klCanvas.drawGradient(a,l)):er.klCanvas.setComposite(a,{draw:function(e){(0,d.KL).drawGradient(e,l)}}),er.easelProjectUpdater.update()}}),ej=new d.KL.ShapeTool({onShape:function(e,t,i,n,r,s){var a=(0,z.throwIfNull)(er.klCanvas.getLayerIndex(ed.canvas)),o={type:ez.getShape(),x1:t,y1:i,x2:n,y2:r,angleRad:s,isOutwards:ez.getIsOutwards(),opacity:ez.getOpacity(),isEraser:ez.getIsEraser(),doLockAlpha:ez.getDoLockAlpha()};"line"===ez.getShape()?(o.strokeRgb=er.klColorSlider.getColor(),o.lineWidth=ez.getLineWidth(),o.isAngleSnap=ez.getIsSnap()||eE.isPressed("shift")):(o.isFixedRatio=ez.getIsFixed()||eE.isPressed("shift"),"stroke"===ez.getMode()?(o.strokeRgb=er.klColorSlider.getColor(),o.lineWidth=ez.getLineWidth()):o.fillRgb=er.klColorSlider.getColor()),e?(er.klCanvas.setComposite(a,void 0),er.klCanvas.drawShape(a,o)):er.klCanvas.setComposite(a,{draw:function(e){(0,d.KL).drawShape(e,o)}}),er.easelProjectUpdater.update()}});this.layersUi=new d.KL.LayersUi({klCanvas:this.klCanvas,onSelect:function(e){eI((0,z.throwIfNull)(er.klCanvas.getLayer(e))),eh.push({tool:["misc"],action:"focusLayer",params:[e]})},parentEl:this.klRootEl,uiState:this.uiState,applyUncommitted:function(){return eb()},history:eh,onUpdateProject:function(){return er.easelProjectUpdater.update()}}),this.layerPreview=new d.KL.LayerPreview({klRootEl:this.klRootEl,onClick:function(){eu&&eu.open("layers")},uiState:this.uiState,history:eh}),this.layerPreview.setIsVisible(this.uiHeight>=579),this.layerPreview.setLayer(this.klCanvas.getLayer(this.klCanvas.getLayerIndex(ed.canvas)));var eF=new d.KL.FilterUi({klRootEl:this.klRootEl,klColorSlider:this.klColorSlider,layersUi:this.layersUi,getCurrentColor:function(){return ep},getKlMaxCanvasSize:function(){return ea},klCanvas:this.klCanvas,getCurrentLayerCtx:function(){return ed},isEmbed:!!this.embed,statusOverlay:this.statusOverlay,onCanvasChanged:function(){er.easelProjectUpdater.update(),er.easel.resetOrFitTransform()},applyUncommitted:function(){return eb()},history:eh}),eH=new ee.KlHistoryExecutor({history:eh,tempHistory:ec,brushUiMap:eL,getOldestProjectState:function(){return n},klCanvas:this.klCanvas,getCurrentLayerCtx:function(){return ed},setCurrentLayerCtx:function(e){ed=e},onExecuted:function(e,t){var i=(0,z.throwIfNull)(er.klCanvas.getLayerIndex(ed.canvas));r.setContext(ed),er.easelBrush.setLastDrawEvent(),er.layersUi.update(i),er.layerPreview.setLayer(er.klCanvas.getLayer(i)),e&&(er.easelProjectUpdater.update(),er.easel.resetOrFitTransform()),eC.onHistory(t)},onCanUndoRedoChange:function(e,t){er.toolspaceToolRow.setEnableUndo(e),er.toolspaceToolRow.setEnableRedo(t)}}),eU=function(){eb(),(0,d.KL).newImageDialog({currentColor:ep,secondaryColor:er.klColorSlider.getSecondaryRGB(),maxCanvasSize:ea,canvasWidth:er.klCanvas.getWidth(),canvasHeight:er.klCanvas.getHeight(),workspaceWidth:window.innerWidth<er.collapseThreshold?er.uiWidth:er.uiWidth-er.toolWidth,workspaceHeight:er.uiHeight,onConfirm:function(e,t,i){er.klCanvas.reset({width:e,height:t,color:1===i.a?i:void 0}),er.layersUi.update(0),eI((0,z.throwIfNull)(er.klCanvas.getLayer(0))),er.easelProjectUpdater.update(),er.easel.resetOrFitTransform()},onCancel:function(){}})},eX=function(e){eb(),(0,f.BB).shareCanvas({canvas:er.klCanvas.getCompleteCanvas(1),fileName:(0,f.BB).getDate()+G.klConfig.filenameBase+".png",title:(0,f.BB).getDate()+G.klConfig.filenameBase+".png",callback:e||function(){}})};this.saveToComputer=new d.KL.SaveToComputer(i.saveReminder,function(){return el},this.klCanvas);var eV=function(e){(0,d.KL).clipboardDialog(er.klRootEl,er.klCanvas.getCompleteCanvas(1),function(e){(0!==e.left||0!==e.right||0!==e.top||0!==e.bottom)&&((0,d.KL).filterLib.cropExtend.apply({context:ed,klCanvas:er.klCanvas,input:e,history:eh}),er.layersUi.update(),er.easelProjectUpdater.update(),er.easel.resetOrFitTransform())},er.statusOverlay,e||!1)},eW=this.embed?null:new d.KL.FileUi({klRootEl:this.klRootEl,projectStore:eo,getProject:function(){return er.klCanvas.getProject()},exportType:el,onExportTypeChange:function(e){el=e},onFileSelect:function(e,t){return eK.handleFileSelect(e,t)},onSaveImageToComputer:function(){eb(),er.saveToComputer.save()},onNewImage:eU,onShareImage:function(){eb(),eX()},onUpload:function(){eb(),(0,d.KL).imgurUpload(er.klCanvas,er.klRootEl,i.saveReminder,i.app&&i.app.imgurKey?i.app.imgurKey:"")},onCopyToClipboard:function(){eb(),eV()},saveReminder:i.saveReminder,applyUncommitted:function(){return eb()}}),eY=new d.KL.SettingsUi({onLeftRight:function(){er.uiState="left"===er.uiState?"right":"left",er.updateUi(),er.embed||(0,w.LocalStorage).setItem("uiState",er.uiState)},saveReminder:this.embed?void 0:i.saveReminder,customAbout:i.aboutEl});eu=new d.KL.TabRow({initialId:"brush",tabArr:[{id:"brush",title:(0,B.LANG)("tool-brush"),image:/*@__PURE__*/t(L),onOpen:function(){"eraserBrush"===o&&er.klColorSlider.enable(!1),(0,f.BB).append(eP,[er.klColorSlider.getElement(),er.klColorSlider.getOutputElement(),eR.getElement()]),eT.style.display="block"},onClose:function(){eT.style.display="none"},css:{minWidth:"45px"}},{id:"hand",title:(0,B.LANG)("tool-hand"),image:/*@__PURE__*/t(A),isVisible:!1,onOpen:function(){eD.setIsVisible(!0)},onClose:function(){eD.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"paintBucket",title:(0,B.LANG)("tool-paint-bucket"),image:/*@__PURE__*/t(I),isVisible:!1,onOpen:function(){er.klColorSlider.enable(!0),eO.setIsVisible(!0)},onClose:function(){eO.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"gradient",title:(0,B.LANG)("tool-gradient"),image:/*@__PURE__*/t(T),isVisible:!1,onOpen:function(){er.klColorSlider.enable(!0),e_.setIsVisible(!0)},onClose:function(){e_.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"text",title:(0,B.LANG)("tool-text"),image:/*@__PURE__*/t(P),isVisible:!1,onOpen:function(){er.klColorSlider.enable(!0),eN.setIsVisible(!0)},onClose:function(){eN.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"shape",title:(0,B.LANG)("tool-shape"),image:/*@__PURE__*/t(R),isVisible:!1,onOpen:function(){er.klColorSlider.enable(!0),ez.setIsVisible(!0)},onClose:function(){ez.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"select",title:(0,B.LANG)("tool-select"),image:/*@__PURE__*/t(M),isVisible:!1,onOpen:function(){eC.getSelectUi().setIsVisible(!0)},onClose:function(){eC.getSelectUi().setIsVisible(!1)},css:{minWidth:"45px"}},{id:"layers",title:(0,B.LANG)("layers"),image:/*@__PURE__*/t(O),onOpen:function(){er.layersUi.update(),er.layersUi.getElement().style.display="block"},onClose:function(){er.layersUi.getElement().style.display="none"},css:{minWidth:"45px"}},{id:"edit",label:(0,B.LANG)("tab-edit"),onOpen:function(){eF.show()},onClose:function(){eF.hide()},css:{padding:"0 7px"}},{id:"file",label:(0,B.LANG)("tab-file"),isVisible:!!eW,onOpen:function(){eW&&(eW.getElement().style.display="block",eW.setIsVisible(!0))},onClose:function(){eW&&(eW.getElement().style.display="none",eW.setIsVisible(!1))},css:{padding:"0 7px"}},{id:"settings",title:(0,B.LANG)("tab-settings"),image:/*@__PURE__*/t(D),onOpen:function(){eY.getElement().style.display="block"},onClose:function(){eY.getElement().style.display="none"},css:{minWidth:"45px"}}]}),this.bottomBarWrapper=(0,f.BB).el({css:{width:"270px",position:"absolute",bottom:"0",left:"0"}}),i.bottomBar&&(this.bottomBar=i.bottomBar,this.bottomBarWrapper.append(this.bottomBar),new MutationObserver(function(){return er.updateBottomBar()}).observe(this.toolspaceInner,{attributes:!0,childList:!0,subtree:!0})),(0,f.BB).append(this.toolspaceInner,[this.layerPreview.getElement(),eu.getElement(),eT,eD.getElement(),eO.getElement(),e_.getElement(),eN.getElement(),ez.getElement(),eC.getSelectUi().getElement(),this.layersUi.getElement(),eF.getElement(),eW?eW.getElement():void 0,eY.getElement(),(0,f.BB).el({css:{height:"10px"}}),this.bottomBarWrapper?this.bottomBarWrapper:void 0]),this.toolspaceScroller=new d.KL.ToolspaceScroller({toolspace:this.toolspace,uiState:this.uiState}),this.embed||Object.defineProperty(window,"KL",{value:(0,_.createConsoleApi)({onDraw:function(e){e&&0!==e.length&&(e.forEach(function(e,t){0===t?r.startLine(e.x,e.y,1):r.goLine(e.x,e.y,1)}),r.endLine())}}),writable:!1}),this.resize(this.uiWidth,this.uiHeight),this.updateUi();var eK=new E.KlAppImportHandler({klRootEl:this.klRootEl,klMaxCanvasSize:ea,layersUi:this.layersUi,setCurrentLayer:eI,klCanvas:this.klCanvas,onImportConfirm:function(){er.easelProjectUpdater.update(),er.easel.resetOrFitTransform()}},{onColor:function(e){return ev.setColor(e)}});this.embed||(new d.KL.KlImageDropper({target:document.body,onDrop:function(e,t){(0,d.KL).dialogCounter.get()>0||(eb(),eK.handleFileSelect(e,t))},enabledTest:function(){return 0===(0,d.KL).dialogCounter.get()}}),window.document.addEventListener("paste",function(e){return eK.onPaste(e)},!1)),window.addEventListener("resize",function(){er.resize(window.innerWidth,window.innerHeight)}),window.addEventListener("orientationchange",function(){er.resize(window.innerWidth,window.innerHeight)}),"visualViewport"in window&&null!==visualViewport&&visualViewport.addEventListener("resize",function(){er.resize(window.innerWidth,window.innerHeight)});var eq=(0,f.BB).el({parent:document.body,css:{position:"fixed",left:"0",top:"0",right:"0",bottom:"0",pointerEvents:"none",zIndex:"-1",userSelect:"none"}});try{new ResizeObserver(function(){return er.resize(window.innerWidth,window.innerHeight)}).observe(eq)}catch(e){eq.remove()}this.klRootEl.addEventListener("wheel",function(e){eE.isPressed("ctrl")&&e.preventDefault()},{passive:!1});var eZ=function(e){e.preventDefault()};window.addEventListener("gesturestart",eZ,{passive:!1}),window.addEventListener("gesturechange",eZ,{passive:!1}),window.addEventListener("gestureend",eZ,{passive:!1}),new et.PinchZoomWatcher,i.saveReminder.setHistory(eh)}return(0,o._)(e,[{key:"updateCollapse",value:function(){this.uiWidth<this.collapseThreshold?(this.toolspaceCollapser.getElement().style.display="block",this.toolspaceCollapser.setDirection(this.uiState),this.toolspaceCollapser.isOpen()?("left"===this.uiState?((0,f.BB).css(this.toolspaceCollapser.getElement(),{left:"271px",right:""}),(0,f.BB).css(this.easel.getElement(),{left:"271px"})):((0,f.BB).css(this.toolspaceCollapser.getElement(),{left:"",right:"271px"}),(0,f.BB).css(this.easel.getElement(),{left:"0"})),this.toolspace.style.display="block",this.easel.setSize(Math.max(0,this.uiWidth-this.toolWidth),this.uiHeight),this.statusOverlay.setWide(!1)):("left"===this.uiState?(0,f.BB).css(this.toolspaceCollapser.getElement(),{left:"0",right:""}):(0,f.BB).css(this.toolspaceCollapser.getElement(),{left:"",right:"0"}),this.toolspace.style.display="none",this.easel.setSize(Math.max(0,this.uiWidth),this.uiHeight),this.statusOverlay.setWide(!0))):(this.toolspaceCollapser.getElement().style.display="none","left"===this.uiState&&(0,f.BB).css(this.easel.getElement(),{left:"271px"}),this.toolspace.style.display="block",this.easel.setSize(Math.max(0,this.uiWidth-this.toolWidth),this.uiHeight),this.statusOverlay.setWide(!1))}},{key:"updateBottomBar",value:function(){if(this.bottomBar){var e=this.toolspaceInner.scrollHeight+40<window.innerHeight?"":"none";e!==this.bottomBarWrapper.style.display&&(this.bottomBarWrapper.style.display=e)}}},{key:"updateUi",value:function(){this.toolspace.classList.toggle("kl-toolspace--left","left"===this.uiState),this.toolspace.classList.toggle("kl-toolspace--right","right"===this.uiState),"left"===this.uiState?((0,f.BB).css(this.toolspace,{left:"0",right:""}),(0,f.BB).css(this.easel.getElement(),{left:"271px"})):((0,f.BB).css(this.toolspace,{left:"",right:"0"}),(0,f.BB).css(this.easel.getElement(),{left:"0"})),this.statusOverlay.setUiState(this.uiState),this.layerPreview.setUiState(this.uiState),this.layersUi.setUiState(this.uiState),this.updateCollapse(),this.toolspaceScroller.updateUiState(this.uiState)}},{key:"getEl",value:function(){return this.klRootEl}},{key:"resize",value:function(e,t){window.scrollY>0&&window.scrollTo(0,0),(this.uiWidth!==Math.max(0,e)||this.uiHeight!==Math.max(0,t))&&(this.uiWidth=Math.max(0,e),this.uiHeight=Math.max(0,t),this.updateCollapse(),this.updateBottomBar(),this.layerPreview.setIsVisible(this.uiHeight>=579),this.klColorSlider.setHeight(Math.max(163,Math.min(400,this.uiHeight-505))),this.toolspaceToolRow.setIsSmall(this.uiHeight<540))}},{key:"out",value:function(e){this.statusOverlay.out(e)}},{key:"getPNG",value:function(){return(0,x.base64ToBlob)(this.klCanvas.getCompleteCanvas(1).toDataURL("image/png"))}},{key:"getProject",value:function(){return this.klCanvas.getProject()}},{key:"swapUiLeftRight",value:function(){this.uiState="left"===this.uiState?"right":"left",this.embed||(0,w.LocalStorage).setItem("uiState",this.uiState),this.updateUi()}},{key:"saveAsPsd",value:function(){this.saveToComputer.save("psd")}},{key:"isDrawing",value:function(){return this.lineSanitizer.getIsDrawing()||this.easel.getIsLocked()}}]),e}()}),n("bX4ja",function(t,n){e(t.exports,"_",function(){return l});var r=i("6KGpL"),s=i("5mm0I"),a=i("kD20o"),o=i("kWe4k");function l(e){return(0,r._)(e)||(0,s._)(e)||(0,o._)(e)||(0,a._)()}}),n("6KGpL",function(t,n){e(t.exports,"_",function(){return s});var r=i("gszWS");function s(e){if(Array.isArray(e))return(0,r._)(e)}}),n("5mm0I",function(t,i){e(t.exports,"_",function(){return n});function n(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}}),n("kD20o",function(t,i){e(t.exports,"_",function(){return n});function n(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}}),n("hrnUX",function(t,n){e(t.exports,"KL",function(){return ey});var r=i("2MaaK"),s=i("dLlkc"),a=i("i8UFO"),o=i("7bWhB"),l=i("dJPtW"),h=i("eEL9N"),c=i("1kyaA"),u=i("4nUqS"),p=i("lCF5N"),d=i("aP0jf"),g=i("11glk"),f=i("lfHl9"),v=i("fg9Sv"),m=i("gmji4"),y=i("j5jvd"),x=i("43qNf"),b=i("iFIyy"),B=i("bmB93"),w=i("hRdOL"),k=i("isYih"),C=i("b4yIv"),S=i("5UrL9"),E=i("cNhNm"),L=i("kEeSq"),A=i("32CBv"),I=i("kqmpc"),T=i("8ebuX"),P=i("13r5y"),R=i("9p4Zp"),M=i("8jqzp"),D=i("84zxV"),O=i("9Kxky"),_=i("1Ax5m"),N=i("e4sAN"),z=i("khi8I"),G=i("dJXmR"),j=i("iS9xS"),F=i("9J17G"),H=i("76Qvv"),U=i("1uc3b"),X=i("h20yl"),V=i("dHnZA"),W=i("kDGzx"),Y=i("30Cml"),K=i("941rU"),q=i("3ujzu"),Z=i("705qg"),$=i("9BlwZ"),Q=i("kyVjY"),J=i("dAXbp"),ee=i("3P46L"),et=i("h62LS"),ei=i("fRGIf"),en=i("9pcu9"),er=i("aSJRf"),es=i("6mTnI"),ea=i("6LAlx"),eo=i("2KGGj"),el=i("5ENro"),eh=i("iVf04"),ec=i("5ngYX"),eu=i("eyygR"),ep=i("7pyBK"),ed=i("cmnov"),eg=i("byS9j"),ef=i("iVHpg"),ev=i("5Gc7M"),em=i("7EG77"),ey={brushes:J.brushes,brushesUI:ee.brushesUI,BrushSettingService:ep.BrushSettingService,KlCanvas:Z.KlCanvas,drawProject:er.drawProject,KlCanvasPreview:S.KlCanvasPreview,filterLibStatus:Q.filterLibStatus,filterLib:Q.filterLib,renderText:X.renderText,floodFillBits:Y.floodFillBits,ShapeTool:q.ShapeTool,drawShape:q.drawShape,GradientTool:em.GradientTool,drawGradient:em.drawGradient,PSD:K,setDbName:$.setDbName,indexedDb:$,ProjectStore:es.ProjectStore,loadAgPsd:eh.loadAgPsd,SaveToComputer:eu.SaveToComputer,calcSliderFalloffFactor:g.calcSliderFalloffFactor,Checkbox:o.Checkbox,input:l.input,Select:h.Select,ImageToggle:c.ImageToggle,ImageRadioList:u.ImageRadioList,RadioList:ei.RadioList,createPenPressureToggle:p.createPenPressureToggle,KlSlider:d.KlSlider,HexColorDialog:f.HexColorDialog,KlColorSlider:v.KlColorSlider,KlColorSliderSmall:m.KlColorSliderSmall,PointSlider:y.PointSlider,ColorOptions:x.ColorOptions,Options:b.Options,BoxToggle:ed.BoxToggle,StatusOverlay:B.StatusOverlay,CropCopy:w.CropCopy,FreeTransform:E.FreeTransform,FreeTransformCanvas:L.FreeTransformCanvas,Cropper:A.Cropper,LayerPreview:I.LayerPreview,KlImageDropper:P.KlImageDropper,OverlayToolspace:R.OverlayToolspace,ToolspaceTopRow:M.ToolspaceTopRow,ToolDropdown:D.ToolDropdown,ToolspaceToolRow:O.ToolspaceToolRow,ToolspaceStabilizerRow:_.ToolspaceStabilizerRow,TabRow:N.TabRow,ToolspaceCollapser:U.ToolspaceCollapser,BrowserStorageUi:en.BrowserStorageUi,SaveReminder:ec.SaveReminder,ToolspaceScroller:ef.ToolspaceScroller,dialogCounter:a.dialogCounter,popup:r.showModal,Popup:s.DynamicModal,clipboardDialog:k.clipboardDialog,showImportAsLayerDialog:T.showImportAsLayerDialog,newImageDialog:H.newImageDialog,textToolDialog:V.textToolDialog,showImportImageDialog:W.showImportImageDialog,showIframePopup:et.showIframeModal,imgurUpload:el.imgurUpload,HandUi:z.HandUi,FillUi:G.FillUi,GradientUi:ev.GradientUi,TextUi:j.TextUi,ShapeUi:F.ShapeUi,FileUi:ea.FileUi,FilterUi:eo.FilterUi,SettingsUi:eg.SettingsUi,LayersUi:C.LayersUi};Object.keys(ey)}),n("2MaaK",function(n,r){e(n.exports,"showModal",function(){return c});var s=i("i8UFO"),a=i("eWjiX"),o=i("1mH1z");i("8zjca");var l=i("jRYue"),h=i("3woRO");function c(e){(0,s.dialogCounter).increase();var i,n,r=!1,c=!!e.ignoreBackground,u=(0,a.BB).el({parent:document.body,css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",overflow:"hidden"}}),p=(0,a.BB).el({parent:u,className:"kl-popup"}),d=(0,a.BB).el({parent:p,css:{width:"100%",minHeight:"100%",position:"relative",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}}),g=(0,a.BB).el({parent:d,onClick:function(){c||k("Cancel")},css:{position:"absolute",left:"0",top:"0",zIndex:"0",width:"100%",height:"100%"}}),f=(0,a.BB).el({tagName:"button",className:"popup-x",content:`<img alt="${(0,o.LANG)("modal-close")}" height="20" src="${/*@__PURE__*/t(l)}">`,title:(0,o.LANG)("modal-close"),onClick:function(){k("Cancel")},css:{width:"40px",height:"40px",lineHeight:"40px",position:"absolute",right:"0",top:"0",background:"none",boxShadow:"none"}}),v=void 0;e.type&&(v=(0,a.BB).el({className:{error:"kl-popup__icon-error",ok:"kl-popup__icon-ok",warning:"kl-popup__icon-warning",upload:"kl-popup__icon-upload"}[e.type]}));var m=["kl-popup-box"];m.push("kl-popup-box--sm");var y=(0,a.BB).el({content:[f,v,(0,a.BB).el({content:e.message,css:{marginRight:"15px",marginBottom:e.div?"10px":void 0}}),e.div],className:m.join(" "),css:e.style?e.style:void 0});d.append((0,a.BB).el({css:{flex:"0.5"}}),y,(0,a.BB).el({css:{flex:"1"}}));var x=new a.BB.KeyListener({onDown:function(e,t,i){r||(n&&"enter"===i&&!(0,a.BB).isInputFocused()&&(t.stopPropagation(),setTimeout(function(){n&&n.click()},10)),"esc"===i&&(t.stopPropagation(),k("Cancel")))}}),b=function(e){x.isPressed("ctrl")&&e.preventDefault()};p.addEventListener("wheel",b,{passive:!1}),p.onclick=a.BB.handleClick,i=e.autoFocus?e.autoFocus:!1===e.autoFocus?void 0:"Ok";var B=e.buttons&&e.buttons.length>0?(0,a.BB).el({parent:y,css:{display:"flex",flexWrap:"wrap",justifyContent:"flex-end",marginTop:"12px",marginLeft:"-8px"}}):void 0,w=[];function k(t){!r&&(r=!0,(0,a.BB).clearSelection(),(0,a.BB).unfocusAnyInput(),u.remove(),(0,s.dialogCounter).decrease(),(0,a.BB).destroyEl(f),(0,a.BB).destroyEl(g),x.destroy(),p.removeEventListener("wheel",b),p.onclick=null,w.forEach(function(e){return(0,a.BB).destroyEl(e)}),w.splice(0,w.length),e.callback&&e.callback(t))}return e.buttons&&e.buttons.forEach(function(r){var s,c=["kl-popup__btn"];("Ok"===r||e.primaries&&e.primaries.includes(r))&&c.push("kl-button-primary");var u=r;"Ok"===r&&(u=(0,o.LANG)("modal-ok"),s=/*@__PURE__*/t(h)),"Cancel"===r&&(u=(0,o.LANG)("modal-cancel"),s=/*@__PURE__*/t(l),c.push("kl-button-cancel"));var d=void 0;s&&(d=(0,a.BB).el({tagName:"img",custom:{src:s,height:"17"}}));var g=(0,a.BB).el({parent:B,tagName:"button",className:c.join(" "),content:[d,(0,a.BB).el({className:"kl-popup__btn__text",content:u})],onClick:function(){k(r)}});w.push(g),i===r&&(setTimeout(function(){g.focus(),p.scrollTo(0,0)},10),setTimeout(function(){p.scrollTo(0,0)},20)),r===e.clickOnEnter&&(n=g)}),e.closeFunc&&e.closeFunc(function(){k("Cancel")}),{setIgnoreBackground:function(e){c=e}}}}),n("i8UFO",function(t,n){e(t.exports,"dialogCounter",function(){return a});var r=i("cx0mh"),s=i("7h4XF"),a=new/*#__PURE__*/(function(){function e(){(0,r._)(this,e),this.listeners=[],this.count=0}return(0,s._)(e,[{key:"emit",value:function(){var e=this;this.listeners.forEach(function(t){t(e.count)})}},{key:"increase",value:function(e){void 0!==e?this.count+=e:this.count++,this.emit()}},{key:"decrease",value:function(e){void 0!==e?this.count-=e:this.count--,this.emit()}},{key:"get",value:function(){return this.count}},{key:"subscribe",value:function(e){this.listeners.push(e)}}]),e}())}),n("eWjiX",function(t,n){e(t.exports,"BB",function(){return C});var r=i("7jh4K"),s=i("6J2My"),a=i("idV3L"),o=i("04lDo"),l=i("eIcQa"),h=i("kVHNC"),c=i("4toIY"),u=i("af1iA"),p=i("dJ1E2"),d=i("72Jv0"),g=i("eg83P"),f=i("eelgW"),v=i("i0uIf"),m=i("6l0gQ"),y=i("jjWRi"),x=i("2pgVs"),b=i("joplQ"),B=i("c1lmK"),w=i("635F6"),k=i("gCzYB"),C={eventUsesHighResTimeStamp:s.eventUsesHighResTimeStamp,hasPointerEvents:s.hasPointerEvents,isCssMinMaxSupported:s.isCssMinMaxSupported,canShareFiles:s.canShareFiles,unsetEventHandler:s.unsetEventHandler,insertAfter:r.insertAfter,loadImage:r.loadImage,css:r.css,setAttributes:r.setAttributes,append:r.append,fitInto:r.fitInto,centerWithin:r.centerWithin,getDate:r.getDate,gcd:r.gcd,reduce:r.reduce,decToFraction:r.decToFraction,imageBlobToUrl:r.imageBlobToUrl,dateDayDifference:r.dateDayDifference,copyObj:r.copyObj,shareCanvas:r.shareCanvas,handleClick:r.handleClick,createSvg:r.createSvg,BbLog:v.BbLog,LocalStorage:m.LocalStorage,throwIfNull:r.throwIfNull,nullToUndefined:r.nullToUndefined,isDark:r.isDark,mix:g.mix,dist:g.dist,distSquared:g.distSquared,lenSquared:g.lenSquared,pointsToAngleRad:g.pointsToAngleRad,pointsToAngleDeg:g.pointsToAngleDeg,isInsideRect:g.isInsideRect,clamp:g.clamp,rotate:g.rotate,rotateAround:g.rotateAround,Matrix:h.Matrix,Vec2:c.Vec2,intDxy:g.intDxy,roundEven:g.roundEven,roundUneven:g.roundUneven,round:g.round,updateBounds:g.updateBounds,boundsInArea:g.boundsInArea,projectPointOnLine:u.projectPointOnLine,PointLine:u.PointLine,BezierLine:u.BezierLine,SplineInterpolator:u.SplineInterpolator,quadraticSplineInput:u.quadraticSplineInput,canvas:f.createCanvas,ctx:l.ctx,copyCanvas:l.copyCanvas,testShouldPixelate:l.testShouldPixelate,drawTransformedImageWithBounds:l.drawTransformedImageWithBounds,drawTransformedImageOnCanvas:l.drawTransformedImageOnCanvas,createCheckerCanvas:l.createCheckerCanvas,createCheckerDataUrl:l.createCheckerDataUrl,resizeCanvas:l.resizeCanvas,convertToAlphaChannelCanvas:l.convertToAlphaChannelCanvas,freeCanvas:l.freeCanvas,canvasBounds:l.canvasBounds,HSV:p.HSV,RGB:p.RGB,CMYK:p.CMYK,ColorConverter:p.ColorConverter,testIsWhiteBestContrast:p.testIsWhiteBestContrast,appendTextDiv:d.appendTextDiv,clearSelection:d.clearSelection,makeUnfocusable:d.makeUnfocusable,el:d.el,destroyEl:d.destroyEl,isInputFocused:d.isInputFocused,unfocusAnyInput:d.unfocusAnyInput,KeyListener:a.KeyListener,PointerListener:o.PointerListener,sameKeys:a.sameKeys,EventChain:k.EventChain,DoubleTapper:B.DoubleTapper,NFingerTapper:x.NFingerTapper,PinchZoomer:b.PinchZoomer,CoalescedExploder:y.CoalescedExploder,OnePointerLimiter:w.OnePointerLimiter};Object.keys(C)}),n("6J2My",function(t,i){e(t.exports,"isFirefox",function(){return r}),e(t.exports,"eventUsesHighResTimeStamp",function(){return s}),e(t.exports,"hasPointerEvents",function(){return a}),e(t.exports,"isCssMinMaxSupported",function(){return o}),e(t.exports,"canShareFiles",function(){return l}),e(t.exports,"unsetEventHandler",function(){return h});var n,r=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,s=(n=new Event("").timeStamp<36e5,function(){return n}),a=!!window.PointerEvent,o=function(){var e;function t(){var t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.left="max(0px, 25px)",document.body.append(t),setTimeout(function(){e=25===t.offsetLeft,t.remove()},25)}return document.body?t():window.addEventListener("DOMContentLoaded",function(){t()}),function(){if(void 0===e)throw Error("isCssMinMaxSupported not initialized");return e}}(),l=function(){return"share"in navigator&&"canShare"in navigator};function h(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];i.forEach(function(t){e[t]=null})}}),n("idV3L",function(t,n){e(t.exports,"KeyListener",function(){return k}),e(t.exports,"sameKeys",function(){return C});var r,s,a,o,l,h,c,u,p,d,g,f,v,m,y,x=i("cx0mh"),b=i("7h4XF"),B=i("8N5YG"),w=(s=function(e){var t=e.key,i=e.code;if(t in u){var n=u[t];if(c[n]){v(n,e,p.join("+"),!0);return}"cmd"===n?f(n,i):clearTimeout(r),c[n]=!0,d[i]=n,p.push(n),v(n,e,p.join("+"))}},a=function(e){var t=e.code,i=p.join("+");if(["Meta","MetaLeft","MetaRight","OSLeft","OSRight"].includes(t)||c.cmd){o();return}var n=d[t];if(void 0!==n){c[n]=!1,d[t]=void 0;for(var r=0;r<p.length;r++)p[r]==n&&(p.splice(r,1),r--);m(n,e,i)}},o=function(){var e=p.join("+");p=[],d={};var t=[];h.forEach(function(e){c[e]&&(c[e]=!1,t.push(e))});for(var i=0;i<t.length;i++)m(t[i],{preventDefault:function(){},stopPropagation:function(){}},e);y()},h=Object.keys(l={space:[" ","Spacebar"],alt:["Alt","AltGraph"],shift:"Shift",ctrl:"Control",cmd:["Meta","MetaLeft","MetaRight"],enter:"Enter",esc:"Escape",backspace:"Backspace",delete:"Delete",sqbr_open:"[",sqbr_close:"]",a:["a","A"],b:["b","B"],c:["c","C"],e:["e","E"],f:["f","F"],g:["g","G"],l:["l","L"],r:["r","R"],s:["s","S"],t:["t","T"],u:["u","U"],x:["x","X"],y:["y","Y"],z:["z","Z"],plus:"+",minus:"-",left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown",home:"Home",end:"End"}),c=Object.entries(l).reduce(function(e,t){return e[(0,B._)(t,1)[0]]=!1,e},{}),u=Object.entries(l).reduce(function(e,t){var i=(0,B._)(t,2),n=i[0],r=i[1];return"string"==typeof r?e[r]=n:r.forEach(function(t){e[t]=n}),e},{}),p=[],d={},g=[],f=function(e,t){r=setTimeout(function(){if(1===p.length&&"cmd"!==p[0]){var i=p.join("+");c[e]=!1,d[t]=void 0;for(var n=0;n<p.length;n++)p[n]==e&&(p.splice(n,1),n--);m(e,{preventDefault:function(){},stopPropagation:function(){}},i),r=void 0}},1e3)},v=function(e,t,i,n){g.forEach(function(r){r[0]&&r[0](e,t,i,n)})},m=function(e,t,i){g.forEach(function(n){n[1]&&n[1](e,t,i)})},y=function(){g.forEach(function(e){e[2]&&e[2]()})},{add:function(e){if(!g.includes(e)){var t=0===g.length;g.push(e),t&&(document.addEventListener("keydown",s),document.addEventListener("keyup",a),window.addEventListener("blur",o))}},remove:function(e){if(g.includes(e)){for(var t=1===g.length,i=0;i<g.length;i++)if(g[i]===e){g.splice(i,1);break}t&&(document.removeEventListener("keydown",s),document.removeEventListener("keyup",a),window.removeEventListener("blur",o))}},getIsDown:function(){return c},getCombo:function(){return p}}),k=/*#__PURE__*/function(){function e(t){(0,x._)(this,e),this.onDown=t.onDown,this.onUp=t.onUp,this.onBlur=t.onBlur,this.ref=[this.onDown,this.onUp,this.onBlur],w.add(this.ref)}return(0,b._)(e,[{key:"isPressed",value:function(e){if(!(e in w.getIsDown()))throw'key "'+e+'" not found';return w.getIsDown()[e]}},{key:"getComboStr",value:function(){return w.getCombo().join("+")}},{key:"comboOnlyContains",value:function(e){for(var t=0;t<w.getCombo().length;t++)if(!e.includes(w.getCombo()[t]))return!1;return!0}},{key:"destroy",value:function(){w.remove(this.ref)}}]),e}();function C(e,t){return e.split("+").sort().join("+")===t.split("+").sort().join("+")}}),n("04lDo",function(t,n){e(t.exports,"PointerListener",function(){return k});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("4EWN2"),l=i("6J2My"),h=i("93oLo"),c=i("eIAon"),u=[];function p(e){switch(e){case 1:return"left";case 2:return"right";case 4:return"middle";default:return}}var d=new c.PressureNormalizer,g=(0,l.eventUsesHighResTimeStamp)()?0:-performance.timing.navigationStart,f=l.hasPointerEvents?"pointerdown":"mousedown",v=l.hasPointerEvents?"pointermove":"mousemove",m=l.hasPointerEvents?"pointerup":"mouseup",y=l.hasPointerEvents?"pointercancel":"mousecancel",x=l.hasPointerEvents?"pointerleave":"mouseleave",b=l.hasPointerEvents?"pointerenter":"mouseenter";function B(e){if("corrected"in e)return e.corrected;var t,i={pointerId:e.pointerId,pointerType:e.pointerType,pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY,movementX:e.movementX,movementY:e.movementY,timeStamp:e.timeStamp+g,pressure:d.normalize(e.pressure),buttons:void 0!==e.buttons?e.buttons:void 0!==e.button?[1,4,2,8,16][e.button]:0,button:e.button,coalescedArr:[],eventPreventDefault:function(){return e.preventDefault()},eventStopPropagation:function(){return e.stopPropagation()}};e.corrected=i;var n=null;"pointerId"in e?"pressure"in e&&0!==e.buttons&&("touch"===e.pointerType&&0===e.pressure&&(i.pressure=1,n=1),"mouse"===e.pointerType&&.5===e.pressure&&(i.pressure=1,n=1)):(i.pointerId=0,i.pointerType="mouse",i.pressure=0!==e.buttons?1:0,n=i.pressure),l.isFirefox&&"mouse"!=e.pointerType&&"pointermove"===e.type&&0===e.buttons&&(i.buttons=1);var r=[];"getCoalescedEvents"in e&&(r=e.getCoalescedEvents());for(var s=function(e){for(var t=u.length-1;t>=0;t--)if(e.pointerId===u[t].pointerId)return u[t];return null}(i)||(t={pointerId:i.pointerId,lastPageX:null,lastPageY:null},u.push(t),u.length>15&&u.shift(),t),a=s.lastPageX,o=s.lastPageY,h=0;h<r.length;h++){var c=r[h];i.coalescedArr.push({pageX:c.pageX,pageY:c.pageY,clientX:c.clientX,clientY:c.clientY,movementX:null===s.lastPageX?0:c.pageX-s.lastPageX,movementY:null===s.lastPageY?0:c.pageY-s.lastPageY,timeStamp:0===c.timeStamp?i.timeStamp:c.timeStamp+g,pressure:null===n?d.normalize(c.pressure):n}),s.lastPageX=c.pageX,s.lastPageY=c.pageY}return s.lastPageX=i.pageX,s.lastPageY=i.pageY,i.movementX=null===a?0:s.lastPageX-a,i.movementY=null===o?0:s.lastPageY-o,i}var w={passive:!1},k=/*#__PURE__*/function(){function e(t){var i,n=this;(0,r._)(this,e),this.isDestroyed=!1,this.isOverCounter=0,this.dragObjArr=[],this.dragPointerIdArr=[],this.lastPointerType=null,this.didSkip=!1,this.targetElement=t.target,this.onPointerCallback=t.onPointer,this.onWheelCallback=t.onWheel,this.onEnterLeaveCallback=t.onEnterLeave,this.maxPointers=Math.max(1,null!==(i=t.maxPointers)&&void 0!==i?i:1);var s=function(e){if(!n.isDestroyed&&n.onWheelCallback){var t=n.targetElement.getBoundingClientRect(),i=(0,a._)((0,o._)((0,a._)({},e instanceof WheelEvent?{deltaY:e.deltaY/120,pageX:e.pageX,pageY:e.pageY}:e),{relX:e.clientX-t.left+n.targetElement.scrollLeft,relY:e.clientY-t.top+n.targetElement.scrollTop}),e instanceof WheelEvent?{event:e}:{});n.onWheelCallback(i)}};if(this.wheelCleaner=t.useDirtyWheel?void 0:new h.WheelCleaner(s),this.onPointerCallback&&(this.onPointerMove=function(e){var t=B(e),i=n.lastPointerType;if(n.lastPointerType=t.pointerType,n.dragPointerIdArr.includes(t.pointerId)||n.dragPointerIdArr.length===n.maxPointers||"touch"===t.pointerType){n.didSkip=!1;return}if(!n.didSkip&&"mouse"===t.pointerType&&"pen"===i){n.didSkip=!0;return}n.didSkip=!1;var r=n.createPointerOutEvent("pointermove",t);n.onPointerCallback&&n.onPointerCallback(r)},this.onPointerDown=function(e,t){var i=B(e);if(!n.dragPointerIdArr.includes(i.pointerId)&&n.dragPointerIdArr.length!==n.maxPointers&&[1,2,4].includes(i.buttons)){0!==n.dragObjArr.length||t||n.setupDocumentListeners();var r={pointerId:i.pointerId,pointerType:i.pointerType,downPageX:i.pageX,downPageY:i.pageY,buttons:i.buttons,lastPageX:i.pageX,lastPageY:i.pageY,lastTimeStamp:i.timeStamp};n.dragObjArr.push(r),n.dragPointerIdArr.push(i.pointerId);var s=n.createPointerOutEvent("pointerdown",i,{downPageX:i.pageX,downPageY:i.pageY,button:p(i.buttons),pressure:i.pressure});n.onPointerCallback&&n.onPointerCallback(s)}},this.windowOnPointerMove=function(e){var t=B(e);if(n.dragPointerIdArr.includes(t.pointerId)){var i=n.getDragObj(t.pointerId);if(i){if(t.buttons!==i.buttons){1===n.dragObjArr.length&&n.destroyDocumentListeners(),n.removeDragObj(t.pointerId);var r=n.createPointerOutEvent("pointerup",t,{downPageX:i.downPageX,downPageY:i.downPageY});n.onPointerCallback&&n.onPointerCallback(r);return}if("pen"!==t.pointerType||t.pageX!==i.lastPageX||t.pageY!==i.lastPageY||t.timeStamp!==i.lastTimeStamp){var s=n.createPointerOutEvent("pointermove",t,{downPageX:i.downPageX,downPageY:i.downPageY,button:p(t.buttons),pressure:t.pressure});i.lastPageX=t.pageX,i.lastPageY=t.pageY,i.lastTimeStamp=t.timeStamp,n.onPointerCallback&&n.onPointerCallback(s)}}}},this.windowOnPointerUp=function(e){var t=B(e);if(n.dragPointerIdArr.includes(t.pointerId)){1===n.dragObjArr.length&&n.destroyDocumentListeners();var i=n.removeDragObj(t.pointerId);if(i){var r=n.createPointerOutEvent("pointerup",t,{downPageX:i.downPageX,downPageY:i.downPageY});n.onPointerCallback&&n.onPointerCallback(r)}}},this.windowOnPointerLeave=function(e){var t=B(e);if(n.dragPointerIdArr.includes(t.pointerId)){1===n.dragObjArr.length&&n.destroyDocumentListeners();var i=n.removeDragObj(t.pointerId);if(i){var r=n.createPointerOutEvent("pointerup",t,{downPageX:i.downPageX,downPageY:i.downPageY});n.onPointerCallback&&n.onPointerCallback(r)}}},this.targetElement.addEventListener(v,this.onPointerMove,w),this.targetElement.addEventListener(f,this.onPointerDown,w),!l.hasPointerEvents)){var c=function(e,t,i){return{pointerId:e.identifier,pointerType:"touch",pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY,button:i?0:void 0,buttons:i?1:0,timeStamp:t.timeStamp,target:t.target,pressure:i?1:0,preventDefault:function(){return t.preventDefault()},stopPropagation:function(){return t.stopPropagation()}}},u=function(e,t){for(var i=0;i<e.changedTouches.length;i++){var r=c(e.changedTouches[i],e,["start","move"].includes(t));"start"===t?n.onPointerDown(r,!1):"move"===t?n.windowOnPointerMove(r):"end"===t?n.windowOnPointerUp(r):n.windowOnPointerLeave(r)}};this.onTouchStart=function(e){e.preventDefault(),u(e,"start")},this.onTouchMove=function(e){u(e,"move")},this.onTouchEnd=function(e){u(e,"end")},this.onTouchCancel=function(e){u(e,"cancel")},this.targetElement.addEventListener("touchstart",this.onTouchStart,w),this.targetElement.addEventListener("touchmove",this.onTouchMove,w),this.targetElement.addEventListener("touchend",this.onTouchEnd,w),this.targetElement.addEventListener("touchcancel",this.onTouchCancel,w)}this.onWheelCallback&&(this.onWheel=function(e){n.wheelCleaner?n.wheelCleaner.process(e):s(e)},this.targetElement.addEventListener("wheel",this.onWheel,{passive:!!t.isWheelPassive})),this.onEnterLeaveCallback&&(this.onPointerEnter=function(){n.isOverCounter++,n.onEnterLeaveCallback&&n.onEnterLeaveCallback(!0)},this.onPointerLeave=function(){n.isOverCounter--,n.onEnterLeaveCallback&&n.onEnterLeaveCallback(!1)},this.targetElement.addEventListener(b,this.onPointerEnter,w),this.targetElement.addEventListener(x,this.onPointerLeave,w)),t.fixScribble&&(this.onTouchMoveScribbleFix=function(e){return e.preventDefault()},this.targetElement.addEventListener("touchmove",this.onTouchMoveScribbleFix,w))}return(0,s._)(e,[{key:"getDragObj",value:function(e){for(var t=0;t<this.dragObjArr.length;t++)if(e===this.dragObjArr[t].pointerId)return this.dragObjArr[t];return null}},{key:"removeDragObj",value:function(e){for(var t=null,i=0;i<this.dragPointerIdArr.length;i++)this.dragPointerIdArr[i]===e&&(t=this.dragObjArr[i],this.dragObjArr.splice(i,1),this.dragPointerIdArr.splice(i,1),i--);return t}},{key:"createPointerOutEvent",value:function(e,t,i){var n,r=this.targetElement.getBoundingClientRect(),s=(0,a._)({type:e,pointerId:t.pointerId,pointerType:t.pointerType,pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY,relX:t.clientX-r.left+this.targetElement.scrollLeft,relY:t.clientY-r.top+this.targetElement.scrollTop,dX:t.movementX,dY:t.movementY,time:t.timeStamp,eventPreventDefault:t.eventPreventDefault,eventStopPropagation:t.eventStopPropagation},i);if("pointermove"===e&&(s.coalescedArr=[],t.coalescedArr.length>1))for(var o=0;o<t.coalescedArr.length;o++)n=t.coalescedArr[o],s.coalescedArr.push({pageX:n.pageX,pageY:n.pageY,clientX:n.clientX,clientY:n.clientY,relX:n.clientX-r.left+this.targetElement.scrollLeft,relY:n.clientY-r.top+this.targetElement.scrollTop,dX:n.movementX,dY:n.movementY,time:n.timeStamp});return s}},{key:"setupDocumentListeners",value:function(){this.windowOnPointerMove&&document.addEventListener(v,this.windowOnPointerMove,w),this.windowOnPointerUp&&document.addEventListener(m,this.windowOnPointerUp,w),this.windowOnPointerLeave&&document.addEventListener(y,this.windowOnPointerLeave,w),this.windowOnPointerLeave&&document.addEventListener(x,this.windowOnPointerLeave,w)}},{key:"destroyDocumentListeners",value:function(){this.windowOnPointerMove&&document.removeEventListener(v,this.windowOnPointerMove),this.windowOnPointerUp&&document.removeEventListener(m,this.windowOnPointerUp),this.windowOnPointerLeave&&document.removeEventListener(y,this.windowOnPointerLeave),this.windowOnPointerLeave&&document.removeEventListener(x,this.windowOnPointerLeave)}},{key:"destroy",value:function(){!this.isDestroyed&&(this.isDestroyed=!0,this.onPointerEnter&&this.targetElement.removeEventListener(b,this.onPointerEnter),this.onPointerLeave&&this.targetElement.removeEventListener(x,this.onPointerLeave),this.onPointerMove&&this.targetElement.removeEventListener(v,this.onPointerMove),this.onPointerDown&&this.targetElement.removeEventListener(f,this.onPointerDown),this.onWheel&&this.targetElement.removeEventListener("wheel",this.onWheel),this.destroyDocumentListeners(),this.onTouchMoveScribbleFix&&document.removeEventListener("touchmove",this.onTouchMoveScribbleFix),this.onTouchStart&&this.targetElement.removeEventListener("touchstart",this.onTouchStart),this.onTouchMove&&this.targetElement.removeEventListener("touchmove",this.onTouchMove),this.onTouchEnd&&this.targetElement.removeEventListener("touchend",this.onTouchEnd),this.onTouchCancel&&this.targetElement.removeEventListener("touchcancel",this.onTouchCancel))}}]),e}()}),n("93oLo",function(t,n){e(t.exports,"WheelCleaner",function(){return a});var r=i("cx0mh"),s=i("7h4XF"),a=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.callback=t,this.knownUnitArr=[100],this.sequenceLength=0,this.sequenceUnit=null,this.toEmitDelta=null,this.position=null}return(0,s._)(e,[{key:"emit",value:function(e){null!==this.position&&null!==this.sequenceUnit&&this.callback({deltaY:Math.round(e/this.sequenceUnit),pageX:this.position.pageX,pageY:this.position.pageY,clientX:this.position.clientX,clientY:this.position.clientY})}},{key:"endSequence",value:function(){null!==this.toEmitDelta&&(this.emit(this.toEmitDelta),this.toEmitDelta=null),null===this.sequenceUnit||this.knownUnitArr.includes(this.sequenceUnit)||this.knownUnitArr.push(this.sequenceUnit),this.sequenceLength=0,this.sequenceUnit=null}},{key:"process",value:function(e){var t=this;this.position={pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY},this.endSequenceTimeout&&clearTimeout(this.endSequenceTimeout),this.endSequenceTimeout=setTimeout(function(){return t.endSequence()},200);var i=e.deltaY;"deltaMode"in e&&1===e.deltaMode&&(i*=100/3);var n=Math.abs(i);if(0===this.sequenceLength){if(this.sequenceLength++,n<50)return;this.sequenceUnit=n,this.knownUnitArr.includes(this.sequenceUnit)?this.emit(i):this.toEmitDelta=i;return}if(null===this.sequenceUnit){this.toEmitDelta=null;return}if(0!==n){if(n===this.sequenceUnit||n/this.sequenceUnit%1<1e-4);else if(this.sequenceUnit/n%1<1e-4)this.sequenceUnit=n;else if(n!==this.sequenceUnit){this.sequenceUnit=null,this.toEmitDelta=null;return}null!==this.toEmitDelta&&(this.emit(this.toEmitDelta),this.toEmitDelta=null),this.emit(i)}}}]),e}()}),n("eIAon",function(t,n){e(t.exports,"PressureNormalizer",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eg83P"),o=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.count=0,this.avgPressure=0,this.normalizeIsComplete=!1,this.normalizeFactor=1}return(0,s._)(e,[{key:"normalize",value:function(e){return 0===e||1===e?e:(this.count<60?(0===this.count||null===this.count?this.avgPressure=e:this.avgPressure=(0,a.mix)(e,this.avgPressure,.95),this.count++):!this.normalizeIsComplete&&(this.normalizeIsComplete=!0,this.avgPressure<.13&&(this.normalizeFactor=2.3)),Math.pow(e,1/this.normalizeFactor))}}]),e}()}),n("eg83P",function(t,i){function n(e,t,i){return e*(1-i)+t*i}function r(e,t,i,n){return Math.sqrt(Math.pow(e-i,2)+Math.pow(t-n,2))}function s(e,t,i,n){return Math.pow(e-i,2)+Math.pow(t-n,2)}function a(e,t){return e*e+t*t}function o(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function l(e,t){return 180*o(e,t)/Math.PI}function h(e,t){return t.x<=e.x&&e.x<=t.x+t.width&&t.y<=e.y&&e.y<=t.y+t.height}function c(e,t,i){return e<t?t:e>i?i:e}function u(e,t,i){var n=Math.PI/180*i,r=Math.cos(n),s=Math.sin(n);return{x:e*r-t*s,y:e*s+t*r}}function p(e,t,i){var n=u(t.x-e.x,t.y-e.y,i);return n.x+=e.x,n.y+=e.y,n}function d(e,t,i){var n=Math.abs(e%t);return Math.min(n,t-n)<=i&&(e=Math.round(e/t)*t),e}function g(e){return(e%=360)>180?e-=360:e<-180&&(e+=360),e}function f(e,t,i){e.x+=t,e.y+=i;var n=Math.round(e.x),r=Math.round(e.y);return e.x-=n,e.y-=r,{dX:n,dY:r}}function v(e){if(e%1==0)return e%2==0?e:e+1;var t=Math.ceil(e),i=Math.floor(e);return t%2==0?t:i}function m(e){if(e%1==0)return e%2==0?e+1:e;var t=Math.ceil(e),i=Math.floor(e);return t%2==1?t:i}function y(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i}function x(e,t){if(!t&&!e)throw Error("at least one param needs to be defined");return t&&(e?(e.x1=Math.min(e.x1,t.x1),e.y1=Math.min(e.y1,t.y1),e.x2=Math.max(e.x2,t.x2),e.y2=Math.max(e.y2,t.y2)):e={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),e}function b(e,t,i){if(e){var n=Math.max(0,e.x1),r=Math.max(0,e.y1),s=Math.min(t-1,e.x2),a=Math.min(i-1,e.y2);if(!(n>s)&&!(r>a))return{x1:n,y1:r,x2:s,y2:a}}}function B(e,t,i){var n=Math.max(0,Math.floor(e.x1)),r=Math.max(0,Math.floor(e.y1)),s=Math.min(t-1,Math.ceil(e.x2)),a=Math.min(i-1,Math.ceil(e.y2));if(!(n>s)&&!(r>a))return{x1:n,y1:r,x2:s,y2:a}}function w(e){return{x1:Math.floor(e.x1),y1:Math.floor(e.y1),x2:Math.ceil(e.x2),y2:Math.ceil(e.y2)}}e(t.exports,"mix",function(){return n}),e(t.exports,"dist",function(){return r}),e(t.exports,"distSquared",function(){return s}),e(t.exports,"lenSquared",function(){return a}),e(t.exports,"pointsToAngleRad",function(){return o}),e(t.exports,"pointsToAngleDeg",function(){return l}),e(t.exports,"isInsideRect",function(){return h}),e(t.exports,"clamp",function(){return c}),e(t.exports,"rotate",function(){return u}),e(t.exports,"rotateAround",function(){return p}),e(t.exports,"snapAngleDeg",function(){return d}),e(t.exports,"minimizeAngleDeg",function(){return g}),e(t.exports,"intDxy",function(){return f}),e(t.exports,"roundEven",function(){return v}),e(t.exports,"roundUneven",function(){return m}),e(t.exports,"round",function(){return y}),e(t.exports,"updateBounds",function(){return x}),e(t.exports,"boundsInArea",function(){return b}),e(t.exports,"intBoundsWithinArea",function(){return B}),e(t.exports,"integerBounds",function(){return w})}),n("eIcQa",function(t,n){e(t.exports,"copyCanvas",function(){return o}),e(t.exports,"ctx",function(){return l}),e(t.exports,"testShouldPixelate",function(){return h}),e(t.exports,"drawTransformedImageWithBounds",function(){return c}),e(t.exports,"drawTransformedImageOnCanvas",function(){return u}),e(t.exports,"createCheckerCanvas",function(){return p}),e(t.exports,"createCheckerDataUrl",function(){return d}),e(t.exports,"resizeCanvas",function(){return function e(t,i,n,r,a){if(i&&n&&(i!==t.width||n!==t.height)){if(i=Math.max(i,1),n=Math.max(n,1),i<=t.width&&n<=t.height){r=r||(0,s.createCanvas)(),a=a||(0,s.createCanvas)();var o,l,h,c=((o={oldWidthEx:Math.round(Math.log2(t.width)),oldHeightEx:Math.round(Math.log2(t.height)),newWidthEx:Math.ceil(Math.log2(i)),newHeightEx:Math.ceil(Math.log2(n))}).oldWidthEx=Math.max(o.oldWidthEx,o.newWidthEx),o.oldHeightEx=Math.max(o.oldHeightEx,o.newHeightEx),o);a.width=c.oldWidthEx>c.newWidthEx?Math.pow(2,c.oldWidthEx):i,a.height=c.oldHeightEx>c.newHeightEx?Math.pow(2,c.oldHeightEx):n,r.getContext("2d").save(),a.getContext("2d").save();var u=r,p=a;l=c.oldWidthEx,h=c.oldHeightEx;var d=p.getContext("2d");d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.globalCompositeOperation="copy",d.drawImage(t,0,0,p.width,p.height);for(var g=p.width,f=p.height;l>c.newWidthEx||h>c.newHeightEx;l--,h--){(d=u.getContext("2d")).imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.globalCompositeOperation="copy";var v=l>c.newWidthEx?g/2:g,m=h>c.newHeightEx?f/2:f;u.width=v,u.height=m,d.drawImage(p,0,0,g,f,0,0,v,m),g=v,f=m;var y=u;u=p,p=y}t.width=i,t.height=n;var x=t.getContext("2d");x.save(),x.imageSmoothingEnabled=!0,x.imageSmoothingQuality="high",x.drawImage(p,0,0,g,f,0,0,i,n),x.restore(),r.getContext("2d").restore(),a.getContext("2d").restore()}else if(i>=t.width&&n>=t.height){(r=r||(0,s.createCanvas)()).width=i,r.height=n;var b=r.getContext("2d");b.save(),b.imageSmoothingEnabled=!0,b.imageSmoothingQuality="high",b.drawImage(t,0,0,i,n),b.restore(),t.width=i,t.height=n,t.getContext("2d").drawImage(r,0,0)}else e(t,i,t.height,r,a),e(t,i,n,r,a)}}}),e(t.exports,"convertToAlphaChannelCanvas",function(){return g}),e(t.exports,"freeCanvas",function(){return f}),e(t.exports,"canvasBounds",function(){return v});var r,s=i("eelgW"),a=i("7jh4K");function o(e){var t=(0,s.createCanvas)(e.width,e.height),i=t.getContext("2d");if(!i)throw Error("2d context not supported or canvas already initialized");return i.drawImage(e,0,0),t}function l(e,t){var i=e.getContext("2d",t);if(!i)throw Error("couldn't get 2d context");return i}function h(e,t,i){if(![1,-1].includes(t)||![1,-1].includes(i)||e.width%1!=0||e.height%1!=0||Math.abs(e.angleDeg)%90!=0)return!1;var n=Math.abs(e.angleDeg-90)%180==0,r=n?e.height:e.width,s=n?e.width:e.height;return(Math.abs(r)%2==0&&e.x%1==0||Math.abs(r)%2==1&&e.x%1==.5)&&(Math.abs(s)%2==0&&e.y%1==0||Math.abs(s)%2==1&&e.y%1==.5)}function c(e,t,i,n,r){n||(n={x:0,y:0,width:t.width,height:t.height}),e.save(),r?e.imageSmoothingEnabled=!1:(e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high"),e.translate(i.x,i.y),e.rotate(i.angleDeg/180*Math.PI),e.scale(i.width>0?1:-1,i.height>0?1:-1),e.drawImage(t,n.x,n.y,n.width,n.height,-Math.abs(i.width)/2,-Math.abs(i.height)/2,Math.abs(i.width),Math.abs(i.height)),e.restore()}function u(e,t,i){(i=(0,a.copyObj)(i)).center||(i.center={x:t.width/2,y:t.height/2}),i.scale||(i.scale={x:1,y:1}),i.angleDegree||(i.angleDegree=0),i.translate||(i.translate={x:0,y:0});var n=e.getContext("2d");if(!n)throw Error("2d context not supported or canvas already initialized");n.save(),Math.abs(i.scale.x-1)>1e-6||Math.abs(i.scale.y-1)>1e-6||Math.abs(i.angleDegree%90)>1e-6?(n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high"):n.imageSmoothingEnabled=!1,n.translate(i.translate.x,i.translate.y),n.translate(i.center.x,i.center.y),n.rotate(i.angleDegree/180*Math.PI),n.scale(i.scale.x,i.scale.y),n.translate(-i.center.x,-i.center.y),n.drawImage(t,0,0,t.width,t.height),n.restore()}var p=function(e,t){var i,n=(0,s.createCanvas)();if(e<1){if(n.width=1,n.height=1,!(i=n.getContext("2d")))throw Error("2d context not supported or canvas already initialized");i.fillStyle="rgb(128, 128, 128)",i.fillRect(0,0,1,1)}else if(e>200)n.width=401,n.height=401;else{if(n.width=2*e,n.height=2*e,!(i=n.getContext("2d")))throw Error("2d context not supported or canvas already initialized");i.fillStyle=t?"rgb(90, 90, 90)":"rgb(255, 255, 255)",i.fillRect(0,0,2*e,2*e),i.fillStyle=t?"rgb(63, 63, 63)":"rgb(200, 200, 200)",i.fillRect(0,0,e,e),i.fillRect(e,e,2*e,2*e)}return n},d=(r={"8l":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC","4l":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC"},function(e,t,i){var n=i?"d":"l";function s(e){if(r[""+(e=parseInt(""+e))+n])return r[""+e+n];var t=p(e,i).toDataURL("image/png");return r[""+e+n]=t,t}if(!t)return s(e);setTimeout(function(){t(s(e))},1)});function g(e){for(var t=e.getContext("2d").getImageData(0,0,e.width,e.height),i=0;i<t.data.length;i+=4)0!==t.data[i+3]&&(t.data[i+3]=(t.data[i]+t.data[i+1]+t.data[i+2])/3*(t.data[i+3]/255));e.getContext("2d").putImageData(t,0,0)}function f(e){e.width=1,e.height=1,e.remove()}function v(e,t){var i=null!=t?t:{x1:0,y1:0,x2:e.canvas.width-1,y2:e.canvas.height-1},n=i.x2-i.x1+1,r=i.y2-i.y1+1,s=e.getImageData(i.x1,i.y1,n,r);if(s.data[3]>0&&s.data[s.data.length-1]>0)return{x:i.x1,y:i.y1,width:i.x2-i.x1+1,height:i.y2-i.y1+1};for(var a={x1:void 0,y1:void 0,x2:void 0,y2:void 0},o=3;o<s.data.length;o+=4)if(s.data[o]>0){var l=(o-3)/4%n,h=Math.floor((o-3)/4/n);(void 0===a.x1||a.x1>l)&&(a.x1=l),void 0===a.y1&&(a.y1=h),(void 0===a.x2||a.x2<l)&&(a.x2=l),(void 0===a.y2||a.y2<h)&&(a.y2=h)}if(void 0!==a.x1&&void 0!==a.y1&&void 0!==a.x2&&void 0!==a.y2)return{x:a.x1+i.x1,y:a.y1+i.y1,width:a.x2-a.x1+1,height:a.y2-a.y1+1}}}),n("eelgW",function(t,i){e(t.exports,"createCanvas",function(){return n});function n(e,t){var i=document.createElement("canvas");return e&&t&&(i.width=e,i.height=t),i}}),n("kVHNC",function(t,i){function n(e,t){return[t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15]]}e(t.exports,"Matrix",function(){return r});var r=Object.freeze({getIdentity:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},multiplyMatrixAndPoint:n,multiplyMatrices:function(e,t){var i=[t[0],t[1],t[2],t[3]],r=[t[4],t[5],t[6],t[7]],s=[t[8],t[9],t[10],t[11]],a=[t[12],t[13],t[14],t[15]],o=n(e,i),l=n(e,r),h=n(e,s),c=n(e,a);return[o[0],o[1],o[2],o[3],l[0],l[1],l[2],l[3],h[0],h[1],h[2],h[3],c[0],c[1],c[2],c[3]]},createTranslationMatrix:function(e,t){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]},createRotationMatrix:function(e){return[Math.cos(-e),-Math.sin(-e),0,0,Math.sin(-e),Math.cos(-e),0,0,0,0,1,0,0,0,0,1]},createScaleMatrix:function(e){return[e,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]}})}),n("4toIY",function(t,i){e(t.exports,"Vec2",function(){return n});var n={add:function(e,t){return{x:e.x+t.x,y:e.y+t.y}},sub:function(e,t){return{x:e.x-t.x,y:e.y-t.y}},nor:function(e){var t=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2));return{x:e.x/t,y:e.y/t}},len:function(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))},dist:function(e,t){return n.len(n.sub(e,t))},mul:function(e,t){return{x:e.x*t,y:e.y*t}},angle:function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},dot:function(e,t){var i=[e.x,e.y],n=[t.x,t.y];return i.map(function(e,t){return i[t]*n[t]}).reduce(function(e,t){return e+t})}}}),n("af1iA",function(t,n){e(t.exports,"projectPointOnLine",function(){return h}),e(t.exports,"PointLine",function(){return c}),e(t.exports,"BezierLine",function(){return u}),e(t.exports,"SplineInterpolator",function(){return p}),e(t.exports,"quadraticSplineInput",function(){return d});var r=i("cx0mh"),s=i("7h4XF"),a=i("4toIY"),o=i("eg83P"),l=i("7jh4K"),h=function(e,t,i){if(e.x===t.x)return{x:e.x,y:i.y};var n,r=(t.y-e.y)/(t.x-e.x),s=e.y-r*e.x;return{x:(r*i.y+i.x-r*s)/(r*r+1),y:(r*r*i.y+r*i.x+s)/(r*r+1)}},c=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.segmentArr=[];for(var n=0;n<t.points.length;n++)!function(e){var n=0;e<t.points.length-1&&(n=(0,o.dist)(t.points[e].x,t.points[e].y,t.points[e+1].x,t.points[e+1].y)),i.segmentArr[e]={x:t.points[e].x,y:t.points[e].y,length:n}}(n)}return(0,s._)(e,[{key:"getAtDist",value:function(e){for(var t=Math.min(this.getLength(),e),i=0;t>this.segmentArr[i].length&&i<this.segmentArr.length-2;i++)t-=this.segmentArr[i].length;var n=Math.min(1,Math.max(0,t/this.segmentArr[i].length));return{x:this.segmentArr[i].x*(1-n)+this.segmentArr[i+1].x*n,y:this.segmentArr[i].y*(1-n)+this.segmentArr[i+1].y*n}}},{key:"getLength",value:function(){for(var e=0,t=0;t<this.segmentArr.length-1;t++)e+=this.segmentArr[t].length;return e}}]),e}(),u=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.lastDot=0,this.pointArr=[]}return(0,s._)(e,[{key:"getBezierPoints",value:function(e,t,i,n,r){for(var s,a=[],o=0;o<=r;o++)s=o/r,a[a.length]={x:Math.pow(1-s,3)*e.x+3*Math.pow(1-s,2)*s*t.x+3*(1-s)*Math.pow(s,2)*i.x+Math.pow(s,3)*n.x,y:Math.pow(1-s,3)*e.y+3*Math.pow(1-s,2)*s*t.y+3*(1-s)*Math.pow(s,2)*i.y+Math.pow(s,3)*n.y};return a}},{key:"add",value:function(e,t,i,n,r){if(!this.lastPoint||e!==this.lastPoint.x||t!==this.lastPoint.y){if(this.lastPoint={x:e,y:t},this.pointArr[this.pointArr.length]={x:e,y:t,spacing:i},1===this.pointArr.length){this.lastSpacing=i;return}if(2===this.pointArr.length){this.pointArr[0].dir=(0,a.Vec2).nor((0,a.Vec2).sub(this.pointArr[1],this.pointArr[0])),this.lastDot=i,this.lastSpacing=i;return}var s,h=this.pointArr[this.pointArr.length-1],u=this.pointArr[this.pointArr.length-2],p=this.pointArr[this.pointArr.length-3];u.dir=(0,a.Vec2).nor((0,a.Vec2).sub(h,p)),(isNaN(u.dir.x)||isNaN(u.dir.y))&&(u.dir=(0,l.copyObj)(p.dir));for(var d=this.pointArr[this.pointArr.length-3],g=this.pointArr[this.pointArr.length-2],f=(0,a.Vec2).add(d,(0,a.Vec2).mul(d.dir,(0,a.Vec2).dist(d,g)/4)),v=(0,a.Vec2).sub(g,(0,a.Vec2).mul(g.dir,(0,a.Vec2).dist(d,g)/4)),m=(s=new c(n?{points:this.getBezierPoints(d,f,v,g,20)}:{points:[d,g]})).getLength(),y=(0,o.mix)(this.lastSpacing,i,(0,o.clamp)(this.lastDot/m,0,1)),x=this.lastDot;x<=m;x+=y){y=(0,o.mix)(this.lastSpacing,i,(0,o.clamp)(x/m,0,1));var b=s.getAtDist(x),B=this.lastCallbackPoint?(0,o.pointsToAngleDeg)(this.lastCallbackPoint,b):void 0;n&&n({x:b.x,y:b.y,t:x/m,angle:B,dAngle:this.lastCallbackPoint?B-this.lastAngle:0}),this.lastCallbackPoint=b,this.lastAngle=B}n?this.lastDot=x-m:(this.lastDot=0,r&&r({p1:d,p2:f,p3:v,p4:g})),this.lastSpacing=i}}},{key:"addFinal",value:function(e,t,i){if(!(this.pointArr.length<2)){var n=this.pointArr[this.pointArr.length-2],r=this.pointArr[this.pointArr.length-1],s=(0,a.Vec2).add(r,(0,a.Vec2).sub(r,n));this.add(s.x,s.y,e,t,i)}}}]),e}(),p=/*#__PURE__*/function(){function e(t){(0,r._)(this,e);var i,n=t.length;for(this.xa=[],this.ya=[],this.u=[],this.y2=[],this.first=t[0][0],this.last=t[t.length-1][0],t.sort(function(e,t){return e[0]-t[0]}),i=0;i<n;i++)this.xa.push(t[i][0]),this.ya.push(t[i][1]);for(i=1,this.u[0]=0,this.y2[0]=0;i<n-1;++i){var s=this.xa[i+1]-this.xa[i-1],a=(this.xa[i]-this.xa[i-1])/s,o=a*this.y2[i-1]+2;this.y2[i]=(a-1)/o;var l=(this.ya[i+1]-this.ya[i])/(this.xa[i+1]-this.xa[i])-(this.ya[i]-this.ya[i-1])/(this.xa[i]-this.xa[i-1]);this.u[i]=(6*l/s-a*this.u[i-1])/o}for(this.y2[n-1]=0,i=n-2;i>=0;--i)this.y2[i]=this.y2[i]*this.y2[i+1]+this.u[i]}return(0,s._)(e,[{key:"getFirstX",value:function(){return this.first}},{key:"getLastX",value:function(){return this.last}},{key:"interpolate",value:function(e){for(var t=this.ya.length,i=0,n=t-1;n-i>1;){var r=n+i>>1;this.xa[r]>e?n=r:i=r}var s=this.xa[n]-this.xa[i],a=(this.xa[n]-e)/s,o=(e-this.xa[i])/s;return a*this.ya[i]+o*this.ya[n]+((a*a*a-a)*this.y2[i]+(o*o*o-o)*this.y2[n])*(s*s)/6}},{key:"findX",value:function(e,t){for(var i,n,r=0;r<=t;r++){var s=r/t,a=this.interpolate(s);if(void 0===i){i=s,n=Math.abs(a-e);continue}var o=Math.abs(a-e);if(o<n)i=s,n=o;else break}return i}}]),e}();function d(e,t,i){function n(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}for(var r=[],s=0;s<=1;s+=i)r.push([n(s,4),n(e+Math.pow(s,2)*(t-e),4)]);return r}}),n("dJ1E2",function(t,n){e(t.exports,"HSV",function(){return s}),e(t.exports,"RGB",function(){return a}),e(t.exports,"CMYK",function(){return o}),e(t.exports,"ColorConverter",function(){return l}),e(t.exports,"testIsWhiteBestContrast",function(){return h});var r=i("cx0mh"),s=function e(t,i,n){(0,r._)(this,e),this.h=Math.max(0,Math.min(360,t)),this.s=Math.max(.001,Math.min(100,i)),this.v=Math.max(0,Math.min(100,n))},a=function e(t,i,n){(0,r._)(this,e),this.r=Math.max(0,Math.min(255,t)),this.g=Math.max(0,Math.min(255,i)),this.b=Math.max(0,Math.min(255,n))},o=function e(t,i,n,s){(0,r._)(this,e),this.c=Math.max(0,Math.min(100,t)),this.m=Math.max(0,Math.min(100,i)),this.y=Math.max(0,Math.min(100,n)),this.k=Math.max(0,Math.min(100,s))},l={_RGBtoHSV:function(e){var t=new s(0,0,0),i=e.r/255,n=e.g/255,r=e.b/255,a=Math.min(i,n,r),o=Math.max(i,n,r),l=o-a;if(t.v=o,0==l)t.h=0,t.s=0;else{t.s=l/o;var h=((o-i)/6+l/2)/l,c=((o-n)/6+l/2)/l,u=((o-r)/6+l/2)/l;i==o?t.h=u-c:n==o?t.h=1/3+h-u:r==o&&(t.h=2/3+c-h),t.h<0&&(t.h+=1),t.h>1&&(t.h-=1)}return t.h=Math.round(360*t.h),t.s=Math.round(100*t.s),t.v=Math.round(100*t.v),t},_HSVtoRGB:function(e){var t,i,n,r,s,o,l,h,c=new a(0,0,0),u=e.h/360%1,p=e.s/100,d=e.v/100;return 0==p?(c.r=255*d,c.g=255*d,c.b=255*d):(i=Math.floor(t=6*u),n=d*(1-p),r=d*(1-p*(t-i)),s=d*(1-p*(1-(t-i))),0==i?(o=d,l=s,h=n):1==i?(o=r,l=d,h=n):2==i?(o=n,l=d,h=s):3==i?(o=n,l=r,h=d):4==i?(o=s,l=n,h=d):(o=d,l=n,h=r),c.r=255*o,c.g=255*l,c.b=255*h,c.r=Math.round(c.r),c.g=Math.round(c.g),c.b=Math.round(c.b)),c},_CMYKtoRGB:function(e){var t=new a(0,0,0),i=e.c/100,n=e.m/100,r=e.y/100,s=e.k/100;return t.r=1-Math.min(1,i*(1-s)+s),t.g=1-Math.min(1,n*(1-s)+s),t.b=1-Math.min(1,r*(1-s)+s),t.r=Math.round(255*t.r),t.g=Math.round(255*t.g),t.b=Math.round(255*t.b),t},_RGBtoCMYK:function(e){var t=new o(0,0,0,0),i=e.r/255,n=e.g/255,r=e.b/255;return t.k=Math.min(1-i,1-n,1-r),t.c=(1-i-t.k)/(1-t.k),t.m=(1-n-t.k)/(1-t.k),t.y=(1-r-t.k)/(1-t.k),t.c=Math.round(100*t.c),t.m=Math.round(100*t.m),t.y=Math.round(100*t.y),t.k=Math.round(100*t.k),t},toRGB:function(e){if(e instanceof a)return e;if(e instanceof s)return this._HSVtoRGB(e);if(e instanceof o)return this._CMYKtoRGB(e);throw Error("unknown type")},toHSV:function(e){if(e instanceof s)return e;if(e instanceof a)return this._RGBtoHSV(e);if(e instanceof o)return this._RGBtoHSV(this._CMYKtoRGB(e));throw Error("unknown type")},toCMYK:function(e){if(e instanceof o)return e;if(e instanceof a)return this._RGBtoCMYK(e);if(e instanceof s)return this._RGBtoCMYK(this._HSVtoRGB(e));throw Error("unknown type")},toHexString:function(e){if(e instanceof a||"r"in e&&"g"in e&&"b"in e){var t=parseInt(""+e.r).toString(16),i=parseInt(""+e.g).toString(16),n=parseInt(""+e.b).toString(16);return 1==t.length&&(t="0"+t),1==i.length&&(i="0"+i),1==n.length&&(n="0"+n),t+i+n}return"#000"},toRgbStr:function(e){return"rgb("+Math.round(e.r)+", "+Math.round(e.g)+", "+Math.round(e.b)+")"},toRgbaStr:function(e){return"rgba("+Math.round(e.r)+", "+Math.round(e.g)+", "+Math.round(e.b)+", "+e.a+")"},hexToRGB:function(e){e=(e=e.trim()).replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,i,n){return t+t+i+i+n+n});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?new a(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)):void 0}};function h(e){return .299*e.r+.587*e.g+.114*e.b<125}}),n("72Jv0",function(t,n){e(t.exports,"appendTextDiv",function(){return a}),e(t.exports,"isInputFocused",function(){return o}),e(t.exports,"unfocusAnyInput",function(){return l}),e(t.exports,"clearSelection",function(){return h}),e(t.exports,"makeUnfocusable",function(){return c}),e(t.exports,"el",function(){return p}),e(t.exports,"destroyEl",function(){return d});var r=i("7jh4K"),s=i("eWjiX");function a(e,t){var i=document.createElement("div");return i.innerHTML=t,e.append(i),i}function o(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=!!document.activeElement&&["INPUT","TEXTAREA","SELECT"].includes(document.activeElement.tagName);return t?i:i&&!(null===(e=document.activeElement)||void 0===e?void 0:e.getAttribute("data-ignore-focus"))}function l(){if(o(!0)){var e=(0,s.BB).el({parent:document.body,tagName:"input",css:{opacity:"0",width:"0",height:"0"}});setTimeout(function(){e.select(),e.focus(),e.remove()},10)}}function h(){if(window.getSelection){var e=window.getSelection();e&&(e.empty?e.empty():e.removeAllRanges&&e.removeAllRanges())}}var c=function(){function e(e){e.preventDefault();var t=!1;if(e.relatedTarget)try{e.relatedTarget.focus(),t=!0}catch(e){console.error("failed to focus")}t||e.currentTarget.blur()}return function(t){t.setAttribute("tabindex","-1"),t.addEventListener("focus",e)}}(),u=[];function p(e){if(!e)return document.createElement("div");var t=document.createElement(e.tagName?e.tagName:"div");e.css&&(0,r.css)(t,e.css),e.content&&("string"==typeof e.content?t.innerHTML=e.content:Array.isArray(e.content)?(0,s.BB).append(t,e.content):t.append(e.content)),e.textContent&&(t.textContent=e.textContent),e.className&&(t.className=e.className),e.id&&(t.id=e.id),e.parent&&e.parent.append(t),"title"in e&&void 0!==e.title&&(t.title=e.title);var i=[];if(void 0!==e.onClick&&(t.addEventListener("click",e.onClick),e.noRef||i.push(["click",e.onClick])),void 0!==e.onChange&&(t.addEventListener("change",e.onChange),e.noRef||i.push(["change",e.onChange])),i.length>0&&u.push({el:t,listeners:i}),"custom"in e&&e.custom)for(var n=Object.keys(e.custom),a=0;a<n.length;a++)t.setAttribute(n[a],e.custom[n[a]]);return t}function d(e){if(e)for(var t=0;t<u.length;t++){var i=u[t];if(i.el===e){i.listeners.forEach(function(t){e.removeEventListener(t[0],t[1])}),u.splice(t,1);break}}}}),n("i0uIf",function(t,n){e(t.exports,"BbLog",function(){return a});var r=i("cx0mh"),s=i("7h4XF"),a=/*#__PURE__*/function(){function e(){(0,r._)(this,e)}return(0,s._)(e,null,[{key:"subscribe",value:function(t){e.listeners.includes(t)||e.listeners.push(t)}},{key:"unsubscribe",value:function(t){for(var i=0;i<e.listeners.length;i++)if(t===e.listeners[i]){e.listeners.splice(i,1);return}}},{key:"emit",value:function(t){e.listeners.forEach(function(e){e(t)})}}]),e}();a.listeners=[]}),n("6l0gQ",function(t,n){e(t.exports,"LocalStorage",function(){return a});var r=i("cx0mh"),s=i("7h4XF"),a=/*#__PURE__*/function(){function e(){(0,r._)(this,e)}return(0,s._)(e,null,[{key:"getItem",value:function(e){var t=null;try{t=localStorage.getItem(e)}catch(e){this.error=e}return t}},{key:"setItem",value:function(e,t){try{localStorage.setItem(e,t)}catch(e){this.error=e}}},{key:"removeItem",value:function(e){try{localStorage.removeItem(e)}catch(e){this.error=e}}},{key:"getError",value:function(){return this.error}}]),e}()}),n("jjWRi",function(t,n){e(t.exports,"CoalescedExploder",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("7jh4K"),o=/*#__PURE__*/function(){function e(){(0,r._)(this,e)}return(0,s._)(e,[{key:"setChainOut",value:function(e){this.chainOut=e}},{key:"chainIn",value:function(e){if("pointermove"!==e.type||!e.coalescedArr||!(e.coalescedArr.length>0))return e;for(var t=0;t<e.coalescedArr.length;t++){var i=(0,a.copyObj)(e);0===t&&(i.coalescedArr=[]);var n=e.coalescedArr[t];i.pageX=n.pageX,i.pageY=n.pageY,i.relX=n.relX,i.relY=n.relY,i.dX=n.dX,i.dY=n.dY,i.time=n.time,i.isCoalesced=t<e.coalescedArr.length-1,this.chainOut&&this.chainOut(i)}return null}}]),e}()}),n("2pgVs",function(t,n){e(t.exports,"NFingerTapper",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eg83P"),o=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.minSilenceBeforeDurationMs=50,this.maxTapMs=500,this.maxFirstLastFingerDownMs=250,this.maxPressedDistancePx=12,this.fingerArr=[],this.eventQueueArr=[],this.firstDownTime=0,this.lastEventTime=0,this.nowTime=performance.now(),this.pointersDownIdArr=[],this.timeoutObj={firstLastDownTimeout:null,tapTimeout:null},this.fingers=t.fingers,this.onTap=t.onTap}return(0,s._)(e,[{key:"failGesture",value:function(){if(0!==this.eventQueueArr.length){this.timeoutObj.firstLastDownTimeout&&clearTimeout(this.timeoutObj.firstLastDownTimeout),this.timeoutObj.tapTimeout&&clearTimeout(this.timeoutObj.tapTimeout);for(var e=0;e<this.eventQueueArr.length;e++)this.chainOut&&this.chainOut(this.eventQueueArr[e]);this.eventQueueArr=[],this.fingerArr=[]}}},{key:"success",value:function(){this.timeoutObj.firstLastDownTimeout&&clearTimeout(this.timeoutObj.firstLastDownTimeout),this.timeoutObj.tapTimeout&&clearTimeout(this.timeoutObj.tapTimeout),this.eventQueueArr=[],this.fingerArr=[],this.onTap()}},{key:"setupTimeout",value:function(e,t){var i=this,n=t-this.nowTime;return!(n<=0)&&(this.timeoutObj[e]=setTimeout(function(){return i.failGesture()},n),!0)}},{key:"processEvent",value:function(e){var t=this.lastEventTime;if(this.lastEventTime=e.time,"pointerdown"===e.type)this.pointersDownIdArr.push(e.pointerId);else if("pointerup"===e.type){for(var i=0;i<this.pointersDownIdArr.length;i++)if(this.pointersDownIdArr[i]===e.pointerId){this.pointersDownIdArr.splice(i,1);break}}if("touch"!==e.pointerType){this.fingerArr.length>0&&this.failGesture();return}if(this.nowTime=performance.now(),"pointerdown"===e.type){if(this.fingerArr.length+1!==this.pointersDownIdArr.length||this.fingerArr.length===this.fingers||this.fingerArr.length>0&&e.time-this.maxFirstLastFingerDownMs>this.fingerArr[0].downTimeMs||0===this.fingerArr.length&&e.time-this.minSilenceBeforeDurationMs<t||0===this.fingerArr.length&&(this.firstDownTime=e.time,!this.setupTimeout("firstLastDownTimeout",e.time+this.maxFirstLastFingerDownMs)||!this.setupTimeout("tapTimeout",e.time+this.maxTapMs))){this.failGesture();return}this.fingerArr.push({pointerId:e.pointerId,downTimeMs:e.time,downPageX:e.pageX,downPageY:e.pageY});return}if("pointermove"===e.type){if(0===this.fingerArr.length)return;for(var n=null,r=0;r<this.fingerArr.length;r++)if(this.fingerArr[r].pointerId===e.pointerId){n=this.fingerArr[r];break}if(null===n||e.time-this.maxTapMs>this.firstDownTime||(0,a.dist)(e.pageX,e.pageY,n.downPageX,n.downPageY)>this.maxPressedDistancePx){this.failGesture();return}}if("pointerup"===e.type){if(0===this.fingerArr.length)return;if(this.fingerArr.length!==this.fingers){this.failGesture();return}for(var s=null,o=0;o<this.fingerArr.length;o++)if(this.fingerArr[o].pointerId===e.pointerId){s=this.fingerArr[o];break}if(null===s)return;if(e.time-this.maxTapMs>this.firstDownTime||(0,a.dist)(e.pageX,e.pageY,s.downPageX,s.downPageY)>this.maxPressedDistancePx){this.failGesture();return}s.isUp=!0;for(var l=!0,h=0;h<this.fingerArr.length;h++)if(!this.fingerArr[h].isUp){l=!1;break}if(l)return this.success(),!0}}},{key:"chainIn",value:function(e){return!0===this.processEvent(e)?null:0===this.fingerArr.length?e:(this.eventQueueArr.push(e),null)}},{key:"setChainOut",value:function(e){this.chainOut=e}}]),e}()}),n("joplQ",function(t,n){e(t.exports,"PinchZoomer",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eg83P"),o=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.firstFingerMaxDistancePx=10,this.untilSecondFingerDurationMs=250,this.pointersDownIdArr=[],this.gestureObj=null,this.eventQueueArr=[],this.nowTime=performance.now(),this.timeoutObj={secondFingerTimeout:null},this.pincherArr=[],this.onPinch=t.onPinch}return(0,s._)(e,[{key:"end",value:function(){this.gestureObj=null,this.eventQueueArr=[]}},{key:"fail",value:function(e){if(this.gestureObj){if(this.timeoutObj.secondFingerTimeout&&clearTimeout(this.timeoutObj.secondFingerTimeout),!e)for(var t=0;t<this.eventQueueArr.length;t++)this.chainOut&&this.chainOut(this.eventQueueArr[t]);this.end()}}},{key:"setupFailTimeout",value:function(e){var t=this,i=e-this.nowTime;return!(i<=0)&&(this.timeoutObj.secondFingerTimeout=setTimeout(function(){return t.fail()},i),!0)}},{key:"processEvent",value:function(e){if("pointerdown"===e.type)this.pointersDownIdArr.push(e.pointerId);else if("pointerup"===e.type){for(var t=0;t<this.pointersDownIdArr.length;t++)if(this.pointersDownIdArr[t]===e.pointerId){this.pointersDownIdArr.splice(t,1);break}}if(this.gestureObj||"touch"===e.pointerType&&("pointermove"!==e.type||!(this.pointersDownIdArr.length>0))&&!(this.pointersDownIdArr.length>1)&&"pointerup"!==e.type){if(this.nowTime=performance.now(),"pointerdown"===e.type){if(this.gestureObj){if("touch"===e.pointerType){this.gestureObj.touchPointerArr.push({pointerId:e.pointerId,relX:e.relX,relY:e.relY}),this.gestureObj.isInProgress?this.continuePinch(this.gestureObj,{type:"down",index:this.gestureObj.touchPointerArr.length-1}):(this.timeoutObj.secondFingerTimeout&&clearTimeout(this.timeoutObj.secondFingerTimeout),this.gestureObj.isInProgress=!0,this.beginPinch(this.gestureObj));return}this.gestureObj.isInProgress?this.gestureObj.otherPointerIdArr.push(e.pointerId):this.fail();return}this.gestureObj={touchPointerArr:[{pointerId:e.pointerId,relX:e.relX,relY:e.relY,downRelX:e.relX,downRelY:e.relY}],otherPointerIdArr:[],isInProgress:!1},this.setupFailTimeout(e.time+this.untilSecondFingerDurationMs)||this.fail();return}if(!this.gestureObj){this.fail();return}if("pointermove"===e.type&&"touch"===e.pointerType){for(var i=null,n=0;n<this.gestureObj.touchPointerArr.length;n++)if(e.pointerId===this.gestureObj.touchPointerArr[n].pointerId){i=this.gestureObj.touchPointerArr[n];break}if(!i){this.fail();return}if(i.relX=e.relX,i.relY=e.relY,this.gestureObj.isInProgress)n<2&&this.continuePinch(this.gestureObj,{type:"move",index:n});else{if(!("downRelX"in i&&void 0!==i.downRelX)||!("downRelY"in i&&void 0!==i.downRelY)){this.fail();return}(0,a.dist)(i.downRelX,i.downRelY,i.relX,i.relY)>this.firstFingerMaxDistancePx&&this.fail()}return}if("pointerup"===e.type){if("touch"===e.pointerType){for(var r=0;r<this.gestureObj.touchPointerArr.length;r++)if(this.gestureObj.touchPointerArr[r].pointerId===e.pointerId){this.gestureObj.touchPointerArr.splice(r,1);break}this.gestureObj.touchPointerArr.length>0&&this.continuePinch(this.gestureObj,{type:"up",index:r})}else for(var s=0;s<this.gestureObj.otherPointerIdArr.length;s++)if(this.gestureObj.otherPointerIdArr[s]===e.pointerId){this.gestureObj.otherPointerIdArr.splice(s,1);break}if(0===this.gestureObj.touchPointerArr.length&&0===this.gestureObj.otherPointerIdArr.length){this.gestureObj.isInProgress?(this.end(),this.endPinch()):this.fail();return}}}}},{key:"beginPinch",value:function(e){for(var t=0;t<e.touchPointerArr.length;t++){var i=e.touchPointerArr[t];this.pincherArr.push({pointerId:i.pointerId,relX:i.relX,relY:i.relY,downRelX:i.relX,downRelY:i.relY})}var n={type:"move",downRelX:0,downRelY:0,relX:0,relY:0,angleRad:0,scale:1};1===this.pincherArr.length?(n.relX=this.pincherArr[0].downRelX,n.relY=this.pincherArr[0].downRelY):(n.relX=.5*(this.pincherArr[0].downRelX+this.pincherArr[1].downRelX),n.relY=.5*(this.pincherArr[0].downRelY+this.pincherArr[1].downRelY)),n.downRelX=n.relX,n.downRelY=n.relY,this.onPinch(n)}},{key:"continuePinch",value:function(e,t){if(!(t.index>1)){if("move"===t.type){var i;if(this.pincherArr[t.index].relX=e.touchPointerArr[t.index].relX,this.pincherArr[t.index].relY=e.touchPointerArr[t.index].relY,1===this.pincherArr.length)i={type:"move",downRelX:this.pincherArr[0].downRelX,downRelY:this.pincherArr[0].downRelY,relX:this.pincherArr[0].relX,relY:this.pincherArr[0].relY,angleRad:0,scale:1};else{var n=(0,a.dist)(this.pincherArr[0].downRelX,this.pincherArr[0].downRelY,this.pincherArr[1].downRelX,this.pincherArr[1].downRelY),r=(0,a.dist)(this.pincherArr[0].relX,this.pincherArr[0].relY,this.pincherArr[1].relX,this.pincherArr[1].relY),s=(0,a.pointsToAngleRad)({x:this.pincherArr[0].downRelX,y:this.pincherArr[0].downRelY},{x:this.pincherArr[1].downRelX,y:this.pincherArr[1].downRelY}),o=(0,a.pointsToAngleRad)({x:this.pincherArr[0].relX,y:this.pincherArr[0].relY},{x:this.pincherArr[1].relX,y:this.pincherArr[1].relY});i={type:"move",downRelX:.5*(this.pincherArr[0].downRelX+this.pincherArr[1].downRelX),downRelY:.5*(this.pincherArr[0].downRelY+this.pincherArr[1].downRelY),relX:.5*(this.pincherArr[0].relX+this.pincherArr[1].relX),relY:.5*(this.pincherArr[0].relY+this.pincherArr[1].relY),angleRad:o-s,scale:r/n}}this.onPinch(i)}else("down"===t.type||"up"===t.type)&&(this.endPinch(),this.beginPinch(e))}}},{key:"endPinch",value:function(){this.pincherArr=[],this.onPinch({type:"end"})}},{key:"chainIn",value:function(e){return(this.processEvent(e),this.gestureObj)?(this.gestureObj.isInProgress||this.eventQueueArr.push(e),null):e}},{key:"setChainOut",value:function(e){this.chainOut=e}}]),e}()}),n("c1lmK",function(t,n){e(t.exports,"DoubleTapper",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("bX4ja"),o=i("eg83P"),l=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.allowedPointerTypeArr=["touch","mouse","pen"],this.allowedButtonArr=["left"],this.minSilenceBeforeDurationMs=400,this.maxPressedDurationMs=300,this.maxPressedDistancePx=10,this.maxInbetweenDistancePx=19,this.maxUpToUpDurationMs=500,this.maxUntilSecondDownDurationMs=300,this.minSilenceAfterMs=250,this.sequenceArr=[],this.pointersDownIdArr=[],this.lastUpTime=0,this.nowTime=0,this.eventQueueArr=[],this.timeoutObj={fail:null,maxUntilSecondDown:null,success:null},this.onDoubleTap=t.onDoubleTap,t.isInstant&&(this.minSilenceBeforeDurationMs=0,this.minSilenceAfterMs=0),this.gestureFailed=function(){if(0!==i.sequenceArr.length){if(i.timeoutObj.fail&&clearTimeout(i.timeoutObj.fail),i.timeoutObj.maxUntilSecondDown&&clearTimeout(i.timeoutObj.maxUntilSecondDown),i.timeoutObj.success&&clearTimeout(i.timeoutObj.success),i.timeoutObj.fail=null,i.timeoutObj.maxUntilSecondDown=null,i.timeoutObj.success=null,i.chainOut)for(var e=0;e<i.eventQueueArr.length;e++)i.chainOut(i.eventQueueArr[e]);i.eventQueueArr=[],i.sequenceArr=[]}}}return(0,s._)(e,[{key:"success",value:function(){this.timeoutObj.fail=null,this.timeoutObj.success=null,this.eventQueueArr=[];var e=this.sequenceArr[this.sequenceArr.length-1];this.sequenceArr=[],"pageX"in e&&this.onDoubleTap({pageX:e.pageX,pageY:e.pageY,relX:e.relX,relY:e.relY})}},{key:"setupTimeout",value:function(e,t,i,n){var r=i-this.nowTime;return(!(r<=0)||!!n)&&(this.timeoutObj[e]=setTimeout(t,Math.max(0,r)),!0)}},{key:"processEvent",value:function(e){var t=this;if("pointerdown"===e.type)this.pointersDownIdArr.push(e.pointerId);else if("pointerup"===e.type){for(var i=0;i<this.pointersDownIdArr.length;i++)if(this.pointersDownIdArr[i]===e.pointerId){this.pointersDownIdArr.splice(i,1);break}}if(!this.allowedPointerTypeArr.includes(e.pointerType)){this.gestureFailed();return}this.nowTime=performance.now();var n=this.sequenceArr.length>0?this.sequenceArr[this.sequenceArr.length-1]:null;if("pointerup"===e.type&&(this.lastUpTime=e.time),"pointerdown"===e.type){if(this.pointersDownIdArr.length>1||null!==this.timeoutObj.success||0===this.sequenceArr.length&&this.nowTime-this.lastUpTime<this.minSilenceBeforeDurationMs||e.button&&!this.allowedButtonArr.includes(e.button)||n&&"isDown"in n&&n.isDown||this.sequenceArr.length>2){this.gestureFailed();return}if(n&&"position"in n&&(0,o.dist)(n.position[0],n.position[1],e.pageX,e.pageY)>this.maxInbetweenDistancePx&&(this.gestureFailed(),"time"in n&&this.nowTime-n.time<this.minSilenceBeforeDurationMs))return;if(this.sequenceArr.push({isDown:!0,time:this.nowTime,position:[e.pageX,e.pageY],pointerId:e.pointerId}),this.sequenceArr.length>1)this.timeoutObj.maxUntilSecondDown&&clearTimeout(this.timeoutObj.maxUntilSecondDown);else if(!this.setupTimeout("maxUntilSecondDown",function(){return t.gestureFailed()},e.time+this.maxUntilSecondDownDurationMs)){this.gestureFailed();return}if(this.timeoutObj.fail&&clearTimeout(this.timeoutObj.fail),!this.setupTimeout("fail",function(){return t.gestureFailed()},e.time+this.maxPressedDurationMs)){this.gestureFailed();return}}if(n&&"pointermove"===e.type&&"pointerId"in n&&n.pointerId===e.pointerId&&(0,o.dist)(n.position[0],n.position[1],e.pageX,e.pageY)>this.maxPressedDistancePx){this.gestureFailed();return}if(n&&"pointerup"===e.type){if("pointerId"in n&&n.pointerId!==e.pointerId||"time"in n&&this.nowTime>=n.time+this.maxPressedDurationMs){this.gestureFailed();return}if(this.timeoutObj.fail&&clearTimeout(this.timeoutObj.fail),this.sequenceArr.length<3){if(!this.setupTimeout("fail",function(){return t.gestureFailed()},e.time+this.maxUpToUpDurationMs)){this.gestureFailed();return}this.sequenceArr=[n,{isUp:!0,time:this.nowTime,position:[e.pageX,e.pageY]}];return}"time"in this.sequenceArr[1]&&this.nowTime<this.sequenceArr[1].time+this.maxUpToUpDurationMs?(this.sequenceArr.push({pageX:e.pageX,pageY:e.pageY,relX:e.relX,relY:e.relY}),this.setupTimeout("success",function(){return t.success()},e.time+this.minSilenceAfterMs,!0)||this.gestureFailed()):this.gestureFailed()}}},{key:"chainIn",value:function(e){return(this.processEvent(e),0===this.sequenceArr.length)?(this.gestureFailed(),e):(this.eventQueueArr.push(e),null)}},{key:"setChainOut",value:function(e){this.chainOut=e}},{key:"setAllowedPointerTypeArr",value:function(e){this.allowedPointerTypeArr=(0,a._)(e)}},{key:"setAllowedButtonArr",value:function(e){this.allowedButtonArr=(0,a._)(e)}}]),e}()}),n("635F6",function(t,n){e(t.exports,"OnePointerLimiter",function(){return a});var r=i("cx0mh"),s=i("7h4XF"),a=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.downPointerId=null,this.ignorePointerIdArr=[]}return(0,s._)(e,[{key:"chainIn",value:function(e){if(this.ignorePointerIdArr.includes(e.pointerId)){if("pointerup"===e.type){for(var t=0;t<this.ignorePointerIdArr.length;t++)if(this.ignorePointerIdArr[t]===e.pointerId){this.ignorePointerIdArr.splice(t,1);break}}return null}return null===this.downPointerId?("pointerdown"===e.type&&(this.downPointerId=e.pointerId),e):e.pointerId!==this.downPointerId?("pointerdown"===e.type&&this.ignorePointerIdArr.push(e.pointerId),null):("pointerup"===e.type&&(this.downPointerId=null),e)}},{key:"setChainOut",value:function(e){this.chainOut=e}}]),e}()}),n("gCzYB",function(t,n){e(t.exports,"EventChain",function(){return a});var r=i("cx0mh"),s=i("7h4XF"),a=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.chainArr=t.chainArr;for(var n=0;n<this.chainArr.length;n++)!function(e){i.chainArr[e].setChainOut(function(t){i.continueChain(e+1,t)})}(n)}return(0,s._)(e,[{key:"continueChain",value:function(e,t){for(;e<this.chainArr.length;e++)if(null===(t=this.chainArr[e].chainIn(t)))return null;return this.chainOut&&this.chainOut(t),null}},{key:"chainIn",value:function(e){return this.continueChain(0,e)}},{key:"setChainOut",value:function(e){this.chainOut=e}}]),e}()}),n("8zjca",function(e,t){window.onscroll=function(e){e.preventDefault()}}),n("jRYue",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"cancel.5edb67d5.svg"}),n("3woRO",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"check.42e17e77.svg"}),n("dLlkc",function(n,r){e(n.exports,"DynamicModal",function(){return u});var s=i("cx0mh"),a=i("7h4XF"),o=i("i8UFO"),l=i("eWjiX"),h=i("1mH1z");i("8zjca");var c=i("jRYue"),u=/*#__PURE__*/function(){function e(i){var n=this;(0,s._)(this,e),(0,o.dialogCounter).increase(),this.onClose=i.onClose,this.parent=document.body,this.rootEl=(0,l.BB).el({parent:this.parent,className:"g-root kl-d-modal-root",css:{position:"fixed",left:"0",top:"0",bottom:"0",right:"0",overflow:"auto",animationName:"consoleIn",animationDuration:"0.3s",animationTimingFunction:"ease-out"},onClick:l.BB.handleClick}),this.bgEl=(0,l.BB).el({parent:this.rootEl,css:{position:"absolute",left:"0",top:"0",bottom:"0",right:"0"},onClick:function(){return n.close()}});var r=(0,l.BB).el({parent:this.rootEl,className:"kl-d-modal",css:{position:"absolute",width:(0,l.BB).isCssMinMaxSupported()?"min(calc(100% - 40px), "+(i.width?i.width:400)+"px)":(i.width?i.width:400)+"px",height:"calc(100% - 40px)",borderRadius:"10px",overflow:"hidden"}});this.updatePos=function(){var e=r.offsetWidth,t=r.offsetHeight;(0,l.BB).css(r,{left:Math.max(0,(window.innerWidth-e)/2)+"px",top:Math.max(20,(window.innerHeight-t)/2-.2*t)+"px"})},this.updatePos(),window.addEventListener("resize",this.updatePos);var a=(0,l.BB).el({parent:r,css:{height:"40px",display:"flex",justifyContent:"space-between",alignItems:"center",paddingLeft:"20px"}});i.title&&a.append(i.title),this.xButton=(0,l.BB).el({parent:a,tagName:"button",className:"popup-x",content:`<img alt="${(0,h.LANG)("modal-close")}" height="20" src="${/*@__PURE__*/t(c)}">`,title:(0,h.LANG)("modal-close"),onClick:function(){return n.close()},css:{width:"40px",height:"40px",lineHeight:"40px",background:"none",boxShadow:"none"},custom:{tabindex:"0"}});var u=(0,l.BB).el({parent:r,css:{height:"calc(100% - 40px)"}});i.content&&u.append(i.content),this.keyListener=new l.BB.KeyListener({onDown:function(e,t){"esc"===e&&(t.stopPropagation(),n.close())}})}return(0,a._)(e,[{key:"close",value:function(){(0,o.dialogCounter).decrease(),(0,l.BB).destroyEl(this.rootEl),this.rootEl.remove(),window.removeEventListener("resize",this.updatePos),this.keyListener.destroy(),(0,l.BB).destroyEl(this.xButton),(0,l.BB).destroyEl(this.bgEl),this.onClose&&this.onClose()}}]),e}()}),n("7bWhB",function(t,n){e(t.exports,"Checkbox",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.doHighlight=!!t.doHighlight,this.element=(0,a.BB).el({className:"kl-checkbox"});var n=(0,a.BB).el({parent:this.element,tagName:"label",className:"kl-checkbox__inner",css:{display:"flex"}});this.check=(0,a.BB).el({parent:n,tagName:"input",css:{margin:"0 5px 0 0"},custom:{type:"checkbox"}}),this.check.checked=!!t.init,this.doHighlight&&this.check.checked&&this.element.classList.add("kl-checkbox--highlight"),t.allowTab||(this.check.tabIndex=-1),t.title&&(n.title=t.title),(0,a.BB).el({parent:n,content:t.label,css:{}}).allowClick=!0,this.check.onchange=function(){i.doHighlight&&i.element.classList.toggle("kl-checkbox--highlight",i.check.checked),t.callback&&t.callback(i.check.checked),setTimeout(function(){i.check.blur()},0)},t.css&&(0,a.BB).css(this.element,t.css)}return(0,s._)(e,[{key:"getValue",value:function(){return this.check.checked}},{key:"setValue",value:function(e){this.check.checked=!!e,this.doHighlight&&this.element.classList.toggle("kl-checkbox--highlight",this.check.checked)}},{key:"getElement",value:function(){return this.element}},{key:"destroy",value:function(){this.check.onchange=null}}]),e}()}),n("dJPtW",function(t,n){e(t.exports,"Input",function(){return o}),e(t.exports,"input",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=/*#__PURE__*/function(){function e(t){var i,n,s=this;(0,r._)(this,e),this.keyListener={destroy:function(){}},this.rootEl=(0,a.BB).el({tagName:"label",content:t.label,css:{display:"flex",alignItems:"center",gap:"5px"}}),this.input=(0,a.BB).el({tagName:"input",parent:this.rootEl,title:t.title}),this.input.type,this.type=null!==(i=t.type)&&void 0!==i?i:"text";try{this.input.type=this.type}catch(e){}var o=null!==(n=t.step)&&void 0!==n?n:1;"number"===this.type&&(void 0!==t.min&&(this.input.min=""+t.min),void 0!==t.max&&(this.input.max=""+t.max),void 0!==t.step&&(this.input.step=""+o)),this.input.value=""+t.init;var l=this.input.value,h=function(){var e=l,i=s.input.value;if(t.doResetIfInvalid){var n=!1;""===i&&(i=l,n=!0),void 0!==t.min&&parseFloat(i)<t.min&&(i=""+t.min,n=!0),void 0!==t.max&&parseFloat(i)>t.max&&(i=""+t.max,n=!0),n&&(s.input.value=""+i)}return l=i,e!==i};if(t.onChange){var c=t.onChange;this.input.onchange=function(){h()&&c(s.input.value)}}if(t.css&&(0,a.BB).css(this.input,t.css),t.doScrollWithoutFocus&&"number"===t.type&&t.onChange){var u=t.onChange;this.keyListener=new a.BB.KeyListener({}),this.pointerListener=new a.BB.PointerListener({target:this.input,onWheel:function(e){var t=s.keyListener.isPressed("shift")?4:1;s.input.value=""+(parseFloat(s.input.value)-e.deltaY*o*t),h()&&u(s.input.value)}})}}return(0,s._)(e,[{key:"getElement",value:function(){return this.rootEl}},{key:"getValue",value:function(){return this.input.value}},{key:"setValue",value:function(e){this.input.value=""+e}},{key:"destroy",value:function(){this.pointerListener&&this.pointerListener.destroy(),this.keyListener.destroy()}}]),e}(),l=function(e){var t=document.createElement("input");if(e.type)try{t.type=e.type}catch(e){}else t.type="text";return void 0!==e.min&&(t.min=""+e.min),void 0!==e.max&&(t.max=""+e.max),t.value=""+e.init,e.callback&&(t.onchange=function(){e.callback(t.value)}),e.css&&(0,a.BB).css(t,e.css),t}}),n("eEL9N",function(t,n){e(t.exports,"Select",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.optionArr=[],this.selectEl=(0,a.BB).el({tagName:"select",title:t.title,className:"kl-select",css:{cursor:"pointer",fontSize:"15px",padding:"3px"}}),t.css&&(0,a.BB).css(this.selectEl,t.css);var n=t.isFocusable;n||(this.selectEl.tabIndex=-1),this.setOptionArr(t.optionArr),t.onChange&&(this.onChange=t.onChange),this.changeListener=function(){n||i.selectEl.blur(),i.onChange&&i.onChange(i.getValue())},this.selectEl.addEventListener("change",this.changeListener),this.selectEl.value=void 0!==t.initValue?t.initValue:""}return(0,s._)(e,[{key:"setValue",value:function(e){this.selectEl.value=void 0===e?"":e}},{key:"getValue",value:function(){return this.selectEl.value}},{key:"setDeltaValue",value:function(e){for(var t=0,i=0;i<this.optionArr.length;i++){var n=this.optionArr[i];if(n.item&&""+n.item[0]===this.selectEl.value){t=i;break}}t=Math.max(0,Math.min(this.optionArr.length-1,t+e));var r=this.optionArr[t];this.selectEl.value=r.item?r.item[0]:"",this.onChange&&this.onChange(this.getValue())}},{key:"getElement",value:function(){return this.selectEl}},{key:"updateLabel",value:function(e,t){this.optionArr.forEach(function(i){i.item&&i.item[0]===e&&i.el&&(i.item[1]=t,i.el.textContent=i.item[1])})}},{key:"setOptionArr",value:function(e){var t=this.selectEl.value;this.optionArr=[],this.selectEl.innerHTML="";for(var i=0;i<e.length;i++){var n=e[i];if(!n){this.optionArr.push({item:n});continue}var r=document.createElement("option");r.value=n[0],r.textContent=n[1],n[2]&&(0,a.BB).css(r,n[2].css),this.optionArr.push({item:n,el:r}),this.selectEl.append(r)}(""===t||e.findIndex(function(e){return e&&e[0]===t})>-1)&&this.setValue(t)}},{key:"destroy",value:function(){this.selectEl.removeEventListener("change",this.changeListener)}}]),e}()}),n("1kyaA",function(t,n){e(t.exports,"ImageToggle",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.isActive=!!t.initValue,this.rootEl=(0,a.BB).el({className:"image-toggle",title:t.title,content:(0,a.BB).el({className:"image-toggle__im"+(t.darkInvert?" dark-invert":""),css:{backgroundImage:"url('"+t.image+"')"}}),onClick:function(e){e.preventDefault(),t.isRadio&&i.isActive||(i.isActive=!i.isActive,i.update(),t.onChange(i.isActive))}}),this.update()}return(0,s._)(e,[{key:"update",value:function(){this.rootEl.classList.toggle("image-toggle-active",this.isActive)}},{key:"setValue",value:function(e){this.isActive=!!e,this.update()}},{key:"getElement",value:function(){return this.rootEl}},{key:"getValue",value:function(){return this.isActive}},{key:"destroy",value:function(){(0,a.BB).destroyEl(this.rootEl)}}]),e}()}),n("4nUqS",function(t,n){e(t.exports,"ImageRadioList",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("1kyaA"),l=/*#__PURE__*/function(){function e(t){var i,n=this;(0,r._)(this,e),this.rootEl=(0,a.BB).el({className:"image-radio-wrapper",css:{display:"flex"}}),this.optionArr=[];for(var s=function(e,i){n.activeIndex=e;for(var r=0;r<n.optionArr.length;r++)n.optionArr[r].radioEl.setValue(r===n.activeIndex);t.onChange(i)},l=function(e,r){r.id===t.initId&&(i=e);var a=new o.ImageToggle({image:r.image,title:r.title,initValue:r.id===t.initId,isRadio:!0,onChange:function(){s(e,r.id)},darkInvert:r.darkInvert});return n.rootEl.append(a.getElement()),{id:r.id,radioEl:a}},h=0;h<t.optionArr.length;h++)this.optionArr.push(l(h,t.optionArr[h]));if(void 0===i)throw Error("initId not in optionArr");this.activeIndex=i}return(0,s._)(e,[{key:"getElement",value:function(){return this.rootEl}},{key:"getValue",value:function(){return this.optionArr[this.activeIndex].id}},{key:"destroy",value:function(){this.optionArr.forEach(function(e){e.radioEl.destroy()})}}]),e}()}),n("lCF5N",function(n,r){e(n.exports,"createPenPressureToggle",function(){return h});var s=i("eWjiX"),a=i("1mH1z"),o=i("44j94"),l=i("cmnov"),h=function(e,i){return new l.BoxToggle({label:(0,s.BB).el({className:"dark-invert",css:{width:"17px",height:"17px",backgroundImage:'url("'+/*@__PURE__*/t(o)+'")',backgroundSize:"contain",backgroundRepeat:"no-repeat",margin:"1px",borderRadius:"3px"}}),title:(0,a.LANG)("brush-toggle-pressure"),init:e,onChange:function(e){i(e)}}).getElement()}}),n("44j94",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"brush-pressure.f4437531.svg"}),n("cmnov",function(t,n){e(t.exports,"BoxToggle",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.value=!!t.init,this.el=(0,a.BB).el({content:t.label,title:t.title,className:"string"==typeof t.label?"kl-box-toggle":"kl-box-toggle kl-box-toggle--custom-el",onClick:function(){i.value=!i.value,i.update(),t.onChange(i.value)},css:{cursor:"pointer"}}),"string"!=typeof t.label&&(0,a.BB).css(t.label,{display:"block",pointerEvents:"none"}),this.update()}return(0,s._)(e,[{key:"update",value:function(){this.el.classList.toggle("kl-box-toggle--active",this.value)}},{key:"getValue",value:function(){return this.value}},{key:"setValue",value:function(e){this.value=!!e,this.update()}},{key:"getElement",value:function(){return this.el}},{key:"destroy",value:function(){(0,a.BB).destroyEl(this.el)}}]),e}()}),n("aP0jf",function(t,n){e(t.exports,"KlSlider",function(){return c});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("11glk"),l=i("1mH1z"),h=i("869o9"),c=/*#__PURE__*/function(){function e(t){var i,n=this;if((0,r._)(this,e),this.isEnabled=!1!==t.isEnabled,this.manualInputRoundDigits=t.manualInputRoundDigits,this.useSpline=!!t.curve,!t.label)throw Error("KlSlider missing params");if(0!=t.min&&0!=t.max&&0!=t.value&&(!t.min||!t.max||!t.value)||t.min>=t.max)throw Error("KlSlider broken params");if(this.min=t.min,this.max=t.max,this.value=(0,a.BB).clamp(t.value,this.min,this.max),this.elementWidth=t.width,this.elementHeight=t.height,this.resolution=t.resolution?t.resolution:2*this.elementWidth,this.onChange=t.onChange?t.onChange:function(){},!t.toValue!=!t.toDisplayValue)throw Error("both or neither have to be set, toValue and toDisplayValue");if(this.displayValueToValue=t.toValue?t.toValue:function(e){return e},this.valueToDisplayValue=t.toDisplayValue?t.toDisplayValue:function(e){return e},this.isChangeOnFinal=!!t.isChangeOnFinal,this.formatFunc=t.formatFunc,this.eventResMs=t.eventResMs,this.unit=t.unit,this.useSpline){if(!t.curve)throw Error("curve needs to be set if useSpline true");var s="quadratic"===t.curve?(0,a.BB).quadraticSplineInput(this.min,this.max,.1):t.curve;this.splineInterpolator=new a.BB.SplineInterpolator(s)}this.rootEl=(0,a.BB).el({css:{display:"flex"}}),this.sliderWrapperEl=(0,a.BB).el({parent:this.rootEl,className:"slider-wrapper",css:{overflow:"hidden",position:"relative",width:this.elementWidth+"px",height:this.elementHeight+"px",userSelect:"none"}}),this.rootEl.oncontextmenu=function(){return!1},this.label=t.label;var l=this.elementHeight-14;this.textEl=(0,a.BB).el({content:this.label,css:{position:"absolute",display:"flex",alignItems:"center",marginLeft:"7px",height:"100%",fontSize:l+"px",pointerEvents:"none"}}),this.control=(0,a.BB).el({className:"slider-inner",css:{position:"absolute",left:"0",top:"0",width:this.valueToSliderValue(this.value)*this.elementWidth+"px",height:this.elementHeight+"px"}});var h=document.createElement("div");this.sliderWrapperEl.append(this.control,this.textEl),this.control.append(h),this.updateEnable();var c=new a.BB.DoubleTapper({onDoubleTap:function(){n.showManualInput()}});c.setAllowedButtonArr(["left","right"]);var u=new a.BB.EventChain({chainArr:[c]}),p=function(e){if(e.eventPreventDefault(),n.isEnabled){if("pointerdown"===e.type){if((0,a.BB).unfocusAnyInput(),n.sliderWrapperEl.className="slider-wrapper slider-wrapper--active","left"===e.button){var t=e.relX/n.elementWidth;t=Math.max(0,Math.min(1,t)),n.value=n.sliderValueToValue(t),n.updateLabel(),n.emit(!1)}i=n.valueToSliderValue(n.value)}if("pointermove"===e.type&&["left","right"].includes(e.button||"")){var r=e.dX,s=Math.abs(e.pageY-(e.downPageY||0));r*=(0,o.calcSliderFalloffFactor)(s,"right"===e.button),r/=n.elementWidth;var l=Math.max(0,Math.min(1,i+=r));n.value=n.sliderValueToValue(l),n.updateLabel(),n.emit(!1)}"pointerup"===e.type&&(n.sliderWrapperEl.className="slider-wrapper",n.emit(!0))}};this.pointerListenerTimeout=setTimeout(function(){n.pointerListener=new a.BB.PointerListener({target:n.sliderWrapperEl,fixScribble:!0,onPointer:function(e){p(e),u.chainIn(e)},onWheel:function(e){var t=n.valueToSliderValue(n.value);t=(0,a.BB).clamp(t-e.deltaY/40,0,1),n.value=n.sliderValueToValue(t),n.updateLabel(),n.onChange(n.value)}}),n.updateLabel()},1)}return(0,s._)(e,[{key:"valueToSliderValue",value:function(e){return this.useSpline&&this.splineInterpolator?this.splineInterpolator.findX(e,Math.floor(this.resolution))||0:(e-this.min)/(this.max-this.min)}},{key:"sliderValueToValue",value:function(e){var t=this.min+e*(this.max-this.min);return this.useSpline&&this.splineInterpolator&&(t=this.splineInterpolator.interpolate(e)||0),t}},{key:"updateLabel",value:function(){var e=this.valueToDisplayValue(this.value);e=(e=this.formatFunc?this.formatFunc(e):Math.round(e)).toLocaleString((0,l.languageStrings).getCode());var t=void 0!==this.unit?this.unit:"";this.textEl.innerHTML=this.label+'&nbsp;&nbsp;<span style="font-weight:bold">'+e+t+"</span>";var i=this.valueToSliderValue(this.value);this.control.style.width=i*this.elementWidth+"px"}},{key:"emit",value:function(e){var t=this;if(e||!this.isChangeOnFinal){if(e||!this.eventResMs){this.onChange(this.value),this.emitInterval&&(clearInterval(this.emitInterval),this.emitInterval=void 0);return}this.emitInterval?this.emitValue=this.value:(this.onChange(this.value),this.emitInterval=setInterval(function(){void 0===t.emitValue?(clearInterval(t.emitInterval),t.emitInterval=void 0):(t.onChange(t.emitValue),t.emitValue=void 0)},this.eventResMs))}}},{key:"updateEnable",value:function(){this.sliderWrapperEl.classList.toggle("slider-wrapper--disabled",!this.isEnabled),(0,a.BB).css(this.sliderWrapperEl,{opacity:this.isEnabled?"":"0.5",pointerEvents:this.isEnabled?"":"none"}),this.manualInput&&this.manualInput.setIsEnabled(this.isEnabled)}},{key:"showManualInput",value:function(){var e=this;this.manualInput=new h.KlSliderManualInput(this.valueToDisplayValue(this.value),this.valueToDisplayValue(this.min),this.valueToDisplayValue(this.max),this.sliderWrapperEl.getBoundingClientRect(),function(t){t=e.displayValueToValue(t),e.setValue((0,a.BB).clamp(t,e.min,e.max)),e.onChange(e.value)},function(){(0,a.BB).css(e.sliderWrapperEl,{display:""}),e.manualInput&&(e.manualInput.getElement().remove(),e.manualInput.destroy()),e.manualInput=void 0},this.manualInputRoundDigits&&this.manualInputRoundDigits>0?this.manualInputRoundDigits:0),this.manualInput.setIsEnabled(this.isEnabled),this.rootEl.append(this.manualInput.getElement()),setTimeout(function(){e.manualInput&&e.manualInput.focus()}),(0,a.BB).css(this.sliderWrapperEl,{display:"none"})}},{key:"changeSliderValue",value:function(e){if(this.isEnabled){var t=this.valueToSliderValue(this.value);t=(0,a.BB).clamp(t+e,0,1),this.value=this.sliderValueToValue(t),this.updateLabel(),this.onChange(this.value)}}},{key:"setValue",value:function(e){this.value=(0,a.BB).clamp(e,this.min,this.max),this.updateLabel()}},{key:"getValue",value:function(){return this.value}},{key:"getDisplayValue",value:function(){return this.valueToDisplayValue(this.value)}},{key:"update",value:function(e){if(this.min=e.min,this.max=e.max,this.useSpline=!!e.curve,this.useSpline){if(!e.curve)throw Error("curve needs to be set if useSpline true");var t="quadratic"===e.curve?(0,a.BB).quadraticSplineInput(this.min,this.max,.1):e.curve;this.splineInterpolator=new a.BB.SplineInterpolator(t)}else this.splineInterpolator=void 0;this.setIsEnabled(!e.isDisabled)}},{key:"setIsEnabled",value:function(e){this.isEnabled=!!e,this.updateEnable()}},{key:"getElement",value:function(){return this.rootEl}},{key:"destroy",value:function(){clearTimeout(this.pointerListenerTimeout),this.pointerListener&&this.pointerListener.destroy(),this.manualInput&&this.manualInput.destroy(),this.emitInterval&&clearInterval(this.emitInterval)}}]),e}()}),n("11glk",function(t,i){e(t.exports,"calcSliderFalloffFactor",function(){return n});function n(e,t){var i=Math.min(10,1+Math.pow(Math.floor(e/50),2));return t&&(i*=2),1/i}}),n("869o9",function(t,n){e(t.exports,"KlSliderManualInput",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("dJPtW"),l=/*#__PURE__*/function(){function e(t,i,n,s,l,h,c){var u,p=this;(0,r._)(this,e),this.onChange=l,this.onClose=h,this.isEnabled=!0,this.isClosed=!1,this.input=(0,o.input)({type:"number",init:t,min:i,max:n,callback:function(e){p.emit()}}),0!==c&&this.input.setAttribute("step","any"),this.input.onblur=function(){p.privateOnClose()},this.input.addEventListener("keyup",function(e){["Enter","Escape"].includes(e.key)?p.privateOnClose():p.emit()},{passive:!1}),this.input.addEventListener("wheel",function(){return p.emit()},{passive:!1}),this.scrollBefore={x:window.scrollX,y:window.scrollY},u=c||0===c?(0,a.BB).round(t,c):t,this.lastValue=u,this.input.value=""+u,(0,a.BB).css(this.input,{width:s.width+"px",height:s.height+"px"})}return(0,s._)(e,[{key:"emit",value:function(){this.lastValue!==Number(this.input.value)&&(this.onChange(Number(this.input.value)),this.lastValue=Number(this.input.value))}},{key:"privateOnClose",value:function(){var e=this;this.isClosed||(this.isClosed=!0,this.emit(),this.onClose(),setTimeout(function(){e.scrollBefore&&window.scrollTo(e.scrollBefore.x,e.scrollBefore.y),e.scrollBefore=void 0}))}},{key:"getElement",value:function(){return this.input}},{key:"setIsEnabled",value:function(e){this.isEnabled=!!e}},{key:"focus",value:function(){this.input.focus(),this.input.select()}},{key:"destroy",value:function(){(0,a.BB).destroyEl(this.input)}}]),e}()}),n("lfHl9",function(n,r){e(n.exports,"HexColorDialog",function(){return d});var s=i("cx0mh"),a=i("eWjiX"),o=i("dJPtW"),l=i("2MaaK"),h=i("1mH1z"),c=i("jLQSi"),u=i("amum4"),p=i("jXowp"),d=function e(i){(0,s._)(this,e);var n=function(e,t){var i=(0,o.input)({init:r[t],min:0,max:255,type:"number",css:{width:"80px"},callback:function(){if(""===i.value||0>parseFloat(i.value)||parseFloat(i.value)>255){n.update();return}i.value=""+Math.round(parseFloat(i.value)),r[t]=Number(i.value),d.style.background="#"+(0,a.BB).ColorConverter.toHexString(r),f.value="#"+(0,a.BB).ColorConverter.toHexString(r)}}),n={update:function(){i.value=""+r[t]},destroy:function(){(0,a.BB).unsetEventHandler(i,"onchange")},element:(0,u.c)("tr",[(0,u.c)("td,pr-10",e),(0,u.c)("td",[i])])};return n},r=new a.BB.RGB(i.color.r,i.color.g,i.color.b),d=(0,a.BB).el({css:{width:"20px",height:"20px",marginBottom:"10px",boxShadow:"inset 0 0 0 1px #fff, 0 0 0 1px #000",background:"#"+(0,a.BB).ColorConverter.toHexString(r)}}),g=(0,a.BB).el({content:(0,h.LANG)("mci-hex")}),f=(0,o.input)({init:"#"+(0,a.BB).ColorConverter.toHexString(r),css:{width:"80px"},callback:function(){var e=(0,a.BB).ColorConverter.hexToRGB(f.value);e?r=e:(e=r,f.value="#"+(0,a.BB).ColorConverter.toHexString(r)),d.style.background="#"+(0,a.BB).ColorConverter.toHexString(e);for(var t=0;t<y.length;t++)y[t].update()}}),v=(0,a.BB).el({tagName:"button",content:'<img src="'+/*@__PURE__*/t(c)+'" height="20" alt=""/>',title:(0,h.LANG)("mci-copy"),onClick:function(){f.select(),navigator.clipboard.writeText(f.value).then().catch()}}),m=(0,u.c)({css:{display:"flex",alignItems:"center",marginBottom:"15px",flexWrap:"wrap",gap:"5px 10px",maxWidth:"250px"}},[g,(0,u.c)(",flex,items-center,gap-10",[f,v])]);setTimeout(function(){f.focus(),f.select()},0);var y=[n((0,h.LANG)("red"),"r"),n((0,h.LANG)("green"),"g"),n((0,h.LANG)("blue"),"b")],x=(0,p.css)({borderCollapse:"collapse",td:{paddingBottom:"5px"}}),b=(0,u.c)("",[d,m,(0,u.c)("table."+x,[(0,u.c)("tbody",y.map(function(e){return e.element}))])]);(0,l.showModal)({target:document.body,message:`<b>${(0,h.LANG)("manual-color-input")}</b>`,div:b,autoFocus:!1,clickOnEnter:"Ok",buttons:["Ok","Cancel"],callback:function(e){(0,a.BB).destroyEl(v),y.forEach(function(e){return e.destroy()}),y.splice(0,y.length),i.onClose("Ok"===e?(0,a.BB).ColorConverter.hexToRGB(f.value):void 0)}})}}),n("jLQSi",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"copy.4adadd0c.svg"}),n("amum4",function(t,n){e(t.exports,"c",function(){return o});var r=i("bX4ja"),s=i("eWjiX"),a=i("72Jv0");function o(e,t){if(void 0===e)return document.createElement("div");if("string"!=typeof e)return e instanceof HTMLElement||(e=(0,a.el)(e)),t&&("string"==typeof t?e.innerHTML=t:(h=e).append.apply(h,(0,r._)(t))),e;var i,n,o,l,h,c,u=function(e){if(""===e)return{};var t,i,n=[];1===(t=e.split(".")).length?i=(t=t[0].split(",")).shift():(i=t.shift(),t.forEach(function(e,i){if(i===t.length-1){var r=(t=e.split(",")).shift();void 0!==r&&n.push(r)}else n.push(e)}));var r={};return""!==i&&(r.tagName=i),n.length>0&&(r.classes=n),t.length>0&&(r.styles=t),r}(e),p=document.createElement(null!==(c=u.tagName)&&void 0!==c?c:"div");return u.classes&&(l=p.classList).add.apply(l,(0,r._)(u.classes)),u.styles&&(i=u.styles,n={},o={c:function(e){n.color=e[0]},bg:function(e){n.background=e[0]},p:function(e){n.padding=e[0]+"px"},py:function(e){n.paddingTop=e[0]+"px",n.paddingBottom=e[0]+"px"},pt:function(e){n.paddingTop=e[0]+"px"},pr:function(e){n.paddingRight=e[0]+"px"},pb:function(e){n.paddingBottom=e[0]+"px"},pl:function(e){n.paddingLeft=e[0]+"px"},mt:function(e){n.marginTop=e[0]+"px"},mr:function(e){n.marginRight=e[0]+"px"},mb:function(e){n.marginBottom=e[0]+"px"},ml:function(e){n.marginLeft=e[0]+"px"},flex:function(){n.display="flex"},flexCol:function(){n.flexDirection="column"},flexWrap:function(){n.flexWrap="wrap"},gap:function(e){n.gap=e.map(function(e){return e+"px"}).join(" ")},grow:function(){n.flexGrow="1"},justify:function(e){n.justifyContent=e[0]},items:function(e){n.alignItems=e[0]},hidden:function(){n.display="none"},nowrap:function(){n.whiteSpace="nowrap"},abs:function(e){n.position="absolute",n.left=e[0]+"px",n.top=e[1]+"px"},w:function(e){n.width="full"===e[0]?"100%":e[0]+"px"},h:function(e){n.height="full"===e[0]?"100%":e[0]+"px"},minh:function(e){n.minHeight=e[0]+"px"},z:function(e){n.zIndex=e[0]},overflow:function(e){n.overflow=e[0]},pos:function(e){n.position=e[0]},left:function(e){n.left="full"===e[0]?"100%":e[0]+"px"},top:function(e){n.top="full"===e[0]?"100%":e[0]+"px"},right:function(e){n.right="full"===e[0]?"100%":e[0]+"px"},bottom:function(e){n.bottom="full"===e[0]?"100%":e[0]+"px"},size:function(e){n.fontSize=e[0]+"px"},pointer:function(e){n.pointerEvents=e[0]}},i.forEach(function(e){var t=e.split("-");o[t.shift()](t)}),(0,s.BB).css(p,n)),t&&("string"==typeof t?p.innerHTML=t:p.append.apply(p,(0,r._)(t))),p}}),n("jXowp",function(t,n){e(t.exports,"css",function(){return a});var r=i("iVt4v");i("exBzs"),i("csvAs"),i("5zE8f");var s=(0,r.default)({key:"css"}),a=(s.flush,s.hydrate,s.cx,s.merge,s.getRegisteredStyles,s.injectGlobal,s.keyframes,s.css);s.sheet,s.cache}),n("iVt4v",function(t,n){e(t.exports,"default",function(){return h});var r=i("exBzs"),s=i("csvAs"),a=i("5zE8f");function o(e,t){if(void 0===e.inserted[t.name])return e.insert("",t,e.sheet,!0)}function l(e,t,i){var n=[],r=(0,a.getRegisteredStyles)(e,n,i);return n.length<2?i:r+t(n)}var h=function(e){var t=(0,r.default)(e);t.sheet.speedy=function(e){this.isSpeedy=e},t.compat=!0;var i=function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];var r=(0,s.serializeStyles)(i,t.registered,void 0);return(0,a.insertStyles)(t,r,!1),t.key+"-"+r.name};return{css:i,cx:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return l(t.registered,i,c(n))},injectGlobal:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];var r=(0,s.serializeStyles)(i,t.registered);o(t,r)},keyframes:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];var r=(0,s.serializeStyles)(i,t.registered),a="animation-"+r.name;return o(t,{name:r.name,styles:"@keyframes "+a+"{"+r.styles+"}"}),a},hydrate:function(e){e.forEach(function(e){t.inserted[e]=!0})},flush:function(){t.registered={},t.inserted={},t.sheet.flush()},sheet:t.sheet,cache:t,getRegisteredStyles:(0,a.getRegisteredStyles).bind(null,t.registered),merge:l.bind(null,t.registered,i)}},c=function e(t){for(var i="",n=0;n<t.length;n++){var r=t[n];if(null!=r){var s=void 0;switch(typeof r){case"boolean":break;case"object":if(Array.isArray(r))s=e(r);else for(var a in s="",r)r[a]&&a&&(s&&(s+=" "),s+=a);break;default:s=r}s&&(i&&(i+=" "),i+=s)}}return i}}),n("exBzs",function(t,n){Object.defineProperty(t.exports,"__esModule",{value:!0,configurable:!0}),e(t.exports,"default",function(){return p});var r=i("hkMbk"),s=i("ikgWV");i("gZ0tz"),i("8ClKM");var a=function(e,t,i){for(var n=0,r=0;n=r,r=(0,s.peek)(),38===n&&12===r&&(t[i]=1),!(0,s.token)(r);)(0,s.next)();return(0,s.slice)(e,s.position)},o=function(e,t){var i=-1,n=44;do switch((0,s.token)(n)){case 0:38===n&&12===(0,s.peek)()&&(t[i]=1),e[i]+=a(s.position-1,t,i);break;case 2:e[i]+=(0,s.delimit)(n);break;case 4:if(44===n){e[++i]=58===(0,s.peek)()?"&\f":"",t[i]=e[i].length;break}default:e[i]+=(0,s.from)(n)}while(n=(0,s.next)())return e},l=/* #__PURE__ */new WeakMap,h=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,i=e.parent,n=e.column===i.column&&e.line===i.line;"rule"!==i.type;)if(!(i=i.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||l.get(i))&&!n){l.set(e,!0);for(var r=[],a=(0,s.dealloc)(o((0,s.alloc)(t),r)),h=i.props,c=0,u=0;c<a.length;c++)for(var p=0;p<h.length;p++,u++)e.props[u]=r[c]?a[c].replace(/&\f/g,h[p]):h[p]+" "+a[c]}}},c=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}},u=[function(e,t,i,n){if(e.length>-1&&!e.return)switch(e.type){case s.DECLARATION:e.return=function e(t,i){switch((0,s.hash)(t,i)){case 5103:return s.WEBKIT+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return s.WEBKIT+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return s.WEBKIT+t+s.MOZ+t+s.MS+t+t;case 6828:case 4268:return s.WEBKIT+t+s.MS+t+t;case 6165:return s.WEBKIT+t+s.MS+"flex-"+t+t;case 5187:return s.WEBKIT+t+(0,s.replace)(t,/(\w+).+(:[^]+)/,s.WEBKIT+"box-$1$2"+s.MS+"flex-$1$2")+t;case 5443:return s.WEBKIT+t+s.MS+"flex-item-"+(0,s.replace)(t,/flex-|-self/,"")+t;case 4675:return s.WEBKIT+t+s.MS+"flex-line-pack"+(0,s.replace)(t,/align-content|flex-|-self/,"")+t;case 5548:return s.WEBKIT+t+s.MS+(0,s.replace)(t,"shrink","negative")+t;case 5292:return s.WEBKIT+t+s.MS+(0,s.replace)(t,"basis","preferred-size")+t;case 6060:return s.WEBKIT+"box-"+(0,s.replace)(t,"-grow","")+s.WEBKIT+t+s.MS+(0,s.replace)(t,"grow","positive")+t;case 4554:return s.WEBKIT+(0,s.replace)(t,/([^-])(transform)/g,"$1"+s.WEBKIT+"$2")+t;case 6187:return(0,s.replace)((0,s.replace)((0,s.replace)(t,/(zoom-|grab)/,s.WEBKIT+"$1"),/(image-set)/,s.WEBKIT+"$1"),t,"")+t;case 5495:case 3959:return(0,s.replace)(t,/(image-set\([^]*)/,s.WEBKIT+"$1$`$1");case 4968:return(0,s.replace)((0,s.replace)(t,/(.+:)(flex-)?(.*)/,s.WEBKIT+"box-pack:$3"+s.MS+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+s.WEBKIT+t+t;case 4095:case 3583:case 4068:case 2532:return(0,s.replace)(t,/(.+)-inline(.+)/,s.WEBKIT+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if((0,s.strlen)(t)-1-i>6)switch((0,s.charat)(t,i+1)){case 109:if(45!==(0,s.charat)(t,i+4))break;case 102:return(0,s.replace)(t,/(.+:)(.+)-([^]+)/,"$1"+s.WEBKIT+"$2-$3$1"+s.MOZ+(108==(0,s.charat)(t,i+3)?"$3":"$2-$3"))+t;case 115:return~(0,s.indexof)(t,"stretch")?e((0,s.replace)(t,"stretch","fill-available"),i)+t:t}break;case 4949:if(115!==(0,s.charat)(t,i+1))break;case 6444:switch((0,s.charat)(t,(0,s.strlen)(t)-3-(~(0,s.indexof)(t,"!important")&&10))){case 107:return(0,s.replace)(t,":",":"+s.WEBKIT)+t;case 101:return(0,s.replace)(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+s.WEBKIT+(45===(0,s.charat)(t,14)?"inline-":"")+"box$3$1"+s.WEBKIT+"$2$3$1"+s.MS+"$2box$3")+t}break;case 5936:switch((0,s.charat)(t,i+11)){case 114:return s.WEBKIT+t+s.MS+(0,s.replace)(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return s.WEBKIT+t+s.MS+(0,s.replace)(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return s.WEBKIT+t+s.MS+(0,s.replace)(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return s.WEBKIT+t+s.MS+t+t}return t}(e.value,e.length);break;case s.KEYFRAMES:return(0,s.serialize)([(0,s.copy)(e,{value:(0,s.replace)(e.value,"@","@"+s.WEBKIT)})],n);case s.RULESET:if(e.length)return(0,s.combine)(e.props,function(t){switch((0,s.match)(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return(0,s.serialize)([(0,s.copy)(e,{props:[(0,s.replace)(t,/:(read-\w+)/,":"+s.MOZ+"$1")]})],n);case"::placeholder":return(0,s.serialize)([(0,s.copy)(e,{props:[(0,s.replace)(t,/:(plac\w+)/,":"+s.WEBKIT+"input-$1")]}),(0,s.copy)(e,{props:[(0,s.replace)(t,/:(plac\w+)/,":"+s.MOZ+"$1")]}),(0,s.copy)(e,{props:[(0,s.replace)(t,/:(plac\w+)/,s.MS+"input-$1")]})],n)}return""})}}],p=function(e){var t,i,n,a=e.key;if("css"===a){var o=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(o,function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))})}var l=e.stylisPlugins||u,p={},d=[];t=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+a+' "]'),function(e){for(var t=e.getAttribute("data-emotion").split(" "),i=1;i<t.length;i++)p[t[i]]=!0;d.push(e)});var g=[s.stringify,(0,s.rulesheet)(function(e){n.insert(e)})],f=(0,s.middleware)([h,c].concat(l,g));i=function(e,t,i,r){var a;n=i,a=e?e+"{"+t.styles+"}":t.styles,(0,s.serialize)((0,s.compile)(a),f),r&&(v.inserted[t.name]=!0)};var v={key:a,sheet:new r.StyleSheet({key:a,container:t,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:p,registered:{},insert:i};return v.sheet.hydrate(d),v}}),n("hkMbk",function(t,i){e(t.exports,"StyleSheet",function(){return n});var n=/*#__PURE__*/function(){function e(e){var t=this;this._insertTag=function(e){var i;i=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,i),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){if(this.ctr%(this.isSpeedy?65e3:1)==0){var t;this._insertTag(((t=document.createElement("style")).setAttribute("data-emotion",this.key),void 0!==this.nonce&&t.setAttribute("nonce",this.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t))}var i=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(i);try{n.insertRule(e,n.cssRules.length)}catch(e){}}else i.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach(function(e){return e.parentNode&&e.parentNode.removeChild(e)}),this.tags=[],this.ctr=0},e}()}),n("ikgWV",function(t,i){e(t.exports,"MS",function(){return n}),e(t.exports,"MOZ",function(){return r}),e(t.exports,"WEBKIT",function(){return s}),e(t.exports,"RULESET",function(){return o}),e(t.exports,"DECLARATION",function(){return l}),e(t.exports,"KEYFRAMES",function(){return h}),e(t.exports,"from",function(){return u}),e(t.exports,"hash",function(){return d}),e(t.exports,"charat",function(){return m}),e(t.exports,"match",function(){return g}),e(t.exports,"replace",function(){return f}),e(t.exports,"indexof",function(){return v}),e(t.exports,"strlen",function(){return x}),e(t.exports,"combine",function(){return B}),e(t.exports,"position",function(){return S}),e(t.exports,"copy",function(){return I}),e(t.exports,"next",function(){return T}),e(t.exports,"peek",function(){return P}),e(t.exports,"slice",function(){return R}),e(t.exports,"token",function(){return M}),e(t.exports,"alloc",function(){return D}),e(t.exports,"dealloc",function(){return O}),e(t.exports,"delimit",function(){return _}),e(t.exports,"compile",function(){return N}),e(t.exports,"serialize",function(){return j}),e(t.exports,"stringify",function(){return F}),e(t.exports,"middleware",function(){return H}),e(t.exports,"rulesheet",function(){return U});var n="-ms-",r="-moz-",s="-webkit-",a="comm",o="rule",l="decl",h="@keyframes",c=Math.abs,u=String.fromCharCode,p=Object.assign;function d(e,t){return 45^m(e,0)?(((t<<2^m(e,0))<<2^m(e,1))<<2^m(e,2))<<2^m(e,3):0}function g(e,t){return(e=t.exec(e))?e[0]:e}function f(e,t,i){return e.replace(t,i)}function v(e,t){return e.indexOf(t)}function m(e,t){return 0|e.charCodeAt(t)}function y(e,t,i){return e.slice(t,i)}function x(e){return e.length}function b(e,t){return t.push(e),e}function B(e,t){return e.map(t).join("")}var w=1,k=1,C=0,S=0,E=0,L="";function A(e,t,i,n,r,s,a){return{value:e,root:t,parent:i,type:n,props:r,children:s,line:w,column:k,length:a,return:""}}function I(e,t){return p(A("",null,null,"",null,null,0),e,{length:-e.length},t)}function T(){return E=S<C?m(L,S++):0,k++,10===E&&(k=1,w++),E}function P(){return m(L,S)}function R(e,t){return y(L,e,t)}function M(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function D(e){return w=k=1,C=x(L=e),S=0,[]}function O(e){return L="",e}function _(e){return R(S-1,function e(t){for(;T();)switch(E){case t:return S;case 34:case 39:34!==t&&39!==t&&e(E);break;case 40:41===t&&e(t);break;case 92:T()}return S}(91===e?e+2:40===e?e+1:e)).trim()}function N(e){return O(function e(t,i,n,r,s,o,l,h,c){for(var p,d=0,g=0,B=l,C=0,I=0,D=0,O=1,N=1,j=1,F=0,H="",U=s,X=o,V=r,W=H;N;)switch(D=F,F=T()){case 40:if(108!=D&&58==m(W,B-1)){-1!=v(W+=f(_(F),"&","&\f"),"&\f")&&(j=-1);break}case 34:case 39:case 91:W+=_(F);break;case 9:case 10:case 13:case 32:W+=function(e){for(;E=P();)if(E<33)T();else break;return M(e)>2||M(E)>3?"":" "}(D);break;case 92:W+=function(e,t){for(;--t&&T()&&!(E<48)&&!(E>102)&&(!(E>57)||!(E<65))&&(!(E>70)||!(E<97)););return R(e,S+(t<6&&32==P()&&32==T()))}(S-1,7);continue;case 47:switch(P()){case 42:case 47:b(A(p=function(e,t){for(;T();)if(e+E===57)break;else if(e+E===84&&47===P())break;return"/*"+R(t,S-1)+"*"+u(47===e?e:T())}(T(),S),i,n,a,u(E),y(p,2,-2),0),c);break;default:W+="/"}break;case 123*O:h[d++]=x(W)*j;case 125*O:case 59:case 0:switch(F){case 0:case 125:N=0;case 59+g:-1==j&&(W=f(W,/\f/g,"")),I>0&&x(W)-B&&b(I>32?G(W+";",r,n,B-1):G(f(W," ","")+";",r,n,B-2),c);break;case 59:W+=";";default:if(b(V=z(W,i,n,d,g,s,h,H,U=[],X=[],B),o),123===F){if(0===g)e(W,i,V,V,U,o,B,h,X);else switch(99===C&&110===m(W,3)?100:C){case 100:case 108:case 109:case 115:e(t,V,V,r&&b(z(t,V,V,0,0,s,h,H,s,U=[],B),X),s,X,B,h,r?U:X);break;default:e(W,V,V,V,[""],X,0,h,X)}}}d=g=I=0,O=j=1,H=W="",B=l;break;case 58:B=1+x(W),I=D;default:if(O<1){if(123==F)--O;else if(125==F&&0==O++&&125==(E=S>0?m(L,--S):0,k--,10===E&&(k=1,w--),E))continue}switch(W+=u(F),F*O){case 38:j=g>0?1:(W+="\f",-1);break;case 44:h[d++]=(x(W)-1)*j,j=1;break;case 64:45===P()&&(W+=_(T())),C=P(),g=B=x(H=W+=function(e){for(;!M(P());)T();return R(e,S)}(S)),F++;break;case 45:45===D&&2==x(W)&&(O=0)}}return o}("",null,null,null,[""],e=D(e),0,[0],e))}function z(e,t,i,n,r,s,a,l,h,u,p){for(var d=r-1,g=0===r?s:[""],v=g.length,m=0,x=0,b=0;m<n;++m)for(var B=0,w=y(e,d+1,d=c(x=a[m])),k=e;B<v;++B)(k=(x>0?g[B]+" "+w:f(w,/&\f/g,g[B])).trim())&&(h[b++]=k);return A(e,t,i,0===r?o:l,h,u,p)}function G(e,t,i,n){return A(e,t,i,l,y(e,0,n),y(e,n+1,-1),n)}function j(e,t){for(var i="",n=e.length,r=0;r<n;r++)i+=t(e[r],r,e,t)||"";return i}function F(e,t,i,n){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case l:return e.return=e.return||e.value;case a:return"";case h:return e.return=e.value+"{"+j(e.children,n)+"}";case o:e.value=e.props.join(",")}return x(i=j(e.children,n))?e.return=e.value+"{"+i+"}":""}function H(e){var t=e.length;return function(i,n,r,s){for(var a="",o=0;o<t;o++)a+=e[o](i,n,r,s)||"";return a}}function U(e){return function(t){!t.root&&(t=t.return)&&e(t)}}}),n("gZ0tz",function(e,t){}),n("8ClKM",function(t,i){e(t.exports,"default",function(){return n});function n(e){var t=Object.create(null);return function(i){return void 0===t[i]&&(t[i]=e(i)),t[i]}}}),n("csvAs",function(t,n){e(t.exports,"serializeStyles",function(){return v});var r,s=i("3worW"),a=i("1gYqP"),o=i("8ClKM"),l=/[A-Z]|^ms/g,h=/_EMO_([^_]+?)_([^]*?)_EMO_/g,c=function(e){return 45===e.charCodeAt(1)},u=function(e){return null!=e&&"boolean"!=typeof e},p=/* #__PURE__ */(0,o.default)(function(e){return c(e)?e:e.replace(l,"-$&").toLowerCase()}),d=function(e,t){switch(e){case"animation":case"animationName":if("string"==typeof t)return t.replace(h,function(e,t,i){return r={name:t,styles:i,next:r},t})}return 1===a.default[e]||c(e)||"number"!=typeof t||0===t?t:t+"px"};function g(e,t,i){if(null==i)return"";if(void 0!==i.__emotion_styles)return i;switch(typeof i){case"boolean":return"";case"object":if(1===i.anim)return r={name:i.name,styles:i.styles,next:r},i.name;if(void 0!==i.styles){var n=i.next;if(void 0!==n)for(;void 0!==n;)r={name:n.name,styles:n.styles,next:r},n=n.next;return i.styles+";"}return function(e,t,i){var n="";if(Array.isArray(i))for(var r=0;r<i.length;r++)n+=g(e,t,i[r])+";";else for(var s in i){var a=i[s];if("object"!=typeof a)null!=t&&void 0!==t[a]?n+=s+"{"+t[a]+"}":u(a)&&(n+=p(s)+":"+d(s,a)+";");else if(Array.isArray(a)&&"string"==typeof a[0]&&(null==t||void 0===t[a[0]]))for(var o=0;o<a.length;o++)u(a[o])&&(n+=p(s)+":"+d(s,a[o])+";");else{var l=g(e,t,a);switch(s){case"animation":case"animationName":n+=p(s)+":"+l+";";break;default:n+=s+"{"+l+"}"}}}return n}(e,t,i);case"function":if(void 0!==e){var s=r,a=i(e);return r=s,g(e,t,a)}}if(null==t)return i;var o=t[i];return void 0!==o?o:i}var f=/label:\s*([^\s;\n{]+)\s*(;|$)/g,v=function(e,t,i){if(1===e.length&&"object"==typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var n,a=!0,o="";r=void 0;var l=e[0];null==l||void 0===l.raw?(a=!1,o+=g(i,t,l)):o+=l[0];for(var h=1;h<e.length;h++)o+=g(i,t,e[h]),a&&(o+=l[h]);f.lastIndex=0;for(var c="";null!==(n=f.exec(o));)c+="-"+n[1];return{name:(0,s.default)(o)+c,styles:o,next:r}}}),n("3worW",function(t,i){e(t.exports,"default",function(){return n});function n(e){for(var t,i=0,n=0,r=e.length;r>=4;++n,r-=4)t=(65535&(t=255&e.charCodeAt(n)|(255&e.charCodeAt(++n))<<8|(255&e.charCodeAt(++n))<<16|(255&e.charCodeAt(++n))<<24))*1540483477+((t>>>16)*59797<<16),t^=t>>>24,i=(65535&t)*1540483477+((t>>>16)*59797<<16)^(65535&i)*1540483477+((i>>>16)*59797<<16);switch(r){case 3:i^=(255&e.charCodeAt(n+2))<<16;case 2:i^=(255&e.charCodeAt(n+1))<<8;case 1:i^=255&e.charCodeAt(n),i=(65535&i)*1540483477+((i>>>16)*59797<<16)}return i^=i>>>13,(((i=(65535&i)*1540483477+((i>>>16)*59797<<16))^i>>>15)>>>0).toString(36)}}),n("1gYqP",function(t,i){e(t.exports,"default",function(){return n});var n={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1}}),n("5zE8f",function(t,i){function n(e,t,i){var n="";return i.split(" ").forEach(function(i){void 0!==e[i]?t.push(e[i]+";"):n+=i+" "}),n}e(t.exports,"getRegisteredStyles",function(){return n}),e(t.exports,"insertStyles",function(){return s});var r=function(e,t,i){var n=e.key+"-"+t.name;!1===i&&void 0===e.registered[n]&&(e.registered[n]=t.styles)},s=function(e,t,i){r(e,t,i);var n=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var s=t;do e.insert(t===s?"."+n:"",s,e.sheet,!0),s=s.next;while(void 0!==s)}}}),n("fg9Sv",function(n,r){e(n.exports,"KlColorSlider",function(){return d});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("lfHl9"),h=i("11glk"),c=i("3IXu5"),u=i("1mH1z"),p=i("fohxs"),d=/*#__PURE__*/function(){function e(i){var n=this;(0,s._)(this,e),this.rootEl=(0,o.BB).el({className:"kl-color-picker",css:{position:"relative"}}),this.outputDiv=(0,o.BB).el({css:{display:"flex",alignItems:"center"}}),this.width=i.width,this.svHeight=i.svHeight,this.height=i.height,this.emitColor=i.onPick,this.onEyedropper=i.onEyedropper,this.primaryColorRGB={r:parseInt(""+i.startValue.r),g:parseInt(""+i.startValue.g),b:parseInt(""+i.startValue.b)},this.primaryColorHSV=(0,o.BB).ColorConverter.toHSV(i.startValue),this.secondaryColorRGB={r:p.ERASE_COLOR,g:p.ERASE_COLOR,b:p.ERASE_COLOR},this.secondaryColorHSV=(0,o.BB).ColorConverter._RGBtoHSV(this.secondaryColorRGB);var r=(0,o.BB).el();this.svSvg=new DOMParser().parseFromString('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><defs><linearGradient id="value" gradientTransform="rotate(90)"><stop offset="0" stop-color="#fff"/><stop offset="100%" stop-color="#000"/></linearGradient><linearGradient id="hue" gradientTransform="rotate(0)"><stop offset="0" stop-color="#fff"/><stop id="hue-stop" offset="100%" stop-color="#f00"/></linearGradient></defs><rect x="0" y="0" width="100" height="100" fill="url(\'#hue\')"/><rect x="0" y="0" width="100" height="100" fill="url(\'#value\')" style="mix-blend-mode: multiply"/></svg>',"image/svg+xml").documentElement;var a=this.svSvg.querySelector("#hue-stop");if(!a)throw Error("#hue-stop not found in svSvg");this.hueStop=a,(0,o.BB).setAttributes(this.hueStop,{"stop-color":"#f0f"}),(0,o.BB).css(this.svSvg,{width:this.width+"px",height:this.svHeight+"px"}),r.append(this.svSvg);var d=(0,o.BB).el({className:"kl-color-picker__h",css:{overflow:"hidden",position:"relative",width:this.width+"px",height:this.height+"px",cursor:"ew-resize",marginTop:"1px",marginBottom:"1px"}});this.divPreview=(0,o.BB).el({className:"kl-color-picker__preview",css:{display:"flex",justifyContent:"space-between",width:2.5*this.height+"px",height:this.height+"px"}}),this.controlH=(0,o.BB).el();var g=function(e){var t=new Image;(0,o.BB).css(t,{position:"absolute",left:"0",top:"0",display:"none",pointerEvents:"none"});for(var i=(0,o.BB).canvas(n.width,n.height),r=(0,o.BB).ctx(i),s=r.createLinearGradient(0,0,n.width,0),a=0;a<1;a+=.01){var l=(0,o.BB).ColorConverter.toRGB(new o.BB.HSV(360*a,100,100)),h=parseInt(""+l.r).toString(16),c=parseInt(""+l.g).toString(16),u=parseInt(""+l.b).toString(16);1===h.length&&(h="0"+h),1===c.length&&(c="0"+c),1===u.length&&(u="0"+u),s.addColorStop(a,"#"+h+c+u)}r.fillStyle=s,r.fillRect(0,0,n.width,n.height),e.append(t),t.alt="hue",t.src=i.toDataURL("image/png"),t.style.display="block"};this.updateSVCanvas(),this.rootEl.style.width=this.width+"px",this.rootEl.oncontextmenu=function(){return!1},this.SVContainer=(0,o.BB).el({className:"kl-color-picker__sv",css:{width:this.width+"px",height:this.svHeight+"px",overflow:"hidden",display:"block",position:"relative",cursor:"crosshair"}}),this.pointerSV=(0,o.BB).el({css:{width:"12px",height:"12px",borderRadius:"6px",position:"absolute",pointerEvents:"none",boxShadow:"0px 0px 0 1px #000, inset 0px 0px 0 1px #fff"}}),this.SVContainer.append(r,this.pointerSV),this.updateSVPointer(),this.rootEl.append(this.SVContainer,d),this.outputDiv.append(this.divPreview),(0,o.BB).css(this.controlH,{width:"2px",height:this.height+"px",background:"#000",borderLeft:"1px solid #fff",position:"absolute",top:"0",left:parseInt(""+(this.primaryColorHSV.h/360*this.width-1))+"px"});var f={h:0,s:0,v:0};this.pickerButton=(0,o.BB).el({title:(0,u.LANG)("eyedropper")+" [Alt]",className:"color-picker-preview-button",css:{width:"30px",height:"30px",backgroundImage:"url("+/*@__PURE__*/t(c)+")",backgroundRepeat:"no-repeat",backgroundSize:"70%",backgroundPosition:"center"},onClick:function(){n.isPicking?n.pickingDone():(n.pickerButton.classList.remove("color-picker-preview-button-hover"),n.pickerButton.classList.add("color-picker-preview-button-active"),n.isPicking=!0,n.onEyedropper(!0))}}),this.isPicking=!1,new o.BB.PointerListener({target:this.pickerButton,onEnterLeave:function(e){n.isPicking||n.pickerButton.classList.toggle("color-picker-preview-button-hover",e)}}),this.divPreview.append(this.pickerButton),this.hexButton=(0,o.BB).el({content:"#",className:"color-picker-preview-button",title:(0,u.LANG)("manual-color-input"),css:{height:"100%",width:this.height+"px",lineHeight:this.height+"px",fontSize:.65*this.height+"px"},onClick:function(){new l.HexColorDialog({color:new o.BB.RGB(n.primaryColorRGB.r,n.primaryColorRGB.g,n.primaryColorRGB.b),onClose:function(e){e&&(n.setColor(e),n.emitColor(new o.BB.RGB(n.primaryColorRGB.r,n.primaryColorRGB.g,n.primaryColorRGB.b)))}})}}),new o.BB.PointerListener({target:this.hexButton,onEnterLeave:function(e){n.hexButton.classList.toggle("color-picker-preview-button-hover",e)}}),this.divPreview.append(this.hexButton),this.setColPreview(),setTimeout(function(){g(d),d.append(n.controlH),new o.BB.PointerListener({target:r,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&((0,o.BB).unfocusAnyInput(),n.SVContainer.classList.toggle("kl-color-picker--active",!0),"left"===e.button?(f.s=e.relX/n.width*100,f.v=100-e.relY/n.svHeight*100,n.primaryColorHSV=new o.BB.HSV(n.primaryColorHSV.h,f.s,f.v),n.primaryColorRGB=(0,o.BB).ColorConverter.toRGB(n.primaryColorHSV),n.updateSVPointer(),n.setColPreview(),n.emitColor((0,o.BB).ColorConverter.toRGB(n.primaryColorHSV))):(f.s=n.primaryColorHSV.s,f.v=n.primaryColorHSV.v)),"pointermove"===e.type&&["left","right"].includes(e.button||"")){var t=1;"right"===e.button&&(t=.5),f.s+=e.dX/n.width*100*t,f.v-=e.dY/n.svHeight*100*t,n.primaryColorHSV=new o.BB.HSV(n.primaryColorHSV.h,f.s,f.v),n.primaryColorRGB=(0,o.BB).ColorConverter.toRGB(n.primaryColorHSV),n.updateSVPointer(),n.setColPreview(),n.emitColor((0,o.BB).ColorConverter.toRGB(n.primaryColorHSV))}"pointerup"===e.type&&n.SVContainer.classList.toggle("kl-color-picker--active",!1)}}),new o.BB.PointerListener({target:d,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&((0,o.BB).unfocusAnyInput(),d.classList.toggle("kl-color-picker--active",!0),"left"===e.button?(f.h=e.relX/n.width*359.99,n.primaryColorHSV=new o.BB.HSV(f.h,n.primaryColorHSV.s,n.primaryColorHSV.v),n.primaryColorRGB=(0,o.BB).ColorConverter.toRGB(n.primaryColorHSV),n.controlH.style.left=Math.round(n.primaryColorHSV.h/359.99*n.width)-1+"px",n.updateSVCanvas(),n.setColPreview(),n.emitColor((0,o.BB).ColorConverter.toRGB(n.primaryColorHSV))):f.h=n.primaryColorHSV.h),"pointermove"===e.type&&["left","right"].includes(e.button||"")){var t=Math.abs(e.pageY-e.downPageY),i=(0,h.calcSliderFalloffFactor)(t,"right"===e.button);f.h+=e.dX/n.width*359.99*i,"right"===e.button&&(f.h=f.h%359.99,f.h<0&&(f.h+=359.99)),f.h=Math.min(359.99,f.h),n.primaryColorHSV=new o.BB.HSV(f.h,n.primaryColorHSV.s,n.primaryColorHSV.v),n.primaryColorRGB=(0,o.BB).ColorConverter.toRGB(n.primaryColorHSV),n.controlH.style.left=Math.round(n.primaryColorHSV.h/359.99*n.width)-1+"px",n.updateSVCanvas(),n.setColPreview(),n.emitColor((0,o.BB).ColorConverter.toRGB(n.primaryColorHSV))}"pointerup"===e.type&&d.classList.toggle("kl-color-picker--active",!1)}})},1),this.secondaryColorBtn=(0,o.BB).el({parent:this.outputDiv,title:(0,u.LANG)("secondary-color")+" [X]",className:"kl-color-picker__secondary",css:{cursor:"pointer",marginLeft:"5px",width:"22px",height:"22px"},onClick:function(e){e.preventDefault(),n.swapColors()}}),this.updateSecondaryColor()}return(0,a._)(e,[{key:"updatePrimaryHSV",value:function(e){0===e.s?this.primaryColorHSV=new o.BB.HSV(this.primaryColorHSV.h,e.s,e.v):this.primaryColorHSV=new o.BB.HSV(e.h,e.s,e.v)}},{key:"updateSVCanvas",value:function(){var e=(0,o.BB).ColorConverter.toRGB(new o.BB.HSV(this.primaryColorHSV.h,100,100));(0,o.BB).setAttributes(this.hueStop,{"stop-color":"#"+(0,o.BB).ColorConverter.toHexString(e)})}},{key:"updateSVPointer",value:function(){var e=this.primaryColorHSV.s/100*this.width-7,t=(1-this.primaryColorHSV.v/100)*this.svHeight-6;(0,o.BB).css(this.pointerSV,{left:e+"px",top:t+"px"})}},{key:"setColPreview",value:function(){this.divPreview.style.backgroundColor="rgb("+this.primaryColorRGB.r+","+this.primaryColorRGB.g+","+this.primaryColorRGB.b+")",(0,o.BB).testIsWhiteBestContrast(this.primaryColorRGB)?((0,o.BB).css(this.pickerButton,{filter:"invert(1)"}),(0,o.BB).css(this.hexButton,{filter:"invert(1)"})):((0,o.BB).css(this.pickerButton,{filter:""}),(0,o.BB).css(this.hexButton,{filter:""}))}},{key:"updateSecondaryColor",value:function(){this.secondaryColorBtn.style.backgroundColor=(0,o.BB).ColorConverter.toRgbStr(this.secondaryColorRGB)}},{key:"setColor",value:function(e){this.primaryColorRGB={r:parseInt(""+e.r),g:parseInt(""+e.g),b:parseInt(""+e.b)},this.updatePrimaryHSV((0,o.BB).ColorConverter.toHSV(e)),this.controlH.style.left=parseInt(""+(this.primaryColorHSV.h/359*this.width-1))+"px",this.updateSVCanvas(),this.updateSVPointer(),this.setColPreview()}},{key:"getColor",value:function(){return new o.BB.RGB(this.primaryColorRGB.r,this.primaryColorRGB.g,this.primaryColorRGB.b)}},{key:"getSecondaryRGB",value:function(){return new o.BB.RGB(this.secondaryColorRGB.r,this.secondaryColorRGB.g,this.secondaryColorRGB.b)}},{key:"getIsPicking",value:function(){return this.isPicking}},{key:"pickingDone",value:function(){this.isPicking&&(this.isPicking=!1,this.onEyedropper(!1),this.pickerButton.classList.remove("color-picker-preview-button-active"))}},{key:"enable",value:function(e){e?(this.rootEl.style.pointerEvents="",this.rootEl.style.opacity="1",this.outputDiv.style.pointerEvents="",this.outputDiv.style.opacity="1"):(this.rootEl.style.pointerEvents="none",this.rootEl.style.opacity="0.5",this.outputDiv.style.pointerEvents="none",this.outputDiv.style.opacity="0.5")}},{key:"setHeight",value:function(e){(e=parseInt(""+(e-2*this.height-3),10))!==this.svHeight&&(this.svHeight=e,(0,o.BB).css(this.svSvg,{width:this.width+"px",height:this.svHeight+"px"}),this.SVContainer.style.height=this.svHeight+"px",this.updateSVPointer())}},{key:"swapColors",value:function(){var e=this.secondaryColorHSV;this.secondaryColorHSV=this.primaryColorHSV,this.updatePrimaryHSV(e),e=this.secondaryColorRGB,this.secondaryColorRGB=this.primaryColorRGB,this.primaryColorRGB=e,this.controlH.style.left=parseInt(""+(this.primaryColorHSV.h/359*this.width-1))+"px",this.updateSVCanvas(),this.updateSVPointer(),this.setColPreview(),this.updateSecondaryColor(),this.emitColor(new o.BB.RGB(this.primaryColorRGB.r,this.primaryColorRGB.g,this.primaryColorRGB.b))}},{key:"getElement",value:function(){return this.rootEl}},{key:"getOutputElement",value:function(){return this.outputDiv}}]),e}()}),n("3IXu5",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"tool-picker.d0e69c3a.svg"}),n("fohxs",function(t,n){e(t.exports,"ERASE_COLOR",function(){return r});var r=((0,i("1C8RU").theme).isDark(),255)}),n("gmji4",function(t,n){e(t.exports,"KlColorSliderSmall",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("11glk"),l=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.rootEl=(0,a.BB).el({css:{width:t.width+"px",position:"relative",overflow:"hidden",userSelect:"none"}}),this.rootEl.oncontextmenu=function(e){e.preventDefault()},this.color=(0,a.BB).ColorConverter.toHSV(new a.BB.RGB(t.color.r,t.color.g,t.color.b)),this.width=t.width,this.heightSV=t.heightSV,this.canvasSV=(0,a.BB).canvas(10,10),(0,a.BB).css(this.canvasSV,{width:this.width+"px",height:this.heightSV+"px",cursor:"crosshair"}),this.updateSV();var n=(0,a.BB).canvas(t.width,t.heightH);n.style.cursor="ew-resize",function(){for(var e=(0,a.BB).ctx(n),i=e.createLinearGradient(0,0,t.width,0),r=0;r<1;r+=.01){var s=(0,a.BB).ColorConverter.toRGB(new a.BB.HSV(360*r,100,100));i.addColorStop(r,"rgba("+parseInt(""+s.r)+", "+parseInt(""+s.g)+", "+parseInt(""+s.b)+", 1)")}e.fillStyle=i,e.fillRect(0,0,t.width,t.heightH)}(),(0,a.BB).css(this.canvasSV,{width:t.width+"px",height:t.heightSV+"px",overflow:"hidden",position:"relative"}),this.canvasSV.style.cssFloat="left",n.style.cssFloat="left",this.rootEl.append(this.canvasSV,n),this.pointerSV=(0,a.BB).el({parent:this.rootEl,css:{width:"8px",height:"8px",borderRadius:"8px",position:"absolute",pointerEvents:"none",boxShadow:"0 0 0 1px #000, inset 0 0 0 1px #fff"}}),this.pointerH=(0,a.BB).el({parent:this.rootEl,css:{width:"0",height:t.heightH+"px",borderLeft:"1px solid #fff",borderRight:"1px solid #000",position:"absolute",top:t.heightSV+"px",pointerEvents:"none"}}),this.updateSVPointer(),this.updateHPointer();var s={h:0,s:0,v:0};this.svPointerId=null,this.svPointerListener=new a.BB.PointerListener({target:this.canvasSV,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&((0,a.BB).unfocusAnyInput(),i.svPointerId=e.pointerId,"left"===e.button?(s.s=e.relX/t.width*100,s.v=100-e.relY/t.heightSV*100,i.color=new a.BB.HSV(i.color.h,s.s,s.v),i.updateSVPointer(),t.callback((0,a.BB).ColorConverter.toRGB(i.color))):(s.s=i.color.s,s.v=i.color.v)),"pointermove"===e.type&&["left","right"].includes(""+e.button)&&i.svPointerId===e.pointerId){var n=1;"right"===e.button&&(n=.5),s.s+=e.dX/t.width*100*n,s.v-=e.dY/t.heightSV*100*n,i.color=new a.BB.HSV(i.color.h,s.s,s.v),i.updateSVPointer(),t.callback((0,a.BB).ColorConverter.toRGB(i.color))}"pointerup"===e.type&&(i.svPointerId=null)}}),this.hPointerId=null,this.hPointerListener=new a.BB.PointerListener({target:n,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&(i.hPointerId=e.pointerId,"left"===e.button?(s.h=e.relX/t.width*359.99,i.color=new a.BB.HSV(s.h,i.color.s,i.color.v),i.updateSV(),i.updateHPointer(),t.callback((0,a.BB).ColorConverter.toRGB(i.color))):s.h=i.color.h),"pointermove"===e.type&&["left","right"].includes(""+e.button)&&i.hPointerId===e.pointerId){var n=Math.abs(e.pageY-e.downPageY),r=(0,o.calcSliderFalloffFactor)(n,"right"===e.button);s.h+=e.dX/t.width*359.99*r,"right"===e.button&&(s.h=s.h%359.99,s.h<0&&(s.h+=359.99)),s.h=Math.min(359.99,s.h),i.color=new a.BB.HSV(s.h,i.color.s,i.color.v),i.updateSV(),i.updateHPointer(),t.callback((0,a.BB).ColorConverter.toRGB(i.color))}"pointerup"===e.type&&(i.hPointerId=null)}}),(0,a.BB).el({parent:this.rootEl,css:{clear:"both"}})}return(0,s._)(e,[{key:"updateSV",value:function(){var e=(0,a.BB).ctx(this.canvasSV);if(!e)throw Error("couldnt create canvas");for(var t=0;t<this.canvasSV.height;t+=1){var i=e.createLinearGradient(0,0,this.canvasSV.width,0),n=(0,a.BB).ColorConverter.toRGB(new a.BB.HSV(this.color.h,1,100-t/this.canvasSV.height*100)),r=(0,a.BB).ColorConverter.toRGB(new a.BB.HSV(this.color.h,100,100-t/this.canvasSV.height*100));i.addColorStop(0,"#"+(0,a.BB).ColorConverter.toHexString(n)),i.addColorStop(1,"#"+(0,a.BB).ColorConverter.toHexString(r)),e.fillStyle="#ff0000",e.fillStyle=i,e.fillRect(0,t,this.canvasSV.width,1)}}},{key:"updateSVPointer",value:function(){var e=this.color.s/100*this.width-4,t=(1-this.color.v/100)*this.heightSV-4;(0,a.BB).css(this.pointerSV,{left:e+"px",top:t+"px"})}},{key:"updateHPointer",value:function(){this.pointerH.style.left=this.color.h/359.999*this.width-1+"px"}},{key:"setColor",value:function(e){this.color=(0,a.BB).ColorConverter.toHSV(new a.BB.RGB(e.r,e.g,e.b)),this.updateSV(),this.updateSVPointer(),this.updateHPointer()}},{key:"getColor",value:function(){return(0,a.BB).ColorConverter.toRGB(this.color)}},{key:"getElement",value:function(){return this.rootEl}},{key:"end",value:function(){this.svPointerId=null,this.hPointerId=null}},{key:"destroy",value:function(){this.svPointerListener.destroy(),this.hPointerListener.destroy()}}]),e}()}),n("j5jvd",function(t,n){e(t.exports,"PointSlider",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=/*#__PURE__*/function(){function e(t){var i,n,s,o=this;(0,r._)(this,e),this.rootEl=(0,a.BB).el({css:{position:"relative"}}),(0,a.BB).el({parent:this.rootEl,className:"kl-point-slider__line",css:{marginTop:parseInt(""+(t.pointSize/2-1))+"px",width:t.width+"px"}}),this.sliderPoint=(0,a.BB).el({parent:this.rootEl,className:"kl-point-slider__point"}),(0,a.BB).el({parent:this.sliderPoint,css:{margin:"-7px 0 0 -7px",width:"calc(100% + 14px)",height:"calc(100% + 7px)"}});var l=function(){(0,a.BB).css(o.sliderPoint,{left:i+"px"})},h=function(){return i/(t.width-t.pointSize)};i=(0,a.BB).clamp(t.init*(t.width-t.pointSize),0,t.width-t.pointSize),(0,a.BB).css(this.sliderPoint,{width:t.pointSize+"px",height:t.pointSize+"px",borderRadius:t.pointSize+"px"}),l(),this.pointerListener=new a.BB.PointerListener({target:this.sliderPoint,fixScribble:!0,onPointer:function(e){"pointerdown"===e.type&&"left"===e.button?(n=!0,s=i,l(),e.eventStopPropagation()):"pointermove"===e.type&&"left"===e.button&&(e.eventStopPropagation(),s+=e.dX,i=parseInt(""+(0,a.BB).clamp(s,0,t.width-t.pointSize)),l(),t.callback(h(),n,!1),n=!1),"pointerup"===e.type&&(e.eventStopPropagation(),l(),t.callback(h(),!1,!0))}})}return(0,s._)(e,[{key:"getEl",value:function(){return this.rootEl}},{key:"setActive",value:function(e){this.sliderPoint.style.backgroundColor=e?"#fff":"#eaeaea"}},{key:"destroy",value:function(){this.pointerListener.destroy()}}]),e}()}),n("43qNf",function(t,n){e(t.exports,"ColorOptions",function(){return p});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("4EWN2"),l=i("eWjiX"),h=i("1C8RU"),c=i("dJ1E2"),u=i("amum4"),p=/*#__PURE__*/function(){function e(t){var i,n=this;(0,r._)(this,e),this.colorArr=[],this.selectedIndex=0,this.rootEl=(0,l.BB).el({content:t.label?t.label:"",title:null!==(i=t.title)&&void 0!==i?i:void 0,css:{display:"flex",alignItems:"center",gap:"7px",position:"relative"}}),this.buttonArr=[];var s=(0,l.BB).createCheckerDataUrl(5,void 0,(0,h.theme).isDark());this.onColorInputChange=function(){var e=n.selectedIndex,i=n.colorArr[e];if(i&&!(i.a<1)){var r=n.colorInput.value;n.buttonArr[n.selectedIndex].el.style.backgroundColor=r,n.colorArr[e]=(0,o._)((0,a._)({},(0,c.ColorConverter).hexToRGB(r)),{a:1}),t.onChange(n.colorArr[e])}},this.colorInput=(0,l.BB).el({tagName:"input",custom:{type:"color",tabIndex:"-1"}}),this.colorInput.onchange=this.onColorInputChange,this.colorInput.oninput=this.onColorInputChange;for(var p=0;p<t.colorArr.length;p++){for(var d=t.colorArr[p],g=!1,f=0;f<this.colorArr.length;f++){var v=this.colorArr[f];if(v===d||null!==v&&null!==d&&v.r===d.r&&v.g===d.g&&v.b===d.b&&v.a===d.a){g=!0;break}}!g&&(this.colorArr.push(d),"initialIndex"in t&&t.initialIndex===p&&(this.selectedIndex=this.colorArr.length-1))}for(var m=0;m<this.colorArr.length;m++)!function(e){var i=n.colorArr[e],r=(0,l.BB).el({parent:n.rootEl,content:i?"":"X",className:"kl-color-option",css:{width:"22px",height:"22px",backgroundColor:i?(0,l.BB).ColorConverter.toRgbaStr(i):"transparent",lineHeight:"23px"},onClick:function(r){if(n.selectedIndex===e){i&&1===i.a&&(n.colorInput.showPicker?n.colorInput.showPicker():n.colorInput.click());return}r.preventDefault(),n.selectedIndex=e,y(),t.onChange(n.colorArr[e])}});i&&0===i.a&&(r.style.backgroundImage="url("+s+")");var a=function(e){r.classList.toggle("kl-color-option--active",e)};n.buttonArr.push({el:r,setIsSelected:a})}(m);this.rootEl.append((0,u.c)(",w-0,h-0,overflow-hidden,abs-0-0",[this.colorInput]));var y=function(){for(var e=0;e<n.buttonArr.length;e++)n.buttonArr[e].setIsSelected(e===n.selectedIndex)};y(),this.updateCheckerboard=function(){var e=(0,l.BB).createCheckerDataUrl(5,void 0,(0,h.theme).isDark());n.buttonArr.forEach(function(t,i){var r=n.colorArr[i];r&&0===r.a&&(t.el.style.backgroundImage="url("+e+")")})},(0,h.theme).addIsDarkListener(this.updateCheckerboard)}return(0,s._)(e,[{key:"getElement",value:function(){return this.rootEl}},{key:"getValue",value:function(){return this.colorArr[this.selectedIndex]}},{key:"destroy",value:function(){this.rootEl.remove(),this.buttonArr.forEach(function(e){(0,l.BB).destroyEl(e.el)}),this.buttonArr.splice(0,this.buttonArr.length),(0,h.theme).removeIsDarkListener(this.updateCheckerboard),this.colorInput.onchange=null,this.colorInput.oninput=null}}]),e}()}),n("iFIyy",function(t,n){e(t.exports,"Options",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.rootEl=(0,a.BB).el();var n=(0,a.BB).el({parent:this.rootEl,className:"kl-option-wrapper",css:{display:"flex"}});t.onChange&&(this.onChange=t.onChange),this.optionArr=[],this.selectedId="initialId"in t&&void 0!==t.initId?t.initId:t.optionArr[0].id;for(var s=0;s<t.optionArr.length;s++)!function(e){var r=["kl-option"];t.isSmall&&r.push("kl-option--small"),"string"!=typeof e.label&&(r.push("kl-option--custom-el"),(0,a.BB).css(e.label,{display:"block",pointerEvents:"none"}));var s={id:e.id,el:(0,a.BB).el({parent:n,content:e.label,className:r.join(" "),onClick:function(){i.selectedId!==s.id&&(!t.onBeforeChange||t.onBeforeChange(s.id))&&(i.selectedId=s.id,i.update(),i.onChange&&i.onChange(i.selectedId))},css:t.optionCss})};e.title&&(s.el.title=e.title),i.optionArr.push(s)}(t.optionArr[s]);this.update(),t.changeOnInit&&setTimeout(function(){i.onChange&&i.onChange(i.selectedId)},0)}return(0,s._)(e,[{key:"getIndex",value:function(){for(var e=0;e<this.optionArr.length;e++)if(this.optionArr[e].id===this.selectedId)return e;return -1}},{key:"update",value:function(){for(var e=0;e<this.optionArr.length;e++)this.optionArr[e].el.classList.toggle("kl-option-selected",this.optionArr[e].id===this.selectedId)}},{key:"getElement",value:function(){return this.rootEl}},{key:"getValue",value:function(){return this.selectedId}},{key:"next",value:function(){this.selectedId=this.optionArr[(this.getIndex()+1)%this.optionArr.length].id,this.update(),this.onChange&&this.onChange(this.selectedId)}},{key:"setValue",value:function(e){this.selectedId!==e&&(this.selectedId=e,this.update(),this.onChange&&this.onChange(this.selectedId))}},{key:"previous",value:function(){this.selectedId=this.optionArr[(this.optionArr.length+this.getIndex()-1)%this.optionArr.length].id,this.update(),this.onChange&&this.onChange(this.selectedId)}},{key:"destroy",value:function(){this.rootEl.remove(),this.optionArr.forEach(function(e){(0,a.BB).destroyEl(e.el)}),this.optionArr.splice(0,this.optionArr.length)}}]),e}()}),n("bmB93",function(n,r){e(n.exports,"StatusOverlay",function(){return h});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("9651N"),h=/*#__PURE__*/function(){function e(){(0,s._)(this,e),this.isWide=!1,this.uiState="right",this.el=(0,o.BB).el({className:"top-overlay g-root",onClick:o.BB.handleClick}),this.updateUiState(),this.innerEl=(0,o.BB).el({className:"top-overlay--inner"}),this.angleIm=new Image,this.angleIm.src=/*@__PURE__*/t(l),(0,o.BB).css(this.angleIm,{verticalAlign:"bottom",width:"20px",height:"20px",marginLeft:"5px",borderRadius:"10px"}),this.innerInnerEl=document.createElement("div"),this.innerInnerEl.style.display="inline-block",this.innerEl.append(this.innerInnerEl,this.angleIm),this.el.append(this.innerEl),document.body.append(this.el),this.el.style.display="none"}return(0,a._)(e,[{key:"updateUiState",value:function(){"left"===this.uiState?this.el.style.left="271px":this.el.style.removeProperty("left")}},{key:"setWide",value:function(e){this.isWide=e,this.el&&(this.isWide?(this.el.style.width="100%",this.el.style.left=""):(this.el.style.removeProperty("width"),this.el.style.left="left"===this.uiState?"271px":""))}},{key:"setUiState",value:function(e){this.uiState=e,this.updateUiState()}},{key:"out",value:function(e,t){var i=this;"string"==typeof e?(this.angleIm.style.display="none",this.innerInnerEl.style.removeProperty("font-family"),this.innerInnerEl.innerHTML=e):"transform"===e.type?(this.angleIm.style.display="inline-block",this.angleIm.style.transform="rotate("+e.angleDeg+"deg)",e.angleDeg%90==0?this.angleIm.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.7)":this.angleIm.style.boxShadow="",this.innerInnerEl.style.fontFamily="monospace",this.innerInnerEl.innerHTML=Math.round(100*e.scale)+"%"):this.angleIm.style.display="none",t&&(this.innerEl.style.animation="",setTimeout(function(){return i.innerEl.style.animation="topOverlayPulse 0.5s ease-out"},20),clearTimeout(this.timeout3),this.timeout3=setTimeout(function(){return i.innerEl.style.animation=""},520)),clearTimeout(this.timeout),clearTimeout(this.timeout2),this.el.style.animationName=t?"consoleInFast":"consoleIn",this.el.style.opacity="1",this.timeout=setTimeout(function(){i.el.style.opacity="0",i.el.style.animationName="consoleOut",i.timeout2=setTimeout(function(){i.el.style.display="none"},450)},1200),this.el.style.display="flex"}}]),e}()}),n("9651N",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"angle.f0b557ac.svg"}),n("hRdOL",function(n,r){e(n.exports,"CropCopy",function(){return m});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("jpkXO");i("ciAU9");var h=i("cdZRx"),c=i("kDVZW"),u=i("1GsyD"),p=i("eg83P"),d=i("1mH1z"),g=i("l6zI1"),f=i("gCzYB"),v=i("635F6"),m=/*#__PURE__*/function(){function e(i){var n,r,a=this;(0,s._)(this,e),this.crop={x:0,y:0,width:0,height:0},this.mode="edit",this.rootEl=(0,o.BB).el({className:"kl-edit-crop-preview",css:{position:"relative",height:i.height+"px",width:i.width+"px",overflow:"hidden"}}),i.onChange&&(this.onChange=i.onChange),this.canvas=i.canvas,this.resetCrop(),this.croppedCanvas=(0,o.BB).canvas(),this.eventTarget=this.croppedCanvas,i.isNotCopy||(this.croppedImage=new Image,this.eventTarget=this.croppedImage),(0,o.BB).css(this.eventTarget,{height:i.height+"px",width:i.width+"px"}),this.rootEl.append(this.eventTarget),this.updateCroppedCanvas(),this.preview=new l.Preview({width:i.width,height:i.height-2,project:{width:i.canvas.width,height:i.canvas.height,layers:[{image:i.canvas,opacity:1,isVisible:!0,mixModeStr:"source-over",hasClipping:!1}]},hasEditMode:!0,onModeChange:function(e){a.mode=e,a.preview.getElement().style.pointerEvents="edit"===e?"none":"",a.rootEl.title="edit"===e?(0,d.LANG)("crop-drag-to-crop"):""},onTransformChange:function(){return a.updateSelectionRect()},padding:20,hasBorder:!1,editIcon:/*@__PURE__*/t(g)}),(0,o.BB).css(this.preview.getElement(),{position:"absolute",left:"0",top:"0",overflow:"hidden",pointerEvents:"none"}),this.preview.render(),this.rootEl.append(this.preview.getElement()),this.selectionRectEl=(0,o.BB).el({parent:this.preview.getElement(),className:"kl-edit-crop-preview__sel"}),this.updateSelectionRect();var m=function(e,t){var i=(0,u.createMatrixFromTransform)(a.preview.getTransform()),n=(0,c.inverse)(i),r={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)},s={x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)},o=(0,h.applyToPoint)(n,r),l=(0,h.applyToPoint)(n,s);return o.x=(0,p.clamp)(Math.floor(o.x),0,a.canvas.width),o.y=(0,p.clamp)(Math.floor(o.y),0,a.canvas.height),l.x=(0,p.clamp)(Math.ceil(l.x),0,a.canvas.width),l.y=(0,p.clamp)(Math.ceil(l.y),0,a.canvas.height),{x:o.x,y:o.y,width:l.x-o.x,height:l.y-o.y}},y=null,x=!1,b=!1,B=new f.EventChain({chainArr:[new v.OnePointerLimiter]});B.setChainOut(function(e){if("pointerdown"===e.type&&"left"===e.button){var t;(e.eventPreventDefault(),x=!0,n={x:e.relX,y:e.relY},!a.isReset()&&(t=n,(0,o.BB).isInsideRect(t,a.getViewportSelectionRect())))?y={x:a.crop.x,y:a.crop.y,width:a.crop.width,height:a.crop.height}:a.crop=m(n,n)}else if("pointermove"===e.type&&"left"===e.button){if(e.eventPreventDefault(),b=!0,y){var i=a.preview.getTransform();a.crop.x=y.x+Math.round((e.relX-n.x)/i.scale),a.crop.y=y.y+Math.round((e.relY-n.y)/i.scale),a.crop.x=(0,o.BB).clamp(a.crop.x,0,a.canvas.width-a.crop.width),a.crop.y=(0,o.BB).clamp(a.crop.y,0,a.canvas.height-a.crop.height)}else a.crop=m(n,{x:e.relX,y:e.relY});a.updateSelectionRect()}else"pointerup"===e.type&&n&&(e.eventPreventDefault(),x=!1,y=null,n=null,0!==a.crop.width&&0!==a.crop.height&&b||(a.resetCrop(),a.updateSelectionRect()),b=!1,r=setTimeout(function(){return a.updateCroppedCanvas()},1))}),this.pointerListener=new o.BB.PointerListener({target:this.eventTarget,fixScribble:!0,onWheel:function(e){a.preview.onWheel(e)},onPointer:function(e){if("hand"===a.mode){e.eventPreventDefault(),a.preview.onPointer(e);return}B.chainIn(e)},maxPointers:2}),this.keyListener=new o.BB.KeyListener({onDown:function(e,t){if(!x){var i=!1,n=Math.max(1,1/a.preview.getTransform().scale),s=a.keyListener.isPressed("shift");"left"===e&&(s?a.crop.width=(0,o.BB).clamp(a.crop.width-n,1,a.canvas.width-a.crop.x):a.crop.x=(0,o.BB).clamp(a.crop.x-n,0,a.canvas.width-a.crop.width),i=!0),"right"===e&&(s?a.crop.width=(0,o.BB).clamp(a.crop.width+n,1,a.canvas.width-a.crop.x):a.crop.x=(0,o.BB).clamp(a.crop.x+n,0,a.canvas.width-a.crop.width),i=!0),"up"===e&&(s?a.crop.height=(0,o.BB).clamp(a.crop.height-n,1,a.canvas.height-a.crop.y):a.crop.y=(0,o.BB).clamp(a.crop.y-n,0,a.canvas.height-a.crop.height),i=!0),"down"===e&&(s?a.crop.height=(0,o.BB).clamp(a.crop.height+n,1,a.canvas.height-a.crop.y):a.crop.y=(0,o.BB).clamp(a.crop.y+n,0,a.canvas.height-a.crop.height),i=!0),i&&(t.preventDefault(),a.updateSelectionRect(),clearTimeout(r),r=setTimeout(function(){return a.updateCroppedCanvas()},100))}}})}return(0,a._)(e,[{key:"resetCrop",value:function(){this.crop={x:0,y:0,width:this.canvas.width,height:this.canvas.height}}},{key:"getViewportSelectionRect",value:function(){var e=this.preview.getTransform(),t=(0,u.createMatrixFromTransform)(e),i=(0,h.applyToPoint)(t,this.crop);return{x:i.x,y:i.y,width:this.crop.width*e.scale,height:this.crop.height*e.scale}}},{key:"updateCroppedCanvas",value:function(){this.croppedCanvas.width=Math.round(this.crop.width),this.croppedCanvas.height=Math.round(this.crop.height),(0,o.BB).ctx(this.croppedCanvas).drawImage(this.canvas,Math.round(-this.crop.x),Math.round(-this.crop.y)),this.croppedImage&&(this.croppedImage.src=this.croppedCanvas.toDataURL("image/png")),this.onChange&&this.onChange(this.croppedCanvas.width,this.croppedCanvas.height)}},{key:"updateSelectionRect",value:function(){var e=this.getViewportSelectionRect();(0,o.BB).css(this.selectionRectEl,{left:e.x+"px",top:e.y+"px",width:e.width+"px",height:e.height+"px",display:this.isReset()?"none":""}),this.onChange&&this.onChange(Math.round(this.crop.width),Math.round(this.crop.height))}},{key:"getEl",value:function(){return this.rootEl}},{key:"reset",value:function(){this.resetCrop(),this.updateCroppedCanvas(),this.updateSelectionRect()}},{key:"isReset",value:function(){return 0===this.crop.x&&0===this.crop.y&&this.crop.width===this.canvas.width&&this.crop.height===this.canvas.height}},{key:"getRect",value:function(){return(0,o.BB).copyObj(this.crop)}},{key:"getCroppedCanvas",value:function(){return this.croppedCanvas}},{key:"destroy",value:function(){this.rootEl.remove(),this.eventTarget.style.removeProperty("width"),this.eventTarget.style.removeProperty("height"),this.keyListener.destroy(),this.pointerListener.destroy(),this.preview.destroy()}}]),e}()}),n("jpkXO",function(n,r){e(n.exports,"Preview",function(){return P});var s=i("cx0mh"),a=i("7h4XF"),o=i("cL71g"),l=i("4EWN2"),h=i("bX4ja"),c=i("amum4"),u=i("bMICc"),p=i("eWjiX"),d=i("04lDo"),g=i("hzavh"),f=i("5LsQG"),v=i("4RrDk"),m=i("fJXlf"),y=i("43wBz"),x=i("gCzYB"),b=i("c1lmK"),B=i("jXowp"),w=i("63yUO"),k=i("joplQ"),C=i("1mH1z");i("ciAU9");var S=i("cdZRx"),E=i("kDVZW"),L=i("8G4G9"),A=i("lUrXo"),I=i("iFIyy"),T=i("1GsyD"),P=/*#__PURE__*/function(){function e(i){var n,r=this;(0,s._)(this,e),this.isReset=!0,this.doRender=!1,this.lastEmittedTransform={x:0,y:0,scale:0,angleDeg:0},this.renderLoop=function(){if(r.animationFrameId=requestAnimationFrame(r.renderLoop),r.doRender){r.doRender=!1,r.viewport.render();var e=r.viewport.getTransform();r.onTransformChange&&JSON.stringify(r.lastEmittedTransform)!==JSON.stringify(e)&&(r.onTransformChange(e),r.lastEmittedTransform=e)}},this.onWheel=function(e){var t=r.viewport.getElement().getBoundingClientRect(),i=e.pageX-t.x,n=e.pageY-t.y,s=r.viewport.getTransform().scale,a=(0,w.zoomByStep)(s,-e.deltaY/2);r.transformCanvas({type:"zoom",vX:i,vY:n,fac:a/s})},this.width=i.width,this.height=i.height,this.project=i.project,this.onTransformChange=i.onTransformChange,this.padding=null!==(n=i.padding)&&void 0!==n?n:10;var a=(0,p.BB).fitInto(this.project.width,this.project.height,this.width-2*this.padding,this.height-2*this.padding).width/this.project.width;this.viewport=new u.ProjectViewport({width:this.width,height:this.height,transform:(0,L.createTransform)({x:this.width/2,y:this.height/2},{x:this.project.width/2,y:this.project.height/2},a,0),project:this.project,useNativeResolution:!1,drawBackground:!0});var o=new b.DoubleTapper({onDoubleTap:function(e){var t=(0,T.createMatrixFromTransform)(r.viewport.getTransform()),i=(0,S.applyToPoint)(t,{x:0,y:0}),n=(0,S.applyToPoint)(t,{x:r.project.width,y:r.project.height}),s=(0,p.BB).isInsideRect({x:e.relX,y:e.relY},{x:i.x,y:i.y,width:n.x-i.x,height:n.y-i.y});(!r.isReset||s)&&r.resetOrZoom(e.relX,e.relY)},isInstant:!0}),l=void 0,E=new k.PinchZoomer({onPinch:function(e){if("move"===e.type){l||(l=r.viewport.getTransform());var t=(0,A.toMetaTransform)(l,{x:e.downRelX,y:e.downRelY});t.scale*=e.scale,t.viewportP.x+=e.relX-e.downRelX,t.viewportP.y+=e.relY-e.downRelY,r.viewport.setTransform((0,L.createTransform)(t.viewportP,t.canvasP,t.scale,t.angleDeg)),r.requestRerender(),r.isReset=!1}else"end"===e.type&&(l=void 0)}});this.pointerChain=new x.EventChain({chainArr:[E,o]}),this.pointerChain.setChainOut(function(e){e.button&&["left","middle"].includes(e.button)&&r.transformCanvas({type:"translate",x:e.dX,y:e.dY})}),this.viewport.getElement().classList.add((0,B.css)({cursor:"grab",":active":{cursor:"grabbing"}})),(0,p.BB).css(this.viewport.getElement(),{userSelect:"none",touchAction:"none"}),this.viewport.getElement().addEventListener("touchend",function(e){return e.preventDefault(),!1}),this.viewport.getElement().addEventListener("contextmenu",function(e){return e.preventDefault(),!1}),this.viewport.getElement().addEventListener("dragstart",function(e){return e.preventDefault(),!1}),this.viewportPointerListener=new d.PointerListener({target:this.viewport.getElement(),onPointer:function(e){r.pointerChain.chainIn(e)},onWheel:this.onWheel,maxPointers:2}),this.viewport.getElement().addEventListener("wheel",function(e){e.preventDefault()}),i.hasEditMode&&(this.modeToggle=new I.Options({optionArr:["edit","hand"].map(function(e){var n,r=(0,p.BB).el({className:"dark-invert",css:{width:"28px",height:"28px",backgroundSize:"contain",margin:"5px",backgroundImage:`url(${"edit"===e?null!==(n=i.editIcon)&&void 0!==n?n:/*@__PURE__*/t(y):/*@__PURE__*/t(m)})`,backgroundPosition:"center",backgroundRepeat:"no-repeat"}});return{id:e,label:r,title:"edit"===e?(0,C.LANG)("tab-edit"):(0,C.LANG)("tool-hand")}}),initId:"edit",onChange:function(e){i.onModeChange&&i.onModeChange(e)}}));var P=(0,B.css)(!1===i.hasBorder?{}:{borderTop:"1px solid #7f7f7f",borderBottom:"1px solid #7f7f7f",".kl-theme-dark &":{borderTop:"1px solid #636363",borderBottom:"1px solid #636363"}});this.rootEl=(0,c.c)({className:P,css:{position:"relative"}},[this.viewport.getElement()].concat((0,h._)(this.modeToggle?[(0,c.c)(",pos-absolute,left-5,top-5,z-1,pointer-auto",[this.modeToggle.getElement()])]:[]),[(0,c.c)(",pos-absolute,right-5,bottom-5,flex,flexCol,gap-5,z-1,pointer-auto",[(0,c.c)({tagName:"button",title:(0,C.LANG)("hand-reset"),onClick:function(){r.reset()},content:`<img alt="reset" height="20" src="${/*@__PURE__*/t(v)}">`,noRef:!0}),(0,c.c)({tagName:"button",title:(0,C.LANG)("zoom-in"),onClick:function(){var e=r.viewport.getTransform().scale,t=(0,w.zoomByStep)(e,1);r.transformCanvas({type:"zoom",fac:t/e})},content:`<img alt="zoom-in" height="20" src="${/*@__PURE__*/t(g)}">`,noRef:!0}),(0,c.c)({tagName:"button",title:(0,C.LANG)("zoom-out"),onClick:function(){var e=r.viewport.getTransform().scale,t=(0,w.zoomByStep)(e,-1);r.transformCanvas({type:"zoom",fac:t/e})},content:`<img alt="zoom-out" height="20" src="${/*@__PURE__*/t(f)}">`,noRef:!0})])])),this.renderLoop()}return(0,a._)(e,[{key:"requestRerender",value:function(){this.doRender=!0}},{key:"resetOrZoom",value:function(e,t){if(this.isReset){this.isReset=!1;var i=(0,S.applyToPoint)((0,E.inverse)((0,T.createMatrixFromTransform)(this.viewport.getTransform())),{x:e,y:t});this.viewport.setTransform((0,L.createTransform)({x:this.width/2,y:this.height/2},i,1,0)),this.requestRerender()}else this.reset()}},{key:"reset",value:function(){var e=(0,p.BB).fitInto(this.project.width,this.project.height,this.width-2*this.padding,this.height-2*this.padding).width/this.project.width;this.viewport.setTransform((0,L.createTransform)({x:this.width/2,y:this.height/2},{x:this.project.width/2,y:this.project.height/2},e,0)),this.isReset=!0,this.requestRerender()}},{key:"transformCanvas",value:function(e){if("translate"===e.type){var t=this.viewport.getTransform();if(0===e.x&&0===e.y)return;this.viewport.setTransform((0,l._)((0,o._)({},t),{x:t.x+e.x,y:t.y+e.y}))}else if("zoom"===e.type){var i,n,r=this.viewport.getTransform(),s=this.viewport.getElement().getBoundingClientRect();e.vX=null!==(i=e.vX)&&void 0!==i?i:s.width/2,e.vY=null!==(n=e.vY)&&void 0!==n?n:s.height/2;var a=(0,A.toMetaTransform)(r,{x:e.vX,y:e.vY});a.scale*=e.fac,this.viewport.setTransform((0,L.createTransform)(a.viewportP,a.canvasP,a.scale,a.angleDeg))}this.isReset=!1,this.requestRerender()}},{key:"render",value:function(){this.requestRerender()}},{key:"setTransform",value:function(e){this.viewport.setTransform(e),this.requestRerender(),this.isReset=!1}},{key:"getTransform",value:function(){return this.viewport.getTransform()}},{key:"onPointer",value:function(e){this.pointerChain.chainIn(e)}},{key:"getElement",value:function(){return this.rootEl}},{key:"destroy",value:function(){void 0!==this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.viewport.destroy(),this.viewportPointerListener.destroy(),this.rootEl.remove(),this.modeToggle&&this.modeToggle.destroy()}}]),e}()}),n("bMICc",function(t,n){e(t.exports,"ProjectViewport",function(){return m});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("4EWN2"),l=i("bX4ja"),h=i("eWjiX"),c=i("7jh4K"),u=i("1C8RU");i("ciAU9");var p=i("dZ59l"),d=i("kDVZW"),g=i("1GsyD"),f=i("fzzhO");function v(e,t){return Math.round(t*e)/t}var m=/*#__PURE__*/function(){function e(t){var i,n=this;(0,r._)(this,e),this.doResize=!0,this.onIsDark=function(){n.pattern=(0,c.throwIfNull)(n.ctx.createPattern((0,h.BB).createCheckerCanvas(10,(0,u.theme).isDark()),"repeat")),n.render()},this.oldDPR=devicePixelRatio,this.resizeListener=function(){devicePixelRatio!==n.oldDPR&&(n.canvas.style.imageRendering=Math.round(devicePixelRatio)!==devicePixelRatio?"":"pixelated",n.oldDPR=devicePixelRatio)},this.width=t.width,this.height=t.height,this.project=t.project,this.useNativeResolution=!!t.useNativeResolution,this.drawBackground=null===(i=t.drawBackground)||void 0===i||i,this.doFillParent=!!t.fillParent,this.renderAfter=t.renderAfter,this.transform=(0,a._)({},t.transform),this.resFactor=this.useNativeResolution?devicePixelRatio:1,this.canvas=(0,h.BB).canvas(this.width*this.resFactor,this.height*this.resFactor),this.ctx=(0,h.BB).ctx(this.canvas),(0,h.BB).css(this.canvas,{width:this.doFillParent?"100%":this.width+"px",height:this.doFillParent?"100%":this.height+"px",imageRendering:Math.round(devicePixelRatio)!==devicePixelRatio?void 0:"pixelated",display:"block"}),window.addEventListener("resize",this.resizeListener),this.pattern=(0,c.throwIfNull)(this.ctx.createPattern((0,h.BB).createCheckerCanvas(10,(0,u.theme).isDark()),"repeat")),(0,u.theme).addIsDarkListener(this.onIsDark)}return(0,s._)(e,[{key:"render",value:function(){var e,t=this,i=(0,u.theme).isDark(),n=(0,o._)((0,a._)({},this.transform),{x:this.transform.x,y:this.transform.y,scale:this.transform.scale});this.doResize&&(this.doResize=!1,this.resFactor=this.useNativeResolution?devicePixelRatio:1,this.canvas.width=Math.round(this.width*this.resFactor),this.canvas.height=Math.round(this.height*this.resFactor));var r={x:Math.round(n.x),y:Math.round(n.y),scaleX:v(n.scale,this.project.width),scaleY:v(n.scale,this.project.height),angleDeg:n.angleDeg},s=(0,g.createMatrixFromTransform)(r);if(this.ctx.save(),r.scaleX>=4||1===r.scaleX&&0===r.angleDeg?this.ctx.imageSmoothingEnabled=!1:(this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="low"),this.drawBackground?(this.ctx.fillStyle=i?"rgb(33, 33, 33)":"rgb(158,158,158)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)):(this.ctx.fillStyle=this.pattern,this.ctx.fillRect(0,0,this.width,this.height)),this.ctx.translate(r.x,r.y),this.ctx.scale(r.scaleX,r.scaleY),this.ctx.rotate(r.angleDeg/180*Math.PI),this.drawBackground){this.ctx.save(),this.ctx.fillStyle=(0,u.theme).isDark()?"rgba(255,255,255,0.25)":"rgba(0,0,0,0.2)";var h=1/r.scaleX,c=1/r.scaleY;this.ctx.fillRect(-h,-c,this.project.width+2*h,this.project.height+2*c),this.ctx.fillStyle=this.pattern;try{this.pattern.setTransform((0,d.inverse)(s))}catch(e){}this.ctx.fillRect(0,0,this.project.width,this.project.height),this.ctx.restore()}this.project.layers.forEach(function(e){if(e.isVisible&&e.opacity){t.ctx.save(),t.ctx.globalCompositeOperation=e.mixModeStr,t.ctx.globalAlpha=e.opacity;var i={};if("function"==typeof e.image){var n,a=e.image(r,t.canvas.width,t.canvas.height);"image"in a&&"transform"in a?(i=a.image,(n=t.ctx).setTransform.apply(n,(0,l._)((0,f.matrixToTuple)((0,p.compose)(s,a.transform))))):i=a}else i=e.image;t.ctx.drawImage(i,0,0),t.ctx.restore()}}),null===(e=this.renderAfter)||void 0===e||e.call(this,this.ctx,r),this.ctx.restore()}},{key:"setSize",value:function(e,t){this.doResize=!0,this.width=e,this.height=t,(0,h.BB).css(this.canvas,{width:this.doFillParent?"100%":this.width+"px",height:this.doFillParent?"100%":this.height+"px"})}},{key:"setTransform",value:function(e){this.transform=(0,a._)({},e)}},{key:"setProject",value:function(e){this.project=e}},{key:"getTransform",value:function(){return(0,a._)({},this.transform)}},{key:"setUseNativeResolution",value:function(e){this.useNativeResolution=e,this.doResize=!0}},{key:"getUseNativeResolution",value:function(){return this.useNativeResolution}},{key:"getElement",value:function(){return this.canvas}},{key:"destroy",value:function(){(0,h.BB).freeCanvas(this.canvas),(0,u.theme).removeIsDarkListener(this.onIsDark),window.removeEventListener("resize",this.resizeListener)}}]),e}()}),n("ciAU9",function(t,n){e(t.exports,"applyToPoint",function(){return i("cdZRx").applyToPoint}),e(t.exports,"fromObject",function(){return i("3wE7v").fromObject}),e(t.exports,"identity",function(){return i("83Kse").identity}),e(t.exports,"inverse",function(){return i("kDVZW").inverse}),e(t.exports,"rotate",function(){return i("1RMPr").rotate}),e(t.exports,"scale",function(){return i("kFecW").scale}),e(t.exports,"compose",function(){return i("dZ59l").compose}),e(t.exports,"translate",function(){return i("kr2fR").translate}),e(t.exports,"decomposeTSR",function(){return i("gvDD3").decomposeTSR}),i("cdZRx"),i("3wE7v"),i("btdnM"),i("83Kse"),i("kDVZW"),i("lNvMw"),i("1RMPr"),i("kFecW"),i("8jtBQ"),i("ibhub"),i("2mZ9s"),i("dZ59l"),i("kr2fR"),i("5687o"),i("eP59S"),i("i0iB3"),i("ag5pW"),i("gvDD3"),i("4JElo"),i("90Qul")}),n("cdZRx",function(t,i){e(t.exports,"applyToPoint",function(){return n});function n(e,t){return Array.isArray(t)?[e.a*t[0]+e.c*t[1]+e.e,e.b*t[0]+e.d*t[1]+e.f]:{x:e.a*t.x+e.c*t.y+e.e,y:e.b*t.x+e.d*t.y+e.f}}}),n("3wE7v",function(t,i){e(t.exports,"fromObject",function(){return n});function n(e){return{a:parseFloat(e.a),b:parseFloat(e.b),c:parseFloat(e.c),d:parseFloat(e.d),e:parseFloat(e.e),f:parseFloat(e.f)}}}),n("btdnM",function(e,t){}),n("83Kse",function(t,i){e(t.exports,"identity",function(){return n});function n(){return{a:1,c:0,e:0,b:0,d:1,f:0}}}),n("kDVZW",function(t,i){e(t.exports,"inverse",function(){return n});function n(e){var t=e.a,i=e.b,n=e.c,r=e.d,s=e.e,a=e.f,o=t*r-i*n;return{a:r/o,b:-(i/o),c:-(n/o),d:t/o,e:-((r*s-n*a)/o),f:(i*s-t*a)/o}}}),n("lNvMw",function(e,t){i("9LyQ8")}),n("9LyQ8",function(t,i){function n(e){return void 0===e}function r(e){return"number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e)}function s(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}e(t.exports,"isUndefined",function(){return n}),e(t.exports,"isNumeric",function(){return r}),e(t.exports,"isObject",function(){return s})}),n("1RMPr",function(t,n){e(t.exports,"rotate",function(){return c}),e(t.exports,"rotateDEG",function(){return u});var r=i("9LyQ8"),s=i("kr2fR"),a=i("dZ59l"),o=Math.cos,l=Math.sin,h=Math.PI;function c(e,t,i){var n=o(e),h=l(e),c={a:n,c:-h,e:0,b:h,d:n,f:0};return(0,r.isUndefined)(t)||(0,r.isUndefined)(i)?c:(0,a.transform)([(0,s.translate)(t,i),c,(0,s.translate)(-t,-i)])}function u(e,t,i){return c(e*h/180,t,i)}}),n("kr2fR",function(t,i){e(t.exports,"translate",function(){return n});function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{a:1,c:0,e:e,b:0,d:1,f:t}}}),n("dZ59l",function(t,n){e(t.exports,"transform",function(){return a}),e(t.exports,"compose",function(){return o});var r=i("lYyRs"),s=i("bX4ja");function a(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];t=Array.isArray(t[0])?t[0]:t;var n=function(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}};switch(t.length){case 0:throw Error("no matrices provided");case 1:return t[0];case 2:return n(t[0],t[1]);default:var o=(0,r._)(t),l=o[0],h=o[1],c=o.slice(2),u=n(l,h);return a.apply(void 0,[u].concat((0,s._)(c)))}}function o(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return a.apply(void 0,(0,s._)(t))}}),n("lYyRs",function(t,n){e(t.exports,"_",function(){return l});var r=i("vDBh4"),s=i("5mm0I"),a=i("keO5I"),o=i("kWe4k");function l(e){return(0,r._)(e)||(0,s._)(e)||(0,o._)(e)||(0,a._)()}}),n("kFecW",function(t,n){e(t.exports,"scale",function(){return o});var r=i("9LyQ8"),s=i("kr2fR"),a=i("dZ59l");function o(e,t,i,n){(0,r.isUndefined)(t)&&(t=e);var o={a:e,c:0,e:0,b:0,d:t,f:0};return(0,r.isUndefined)(i)||(0,r.isUndefined)(n)?o:(0,a.transform)([(0,s.translate)(i,n),o,(0,s.translate)(-i,-n)])}}),n("8jtBQ",function(t,i){e(t.exports,"shear",function(){return n});function n(e,t){return{a:1,c:e,e:0,b:t,d:1,f:0}}}),n("ibhub",function(t,i){e(t.exports,"skewDEG",function(){return r});var n=Math.tan;function r(e,t){var i,r;return i=e*Math.PI/180,r=t*Math.PI/180,{a:1,c:n(i),e:0,b:n(r),d:1,f:0}}}),n("2mZ9s",function(e,t){}),n("5687o",function(e,t){i("kDVZW"),i("dZ59l"),i("eP59S")}),n("eP59S",function(t,i){e(t.exports,"smoothMatrix",function(){return n});function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e10;return{a:Math.round(e.a*t)/t,b:Math.round(e.b*t)/t,c:Math.round(e.c*t)/t,d:Math.round(e.d*t)/t,e:Math.round(e.e*t)/t,f:Math.round(e.f*t)/t}}}),n("i0iB3",function(e,t){i("3wE7v"),i("kr2fR"),i("kFecW"),i("1RMPr"),i("ibhub"),i("8jtBQ")}),n("ag5pW",function(e,t){i("376sE")}),n("376sE",function(t,i){function n(e,t,i,r){var s=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(s,n.prototype),s.expected=t,s.found=i,s.location=r,s.name="SyntaxError",s}function r(e,t,i){return(i=i||" ",e.length>t)?e:(t-=e.length,e+(i+=i.repeat(t)).slice(0,t))}function s(e,t){var i,r,s,a,o,l,h,c,u={},p=(t=void 0!==t?t:{}).grammarSource,d={transformList:Q},g=Q,f="matrix",v="translate",m="scale",y="rotate",x="skewX",b="skewY",B=/^[eE]/,w=/^[+\-]/,k=/^[0-9]/,C=/^[ \t\r\n]/,S=K("matrix",!1),E=K("(",!1),L=K(")",!1),A=K("translate",!1),I=K("scale",!1),T=K("rotate",!1),P=K("skewX",!1),R=K("skewY",!1),M=K(",",!1),D={type:"other",description:"fractionalConstant"},O=K(".",!1),_=q(["e","E"],!1,!1),N=q(["+","-"],!1,!1),z=q([["0","9"]],!1,!1),G=q([" ","	","\r","\n"],!1,!1),j=function(e,t){var i={type:"translate",tx:e};return t&&(i.ty=t),[i]},F=function(e,t){var i={type:"scale",sx:e};return t&&(i.sy=t),[i]},H=function(e,t){var i={type:"rotate",angle:e};return t&&(i.cx=t[0],i.cy=t[1]),[i]},U=0,X=[{line:1,column:1}],V=0,W=[],Y=0;if("startRule"in t){if(!(t.startRule in d))throw Error("Can't start parsing from rule \""+t.startRule+'".');g=d[t.startRule]}function K(e,t){return{type:"literal",text:e,ignoreCase:t}}function q(e,t,i){return{type:"class",parts:e,inverted:t,ignoreCase:i}}function Z(t){var i,n=X[t];if(n)return n;for(i=t-1;!X[i];)i--;for(n={line:(n=X[i]).line,column:n.column};i<t;)10===e.charCodeAt(i)?(n.line++,n.column=1):n.column++,i++;return X[t]=n,n}function $(e){U<V||(U>V&&(V=U,W=[]),W.push(e))}function Q(){var e,t,i,n;for(e=[],t=el();t!==u;)e.push(t),t=el();for((t=function e(){var t,i,n,r,s;if(t=U,(i=J())!==u){if(n=[],(r=ei())!==u)for(;r!==u;)n.push(r),r=ei();else n=u;n!==u&&(r=e())!==u?(s=r,t=i.concat(s)):(U=t,t=u)}else U=t,t=u;return t===u&&(t=J()),t}())===u&&(t=null),i=[],n=el();n!==u;)i.push(n),n=el();return t}function J(){var t;return(t=function(){var t,i,n,r,s,a,o,l,h,c,p,d,g;if(t=U,e.substr(U,6)===f?(i=f,U+=6):(i=u,0===Y&&$(S)),i!==u){for(n=[],r=el();r!==u;)n.push(r),r=el();if(40===e.charCodeAt(U)?(r="(",U++):(r=u,0===Y&&$(E)),r!==u){for(s=[],a=el();a!==u;)s.push(a),a=el();if((a=ee())!==u){if(ei()!==u){if((o=ee())!==u){if(ei()!==u){if((l=ee())!==u){if(ei()!==u){if((h=ee())!==u){if(ei()!==u){if((c=ee())!==u){if(ei()!==u){if((p=ee())!==u){for(d=[],g=el();g!==u;)d.push(g),g=el();(41===e.charCodeAt(U)?(g=")",U++):(g=u,0===Y&&$(L)),g!==u)?t=[{type:"matrix",a:a,b:o,c:l,d:h,e:c,f:p}]:(U=t,t=u)}else U=t,t=u}else U=t,t=u}else U=t,t=u}else U=t,t=u}else U=t,t=u}else U=t,t=u}else U=t,t=u}else U=t,t=u}else U=t,t=u}else U=t,t=u}else U=t,t=u}else U=t,t=u}else U=t,t=u;return t}())===u&&(t=function(){var t,i,n,r,s,a,o,l,h;if(t=U,e.substr(U,9)===v?(i=v,U+=9):(i=u,0===Y&&$(A)),i!==u){for(n=[],r=el();r!==u;)n.push(r),r=el();if(40===e.charCodeAt(U)?(r="(",U++):(r=u,0===Y&&$(E)),r!==u){for(s=[],a=el();a!==u;)s.push(a),a=el();if((a=ee())!==u){for((o=et())===u&&(o=null),l=[],h=el();h!==u;)l.push(h),h=el();41===e.charCodeAt(U)?(h=")",U++):(h=u,0===Y&&$(L)),h!==u?t=j(a,o):(U=t,t=u)}else U=t,t=u}else U=t,t=u}else U=t,t=u;return t}())===u&&(t=function(){var t,i,n,r,s,a,o,l,h;if(t=U,e.substr(U,5)===m?(i=m,U+=5):(i=u,0===Y&&$(I)),i!==u){for(n=[],r=el();r!==u;)n.push(r),r=el();if(40===e.charCodeAt(U)?(r="(",U++):(r=u,0===Y&&$(E)),r!==u){for(s=[],a=el();a!==u;)s.push(a),a=el();if((a=ee())!==u){for((o=et())===u&&(o=null),l=[],h=el();h!==u;)l.push(h),h=el();41===e.charCodeAt(U)?(h=")",U++):(h=u,0===Y&&$(L)),h!==u?t=F(a,o):(U=t,t=u)}else U=t,t=u}else U=t,t=u}else U=t,t=u;return t}())===u&&(t=function(){var t,i,n,r,s,a,o,l,h,c,p,d;if(t=U,e.substr(U,6)===y?(i=y,U+=6):(i=u,0===Y&&$(T)),i!==u){for(n=[],r=el();r!==u;)n.push(r),r=el();if(40===e.charCodeAt(U)?(r="(",U++):(r=u,0===Y&&$(E)),r!==u){for(s=[],a=el();a!==u;)s.push(a),a=el();if((a=ee())!==u){for((c=U,ei()!==u&&(p=ee())!==u&&ei()!==u&&(d=ee())!==u)?c=[p,d]:(U=c,c=u),(o=c)===u&&(o=null),l=[],h=el();h!==u;)l.push(h),h=el();41===e.charCodeAt(U)?(h=")",U++):(h=u,0===Y&&$(L)),h!==u?t=H(a,o):(U=t,t=u)}else U=t,t=u}else U=t,t=u}else U=t,t=u;return t}())===u&&(t=function(){var t,i,n,r,s,a,o,l;if(t=U,e.substr(U,5)===x?(i=x,U+=5):(i=u,0===Y&&$(P)),i!==u){for(n=[],r=el();r!==u;)n.push(r),r=el();if(40===e.charCodeAt(U)?(r="(",U++):(r=u,0===Y&&$(E)),r!==u){for(s=[],a=el();a!==u;)s.push(a),a=el();if((a=ee())!==u){for(o=[],l=el();l!==u;)o.push(l),l=el();(41===e.charCodeAt(U)?(l=")",U++):(l=u,0===Y&&$(L)),l!==u)?t=[{type:"skewX",angle:a}]:(U=t,t=u)}else U=t,t=u}else U=t,t=u}else U=t,t=u;return t}())===u&&(t=function(){var t,i,n,r,s,a,o,l;if(t=U,e.substr(U,5)===b?(i=b,U+=5):(i=u,0===Y&&$(R)),i!==u){for(n=[],r=el();r!==u;)n.push(r),r=el();if(40===e.charCodeAt(U)?(r="(",U++):(r=u,0===Y&&$(E)),r!==u){for(s=[],a=el();a!==u;)s.push(a),a=el();if((a=ee())!==u){for(o=[],l=el();l!==u;)o.push(l),l=el();(41===e.charCodeAt(U)?(l=")",U++):(l=u,0===Y&&$(L)),l!==u)?t=[{type:"skewY",angle:a}]:(U=t,t=u)}else U=t,t=u}else U=t,t=u}else U=t,t=u;return t}()),t}function ee(){var t,i,n,r,s,a,o,l,h,c,p,d,g;if(t=U,i=U,(n=es())===u&&(n=null),((s=U,(Y++,h=U,(c=ea())===u&&(c=null),46===e.charCodeAt(U)?(p=".",U++):(p=u,0===Y&&$(O)),p!==u&&(d=ea())!==u)?h=[(g=c)?g.join(""):null,".",d.join("")].join(""):(U=h,h=u),h===u&&((h=U,(c=ea())!==u&&(46===e.charCodeAt(U)?(p=".",U++):(p=u,0===Y&&$(O)),p!==u))?h=c.join(""):(U=h,h=u)),Y--,h===u&&(c=u,0===Y&&$(D)),(a=h)!==u)?((o=er())===u&&(o=null),s=[a,o||null].join("")):(U=s,s=u),s===u&&((s=U,(a=ea())!==u&&(o=er())!==u)?s=[a,o].join(""):(U=s,s=u)),(r=s)!==u)?i=n=[n,r]:(U=i,i=u),i!==u)i=parseFloat(i.join(""));return(t=i)===u&&(t=U,i=U,(n=es())===u&&(n=null),((l=ea())!==u&&(l=l.join("")),(r=l)!==u)?i=n=[n,r]:(U=i,i=u),i!==u&&(i=parseInt(i.join(""))),t=i),t}function et(){var e,t;return(e=U,ei()!==u&&(t=ee())!==u)?e=t:(U=e,e=u),e}function ei(){var e,t,i,n,r;if(e=U,t=[],(i=el())!==u)for(;i!==u;)t.push(i),i=el();else t=u;if(t!==u){for((i=en())===u&&(i=null),n=[],r=el();r!==u;)n.push(r),r=el();e=t=[t,i,n]}else U=e,e=u;if(e===u){if(e=U,(t=en())!==u){for(i=[],n=el();n!==u;)i.push(n),n=el();e=t=[t,i]}else U=e,e=u}return e}function en(){var t;return 44===e.charCodeAt(U)?(t=",",U++):(t=u,0===Y&&$(M)),t}function er(){var t,i,n,r;return(t=U,B.test(e.charAt(U))?(i=e.charAt(U),U++):(i=u,0===Y&&$(_)),i!==u&&((n=es())===u&&(n=null),(r=ea())!==u))?t=["e",n,r.join("")].join(""):(U=t,t=u),t}function es(){var t;return w.test(e.charAt(U))?(t=e.charAt(U),U++):(t=u,0===Y&&$(N)),t}function ea(){var e,t;if(e=[],(t=eo())!==u)for(;t!==u;)e.push(t),t=eo();else e=u;return e}function eo(){var t;return k.test(e.charAt(U))?(t=e.charAt(U),U++):(t=u,0===Y&&$(z)),t}function el(){var t;return C.test(e.charAt(U))?(t=e.charAt(U),U++):(t=u,0===Y&&$(G)),t}if((c=g())!==u&&U===e.length)return c;throw c!==u&&U<e.length&&$({type:"end"}),l=W,h=V<e.length?e.charAt(V):null,i=V,r=V<e.length?V+1:V,s=Z(i),a=Z(r),o={source:p,start:{offset:i,line:s.line,column:s.column},end:{offset:r,line:a.line,column:a.column}},new n(n.buildMessage(l,h),l,h,o)}e(t.exports,"parse",function(){return s}),function(e,t){function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i}(n,Error),n.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var i,n=null;for(i=0;i<e.length;i++)if(e[i].source===this.location.source){n=e[i].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,a=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(s):s,o=this.location.source+":"+a.line+":"+a.column;if(n){var l=this.location.end,h=r("",a.line.toString().length," "),c=n[s.line-1],u=(s.line===l.line?l.column:c.length+1)-s.column||1;t+="\n --> "+o+"\n"+h+" |\n"+a.line+" | "+c+"\n"+h+" | "+r("",s.column-1," ")+r("",u,"^")}else t+="\n at "+o}return t},n.buildMessage=function(e,t){var i={literal:function(e){return'"'+r(e.text)+'"'},class:function(e){var t=e.parts.map(function(e){return Array.isArray(e)?s(e[0])+"-"+s(e[1]):s(e)});return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function r(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}function a(e){return i[e.type](e)}return"Expected "+function(e){var t,i,n=e.map(a);if(n.sort(),n.length>0){for(t=1,i=1;t<n.length;t++)n[t-1]!==n[t]&&(n[i]=n[t],i++);n.length=i}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+(t?'"'+r(t)+'"':"end of input")+" found."}}),n("gvDD3",function(t,n){e(t.exports,"decomposeTSR",function(){return a});var r=i("kFecW"),s=i("dZ59l");function a(e){var t,i,n,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a?e=o?(0,s.compose)(e,(0,r.scale)(-1,-1)):(0,s.compose)(e,(0,r.scale)(1,-1)):o&&(e=(0,s.compose)(e,(0,r.scale)(-1,1)));var l=e.a,h=e.b,c=e.c,u=e.d;if(0!==l||0!==c){var p=Math.hypot(l,c);t=p,i=(l*u-h*c)/p;var d=Math.acos(l/p);n=c>0?-d:d}else if(0!==h||0!==u){var g=Math.hypot(h,u);t=(l*u-h*c)/g,i=g;var f=Math.acos(h/g);n=Math.PI/2+(u>0?-f:f)}else t=0,i=0,n=0;return o&&(t=-t),a&&(i=-i),{translate:{tx:e.e,ty:e.f},scale:{sx:t,sy:i},rotation:{angle:n}}}}),n("4JElo",function(e,t){}),n("90Qul",function(e,t){i("kr2fR"),i("cdZRx"),i("1RMPr"),i("kFecW"),i("dZ59l")}),n("1GsyD",function(t,n){e(t.exports,"createMatrixFromTransform",function(){return l}),i("ciAU9");var r=i("dZ59l"),s=i("1RMPr"),a=i("kFecW"),o=i("kr2fR");function l(e){var t="scale"in e?e.scale:e.scaleX,i="scale"in e?e.scale:e.scaleY;return(0,r.compose)((0,o.translate)(e.x,e.y),(0,s.rotate)(e.angleDeg/180*Math.PI),(0,a.scale)(t,i))}}),n("fzzhO",function(t,i){e(t.exports,"matrixToTuple",function(){return n});function n(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}}),n("hzavh",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"tool-zoom-in.d413f042.svg"}),n("5LsQG",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"tool-zoom-out.299f4d1f.svg"}),n("4RrDk",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"viewport-reset.25476ab5.svg"}),n("fJXlf",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"tool-hand.e7fc81b9.svg"}),n("43wBz",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-pencil.d7636d97.svg"}),n("63yUO",function(t,i){e(t.exports,"zoomByStep",function(){return n});function n(e,t){var i=Math.log2(e)/Math.abs(t);return i+=t>0?1:-1,Math.pow(2,i=Math.round(i)*Math.abs(t))}}),n("8G4G9",function(t,n){e(t.exports,"createTransform",function(){return l}),i("ciAU9");var r=i("cdZRx"),s=i("dZ59l"),a=i("1RMPr"),o=i("kFecW");function l(e,t,i,n){var l=(0,s.compose)((0,o.scale)(-i,-i),(0,a.rotate)(n/180*Math.PI)),h=(0,r.applyToPoint)(l,t);return h.x+=e.x,h.y+=e.y,{x:h.x,y:h.y,scale:i,angleDeg:n}}}),n("lUrXo",function(t,n){e(t.exports,"toMetaTransform",function(){return o});var r=i("1GsyD");i("ciAU9");var s=i("cdZRx"),a=i("kDVZW");function o(e,t){var i=(0,r.createMatrixFromTransform)(e),n=(0,s.applyToPoint)((0,a.inverse)(i),t);return{viewportP:t,canvasP:n,scale:e.scale,angleDeg:e.angleDeg}}}),n("l6zI1",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-crop.16c534dd.svg"}),n("isYih",function(t,n){e(t.exports,"clipboardDialog",function(){return c});var r=i("1LaJZ"),s=i("2gUX3"),a=i("eWjiX"),o=i("2MaaK"),l=i("hRdOL"),h=i("1mH1z");function c(e,t,i,n,c){var u,p,d=!1;try{d=!!ClipboardItem}catch(e){}var g=document.createElement("div"),f=window.innerWidth<550||window.innerHeight<550,v=(0,a.BB).el({content:(0,h.LANG)("crop-drag-to-crop")+(d?"":"<br>"+(0,h.LANG)("cropcopy-click-hold")),css:{textAlign:"center"}});g.append(v);var m=new l.CropCopy({width:f?340:540,height:f?300:350,canvas:t,isNotCopy:!1,onChange:function(){return setTimeout(function(){d&&(clearTimeout(u),u=setTimeout(function(){m.getCroppedCanvas().toBlob(function(e){y=null!=e?e:void 0},"image/png")},50))})}});(0,a.BB).css(m.getEl(),{marginTop:"10px",marginLeft:"-20px"}),g.append(m.getEl());var y=void 0;function x(){return b.apply(this,arguments)}function b(){return(b=(0,r._)(function(){var e;return(0,s.__generator)(this,function(t){switch(t.label){case 0:if(!y)return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,navigator.clipboard.write([new ClipboardItem({[y.type]:y})])];case 2:return t.sent(),setTimeout(function(){n.out((0,h.LANG)("cropcopy-copied"),!0)},200),[3,4];case 3:return console.error((e=t.sent()).name,e.message),[2];case 4:return[2]}})})).apply(this,arguments)}var B=new a.BB.KeyListener({onDown:function(e,t,i){["ctrl+c","cmd+c"].includes(i)&&(x(),p&&p())}});function w(){p&&p()}window.addEventListener("blur",w);var k=[];d&&k.push((0,h.LANG)("cropcopy-btn-copy")),c&&k.push((0,h.LANG)("cropcopy-btn-crop")),k.push("Cancel"),(0,o.showModal)({target:e,message:"<b>"+(c?`${(0,h.LANG)("cropcopy-title-copy")} / ${(0,h.LANG)("cropcopy-title-crop")}`:`${(0,h.LANG)("cropcopy-title-copy")}`)+"</b>",div:g,style:f?{}:{width:"540px"},buttons:k,primaries:[(0,h.LANG)("cropcopy-btn-copy")],callback:function(e){if(e===(0,h.LANG)("cropcopy-btn-copy"))x();else if(e===(0,h.LANG)("cropcopy-btn-crop")){var n=m.getRect();i({left:Math.round(-n.x),right:Math.round(n.x+n.width-t.width),top:Math.round(-n.y),bottom:Math.round(n.y+n.height-t.height)})}window.removeEventListener("blur",w),(0,a.BB).freeCanvas(m.getCroppedCanvas()),m.destroy(),B.destroy()},clickOnEnter:(0,h.LANG)("cropcopy-btn-copy"),closeFunc:function(e){p=e}})}}),n("b4yIv",function(n,r){e(n.exports,"LayersUi",function(){return E});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("eEL9N"),h=i("j5jvd"),c=i("705qg"),u=i("1mH1z"),p=i("bBcC4"),d=i("50Lcc"),g=i("dsnzg"),f=i("1C8RU"),v=i("7jh4K"),m=i("6J2My"),y=i("amum4"),x=i("6vUjz"),b=i("c7Qka"),B=i("fwb8M"),w=i("9j3zc"),k=i("4UZXr"),C=i("2Xpd6"),S=i("g6Z5k"),E=/*#__PURE__*/function(){function e(i){var n,r,a=this;(0,s._)(this,e),this.lastpos=0,this.layerHeight=35,this.layerSpacing=0,this.klCanvas=i.klCanvas,this.onSelect=i.onSelect,this.parentEl=i.parentEl,this.uiState=i.uiState,this.applyUncommitted=i.applyUncommitted,this.history=i.history,this.onUpdateProject=i.onUpdateProject,this.layerElArr=[],this.layerHeight=35,this.layerSpacing=0,this.largeThumbDiv=(0,o.BB).el({onClick:o.BB.handleClick,css:{position:"absolute",top:"500px",background:"#aaa",boxShadow:"1px 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none",padding:"0",border:"1px solid #aaa",transition:"opacity 0.3s ease-out",userSelect:"none"}}),this.setUiState(this.uiState),(0,o.BB).createCheckerDataUrl(4,function(e){a.largeThumbDiv.style.backgroundImage="url("+e+")"},(0,f.theme).isDark()),this.largeThumbCanvas=(0,o.BB).canvas(200,200),this.largeThumbCanvas.style.display="block",this.largeThumbDiv.append(this.largeThumbCanvas),this.largeThumbInDocument=!1,this.klCanvasLayerArr=this.klCanvas.getLayers(),this.selectedSpotIndex=this.klCanvasLayerArr.length-1,this.rootEl=(0,o.BB).el({css:{marginRight:"10px",marginBottom:"10px",marginLeft:"10px",marginTop:"10px",cursor:"default"}});var h=(0,o.BB).el({css:{width:"270px",position:"relative",margin:"0 -10px",zIndex:"0"}});this.layerListEl=(0,o.BB).el({parent:h}),this.addBtn=(0,o.BB).el({tagName:"button"}),this.duplicateBtn=(0,o.BB).el({tagName:"button"}),this.mergeBtn=(0,o.BB).el({tagName:"button"}),this.removeBtn=(0,o.BB).el({tagName:"button"});var c=(0,o.BB).el({tagName:"button"});this.moreDropdown=new x.DropdownMenu({button:(0,o.BB).el({content:`<img src="${/*@__PURE__*/t(S)}" width="13"/>`,css:{display:"flex",justifyContent:"center",opacity:"0.9"}}),buttonTitle:(0,u.LANG)("more"),items:[["merge-all",(0,u.LANG)("layers-merge-all")]],onItemClick:function(e){if("merge-all"===e){a.applyUncommitted();var t=a.klCanvas.mergeAll();!1!==t&&(a.klCanvasLayerArr=a.klCanvas.getLayers(),a.selectedSpotIndex=t,a.createLayerList(),a.history.pause(!0),a.onSelect(a.selectedSpotIndex),a.history.pause(!1),a.updateButtons())}}}),this.updateButtons(),this.rootEl.append((n=(0,o.BB).el(),setTimeout(function(){(0,o.BB).makeUnfocusable(a.addBtn),(0,o.BB).makeUnfocusable(a.duplicateBtn),(0,o.BB).makeUnfocusable(a.mergeBtn),(0,o.BB).makeUnfocusable(a.removeBtn),(0,o.BB).makeUnfocusable(c),a.addBtn.style.cssFloat="left",a.duplicateBtn.style.cssFloat="left",a.mergeBtn.style.cssFloat="left",a.removeBtn.style.cssFloat="left",c.style.cssFloat="left",a.addBtn.title=(0,u.LANG)("layers-new"),a.duplicateBtn.title=(0,u.LANG)("layers-duplicate"),a.removeBtn.title=(0,u.LANG)("layers-remove"),a.mergeBtn.title=(0,u.LANG)("layers-merge"),c.title=(0,u.LANG)("layers-rename-title"),a.addBtn.style.paddingLeft="5px",a.addBtn.style.paddingRight="3px",a.removeBtn.style.paddingLeft="5px",a.removeBtn.style.paddingRight="3px",a.duplicateBtn.style.paddingLeft="5px",a.duplicateBtn.style.paddingRight="3px",a.mergeBtn.style.paddingLeft="5px",a.mergeBtn.style.paddingRight="3px",c.style.height="30px",c.style.lineHeight="20px",a.addBtn.innerHTML="<img src='"+/*@__PURE__*/t(b)+"' height='20'/>",a.duplicateBtn.innerHTML="<img src='"+/*@__PURE__*/t(B)+"' height='20'/>",a.mergeBtn.innerHTML="<img src='"+/*@__PURE__*/t(w)+"' height='20'/>",a.removeBtn.innerHTML="<img src='"+/*@__PURE__*/t(k)+"' height='20'/>",c.innerHTML="<img src='"+/*@__PURE__*/t(C)+"' height='20'/>",n.append((0,y.c)(",flex,gap-5,mb-10",[a.addBtn,a.removeBtn,a.duplicateBtn,a.mergeBtn,c,(0,y.c)(",grow-1"),a.moreDropdown.getElement()])),a.addBtn.onclick=function(){a.applyUncommitted(),!1!==a.klCanvas.addLayer(a.selectedSpotIndex)&&(a.klCanvasLayerArr=a.klCanvas.getLayers(),a.selectedSpotIndex=a.selectedSpotIndex+1,a.createLayerList(),a.history.pause(!0),a.onSelect(a.selectedSpotIndex),a.history.pause(!1),a.updateButtons())},a.duplicateBtn.onclick=function(){a.applyUncommitted(),!1!==a.klCanvas.duplicateLayer(a.selectedSpotIndex)&&(a.klCanvasLayerArr=a.klCanvas.getLayers(),a.selectedSpotIndex++,a.createLayerList(),a.history.pause(!0),a.onSelect(a.selectedSpotIndex),a.history.pause(!1),a.updateButtons())},a.removeBtn.onclick=function(){a.applyUncommitted(),a.layerElArr.length<=1||(a.klCanvas.removeLayer(a.selectedSpotIndex),a.selectedSpotIndex>0&&a.selectedSpotIndex--,a.klCanvasLayerArr=a.klCanvas.getLayers(),a.createLayerList(),a.history.pause(!0),a.onSelect(a.selectedSpotIndex),a.history.pause(!1),a.updateButtons())},a.mergeBtn.onclick=function(){a.applyUncommitted(),a.selectedSpotIndex<=0||(0,g.mergeLayerDialog)(a.parentEl,{topCanvas:a.klCanvasLayerArr[a.selectedSpotIndex].context.canvas,bottomCanvas:a.klCanvasLayerArr[a.selectedSpotIndex-1].context.canvas,topOpacity:a.klCanvas.getLayer(a.selectedSpotIndex).opacity,mixModeStr:a.klCanvasLayerArr[a.selectedSpotIndex].mixModeStr,callback:function(e){a.klCanvas.mergeLayers(a.selectedSpotIndex,a.selectedSpotIndex-1,e),a.klCanvasLayerArr=a.klCanvas.getLayers(),a.selectedSpotIndex--,a.createLayerList(),a.history.pause(!0),a.onSelect(a.selectedSpotIndex),a.history.pause(!1),a.updateButtons()}})},c.onclick=function(){a.applyUncommitted(),a.renameLayer(a.selectedSpotIndex)}},1),n)),r=(0,o.BB).el({content:(0,u.LANG)("layers-blending")+"&nbsp;",css:{fontSize:"15px"}}),this.modeSelect=new l.Select({optionArr:["source-over",void 0,"darken","multiply","color-burn",void 0,"lighten","screen","color-dodge",void 0,"overlay","soft-light","hard-light",void 0,"difference","exclusion",void 0,"hue","saturation","color","luminosity"].map(function(e){return e?[e,(0,p.translateBlending)(e)]:void 0}),onChange:function(e){a.klCanvas.setMixMode(a.selectedSpotIndex,e),a.update(a.selectedSpotIndex)},css:{marginBottom:"10px"}}),r.append(this.modeSelect.getElement()),this.rootEl.append(r),this.rootEl.append(h),setInterval(function(){if("block"===a.rootEl.style.display){var e=a.history.getChangeCount();if(e!==a.oldHistoryState){a.oldHistoryState=e;for(var t=0;t<a.layerElArr.length;t++)if(a.selectedSpotIndex===a.layerElArr[t].spot&&a.klCanvasLayerArr[a.layerElArr[t].spot]){var i=(0,o.BB).ctx(a.layerElArr[t].thumb);i.save(),i.clearRect(0,0,i.canvas.width,i.canvas.height),a.klCanvasLayerArr[a.layerElArr[t].spot].context.canvas.width<a.layerElArr[t].thumb.width&&(i.imageSmoothingEnabled=!1),i.drawImage(a.klCanvasLayerArr[a.layerElArr[t].spot].context.canvas,0,0,a.layerElArr[t].thumb.width,a.layerElArr[t].thumb.height),i.restore()}}}},1),(0,f.theme).addIsDarkListener(function(){a.createLayerList()}),this.createLayerList()}return(0,a._)(e,[{key:"move",value:function(e,t){var i=this;if(isNaN(e)||isNaN(t))throw"layers-ui - invalid move";for(var n=0;n<this.klCanvasLayerArr.length;n++)!function(n){var r=i.layerElArr[n].spot;i.layerElArr[n].spot===e?r=t:(i.layerElArr[n].spot>e&&r--,r>=t&&r++),i.layerElArr[n].spot=r,i.layerElArr[n].posY=(i.layerHeight+i.layerSpacing)*(i.klCanvasLayerArr.length-r-1),i.layerElArr[n].style.top=i.layerElArr[n].posY+"px"}(n);e!==t&&(this.klCanvas.moveLayer(this.selectedSpotIndex,t-e),this.klCanvasLayerArr=this.klCanvas.getLayers(),this.selectedSpotIndex=t,this.mergeBtn.disabled=0===this.selectedSpotIndex)}},{key:"posToSpot",value:function(e){var t=parseInt(""+(e/(this.layerHeight+this.layerSpacing)+.5));return t=Math.min(this.klCanvasLayerArr.length-1,Math.max(0,t)),t=this.klCanvasLayerArr.length-t-1}},{key:"updateLayersVerticalPosition",value:function(e,t){if((t=Math.min(this.klCanvasLayerArr.length-1,Math.max(0,t)))!==this.lastpos){for(var i=0;i<this.klCanvasLayerArr.length;i++)if(this.layerElArr[i].spot!==e){var n=this.layerElArr[i].spot;this.layerElArr[i].spot>e&&n--,n>=t&&n++,this.layerElArr[i].posY=(this.layerHeight+this.layerSpacing)*(this.klCanvasLayerArr.length-n-1),this.layerElArr[i].style.top=this.layerElArr[i].posY+"px"}this.lastpos=t}}},{key:"renameLayer",value:function(e){var t=this;(0,d.renameLayerDialog)(this.parentEl,this.klCanvas.getLayer(e).name,function(i){void 0!==i&&i!==t.klCanvas.getLayer(e).name&&(t.klCanvas.renameLayer(e,i),t.createLayerList(),t.history.pause(!0),t.onSelect(e),t.history.pause(!1))})}},{key:"updateHeight",value:function(){this.layerListEl.style.height=35*this.layerElArr.length+"px"}},{key:"createLayerList",value:function(){var e=this;this.oldHistoryState=this.history.getChangeCount(),this.klCanvasLayerArr=this.klCanvas.getLayers();var t=(0,o.BB).createCheckerDataUrl(4,void 0,(0,f.theme).isDark());for(this.layerElArr=[];this.layerListEl.firstChild;){var i=this.layerListEl.firstChild;i.pointerListener.destroy(),i.opacitySlider.destroy(),i.remove()}for(var n=0;n<this.klCanvasLayerArr.length;n++)!function(i){var n,r=(0,v.throwIfNull)(e.klCanvas.getLayer(i)),s=r.name,a=e.klCanvasLayerArr[i].opacity,l=r.isVisible,c=e.klCanvasLayerArr[i].context.canvas,p=(0,o.BB).el({className:"kl-layer"});e.layerElArr[i]=p,p.posY=(e.klCanvasLayerArr.length-1)*35-35*i,(0,o.BB).css(p,{top:p.posY+"px"});var d=(0,o.BB).el();(0,o.BB).css(d,{position:"relative"});var g=(0,o.BB).el();(0,o.BB).css(g,{width:"270px",height:"34px"});var f=(0,o.BB).el();p.append(d),d.append(g,f),p.spot=i;var y=(0,o.BB).el({tagName:"label",parent:g,title:(0,u.LANG)("layers-visibility-toggle"),css:{display:"flex",width:"25px",height:"100%",justifyContent:"right",alignItems:"center",cursor:"pointer"}}),x=(0,o.BB).el({tagName:"input",parent:y,custom:{type:"checkbox",tabindex:"-1"},css:{display:"block",cursor:"pointer",margin:"0",marginRight:"5px"}});x.checked=l,x.onchange=function(){e.klCanvas.setLayerIsVisible(p.spot,x.checked),e.createLayerList(),p.spot===e.selectedSpotIndex&&(e.history.pause(!0),e.onSelect(e.selectedSpotIndex),e.history.pause(!1))};var b=function(e){e.preventDefault(),e.stopPropagation()};m.hasPointerEvents?y.onpointerdown=b:y.onmousedown=b;var B=(0,o.BB).fitInto(c.width,c.height,30,30,1);p.thumb=(0,o.BB).canvas(B.width,B.height);var w=(0,o.BB).ctx(p.thumb);w.save(),p.thumb.width>c.width&&(w.imageSmoothingEnabled=!1),w.drawImage(c,0,0,p.thumb.width,p.thumb.height),w.restore(),(0,o.BB).css(p.thumb,{position:"absolute",left:(32-p.thumb.width)/2+25+"px",top:(32-p.thumb.height)/2+1+"px"}),p.thumb.style.backgroundImage="url("+t+")",p.label=(0,o.BB).el({className:"kl-layer__label"}),p.layerName=s,p.label.append(p.layerName),(0,o.BB).css(p.label,{position:"absolute",left:"63px",top:"1px",fontSize:"13px",width:"170px",height:"20px",overflow:"hidden",whiteSpace:"nowrap"}),p.label.ondblclick=function(){e.applyUncommitted(),e.renameLayer(p.spot)},p.opacityLabel=(0,o.BB).el({className:"kl-layer__opacity-label"}),p.opacity=a,p.opacityLabel.append(parseInt(""+100*p.opacity)+"%"),(0,o.BB).css(p.opacityLabel,{position:"absolute",left:"214px",top:"1px",fontSize:"13px",textAlign:"right",width:"50px",transition:"color 0.2s ease-in-out",textDecoration:l?void 0:"line-through"});var k=new h.PointSlider({init:p.opacity,width:200,pointSize:14,callback:function(t,i,r){if(i){n=e.klCanvas.getLayer(p.spot).opacity,e.history.pause(!0);return}if(r){e.history.pause(!1),n!==t&&e.klCanvas.layerOpacity(p.spot,t);return}p.opacityLabel.innerHTML=Math.round(100*t)+"%",e.klCanvas.layerOpacity(p.spot,t),e.onUpdateProject()}});(0,o.BB).css(k.getEl(),{position:"absolute",left:"64px",top:"17px"}),p.opacitySlider=k,p.thumb.onpointerover=function(t){if(0===t.buttons||t.pointerType&&"touch"===t.pointerType){var i=(0,o.BB).fitInto(c.width,c.height,250,250,1);(e.largeThumbCanvas.width!==i.width||e.largeThumbCanvas.height!==i.height)&&(e.largeThumbCanvas.width=i.width,e.largeThumbCanvas.height=i.height);var n=(0,o.BB).ctx(e.largeThumbCanvas);n.save(),e.largeThumbCanvas.width>c.width&&(n.imageSmoothingEnabled=!1),n.imageSmoothingQuality="high",n.clearRect(0,0,e.largeThumbCanvas.width,e.largeThumbCanvas.height),n.drawImage(c,0,0,e.largeThumbCanvas.width,e.largeThumbCanvas.height),n.restore(),(0,o.BB).css(e.largeThumbDiv,{top:t.clientY-e.largeThumbCanvas.height/2+"px",opacity:"0"}),e.largeThumbInDocument||(document.body.append(e.largeThumbDiv),e.largeThumbInDocument=!0),clearTimeout(e.largeThumbInTimeout),e.largeThumbInTimeout=setTimeout(function(){(0,o.BB).css(e.largeThumbDiv,{opacity:"1"})},20),clearTimeout(e.largeThumbTimeout)}},p.thumb.onpointerout=function(){clearTimeout(e.largeThumbInTimeout),(0,o.BB).css(e.largeThumbDiv,{opacity:"0"}),clearTimeout(e.largeThumbTimeout),e.largeThumbTimeout=setTimeout(function(){e.largeThumbInDocument&&(e.largeThumbDiv.remove(),e.largeThumbInDocument=!1)},300)},g.append(p.thumb,p.label,p.opacityLabel,k.getEl());var C=!1,S=!1;p.pointerListener=new o.BB.PointerListener({target:g,onPointer:function(t){if("pointerdown"===t.type&&"left"===t.button)e.applyUncommitted(),(0,o.BB).css(p,{transition:"box-shadow 0.3s ease-in-out"}),p.style.zIndex="1",e.lastpos=p.spot,S=!1,p.isSelected||(S=!0,e.activateLayer(p.spot)),C=!0;else if("pointermove"===t.type&&"left"===t.button){C&&(C=!1,(0,o.BB).css(p,{boxShadow:"1px 3px 5px rgba(0,0,0,0.4)"})),p.posY+=t.dY;var i=Math.max(0,Math.min((e.klCanvasLayerArr.length-1)*35,p.posY));p.style.top=i+"px",e.updateLayersVerticalPosition(p.spot,e.posToSpot(p.posY))}if("pointerup"===t.type){(0,o.BB).css(p,{transition:"all 0.1s linear"}),setTimeout(function(){(0,o.BB).css(p,{boxShadow:""})},20),p.posY=Math.max(0,Math.min((e.klCanvasLayerArr.length-1)*35,p.posY)),p.style.zIndex="";var n=e.posToSpot(p.posY),r=p.spot;e.move(p.spot,n),r!=n&&(e.history.pause(!0),e.onSelect(e.selectedSpotIndex),e.history.pause(!1)),r===n&&S&&e.onSelect(e.selectedSpotIndex),S=!1}}}),e.layerListEl.append(p)}(n);this.activateLayer(this.selectedSpotIndex),this.updateHeight()}},{key:"updateButtons",value:function(){var e=this.klCanvasLayerArr.length===c.MAX_LAYERS,t=1===this.klCanvasLayerArr.length;this.addBtn.disabled=e,this.removeBtn.disabled=t,this.duplicateBtn.disabled=e,this.mergeBtn.disabled=0===this.selectedSpotIndex,this.moreDropdown.setEnabled("merge-all",!t)}},{key:"update",value:function(e){var t=this;this.klCanvasLayerArr=this.klCanvas.getLayers(),(e||0===e)&&(this.selectedSpotIndex=e),this.updateButtons(),setTimeout(function(){return t.createLayerList()},1)}},{key:"getSelected",value:function(){return this.selectedSpotIndex}},{key:"activateLayer",value:function(e){if(e<0||e>this.layerElArr.length-1)throw"invalid spotIndex "+e+", layerElArr.length "+this.layerElArr.length;this.selectedSpotIndex=e,this.modeSelect.setValue(this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr);for(var t=0;t<this.layerElArr.length;t++){var i=this.layerElArr[t],n=this.selectedSpotIndex===i.spot;(0,o.BB).css(i,{boxShadow:""}),i.classList.toggle("kl-layer--selected",n),i.opacitySlider.setActive(n),i.isSelected=n}this.mergeBtn.disabled=0===this.selectedSpotIndex}},{key:"setUiState",value:function(e){this.uiState=e,"left"===this.uiState?(0,o.BB).css(this.largeThumbDiv,{left:"280px",right:""}):(0,o.BB).css(this.largeThumbDiv,{left:"",right:"280px"})}},{key:"getElement",value:function(){return this.rootEl}}]),e}()}),n("705qg",function(t,n){e(t.exports,"isKlCanvasHistoryEntry",function(){return S}),e(t.exports,"MAX_LAYERS",function(){return L}),e(t.exports,"KlCanvas",function(){return A});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("bX4ja"),l=i("eWjiX"),h=i("30Cml"),c=i("3ujzu"),u=i("h20yl"),p=i("aSJRf"),d=i("1mH1z"),g=i("7EG77");i("ciAU9");var f=i("dZ59l"),v=i("3wE7v"),m=i("83Kse"),y=i("kr2fR"),x=i("9b3eo"),b=i("bbA6w"),B=i("g03EN"),w=i("eg83P"),k=i("eIcQa"),C=i("fzzhO");function S(e){return"canvas"===e.tool[0]}var E=["source-over","darken","multiply","color-burn","lighten","screen","color-dodge","overlay","soft-light","hard-light","difference","exclusion","hue","saturation","color","luminosity"],L=16,A=/*#__PURE__*/function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((0,r._)(this,e),this.layerNrOffset=i,this.isDestroyed=!1,this.selection=void 0,this.selectionSample=void 0,this.layerCanvasArr=[],this.pickCanvas=(0,l.BB).canvas(1,1),"copy"in t?(this.width=1,this.height=1):"width"in t&&"height"in t?(this.width=t.width,this.height=t.height):(this.width=1,this.height=1),this.init(this.width,this.height),this.changeListenerArr=[],"copy"in t)try{this.copy(t.copy)}catch(e){throw this.destroy(),e}else if("projectObj"in t){var n=(0,o._)(t.projectObj.layers);if(this.init(t.projectObj.width,t.projectObj.height),!n.length)throw Error("project.layers needs at least 1 layer");for(var s=0;s<n.length;s++){var a=n[s].mixModeStr;if(a&&!E.includes(a))throw Error("unknown mixModeStr "+n[s].mixModeStr);this.addLayer(),this.layerOpacity(s,n[s].opacity),this.layerCanvasArr[s].name=n[s].name,this.layerCanvasArr[s].isVisible=n[s].isVisible,this.layerCanvasArr[s].mixModeStr=a||"source-over",(0,l.BB).ctx(this.layerCanvasArr[s]).drawImage(n[s].image,0,0)}}this.updateIndices()}return(0,s._)(e,[{key:"init",value:function(e,t){if(!e||!t||isNaN(e)||isNaN(t)||e<1||t<1)throw Error("init - invalid canvas size: "+e+", "+t);this.width=e,this.height=t}},{key:"emitChange",value:function(){this.changeListenerArr.forEach(function(e){return e()})}},{key:"updateIndices",value:function(){this.layerCanvasArr.forEach(function(e,t){e.index=t})}},{key:"getSelectionOrFallback",value:function(){var e;return null!==(e=this.selection)&&void 0!==e?e:[[[[0,0],[this.width,0],[this.width,this.height],[0,this.height],[0,0]]]]}},{key:"createSelectionSample",value:function(e){var t=this.getSelectionArea(e);if(!t){this.selectionSample={image:void 0,transformation:(0,m.identity)()};return}var i=this.layerCanvasArr[e],n=(0,l.BB).canvas(t.width,t.height),r=(0,l.BB).ctx(n);r.save(),r.translate(-t.x,-t.y),r.drawImage(i,0,0),r.restore(),this.selectionSample={image:n,transformation:(0,y.translate)(t.x,t.y)}}},{key:"transformSelectionAndSample",value:function(e){if(!this.selectionSample)throw Error("no selection sample");this.selection&&(this.selection=(0,b.transformMultiPolygon)(this.selection,e)),this.selectionSample.transformation=(0,f.compose)([e,this.selectionSample.transformation])}},{key:"drawSelectionSample",value:function(e,t){if(!this.selectionSample)throw Error("no selection sample");if(this.selectionSample.image){var i=this.layerCanvasArr[e],n=(0,l.BB).ctx(i),r=this.getSelectionOrFallback(),s=(0,x.getSelectionPath2d)(r);n.save(),n.clip(s),n.setTransform.apply(n,(0,o._)((0,C.matrixToTuple)(this.selectionSample.transformation))),t&&(n.imageSmoothingEnabled=!1),n.drawImage(this.selectionSample.image,0,0),n.restore()}}},{key:"setHistory",value:function(e){this.history=e}},{key:"reset",value:function(e){var t,i,n;if(!e.width||!e.height||e.width<1||e.height<1||isNaN(e.width)||isNaN(e.height))throw Error("invalid canvas size");if(null===(t=this.history)||void 0===t||t.pause(!0),this.width=e.width,this.height=e.height,this.selection=void 0,this.clearSelectionSample(),this.layerCanvasArr.splice(1,Math.max(0,this.layerCanvasArr.length-1)),e.layers)for(var r=0;r<e.layers.length;r++){var s=e.layers[r];this.layerCanvasArr[r]||this.addLayer(),this.layerCanvasArr[r].name=s.name,this.layerCanvasArr[r].isVisible=s.isVisible,this.layerCanvasArr[r].width=this.width,this.layerCanvasArr[r].height=this.height,this.layerCanvasArr[r].mixModeStr=s.mixModeStr?s.mixModeStr:"source-over",(0,l.BB).ctx(this.layerCanvasArr[r]).drawImage(s.image,0,0),this.layerOpacity(r,s.opacity)}else this.layerCanvasArr[0].name=e.layerName?e.layerName:(0,d.LANG)("layers-layer")+" 1",this.layerCanvasArr[0].isVisible=!0,this.layerCanvasArr[0].width=this.width,this.layerCanvasArr[0].height=this.height,this.layerCanvasArr[0].mixModeStr="source-over",this.layerOpacity(0,1),e.color?this.layerFill(0,e.color):e.image&&(0,l.BB).ctx(this.layerCanvasArr[0]).drawImage(e.image,0,0);return this.updateIndices(),null===(i=this.history)||void 0===i||i.pause(!1),null===(n=this.history)||void 0===n||n.push({tool:["canvas"],action:"reset",params:[e]}),this.layerCanvasArr.length-1}},{key:"isLayerLimitReached",value:function(){return this.layerCanvasArr.length>=L}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"copy",value:function(e){if(1>e.getWidth()||1>e.getHeight()||isNaN(e.getWidth())||isNaN(e.getHeight()))throw Error("invalid canvas size");null===(t=this.history)||void 0===t||t.pause(!0),this.selection=e.getSelection(),this.clearSelectionSample(),e.selectionSample&&(this.selectionSample={image:e.selectionSample.image?(0,l.BB).copyCanvas(e.selectionSample.image):void 0,transformation:(0,v.fromObject)(e.selectionSample.transformation)});for(var t,i,n=e.getLayers();this.layerCanvasArr.length>n.length;)this.removeLayer(this.layerCanvasArr.length-1);(e.getWidth()!=this.width||e.getHeight()!=this.height)&&this.init(e.getWidth(),e.getHeight());for(var r=0;r<n.length;r++)r>=this.layerCanvasArr.length?this.addLayer():(this.layerCanvasArr[r].width=this.width,this.layerCanvasArr[r].height=this.height),this.layerOpacity(r,n[r].opacity),this.layerCanvasArr[r].name=n[r].name,this.layerCanvasArr[r].isVisible=n[r].isVisible,this.layerCanvasArr[r].mixModeStr=n[r].mixModeStr,(0,l.BB).ctx(this.layerCanvasArr[r]).drawImage(n[r].context.canvas,0,0);this.updateIndices(),null===(i=this.history)||void 0===i||i.pause(!1)}},{key:"getLayerCount",value:function(){return this.layerCanvasArr.length}},{key:"resize",value:function(e,t){var i,n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"smooth";if(!e||!t||e===this.width&&t===this.height||isNaN(e)||isNaN(t)||e<1||t<1)return!1;if(e=Math.max(e,1),t=Math.max(t,1),"pixelated"===r){i=(0,l.BB).canvas(e,t);var s=(0,l.BB).ctx(i);s.imageSmoothingEnabled=!1;for(var a=0;a<this.layerCanvasArr.length;a++){a>0&&s.clearRect(0,0,e,t);var o=this.layerCanvasArr[a];s.drawImage(o,0,0,e,t),o.width=e,o.height=t,(0,l.BB).ctx(o).drawImage(i,0,0)}}else if("smooth"===r){i=(0,l.BB).canvas(),n=(0,l.BB).canvas();for(var h=0;h<this.layerCanvasArr.length;h++)(0,l.BB).resizeCanvas(this.layerCanvasArr[h],e,t,i,n)}else throw Error("unknown resize algorithm");return this.width=e,this.height=t,!0}},{key:"resizeCanvas",value:function(e){var t=Math.round(e.left)+this.width+Math.round(e.right),i=Math.round(e.top)+this.height+Math.round(e.bottom),n=Math.round(e.left),r=Math.round(e.top);if(isNaN(t)||isNaN(i)||t<1||i<1)throw Error("KlCanvas.resizeCanvas - invalid canvas size");for(var s=0;s<this.layerCanvasArr.length;s++){var a=(0,l.BB).canvas(this.width,this.height),o=this.layerCanvasArr[s],h=(0,l.BB).ctx(this.layerCanvasArr[s]);(0,l.BB).ctx(a).drawImage(o,0,0),this.layerCanvasArr[s].width=t,this.layerCanvasArr[s].height=i,h.save(),0===s&&e.fillColor&&(h.fillStyle=(0,l.BB).ColorConverter.toRgbStr(e.fillColor),h.fillRect(0,0,t,i),h.clearRect(n,r,this.width,this.height)),h.drawImage(a,n,r),h.restore()}this.width=t,this.height=i}},{key:"addLayer",value:function(e){if(this.isLayerLimitReached())return!1;var t,i,n,r=(0,l.BB).canvas(this.width,this.height);if(!r.getContext("2d"))throw Error("kl-create-canvas-error");return r.isVisible=!0,r.mixModeStr="source-over",void 0===e?(this.layerCanvasArr[this.layerCanvasArr.length]=r,e=Math.max(0,this.layerCanvasArr.length-1)):(this.layerCanvasArr.splice(e+1,0,r),e++),r.name=(0,d.LANG)("layers-layer")+" "+(this.layerCanvasArr.length+this.layerNrOffset),null===(t=this.history)||void 0===t||t.pause(!0),this.layerOpacity(e,1),null===(i=this.history)||void 0===i||i.pause(!1),this.updateIndices(),null===(n=this.history)||void 0===n||n.push({tool:["canvas"],action:"addLayer",params:[e-1]}),e}},{key:"duplicateLayer",value:function(e){if(!this.layerCanvasArr[e]||this.isLayerLimitReached())return!1;var t,i,n,r=(0,l.BB).canvas(this.width,this.height);return this.layerCanvasArr.splice(e+1,0,r),r.name=this.layerCanvasArr[e].name+" "+(0,d.LANG)("layers-copy"),r.isVisible=this.layerCanvasArr[e].isVisible,r.mixModeStr=this.layerCanvasArr[e].mixModeStr,(0,l.BB).ctx(r).putImageData((0,l.BB).ctx(this.layerCanvasArr[e]).getImageData(0,0,this.width,this.height),0,0),null===(t=this.history)||void 0===t||t.pause(!0),this.layerOpacity(e+1,this.layerCanvasArr[e].opacity),null===(i=this.history)||void 0===i||i.pause(!1),this.updateIndices(),null===(n=this.history)||void 0===n||n.push({tool:["canvas"],action:"duplicateLayer",params:[e]}),e+1}},{key:"getLayerContext",value:function(e,t){if(this.layerCanvasArr[e])return(0,l.BB).ctx(this.layerCanvasArr[e]);if(t)return null;throw Error("layer of index "+e+" not found (in "+this.layerCanvasArr.length+" layers)")}},{key:"removeLayer",value:function(e){var t;return!!this.layerCanvasArr[e]&&((0,l.BB).freeCanvas(this.layerCanvasArr[e]),this.layerCanvasArr.splice(e,1),this.updateIndices(),null===(t=this.history)||void 0===t||t.push({tool:["canvas"],action:"removeLayer",params:[e]}),Math.max(0,e-1))}},{key:"renameLayer",value:function(e,t){var i;return!!this.layerCanvasArr[e]&&(this.layerCanvasArr[e].name=t,null===(i=this.history)||void 0===i||i.push({tool:["canvas"],action:"renameLayer",params:[e,t]}),!0)}},{key:"layerOpacity",value:function(e,t){var i;this.layerCanvasArr[e]&&(t=Math.max(0,Math.min(1,t)),this.layerCanvasArr[e].opacity=t,null===(i=this.history)||void 0===i||i.push({tool:["canvas"],action:"layerOpacity",params:[e,t]}),this.emitChange())}},{key:"setLayerIsVisible",value:function(e,t){var i;if(this.layerCanvasArr[e])this.layerCanvasArr[e].isVisible=t;else throw Error(`layer ${e} undefined`);null===(i=this.history)||void 0===i||i.push({tool:["canvas"],action:"setLayerIsVisible",params:[e,t]})}},{key:"moveLayer",value:function(e,t){if(0!==t&&this.layerCanvasArr[e]){var i,n=this.layerCanvasArr[e];this.layerCanvasArr.splice(e,1);var r=Math.max(0,Math.min(e+t,this.layerCanvasArr.length));return this.layerCanvasArr.splice(r,0,n),this.updateIndices(),null===(i=this.history)||void 0===i||i.push({tool:["canvas"],action:"moveLayer",params:[e,t]}),r}}},{key:"mergeLayers",value:function(e,t,i){if(this.layerCanvasArr[e]&&this.layerCanvasArr[t]&&e!==t){if(e>t){var n,r,s,a=e;e=t,t=a}var o=this.layerCanvasArr[t].opacity;if(0!==o&&o){var h=(0,l.BB).ctx(this.layerCanvasArr[e]);h.save(),"as-alpha"===i?((0,l.BB).convertToAlphaChannelCanvas(this.layerCanvasArr[t]),h.globalCompositeOperation="destination-in"):i&&(h.globalCompositeOperation=i),h.globalAlpha=o,(0,l.BB).ctx(this.layerCanvasArr[e]).drawImage(this.layerCanvasArr[t],0,0),h.restore(),i&&(h.save(),h.fillStyle="rgba(0,0,0,0.01)",h.fillRect(-.9999999,-.9999999,1,1),h.restore())}return this.updateIndices(),null===(n=this.history)||void 0===n||n.pause(!0),this.removeLayer(t),null===(r=this.history)||void 0===r||r.pause(!1),null===(s=this.history)||void 0===s||s.push({tool:["canvas"],action:"mergeLayers",params:[e,t,i]}),e}}},{key:"mergeAll",value:function(){if(1===this.layerCanvasArr.length)return!1;for(var e,t,i,n=(0,l.BB).ctx(this.layerCanvasArr[0]),r=1;r<this.layerCanvasArr.length;r++){var s=this.layerCanvasArr[r];s.isVisible&&0!==s.opacity&&(n.save(),n.globalCompositeOperation=s.mixModeStr,n.globalAlpha=s.opacity,n.drawImage(s,0,0),n.restore())}null===(e=this.history)||void 0===e||e.pause(!0);for(var a=this.layerCanvasArr.length-1;a>0;a--)this.removeLayer(a);return this.renameLayer(0,(0,d.LANG)("layers-layer")+" 1"),null===(t=this.history)||void 0===t||t.pause(!1),null===(i=this.history)||void 0===i||i.push({tool:["canvas"],action:"mergeAll",params:[]}),0}},{key:"rotate",value:function(e){for(;e<0;)e+=360;if((e%=360)%90==0&&0!==e){var t=(0,l.BB).canvas();0===e||180===e?(t.width=this.width,t.height=this.height):(90===e||270===e)&&(t.width=this.height,t.height=this.width);for(var i=(0,l.BB).ctx(t),n=0;n<this.layerCanvasArr.length;n++)i.clearRect(0,0,t.width,t.height),i.save(),i.translate(t.width/2,t.height/2),i.rotate(e*Math.PI/180),180===e?i.drawImage(this.layerCanvasArr[n],-t.width/2,-t.height/2):(90===e||270===e)&&i.drawImage(this.layerCanvasArr[n],-t.height/2,-t.width/2),this.layerCanvasArr[n].width=t.width,this.layerCanvasArr[n].height=t.height,(0,l.BB).ctx(this.layerCanvasArr[n]).clearRect(0,0,this.layerCanvasArr[n].width,this.layerCanvasArr[n].height),(0,l.BB).ctx(this.layerCanvasArr[n]).drawImage(t,0,0),i.restore();this.width=t.width,this.height=t.height}}},{key:"flip",value:function(e,t,i){if(e||t){var n=(0,l.BB).canvas(this.width,this.height);n.width=this.width,n.height=this.height;for(var r=(0,l.BB).ctx(n),s=0;s<this.layerCanvasArr.length;s++)(i||0===i)&&s!==i||(r.save(),r.clearRect(0,0,n.width,n.height),r.translate(n.width/2,n.height/2),r.scale(e?-1:1,t?-1:1),r.drawImage(this.layerCanvasArr[s],-n.width/2,-n.height/2),r.restore(),(0,l.BB).ctx(this.layerCanvasArr[s]).clearRect(0,0,this.layerCanvasArr[s].width,this.layerCanvasArr[s].height),(0,l.BB).ctx(this.layerCanvasArr[s]).drawImage(n,0,0))}}},{key:"layerFill",value:function(e,t,i,n){var r,s=(0,l.BB).ctx(this.layerCanvasArr[e]);if(s.save(),i&&(s.globalCompositeOperation=i),n&&this.selection){var a=(0,x.getSelectionPath2d)(this.selection);s.clip(a)}s.fillStyle="rgba("+t.r+","+t.g+","+t.b+",1)",s.fillRect(0,0,this.layerCanvasArr[e].width,this.layerCanvasArr[e].height),s.restore(),s.save(),s.fillStyle="rgba(0,0,0,0.01)",s.fillRect(-.9999999,-.9999999,1,1),s.restore(),null===(r=this.history)||void 0===r||r.push({tool:["canvas"],action:"layerFill",params:[e,t,i,n]})}},{key:"floodFill",value:function(e,t,i,n,r,s,a,o,c){if(!(t<0)&&!(i<0)&&!(t>=this.width)&&!(i>=this.height)&&0!==r){if(s=Math.round(s),!["above","current","all"].includes(a))throw Error("invalid sampleStr");if("all"===a){var u,p,d,g,f=1===this.layerCanvasArr.length?this.layerCanvasArr[0]:this.getCompleteCanvas(1),v=(0,l.BB).ctx(f).getImageData(0,0,this.width,this.height).data;p=(0,h.floodFillBits)(v,this.width,this.height,t,i,s,Math.round(o),c),g=(d=(0,l.BB).ctx(this.layerCanvasArr[e])).getImageData(0,0,this.width,this.height)}else{var m="above"===a?e+1:e;if(m>=this.layerCanvasArr.length)return;var y=(0,l.BB).ctx(this.layerCanvasArr[m]),x=y.getImageData(0,0,this.width,this.height),b=x.data;p=(0,h.floodFillBits)(b,this.width,this.height,t,i,s,Math.round(o),c),d=e===m?y:(0,l.BB).ctx(this.layerCanvasArr[e]),g=e===m?x:d.getImageData(0,0,this.width,this.height)}var B=g.data;if(n){if(1===r)for(var w=0;w<this.width*this.height;w++)255===p.data[w]&&(B[4*w]=n.r,B[4*w+1]=n.g,B[4*w+2]=n.b,B[4*w+3]=255);else for(var k=0;k<this.width*this.height;k++)255===p.data[k]&&(B[4*k]=(0,l.BB).mix(B[4*k],n.r,r),B[4*k+1]=(0,l.BB).mix(B[4*k+1],n.g,r),B[4*k+2]=(0,l.BB).mix(B[4*k+2],n.b,r),B[4*k+3]=(0,l.BB).mix(B[4*k+3],255,r))}else if(1===r)for(var C=0;C<this.width*this.height;C++)255===p.data[C]&&(B[4*C+3]=0);else for(var S=0;S<this.width*this.height;S++)255===p.data[S]&&(B[4*S+3]=(0,l.BB).mix(B[4*S+3],0,r));d.putImageData(g,0,0),null===(u=this.history)||void 0===u||u.push({tool:["canvas"],action:"replaceLayer",params:[e,g]})}}},{key:"drawShape",value:function(e,t){var i;(t.x1!==t.x2||t.y1!==t.y2)&&((0,c.drawShape)((0,l.BB).ctx(this.layerCanvasArr[e]),t),null===(i=this.history)||void 0===i||i.push({tool:["canvas"],action:"drawShape",params:[e,(0,l.BB).copyObj(t)]}))}},{key:"drawGradient",value:function(e,t){var i;(0,g.drawGradient)((0,l.BB).ctx(this.layerCanvasArr[e]),t),null===(i=this.history)||void 0===i||i.push({tool:["canvas"],action:"drawGradient",params:[e,(0,l.BB).copyObj(t)]})}},{key:"text",value:function(e,t){var i;(0,u.renderText)(this.layerCanvasArr[e],(0,l.BB).copyObj(t)),null===(i=this.history)||void 0===i||i.push({tool:["canvas"],action:"text",params:[e,(0,l.BB).copyObj(t)]})}},{key:"replaceLayer",value:function(e,t){var i;(0,l.BB).ctx(this.layerCanvasArr[e]).putImageData(t,0,0),null===(i=this.history)||void 0===i||i.push({tool:["canvas"],action:"replaceLayer",params:[e,t]})}},{key:"eraseLayer",value:function(e){var t,i=(0,l.BB).ctx(this.layerCanvasArr[e.layerIndex]);if(i.save(),e.useSelection&&this.selection){var n=(0,x.getSelectionPath2d)(this.selection);i.clip(n)}e.useAlphaLock?i.globalCompositeOperation="source-in":i.globalCompositeOperation="destination-out",i.fillStyle="#fff",i.fillRect(0,0,this.width,this.height),i.restore(),null===(t=this.history)||void 0===t||t.push({tool:["canvas"],action:"eraseLayer",params:[e]})}},{key:"moveRect",value:function(e,t,i){var n,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=(0,l.BB).ctx(this.layerCanvasArr[e]);s.save();var o={x:t.width>0?t.x:t.x+t.width,y:t.height>0?t.y:t.y+t.height,width:Math.abs(-t.width),height:Math.abs(-t.height)};if(r)s.drawImage(s.canvas,o.x,o.y,o.width,o.height,o.x+i.x,o.y+i.y,o.width,o.height);else{var h=(0,l.BB).canvas(o.width,o.height);h.getContext("2d").drawImage(s.canvas,-o.x,-o.y),s.clearRect(o.x,o.y,o.width,o.height),s.drawImage(h,o.x+i.x,o.y+i.y),(0,l.BB).freeCanvas(h)}s.restore(),null===(n=this.history)||void 0===n||n.push({tool:["canvas"],action:"moveRect",params:[e,(0,a._)({},o),(0,a._)({},i),r]})}},{key:"getLayers",value:function(){return this.layerCanvasArr.map(function(e){return{context:(0,l.BB).ctx(e),isVisible:e.isVisible,opacity:e.opacity,name:e.name,mixModeStr:e.mixModeStr}})}},{key:"getLayersFast",value:function(){return this.layerCanvasArr.map(function(e){return{canvas:e,isVisible:e.isVisible,opacity:e.opacity,name:e.name,mixModeStr:e.mixModeStr}})}},{key:"getLayerIndex",value:function(e,t){for(var i=0;i<this.layerCanvasArr.length;i++)if(this.layerCanvasArr[i]===e)return i;if(!t)throw Error("layer not found (in "+this.layerCanvasArr.length+" layers)");return null}},{key:"getLayer",value:function(e,t){if(this.layerCanvasArr[e])return{context:(0,l.BB).ctx(this.layerCanvasArr[e]),isVisible:this.layerCanvasArr[e].isVisible,opacity:this.layerCanvasArr[e].opacity,name:this.layerCanvasArr[e].name,id:e};if(!t)throw Error("layer of index "+e+" not found (in "+this.layerCanvasArr.length+" layers)");return null}},{key:"getColorAt",value:function(e,t){e=Math.floor(e),t=Math.floor(t);var i=(0,l.BB).ctx(this.pickCanvas);i.save(),i.imageSmoothingEnabled=!1,i.clearRect(0,0,1,1);for(var n=0;n<this.layerCanvasArr.length;n++){var r=this.layerCanvasArr[n];r.isVisible&&0!==r.opacity&&(i.globalAlpha=r.opacity,i.globalCompositeOperation=r.mixModeStr,i.drawImage(r,-e,-t))}i.restore();var s=i.getImageData(0,0,1,1);return new l.BB.RGB(s.data[0],s.data[1],s.data[2])}},{key:"getCompleteCanvas",value:function(e){return(0,p.drawProject)(this.getProject(),e)}},{key:"getProject",value:function(){return{width:this.width,height:this.height,layers:this.layerCanvasArr.map(function(e){return{name:e.name,isVisible:e.isVisible,opacity:e.opacity,mixModeStr:e.mixModeStr,image:e}})}}},{key:"addChangeListener",value:function(e){this.changeListenerArr.includes(e)||this.changeListenerArr.push(e)}},{key:"removeChangeListener",value:function(e){for(var t=0;t<this.changeListenerArr.length;t++)if(this.changeListenerArr[t]===e){this.changeListenerArr.splice(t,1);return}}},{key:"setMixMode",value:function(e,t){var i;if(!this.layerCanvasArr[e])throw Error("invalid layer");this.layerCanvasArr[e].mixModeStr=t,null===(i=this.history)||void 0===i||i.push({tool:["canvas"],action:"setMixMode",params:[e,""+t]})}},{key:"setComposite",value:function(e,t){if(!this.layerCanvasArr[e])throw Error("invalid layer");this.layerCanvasArr[e].compositeObj=t}},{key:"setSelection",value:function(e){var t;(this.selection||e)&&(this.selection=e,null===(t=this.history)||void 0===t||t.push({tool:["canvas"],action:"setSelection",params:[e],isFree:!0}))}},{key:"getSelection",value:function(){return this.selection}},{key:"transformViaSelection",value:function(e){var t,i,n,r,s;null===(t=this.history)||void 0===t||t.pause(!0),this.createSelectionSample(e.sourceLayer),this.eraseLayer({layerIndex:e.sourceLayer,useSelection:!0}),this.transformSelectionAndSample(e.transformation),this.drawSelectionSample(null!==(r=e.targetLayer)&&void 0!==r?r:e.sourceLayer,null!==(s=e.isPixelated)&&void 0!==s&&s),null===(i=this.history)||void 0===i||i.pause(!1),null===(n=this.history)||void 0===n||n.push({tool:["canvas"],action:"transformViaSelection",params:[e]})}},{key:"transformCloneViaSelection",value:function(e){var t,i,n,r;if(null===(t=this.history)||void 0===t||t.pause(!0),!this.selectionSample){if(void 0===e.sourceLayer)throw Error("no source layer");this.createSelectionSample(e.sourceLayer)}this.transformSelectionAndSample(e.transformation),this.drawSelectionSample(e.targetLayer,null!==(r=e.isPixelated)&&void 0!==r&&r),null===(i=this.history)||void 0===i||i.pause(!1),null===(n=this.history)||void 0===n||n.push({tool:["canvas"],action:"transformCloneViaSelection",params:[e]})}},{key:"clearSelectionSample",value:function(){var e;this.selectionSample&&(this.selectionSample.image&&(0,l.BB).freeCanvas(this.selectionSample.image),this.selectionSample=void 0,null===(e=this.history)||void 0===e||e.push({tool:["canvas"],action:"clearSelectionSample",isHidden:!0,params:[]}))}},{key:"getSelectionArea",value:function(e){var t=this.layerCanvasArr[e],i=(0,l.BB).ctx(t),n=this.getSelectionOrFallback(),r=(0,B.getMultiPolyBounds)(n),s=(0,w.intBoundsWithinArea)(r,this.width,this.height);if(s)return(0,k.canvasBounds)(i,s)}},{key:"getSelectionSample",value:function(){return this.selectionSample}},{key:"getHistory",value:function(){return this.history}},{key:"destroy",value:function(){this.isDestroyed||(this.layerCanvasArr.forEach(function(e){(0,l.BB).freeCanvas(e)}),this.layerCanvasArr=[],this.isDestroyed=!0)}}]),e}()}),n("30Cml",function(t,i){var n,r;function s(e,t,i,s,a){if(n=i%e+s,r=Math.floor(i/e)+a,!(n<0)&&!(r<0)&&!(n>=e)&&!(r>=t))return r*e+n}function a(e,t,i,n,r,s,a){return void 0!==a&&255!==t[a]&&!!(e[4*a]===r[0]&&e[4*a+1]===r[1]&&e[4*a+2]===r[2]&&e[4*a+3]===r[3]||s>0&&Math.abs(e[4*a]-r[0])<=s&&Math.abs(e[4*a+1]-r[1])<=s&&Math.abs(e[4*a+2]-r[2])<=s&&Math.abs(e[4*a+3]-r[3])<=s)&&(t[a]=255,!0)}function o(e,t,i,n,r,o,l,h){n=Math.round(n),r=Math.round(r);var c=new Uint8Array(new ArrayBuffer(t*i));return function(e,t,i,n,r,o,l,h,c){var u,p,d,g,f,v,m,y,x,b,B,w,k=[e[(o*i+r)*4],e[(o*i+r)*4+1],e[(o*i+r)*4+2],e[(o*i+r)*4+3]];if(c){var C,S,E=[];for(E.push(o*i+r),t[o*i+r]=255;E.length;)S=s(i,n,C=E.pop(),-1,0),a(e,t,i,n,k,l,S)&&E.push(S),S=s(i,n,C,1,0),a(e,t,i,n,k,l,S)&&E.push(S),S=s(i,n,C,0,-1),a(e,t,i,n,k,l,S)&&E.push(S),S=s(i,n,C,0,1),a(e,t,i,n,k,l,S)&&E.push(S)}else for(var L=0;L<i*n;L++)a(e,t,i,n,k,l,L);if(0!==h){for(var A=0;A<i;A++)for(var I=0;I<n;I++)255===t[I*i+A]&&(u=A,p=A,d=I,g=I,f=255!==t[I*i+A-1],v=255!==t[(I-1)*i+A-1],m=255!==t[(I-1)*i+A],y=255!==t[(I-1)*i+A+1],x=255!==t[I*i+A+1],b=255!==t[(I+1)*i+A+1],B=255!==t[(I+1)*i+A],w=255!==t[(I+1)*i+A-1],f&&(u=A-h),f&&v&&m&&(u=A-h,d=I-h),m&&(d=Math.min(d,I-h)),m&&y&&x&&(d=Math.min(d,I-h),p=A+h),x&&(p=Math.max(p,A+h)),x&&b&&B&&(p=Math.max(p,A+h),g=Math.max(g,I+h)),B&&(g=Math.max(g,I+h)),B&&w&&f&&(u=Math.min(u,A-h),g=Math.max(g,I+h)),(f||v||m||y||x||b||B||w)&&function(e,t,i,n,r,s){for(var a=i;a<=r;a++)for(var o=n;o<=s;o++)255!==e[o*t+a]&&(e[o*t+a]=254)}(t,i,Math.max(0,u),Math.max(0,d),Math.min(i-1,p),Math.min(n-1,g)));for(var T=0;T<i*n;T++)254===t[T]&&(t[T]=255)}}(e,c,t,i,n,r,o,l,h),{data:c}}e(t.exports,"floodFillBits",function(){return o})}),n("3ujzu",function(t,n){e(t.exports,"ShapeTool",function(){return l}),e(t.exports,"drawShape",function(){return h});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("eWjiX"),l=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.downX=0,this.downY=0,this.downAngleRad=0,this.onShape=t.onShape}return(0,s._)(e,[{key:"onDown",value:function(e,t,i){this.downX=e,this.downY=t,this.downAngleRad=i}},{key:"onMove",value:function(e,t){this.onShape(!1,this.downX,this.downY,e,t,this.downAngleRad)}},{key:"onUp",value:function(e,t){this.onShape(!0,this.downX,this.downY,e,t,this.downAngleRad)}}]),e}();function h(e,t){if(["rect","ellipse","line"].includes((t=(0,a._)({angleRad:0,isOutwards:!1,opacity:1,isEraser:!1,doLockAlpha:!1},(0,o.BB).copyObj(t))).type)){if(void 0===t.angleRad)throw Error("angleRad undefined");var i,n,r=void 0===t.lineWidth?-1:Math.round(t.lineWidth),s=180*t.angleRad/Math.PI;if(!t.isEraser&&void 0===t.fillRgb&&void 0===t.strokeRgb)throw Error("fillRgb and strokeRgb undefined");var l=t.isEraser?{r:255,g:255,b:255}:t.fillRgb?t.fillRgb:t.strokeRgb;e.save(),t.opacity&&(e.globalAlpha=t.opacity),t.isEraser&&(e.globalCompositeOperation="destination-out"),t.doLockAlpha&&(e.globalCompositeOperation="source-atop"),e.rotate(-t.angleRad),t.fillRgb?e.fillStyle=(0,o.BB).ColorConverter.toRgbStr(l):t.strokeRgb&&(e.strokeStyle=(0,o.BB).ColorConverter.toRgbStr(l),e.lineWidth=r);var h=t.x1,c=t.y1,u=t.x2,p=t.y2;if(t.isAngleSnap){var d=(0,o.BB).rotate(h,c,t.angleRad/Math.PI*180),g=(0,o.BB).rotate(u,p,t.angleRad/Math.PI*180),f=(0,o.BB).pointsToAngleDeg(d,g)+90,v=45*Math.round(f/45),m=(0,o.BB).rotateAround({x:h,y:c},{x:u,y:p},v-f);u=m.x,p=m.y,(s+v)%90==0&&(Math.round((s-v)/90)%2==0?u=h:p=c)}var y=h,x=c,b=u-h,B=p-c;if("line"!==t.type&&t.isFixedRatio){var w=(0,o.BB).rotate(t.x1,t.y1,t.angleRad/Math.PI*180),k=(0,o.BB).rotate(t.x2,t.y2,t.angleRad/Math.PI*180),C=w.x,S=w.y,E=k.x-w.x,L=k.y-w.y;Math.abs(E)<Math.abs(L)?L=Math.abs(E)*(L<0?-1:1):E=Math.abs(L)*(E<0?-1:1),k.x=C+E,k.y=S+L,w=(0,o.BB).rotate(w.x,w.y,-t.angleRad/Math.PI*180),k=(0,o.BB).rotate(k.x,k.y,-t.angleRad/Math.PI*180),h=w.x,c=w.y,u=k.x,p=k.y,y=h,x=c,b=u-h,B=p-c}if(t.isOutwards&&(y-=b,x-=B,b*=2,B*=2,h=y,c=x,u=y+b,p=x+B),"line"===t.type){var A=Math.round(h),I=Math.round(c),T=Math.round(u),P=Math.round(p),R=Math.floor(h),M=Math.floor(c),D=Math.floor(u),O=Math.floor(p);r%2==0?I===P?(i={x:R,y:I},n={x:D,y:P},R<D?n.x+=1:i.x+=1):A===T?(i={x:A,y:M},n={x:T,y:O},M<O?n.y+=1:i.y+=1):(i={x:h,y:c},n={x:u,y:p}):(i={x:R,y:M},n={x:D,y:O},M===O?(R<D?n.x+=1:i.x+=1,i.y+=.5,n.y+=.5):R===D?(M<O?n.y+=1:i.y+=1,i.x+=.5,n.x+=.5):(i.x=h,i.y=c,n.x=u,n.y=p)),i=(0,o.BB).rotate(i.x,i.y,t.angleRad/Math.PI*180),n=(0,o.BB).rotate(n.x,n.y,t.angleRad/Math.PI*180),e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(n.x,n.y),e.stroke()}else if("rect"===t.type){var _=Math.floor(h),N=Math.floor(c),z=Math.floor(u),G=Math.floor(p);s%90==0?t.fillRgb?(h%1==0&&(h+=1),c%1==0&&(c+=1),u%1==0&&(u+=1),p%1==0&&(p+=1),i={x:h<u?_:z,y:c<p?N:G},(n={x:Math.ceil((h<u?u:h)-i.x),y:Math.ceil((c<p?p:c)-i.y)}).x=i.x+n.x,n.y=i.y+n.y):r%2==0?(i={x:_,y:N},n={x:z,y:G}):(i={x:_+.5,y:N+.5},n={x:z+.5,y:G+.5}):(i={x:h,y:c},n={x:u,y:p}),i=(0,o.BB).rotate(i.x,i.y,t.angleRad/Math.PI*180),(n=(0,o.BB).rotate(n.x,n.y,t.angleRad/Math.PI*180)).x=n.x-i.x,n.y=n.y-i.y,t.fillRgb?e.fillRect(i.x,i.y,n.x,n.y):e.strokeRect(i.x,i.y,n.x,n.y)}else i=(0,o.BB).rotate(h,c,t.angleRad/Math.PI*180),n=(0,o.BB).rotate(u,p,t.angleRad/Math.PI*180),y=i.x,x=i.y,b=n.x-i.x,B=n.y-i.y,e.beginPath(),e.ellipse(y+b/2,x+B/2,Math.abs(b/2),Math.abs(B/2),0,0,2*Math.PI),t.fillRgb?e.fill():e.stroke();e.restore()}else throw Error("unknown shape")}}),n("h20yl",function(t,n){e(t.exports,"renderText",function(){return s});var r=i("eWjiX");function s(e,t){t=(0,r.BB).copyObj(t);var i=(0,r.BB).ctx(e);i.save(),i.textAlign=t.align,i.letterSpacing=t.letterSpacing?t.letterSpacing+"px":"0";var n=[t.size+"px "+(t.font?t.font:"sans-serif")];t.isBold&&n.unshift("bold"),t.isItalic&&n.unshift("italic"),i.font=n.join(" "),i.fillStyle=t.fill?(0,r.BB).ColorConverter.toRgbaStr(t.fill.color):"transparent",i.strokeStyle=t.stroke?(0,r.BB).ColorConverter.toRgbaStr(t.stroke.color):"transparent",t.stroke&&(i.lineWidth=t.stroke.lineWidth,i.lineJoin="round"),i.translate(t.x,t.y),i.rotate(-t.angleRad);var s=t.text.split("\n").map(function(e){return e.replaceAll("	","    ")}),a={x1:0,y1:0,x2:0,y2:0},o=!0;return s.forEach(function(e,n){var r,s,l,h,c,u,p=i.measureText(e),d=t.size*(null!==(u=t.lineHeight)&&void 0!==u?u:1)*n,g=(r=t.align,h=null!==(s=p.fontBoundingBoxAscent)&&void 0!==s?s:p.actualBoundingBoxAscent,c=null!==(l=p.fontBoundingBoxDescent)&&void 0!==l?l:p.actualBoundingBoxDescent,"left"===r?{x:0,y:-h,width:p.width,height:h+c}:"right"===r?{x:-p.width,y:-h,width:p.width,height:h+c}:{x:-p.width/2,y:-h,width:p.width,height:h+c});o?(o=!1,a.x1=0+g.x,a.y1=d+g.y,a.x2=0+g.x+g.width,a.y2=d+g.y+g.height):(a.x1=Math.min(a.x1,0+g.x),a.y1=Math.min(a.y1,d+g.y),a.x2=Math.max(a.x2,0+g.x+g.width),a.y2=Math.max(a.y2,d+g.y+g.height))}),s.forEach(function(e,n){var r,s=t.size*(null!==(r=t.lineHeight)&&void 0!==r?r:1)*n;i.strokeText(e,0,s)}),s.forEach(function(e,n){var r,s=t.size*(null!==(r=t.lineHeight)&&void 0!==r?r:1)*n;i.fillText(e,0,s)}),i.restore(),{x:a.x1,y:a.y1,width:a.x2-a.x1,height:a.y2-a.y1}}}),n("aSJRf",function(t,n){e(t.exports,"drawProject",function(){return s});var r=i("eWjiX");function s(e,t){var i=(0,r.BB).canvas(Math.max(1,Math.round(e.width*t)),Math.max(1,Math.round(e.height*t))),n=(0,r.BB).ctx(i);n.save(),t>1&&(n.imageSmoothingEnabled=!1);for(var s=0;s<e.layers.length;s++){var a=e.layers[s];if(a.isVisible&&0!==a.opacity){n.globalAlpha=a.opacity;var o=a.mixModeStr;n.globalCompositeOperation=void 0!==o?o:"source-over",n.drawImage(a.image,0,0,i.width,i.height)}}return n.restore(),i}}),n("7EG77",function(t,n){e(t.exports,"GradientTool",function(){return h}),e(t.exports,"drawGradient",function(){return c});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("4EWN2"),l=i("eWjiX"),h=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.downX=0,this.downY=0,this.downAngleRad=0,this.onGradient=t.onGradient}return(0,s._)(e,[{key:"onDown",value:function(e,t,i){this.downX=e,this.downY=t,this.downAngleRad=i}},{key:"onMove",value:function(e,t){this.onGradient(!1,this.downX,this.downY,e,t,this.downAngleRad)}},{key:"onUp",value:function(e,t){this.onGradient(!0,this.downX,this.downY,e,t,this.downAngleRad)}}]),e}();function c(e,t){e.save();var i,n=t.x1,r=t.y1,s=t.x2,h=t.y2;if(t.doSnap){var c=180*t.angleRad/Math.PI,u=(0,l.BB).rotate(n,r,t.angleRad/Math.PI*180),p=(0,l.BB).rotate(s,h,t.angleRad/Math.PI*180),d=(0,l.BB).pointsToAngleDeg(u,p)+90,g=45*Math.round(d/45),f=(0,l.BB).rotateAround({x:n,y:r},{x:s,y:h},g-d);s=f.x,h=f.y,(c+g)%90==0&&(Math.round((c-g)/90)%2==0?s=n:h=r)}var v=t.color1;t.isEraser&&t.doLockAlpha&&(v={r:255,g:255,b:255});var m=(0,o._)((0,a._)({},v),{a:t.opacity}),y=(0,o._)((0,a._)({},v),{a:0});if(t.isReversed){var x=m;m=y,y=x}if("linear"===t.type)(i=e.createLinearGradient(n,r,s,h)).addColorStop(0,(0,l.BB).ColorConverter.toRgbaStr(m)),i.addColorStop(1,(0,l.BB).ColorConverter.toRgbaStr(y));else if("linear-mirror"===t.type){var b={x:s-n,y:h-r};(i=e.createLinearGradient(n-b.x,r-b.y,s,h)).addColorStop(0,(0,l.BB).ColorConverter.toRgbaStr(y)),i.addColorStop(.5,(0,l.BB).ColorConverter.toRgbaStr(m)),i.addColorStop(1,(0,l.BB).ColorConverter.toRgbaStr(y))}else if("radial"===t.type){var B=(0,l.BB).Vec2.dist({x:n,y:r},{x:s,y:h});(i=e.createRadialGradient(n,r,0,n,r,B)).addColorStop(0,(0,l.BB).ColorConverter.toRgbaStr(m)),i.addColorStop(1,(0,l.BB).ColorConverter.toRgbaStr(y))}e.fillStyle=i,t.isEraser&&(e.globalCompositeOperation="destination-out"),t.doLockAlpha&&(e.globalCompositeOperation="source-atop"),e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore()}}),n("9b3eo",function(t,n){e(t.exports,"getSelectionPath2d",function(){return s}),e(t.exports,"getSvgPathD",function(){return a});var r=i("bX4ja");function s(e){var t=new Path2D;return e.forEach(function(e){e.forEach(function(e){e.forEach(function(e,i){0===i?t.moveTo.apply(t,(0,r._)(e)):t.lineTo.apply(t,(0,r._)(e))})}),t.closePath()}),t}function a(e){var t="";return e.forEach(function(e){e.forEach(function(e){t+="M",e.forEach(function(e){t+=e.join(",")+" "})})}),t.trim()}}),n("bbA6w",function(t,n){e(t.exports,"transformMultiPolygon",function(){return s}),i("ciAU9");var r=i("cdZRx");function s(e,t){return e.map(function(e){return e.map(function(e){return e.map(function(e){return Object.values((0,r.applyToPoint)(t,{x:e[0],y:e[1]}))})})})}}),n("g03EN",function(t,i){e(t.exports,"getMultiPolyBounds",function(){return n});function n(e){var t=void 0,i=void 0,n=void 0,r=void 0;if(e.forEach(function(e){e.forEach(function(e){e.forEach(function(e){t=void 0===t?e[0]:Math.min(t,e[0]),i=void 0===i?e[1]:Math.min(i,e[1]),n=void 0===n?e[0]:Math.max(n,e[0]),r=void 0===r?e[1]:Math.max(r,e[1])})})}),void 0===t||void 0===i||void 0===n||void 0===r)throw"empty poly";return{x1:t,y1:i,x2:n,y2:r}}}),n("bBcC4",function(t,n){e(t.exports,"translateBlending",function(){return s});var r=i("1mH1z");function s(e){if(!e)return(0,r.LANG)("layers-blend-normal");var t={"source-over":"layers-blend-normal",darken:"layers-blend-darken",multiply:"layers-blend-multiply","color-burn":"layers-blend-color-burn",lighten:"layers-blend-lighten",screen:"layers-blend-screen","color-dodge":"layers-blend-color-dodge",overlay:"layers-blend-overlay","soft-light":"layers-blend-soft-light","hard-light":"layers-blend-hard-light",difference:"layers-blend-difference",exclusion:"layers-blend-exclusion",hue:"layers-blend-hue",saturation:"layers-blend-saturation",color:"layers-blend-color",luminosity:"layers-blend-luminosity"};if(!(e in t))throw Error("unknown blend mode");return(0,r.LANG)(t[e])}}),n("50Lcc",function(n,r){e(n.exports,"renameLayerDialog",function(){return h});var s=i("eWjiX"),a=i("1mH1z"),o=i("2MaaK"),l=i("4UZXr");function h(e,i,n){var r=(0,s.BB).el(),h=(0,s.BB).el({content:(0,a.LANG)("layers-rename-name")+":",css:{marginRight:"5px"}}),c=(0,s.BB).el({css:{display:"flex"}}),u=(0,s.BB).el({tagName:"input"});u.value=i,u.setAttribute("data-ignore-focus","true");var p=(0,s.BB).el({tagName:"button",content:'<img src="'+/*@__PURE__*/t(l)+'" height="20"/>',title:(0,a.LANG)("layers-rename-clear"),css:{marginLeft:"10px"},onClick:function(){u.value="",u.focus()}}),d=[(0,a.LANG)("layers-rename-sketch"),(0,a.LANG)("layers-rename-colors"),(0,a.LANG)("layers-rename-shading"),(0,a.LANG)("layers-rename-lines"),(0,a.LANG)("layers-rename-effects"),(0,a.LANG)("background"),(0,a.LANG)("layers-rename-foreground")],g=[],f=(0,s.BB).el({css:{display:"flex",flexWrap:"wrap",marginTop:"5px",marginLeft:"-5px"}});d.forEach(function(e){var t=(0,s.BB).el({parent:f,tagName:"button",content:e,onClick:function(){u.value=""+t.textContent},css:{margin:"5px 0 0 5px"}});g.push(t)}),r.append(h),h.append(c,f),c.append(u,p),setTimeout(function(){u.focus(),u.select()},10),(0,o.showModal)({target:e,message:`<b>${(0,a.LANG)("layers-rename-title")}</b>`,div:r,buttons:[(0,a.LANG)("layers-rename"),"Cancel"],primaries:[(0,a.LANG)("layers-rename")],callback:function(e){(0,s.BB).destroyEl(p),g.forEach(function(e){(0,s.BB).destroyEl(e)}),g.splice(0,g.length),e===(0,a.LANG)("layers-rename")?n(u.value):n(void 0)},clickOnEnter:(0,a.LANG)("layers-rename")})}}),n("4UZXr",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"remove-layer.4e9b2b7d.svg"}),n("dsnzg",function(t,n){e(t.exports,"mergeLayerDialog",function(){return c});var r=i("eWjiX"),s=i("1mH1z"),a=i("iFIyy"),o=i("bBcC4"),l=i("2MaaK"),h=i("1C8RU");function c(e,t){var i=(0,r.BB).el();i.innerHTML=(0,s.LANG)("layers-merge-description");var n=new a.Options({optionArr:[{id:t.mixModeStr,label:(0,o.translateBlending)(t.mixModeStr)},{id:"source-in",label:"source-in"},{id:"source-out",label:"source-out"},{id:"source-atop",label:"source-atop"},{id:"destination-in",label:"destination-in"},{id:"destination-out",label:"destination-out"},{id:"destination-atop",label:"destination-atop"},{id:"xor",label:"xor"}],initId:t.mixModeStr,onChange:function(){f()},isSmall:!0});n.getElement().style.marginTop="5px",i.append(n.getElement());var c=(0,r.BB).fitInto(t.topCanvas.width,t.topCanvas.height,200,200,1),u=(0,r.BB).canvas(c.width,c.height);u.title=(0,s.LANG)("preview"),u.className="kl-merge-preview";var p=(0,r.BB).el({content:"<br/>",css:{clear:"both"}});function d(){(0,r.BB).createCheckerDataUrl(4,function(e){u.style.backgroundImage="url("+e+")"},(0,h.theme).isDark())}i.append(p,u),d(),(0,h.theme).addIsDarkListener(d);var g=(0,r.BB).copyCanvas(u);(0,r.BB).ctx(g).drawImage(t.topCanvas,0,0,g.width,g.height),(0,r.BB).convertToAlphaChannelCanvas(g);var f=function(){var e=(0,r.BB).ctx(u);e.save(),e.clearRect(0,0,u.width,u.height),u.width>t.topCanvas.width&&(e.imageSmoothingEnabled=!1),e.drawImage(t.bottomCanvas,0,0,u.width,u.height),"as-alpha"===n.getValue()?(e.globalCompositeOperation="destination-in",e.globalAlpha=t.topOpacity,e.drawImage(g,0,0,u.width,u.height)):(e.globalCompositeOperation=n.getValue(),e.globalAlpha=t.topOpacity,e.drawImage(t.topCanvas,0,0,u.width,u.height)),e.restore()};f();var v=new r.BB.KeyListener({onDown:function(e){"right"===e&&n.next(),"left"===e&&n.previous()}});(0,l.showModal)({target:e,message:`<b>${(0,s.LANG)("layers-merge-modal-title")}</b>`,div:i,buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(e){v.destroy(),n.destroy(),(0,h.theme).removeIsDarkListener(d),"Ok"===e&&t.callback(n.getValue())}})}}),n("6vUjz",function(t,n){e(t.exports,"DropdownMenu",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("amum4"),o=i("72Jv0"),l=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.isExpanded=!1,this.onSetEnabled=function(){return 0};var n=(0,a.c)("button,w-full,h-full",[t.button]);n.onclick=function(){c(!i.isExpanded)},t.buttonTitle&&(n.title=t.buttonTitle),(0,o.makeUnfocusable)(n);var s=[],l={};t.items.forEach(function(e){var i=(0,a.c)("button",e[1]);(0,o.makeUnfocusable)(i),i.onclick=function(){c(!1),t.onItemClick(e[0])},s.push(i),l[e[0]]=i}),this.onSetEnabled=function(e,t){l[e].disabled=!t};var h=(0,a.c)(".kl-dropdown-menu,right-0,top-full,nowrap,hidden",s);this.rootElement=(0,a.c)(",pos-relative",[n,h]);var c=function(e){i.isExpanded=e,h.style.display=i.isExpanded?"block":"none",i.isExpanded?(document.addEventListener("pointerdown",u,{passive:!1}),window.addEventListener("blur",p)):(document.removeEventListener("pointerdown",u),window.removeEventListener("blur",p))},u=function(e){var t=e.target;n.contains(t)||h.contains(t)||c(!1)},p=function(){return c(!1)}}return(0,s._)(e,[{key:"getElement",value:function(){return this.rootElement}},{key:"setEnabled",value:function(e,t){this.onSetEnabled(e,t)}}]),e}()}),n("c7Qka",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"add-layer.ce1078bb.svg"}),n("fwb8M",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"duplicate-layer.3314e3c7.svg"}),n("9j3zc",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"merge-layers.19da79a6.svg"}),n("2Xpd6",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"rename-layer.7c31d4f4.svg"}),n("g6Z5k",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"caret-down.68d4cd16.svg"}),n("5UrL9",function(t,n){e(t.exports,"KlCanvasPreview",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("1C8RU"),l=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.layers=t.layers;var n=t.width/t.layers[0].image.width,s=n>1?t.layers[0].image.width:t.width,l=n>1?t.layers[0].image.height:t.height;this.canvas=(0,a.BB).canvas(s,l),this.updateCheckerboard=function(){i.canvas.style.backgroundImage="url("+(0,a.BB).createCheckerDataUrl(8,void 0,(0,o.theme).isDark())+")"},this.updateCheckerboard(),this.ctx=(0,a.BB).ctx(this.canvas),(0,a.BB).css(this.canvas,{width:"100%",height:"100%",imageRendering:n>1?"pixelated":void 0}),setTimeout(function(){return i.render()},0),(0,o.theme).addIsDarkListener(this.updateCheckerboard)}return(0,s._)(e,[{key:"getElement",value:function(){return this.canvas}},{key:"render",value:function(){if(this.ctx){this.ctx.save(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var e=0;e<this.layers.length;e++){var t=this.layers[e];t.isVisible&&0!==t.opacity&&(this.ctx.globalAlpha=this.layers[e].opacity,this.ctx.globalCompositeOperation=this.layers[e].mixModeStr,this.canvas.width>this.layers[e].image.width&&(this.ctx.imageSmoothingEnabled=!1),this.ctx.drawImage(this.layers[e].image,0,0,this.canvas.width,this.canvas.height))}this.ctx.restore()}}},{key:"destroy",value:function(){(0,o.theme).removeIsDarkListener(this.updateCheckerboard)}}]),e}()}),n("cNhNm",function(n,r){e(n.exports,"FreeTransform",function(){return u});var s=i("cx0mh"),a=i("7h4XF"),o=i("cL71g"),l=i("eWjiX"),h=i("fQgKL"),c=i("lt7cS"),u=/*#__PURE__*/function(){function e(i){var n,r=this;(0,s._)(this,e);var a=function(){u.x=0,u.y=0};this.scaled={x:0,y:0,width:0,height:0,corners:[{x:0,y:0}]},this.minSnapDist=7,this.cornerCursors=["nw","n","ne","e","se","s","sw","w"],this.gripSize=16,this.edgeSize=10,this.corners=[],this.edges=[],this.viewportTransform=(0,o._)({},i.viewportTransform),this.value={x:i.x,y:i.y,width:i.width,height:i.height,angleDeg:i.angleDeg},this.isConstrained=i.isConstrained,this.snapX=i.snapX,this.snapY=i.snapY,this.callback=i.callback,this.snappingEnabled=!0,this.ratio=this.value.width/this.value.height,this.rootEl=(0,l.BB).el({className:"kl-free-transform",css:{userSelect:"none"}}),this.transEl=(0,l.BB).el({parent:this.rootEl,css:{position:"absolute"}}),this.boundsEl=(0,l.BB).el({css:{position:"absolute",cursor:"move",boxShadow:"rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px"}});var u={x:0,y:0};this.keyListener=new l.BB.KeyListener({});var p={x:0,y:0};this.boundsPointerListener=new l.BB.PointerListener({target:this.boundsEl,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointerdown"===e.type&&(p={x:r.value.x,y:r.value.y}),"pointermove"===e.type&&"left"===e.button){r.value.x=p.x+(e.pageX-e.downPageX)/r.viewportTransform.scale,r.value.y=p.y+(e.pageY-e.downPageY)/r.viewportTransform.scale;var t={distX:-1,distY:-1};if(r.snappingEnabled){for(n=0;n<r.snapX.length;n++)(i=Math.abs(r.value.x-r.snapX[n]))<r.minSnapDist/r.viewportTransform.scale&&(void 0===t.x||i<t.distX)&&(t.x=r.snapX[n],t.distX=i);for(n=0;n<r.snapY.length;n++)(i=Math.abs(r.value.y-r.snapY[n]))<r.minSnapDist/r.viewportTransform.scale&&(void 0===t.y||i<t.distY)&&(t.y=r.snapY[n],t.distY=i);for(n=0;n<4;n++){s=(0,c.toImageSpace)(r.corners[n].x,r.corners[n].y,r.value);var i,n,s,a=void 0;for(a=0;a<r.snapX.length;a++)(i=Math.abs(s.x-r.snapX[a]))<r.minSnapDist/r.viewportTransform.scale&&(void 0===t.x||i<t.distX)&&(t.x=r.snapX[a]-(s.x-r.value.x),t.distX=i);for(a=0;a<r.snapY.length;a++)(i=Math.abs(s.y-r.snapY[a]))<r.minSnapDist/r.viewportTransform.scale&&(void 0===t.y||i<t.distY)&&(t.y=r.snapY[a]-(s.y-r.value.y),t.distY=i)}}if("shift"===r.keyListener.getComboStr()){var o=(0,l.BB).projectPointOnLine({x:0,y:p.y},{x:10,y:p.y},{x:r.value.x,y:r.value.y}),h=(0,l.BB).dist(o.x,o.y,r.value.x,r.value.y);t={x:o.x,y:o.y,distX:h,distY:h},o=(0,l.BB).projectPointOnLine({x:p.x,y:0},{x:p.x,y:10},{x:r.value.x,y:r.value.y}),(h=(0,l.BB).dist(o.x,o.y,r.value.x,r.value.y))<t.distX&&(t={x:o.x,y:o.y,distX:h,distY:h}),o=(0,l.BB).projectPointOnLine({x:p.x,y:p.y},{x:p.x+1,y:p.y+1},{x:r.value.x,y:r.value.y}),(h=(0,l.BB).dist(o.x,o.y,r.value.x,r.value.y))<t.distX&&(t={x:o.x,y:o.y,distX:h,distY:h}),o=(0,l.BB).projectPointOnLine({x:p.x,y:p.y},{x:p.x+1,y:p.y-1},{x:r.value.x,y:r.value.y}),(h=(0,l.BB).dist(o.x,o.y,r.value.x,r.value.y))<t.distX&&(t={x:o.x,y:o.y,distX:h,distY:h})}void 0!=t.x&&(r.value.x=t.x),void 0!=t.y&&(r.value.y=t.y),Math.abs(r.value.angleDeg)%90==0&&((0,c.snapToPixel)(r.value),r.updateCornerPositions()),r.updateDOM()}}});for(var d=0;d<4;d++)!function(e){var t=r.corners[e]={i:e,el:(0,l.BB).el({css:{width:r.gripSize+"px",height:r.gripSize+"px",background:"#fff",borderRadius:r.gripSize+"px",position:"absolute",border:"2px solid #000"}}),x:0,y:0,virtualPos:{x:0,y:0}};t.updateDOM=function(){var i=[[-1,-1],[1,-1],[1,1],[-1,1]].map(function(e){return e[0]*=r.value.width>0?1:-1,e[1]*=r.value.height>0?1:-1,e}),n=20>Math.abs(r.scaled.width)||20>Math.abs(r.scaled.height)?10:0;(0,l.BB).css(t.el,{left:r.scaled.corners[t.i].x-r.gripSize/2+i[e][0]*n+"px",top:r.scaled.corners[t.i].y-r.gripSize/2+i[e][1]*n+"px"});for(var s=(0,l.BB).pointsToAngleDeg({x:r.value.x,y:r.value.y},(0,c.toImageSpace)(t.x,t.y,r.value))+135;s<0;)s+=360;var a=Math.round(s/45)%r.cornerCursors.length;(0,l.BB).css(t.el,{cursor:r.cornerCursors[a]+"-resize"})},t.pointerListener=new l.BB.PointerListener({target:r.corners[e].el,fixScribble:!0,onPointer:function(t){if(t.eventPreventDefault(),"pointerdown"===t.type&&"left"===t.button)r.corners[e].virtualPos=(0,c.toImageSpace)(r.corners[e].x,r.corners[e].y,r.value);else if("pointermove"===t.type&&"left"===t.button){r.corners[e].virtualPos.x+=t.dX/r.viewportTransform.scale,r.corners[e].virtualPos.y+=t.dY/r.viewportTransform.scale;var i={x:r.corners[e].virtualPos.x,y:r.corners[e].virtualPos.y};i=r.constrainCorner(e,i.x,i.y),r.isConstrained||(i=r.snapCorner(i.x,i.y)),Math.abs(r.value.angleDeg)%90==0&&(i.x=Math.round(i.x),i.y=Math.round(i.y));var n=(0,c.toTransformSpace)(i.x,i.y,r.value),s=n.x-r.corners[e].x,a=n.y-r.corners[e].y;r.corners[e].x=n.x,r.corners[e].y=n.y;var o=[];0===e?o=[3,1,2]:1===e?o=[2,0,3]:2===e?o=[1,3,0]:3===e&&(o=[0,2,1]),r.corners[o[0]].x=r.corners[e].x,r.corners[o[1]].y=r.corners[e].y,r.keyListener.isPressed("shift")&&(r.corners[o[2]].x-=s,r.corners[o[2]].y-=a,r.corners[o[1]].x=r.corners[o[2]].x,r.corners[o[0]].y=r.corners[o[2]].y),r.updateTransformViaCorners()}}})}(d);this.updateCornerPositions(),this.updateScaled();for(var g=0;g<4;g++)!function(e){r.edges[e]={el:(0,l.BB).el({css:{width:r.edgeSize+"px",height:r.edgeSize+"px",position:"absolute"}})};var t=r.edges[e];t.updateDOM=function(){0===e?(0,l.BB).css(t.el,{left:Math.min(r.scaled.corners[0].x,r.scaled.corners[1].x)+"px",top:Math.min(r.scaled.corners[0].y,r.scaled.corners[3].y)-r.edgeSize+"px",width:Math.abs(r.scaled.width)+"px",height:r.edgeSize+"px"}):1===e?(0,l.BB).css(t.el,{left:Math.max(r.scaled.corners[0].x,r.scaled.corners[1].x)+"px",top:Math.min(r.scaled.corners[1].y,r.scaled.corners[2].y)+"px",width:r.edgeSize+"px",height:Math.abs(r.scaled.height)+"px"}):2===e?(0,l.BB).css(t.el,{left:Math.min(r.scaled.corners[3].x,r.scaled.corners[2].x)+"px",top:Math.max(r.scaled.corners[0].y,r.scaled.corners[3].y)+"px",width:Math.abs(r.scaled.width)+"px",height:r.edgeSize+"px"}):3===e&&(0,l.BB).css(t.el,{left:Math.min(r.scaled.corners[0].x,r.scaled.corners[1].x)-r.edgeSize+"px",top:Math.min(r.scaled.corners[0].y,r.scaled.corners[3].y)+"px",width:r.edgeSize+"px",height:Math.abs(r.scaled.height)+"px"});for(var i=Math.round(r.value.angleDeg/45);i<0;)i+=8;i=(2*e+1+i)%r.cornerCursors.length,t.el.style.cursor=r.cornerCursors[i]+"-resize"};var i=[0,2].includes(e);t.pointerListener=new l.BB.PointerListener({target:r.edges[e].el,fixScribble:!0,onPointer:function(t){if(t.eventPreventDefault(),"pointerdown"===t.type&&"left"===t.button&&(n=i?r.corners[0].y>=r.corners[3].y:r.corners[0].x>=r.corners[1].x,a()),"pointermove"===t.type&&"left"===t.button){var s=(0,l.BB).rotateAround({x:0,y:0},{x:t.dX/r.viewportTransform.scale,y:t.dY/r.viewportTransform.scale},-r.value.angleDeg),o={dX:s.x,dY:s.y};Math.abs(r.value.angleDeg)%90==0&&(o=(0,l.BB).intDxy(u,s.x,s.y));var h=[];0===e?h=[2,3,0,1]:1===e?h=[0,3,1,2]:2===e?h=[0,1,2,3]:3===e&&(h=[1,2,0,3]);var c=i?"y":"x",p=i?o.dY:o.dX;n?(r.corners[h[0]][c]+=p,r.corners[h[1]][c]+=p):(r.corners[h[2]][c]+=p,r.corners[h[3]][c]+=p),r.keyListener.isPressed("shift")&&(n?(r.corners[h[2]][c]-=p,r.corners[h[3]][c]-=p):(r.corners[h[0]][c]-=p,r.corners[h[1]][c]-=p)),i?r.restoreRatio(!1,!0):r.restoreRatio(!0,!1),r.updateTransformViaCorners()}}})}(g);this.angleGrip={el:(0,l.BB).el({css:{cursor:"url("+/*@__PURE__*/t(h)+") 10 10, move",width:this.gripSize+"px",height:this.gripSize+"px",background:"#0ff",borderRadius:this.gripSize+"px",position:"absolute",boxShadow:"inset 0 0 0 2px #000"}}),x:0,y:0,snap:!1,updateDOM:function(){(0,l.BB).css(r.angleGrip.el,{left:r.angleGrip.x-r.gripSize/2+"px",top:r.angleGrip.y-r.gripSize/2+"px"})}},(0,l.BB).el({parent:this.angleGrip.el,css:{width:"2px",height:"13px",left:this.gripSize/2-1+"px",top:this.gripSize+"px",background:"#0ff",position:"absolute"}}),this.anglePointerListener=new l.BB.PointerListener({target:this.angleGrip.el,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=r.rootEl.getBoundingClientRect(),i={x:t.left-r.rootEl.scrollLeft+r.viewportTransform.x,y:t.top-r.rootEl.scrollTop+r.viewportTransform.y},n={x:(e.clientX-i.x)/r.viewportTransform.scale,y:(e.clientY-i.y)/r.viewportTransform.scale},s=(0,l.BB).pointsToAngleDeg({x:r.value.x,y:r.value.y},n)+90;r.value.angleDeg=s;var a=45*Math.round(s/360*8);"shift"===r.keyListener.getComboStr()?r.value.angleDeg=a:r.snappingEnabled&&8>Math.abs(a-s)&&(r.value.angleDeg=a),r.updateDOM()}"pointerup"===e.type&&Math.abs(r.value.angleDeg)%90==0&&((0,c.snapToPixel)(r.value),r.updateCornerPositions(),r.updateDOM())}}),(0,c.snapToPixel)(this.value),this.updateDOM(!0),(0,l.BB).append(this.transEl,[this.boundsEl,this.edges[0].el,this.edges[1].el,this.edges[2].el,this.edges[3].el,this.corners[0].el,this.corners[1].el,this.corners[2].el,this.corners[3].el,this.angleGrip.el])}return(0,a._)(e,[{key:"updateScaled",value:function(){var e=this;this.scaled.x=this.value.x*this.viewportTransform.scale,this.scaled.y=this.value.y*this.viewportTransform.scale,this.scaled.width=this.value.width*this.viewportTransform.scale,this.scaled.height=this.value.height*this.viewportTransform.scale,this.scaled.corners=this.corners.map(function(t){return{x:t.x*e.viewportTransform.scale,y:t.y*e.viewportTransform.scale}})}},{key:"snapCorner",value:function(e,t){if(!this.snappingEnabled)return{x:e,y:t};for(var i,n,r,s={x:void 0,y:void 0,dist:{x:void 0,y:void 0}},a=0;a<this.snapX.length;a++)(i=Math.abs(e-this.snapX[a]))<this.minSnapDist/this.viewportTransform.scale&&(void 0===s.x||i<s.dist.x)&&(s.x=this.snapX[a],s.dist.x=i);for(var o=0;o<this.snapY.length;o++)(i=Math.abs(t-this.snapY[o]))<this.minSnapDist/this.viewportTransform.scale&&(void 0===s.y||i<s.dist.y)&&(s.y=this.snapY[o],s.dist.y=i);return void 0===s.x&&void 0===s.y?{x:e,y:t}:{x:null!==(n=s.x)&&void 0!==n?n:e,y:null!==(r=s.y)&&void 0!==r?r:t}}},{key:"constrainCorner",value:function(e,t,i){if(!this.isConstrained)return{x:t,y:i};var n=this.value.width*this.value.height<0?-1:1;return(0,l.BB).projectPointOnLine({x:this.value.x,y:this.value.y},(0,c.toImageSpace)(this.ratio,n*([0,2].includes(e)?1:-1),this.value),{x:t,y:i})}},{key:"updateCornerPositions",value:function(){this.corners[0].x=-this.value.width/2,this.corners[0].y=-this.value.height/2,this.corners[1].x=this.value.width/2,this.corners[1].y=-this.value.height/2,this.corners[2].x=this.value.width/2,this.corners[2].y=this.value.height/2,this.corners[3].x=-this.value.width/2,this.corners[3].y=this.value.height/2}},{key:"restoreRatio",value:function(e,t){if(this.isConstrained){var i=Math.abs(this.value.angleDeg)%90==0,n=Math.abs(this.value.angleDeg-90)%180==0;if(t&&!e){var r=Math.abs(this.corners[3].y-this.corners[0].y),s=this.ratio*r;i&&(s=(n?this.value.y%1:this.value.x%1)==0?(0,l.BB).roundEven(s):(0,l.BB).roundUneven(s)),this.corners[1].x-this.corners[0].x<0&&(s*=-1),this.corners[0].x=-s/2,this.corners[3].x=-s/2,this.corners[1].x=s/2,this.corners[2].x=s/2}if(!t&&e){var a=Math.abs(this.corners[0].x-this.corners[1].x)/this.ratio;i&&(a=(n?this.value.x%1:this.value.y%1)==0?(0,l.BB).roundEven(a):(0,l.BB).roundUneven(a)),this.corners[3].y-this.corners[0].y<0&&(a*=-1),this.corners[0].y=-a/2,this.corners[1].y=-a/2,this.corners[2].y=a/2,this.corners[3].y=a/2}}}},{key:"updateTransformViaCorners",value:function(){var e=(0,l.BB).rotateAround({x:0,y:0},{x:(this.corners[0].x+this.corners[1].x)/2,y:(this.corners[0].y+this.corners[3].y)/2},this.value.angleDeg);this.value.x=e.x+this.value.x,this.value.y=e.y+this.value.y,this.value.width=this.corners[1].x-this.corners[0].x,this.value.height=this.corners[3].y-this.corners[0].y,this.updateCornerPositions(),this.updateDOM()}},{key:"updateDOM",value:function(e){this.updateScaled(),(0,l.BB).css(this.transEl,{left:this.viewportTransform.x+this.scaled.x+"px",top:this.viewportTransform.y+this.scaled.y+"px",transformOrigin:"0 0",transform:"rotate("+this.value.angleDeg+"deg)"}),(0,l.BB).css(this.boundsEl,{width:Math.abs(this.scaled.width)+"px",height:Math.abs(this.scaled.height)+"px",left:Math.min(this.scaled.corners[0].x,this.scaled.corners[1].x)+"px",top:Math.min(this.scaled.corners[0].y,this.scaled.corners[3].y)+"px"}),this.corners[0].updateDOM(),this.corners[1].updateDOM(),this.corners[2].updateDOM(),this.corners[3].updateDOM(),this.edges[0].updateDOM(),this.edges[1].updateDOM(),this.edges[2].updateDOM(),this.edges[3].updateDOM(),this.angleGrip.x=0,this.angleGrip.y=-Math.abs(this.value.height*this.viewportTransform.scale)/2-20,this.angleGrip.updateDOM(),!e&&this.callback&&this.callback((0,c.copyTransform)(this.value))}},{key:"getValue",value:function(){return(0,c.copyTransform)(this.value)}},{key:"setIsConstrained",value:function(e){this.isConstrained=e,e&&0!==this.value.width&&0!==this.value.height&&(this.ratio=Math.abs(this.value.width/this.value.height))}},{key:"setSnapping",value:function(e){this.snappingEnabled=e}},{key:"setPos",value:function(e){this.value.x=e.x,this.value.y=e.y,this.updateDOM(!0)}},{key:"move",value:function(e,t){this.value.x+=e,this.value.y+=t,this.updateDOM(!1)}},{key:"setSize",value:function(e,t){this.value.width=e,this.value.height=t,Math.abs(this.value.angleDeg)%90==0&&(0,c.snapToPixel)(this.value),this.updateCornerPositions(),this.updateDOM(!1)}},{key:"setAngleDeg",value:function(e){this.value.angleDeg=e,Math.abs(this.value.angleDeg)%90==0&&((0,c.snapToPixel)(this.value),this.updateCornerPositions()),this.updateDOM(!0)}},{key:"setViewportTransform",value:function(e){this.viewportTransform=e,this.updateScaled(),this.updateDOM()}},{key:"getElement",value:function(){return this.rootEl}},{key:"getRatio",value:function(){return this.ratio}},{key:"destroy",value:function(){this.keyListener.destroy(),this.boundsPointerListener.destroy(),this.corners.forEach(function(e){return e.pointerListener.destroy()}),this.edges.forEach(function(e){return e.pointerListener.destroy()}),this.anglePointerListener.destroy()}}]),e}()}),n("fQgKL",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"cursor-rotate.4dea8425.png"}),n("lt7cS",function(t,n){e(t.exports,"snapToPixel",function(){return s}),e(t.exports,"copyTransform",function(){return a}),e(t.exports,"toTransformSpace",function(){return o}),e(t.exports,"toImageSpace",function(){return l});var r=i("eWjiX");function s(e){if(Math.abs(e.angleDeg)%90==0){e.width=Math.round(e.width),e.height=Math.round(e.height);var t=Math.abs(e.angleDeg-90)%180==0;e.x=(t?e.height:e.width)%2==0?Math.round(e.x):Math.round(e.x-.5)+.5,e.y=(t?e.width:e.height)%2==0?Math.round(e.y):Math.round(e.y-.5)+.5}}function a(e){return{x:e.x,y:e.y,width:e.width,height:e.height,angleDeg:e.angleDeg}}function o(e,t,i){n=e-i.x,s=t-i.y;var n,s,a=(0,r.BB).rotateAround({x:0,y:0},{x:n,y:s},-i.angleDeg);return{x:n=a.x,y:s=a.y}}function l(e,t,i){var n=(0,r.BB).rotateAround({x:0,y:0},{x:e,y:t},i.angleDeg);return{x:n.x+i.x,y:n.y+i.y}}}),n("kEeSq",function(t,n){e(t.exports,"FreeTransformCanvas",function(){return c});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("cNhNm"),l=i("jpkXO");i("fDKZh");var h=i("elJSU"),c=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.imageWidth=t.imageWidth,this.imageHeight=t.imageHeight,this.rootEl=(0,a.BB).el({className:"kl-preview-wrapper",css:{width:t.elementWidth+"px",height:t.elementHeight+"px"}}),this.rootEl.oncontextmenu=function(){return!1},this.layers=t.layers,this.transformIndex=t.transformIndex,this.previewLayerArr=this.layers.map(function(e){var t;return{image:e.image,isVisible:e.isVisible,mixModeStr:null!==(t=e.mixModeStr)&&void 0!==t?t:"source-over",opacity:e.opacity,hasClipping:!1}}),this.previewCanvas=(0,a.BB).canvas(this.imageWidth,this.imageHeight),this.previewLayerArr[this.previewLayerArr.length-1].image=this.previewCanvas,this.preview=new l.Preview({width:t.elementWidth,height:t.elementHeight,project:{width:t.imageWidth,height:t.imageHeight,layers:this.previewLayerArr},hasEditMode:!0,onModeChange:function(e){i.freeTransform.getElement().style.pointerEvents="edit"===e?"":"none",i.freeTransform.getElement().style.opacity="edit"===e?"":"0.5"},onTransformChange:function(e){i.freeTransform.setViewportTransform(e)},padding:30}),this.preview.getElement().classList.add((0,h.css)({overflow:"hidden",marginLeft:"-20px",marginRight:"-20px"})),this.rootEl.append(this.preview.getElement()),this.initTransform={x:this.imageWidth/2,y:this.imageHeight/2,width:this.layers[this.transformIndex].image.width,height:this.layers[this.transformIndex].image.height},this.freeTransform=new o.FreeTransform({x:this.initTransform.x,y:this.initTransform.y,width:this.initTransform.width,height:this.initTransform.height,angleDeg:0,isConstrained:!0,snapX:[0,this.imageWidth],snapY:[0,this.imageHeight],viewportTransform:this.preview.getTransform(),callback:function(){i.updatePreview()}}),this.preview.getElement().append(this.freeTransform.getElement()),(0,a.BB).css(this.freeTransform.getElement(),{position:"absolute",left:"0",top:"0"}),setTimeout(function(){return i.updatePreview()},0)}return(0,s._)(e,[{key:"updatePreview",value:function(){var e=this.freeTransform.getValue(),t=(0,a.BB).ctx(this.previewCanvas);t.save(),t.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height),(0,a.BB).drawTransformedImageWithBounds(t,this.layers[this.transformIndex].image,e,void 0,(0,a.BB).testShouldPixelate(e,e.width/this.initTransform.width,e.height/this.initTransform.height)),t.restore(),this.preview.render()}},{key:"move",value:function(e,t){this.freeTransform.move(e,t)}},{key:"reset",value:function(){var e=this.layers[this.transformIndex].image.width,t=this.layers[this.transformIndex].image.height;this.freeTransform.setSize(e,t),this.freeTransform.setPos({x:e/2,y:t/2}),this.freeTransform.setAngleDeg(0),this.updatePreview()}},{key:"setTransformFit",value:function(){var e=(0,a.BB).fitInto(this.layers[this.transformIndex].image.width,this.layers[this.transformIndex].image.height,this.imageWidth,this.imageHeight,1);this.freeTransform.setSize(e.width,e.height),this.freeTransform.setPos({x:e.width/2,y:e.height/2}),this.freeTransform.setAngleDeg(0),this.updatePreview()}},{key:"setTransformCenter",value:function(){this.freeTransform.setPos({x:this.imageWidth/2,y:this.imageHeight/2}),this.freeTransform.setAngleDeg(0),this.updatePreview()}},{key:"getTransformation",value:function(){return this.freeTransform.getValue()}},{key:"getIsPixelated",value:function(){var e=this.freeTransform.getValue();return(0,a.BB).testShouldPixelate(e,e.width/this.initTransform.width,e.height/this.initTransform.height)}},{key:"getElement",value:function(){return this.rootEl}},{key:"destroy",value:function(){this.freeTransform.destroy(),this.preview.destroy(),(0,a.BB).freeCanvas(this.previewCanvas)}}]),e}()}),n("fDKZh",function(t,n){e(t.exports,"css",function(){return i("elJSU").css}),i("elJSU")}),n("elJSU",function(e,t){e.exports=i("dQMMg")}),n("dQMMg",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0});var n=i("8O5Y2");i("exBzs"),i("csvAs"),i("5zE8f");var r=n.default({key:"css"}),s=r.flush,a=r.hydrate,o=r.cx,l=r.merge,h=r.getRegisteredStyles,c=r.injectGlobal,u=r.keyframes,p=r.css,d=r.sheet,g=r.cache;e.exports.cache=g,e.exports.css=p,e.exports.cx=o,e.exports.flush=s,e.exports.getRegisteredStyles=h,e.exports.hydrate=a,e.exports.injectGlobal=c,e.exports.keyframes=u,e.exports.merge=l,e.exports.sheet=d}),n("8O5Y2",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0});var n=i("exBzs"),r=i("csvAs"),s=i("5zE8f"),a=n&&n.__esModule?n:{default:n};function o(e,t){if(void 0===e.inserted[t.name])return e.insert("",t,e.sheet,!0)}function l(e,t,i){var n=[],r=s.getRegisteredStyles(e,n,i);return n.length<2?i:r+t(n)}var h=function e(t){for(var i="",n=0;n<t.length;n++){var r=t[n];if(null!=r){var s=void 0;switch(typeof r){case"boolean":break;case"object":if(Array.isArray(r))s=e(r);else for(var a in s="",r)r[a]&&a&&(s&&(s+=" "),s+=a);break;default:s=r}s&&(i&&(i+=" "),i+=s)}}return i};e.exports.default=function(e){var t=a.default(e);t.sheet.speedy=function(e){this.isSpeedy=e},t.compat=!0;var i=function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];var a=r.serializeStyles(i,t.registered,void 0);return s.insertStyles(t,a,!1),t.key+"-"+a.name};return{css:i,cx:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return l(t.registered,i,h(n))},injectGlobal:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];var s=r.serializeStyles(i,t.registered);o(t,s)},keyframes:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];var s=r.serializeStyles(i,t.registered),a="animation-"+s.name;return o(t,{name:s.name,styles:"@keyframes "+a+"{"+s.styles+"}"}),a},hydrate:function(e){e.forEach(function(e){t.inserted[e]=!0})},flush:function(){t.registered={},t.inserted={},t.sheet.flush()},sheet:t.sheet,cache:t,getRegisteredStyles:s.getRegisteredStyles.bind(null,t.registered),merge:l.bind(null,t.registered,i)}}}),n("32CBv",function(t,n){e(t.exports,"Cropper",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.scale=t.scale,this.callback=t.callback;var n=t.maxW,s=t.maxW;this.rootEl=(0,a.BB).el();var o=["nw","n","ne","e","se","s","sw","w"];this.keyListener=new a.BB.KeyListener({}),(0,a.BB).css(this.rootEl,{position:"absolute",left:this.x*this.scale+"px",top:this.y*this.scale+"px"}),this.outline={el:(0,a.BB).el({css:{position:"absolute",border:"1px dashed #fff",cursor:"move"}}),update:function(){(0,a.BB).css(i.outline.el,{left:i.grips[0].x*i.scale-1+"px",top:i.grips[0].y*i.scale-1+"px",width:(i.grips[2].x-i.grips[0].x)*i.scale+"px",height:(i.grips[2].y-i.grips[0].y)*i.scale+"px"})}},this.pointerRemainder={x:0,y:0},this.outlinePointerListener=new a.BB.PointerListener({target:this.outline.el,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=(0,a.BB).intDxy(i.pointerRemainder,e.dX/i.scale,e.dY/i.scale),n=t.dX,r=t.dY;i.grips[0].x+=n,i.grips[0].y+=r,i.grips[1].x+=n,i.grips[1].y+=r,i.grips[2].x+=n,i.grips[2].y+=r,i.grips[3].x+=n,i.grips[3].y+=r,i.update()}"pointerup"===e.type&&i.commit()}}),this.thirdsHorizontal={el:(0,a.BB).el({css:{position:"absolute",borderTop:"1px solid #0ff",borderBottom:"1px solid #0ff"}}),update:function(){(0,a.BB).css(i.thirdsHorizontal.el,{left:i.grips[0].x*i.scale+"px",top:(i.grips[0].y+(i.grips[2].y-i.grips[0].y)/3)*i.scale+"px",width:(i.grips[2].x-i.grips[0].x)*i.scale+"px",height:(i.grips[2].y-i.grips[0].y)/3*i.scale+"px"})}},this.thirdsVertical={el:(0,a.BB).el({css:{position:"absolute",borderLeft:"1px solid #0ff",borderRight:"1px solid #0ff"}}),update:function(){(0,a.BB).css(i.thirdsVertical.el,{left:(i.grips[0].x+(i.grips[2].x-i.grips[0].x)/3)*i.scale+"px",top:i.grips[0].y*i.scale+"px",width:(i.grips[2].x-i.grips[0].x)/3*i.scale+"px",height:(i.grips[2].y-i.grips[0].y)*i.scale+"px"})}},this.grips=[{x:0,y:0},{x:this.width,y:0},{x:this.width,y:this.height},{x:0,y:this.height}];var l=function(e){i.grips[0].y+=e,i.grips[0].y=(0,a.BB).clamp(i.grips[0].y,i.grips[3].y-s,i.grips[3].y-1),i.grips[1].y=i.grips[0].y},h=function(e){i.grips[1].x+=e,i.grips[1].x=(0,a.BB).clamp(i.grips[1].x,i.grips[0].x+1,i.grips[0].x+n),i.grips[2].x=i.grips[1].x},c=function(e){i.grips[2].y+=e,i.grips[2].y=(0,a.BB).clamp(i.grips[2].y,i.grips[1].y+1,i.grips[1].y+s),i.grips[3].y=i.grips[2].y},u=function(e){i.grips[0].x+=e,i.grips[0].x=(0,a.BB).clamp(i.grips[0].x,i.grips[1].x-n,i.grips[1].x-1),i.grips[3].x=i.grips[0].x};this.edges=[];for(var p=0;p<4;p++)!function(e){var t=(0,a.BB).el({css:{width:"40px",height:"40px",position:"absolute"}}),n=function(){0===e?(0,a.BB).css(t,{left:i.grips[0].x*i.scale+10+"px",top:i.grips[0].y*i.scale-80+10+"px",width:(i.grips[1].x-i.grips[0].x)*i.scale-20+"px",height:"80px"}):1===e?(0,a.BB).css(t,{left:i.grips[1].x*i.scale-10+"px",top:i.grips[1].y*i.scale+10+"px",width:"80px",height:(i.grips[2].y-i.grips[1].y)*i.scale-20+"px"}):2===e?(0,a.BB).css(t,{left:i.grips[3].x*i.scale+10+"px",top:i.grips[3].y*i.scale-10+"px",width:(i.grips[2].x-i.grips[3].x)*i.scale-20+"px",height:"80px"}):3===e&&(0,a.BB).css(t,{left:i.grips[0].x*i.scale-80+10+"px",top:i.grips[0].y*i.scale+10+"px",width:"80px",height:(i.grips[3].y-i.grips[0].y)*i.scale-20+"px"});var n=2*e+1;t.style.cursor=o[n]+"-resize"};i.edges[e]={el:t,update:n}}(p);this.darken=[];for(var d=0;d<4;d++)!function(e){var t=(0,a.BB).el({css:{position:"absolute",background:"#000",opacity:"0.5"}}),n=function(){0===e?(0,a.BB).css(t,{left:i.grips[0].x*i.scale+"px",top:i.grips[0].y*i.scale-8e3+"px",width:(i.grips[1].x-i.grips[0].x)*i.scale+"px",height:"8000px"}):1===e?(0,a.BB).css(t,{left:i.grips[1].x*i.scale+"px",top:i.grips[1].y*i.scale-8e3+"px",width:"8000px",height:"16000px"}):2===e?(0,a.BB).css(t,{left:i.grips[3].x*i.scale+"px",top:i.grips[3].y*i.scale+"px",width:(i.grips[2].x-i.grips[3].x)*i.scale+"px",height:"8000px"}):3===e&&(0,a.BB).css(t,{left:i.grips[0].x*i.scale-8e3+"px",top:i.grips[0].y*i.scale-8e3+"px",width:"8000px",height:"16000px"})};i.darken[e]={el:t,update:n}}(d);this.edge0PointerListener=new a.BB.PointerListener({target:this.edges[0].el,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=(0,a.BB).intDxy(i.pointerRemainder,e.dX/i.scale,e.dY/i.scale).dY;l(t),i.keyListener.isPressed("shift")&&c(-t),i.update()}"pointerup"===e.type&&i.commit()}}),this.edge1PointerListener=new a.BB.PointerListener({target:this.edges[1].el,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=(0,a.BB).intDxy(i.pointerRemainder,e.dX/i.scale,e.dY/i.scale),n=t.dX;t.dY,h(n),i.keyListener.isPressed("shift")&&u(-n),i.update()}"pointerup"===e.type&&i.commit()}}),this.edge2PointerListener=new a.BB.PointerListener({target:this.edges[2].el,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=(0,a.BB).intDxy(i.pointerRemainder,e.dX/i.scale,e.dY/i.scale),n=(t.dX,t.dY);c(n),i.keyListener.isPressed("shift")&&l(-n),i.update()}"pointerup"===e.type&&i.commit()}}),this.edge3PointerListener=new a.BB.PointerListener({target:this.edges[3].el,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=(0,a.BB).intDxy(i.pointerRemainder,e.dX/i.scale,e.dY/i.scale),n=t.dX;t.dY,u(n),i.keyListener.isPressed("shift")&&h(-n),i.update()}"pointerup"===e.type&&i.commit()}}),this.cornerElArr=[],function(){for(var e=0;e<4;e++)!function(e){var t=(0,a.BB).el({css:{width:"80px",height:"80px",position:"absolute",cursor:["nwse-resize","nesw-resize"][e%2]}}),n=function(){0===e?(0,a.BB).css(t,{left:i.grips[0].x*i.scale-80+10+"px",top:i.grips[0].y*i.scale-80+10+"px"}):1===e?(0,a.BB).css(t,{left:i.grips[1].x*i.scale-10+"px",top:i.grips[1].y*i.scale-80+10+"px"}):2===e?(0,a.BB).css(t,{left:i.grips[1].x*i.scale-10+"px",top:i.grips[2].y*i.scale-10+"px"}):3===e&&(0,a.BB).css(t,{left:i.grips[0].x*i.scale-80+10+"px",top:i.grips[2].y*i.scale-10+"px"})};i.cornerElArr[e]={el:t,update:n}}(e)}(),this.corner0PointerListener=new a.BB.PointerListener({target:this.cornerElArr[0].el,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=(0,a.BB).intDxy(i.pointerRemainder,e.dX/i.scale,e.dY/i.scale),n=t.dX,r=t.dY;u(n),l(r),i.keyListener.isPressed("shift")&&(h(-n),c(-r)),i.update()}"pointerup"===e.type&&i.commit()}}),this.corner1PointerListener=new a.BB.PointerListener({target:this.cornerElArr[1].el,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=(0,a.BB).intDxy(i.pointerRemainder,e.dX/i.scale,e.dY/i.scale),n=t.dX,r=t.dY;h(n),l(r),i.keyListener.isPressed("shift")&&(u(-n),c(-r)),i.update()}"pointerup"===e.type&&i.commit()}}),this.corner2PointerListener=new a.BB.PointerListener({target:this.cornerElArr[2].el,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=(0,a.BB).intDxy(i.pointerRemainder,e.dX/i.scale,e.dY/i.scale),n=t.dX,r=t.dY;h(n),c(r),i.keyListener.isPressed("shift")&&(u(-n),l(-r)),i.update()}"pointerup"===e.type&&i.commit()}}),this.corner3PointerListener=new a.BB.PointerListener({target:this.cornerElArr[3].el,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=(0,a.BB).intDxy(i.pointerRemainder,e.dX/i.scale,e.dY/i.scale),n=t.dX,r=t.dY;u(n),c(r),i.keyListener.isPressed("shift")&&(h(-n),l(-r)),i.update()}"pointerup"===e.type&&i.commit()}}),this.rootEl.append(this.darken[1].el,this.darken[0].el,this.darken[2].el,this.darken[3].el,this.thirdsHorizontal.el,this.thirdsVertical.el,this.outline.el,this.edges[1].el,this.edges[0].el,this.edges[2].el,this.edges[3].el,this.cornerElArr[0].el,this.cornerElArr[1].el,this.cornerElArr[2].el,this.cornerElArr[3].el),this.update()}return(0,s._)(e,[{key:"update",value:function(){this.edges[0].update(),this.edges[1].update(),this.edges[2].update(),this.edges[3].update(),this.cornerElArr[0].update(),this.cornerElArr[1].update(),this.cornerElArr[2].update(),this.cornerElArr[3].update(),this.darken[0].update(),this.darken[1].update(),this.darken[2].update(),this.darken[3].update(),this.outline.update(),this.thirdsHorizontal.update(),this.thirdsVertical.update()}},{key:"commit",value:function(){this.pointerRemainder.x=0,this.pointerRemainder.y=0,this.callback(this.getTransform())}},{key:"getTransform",value:function(){return this.grips[1].x-=this.grips[0].x,this.grips[1].y-=this.grips[0].y,this.grips[2].x-=this.grips[0].x,this.grips[2].y-=this.grips[0].y,this.grips[3].x-=this.grips[0].x,this.grips[3].y-=this.grips[0].y,this.x+=this.grips[0].x,this.y+=this.grips[0].y,this.grips[0].x=0,this.grips[0].y=0,{x:this.x,y:this.y,width:this.grips[1].x,height:this.grips[2].y}}},{key:"setTransform",value:function(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,(0,a.BB).css(this.rootEl,{left:this.x*this.scale+"px",top:this.y*this.scale+"px"}),this.grips[0].x=0,this.grips[0].y=0,this.grips[1].x=this.width,this.grips[1].y=0,this.grips[2].x=this.width,this.grips[2].y=this.height,this.grips[3].x=0,this.grips[3].y=this.height,this.update(),this.commit()}},{key:"setScale",value:function(e){this.scale=e,(0,a.BB).css(this.rootEl,{left:this.x*this.scale+"px",top:this.y*this.scale+"px"}),this.update()}},{key:"showThirds",value:function(e){this.thirdsHorizontal.el.style.display=e?"block":"none",this.thirdsVertical.el.style.display=e?"block":"none"}},{key:"getElement",value:function(){return this.rootEl}},{key:"destroy",value:function(){this.keyListener.destroy(),this.outlinePointerListener.destroy(),this.corner0PointerListener.destroy(),this.corner1PointerListener.destroy(),this.corner2PointerListener.destroy(),this.corner3PointerListener.destroy(),this.edge0PointerListener.destroy(),this.edge1PointerListener.destroy(),this.edge2PointerListener.destroy(),this.edge3PointerListener.destroy()}}]),e}()}),n("kqmpc",function(t,n){e(t.exports,"LayerPreview",function(){return c});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("1mH1z"),l=i("1C8RU"),h=i("7jh4K"),c=/*#__PURE__*/function(){function e(t){var i,n=this;(0,r._)(this,e),this.animationCanvasCheckerPattern={},this.largeCanvasCheckerPattern={},this.rootEl=(0,a.BB).el({className:"kl-layer-preview"}),this.history=t.history,this.isVisible=!0,this.height=40,this.canvasSize=this.height-10,this.largeCanvasSize=300,this.lastDrawnState=-2,this.lastDrawnSize={width:0,height:0},this.animationCanvas=(0,a.BB).canvas(),this.animationCanvasCtx=(0,a.BB).ctx(this.animationCanvas),this.animationLength=30,this.animationCount=0,this.largeCanvasIsVisible=!1,this.uiState=t.uiState,this.contentWrapperEl=(0,a.BB).el({css:{display:"flex",alignItems:"center",height:this.height+"px"}});var s=(0,a.BB).el({css:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"23px",flexShrink:"0"}});this.checkEl=(0,a.BB).el({parent:s,tagName:"input",css:{pointerEvents:"none"},custom:{type:"checkbox",disabled:"true"}});var h=(0,a.BB).el({css:{minWidth:this.height+"px",height:this.height+"px",display:"flex",justifyContent:"center",alignItems:"center"}});this.canvas=(0,a.BB).canvas(this.canvasSize,this.canvasSize),this.canvasCtx=(0,a.BB).ctx(this.canvas),this.canvas.title=(0,o.LANG)("layers-active-layer");var c=(0,a.BB).el({css:{flexGrow:"1",paddingLeft:"10px",fontSize:"13px",overflow:"hidden",position:"relative"}});this.nameLabelEl=(0,a.BB).el({content:"",css:{cssFloat:"left",whiteSpace:"nowrap"}});var u=(0,a.BB).el({css:{position:"absolute",left:"10px",top:"0",width:"90px",height:"100%"}});t.onClick&&(u.addEventListener("click",function(){return t.onClick()},{passive:!1}),this.canvas.addEventListener("click",function(){return t.onClick()},{passive:!1}),s.addEventListener("click",function(){return t.onClick()},{passive:!1})),this.opacityEl=(0,a.BB).el({content:(0,o.LANG)("opacity")+"<br>100%",css:{minWidth:"60px",fontSize:"12px",textAlign:"center"}}),this.largeCanvasWrapper=(0,a.BB).el({onClick:a.BB.handleClick,css:{pointerEvents:"none",background:"#fff",position:"absolute",right:"280px",top:"10px",border:"1px solid #aaa",boxShadow:"1px 1px 3px rgba(0,0,0,0.3)",transition:"opacity 300ms ease-in-out",userSelect:"none",display:"block",webkitTouchCallout:"none"}}),this.largeCanvas=(0,a.BB).canvas(this.largeCanvasSize,this.largeCanvasSize),this.largeCanvasWrapper.append(this.largeCanvas),this.largeCanvasCtx=(0,a.BB).ctx(this.largeCanvas),(0,a.BB).css(this.largeCanvas,{display:"block"}),h.append(this.canvas),c.append(this.nameLabelEl,u),this.contentWrapperEl.append(s,h,c,this.opacityEl),this.rootEl.append(this.contentWrapperEl),this.updateCheckerPatterns(),(0,l.theme).addIsDarkListener(function(){n.updateCheckerPatterns(),n.draw(!0)}),setInterval(function(){n.layerObj&&n.history.getChangeCount()!==n.lastDrawnState&&(n.layerObj.opacity=n.layerObj.context.canvas.opacity,n.draw(!1))},2e3);var p=function(){n.largeCanvasWrapper.remove()},d=function(e){n.largeCanvasIsVisible!==e&&(clearTimeout(i),n.largeCanvasIsVisible=e,e?i=setTimeout(function(){n.drawLargeCanvas(),n.largeCanvasWrapper.style.opacity="0",t.klRootEl.append(n.largeCanvasWrapper),setTimeout(function(){n.largeCanvasWrapper.style.opacity="1"},20)},250):(n.largeCanvasWrapper.style.opacity="0",i=setTimeout(p,320)))};new a.BB.PointerListener({target:this.canvas,onEnterLeave:function(e){d(e)}})}return(0,s._)(e,[{key:"updateCheckerPatterns",value:function(){var e=(0,a.BB).createCheckerCanvas(4,(0,l.theme).isDark());this.animationCanvasCheckerPattern=(0,h.throwIfNull)(this.animationCanvasCtx.createPattern(e,"repeat")),this.largeCanvasCheckerPattern=(0,h.throwIfNull)(this.canvasCtx.createPattern(e,"repeat"))}},{key:"animate",value:function(){var e=this;0!==this.animationCount&&(this.animationCount--,this.canvasCtx.save(),this.canvasCtx.globalAlpha=Math.pow((this.animationLength-this.animationCount)/this.animationLength,2),this.canvasCtx.drawImage(this.animationCanvas,0,0),this.canvasCtx.restore(),this.animationCount>0&&requestAnimationFrame(function(){return e.animate()}))}},{key:"drawLargeCanvas",value:function(){if(this.largeCanvasIsVisible&&this.layerObj){var e=this.layerObj.context.canvas,t=(0,a.BB).fitInto(e.width,e.height,this.largeCanvasSize,this.largeCanvasSize,1);this.largeCanvas.width=Math.round(t.width),this.largeCanvas.height=Math.round(t.height),this.largeCanvasCtx.save(),this.largeCanvas.width>e.width?this.largeCanvasCtx.imageSmoothingEnabled=!1:(this.largeCanvasCtx.imageSmoothingEnabled=!0,this.largeCanvasCtx.imageSmoothingQuality="high"),this.largeCanvasCtx.fillStyle=this.largeCanvasCheckerPattern,this.largeCanvasCtx.fillRect(0,0,this.largeCanvas.width,this.largeCanvas.height),this.largeCanvasCtx.drawImage(e,0,0,this.largeCanvas.width,this.largeCanvas.height),this.largeCanvasCtx.restore();var i=this.rootEl.getBoundingClientRect();(0,a.BB).css(this.largeCanvasWrapper,{top:Math.max(10,i.top+this.height/2-this.largeCanvas.height/2)+"px"})}}},{key:"draw",value:function(e){if(this.isVisible&&this.layerObj){var t=this.layerObj.isVisible;this.checkEl.parentElement.title=t?(0,o.LANG)("layers-active-layer-visible"):(0,o.LANG)("layers-active-layer-hidden"),this.checkEl.checked=t,this.checkEl.style.boxShadow=t?"":"0 0 0 1px red",this.nameLabelEl.textContent=this.layerObj.name,this.layerObj.isVisible?this.opacityEl.innerHTML=(0,o.LANG)("opacity")+"<br>"+Math.round(100*this.layerObj.opacity)+"%":this.opacityEl.innerHTML=(0,o.LANG)("opacity")+"<br><s>"+Math.round(100*this.layerObj.opacity)+"%</s>";var i=this.layerObj.context.canvas;if(i.width!==this.lastDrawnSize.width||i.height!==this.lastDrawnSize.height){var n=(0,a.BB).fitInto(i.width,i.height,this.canvasSize,this.canvasSize,1);this.canvas.width=Math.round(n.width),this.canvas.height=Math.round(n.height),e=!0}this.animationCanvas.width=this.canvas.width,this.animationCanvas.height=this.canvas.height,this.animationCanvasCtx.save(),this.animationCanvasCtx.imageSmoothingEnabled=!1,this.animationCanvasCtx.fillStyle=this.animationCanvasCheckerPattern,this.animationCanvasCtx.fillRect(0,0,this.animationCanvas.width,this.animationCanvas.height),this.animationCanvasCtx.drawImage(i,0,0,this.animationCanvas.width,this.animationCanvas.height),this.animationCanvasCtx.restore(),e?(this.animationCount=0,this.canvasCtx.save(),this.canvasCtx.drawImage(this.animationCanvas,0,0),this.canvasCtx.restore()):(this.animationCount=this.animationLength,this.animate()),this.drawLargeCanvas(),this.lastDrawnState=this.history.getChangeCount(),this.lastDrawnSize.width=i.width,this.lastDrawnSize.height=i.height}}},{key:"getElement",value:function(){return this.rootEl}},{key:"setIsVisible",value:function(e){if(this.isVisible!==e){this.isVisible=e,this.contentWrapperEl.style.display=this.isVisible?"flex":"none",this.rootEl.style.marginBottom=this.isVisible?"":"10px";var t=this.history.getChangeCount();e&&this.lastDrawnState!==t&&this.draw(!0)}}},{key:"setLayer",value:function(e){this.layerObj=e,this.draw(!0)}},{key:"setUiState",value:function(e){this.uiState=e,"left"===this.uiState?(0,a.BB).css(this.largeCanvasWrapper,{left:"280px",right:""}):(0,a.BB).css(this.largeCanvasWrapper,{left:"",right:"280px"})}}]),e}()}),n("8ebuX",function(t,n){e(t.exports,"showImportAsLayerDialog",function(){return c});var r=i("eWjiX"),s=i("kEeSq"),a=i("2MaaK"),o=i("1mH1z"),l=i("bh77f"),h=i("ChldL");function c(e){var t=document.createElement("div");if((0,r.BB).appendTextDiv(t,(0,o.LANG)("import-as-layer-description")),e.klCanvas.isLayerLimitReached()){var i=(0,r.BB).el({content:(0,o.LANG)("import-as-layer-limit-reached"),css:{background:"#ff0",padding:"10px",marginTop:"5px",marginBottom:"5px",border:"1px solid #e7d321",borderRadius:"5px"}});t.append(i)}var n=(0,l.testIsSmall)(),c=(0,r.BB).el({css:{display:"flex"}}),u=(0,r.BB).el({tagName:"button",content:"1:1",css:{marginRight:"10px"},onClick:function(){m.reset()}}),p=(0,r.BB).el({tagName:"button",content:(0,o.LANG)("import-as-layer-fit"),css:{marginRight:"10px"},onClick:function(){m.setTransformFit()}}),d=(0,r.BB).el({tagName:"button",content:(0,o.LANG)("center"),css:{marginRight:"10px"},onClick:function(){m.setTransformCenter()}});c.append(u,p,d),t.append(c);for(var g=[],f=e.klCanvas.getLayers(),v=0;v<f.length;v++)g.push({image:f[v].context.canvas,isVisible:f[v].isVisible,opacity:f[v].opacity,mixModeStr:f[v].mixModeStr});g.push({image:e.importImage,isVisible:!0,opacity:1,mixModeStr:"source-over"});var m=new s.FreeTransformCanvas({elementWidth:(0,h.getPreviewWidth)(n),elementHeight:(0,h.getPreviewHeight)(n)+50,imageWidth:e.klCanvas.getLayerContext(0).canvas.width,imageHeight:e.klCanvas.getLayerContext(0).canvas.height,layers:g,transformIndex:g.length-1});function y(e,t){m.move(e,t)}(0,r.BB).css(m.getElement(),{marginTop:"10px",marginLeft:"-20px"}),t.append(m.getElement());var x=new r.BB.KeyListener({onDown:function(e){"left"===e&&y(-1,0),"right"===e&&y(1,0),"up"===e&&y(0,-1),"down"===e&&y(0,1)}});(0,a.showModal)({target:e.target,message:`<b>${(0,o.LANG)("import-as-layer-title")}</b>`,div:t,style:n?void 0:{width:"540px"},buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(t){x.destroy(),m.destroy(),(0,r.BB).destroyEl(u),(0,r.BB).destroyEl(p),(0,r.BB).destroyEl(d),"Ok"===t?e.callback(m.getTransformation(),m.getIsPixelated()):e.callback()}})}}),n("bh77f",function(t,i){e(t.exports,"testIsSmall",function(){return n});function n(){return window.innerWidth<550}}),n("ChldL",function(t,i){e(t.exports,"smallPreview",function(){return n}),e(t.exports,"mediumPreview",function(){return r}),e(t.exports,"getPreviewWidth",function(){return s}),e(t.exports,"getPreviewHeight",function(){return a});var n={width:340,height:220},r={width:540,height:300};function s(e){return e?n.width:r.width}function a(e){return e?n.height:r.height}}),n("13r5y",function(t,n){e(t.exports,"KlImageDropper",function(){return a});var r=i("cx0mh"),s=i("eWjiX"),a=function e(t){var i=this;(0,r._)(this,e),this.rootEl=(0,s.BB).el({content:"Drop to import",css:{paddingTop:"100px",position:"fixed",left:"0",top:"0",width:"100%",height:"100%",background:"rgba(50, 50, 50, 0.7)",color:"#fff",textShadow:"2px 2px #000",textAlign:"center",fontSize:"25px"}});var n=(0,s.BB).el({css:{marginTop:"50px",display:"flex",justifyContent:"center"}}),a={width:"200px",padding:"50px",margin:"10px",borderRadius:"20px",border:"1px dashed #fff",background:"#00aefe",fontWeight:"bold"},o=(0,s.BB).el({content:"As Layer",css:a}),l=(0,s.BB).el({content:"As New Image",css:a});this.rootEl.append(n),n.append(o,l);var h=0,c=0,u=0,p=function(){h=0,c=0,u=0,i.rootEl.remove()},d=function(e){return!!e.dataTransfer&&!e.dataTransfer.types.includes("text/plain")},g=function(){var e="0 0 20px 4px #fff";c>0?(o.style.boxShadow=e,l.style.boxShadow=""):u>0?(o.style.boxShadow="",l.style.boxShadow=e):(o.style.boxShadow="",l.style.boxShadow="")};o.addEventListener("dragenter",function(){c++,g()},{passive:!1}),o.addEventListener("dragleave",function(){c--,g()},{passive:!1}),l.addEventListener("dragenter",function(){u++,g()},{passive:!1}),l.addEventListener("dragleave",function(){u--,g()},{passive:!1}),window.addEventListener("dragover",function(e){d(e)&&(e.stopPropagation(),e.preventDefault())},{passive:!1}),window.addEventListener("dragenter",function(e){t.enabledTest()&&d(e)&&(0===h&&t.target.append(i.rootEl),h++)},{passive:!1}),window.addEventListener("dragleave",function(e){d(e)&&0!==h&&0===(h=Math.max(0,h-1))&&i.rootEl.remove()},{passive:!1}),window.addEventListener("drop",function(e){if(!d(e)||!e.dataTransfer||0===e.dataTransfer.files.length){p();return}e.stopPropagation(),e.preventDefault();var n="default";c>0?n="layer":u>0&&(n="image"),t.onDrop(e.dataTransfer.files,n),h>0&&i.rootEl.remove(),h=0,c=0,u=0,g()},{passive:!1}),this.rootEl.addEventListener("pointerdown",function(){p()},{passive:!1}),new s.BB.KeyListener({onDown:function(e){h>0&&"esc"===e&&p()}})}}),n("9p4Zp",function(t,n){e(t.exports,"OverlayToolspace",function(){return c});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("gmji4"),l=i("aP0jf"),h=i("1mH1z"),c=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e);var n={width:150,svHeight:90,hHeight:20,sliderHeight:25},s=!1;this.rootEl=(0,a.BB).el({className:"kl-overlay-toolspace"});var c={color:null,size:null,opacity:null},u=(0,a.BB).el({parent:this.rootEl,className:"kl-overlay-toolspace__color"}),p=new o.KlColorSliderSmall({width:n.width,heightSV:n.svHeight,heightH:n.hHeight,color:t.brushSettingService.getColor(),callback:function(e){d.style.backgroundColor="rgb("+e.r+","+e.g+","+e.b+")",t.brushSettingService.setColor(e,y)}}),d=(0,a.BB).el({css:{width:n.width+"px",height:n.hHeight+"px",pointerEvents:"none"}}),g=t.brushSettingService.getColor();d.style.backgroundColor="rgb("+g.r+","+g.g+","+g.b+")",u.append(d,p.getElement());var f=function(e){p.setColor(e),d.style.backgroundColor="rgb("+e.r+","+e.g+","+e.b+")"},v=new l.KlSlider({label:(0,h.LANG)("brush-size"),width:n.width,height:n.sliderHeight,min:0,max:500,value:50,resolution:225,eventResMs:1e3/30,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(e){t.brushSettingService.setSize(e)},formatFunc:function(e){return e<10?(0,a.BB).round(e,1):Math.round(e)}});(0,a.BB).css(v.getElement(),{marginTop:"2px"});var m=new l.KlSlider({label:(0,h.LANG)("opacity"),width:n.width,height:n.sliderHeight,min:0,max:1,value:1,resolution:225,eventResMs:1e3/30,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(e){t.brushSettingService.setOpacity(e)}});(0,a.BB).css(m.getElement(),{margin:"2px 0"}),this.rootEl.append(v.getElement(),m.getElement());var y=function(e){"color"===e.type&&(s?f(e.value):c.color=e.value),"size"===e.type&&(s?v.setValue(e.value):c.size=e.value),"opacity"===e.type&&(s?m.setValue(e.value):c.opacity=e.value),"sliderConfig"===e.type&&(v.update(e.value.sizeSlider),m.update(e.value.opacitySlider))};t.brushSettingService.subscribe(y);var x=t.brushSettingService.getSliderConfig();v.update(x.sizeSlider),m.update(x.opacitySlider),v.setValue(t.brushSettingService.getSize()),m.setValue(t.brushSettingService.getOpacity());var b=function(){(0,a.BB).unfocusAnyInput(),i.rootEl.style.display=s?"block":"none",s&&B&&(0,a.BB).css(i.rootEl,{left:B.x-Math.round(n.width/2)+"px",top:B.y-Math.round(n.svHeight+3*n.hHeight/2)+"px"})},B=null;document.addEventListener("pointermove",function(e){B={x:e.pageX,y:e.pageY}},{passive:!1}),new a.BB.KeyListener({onDown:function(e,i,n,r){if(!r){if(s){s=!1,b();return}t.enabledTest()&&B&&["ctrl+alt","cmd+alt","alt+ctrl","alt+cmd"].includes(n)&&(i.preventDefault(),s=!0,null!==c.color&&(f(c.color),c.color=null),null!==c.size&&(v.setValue(c.size),c.size=null),null!==c.opacity&&(m.setValue(c.opacity),c.opacity=null),b())}},onUp:function(e,t,i){["ctrl+alt","cmd+alt","alt+ctrl","alt+cmd"].includes(i)&&s&&(s=!1,p.end(),b())},onBlur:function(){s&&(s=!1,p.end(),b())}})}return(0,s._)(e,[{key:"getElement",value:function(){return this.rootEl}}]),e}()}),n("8jqzp",function(n,r){e(n.exports,"ToolspaceTopRow",function(){return f});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("jXqqY"),h=i("cUI0B"),c=i("9amXA"),u=i("lamRy"),p=i("5OHFZ"),d=i("a2EGp"),g=i("1mH1z"),f=/*#__PURE__*/function(){function e(i){(0,s._)(this,e);var n=function(e){var t=6+(e.extraPadding?e.extraPadding:0),i=(0,o.BB).el({className:"toolspace-row-button nohighlight",title:e.title,onClick:e.onClick,css:{padding:e.contain?t+"px 0":""}}),n=(0,o.BB).el({className:e.darkInvert?"dark-invert":void 0,css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%"}});n.style.pointerEvents="none",i.append(n);var r=new o.BB.PointerListener({target:i,onEnterLeave:function(e){i.classList.toggle("toolspace-row-button-hover",e)}});return{el:i,pointerListener:r}};this.rootEl=(0,o.BB).el({className:"kl-toolspace-row",css:{height:"36px",display:"flex"}});var r=n({onClick:i.onLogo,title:(0,g.LANG)("home"),image:i.logoImg?i.logoImg:/*@__PURE__*/t(l),contain:!0,darkInvert:!0});r.el.classList.add("kl-tool-row-border-right"),(0,o.BB).css(r.el,{width:"46px"});var a=n({onClick:i.onNew,title:(0,g.LANG)("file-new"),image:/*@__PURE__*/t(h),extraPadding:1,contain:!0}),f=n({onClick:i.onImport,title:(0,g.LANG)("file-import"),image:/*@__PURE__*/t(c),extraPadding:1,contain:!0}),v=n({onClick:i.onSave,title:(0,g.LANG)("file-save"),image:/*@__PURE__*/t(u),extraPadding:1,contain:!0}),m=null;(0,o.BB).canShareFiles()&&(m=n({onClick:i.onShare,title:(0,g.LANG)("file-share"),image:/*@__PURE__*/t(p),contain:!0,darkInvert:!0}));var y=n({onClick:i.onHelp,title:(0,g.LANG)("help"),image:/*@__PURE__*/t(d),contain:!0,darkInvert:!0});(0,o.BB).append(this.rootEl,[r.el,a.el,f.el,v.el,m?m.el:void 0,y.el])}return(0,a._)(e,[{key:"getElement",value:function(){return this.rootEl}}]),e}()}),n("jXqqY",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"klecks-logo.2dcce02e.png"}),n("cUI0B",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"new-image.2d692480.svg"}),n("9amXA",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"import.7a68c844.svg"}),n("lamRy",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"export.2deb9ff8.svg"}),n("5OHFZ",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"share.454898d1.svg"}),n("a2EGp",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"help.208e9032.svg"}),n("84zxV",function(n,r){e(n.exports,"ToolDropdown",function(){return m});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("i8UFO"),h=i("beDft"),c=i("fOpTP"),u=i("51i5Z"),p=i("hnyNy"),d=i("a5L8I"),g=i("gzQkL"),f=i("g6Z5k"),v=i("1mH1z"),m=/*#__PURE__*/function(){function e(i){var n,r,a,m=this;(0,s._)(this,e),this.smallMargin="6px 0",this.optionArr=["brush","paintBucket","gradient","text","shape","select"],this.imArr=[/*@__PURE__*/t(h),/*@__PURE__*/t(c),/*@__PURE__*/t(u),/*@__PURE__*/t(p),/*@__PURE__*/t(d),/*@__PURE__*/t(g)],this.titleArr=[`${(0,v.LANG)("tool-brush")} [B]`,`${(0,v.LANG)("tool-paint-bucket")} [G]`,`${(0,v.LANG)("tool-gradient")} [G]`,`${(0,v.LANG)("tool-text")} [T]`,`${(0,v.LANG)("tool-shape")} [U]`,`${(0,v.LANG)("tool-select")} [L]`],this.currentActiveIndex=0,this.isActive=!0;var y=!1;setTimeout(function(){for(var e=1;e<m.imArr.length;e++)new Image().src=m.imArr[e]},100),this.rootEl=(0,o.BB).el({css:{position:"relative",flexGrow:"1"}});var x=!1;o.BB.hasPointerEvents&&new o.BB.PointerListener({target:this.rootEl,onPointer:function(e){if("pointerdown"===e.type)y||(n=setTimeout(function(){S()},400),x=!0,r=e.pageX,a=e.pageY);else if("pointermove"===e.type&&x)!y&&(0,o.BB).dist(r,a,e.pageX,e.pageY)>5&&(clearTimeout(n),S());else if("pointerup"===e.type&&x&&(clearTimeout(n),x=!1,y)){for(var t=document.elementFromPoint(e.pageX,e.pageY),s=0;s<m.dropdownBtnArr.length;s++)if(t===m.dropdownBtnArr[s].wrapper){E(),m.isActive=!0,m.currentActiveIndex=s,m.updateButton(),i.onChange(m.optionArr[m.currentActiveIndex]);break}}}}),this.activeButton=(0,o.BB).el({parent:this.rootEl,className:"toolspace-row-button nohighlight toolspace-row-button-activated",title:this.titleArr[this.currentActiveIndex],onClick:function(e){if(m.isActive&&!y){e.preventDefault(),e.stopPropagation(),S();return}m.isActive=!0,i.onChange(m.optionArr[m.currentActiveIndex]),y&&E()},css:{padding:"10px 0",pointerEvents:"auto",height:"100%",boxSizing:"border-box"}}),this.activeButtonIm=(0,o.BB).el({parent:this.activeButton,className:"dark-invert",css:{backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain",width:"calc(100% - 7px)",height:"100%",pointerEvents:"none",opacity:"0.75"}}),this.arrowButton=(0,o.BB).el({parent:this.activeButton,className:"dark-invert",css:{position:"absolute",right:"1px",bottom:"1px",width:"18px",height:"18px",cursor:"pointer",backgroundImage:"url('"+/*@__PURE__*/t(f)+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"60%"},title:"More Tools",onClick:function(e){e.preventDefault(),e.stopPropagation(),S()}});var b=(0,o.BB).el({css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0"}});new o.BB.PointerListener({target:b,onPointer:function(e){"pointerdown"===e.type&&(e.eventPreventDefault(),E())}});var B=(0,o.BB).el({className:"tool-dropdown-wrapper",css:{position:"absolute",width:"100%",height:100*(this.optionArr.length-1)+"%",top:"100%",left:"0",zIndex:"1",boxSizing:"border-box",cursor:"pointer",transition:"height 0.1s ease-in-out, opacity 0.1s ease-in-out",borderBottomLeftRadius:"5px",borderBottomRightRadius:"5px",overflow:"hidden"}});this.dropdownBtnArr=[];for(var w=function(e){var t=(0,o.BB).el({parent:B,className:"tool-dropdown-button",title:e.title,css:{padding:"10px 0",height:100/(m.optionArr.length-1)+"%",boxSizing:"border-box"},onClick:function(t){t.preventDefault(),t.stopPropagation(),e.onClick(e.index)}});return(0,o.BB).el({parent:t,className:"dark-invert",css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain",height:"100%",pointerEvents:"none",opacity:"0.75"}}),{wrapper:t,show:function(e){t.style.display=e?"block":"none"},setIsSmall:function(e){t.style.padding=e?m.smallMargin:"10px 0"}}},k=function(e){E(),m.isActive=!0,m.currentActiveIndex=e,m.updateButton(),i.onChange(m.optionArr[m.currentActiveIndex])},C=0;C<this.optionArr.length;C++)this.dropdownBtnArr.push(w({index:C,id:this.optionArr[C],image:this.imArr[C],title:this.titleArr[C],onClick:k}));var S=function(){(0,l.dialogCounter).increase(.5),y=!0;for(var e=0;e<m.optionArr.length;e++)m.dropdownBtnArr[e].show(m.currentActiveIndex!==e);m.arrowButton.style.display="none",m.rootEl.style.zIndex="1",document.body.append(b),m.rootEl.append(B)},E=function(){(0,l.dialogCounter).decrease(.5),y=!1,m.arrowButton.style.removeProperty("display"),m.rootEl.style.removeProperty("z-index"),b.remove(),B.remove()};this.updateButton()}return(0,a._)(e,[{key:"updateButton",value:function(){this.activeButton.title=this.titleArr[this.currentActiveIndex],this.activeButtonIm.style.backgroundImage="url('"+this.imArr[this.currentActiveIndex]+"')"}},{key:"setIsSmall",value:function(e){this.activeButton.style.padding=e?this.smallMargin:"10px 0";for(var t=0;t<this.optionArr.length;t++)this.dropdownBtnArr[t].setIsSmall(e);e?(this.arrowButton.style.width="14px",this.arrowButton.style.height="14px"):(this.arrowButton.style.width="18px",this.arrowButton.style.height="18px")}},{key:"setActive",value:function(e){if(this.optionArr.includes(e)){this.isActive=!0;for(var t=0;t<this.optionArr.length;t++)if(this.optionArr[t]===e){this.currentActiveIndex=t;break}this.activeButton.classList.add("toolspace-row-button-activated"),this.updateButton()}else this.isActive=!1,this.activeButton.classList.remove("toolspace-row-button-activated")}},{key:"getActive",value:function(){return this.optionArr[this.currentActiveIndex]}},{key:"getElement",value:function(){return this.rootEl}}]),e}()}),n("beDft",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"tool-paint.f73a8943.svg"}),n("fOpTP",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"tool-fill.3358320a.svg"}),n("51i5Z",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"tool-gradient.64486254.svg"}),n("hnyNy",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"tool-text.1cbd0325.svg"}),n("a5L8I",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"tool-shape.3de78c3f.svg"}),n("gzQkL",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"tool-select.bd971ee9.svg"}),n("9Kxky",function(n,r){e(n.exports,"ToolspaceToolRow",function(){return g});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("84zxV"),h=i("fJXlf"),c=i("hzavh"),u=i("5LsQG"),p=i("b3iUb"),d=i("1mH1z"),g=/*#__PURE__*/function(){function e(i){var n=this;(0,s._)(this,e),this.rootEl=(0,o.BB).el({className:"kl-toolspace-row",css:{height:"54px",display:"flex"}}),this.onActivate=i.onActivate,this.currentActiveStr="brush";var r=function(e){var t=e.doLighten?"6px 0":"8px 0",i=(0,o.BB).el({className:"toolspace-row-button nohighlight",onClick:e.onClick,css:{padding:e.contain?"10px 0":""}}),n=(0,o.BB).el({className:"dark-invert",css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%",transform:e.doMirror?"scale(-1, 1)":"",pointerEvents:"none",opacity:e.doLighten?"0.75":"1"}});i.append(n);var r=new o.BB.PointerListener({target:i,onEnterLeave:function(e){i.classList.toggle("toolspace-row-button-hover",e)}});return{el:i,pointerListener:r,setIsSmall:function(n){i.style.padding=e.contain?n?t:"10px 0":""}}},a=function(e){var t=(0,o.BB).el({css:{flexGrow:"1",position:"relative"}}),i=(0,o.BB).createSvg({elementType:"svg",width:"67px",height:"54px",viewBox:"0 0 100 100",preserveAspectRatio:"none"});(0,o.BB).css(i,{position:"absolute",left:"0",top:"0"});var n=(0,o.BB).createSvg({elementType:"defs",childrenArr:[{elementType:"filter",id:"innershadow",x0:"-50%",y0:"-50%",width:"200%",height:"200%",childrenArr:[{elementType:"feGaussianBlur",in:"SourceAlpha",stdDeviation:"10",result:"blur"},{elementType:"feOffset",dx:"2",dy:"2"},{elementType:"feComposite",in2:"SourceAlpha",operator:"arithmetic",k2:"-1",k3:"1",result:"shadowDiff"},{elementType:"feFlood","flood-color":"#000","flood-opacity":"0.2"},{elementType:"feComposite",in2:"shadowDiff",operator:"in"},{elementType:"feComposite",in2:"SourceGraphic",operator:"over",result:"firstfilter"},{elementType:"feGaussianBlur",in:"firstfilter",stdDeviation:"10",result:"blur2"},{elementType:"feOffset",dx:"2",dy:"2"},{elementType:"feComposite",in2:"firstfilter",operator:"arithmetic",k2:"-1",k3:"1",result:"shadowDiff"},{elementType:"feFlood","flood-color":"#000","flood-opacity":"0.2"},{elementType:"feComposite",in2:"shadowDiff",operator:"in"},{elementType:"feComposite",in2:"firstfilter",operator:"over"}]}]}),r=(0,o.BB).createSvg({elementType:"path","vector-effect":"non-scaling-stroke",d:"M0,0 L 100,0 0,100 z",fill:"rgba(0,0,0,0)",class:"toolspace-svg-triangle-button"});r.onclick=function(){e.onLeft(),r.classList.remove("toolspace-svg-triangle-button-hover")};var s=(0,o.BB).createSvg({elementType:"path","vector-effect":"non-scaling-stroke",d:"M100,100 L 100,0 0,100 z",fill:"rgba(0,0,0,0)",class:"toolspace-svg-triangle-button"});s.onclick=function(){e.onRight(),s.classList.remove("toolspace-svg-triangle-button-hover")};var a=new o.BB.PointerListener({target:r,onEnterLeave:function(e){r.classList.toggle("toolspace-svg-triangle-button-hover",e)}}),l=new o.BB.PointerListener({target:s,onEnterLeave:function(e){s.classList.toggle("toolspace-svg-triangle-button-hover",e)}});i.append(n,r,s),t.append(i);var h=(0,o.BB).el({parent:t,className:"dark-invert",css:{backgroundImage:"url('"+e.leftImage+"')",backgroundRepeat:"no-repeat",backgroundSize:"contain",width:"20px",height:"20px",position:"absolute",left:"10px",top:"8px",pointerEvents:"none"}});t.append(h);var c=(0,o.BB).el({parent:t,className:"dark-invert",css:{backgroundImage:"url('"+(e.rightImage?e.rightImage:e.leftImage)+"')",backgroundRepeat:"no-repeat",backgroundSize:"contain",width:"20px",height:"20px",position:"absolute",right:"10px",bottom:"8px",transform:e.rightImage?"":"scale(-1, 1)",pointerEvents:"none"}});return{el:t,setIsEnabledLeft:function(e){r.classList.toggle("toolspace-row-button-disabled",!e),h.classList.toggle("toolspace-row-button-disabled",!e)},setIsEnabledRight:function(e){s.classList.toggle("toolspace-row-button-disabled",!e),c.classList.toggle("toolspace-row-button-disabled",!e)},leftPointerListener:a,rightPointerListener:l}};this.toolDropdown=new l.ToolDropdown({onChange:function(e){n.setActive(e,!0)}}),this.rootEl.append(this.toolDropdown.getElement()),this.handButton=r({onClick:function(){n.setActive("hand",!0)},image:/*@__PURE__*/t(h),contain:!0,doLighten:!0}),this.handButton.el.classList.add("kl-tool-row-border-right"),this.handButton.el.title=(0,d.LANG)("tool-hand"),this.rootEl.append(this.handButton.el),this.zoomInNOutButton=a({onLeft:i.onZoomIn,onRight:i.onZoomOut,leftImage:/*@__PURE__*/t(c),rightImage:/*@__PURE__*/t(u)}),this.zoomInNOutButton.el.title=(0,d.LANG)("tool-zoom"),this.rootEl.append(this.zoomInNOutButton.el),this.zoomInButton=r({onClick:i.onZoomIn,image:/*@__PURE__*/t(c),contain:!0}),this.zoomInButton.el.title=(0,d.LANG)("zoom-in"),this.rootEl.append(this.zoomInButton.el),this.zoomOutButton=r({onClick:i.onZoomOut,image:/*@__PURE__*/t(u),contain:!0}),this.zoomOutButton.el.title=(0,d.LANG)("zoom-out"),this.rootEl.append(this.zoomOutButton.el),this.undoNRedoButton=a({onLeft:i.onUndo,onRight:i.onRedo,leftImage:/*@__PURE__*/t(p),rightImage:null}),this.undoNRedoButton.el.title=(0,d.LANG)("undo")+"/"+(0,d.LANG)("redo"),this.undoNRedoButton.setIsEnabledLeft(!1),this.undoNRedoButton.setIsEnabledRight(!1),this.rootEl.append(this.undoNRedoButton.el),this.undoButton=r({onClick:i.onUndo,image:/*@__PURE__*/t(p),contain:!0}),this.undoButton.el.title=(0,d.LANG)("undo"),this.undoButton.el.classList.add("toolspace-row-button-disabled"),this.rootEl.append(this.undoButton.el),this.redoButton=r({onClick:i.onRedo,image:/*@__PURE__*/t(p),contain:!0,doMirror:!0}),this.redoButton.el.title=(0,d.LANG)("redo"),this.redoButton.el.classList.add("toolspace-row-button-disabled"),this.rootEl.append(this.redoButton.el),this.zoomInButton.el.style.display="none",this.zoomOutButton.el.style.display="none",this.undoButton.el.style.display="none",this.redoButton.el.style.display="none"}return(0,a._)(e,[{key:"getElement",value:function(){return this.rootEl}},{key:"setIsSmall",value:function(e){(0,o.BB).css(this.rootEl,{height:e?"36px":"54px"}),this.toolDropdown.setIsSmall(e),this.handButton.setIsSmall(e),this.zoomInButton.setIsSmall(e),this.zoomOutButton.setIsSmall(e),this.undoButton.setIsSmall(e),this.redoButton.setIsSmall(e),e?(this.zoomInNOutButton.el.style.display="none",this.undoNRedoButton.el.style.display="none",this.zoomInButton.el.style.display="block",this.zoomOutButton.el.style.display="block",this.undoButton.el.style.display="block",this.redoButton.el.style.display="block"):(this.zoomInNOutButton.el.style.display="block",this.undoNRedoButton.el.style.display="block",this.zoomInButton.el.style.display="none",this.zoomOutButton.el.style.display="none",this.undoButton.el.style.display="none",this.redoButton.el.style.display="none")}},{key:"setEnableZoomIn",value:function(e){this.zoomInButton.el.classList.toggle("toolspace-row-button-disabled",!e),this.zoomInNOutButton.setIsEnabledLeft(e)}},{key:"setEnableZoomOut",value:function(e){this.zoomOutButton.el.classList.toggle("toolspace-row-button-disabled",!e),this.zoomInNOutButton.setIsEnabledRight(e)}},{key:"setEnableUndo",value:function(e){this.undoButton.el.classList.toggle("toolspace-row-button-disabled",!e),this.undoNRedoButton.setIsEnabledLeft(e)}},{key:"setEnableRedo",value:function(e){this.redoButton.el.classList.toggle("toolspace-row-button-disabled",!e),this.undoNRedoButton.setIsEnabledRight(e)}},{key:"setActive",value:function(e,t){this.currentActiveStr!==e&&(this.currentActiveStr=e,this.toolDropdown.setActive(this.currentActiveStr),this.handButton.el.classList.toggle("toolspace-row-button-activated","hand"===this.currentActiveStr),t&&this.onActivate(this.currentActiveStr))}},{key:"getActive",value:function(){return this.currentActiveStr}}]),e}()}),n("b3iUb",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"tool-undo.540bf765.svg"}),n("1Ax5m",function(t,n){e(t.exports,"ToolspaceStabilizerRow",function(){return h});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("eEL9N"),l=i("1mH1z"),h=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.rootEl=(0,a.BB).el({tagName:"label",className:"kl-stabilizer",content:(0,l.LANG)("stabilizer")+"&nbsp;",title:(0,l.LANG)("stabilizer-title")});var i=new o.Select({optionArr:[["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"]],initValue:""+t.smoothing,onChange:function(e){t.onSelect(parseInt(e))}});this.rootEl.append(i.getElement()),this.pointerListener=new a.BB.PointerListener({target:this.rootEl,onWheel:function(e){i.setDeltaValue(e.deltaY)}})}return(0,s._)(e,[{key:"getElement",value:function(){return this.rootEl}}]),e}()}),n("e4sAN",function(n,r){e(n.exports,"TabRow",function(){return h});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("8yDbi"),h=/*#__PURE__*/function(){function e(i){var n,r=this;(0,s._)(this,e);var a=null!==(n=i.height)&&void 0!==n?n:35;this.rootEl=(0,o.BB).el({className:"tabrow",css:{height:a+1+"px"}}),this.tabArr=[],this.roundRight=(0,o.BB).el({css:{width:"10px",height:"10px",backgroundImage:`url('${/*@__PURE__*/t(l)}')`,backgroundSize:"cover",position:"absolute",right:"-10px",bottom:"0",pointerEvents:"none"}}),this.roundLeft=(0,o.BB).el({css:{width:"10px",height:"10px",backgroundImage:`url('${/*@__PURE__*/t(l)}')`,backgroundSize:"cover",position:"absolute",left:"-10px",bottom:"0",transform:"scale(-1,1)",pointerEvents:"none"}});for(var h=function(e,t,i){var n=!("isVisible"in e)||void 0===e.isVisible||e.isVisible,s={id:e.id,isVisible:n,onOpen:e.onOpen,onClose:e.onClose,update:function(e){s.el.className=e===s?i?"tabrow__tab tabrow__tab--opened-accented":"tabrow__tab tabrow__tab--opened":"tabrow__tab",s.el.style.display=s.isVisible?"block":"none"},el:(0,o.BB).el({parent:r.rootEl,content:"label"in e?e.label:"",title:"title"in e?e.title:void 0,className:t===e.id?i?"tabrow__tab tabrow__tab--opened-accented":"tabrow__tab tabrow__tab--opened":"tabrow__tab",css:{lineHeight:a+"px",display:n?"block":"none",zIndex:"0"},onClick:function(){r.activeTab!==s&&r.open(s.id)}}),pointerListener:{}};return"image"in e&&(0,o.BB).el({tagName:"span",parent:s.el,className:"dark-invert",css:{backgroundImage:`url("${e.image}")`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",display:"flex",height:a-7+"px",justifyContent:"center",margin:"4px auto"}}),"css"in e&&void 0!==e.css&&(0,o.BB).css(s.el,e.css),s.pointerListener=new o.BB.PointerListener({target:s.el,onEnterLeave:function(e){s.el.classList.toggle("tabrow__tab-hover",e)}}),t===s.id?(s.onOpen(),s.el.append(r.roundRight,r.roundLeft)):s.onClose(),s},c=null,u=0;u<i.tabArr.length;u++){var p=h(i.tabArr[u],i.initialId,i.useAccent||!1);p.id===i.initialId&&(c=p),this.tabArr.push(p)}if(!c)throw"invalid initialId";this.activeTab=c}return(0,a._)(e,[{key:"update",value:function(){for(var e=0;e<this.tabArr.length;e++)this.tabArr[e].update(this.activeTab)}},{key:"getElement",value:function(){return this.rootEl}},{key:"open",value:function(e){for(var t=0;t<this.tabArr.length;t++)if(this.tabArr[t].id===e){if(this.activeTab===this.tabArr[t])return;this.activeTab.onClose(),this.activeTab=this.tabArr[t],this.activeTab.onOpen(),this.activeTab.el.append(this.roundRight,this.roundLeft),this.update();return}throw"TabRow.open - invalid tabId"}},{key:"getOpenedTabId",value:function(){return""+this.activeTab.id}},{key:"setIsVisible",value:function(e,t){for(var i=0;i<this.tabArr.length;i++)if(this.tabArr[i].id===e){this.tabArr[i].isVisible=t,this.update();return}throw"TabRow.setIsVisible - invalid tabId"}},{key:"destroy",value:function(){this.tabArr.forEach(function(e){(0,o.BB).destroyEl(e.el),e.pointerListener.destroy()})}}]),e}()}),n("8yDbi",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"inverted-border.3353c7f3.svg"}),n("khi8I",function(n,r){e(n.exports,"HandUi",function(){return u});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("9651N"),h=i("7WTfQ"),c=i("1mH1z"),u=/*#__PURE__*/function(){function e(i){(0,s._)(this,e),this.isVisible=!0,this.rootEl=(0,o.BB).el({css:{margin:"10px"}}),this.scale=i.scale,this.angleDeg=i.angleDeg,this.onAngleChange=i.onAngleChange;var n=(0,o.BB).el({css:{marginBottom:"10px",display:"flex"}}),r=(0,o.BB).el({css:{display:"flex",marginBottom:"10px"}}),a=(0,o.BB).el({css:{display:"flex"}});this.rootEl.append(n,r,a),this.scaleEl=(0,o.BB).el({css:{width:"55px",userSelect:"none"}}),n.append(this.scaleEl),this.angleIm=new Image,this.angleIm.src=/*@__PURE__*/t(l),(0,o.BB).css(this.angleIm,{verticalAlign:"bottom",width:"20px",height:"20px",marginRight:"5px",borderRadius:"10px",background:"rgba(0,0,0,0.2)",userSelect:"none"}),n.append(this.angleIm),this.angleEl=(0,o.BB).el({parent:n,css:{userSelect:"none"}}),this.updateUi();var u=(0,o.BB).el({tagName:"button",content:(0,c.LANG)("hand-reset"),onClick:i.onReset});(0,o.BB).makeUnfocusable(u);var p=(0,o.BB).el({tagName:"button",content:(0,c.LANG)("hand-fit"),css:{marginLeft:"10px"},onClick:i.onFit});(0,o.BB).makeUnfocusable(p),r.append(u,p);var d=(0,o.BB).el({tagName:"button",content:'<img height="20" src="'+/*@__PURE__*/t(h)+'" alt="Rotate" style="transform: scale(-1, 1)"/>',onClick:function(){i.onAngleChange(-15,!0)}});(0,o.BB).makeUnfocusable(d);var g=(0,o.BB).el({tagName:"button",content:"0°",css:{marginLeft:"10px"},onClick:function(){i.onAngleChange(0)}});(0,o.BB).makeUnfocusable(g);var f=(0,o.BB).el({tagName:"button",content:'<img height="20" src="'+/*@__PURE__*/t(h)+'" alt="Rotate"/>',css:{marginLeft:"10px"},onClick:function(){i.onAngleChange(15,!0)}});(0,o.BB).makeUnfocusable(f),a.append(d,g,f)}return(0,a._)(e,[{key:"updateUi",value:function(){this.scaleEl.innerHTML=Math.round(100*this.scale)+"%",this.angleEl.innerHTML=Math.round(this.angleDeg)+"°",this.angleIm.style.transform="rotate("+this.angleDeg+"deg)",this.angleDeg%90==0?this.angleIm.style.boxShadow="inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)":this.angleIm.style.boxShadow=""}},{key:"getElement",value:function(){return this.rootEl}},{key:"setIsVisible",value:function(e){this.isVisible=!!e,this.rootEl.style.display=this.isVisible?"block":"none",this.isVisible&&this.updateUi()}},{key:"update",value:function(e,t){this.scale=e,this.angleDeg=t,this.isVisible&&this.updateUi()}}]),e}()}),n("7WTfQ",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-rotate.fd0e572a.svg"}),n("dJXmR",function(t,n){e(t.exports,"FillUi",function(){return u});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("aP0jf"),l=i("eEL9N"),h=i("7bWhB"),c=i("1mH1z"),u=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.rootEl=(0,a.BB).el({css:{margin:"10px"}}),this.isVisible=!0,this.colorDiv=(0,a.BB).el({parent:this.rootEl,css:{marginBottom:"10px"}}),this.colorSlider=t.colorSlider,this.opacitySlider=new o.KlSlider({label:(0,c.LANG)("opacity"),width:250,height:30,min:.01,max:1,value:1,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e}}),this.rootEl.append(this.opacitySlider.getElement()),this.toleranceSlider=new o.KlSlider({label:(0,c.LANG)("bucket-tolerance"),width:250,height:30,min:0,max:255,value:51,toValue:function(e){return 2.55*e},toDisplayValue:function(e){return e/2.55}}),(0,a.BB).css(this.toleranceSlider.getElement(),{marginTop:"10px"}),this.rootEl.append(this.toleranceSlider.getElement());var n=(0,a.BB).el({parent:this.rootEl,css:{display:"flex",marginTop:"10px"}}),s=(0,a.BB).el({content:(0,c.LANG)("bucket-sample")+"&nbsp;",title:(0,c.LANG)("bucket-sample-title"),css:{fontSize:"15px"}});this.modeSelect=new l.Select({optionArr:[["all",(0,c.LANG)("bucket-sample-all")],["current",(0,c.LANG)("bucket-sample-active")],["above",(0,c.LANG)("bucket-sample-above")]],initValue:"all"}),new a.BB.PointerListener({target:this.modeSelect.getElement(),onWheel:function(e){i.modeSelect.setDeltaValue(e.deltaY)}}),s.append(this.modeSelect.getElement()),n.append(s);var u=(0,a.BB).el({content:(0,c.LANG)("bucket-grow")+"&nbsp;",title:(0,c.LANG)("bucket-grow-title"),css:{fontSize:"15px",marginLeft:"10px"}});this.growSelect=new l.Select({optionArr:[["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"]],initValue:"0"}),new a.BB.PointerListener({target:this.growSelect.getElement(),onWheel:function(e){i.growSelect.setDeltaValue(e.deltaY)}}),u.append(this.growSelect.getElement()),n.append(u),this.isContiguous=!0;var p=new h.Checkbox({init:!0,label:(0,c.LANG)("bucket-contiguous"),title:(0,c.LANG)("bucket-contiguous-title"),callback:function(e){i.isContiguous=e},css:{paddingRight:"5px",display:"inline-block",width:"50%"}});this.eraserToggle=new h.Checkbox({init:!1,label:(0,c.LANG)("eraser"),css:{paddingRight:"5px",display:"inline-block",width:"50%"}}),this.rootEl.append((0,a.BB).el({content:[p.getElement(),this.eraserToggle.getElement()],css:{display:"flex",marginTop:"10px"}}))}return(0,s._)(e,[{key:"getElement",value:function(){return this.rootEl}},{key:"setIsVisible",value:function(e){this.isVisible=!!e,this.rootEl.style.display=this.isVisible?"block":"none",this.isVisible&&this.colorDiv.append(this.colorSlider.getElement(),this.colorSlider.getOutputElement())}},{key:"getTolerance",value:function(){return 0===Math.round(this.toleranceSlider.getDisplayValue())?0:this.toleranceSlider.getValue()}},{key:"getOpacity",value:function(){return this.opacitySlider.getValue()}},{key:"getSample",value:function(){return this.modeSelect.getValue()}},{key:"getGrow",value:function(){return parseInt(this.growSelect.getValue(),10)}},{key:"getContiguous",value:function(){return this.isContiguous}},{key:"getIsEraser",value:function(){return this.eraserToggle.getValue()}}]),e}()}),n("iS9xS",function(t,n){e(t.exports,"TextUi",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("1mH1z"),l=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.isVisible=!0,this.rootEl=(0,a.BB).el({css:{margin:"10px"}}),this.colorSlider=t.colorSlider,this.colorDiv=(0,a.BB).el({parent:this.rootEl,css:{marginBottom:"10px"}}),(0,a.BB).el({parent:this.rootEl,content:(0,o.LANG)("text-instruction")})}return(0,s._)(e,[{key:"getElement",value:function(){return this.rootEl}},{key:"setIsVisible",value:function(e){this.isVisible=!!e,this.rootEl.style.display=this.isVisible?"block":"none",this.isVisible&&this.colorDiv.append(this.colorSlider.getElement(),this.colorSlider.getOutputElement())}}]),e}()}),n("9J17G",function(t,n){e(t.exports,"ShapeUi",function(){return u});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("iFIyy"),l=i("7bWhB"),h=i("aP0jf"),c=i("1mH1z"),u=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.shape="rect",this.mode="stroke",this.rootEl=(0,a.BB).el({css:{margin:"10px"}}),this.isVisible=!0,this.colorDiv=(0,a.BB).el({parent:this.rootEl,css:{marginBottom:"10px"}}),this.colorSlider=t.colorSlider;var n=(0,a.BB).createSvg({elementType:"rect",x:"8",width:"19"}),s=(0,a.BB).createSvg({elementType:"svg",width:"35",height:"35"});s.classList.add("dark-invert"),s.append(n),(0,a.BB).css(s,{display:"block"});var u=(0,a.BB).createSvg({elementType:"rect",x:"8",width:"19"}),p=(0,a.BB).createSvg({elementType:"svg",width:"35",height:"35"});p.classList.add("dark-invert"),p.append(u),(0,a.BB).css(p,{display:"block"});var d=(0,a.BB).createSvg({elementType:"ellipse",cx:"17.5",cy:"17.5",rx:"9.5"}),g=(0,a.BB).createSvg({elementType:"svg",width:"35",height:"35"});g.classList.add("dark-invert"),g.append(d),(0,a.BB).css(g,{display:"block"});var f=(0,a.BB).createSvg({elementType:"ellipse",cx:"17.5",cy:"17.5",rx:"9.5"}),v=(0,a.BB).createSvg({elementType:"svg",width:"35",height:"35"});v.classList.add("dark-invert"),v.append(f),(0,a.BB).css(v,{display:"block"});var m=(0,a.BB).createSvg({elementType:"line",x1:"8",x2:"27"}),y=(0,a.BB).createSvg({elementType:"svg",width:"35",height:"35"});y.classList.add("dark-invert"),y.append(m),(0,a.BB).css(y,{display:"block"});var x=function(){var e=(0,a.BB).clamp(Math.round(i.lineWidthSlider.getValue()/10),1,10)+"px";(0,a.BB).css(n,{fill:"none",stroke:"black",strokeWidth:e}),(0,a.BB).css(u,{fill:"black",stroke:"none"}),(0,a.BB).css(d,{fill:"none",stroke:"black",strokeWidth:e}),(0,a.BB).css(f,{fill:"black",stroke:"none"}),(0,a.BB).css(m,{fill:"none",stroke:"black",strokeWidth:e}),i.fixedToggle.getValue()?(n.setAttribute("y","8"),n.setAttribute("height","19"),u.setAttribute("y","8"),u.setAttribute("height","19"),d.setAttribute("ry","9.5"),f.setAttribute("ry","9.5")):(n.setAttribute("y","10.8"),n.setAttribute("height","13.399999999999999"),u.setAttribute("y","10.8"),u.setAttribute("height","13.399999999999999"),d.setAttribute("ry","6.699999999999999"),f.setAttribute("ry","6.699999999999999")),i.snapToggle.getValue()?(m.setAttribute("y1","27"),m.setAttribute("y2","8")):(m.setAttribute("y1","24.2"),m.setAttribute("y2","10.8"))},b=(0,a.BB).el({parent:this.rootEl,css:{display:"flex",justifyContent:"space-between",alignItems:"start"}}),B=new o.Options({optionArr:[{id:"rect-stroke",label:s,title:(0,c.LANG)("shape-rect")+" "+(0,c.LANG)("shape-stroke")},{id:"ellipse-stroke",label:g,title:(0,c.LANG)("shape-ellipse")+" "+(0,c.LANG)("shape-stroke")},{id:"line",label:y,title:(0,c.LANG)("shape-line")},{id:"rect-fill",label:p,title:(0,c.LANG)("shape-rect")+" "+(0,c.LANG)("shape-fill")},{id:"ellipse-fill",label:v,title:(0,c.LANG)("shape-ellipse")+" "+(0,c.LANG)("shape-fill")}],initId:this.shape+" "+this.mode,onChange:function(e){var t=e.split("-");i.shape=t[0],i.mode=t[1],(0,a.BB).css(i.fixedToggle.getElement(),{display:"line"===i.shape?"none":""}),(0,a.BB).css(i.snapToggle.getElement(),{display:"line"===i.shape?"":"none"}),(0,a.BB).css(i.lineWidthSlider.getElement(),{display:"line"!==i.shape&&"fill"===i.mode?"none":""})},changeOnInit:!0});B.getElement().style.width="120px",b.append(B.getElement()),this.eraserToggle=new l.Checkbox({init:!1,label:(0,c.LANG)("eraser"),callback:function(){x()}}),this.lockAlphaToggle=new l.Checkbox({init:!1,label:(0,c.LANG)("lock-alpha"),title:(0,c.LANG)("lock-alpha-title"),doHighlight:!0}),this.lockAlphaToggle.getElement().style.marginTop="10px",b.append((0,a.BB).el({content:[this.eraserToggle.getElement(),this.lockAlphaToggle.getElement()]})),this.lineWidthSlider=new h.KlSlider({label:(0,c.LANG)("shape-line-width"),width:250,height:30,min:1,max:200,value:4,curve:"quadratic",onChange:function(){x()}}),(0,a.BB).css(this.lineWidthSlider.getElement(),{marginTop:"10px"}),this.rootEl.append(this.lineWidthSlider.getElement()),this.opacitySlider=new h.KlSlider({label:(0,c.LANG)("opacity"),width:250,height:30,min:.01,max:1,value:1,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e}}),(0,a.BB).css(this.opacitySlider.getElement(),{marginTop:"10px"}),this.rootEl.append(this.opacitySlider.getElement());var w=(0,a.BB).el({parent:this.rootEl,css:{display:"flex",alignItems:"center",marginTop:"10px"}});this.outwardsToggle=new l.Checkbox({init:!1,label:(0,c.LANG)("shape-outwards"),css:{width:"50%",marginRight:"10px"}}),w.append(this.outwardsToggle.getElement()),this.fixedToggle=new l.Checkbox({init:!1,label:(0,c.LANG)("shape-fixed"),callback:function(){x()},css:{flexGrow:"1"}}),w.append(this.fixedToggle.getElement()),this.snapToggle=new l.Checkbox({init:!1,label:(0,c.LANG)("angle-snap"),title:(0,c.LANG)("angle-snap-title"),callback:function(){x()},css:{flexGrow:"1"}}),w.append(this.snapToggle.getElement()),x()}return(0,s._)(e,[{key:"getElement",value:function(){return this.rootEl}},{key:"setIsVisible",value:function(e){this.isVisible=!!e,this.rootEl.style.display=this.isVisible?"block":"none",this.isVisible&&(this.colorDiv.append(this.colorSlider.getElement()),this.colorDiv.append(this.colorSlider.getOutputElement()))}},{key:"getShape",value:function(){return this.shape}},{key:"getMode",value:function(){return this.mode}},{key:"getIsEraser",value:function(){return this.eraserToggle.getValue()}},{key:"getOpacity",value:function(){return this.opacitySlider.getValue()}},{key:"getLineWidth",value:function(){return this.lineWidthSlider.getValue()}},{key:"getIsOutwards",value:function(){return this.outwardsToggle.getValue()}},{key:"getIsFixed",value:function(){return this.fixedToggle.getValue()}},{key:"getIsSnap",value:function(){return this.snapToggle.getValue()}},{key:"getDoLockAlpha",value:function(){return this.lockAlphaToggle.getValue()}}]),e}()}),n("76Qvv",function(t,n){e(t.exports,"newImageDialog",function(){return p});var r=i("eWjiX"),s=i("eEL9N"),a=i("43qNf"),o=i("2MaaK"),l=i("1mH1z"),h=i("cNr8p"),c=i("fohxs"),u=i("1C8RU");function p(e){var t=e.currentColor,i=e.secondaryColor,n=e.maxCanvasSize,p=e.canvasWidth,d=e.canvasHeight,g=e.workspaceWidth,f=e.workspaceHeight,v=e.onConfirm,m=e.onCancel;function y(e,t,i,s,a){return(0,r.BB).fitInto(e,t,Math.min(n,i-a),Math.min(n,s-a),1)}var x=(0,r.BB).el(),b=(0,r.BB).el({tagName:"input"}),B={color:"#888",fontSize:"12px",marginLeft:"5px"},w=(0,r.BB).el({textContent:(0,l.LANG)("new-px"),css:B}),k=(0,r.BB).el({tagName:"input"}),C=(0,r.BB).el({textContent:(0,l.LANG)("new-px"),css:B});b.setAttribute("data-ignore-focus","true"),k.setAttribute("data-ignore-focus","true"),b.type="number",b.min="1",b.max=""+n,(0,r.BB).css(b,{width:"70px"}),k.type="number",k.min="1",k.max=""+n,k.style.width="70px",b.value=""+p,k.value=""+d,b.onclick=function(){b.focus(),F()},k.onclick=function(){k.focus(),F()};var S=(0,h.table)([[(0,l.LANG)("width")+":&nbsp;",b,w],[(0,r.BB).el({css:{height:"5px"}}),"",""],[(0,l.LANG)("height")+":&nbsp;",k,C]]);(0,r.BB).css(S,{marginBottom:"10px"});var E=(0,r.BB).el({css:{marginTop:"5px",color:"#888"}}),L=(0,r.BB).el({css:{display:"flex",flexWrap:"wrap",gap:"5px"}}),A=(0,r.BB).el({tagName:"button"});L.style.marginBottom="10px";var I=(0,r.BB).el({tagName:"button"}),T=(0,r.BB).el({tagName:"button"}),P=(0,r.BB).el({tagName:"button"}),R=(0,r.BB).el({tagName:"button"}),M=(0,r.BB).el({tagName:"button"});I.textContent=(0,l.LANG)("new-current"),A.textContent=(0,l.LANG)("new-fit"),M.textContent=(0,l.LANG)("new-oversize"),P.textContent=(0,l.LANG)("new-landscape"),R.textContent=(0,l.LANG)("new-portrait"),T.textContent=(0,l.LANG)("new-square"),L.append(I,A,M,T,P,R),I.onclick=function(){b.value=""+p,k.value=""+d,F()},A.onclick=function(){b.value=""+g,k.value=""+f,F()},M.onclick=function(){b.value=""+(g+500),k.value=""+(f+500),F()},T.onclick=function(){var e=y(1,1,g,f,0);b.value=""+Math.round(e.width),k.value=""+Math.round(e.height),F()},P.onclick=function(){var e=y(4,3,g,f,0);b.value=""+Math.round(e.width),k.value=""+Math.round(e.height),F()},R.onclick=function(){var e=y(3,4,g,f,0);b.value=""+Math.round(e.width),k.value=""+Math.round(e.height),F()};var D=new s.Select({isFocusable:!0,optionArr:[["screen",(0,l.LANG)("new-screen")],["16 9",(0,l.LANG)("new-video")+" 16:9"],["3 2","3:2"],["5 3","5:3"],["2 1","2:1"],["paper",(0,l.LANG)("new-din-paper")+" √2:1"],["9 16","9:16"],["2 3","2:3"],["3 5","3:5"],["1 2","1:2"],["1 1.4142135623730951","1:√2"]],onChange:function(e){if("screen"===e)b.value=""+window.screen.width,k.value=""+window.screen.height;else if("paper"===e){var t=y(Math.sqrt(2),1,g,f,0);b.value=""+Math.round(t.width),k.value=""+Math.round(t.height)}else{var i=e.split(" "),n=y(parseFloat(i[0]),parseFloat(i[1]),g,f,0);b.value=""+Math.round(n.width),k.value=""+Math.round(n.height)}F(),D.setValue(void 0)}});setTimeout(function(){D.setValue(void 0)},0),(0,r.BB).css(D.getElement(),{width:"80px"}),L.append(D.getElement());var O={r:255,g:255,b:255,a:1},_=[{r:255,g:255,b:255,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:0},{r:t.r,g:t.g,b:t.b,a:1},{r:i.r,g:i.g,b:i.b,a:1}],N=0;(0,u.theme).isDark()&&_.forEach(function(e,t){e.r===c.ERASE_COLOR&&e.g===c.ERASE_COLOR&&e.b===c.ERASE_COLOR&&(N=t,O=e)});var z=new a.ColorOptions({colorArr:_,initialIndex:N,onChange:function(e){O=e,j.style.backgroundColor="rgba("+e.r+","+e.g+","+e.b+", "+e.a+")"}}),G=(0,r.BB).el({className:"kl-transparent-preview",css:{boxSizing:"border-box",width:"340px",height:"140px",display:"table",padding:"10px",marginTop:"10px",marginLeft:"-20px"}}),j=(0,r.BB).el({className:"kl-transparent-preview__canvas",css:{width:"200px",height:"100px",backgroundColor:"rgba("+O.r+","+O.g+","+O.b+", "+O.a+")",marginLeft:"auto",marginRight:"auto",color:"#aaa",fontSize:"16px",fontWeight:"bold",textAlign:"center",verticalAlign:"center",display:"table",overflow:"hidden"}});function F(){b.value=""+Math.min(n,parseInt(b.value)),k.value=""+Math.min(n,parseInt(k.value));var e=parseInt(b.value),t=parseInt(k.value);(e<1||e>n||t<1||t>n)&&(e>n?e=n:t>n&&(t=n),b.value=""+e,k.value=""+t);for(var i=[[1,2],[2,1],[2,3],[3,2],[3,4],[4,3],[4,5],[5,4],[16,9],[9,16],[3,2],[2,3],[5,3],[3,5],[2,1],[1,2],[1.414,1],[1,1.414]],s=(0,r.BB).reduce(e,t),a=i[0],o=Math.abs(i[0][0]/i[0][1]-s[0]/s[1]),h=0;h<i.length;h++)Math.abs(i[h][0]/i[h][1]-s[0]/s[1])<o&&(a=i[h],o=Math.abs(i[h][0]/i[h][1]-s[0]/s[1]));o>0&&o<.005?E.innerText=(0,l.LANG)("new-ratio")+": ~"+a[0]+":"+a[1]:E.innerText=(0,l.LANG)("new-ratio")+": "+s[0]+":"+s[1];var c=e,p=function(e,t){for(var i=e,n=t;;){if(!(i%=n))return n;if(!(n%=i))return i}}(e,t);e/=p,t/=p,t*=260,(e*=260)>260&&(t=260/e*t,e=260),t>100&&(e=100/t*e,t=100),j.style.width=e+"px",j.style.height=t+"px",(0,r.BB).createCheckerDataUrl(parseInt(""+e/c*30),function(e){G.style.background="url("+e+")"},(0,u.theme).isDark())}(0,r.BB).el({parent:G,content:j,css:{display:"table-cell",verticalAlign:"middle"}}),(0,r.BB).el({parent:j,css:{display:"table-cell",verticalAlign:"middle"}}),(0,u.theme).addIsDarkListener(F),b.onchange=function(){(""===b.value||0>parseInt(b.value))&&(b.value="1"),F()},b.onkeyup=function(){F()},k.onchange=function(){(""===k.value||0>parseFloat(k.value))&&(k.value="1"),F()},k.onkeyup=function(){F()},F(),x.append(L);var H=(0,r.BB).el({parent:x,css:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"}});(0,r.BB).el({parent:H}).append(S,E),H.append(z.getElement()),x.append(G),(0,o.showModal)({target:document.body,message:`<b>${(0,l.LANG)("new-title")}</b>`,div:x,buttons:["Ok","Cancel"],callback:function(e){if((0,r.BB).unsetEventHandler(b,"onclick","onchange","onkeyup"),(0,r.BB).unsetEventHandler(b,"onclick","onchange","onkeyup"),(0,r.BB).unsetEventHandler(I,"onclick"),(0,r.BB).unsetEventHandler(A,"onclick"),(0,r.BB).unsetEventHandler(M,"onclick"),(0,r.BB).unsetEventHandler(T,"onclick"),(0,r.BB).unsetEventHandler(P,"onclick"),(0,r.BB).unsetEventHandler(R,"onclick"),D.destroy(),z.destroy(),(0,u.theme).removeIsDarkListener(F),"Cancel"===e||0>=parseInt(b.value)||0>=parseInt(k.value)||isNaN(parseInt(b.value))||isNaN(parseInt(k.value))){m();return}v(parseInt(b.value),parseInt(k.value),O)},clickOnEnter:"Ok"})}}),n("cNr8p",function(t,n){e(t.exports,"table",function(){return a});var r=i("bX4ja"),s=i("eWjiX");function a(e,t){var i=(0,s.BB).el({tagName:"table",className:"kl-table"});return e.forEach(function(e,n){var a=(0,s.BB).el({tagName:"tr"});a.append.apply(a,(0,r._)(e.map(function(e,i){var r=(0,s.BB).el({tagName:"td",content:e}),a=n+"."+i;return void 0!==t&&a in t&&(r.rowSpan=t[a].rowspan),r}))),i.append(a)}),i}}),n("1uc3b",function(n,r){e(n.exports,"ToolspaceCollapser",function(){return c});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("3Dc4P"),h=i("1mH1z"),c=/*#__PURE__*/function(){function e(i){var n=this;(0,s._)(this,e),this.stateIsOpen=!0,this.directionStr="right",this.rootEl=(0,o.BB).el({className:"kl-toolspace-toggle",css:{width:"36px",height:"36px",background:"rgba(100, 100, 100, 0.9)",color:"#fff",position:"absolute",top:"0",textAlign:"center",lineHeight:"36px",cursor:"pointer",userSelect:"none",padding:"6px",boxSizing:"border-box"},title:(0,h.LANG)("toggle-show-tools"),onClick:function(e){e.preventDefault(),n.stateIsOpen=!n.stateIsOpen,n.update(),i.onChange()}}),this.icon=(0,o.BB).el({parent:this.rootEl,css:{backgroundImage:`url(${/*@__PURE__*/t(l)})`,width:"100%",height:"100%",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",userSelect:"none"}}),this.rootEl.oncontextmenu=function(){return!1}}return(0,a._)(e,[{key:"update",value:function(){"left"===this.directionStr?this.icon.style.transform=this.stateIsOpen?"rotate(180deg)":"":this.icon.style.transform=this.stateIsOpen?"":"rotate(180deg)"}},{key:"isOpen",value:function(){return this.stateIsOpen}},{key:"setDirection",value:function(e){this.directionStr=e,this.update()}},{key:"getElement",value:function(){return this.rootEl}}]),e}()}),n("3Dc4P",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"ui-collapse.2b5dfc6a.svg"}),n("dHnZA",function(t,n){e(t.exports,"textToolDialog",function(){return y});var r=i("cL71g"),s=i("4EWN2"),a=i("eWjiX"),o=i("2MaaK"),l=i("1mH1z"),h=i("2NQHg"),c=i("4aPno"),u=i("l2lnZ"),p=i("7xBn4"),d=i("MbxPB"),g=i("6Tfl8"),f=i("amum4"),v=i("jXowp"),m=i("e4sAN");function y(e){var t=(0,a.BB).el({}),i=(0,a.BB).copyObj(e.text),n=(0,a.BB).el({className:g.viewportWrapper}),y=new d.TextToolViewportUI({text:i,klCanvas:e.klCanvas,layerIndex:e.layerIndex,onDragEnd:function(){return"text"===S.getOpenedTabId()?C.focus():0}});function x(e){i=(0,r._)({},i,e),y.setText(i)}y.render();var b=new c.TextToolFontUI((0,s._)((0,r._)({},i),{onUpdate:function(e){x(e)}})),B=(0,a.BB).el({css:{display:"flex",gap:"10px",flexDirection:"column"}}),w=new h.TextToolFillUI({fill:i.fill,primaryColor:e.primaryColor,secondaryColor:e.secondaryColor,onUpdate:function(e){x(e)}}),k=new u.TextToolStrokeUI({stroke:i.stroke,primaryColor:e.primaryColor,secondaryColor:e.secondaryColor,onUpdate:function(e){x(e)}}),C=new p.TextToolTextUI({text:i.text,onUpdate:function(e){void 0!==e.text&&P.setIgnoreBackground(e.text.length>0),x(e)}}),S=new m.TabRow({initialId:"text",height:40,tabArr:[{id:"text",label:(0,l.LANG)("text-text"),onOpen:function(){C.getElement().style.display="",C.focus()},onClose:function(){C.getElement().style.display="none"}},{id:"font",label:(0,l.LANG)("text-font"),onOpen:function(){b.getElement().style.display="flex"},onClose:function(){b.getElement().style.display="none"}},{id:"color",label:(0,l.LANG)("text-color"),onOpen:function(){B.style.display="flex"},onClose:function(){B.style.display="none"}}]});S.getElement().classList.add((0,v.css)({minWidth:"200px",maxWidth:"500px",flexGrow:"1",borderBottom:"none !important"}));var E=(0,v.css)({position:"relative",">*":{position:"absolute",right:0,top:10}}),L=(0,v.css)({display:"flex",justifyContent:"space-between",flexDirection:"row-reverse",flexWrap:"wrap",marginTop:"10px",marginLeft:"-20px",marginRight:"-20px",padding:"0 20px","@media (min-width: 700px) and (min-height: 700px)":{display:"none !important"}}),A=(0,v.css)({minHeight:72,marginTop:"10px","@media (min-width: 700px) and (min-height: 700px)":{display:"flex",flexDirection:"column",gap:"10px",">*":{display:"flex !important"}}});t.append((0,f.c)("",[(0,f.c)(n,[y.getElement()]),(0,f.c)("."+E,[y.getInputsElement()]),(0,f.c)(".tabrow."+L,[(0,f.c)(",w-240,h-40"),S.getElement()]),(0,f.c)("."+A,[(0,f.c)(B,[w.getElement(),k.getElement()]),b.getElement(),C.getElement()])]));var I=function(){var e=n.getBoundingClientRect(),t=Math.ceil(e.width),i=Math.ceil(e.height);y.setSize(t,i)};function T(){window.scrollTo(0,0)}window.addEventListener("resize",I),setTimeout(function(){I()}),setTimeout(function(){C.focus()},100),window.addEventListener("scroll",T,{passive:!1});var P=(0,o.showModal)({target:document.body,message:`<b>${(0,l.LANG)("text-title")}</b>`,div:t,buttons:["Ok","Cancel"],ignoreBackground:e.text.text.length>0,callback:function(t){window.removeEventListener("resize",I),window.removeEventListener("scroll",T),y.destroy(),b.destroy(),w.destroy(),k.destroy(),C.destroy(),S.destroy(),"Ok"===t&&e.onConfirm((0,r._)({},y.getValues(),b.getValues(),w.getValues(),k.getValues(),C.getValues()))},style:{width:"calc(100% - 50px)",maxWidth:"1000px",minWidth:"300px",boxSizing:"border-box"},clickOnEnter:"Ok"})}}),n("2NQHg",function(t,n){e(t.exports,"TextToolFillUI",function(){return d});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("4EWN2"),l=i("43qNf"),h=i("aP0jf"),c=i("1mH1z"),u=i("amum4"),p=i("7jh4K"),d=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e);var n=function(){t.onUpdate(i.getValues())},s=[null,t.fill?(0,o._)((0,a._)({},t.fill.color),{a:1}):null,(0,o._)((0,a._)({},t.primaryColor),{a:1}),(0,o._)((0,a._)({},t.secondaryColor),{a:1}),{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];this.colorOptions=new l.ColorOptions({colorArr:s,initialIndex:t.fill?1:0,title:(0,c.LANG)("shape-fill"),onChange:function(e){i.opacitySlider.getElement().style.display=null!==e?"":"none",n()}}),this.opacitySlider=new h.KlSlider({label:(0,c.LANG)("opacity"),width:150,height:30,min:.01,max:1,value:t.fill?t.fill.color.a:1,resolution:225,eventResMs:1e3/30,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e},onChange:function(){return n()}}),this.opacitySlider.getElement().style.display=t.fill?"":"none";var d=(0,p.createSvg)({elementType:"svg",class:"dark-invert",width:"25px",height:"25px",viewBox:"0 0 30 30",childrenArr:[{elementType:"polyline",points:"0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0","transform-origin":"15px 15px",transform:"scale(0.8)",fill:"#000c"}]});this.rootEl=(0,u.c)(",flex,gap-10,items-center,flexWrap,minh-30",[d,this.colorOptions.getElement(),this.opacitySlider.getElement()])}return(0,s._)(e,[{key:"getElement",value:function(){return this.rootEl}},{key:"getValues",value:function(){var e=this.colorOptions.getValue();return null===e||(null==e?void 0:e.a)===0?{fill:void 0}:{fill:{color:(0,o._)((0,a._)({},e),{a:this.opacitySlider.getValue()})}}}},{key:"destroy",value:function(){this.colorOptions.destroy(),this.opacitySlider.destroy()}}]),e}()}),n("4aPno",function(n,r){e(n.exports,"TextToolFontUI",function(){return E});var s=i("1LaJZ"),a=i("cx0mh"),o=i("7h4XF"),l=i("bX4ja"),h=i("2gUX3"),c=i("eWjiX"),u=i("dJPtW"),p=i("1mH1z"),d=i("4nUqS"),g=i("etYTQ"),f=i("1BYnA"),v=i("hA175"),m=i("jGth6"),y=i("2EJEU"),x=i("1kyaA"),b=i("eEL9N"),B=i("amum4"),w=i("gE7dS"),k=[{fontFamily:"sans-serif",fontName:"Sans-serif"},{fontFamily:"serif",fontName:"Serif"},{fontFamily:"monospace",fontName:"Monospace"},{fontFamily:"cursive",fontName:"Cursive"},{fontFamily:"fantasy",fontName:"Fantasy"}].concat((0,l._)((0,w.fonts).map(function(e){return{fontFamily:e.name,fontName:e.name}}))),C=!1;function S(){return(S=(0,s._)(function(){var e,t,i;return(0,h.__generator)(this,function(n){switch(n.label){case 0:if(e=function(e){t.push((0,s._)(function(){var t,i,n;return(0,h.__generator)(this,function(r){switch(r.label){case 0:return[4,fetch((t=w.fonts[e]).url)];case 1:return[4,r.sent().arrayBuffer()];case 2:return i=r.sent(),n=new FontFace(t.name,i),document.fonts.add(n),[2]}})})())},C)return[2];for(i=0,C=!0,t=[];i<w.fonts.length;i++)e(i);return[4,Promise.all(t)];case 1:return n.sent(),[2]}})})).apply(this,arguments)}var E=/*#__PURE__*/function(){function e(i){var n,r,s=this;(0,a._)(this,e),this.onUpdate=i.onUpdate,this.fontSelect=new b.Select({initValue:i.font,optionArr:k.map(function(e){return[e.fontFamily,e.fontName,{css:{fontFamily:e.fontFamily,fontSize:"1.2em"}}]}),isFocusable:!0,css:{width:"180px"},onChange:function(e){s.loadBundledFonts(),i.onUpdate({font:e})}}),this.onFocus=function(){return s.loadBundledFonts()},this.fontSelect.getElement().addEventListener("focus",this.onFocus),this.fontPointerListener=new c.BB.PointerListener({target:this.fontSelect.getElement(),onWheel:function(e){return s.fontSelect.setDeltaValue(e.deltaY)}}),this.importButton=(0,c.BB).el({tagName:"button",content:(0,p.LANG)("file-import"),onClick:function(){s.importFont()}});var o=(0,c.BB).el({content:'<div><span style="font-size: 0.6em; margin-right: -1px">A</span>A</div>',css:{width:"25px",height:"25px",display:"flex",justifyContent:"center",alignItems:"center",fontSize:"1.2em",userSelect:"none"}});this.sizeInput=new u.Input({title:(0,p.LANG)("text-size"),type:"number",min:0,max:1e3,init:i.size,onChange:function(e){i.onUpdate({size:parseFloat(e)})},doResetIfInvalid:!0,doScrollWithoutFocus:!0,css:{width:"70px"}}),this.lineHeightInput=new u.Input({label:(0,p.LANG)("text-line-height"),type:"number",min:0,max:10,step:.1,init:null!==(n=i.lineHeight)&&void 0!==n?n:1,onChange:function(e){i.onUpdate({lineHeight:parseFloat(e)})},doResetIfInvalid:!0,doScrollWithoutFocus:!0,css:{width:"60px"}}),this.letterSpacingInput=new u.Input({label:(0,p.LANG)("text-letter-spacing"),type:"number",min:-100,max:100,init:null!==(r=i.letterSpacing)&&void 0!==r?r:0,onChange:function(e){i.onUpdate({letterSpacing:parseFloat(e)})},doResetIfInvalid:!0,doScrollWithoutFocus:!0,css:{width:"60px"}}),this.alignRadioList=new d.ImageRadioList({optionArr:[{id:"left",title:(0,p.LANG)("text-left"),image:/*@__PURE__*/t(g),darkInvert:!0},{id:"center",title:(0,p.LANG)("text-center"),image:/*@__PURE__*/t(f),darkInvert:!0},{id:"right",title:(0,p.LANG)("text-right"),image:/*@__PURE__*/t(v),darkInvert:!0}],initId:i.align,onChange:function(e){return i.onUpdate({align:e})}}),this.italicToggle=new x.ImageToggle({image:/*@__PURE__*/t(m),title:(0,p.LANG)("text-italic"),initValue:i.isItalic,onChange:function(e){return i.onUpdate({isItalic:e})},darkInvert:!0}),this.boldToggle=new x.ImageToggle({image:/*@__PURE__*/t(y),title:(0,p.LANG)("text-bold"),initValue:i.isBold,onChange:function(e){return i.onUpdate({isBold:e})},darkInvert:!0}),this.rootEl=(0,B.c)(",flex,flexWrap,gap-10-15,items-center",[(0,B.c)(",flex,gap-5,items-center",[o,this.sizeInput.getElement()]),(0,B.c)(",flex,gap-5",[this.fontSelect.getElement(),this.importButton]),(0,B.c)(",flex,gap-7",[this.alignRadioList.getElement(),this.italicToggle.getElement(),this.boldToggle.getElement()]),this.letterSpacingInput.getElement(),this.lineHeightInput.getElement()])}return(0,o._)(e,[{key:"loadBundledFonts",value:function(){var e=this;C||(function(){return S.apply(this,arguments)})().then(function(){e.onUpdate({font:e.fontSelect.getValue()})})}},{key:"importFont",value:function(){var e=document.createElement("input");e.type="file",e.multiple=!0,e.accept=".ttf, .otf, .woff, .woff2, .eot",e.focus(),e.click();var t=this;e.onchange=/*#__PURE__*/(0,s._)(function(){var i,n,r,s,a,o,l,c,u;return(0,h.__generator)(this,function(h){switch(h.label){case 0:if(!e.files||0===e.files.length)return[2];i=void 0,n=k.map(function(e){return e.fontFamily}),r=0,h.label=1;case 1:if(!(r<e.files.length))return[3,4];if(s=e.files[r],a="kl-"+k.length,n.includes(a))return[3,3];return i||(i=a,t.importButton.disabled=!0,t.importButton.innerText=(0,p.LANG)("loading")),(o=s.name.split(".")).pop(),k.push({fontFamily:a,fontName:o.join(".")}),c=FontFace.bind,u=[void 0,a],[4,s.arrayBuffer()];case 2:l=new(c.apply(FontFace,u.concat([h.sent()]))),document.fonts.add(l),h.label=3;case 3:return r++,[3,1];case 4:return setTimeout(function(){t.fontSelect.setOptionArr(k.map(function(e){return[e.fontFamily,e.fontName,{css:{fontFamily:e.fontFamily,fontSize:"1.2em"}}]})),t.fontSelect.setValue(i),t.onUpdate({font:i}),t.importButton.disabled=!1,t.importButton.innerText=(0,p.LANG)("file-import")}),[2]}})})}},{key:"getElement",value:function(){return this.rootEl}},{key:"getValues",value:function(){return{font:this.fontSelect.getValue(),size:+this.sizeInput.getValue(),letterSpacing:+this.letterSpacingInput.getValue(),lineHeight:+this.lineHeightInput.getValue(),align:this.alignRadioList.getValue(),isItalic:this.italicToggle.getValue(),isBold:this.boldToggle.getValue()}}},{key:"destroy",value:function(){this.fontPointerListener.destroy(),this.fontSelect.getElement().removeEventListener("focus",this.onFocus),this.fontSelect.destroy(),(0,c.BB).destroyEl(this.importButton),this.sizeInput.destroy(),this.lineHeightInput.destroy(),this.letterSpacingInput.destroy(),this.alignRadioList.destroy(),this.italicToggle.destroy(),this.boldToggle.destroy()}}]),e}()}),n("etYTQ",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"align-left.4876a845.svg"}),n("1BYnA",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"align-center.6f56d4bd.svg"}),n("hA175",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"align-right.1521d61c.svg"}),n("jGth6",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"typo-italic.7ab32910.svg"}),n("2EJEU",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"typo-bold.5c790c89.svg"}),n("gE7dS",function(n,r){e(n.exports,"fonts",function(){return B});var s=i("fElB3"),a=i("4hj8T"),o=i("f4cse"),l=i("9IjWJ"),h=i("9m4hw"),c=i("hLFxM"),u=i("juy8P"),p=i("dEvnt"),d=i("7LJGu"),g=i("i231E"),f=i("ecdxH"),v=i("dSFQZ"),m=i("if1qO"),y=i("7Qutq"),x=i("8IyeX"),b=i("5W96z"),B=[{name:"Caveat",url:/*@__PURE__*/t(s)},{name:"ClimateCrisis",url:/*@__PURE__*/t(a)},{name:"CorrectionBrush",url:/*@__PURE__*/t(o)},{name:"DancingScript",url:/*@__PURE__*/t(l)},{name:"Diabolik",url:/*@__PURE__*/t(h)},{name:"FreckleFace",url:/*@__PURE__*/t(c)},{name:"Gloock",url:/*@__PURE__*/t(u)},{name:"GochiHand",url:/*@__PURE__*/t(d)},{name:"Pacha",url:/*@__PURE__*/t(p)},{name:"PassionOne",url:/*@__PURE__*/t(g)},{name:"PixeloidSans",url:/*@__PURE__*/t(f)},{name:"PlaypenSans",url:/*@__PURE__*/t(v)},{name:"Quicksand",url:/*@__PURE__*/t(m)},{name:"Silkscreen",url:/*@__PURE__*/t(y)},{name:"Tehroc",url:/*@__PURE__*/t(x)},{name:"YUNGA",url:/*@__PURE__*/t(b)}]}),n("fElB3",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"Caveat-Regular.2fe80bbd.woff2"}),n("4hj8T",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"ClimateCrisis-Regular-VariableFont_YEAR.3ad02523.woff2"}),n("f4cse",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"CorrectionBrush.a69973aa.woff2"}),n("9IjWJ",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"DancingScript-Regular.ef2fe647.woff2"}),n("9m4hw",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"Diabolik-Regular-VF.f4eeb79e.woff2"}),n("hLFxM",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"FreckleFace-Regular.05946539.woff2"}),n("juy8P",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"Gloock-Regular.60f8f765.woff2"}),n("dEvnt",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"Pacha.08c8457a.woff2"}),n("7LJGu",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"GochiHand-Regular.c45792b0.woff2"}),n("i231E",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"PassionOne-Bold.9e08b0dc.woff2"}),n("ecdxH",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"PixeloidSans.bc292131.woff2"}),n("dSFQZ",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"PlaypenSans-Thin.314b29a4.woff2"}),n("if1qO",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"Quicksand-Light.1f0c44a2.woff2"}),n("7Qutq",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"Silkscreen-Regular.cef2b4cb.woff2"}),n("8IyeX",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"Tehroc-Regular.4540047b.woff2"}),n("5W96z",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"YUNGA-Display.30c04a15.woff2"}),n("l2lnZ",function(t,n){e(t.exports,"TextToolStrokeUI",function(){return g});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("4EWN2"),l=i("eWjiX"),h=i("43qNf"),c=i("aP0jf"),u=i("1mH1z"),p=i("amum4"),d=i("7jh4K"),g=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.rootEl=(0,l.BB).el({css:{boxShadow:"0 0 0 1px #aaa"}});var n=function(){t.onUpdate(i.getValues())},s=[null,t.stroke?(0,o._)((0,a._)({},t.stroke.color),{a:1}):null,(0,o._)((0,a._)({},t.secondaryColor),{a:1}),(0,o._)((0,a._)({},t.primaryColor),{a:1}),{r:255,g:255,b:255,a:1},{r:0,g:0,b:0,a:1}];this.colorOptions=new h.ColorOptions({colorArr:s,initialIndex:t.stroke?1:0,title:(0,u.LANG)("shape-stroke"),onChange:function(e){i.opacitySlider.getElement().style.display=null!==e?"":"none",i.lineWidthSlider.getElement().style.display=null!==e?"":"none",n()}}),this.opacitySlider=new c.KlSlider({label:(0,u.LANG)("opacity"),width:150,height:30,min:.01,max:1,value:t.stroke?t.stroke.color.a:1,resolution:225,eventResMs:1e3/30,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e},onChange:function(){return n()}}),this.lineWidthSlider=new c.KlSlider({label:(0,u.LANG)("shape-line-width"),width:150,height:30,min:.5,max:100,value:t.stroke?t.stroke.lineWidth:2,eventResMs:1e3/30,curve:"quadratic",onChange:function(){return n()}}),this.opacitySlider.getElement().style.display=t.stroke?"":"none",this.lineWidthSlider.getElement().style.display=t.stroke?"":"none";var g=(0,d.createSvg)({elementType:"svg",class:"dark-invert",width:"25px",height:"25px",viewBox:"0 0 30 30",childrenArr:[{elementType:"polyline",points:"0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0",fill:"none",stroke:"#000c","stroke-width":"3","transform-origin":"15px 15px",transform:"scale(0.8)"}]});this.rootEl=(0,p.c)(",flex,gap-10,items-center,flexWrap,minh-30",[g,this.colorOptions.getElement(),this.opacitySlider.getElement(),this.lineWidthSlider.getElement()])}return(0,s._)(e,[{key:"getElement",value:function(){return this.rootEl}},{key:"getValues",value:function(){var e=this.colorOptions.getValue();return null===e||(null==e?void 0:e.a)===0?{stroke:void 0}:{stroke:{color:(0,o._)((0,a._)({},e),{a:this.opacitySlider.getValue()}),lineWidth:this.lineWidthSlider.getValue()}}}},{key:"destroy",value:function(){this.colorOptions.destroy(),this.opacitySlider.destroy(),this.lineWidthSlider.destroy()}}]),e}()}),n("7xBn4",function(t,n){e(t.exports,"TextToolTextUI",function(){return h});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("1mH1z"),l=i("amum4"),h=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.onInput=function(){i.emit()},this.lastEmittedText=t.text,this.onUpdate=t.onUpdate,this.rootEl=(0,l.c)(""),this.textInput=(0,a.BB).el({tagName:"textarea",parent:this.rootEl,content:t.text,custom:{placeholder:(0,o.LANG)("text-placeholder")},css:{whiteSpace:"pre",overflow:"auto",width:"100%",height:"70px",resize:"vertical"},onChange:function(){i.emit()}}),this.textInput.addEventListener("input",this.onInput)}return(0,s._)(e,[{key:"emit",value:function(){var e=this.textInput.value;e!==this.lastEmittedText&&(this.lastEmittedText=e,this.onUpdate({text:e}))}},{key:"getElement",value:function(){return this.rootEl}},{key:"getValues",value:function(){return{text:this.textInput.value}}},{key:"focus",value:function(){this.textInput.focus()}},{key:"destroy",value:function(){(0,a.BB).destroyEl(this.textInput),this.textInput.removeEventListener("input",this.onInput)}}]),e}()}),n("MbxPB",function(n,r){e(n.exports,"TextToolViewportUI",function(){return y});var s=i("cx0mh"),a=i("7h4XF"),o=i("cL71g"),l=i("4EWN2"),h=i("eWjiX"),c=i("7jh4K"),u=i("1C8RU"),p=i("h20yl"),d=i("aP0jf"),g=i("1mH1z"),f=i("hzavh"),v=i("5LsQG"),m=i("amum4"),y=/*#__PURE__*/function(){function e(i){var n=this;(0,s._)(this,e),this.offset={x:0,y:0},this.zoomFac=0,this.scale=1,this.layerArr=[],this.onDarkChange=function(){n.checkerPattern=(0,c.throwIfNull)(n.previewCtx.createPattern((0,h.BB).createCheckerCanvas(8,(0,u.theme).isDark()),"repeat")),n.render()},this.rootEl=(0,m.c)(),this.text=i.text,this.layerIndex=i.layerIndex;var r=window.innerWidth<550,a=window.innerHeight<630;this.width=r?340:540,this.height=r?a?210:260:a?230:350,this.layerArr=i.klCanvas.getLayersFast(),this.textCanvas=(0,h.BB).canvas(i.klCanvas.getWidth(),i.klCanvas.getHeight()),this.textCtx=(0,h.BB).ctx(this.textCanvas),this.targetCanvas=(0,h.BB).canvas(this.width,this.height),this.targetCtx=(0,h.BB).ctx(this.targetCanvas),this.layersCanvas=(0,h.BB).canvas(this.width,this.height),this.layersCtx=(0,h.BB).ctx(this.layersCanvas),this.previewCanvas=(0,h.BB).canvas(this.width,this.height),this.previewCtx=(0,h.BB).ctx(this.previewCanvas),(0,h.BB).css(this.previewCanvas,{display:"block"}),this.previewWrapper=(0,h.BB).el({parent:this.rootEl,css:{position:"relative",width:this.width+"px",cursor:"move",touchAction:"none"}}),(0,h.BB).el({parent:this.previewWrapper,className:"kl-text-preview-wrapper"}),this.previewWrapper.append(this.previewCanvas),this.checkerPattern=(0,c.throwIfNull)(this.previewCtx.createPattern((0,h.BB).createCheckerCanvas(8,(0,u.theme).isDark()),"repeat")),this.emptyCanvas=(0,h.BB).canvas(1,1),this.emptyCanvasLight=(0,h.BB).canvas(1,1);var o=(0,h.BB).ctx(this.emptyCanvas);o.fillRect(0,0,1,1),(o=(0,h.BB).ctx(this.emptyCanvasLight)).fillStyle="#fff",o.fillRect(0,0,1,1),(0,u.theme).addIsDarkListener(this.onDarkChange),this.previewCanvas.oncontextmenu=function(e){return e.preventDefault()};var l=!1,p=!1,y=!1;this.previewPointerListener=new h.BB.PointerListener({target:this.previewCanvas,onPointer:function(e){if("pointerdown"===e.type&&(l=!1,p=!0),"pointermove"===e.type&&p&&(l=!0),"pointerup"===e.type&&(p&&l&&"mouse"===e.pointerType&&i.onDragEnd(),l=!1,p=!1),"pointermove"===e.type&&"left"===e.button&&(e.eventPreventDefault(),n.offset={x:0,y:0},n.move(-e.dX,-e.dY)),"pointerdown"===e.type&&"right"===e.button&&document.body.append(n.eventCapture),"pointerup"===e.type&&setTimeout(function(){return n.eventCapture.remove()},20),"pointermove"===e.type&&"right"===e.button&&(y=!0,e.eventPreventDefault(),n.offset.x-=e.dX,n.offset.y-=e.dY,n.render()),"pointerup"===e.type&&y){var t=0;n.interval=setInterval(function(){t>8&&(clearInterval(n.interval),n.offset={x:0,y:0},n.render()),n.offset={x:.6*n.offset.x,y:.6*n.offset.y},n.render(),t++},10),n.offset={x:.6*n.offset.x,y:.6*n.offset.y},n.render()}},onWheel:function(e){n.changeZoomFac(-e.deltaY)}}),this.previewCanvas.addEventListener("wheel",function(e){return e.preventDefault()},{passive:!1}),this.rotationSlider=new d.KlSlider({label:(0,g.LANG)("filter-transform-rotation"),width:150,height:30,min:-Math.PI,max:Math.PI,value:i.text.angleRad,resolution:225,toValue:function(e){return e*Math.PI/180},toDisplayValue:function(e){return e/Math.PI*180},onChange:function(){n.offset={x:0,y:0},n.render()},unit:"°"}),this.zoomInBtn=(0,h.BB).el({tagName:"button",content:`<img height="20" src="${/*@__PURE__*/t(f)}">`,title:(0,g.LANG)("zoom-in"),onClick:function(){return n.changeZoomFac(1)},css:{fontWeight:"bold"}}),this.zoomOutBtn=(0,h.BB).el({tagName:"button",content:`<img height="20" src="${/*@__PURE__*/t(v)}">`,title:(0,g.LANG)("zoom-out"),onClick:function(){return n.changeZoomFac(-1)},css:{fontWeight:"bold"}}),this.eventCapture=(0,h.BB).el({css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",zIndex:"999",cursor:"move"}}),this.eventCapture.oncontextmenu=function(e){return e.preventDefault()},this.keyListener=new h.BB.KeyListener({onDown:function(e){if(!(0,h.BB).isInputFocused(!0)){var t=n.keyListener.isPressed("shift")?4:1;"left"===e&&n.move(-t,0),"right"===e&&n.move(t,0),"up"===e&&n.move(0,-t),"down"===e&&n.move(0,t)}}}),this.inputsRootEl=(0,m.c)(",flex,gap-5",[this.rotationSlider.getElement(),(0,m.c)(),this.zoomInBtn,this.zoomOutBtn])}return(0,a._)(e,[{key:"canZoom",value:function(e){return this.zoomFac!==Math.min(2,Math.max(-2,this.zoomFac+e))}},{key:"changeZoomFac",value:function(e){this.zoomFac=Math.min(2,Math.max(-2,this.zoomFac+e)),this.render(),this.zoomInBtn.disabled=!this.canZoom(1),this.zoomOutBtn.disabled=!this.canZoom(-1)}},{key:"move",value:function(e,t){var i=(0,h.BB).rotate(e,t,-this.rotationSlider.getValue()/Math.PI*180);this.text.x+=i.x/this.scale,this.text.y+=i.y/this.scale,this.render()}},{key:"render",value:function(){var e=this.rotationSlider.getValue();this.textCtx.clearRect(0,0,this.textCanvas.width,this.textCanvas.height);var t=(0,p.renderText)(this.textCanvas,(0,l._)((0,o._)({},this.text),{x:this.text.x,y:this.text.y,angleRad:this.rotationSlider.getValue()})),i=(0,h.BB).Vec2.mul((0,h.BB).rotate(this.offset.x,this.offset.y,-e/Math.PI*180),1/this.scale);t.width=Math.max(t.width,1),t.height=Math.max(t.height,1);var n=(0,h.BB).rotate(t.x,t.y,-e/Math.PI*180),r=(0,h.BB).rotate(t.width,t.height,-e/Math.PI*180),s=this.text.x+n.x+r.x/2+i.x,a=this.text.y+n.y+r.y/2+i.y,c=(0,h.BB).fitInto(t.width,t.height,this.width-100,this.height-100);this.scale=Math.min(1,c.width/t.width),this.scale=Math.min(4,this.scale*Math.pow(2,this.zoomFac)),this.targetCtx.save(),this.scale>=4?this.targetCtx.imageSmoothingEnabled=!1:(this.targetCtx.imageSmoothingEnabled=!0,this.targetCtx.imageSmoothingQuality=this.scale>=1?"low":"medium"),this.targetCtx.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height),this.targetCtx.translate(this.width/2,this.height/2),this.targetCtx.scale(this.scale,this.scale),this.targetCtx.rotate(e),this.targetCtx.drawImage(this.layerArr[this.layerIndex].canvas,-s,-a),this.targetCtx.drawImage(this.textCanvas,-s,-a),this.targetCtx.restore();var d=(0,u.theme).isDark();this.layersCtx.save(),this.layersCtx.fillStyle=d?"rgb(33,33,33)":"rgb(158,158,158)",this.layersCtx.fillRect(0,0,this.width,this.height),this.layersCtx.save(),this.layersCtx.translate(this.width/2,this.height/2),this.layersCtx.scale(this.scale,this.scale),this.layersCtx.rotate(e),this.layersCtx.imageSmoothingEnabled=!1;var g=1/this.scale;this.layersCtx.globalAlpha=d?.25:.2,this.layersCtx.drawImage(d?this.emptyCanvasLight:this.emptyCanvas,-s-g,-a-g,this.textCanvas.width+2*g,this.textCanvas.height+2*g),this.layersCtx.globalAlpha=1,this.layersCtx.globalCompositeOperation="destination-out",this.layersCtx.drawImage(this.emptyCanvas,-s,-a,this.textCanvas.width,this.textCanvas.height),this.layersCtx.restore(),this.scale>=4?this.layersCtx.imageSmoothingEnabled=!1:(this.layersCtx.imageSmoothingEnabled=!0,this.layersCtx.imageSmoothingQuality=this.scale>=1?"low":"medium"),this.layersCtx.save(),this.layersCtx.translate(this.width/2,this.height/2),this.layersCtx.scale(this.scale,this.scale),this.layersCtx.rotate(e);for(var f=0;f<this.layerIndex;f++)this.layerArr[f].isVisible&&this.layerArr[f].opacity>0&&(this.layersCtx.globalAlpha=this.layerArr[f].opacity,this.layersCtx.globalCompositeOperation=this.layerArr[f].mixModeStr,this.layersCtx.drawImage(this.layerArr[f].canvas,-s,-a));this.layersCtx.restore(),this.layersCtx.globalAlpha=this.layerArr[this.layerIndex].opacity*(this.layerArr[this.layerIndex].isVisible?1:0),this.layersCtx.globalCompositeOperation=this.layerArr[this.layerIndex].mixModeStr,this.layersCtx.drawImage(this.targetCanvas,0,0),this.layersCtx.save(),this.layersCtx.translate(this.width/2,this.height/2),this.layersCtx.scale(this.scale,this.scale),this.layersCtx.rotate(e);for(var v=this.layerIndex+1;v<this.layerArr.length;v++)this.layerArr[v].isVisible&&this.layerArr[v].opacity>0&&(this.layersCtx.globalAlpha=this.layerArr[v].opacity,this.layersCtx.globalCompositeOperation=this.layerArr[v].mixModeStr,this.layersCtx.drawImage(this.layerArr[v].canvas,-s,-a));this.layersCtx.restore(),this.layersCtx.restore(),this.previewCtx.save(),this.previewCtx.fillStyle=this.checkerPattern,this.previewCtx.fillRect(0,0,this.previewCanvas.width,this.previewCanvas.height),this.previewCtx.drawImage(this.layersCanvas,0,0),this.previewCtx.restore(),this.previewCtx.save(),this.previewCtx.globalCompositeOperation="difference",this.previewCtx.strokeStyle="#fff",this.previewCtx.lineWidth=.5,this.previewCtx.translate(-this.offset.x,-this.offset.y),this.previewCtx.strokeRect(Math.round(this.width/2-t.width/2*this.scale)+.5,Math.round(this.height/2-t.height/2*this.scale)+.5,Math.round(t.width*this.scale),Math.round(t.height*this.scale)),this.previewCtx.restore()}},{key:"getElement",value:function(){return this.rootEl}},{key:"getInputsElement",value:function(){return this.inputsRootEl}},{key:"getValues",value:function(){return{x:this.text.x,y:this.text.y,angleRad:this.rotationSlider.getValue()}}},{key:"setText",value:function(e){var t=this.text.x,i=this.text.y,n=this.text.angleRad;this.text=(0,l._)((0,o._)({},e),{x:t,y:i,angleRad:n}),this.render()}},{key:"setSize",value:function(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.targetCanvas.width=this.width,this.targetCanvas.height=this.height,this.layersCanvas.width=this.width,this.layersCanvas.height=this.height,this.previewCanvas.width=this.width,this.previewCanvas.height=this.height,this.previewWrapper.style.width=this.width+"px",this.render())}},{key:"destroy",value:function(){(0,h.BB).destroyEl(this.rootEl),(0,h.BB).destroyEl(this.inputsRootEl),(0,h.BB).destroyEl(this.previewWrapper),clearInterval(this.interval),this.rotationSlider.destroy(),(0,h.BB).destroyEl(this.zoomInBtn),(0,h.BB).destroyEl(this.zoomOutBtn),this.eventCapture.remove(),this.previewPointerListener.destroy(),this.keyListener.destroy(),(0,u.theme).removeIsDarkListener(this.onDarkChange)}}]),e}()}),n("6Tfl8",function(t,i){var n;e(t.exports,"viewportWrapper",function(){return n},function(e){return n=e}),n="_5vlQAW_viewportWrapper"}),n("kDGzx",function(t,n){e(t.exports,"showImportImageDialog",function(){return h});var r=i("eWjiX"),s=i("hRdOL"),a=i("7bWhB"),o=i("2MaaK"),l=i("1mH1z");function h(e){var t,i,n=(0,r.BB).el(),h=window.innerWidth<550||window.innerHeight<550,c=(0,r.BB).el({css:{marginTop:"10px",textAlign:"center",color:"#888",lineHeight:"20px"}}),u=new s.CropCopy({width:h?340:540,height:h?300:400,canvas:e.image.canvas,isNotCopy:!0,onChange:function(e,t){c&&p(e,t)}});function p(t,i){var n=(0,r.BB).fitInto(t,i,e.maxSize,e.maxSize);n.width<t?(c.innerHTML=`<span class="kl-text-error">${t} X ${i}</span> \u{27F6} ${Math.round(n.width)} X ${Math.round(n.height)}`,c.title=(0,l.LANG)("import-too-large")):(c.innerHTML=`${t} X ${i}`,c.title="")}(0,r.BB).css(u.getEl(),{marginLeft:"-20px"}),u.getEl().title=(0,l.LANG)("crop-drag-to-crop"),n.append(u.getEl(),c),p(e.image.width,e.image.height);var d=!1;if("psd"===e.image.type){if(e.image.layers){if(t=new a.Checkbox({init:d,label:(0,l.LANG)("import-flatten"),callback:function(e){d=e}}),n.append(t.getElement()),e.image.warningArr){var g=(0,r.BB).el({className:"kl-import-note",content:(0,l.LANG)("import-psd-limited-support")}),f=e.image.warningArr;i=(0,r.BB).el({parent:g,tagName:"a",content:"Details",css:{marginLeft:"5px"},onClick:function(){return function(e){for(var t=[],i={mask:"Masks not supported. Mask was applied.",clipping:"Clipping not supported. Clipping layers were merged.",group:"Groups not supported. Layers were ungrouped.",adjustment:"Adjustment layers not supported.","layer-effect":"Layer effects not supported.","smart-object":"Smart objects not supported.","blend-mode":"Unsupported layer blend mode.","bits-per-channel":"Unsupported color depth. Only 8bit per channel supported."},n=0;n<e.length;n++)t.push("- "+i[e[n]]);alert(t.join("\n"))}(f)}}),n.append(g)}}else{var v=(0,r.BB).el({className:"kl-import-note",content:(0,l.LANG)("import-psd-unsupported")});n.append(v)}}(0,o.showModal)({target:e.target,message:`<b>${(0,l.LANG)("import-title")}</b>`,div:n,style:h?{}:{width:"540px"},buttons:[(0,l.LANG)("import-btn-as-layer"),(0,l.LANG)("import-btn-as-image"),"Cancel"],primaries:[(0,l.LANG)("import-btn-as-layer"),(0,l.LANG)("import-btn-as-image")],callback:function(n){var s=u.getCroppedCanvas(),a=u.getRect(),o=e.image.width!==a.width&&e.image.height!==a.height;u.destroy(),(0,r.BB).destroyEl(i),t&&t.destroy(),n===(0,l.LANG)("import-btn-as-layer")?(e.callback({type:"as-layer",image:o?s:e.image.canvas}),o||(0,r.BB).freeCanvas(s)):n===(0,l.LANG)("import-btn-as-image")?"psd"===e.image.type?(d&&delete e.image.layers,e.callback({type:"as-image-psd",image:e.image,cropObj:a}),(0,r.BB).freeCanvas(s)):"image"===e.image.type&&e.callback({type:"as-image",image:s}):(e.callback({type:"cancel"}),(0,r.BB).freeCanvas(s))},autoFocus:"As Image"})}}),n("941rU",function(t,n){e(t.exports,"blendPsdToKl",function(){return p}),e(t.exports,"blendKlToPsd",function(){return d}),e(t.exports,"readPsd",function(){return g}),e(t.exports,"klPsdToKlProject",function(){return f});var r,s,a=i("eelgW"),o=i("1mH1z"),l=i("705qg"),h=i("eWjiX"),c=i("7jh4K");function u(){r||(s=Object.fromEntries(Object.entries(r={"source-over":"normal",darken:"darken",multiply:"multiply","color-burn":"color burn",lighten:"lighten",screen:"screen","color-dodge":"color dodge",overlay:"overlay","soft-light":"soft light","hard-light":"hard light",difference:"difference",exclusion:"exclusion",hue:"hue",saturation:"saturation",color:"color",luminosity:"luminosity"}).map(function(e){return e.reverse()})))}function p(e){return u(),s[e]}function d(e){return u(),r[e]}function g(e){if(!e.canvas)throw Error("psdObj.canvas undefined");var t={type:"psd",canvas:e.canvas,width:e.width,height:e.height};function i(e){t.warningArr||(t.warningArr=[]),t.warningArr.includes(e)||t.warningArr.push(e)}function n(e){var t=p(e);return t||(i("blend-mode"),t="source-over"),t}if(8!==e.bitsPerChannel&&i("bits-per-channel"),!e.children)return t.error=!0,t;var r,s=l.MAX_LAYERS;if(0+function e(t){var n=0;if(t.blendMode){var r=p(t.blendMode);if(r&&"source-over"!==r)return 1}if(t.children)for(var s=0;s<t.children.length;s++){var a=t.children[s];!a.clipping&&!a.adjustment&&(a.children?(i("group"),n+=e(a)):n++)}return n}(e)>s)return t.error=!0,t;function o(e,t){var i=(0,h.BB).ctx(e),n=i.getImageData(0,0,e.width,e.height);if(0===t)for(var r=0;r<n.data.length;r+=4)n.data[r+3]=n.data[r];else for(var s=0;s<n.data.length;s+=4)n.data[s+3]=255-n.data[s];i.putImageData(n,0,0)}return t.layers=[],t.layers=function e(r){var s,l,u=[],p=!r.hidden,d=(0,c.throwIfUndefined)(r.opacity,"groupOpacity is undefined"),g=n(r.blendMode);if("source-over"!==g&&(s=(0,a.createCanvas)(t.width,t.height),l=(0,h.BB).ctx(s)),r.mask&&(i("mask"),o(r.mask.canvas,r.mask.defaultColor)),r.children)for(var f=0;f<r.children.length;f++){var v=r.children[f];if(!v.clipping){if(v.adjustment){i("adjustment");continue}var m=(v.children||v.canvas)&&r.children[f+1]&&r.children[f+1].clipping;if(m&&i("clipping"),v.children){for(var y=e(v),x=0;x<y.length;x++){var b=y[x],B=(0,h.BB).ctx(b.image);if(m){var w=(0,a.createCanvas)(t.width,t.height),k=(0,h.BB).ctx(w);k.drawImage(b.image,0,0);for(var C=f+1;C<r.children.length&&r.children[C].clipping;C++){var S=r.children[C];if(0!==S.opacity&&!S.hidden){if(void 0===S.blendMode)throw Error("clippingItem.blendMode undefined");if(void 0===S.opacity)throw Error("clippingItem.opacity undefined");if(void 0===S.canvas)throw Error("clippingItem.canvas undefined");if(void 0===S.left)throw Error("clippingItem.left undefined");if(void 0===S.top)throw Error("clippingItem.top undefined");k.globalCompositeOperation=n(S.blendMode),k.globalAlpha=S.opacity,k.drawImage(S.canvas,S.left,S.top)}}B.globalCompositeOperation="source-atop",B.drawImage(w,0,0)}if(r.mask){if(B.globalCompositeOperation=0===r.mask.defaultColor?"destination-in":"destination-out",void 0===r.mask.canvas)throw Error("psdGroupObj.mask.canvas undefined");if(void 0===r.mask.left)throw Error("psdGroupObj.mask.left undefined");if(void 0===r.mask.top)throw Error("psdGroupObj.mask.top undefined");B.drawImage(r.mask.canvas,r.mask.left,r.mask.top)}if(s){if(void 0===l)throw Error("groupCtx undefined");l.globalCompositeOperation=b.mixModeStr,l.globalAlpha=b.opacity,l.drawImage(b.image,0,0)}else b.opacity=b.opacity*d,u.push(b)}continue}var E=(0,a.createCanvas)(t.width,t.height),L=(0,h.BB).ctx(E);if(v.canvas){if(void 0===v.top)throw Error("item.top undefined");if(void 0===v.left)throw Error("item.left undefined");L.drawImage(v.canvas,v.left,v.top)}if(v.effects&&i("layer-effect"),v.mask){if(i("mask"),void 0===v.mask.canvas)throw Error("item.mask.canvas undefined");if(void 0===v.mask.defaultColor)throw Error("item.mask.defaultColor undefined");if(void 0===v.mask.left)throw Error("item.mask.left undefined");if(void 0===v.mask.top)throw Error("item.mask.top undefined");o(v.mask.canvas,v.mask.defaultColor),L.globalCompositeOperation=0===v.mask.defaultColor?"destination-in":"destination-out",L.drawImage(v.mask.canvas,v.mask.left,v.mask.top)}if(m){if(void 0===v.right)throw Error("item.right undefined");if(void 0===v.left)throw Error("item.left undefined");if(void 0===v.bottom)throw Error("item.bottom undefined");if(void 0===v.top)throw Error("item.top undefined");if(void 0===v.canvas)throw Error("item.canvas undefined");var A=(0,a.createCanvas)(v.right-v.left,v.bottom-v.top),I=(0,h.BB).ctx(A);I.drawImage(v.canvas,0,0);for(var T=f+1;T<r.children.length&&r.children[T].clipping;T++){var P=r.children[T];if(0!==P.opacity&&!P.hidden){if(void 0===P.blendMode)throw Error("clippingItem.blendMode undefined");if(void 0===P.opacity)throw Error("clippingItem.opacity undefined");if(void 0===P.canvas)throw Error("clippingItem.canvas undefined");if(void 0===P.left)throw Error("clippingItem.left undefined");if(void 0===P.top)throw Error("clippingItem.top undefined");I.globalCompositeOperation=n(P.blendMode),I.globalAlpha=P.opacity,I.drawImage(P.canvas,P.left-v.left,P.top-v.top)}}L.globalCompositeOperation="source-atop",L.drawImage(A,v.left,v.top)}if(r.mask){if(L.globalCompositeOperation=0===r.mask.defaultColor?"destination-in":"destination-out",void 0===r.mask.canvas)throw Error("psdGroupObj.mask.canvas undefined");if(void 0===r.mask.left)throw Error("psdGroupObj.mask.left undefined");if(void 0===r.mask.top)throw Error("psdGroupObj.mask.top undefined");L.drawImage(r.mask.canvas,r.mask.left,r.mask.top)}if(void 0===v.blendMode)throw Error("item.blendMode undefined");if(void 0===v.hidden)throw Error("item.hidden  undefined");if(void 0===v.opacity)throw Error("item.opacity undefined");if(s&&l)d>0&&(l.globalCompositeOperation=n(v.blendMode),l.globalAlpha=v.hidden?0:v.opacity,l.drawImage(E,0,0));else{if(void 0===v.name)throw Error("item.name undefined");u.push({name:v.name,isVisible:!v.hidden&&p,opacity:v.opacity*d,mixModeStr:n(v.blendMode),image:E})}}}if(s){if(void 0===r.name)throw Error("psdGroupObj.name undefined");u=[{name:r.name,isVisible:p,opacity:d,mixModeStr:g,image:s}]}return u}({name:"root",opacity:1,blendMode:"normal",children:e.children}),t}function f(e){var t={width:e.width,height:e.height,layers:[]};return e.layers?t.layers=e.layers.map(function(e){return{name:e.name,isVisible:e.isVisible,opacity:e.opacity,mixModeStr:e.mixModeStr,image:e.image}}):t.layers=[{name:(0,o.LANG)("background"),isVisible:!0,opacity:1,mixModeStr:"source-over",image:e.canvas}],t}}),n("9BlwZ",function(t,i){e(t.exports,"setDbName",function(){return a}),e(t.exports,"getKlProjectObj",function(){return l}),e(t.exports,"storeKlProjectObj",function(){return h}),e(t.exports,"clear",function(){return c});var n=!!window.indexedDB,r="Klecks",s="ProjectStore";function a(e){r=""+e}function o(e,t,i){var a,o=!1;function l(e){o||(o=!0,i(e))}if(!n){setTimeout(function(){l("no indexed db available")},0);return}try{a=window.indexedDB.open(r,1)}catch(e){l(e.message);return}a.onupgradeneeded=function(){try{a.result.createObjectStore(s,{keyPath:"id"}).createIndex("id","id",{unique:!0})}catch(e){l(e.message)}},a.onerror=function(){l("indexedDB.open failed, "+a.error)},a.onsuccess=function(){var i,n,h;try{if(!(i=a.result).objectStoreNames.contains(s)){window.indexedDB.deleteDatabase(r),l("object store "+s+" missing. destroying db");return}(h=(n=i.transaction(s,"readwrite")).objectStore(s)).index("id")}catch(e){l(e.message);return}i.onerror=function(){l("database error, "+i.error)};try{e(h)}catch(e){l(e.message);return}n.oncomplete=function(){o||(o=!0,t()),i.close()},n.onerror=function(){l("transaction error, "+n.error)}}}function l(e,t){if(n){var i;o(function(e){i=e.get(1)},function(){e(i.result)},function(e){t("execIndexedDBTransaction error, "+e)})}else e(void 0)}function h(e,t,i){o(function(t){t.put(e)},function(){t()},function(e){i(e)})}function c(e,t){o(function(e){e.delete(1)},function(){e()},function(e){t(e)})}}),n("kyVjY",function(n,r){e(n.exports,"filterLibStatus",function(){return C}),e(n.exports,"filterLib",function(){return S});var s=i("caJNA"),a=i("l6zI1"),o=i("fNWSC"),l=i("dfRUv"),h=i("cgsWO"),c=i("2KiYW"),u=i("iYsvm"),p=i("9pVlq"),d=i("7WTfQ"),g=i("g2Enb"),f=i("hlmuN"),v=i("a0XQW"),m=i("9FsPV"),y=i("auPoB"),x=i("i6VNg"),b=i("1JZ2n"),B=i("4bY7c"),w=i("15cx2"),k=i("gUwc7"),C={isLoaded:!1},S={brightnessContrast:{lang:{name:"filter-bright-contrast-title",button:"filter-bright-contrast",description:"filter-bright-contrast-description"},icon:/*@__PURE__*/t(s),updatePos:!1,getDialog:null,apply:null,inEmbed:!0,webGL:!0},cropExtend:{lang:{name:"filter-crop-title",button:"filter-crop-extend",description:"filter-crop-description"},icon:/*@__PURE__*/t(a),updatePos:!0,getDialog:null,apply:null,inEmbed:!1},curves:{lang:{name:"filter-curves-title",button:"filter-curves",description:"filter-curves-description"},icon:/*@__PURE__*/t(o),updatePos:!1,getDialog:null,apply:null,inEmbed:!0,webGL:!0},distort:{lang:{name:"filter-distort",button:"filter-distort",description:"filter-distort-description"},icon:/*@__PURE__*/t(k),updatePos:!1,getDialog:null,apply:null,inEmbed:!0,webGL:!0},flip:{lang:{name:"filter-flip-title",button:"filter-flip",description:"filter-flip-description"},icon:/*@__PURE__*/t(l),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},hueSaturation:{lang:{name:"filter-hue-sat-title",button:"filter-hue-sat",description:"filter-hue-sat-description"},icon:/*@__PURE__*/t(h),updatePos:!1,getDialog:null,apply:null,inEmbed:!0,darkNoInvert:!0,webGL:!0},invert:{lang:{name:"filter-invert",button:"filter-invert"},icon:/*@__PURE__*/t(c),updatePos:!1,isInstant:!0,getDialog:null,apply:null,inEmbed:!0,darkNoInvert:!0,webGL:!0},perspective:{lang:{name:"filter-perspective-title",button:"filter-perspective",description:"filter-perspective-description"},icon:/*@__PURE__*/t(u),updatePos:!1,getDialog:null,apply:null,inEmbed:!0,webGL:!0},resize:{lang:{name:"filter-resize-title",button:"filter-resize",description:"filter-resize-description"},icon:/*@__PURE__*/t(p),updatePos:!0,getDialog:null,apply:null,inEmbed:!1},rotate:{lang:{name:"filter-rotate-title",button:"filter-rotate",description:"filter-rotate-description"},icon:/*@__PURE__*/t(d),updatePos:!0,getDialog:null,apply:null,inEmbed:!1},tiltShift:{lang:{name:"filter-tilt-shift-title",button:"filter-tilt-shift",description:"filter-tilt-shift-description"},icon:/*@__PURE__*/t(g),updatePos:!1,getDialog:null,apply:null,inEmbed:!0,webGL:!0},toAlpha:{lang:{name:"filter-to-alpha-title",button:"filter-to-alpha",description:"filter-to-alpha-description"},icon:/*@__PURE__*/t(f),updatePos:!1,getDialog:null,apply:null,inEmbed:!0,darkNoInvert:!0,webGL:!0},transform:{lang:{name:"filter-transform-title",button:"filter-transform",description:"filter-transform-description"},icon:/*@__PURE__*/t(v),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},blur:{lang:{name:"filter-triangle-blur-title",button:"filter-triangle-blur",description:"filter-triangle-blur-description"},icon:/*@__PURE__*/t(m),updatePos:!1,getDialog:null,apply:null,inEmbed:!0,darkNoInvert:!0,webGL:!0},unsharpMask:{lang:{name:"filter-unsharp-mask-title",button:"filter-unsharp-mask",description:"filter-unsharp-mask-description"},icon:/*@__PURE__*/t(y),updatePos:!1,getDialog:null,apply:null,inEmbed:!0,darkNoInvert:!0,webGL:!0},grid:{lang:{name:"filter-grid",button:"filter-grid",description:"filter-grid-description"},icon:/*@__PURE__*/t(x),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},noise:{lang:{name:"filter-noise",button:"filter-noise",description:"filter-noise-description"},icon:/*@__PURE__*/t(b),updatePos:!1,getDialog:null,apply:null,inEmbed:!0,webGL:!0},pattern:{lang:{name:"filter-pattern",button:"filter-pattern",description:"filter-pattern-description"},icon:/*@__PURE__*/t(B),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},vanishPoint:{lang:{name:"filter-vanish-point-title",button:"filter-vanish-point",description:"filter-vanish-point-description"},icon:/*@__PURE__*/t(w),updatePos:!1,getDialog:null,apply:null,inEmbed:!0}}}),n("caJNA",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-brightness-contrast.8430cb26.svg"}),n("fNWSC",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-curves.bbdb97b2.svg"}),n("dfRUv",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-flip.00fd2c6b.svg"}),n("cgsWO",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-hue-saturation.6e36cf05.svg"}),n("2KiYW",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-invert.f5d05ba3.png"}),n("iYsvm",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-perspective.e23100db.svg"}),n("9pVlq",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-resize.56391e2b.svg"}),n("g2Enb",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-tilt-shift.f8ae88b3.png"}),n("hlmuN",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-to-alpha.f7a2065a.svg"}),n("a0XQW",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-transform.c8795430.svg"}),n("9FsPV",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-triangle-blur.d2c20f1d.png"}),n("auPoB",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-unsharp-mask.f1520547.png"}),n("i6VNg",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-grid.e900ce7b.svg"}),n("1JZ2n",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-noise.51bd751c.svg"}),n("4bY7c",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-pattern.1a06e094.svg"}),n("15cx2",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-vanish-point.fc5858e4.svg"}),n("gUwc7",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"edit-distort.bdb643f2.svg"}),n("dAXbp",function(t,n){e(t.exports,"brushes",function(){return u});var r=i("68QTJ"),s=i("5PSXS"),a=i("ewgr9"),o=i("kic4a"),l=i("7cUpm"),h=i("ltaBP"),c=i("6Nq1H"),u={PenBrush:r.PenBrush,BlendBrush:s.BlendBrush,SketchyBrush:a.SketchyBrush,PixelBrush:o.PixelBrush,ChemyBrush:c.ChemyBrush,SmudgeBrush:h.SmudgeBrush,EraserBrush:l.EraserBrush}}),n("68QTJ",function(t,n){e(t.exports,"PenBrush",function(){return h});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("5CF7D"),l=2*Math.PI,h=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.context={},this.settingHasOpacityPressure=!1,this.settingHasSizePressure=!0,this.settingSize=2,this.settingSpacing=.8489,this.settingOpacity=1,this.settingColor={},this.settingColorStr="",this.settingAlphaId=0,this.settingLockLayerAlpha=!1,this.hasDrawnDot=!1,this.lineToolLastDot=0,this.lastInput={x:0,y:0,pressure:0},this.lastInput2={x:0,y:0,pressure:0},this.inputArr=[],this.inputIsDrawing=!1,this.bezierLine=null,this.alphaCanvas128=(0,a.BB).canvas(128,128),this.alphaCanvas64=(0,a.BB).canvas(64,64),this.alphaCanvas32=(0,a.BB).canvas(32,32),this.alphaOpacityArr=[1,.9,1,1]}return(0,s._)(e,[{key:"updateAlphaCanvas",value:function(){if(0!==this.settingAlphaId&&3!==this.settingAlphaId)for(var e,t=[[this.alphaCanvas128,128],[this.alphaCanvas64,64],[this.alphaCanvas32,32]],i=0;i<t.length;i++)(e=(0,a.BB).ctx(t[i][0])).save(),e.clearRect(0,0,t[i][1],t[i][1]),e.fillStyle="rgba("+this.settingColor.r+", "+this.settingColor.g+", "+this.settingColor.b+", "+this.alphaOpacityArr[this.settingAlphaId]+")",e.fillRect(0,0,t[i][1],t[i][1]),e.globalCompositeOperation="destination-in",e.imageSmoothingQuality="high",e.drawImage(o.alphaImArr[this.settingAlphaId],0,0,t[i][1],t[i][1]),e.restore()}},{key:"calcOpacity",value:function(e){return this.settingOpacity*(this.settingHasOpacityPressure?e*e:1)}},{key:"drawDot",value:function(e,t,i,n,r,s){if(!(i<=0)){if(this.settingLockLayerAlpha&&(this.context.globalCompositeOperation="source-atop"),s&&s[3]===n||(this.context.globalAlpha=n),s||0!==this.settingAlphaId&&3!==this.settingAlphaId||(this.context.fillStyle=this.settingColorStr),0===this.settingAlphaId)this.context.beginPath(),this.context.arc(e,t,i,0,l),this.context.closePath(),this.context.fill(),this.hasDrawnDot=!0;else if(3===this.settingAlphaId)void 0!==r&&(this.context.save(),this.context.translate(e,t),this.context.rotate(r/180*Math.PI),this.context.fillRect(-i,-i,2*i,2*i),this.context.restore(),this.hasDrawnDot=!0);else{this.context.save(),this.context.translate(e,t);var a=this.alphaCanvas128;i<=32&&i>16?a=this.alphaCanvas64:i<=16&&(a=this.alphaCanvas32),this.context.scale(i,i),1===this.settingAlphaId&&this.context.rotate((e+t)*53123%l),this.context.drawImage(a,-1,-1,2,2),this.context.restore(),this.hasDrawnDot=!0}}}},{key:"continueLine",value:function(e,t,i,n){var r=this;null===this.bezierLine&&(this.bezierLine=new a.BB.BezierLine,this.bezierLine.add(this.lastInput.x,this.lastInput.y,0,function(){}));var s=[],o=function(e){var t=(0,a.BB).mix(r.lastInput2.pressure,n,e.t),i=r.calcOpacity(t),o=Math.max(.1,r.settingSize*(r.settingHasSizePressure?t:1));s.push([e.x,e.y,o,i,e.angle])},l=i*this.settingSpacing;null===e||null===t?this.bezierLine.addFinal(l,o):this.bezierLine.add(e,t,l,o),this.context.save();for(var h=void 0,c=0;c<s.length;c++){var u=s[c];this.drawDot(u[0],u[1],u[2],u[3],u[4],h),h=u}this.context.restore()}},{key:"startLine",value:function(e,t,i){this.historyEntry={tool:["brush","PenBrush"],actions:[{action:"opacityPressure",params:[this.settingHasOpacityPressure]},{action:"sizePressure",params:[this.settingHasSizePressure]},{action:"setSize",params:[this.settingSize]},{action:"setSpacing",params:[this.settingSpacing]},{action:"setOpacity",params:[this.settingOpacity]},{action:"setColor",params:[this.settingColor]},{action:"setAlpha",params:[this.settingAlphaId]},{action:"setLockAlpha",params:[this.settingLockLayerAlpha]}]},i=(0,a.BB).clamp(i,0,1);var n=this.calcOpacity(i),r=this.settingHasSizePressure?Math.max(.1,i*this.settingSize):Math.max(.1,this.settingSize);this.hasDrawnDot=!1,this.inputIsDrawing=!0,this.context.save(),this.drawDot(e,t,r,n),this.context.restore(),this.lineToolLastDot=r*this.settingSpacing,this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=i,this.lastInput2.pressure=i,this.inputArr=[{x:e,y:t,pressure:i}],this.historyEntry.actions.push({action:"startLine",params:[e,t,i]})}},{key:"goLine",value:function(e,t,i){if(this.inputIsDrawing){this.historyEntry.actions.push({action:"goLine",params:[e,t,i]});var n=(0,a.BB).clamp(i,0,1),r=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);this.context.save(),this.continueLine(e,t,r,this.lastInput.pressure),this.context.restore(),this.lastInput.x=e,this.lastInput.y=t,this.lastInput2.pressure=this.lastInput.pressure,this.lastInput.pressure=n,this.inputArr.push({x:e,y:t,pressure:i})}}},{key:"endLine",value:function(e,t){var i,n=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);if(this.context.save(),this.continueLine(null,null,n,this.lastInput.pressure),this.context.restore(),this.inputIsDrawing=!1,3===this.settingAlphaId&&!this.hasDrawnDot){var r=this.inputArr[0];this.inputArr.forEach(function(e){e.pressure>r.pressure&&(r=e)}),this.context.save();var s=(0,a.BB).clamp(r.pressure,0,1),o=this.calcOpacity(s);this.drawDot(r.x,r.y,n,o,0),this.context.restore()}this.bezierLine=null,this.historyEntry&&(this.historyEntry.actions.push({action:"endLine",params:[e,t]}),null===(i=this.history)||void 0===i||i.push(this.historyEntry),this.historyEntry=void 0),this.hasDrawnDot=!1,this.inputArr=[]}},{key:"drawLineSegment",value:function(e,t,i,n){if(this.lastInput.x=i,this.lastInput.y=n,this.lastInput.pressure=1,!this.inputIsDrawing&&void 0!==e){var r,s,o=(0,a.BB).pointsToAngleDeg({x:e,y:t},{x:i,y:n}),l=Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2)),h=(i-e)/l,c=(n-t)/l,u=this.settingSize*this.settingSpacing;for(this.lineToolLastDot=this.settingSize*this.settingSpacing,this.context.save(),s=this.lineToolLastDot;s<=l;s+=u)this.drawDot(e+h*s,t+c*s,this.settingSize,this.settingOpacity,o);this.context.restore();var p={tool:["brush","PenBrush"],actions:[{action:"opacityPressure",params:[this.settingHasOpacityPressure]},{action:"sizePressure",params:[this.settingHasSizePressure]},{action:"setSize",params:[this.settingSize]},{action:"setSpacing",params:[this.settingSpacing]},{action:"setOpacity",params:[this.settingOpacity]},{action:"setColor",params:[this.settingColor]},{action:"setAlpha",params:[this.settingAlphaId]},{action:"setLockAlpha",params:[this.settingLockLayerAlpha]},{action:"drawLineSegment",params:[e,t,i,n]}]};null===(r=this.history)||void 0===r||r.push(p)}}},{key:"isDrawing",value:function(){return this.inputIsDrawing}},{key:"setAlpha",value:function(e){this.settingAlphaId!==e&&(this.settingAlphaId=e,this.updateAlphaCanvas())}},{key:"setColor",value:function(e){this.settingColor!==e&&(this.settingColor={r:e.r,g:e.g,b:e.b},this.settingColorStr="rgb("+this.settingColor.r+","+this.settingColor.g+","+this.settingColor.b+")",this.updateAlphaCanvas())}},{key:"setContext",value:function(e){this.context=e}},{key:"setHistory",value:function(e){this.history=e}},{key:"setSize",value:function(e){this.settingSize=e}},{key:"setOpacity",value:function(e){this.settingOpacity=e}},{key:"setSpacing",value:function(e){this.settingSpacing=e}},{key:"sizePressure",value:function(e){this.settingHasSizePressure=e}},{key:"opacityPressure",value:function(e){this.settingHasOpacityPressure=e}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=e}},{key:"getSpacing",value:function(){return this.settingSpacing}},{key:"getSize",value:function(){return this.settingSize}},{key:"getOpacity",value:function(){return this.settingOpacity}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}}]),e}()}),n("5CF7D",function(t,n){e(t.exports,"alphaImArr",function(){return s});var r=i("74D3O"),s=[];s[1]=(0,r.genBrushAlpha01)(128),s[2]=(0,r.genBrushAlpha02)(128)}),n("74D3O",function(t,n){e(t.exports,"genBrushAlpha01",function(){return a}),e(t.exports,"genBrushAlpha02",function(){return o});var r=i("eWjiX"),s=i("gZSR2");function a(e){for(var t=e/500,i=(0,r.BB).canvas(e,e),n=(0,r.BB).ctx(i),a=n.createImageData(e,e),o=0;o<e;o++)for(var l=0;l<e;l++){var h=(l*e+o)*4,c=t+.04*(0,s.noise).simplex2(o/50/t,l/50/t),u=100+((0,s.noise).simplex2(o/50/c,l/50/c)+1)/2*100;u-=((0,s.noise).simplex2(o/10/t,l/10/t)+1)/2*100;var p=(0,r.BB).dist(e/2,e/2,o,l);u*=(0,r.BB).clamp(1-((p-e/2.5)/(e/14)+(0,s.noise).simplex2(o/22/c,l/22/c)),0,1)*(2*(0,r.BB).clamp(1-p/e,0,1)),a.data[h]=0,a.data[h+1]=0,a.data[h+2]=0,a.data[h+3]=(0,r.BB).clamp(u,0,255)}return n.putImageData(a,0,0),i}function o(e){var t,i;t=2/3*(1/4),i=1/3*(1/4);for(var n={x:1/4*e,y:e-1/4*e},s={x:e-1/4*e,y:1/4*e},a=(0,r.BB).canvas(e,e),o=(0,r.BB).ctx(a),l=o.createImageData(e,e),h=0;h<e;h++)for(var c=0;c<e;c++){var u=(c*e+h)*4,p=function(e,t,i){var n=(0,r.BB).Vec2.sub(i,t),s=(0,r.BB).Vec2.sub(e,t),a=(0,r.BB).clamp((0,r.BB).Vec2.dot(s,n)/(0,r.BB).Vec2.dot(n,n),0,1);return(0,r.BB).Vec2.len((0,r.BB).Vec2.sub(s,(0,r.BB).Vec2.mul(n,a)))}({x:h,y:c},n,s);p=(0,r.BB).clamp(255-(p-e*t)/(e*i)*255,0,255),l.data[u]=0,l.data[u+1]=0,l.data[u+2]=0,l.data[u+3]=p}return o.putImageData(l,0,0),a}}),n("gZSR2",function(t,n){e(t.exports,"noise",function(){return g});var r=i("cx0mh"),s=i("7h4XF"),a={},o=/*#__PURE__*/function(){function e(t,i,n){(0,r._)(this,e),this.x=t,this.y=i,this.z=n}return(0,s._)(e,[{key:"dot2",value:function(e,t){return this.x*e+this.y*t}}]),e}(),l=[new o(1,1,0),new o(-1,1,0),new o(1,-1,0),new o(-1,-1,0),new o(1,0,1),new o(-1,0,1),new o(1,0,-1),new o(-1,0,-1),new o(0,1,1),new o(0,-1,1),new o(0,1,-1),new o(0,-1,-1)],h=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],c=Array(512),u=Array(512);a.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var i=void 0;i=1&t?h[t]^255&e:h[t]^e>>8&255,c[t]=c[t+256]=i,u[t]=u[t+256]=l[i%12]}},a.seed(0);var p=.5*(Math.sqrt(3)-1),d=(3-Math.sqrt(3))/6;a.simplex2=function(e,t){var i,n,r,s,a,o=(e+t)*p,l=Math.floor(e+o),h=Math.floor(t+o),g=(l+h)*d,f=e-l+g,v=t-h+g;f>v?(s=1,a=0):(s=0,a=1);var m=f-s+d,y=v-a+d,x=f-1+2*d,b=v-1+2*d,B=u[(l&=255)+c[h&=255]],w=u[l+s+c[h+a]],k=u[l+1+c[h+1]],C=.5-f*f-v*v;C<0?i=0:(C*=C,i=C*C*B.dot2(f,v));var S=.5-m*m-y*y;S<0?n=0:(S*=S,n=S*S*w.dot2(m,y));var E=.5-x*x-b*b;return E<0?r=0:(E*=E,r=E*E*k.dot2(x,b)),70*(i+n+r)};var g=a}),n("5PSXS",function(t,n){e(t.exports,"BlendBrush",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("eg83P"),l=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.isTesting=!1,this.context={},this.color={},this.size=29,this.opacity=.6,this.blending=.65,this.settingLockLayerAlpha=!1,this.settingSizePressure=!0,this.settingOpacityPressure=!1,this.blendCol={r:0,g:0,b:0,a:1},this.blendMix=.45,this.mixCol={r:0,g:0,b:0},this.localColOld={},this.isDrawing=!1,this.lastInput={x:0,y:0,pressure:0},this.lastInput2={x:0,y:0,pressure:0},this.cells=[],this.drawBuffer=[]}return(0,s._)(e,[{key:"updateRedrawBounds",value:function(e){this.redrawBounds=(0,a.BB).updateBounds(this.redrawBounds,e)}},{key:"getCellsWidth",value:function(){return Math.ceil(this.context.canvas.width/256)}},{key:"drawChangedCells",value:function(){var e=this;if(this.redrawBounds){var t=this.cells.map(function(){});this.getTouchedCells(this.redrawBounds).forEach(function(i,n){i&&(t[n]=e.cells[n])}),this.drawCells(t),this.redrawBounds=void 0}}},{key:"getTouchedCells",value:function(e){var t=this.cells.map(function(){return!1}),i=this.getCellsWidth();e={x1:Math.floor(e.x1/256),y1:Math.floor(e.y1/256),x2:Math.floor(e.x2/256),y2:Math.floor(e.y2/256)};for(var n=e.x1;n<=e.x2;n++)for(var r=e.y1;r<=e.y2;r++)t[r*i+n]=!0;return t}},{key:"sliceBounds",value:function(e){var t=this,i=this.getCellsWidth(),n=[];return this.getTouchedCells(e).forEach(function(r,s){if(r){var a=s%i*256,o=256*Math.floor(s/i),l=t.cells[s].width,h=t.cells[s].height,c={x1:Math.max(0,e.x1-a),y1:Math.max(0,e.y1-o),x2:Math.min(l-1,e.x2-a),y2:Math.min(h-1,e.y2-o)};c.x1>c.x2||c.y1>c.y2||n.push({index:s,bounds:c})}}),n}},{key:"copyFromCanvas",value:function(e){var t=this;if(e){var i=this.getTouchedCells(e),n=this.getCellsWidth();i.forEach(function(e,i){if(e&&!t.cells[i]){var r=i%n,s=Math.floor(i/n),o=(Math.min(256*r+256,t.context.canvas.width)-1)%256+1,l=(Math.min(256*s+256,t.context.canvas.height)-1)%256+1,h=(0,a.BB).canvas(o,l),c=(0,a.BB).ctx(h);c.drawImage(t.context.canvas,-(256*r),-(256*s)),t.cells[i]=c.getImageData(0,0,o,l)}})}}},{key:"getAverage",value:function(e,t,i){var n=this,r=Math.max(0,Math.floor(e-(i=Math.max(.5,.75*i)))),s=Math.max(0,Math.floor(t-i)),a=Math.min(this.context.canvas.width-1,Math.ceil(e+i)),o=Math.min(this.context.canvas.height-1,Math.ceil(t+i));if(r>a||s>o)return{r:0,g:0,b:0,a:0};var l,h=0,c=0,u=0,p=0;return this.sliceBounds({x1:r,y1:s,x2:a,y2:o}).forEach(function(e){for(var t=n.cells[e.index].width,i=n.cells[e.index].data,r=e.bounds,s=r.y1;s<=r.y2;s+=4)for(var a=r.x1,o=s*t*4+4*r.x1;a<=r.x2;a+=4,o+=16)l=i[o+3],h+=i[o]*l,c+=i[o+1]*l,u+=i[o+2]*l,p+=l}),0!==p&&(h/=p,c/=p,u/=p,p=Math.min(1,p)),{r:h,g:c,b:u,a:p}}},{key:"prepDot",value:function(e,t,i){var n=Math.max(0,Math.floor(e-(i=Math.max(.5,i)))),r=Math.max(0,Math.floor(t-i)),s=Math.min(this.context.canvas.width-1,Math.ceil(e+i)),a=Math.min(this.context.canvas.height-1,Math.ceil(t+i));if(!(n>s)&&!(r>a))return{x1:n,y1:r,x2:s,y2:a}}},{key:"drawDot",value:function(e){for(var t=this,i=0,n=e.size>30?1024:512,r=[],s=0;s<n;s++)r[s]=(Math.random()-.5)/1.001+.5;var l=[8,4,4,4,2,2,2,2,2,2][Math.floor(2*e.size)],h=l?l*l:0,c=[];if(l)for(var u=0,p=0;p<l;p++)for(var d=0;d<l;d++,u+=2)c[u]=(p+1)/l,c[u+1]=(d+1)/l;var g=.8*Math.pow(e.opacity,2),f=1-g,v=e.size*e.size,m=v*f/e.opacity,y=(1+g/f)*e.opacity,x=this.sliceBounds({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}),b=this.getCellsWidth();x.forEach(function(s){for(var l=s.index%b*256,u=256*Math.floor(s.index/b),p=t.cells[s.index].width,d=t.cells[s.index].data,g=s.bounds.y1,f=g+u-e.y;g<=s.bounds.y2;g++,f++)for(var x=s.bounds.x1,B=g*p*4+4*s.bounds.x1,w=x+l-e.x;x<=s.bounds.x2;x++,B+=4,w++){var k=0;if(h){for(var C=0;C<c.length;C+=2){var S=(0,a.BB).lenSquared(w+c[C],f+c[C+1]);S>=v||(k+=(0,o.clamp)(y-S/m,0,e.opacity))}if(!k)continue;k/=h}else{var E=Math.pow(w,2)+Math.pow(f,2);if(E>=v)continue;k=(0,o.clamp)(y-E/m,0,e.opacity)}var L=1-k,A=d[B+3]/255;if(t.settingLockLayerAlpha){var I=e.r*k+d[B]*L,T=e.g*k+d[B+1]*L,P=e.b*k+d[B+2]*L;A&&(d[B]=Math.floor(I+r[i]),d[B+1]=Math.floor(T+r[i]),d[B+2]=Math.floor(P+r[i]))}else{var R=e.r*k+d[B]*A*L,M=e.g*k+d[B+1]*A*L,D=e.b*k+d[B+2]*A*L,O=1-L*(1-A);d[B+3]=Math.floor(Math.min(255,255*O)+.5),O&&(d[B]=Math.floor(R/O+r[i]),d[B+1]=Math.floor(M/O+r[i]),d[B+2]=Math.floor(D/O+r[i]))}i=(i+1)%n}})}},{key:"calcSpacing",value:function(e){return(0,a.BB).mix(2*e/2,2*e/9,(0,o.clamp)((e-2.7)/9.3,0,1))}},{key:"continueLine",value:function(e,t,i,n){var r,s,o,l,h=this;this.drawBuffer=[];var c=this.settingSizePressure?Math.max(1,i*this.size):Math.max(1,this.size),u=this.calcSpacing(c),p=void 0===e?this.lastInput.x:e,d=void 0===t?this.lastInput.y:t;if(0===this.blending)this.mixCol.r=this.color.r,this.mixCol.g=this.color.g,this.mixCol.b=this.color.b;else{if(n)l={r:this.localColOld.r,g:this.localColOld.g,b:this.localColOld.b,a:0};else{var g=[p,d,this.settingSizePressure?Math.max(.5,i*this.size):Math.max(.5,this.size)],f=this.prepDot(g[0],g[1],g[2]);f&&this.copyFromCanvas(f),l=this.getAverage(g[0],g[1],g[2])}o={r:0,g:0,b:0,a:0},l.a>0&&0===this.blendCol.a?(this.blendCol.r=l.r,this.blendCol.g=l.g,this.blendCol.b=l.b,this.blendCol.a=l.a):(0===l.a&&(l.r=this.color.r,l.g=this.color.g,l.b=this.color.b,l.a=1-this.blending),this.blendCol.r=(0,a.BB).mix(this.blendCol.r,(0,a.BB).mix(this.blendCol.r,l.r,this.blendMix),l.a),this.blendCol.g=(0,a.BB).mix(this.blendCol.g,(0,a.BB).mix(this.blendCol.g,l.g,this.blendMix),l.a),this.blendCol.b=(0,a.BB).mix(this.blendCol.b,(0,a.BB).mix(this.blendCol.b,l.b,this.blendMix),l.a),this.blendCol.a=Math.min(1,this.blendCol.a+l.a)),o.r=this.blendCol.r,o.g=this.blendCol.g,o.b=this.blendCol.b,o.a=this.blendCol.a}var v=function(e){if(!(h.blending>=1)||!(h.blendCol.a<=0)){var t=e.t;r=h.lastInput2.pressure*(1-t)+i*t,s=h.settingOpacityPressure?h.opacity*r*r:h.opacity,c=h.settingSizePressure?Math.max(.1,r*h.size):Math.max(.1,h.size),0!=h.blending&&(h.mixCol.r=(0,a.BB).mix(h.localColOld.r,o.r,t),h.mixCol.g=(0,a.BB).mix(h.localColOld.g,o.g,t),h.mixCol.b=(0,a.BB).mix(h.localColOld.b,o.b,t)),1===h.blending&&0===h.localColOld.a&&(h.mixCol.r=o.r,h.mixCol.g=o.g,h.mixCol.b=o.b);var n=h.prepDot(e.x,e.y,c);n&&(h.updateRedrawBounds(n),h.drawBuffer.push({x:e.x,y:e.y,size:c,opacity:s,x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,r:(0,a.BB).mix(h.color.r,h.mixCol.r,h.blending),g:(0,a.BB).mix(h.color.g,h.mixCol.g,h.blending),b:(0,a.BB).mix(h.color.b,h.mixCol.b,h.blending)}))}};void 0===e||void 0===t?this.bezierLine.addFinal(u,v):this.bezierLine.add(e,t,u,v),this.copyFromCanvas(this.redrawBounds),this.drawBuffer.forEach(function(e){h.drawDot(e)}),this.drawBuffer=[],this.localColOld=o}},{key:"setHistory",value:function(e){this.history=e}},{key:"getSize",value:function(){return this.size}},{key:"setSize",value:function(e){this.size=e}},{key:"getOpacity",value:function(){return this.opacity}},{key:"setOpacity",value:function(e){this.opacity=e}},{key:"getBlending",value:function(){return this.blending}},{key:"setBlending",value:function(e){this.blending=e}},{key:"setColor",value:function(e){this.color=(0,a.BB).copyObj(e)}},{key:"setContext",value:function(e){this.context=e}},{key:"setSizePressure",value:function(e){this.settingSizePressure=e}},{key:"setOpacityPressure",value:function(e){this.settingOpacityPressure=e}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=e}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"setIsTesting",value:function(e){this.isTesting=e}},{key:"startLine",value:function(e,t,i){var n=this;this.historyEntry={tool:["brush","BlendBrush"],actions:[]};var r=Math.ceil(this.context.canvas.width/256)*Math.ceil(this.context.canvas.height/256);this.cells="0".repeat(r).split("").map(function(){}),this.isDrawing=!0,i=Math.max(0,Math.min(1,i));var s=this.settingOpacityPressure?this.opacity*i*i:this.opacity,o=this.settingSizePressure?Math.max(.1,i*this.size):Math.max(.1,this.size);if(0===this.blending)this.mixCol.r=this.color.r,this.mixCol.g=this.color.g,this.mixCol.b=this.color.b;else{this.copyFromCanvas(this.prepDot(e,t,o));var l=this.getAverage(e,t,this.settingSizePressure?Math.max(.1,i*this.size):Math.max(.1,this.size));0===l.a?this.blendCol={r:this.color.r,g:this.color.g,b:this.color.b,a:1-this.blending}:this.blendCol={r:l.r,g:l.g,b:l.b,a:l.a},this.mixCol.r=this.blendCol.r,this.mixCol.g=this.blendCol.g,this.mixCol.b=this.blendCol.b}if(this.localColOld={r:this.mixCol.r,g:this.mixCol.g,b:this.mixCol.b,a:this.blendCol.a},this.redrawBounds=void 0,this.drawBuffer=[],this.blending<1||this.blendCol.a>0){var h=this.prepDot(e,t,o);h&&(this.updateRedrawBounds(h),this.drawBuffer.push({x:e,y:t,size:o,opacity:s,x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,r:(0,a.BB).mix(this.color.r,this.mixCol.r,this.blending),g:(0,a.BB).mix(this.color.g,this.mixCol.g,this.blending),b:(0,a.BB).mix(this.color.b,this.mixCol.b,this.blending)}))}this.copyFromCanvas(this.redrawBounds),this.drawBuffer.forEach(function(e){n.drawDot(e)}),this.drawBuffer=[],this.bezierLine=new a.BB.BezierLine,this.bezierLine.add(e,t,0,function(){}),this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=i,this.lastInput2=(0,a.BB).copyObj(this.lastInput),this.isTesting||this.drawChangedCells()}},{key:"goLine",value:function(e,t,i,n){this.isDrawing&&(this.continueLine(e,t,this.lastInput.pressure,n),this.lastInput2=(0,a.BB).copyObj(this.lastInput),this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=i,this.isTesting||this.drawChangedCells())}},{key:"endLine",value:function(){this.bezierLine&&this.continueLine(void 0,void 0,this.lastInput.pressure,!1),this.isDrawing=!1,this.bezierLine=void 0,this.drawChangedCells(),this.historyEntry&&this.history&&this.cells.find(function(e){return!!e})&&(this.historyEntry.actions.push({action:"drawCells",params:[this.cells]}),this.history.push(this.historyEntry),this.historyEntry=void 0),this.cells=[]}},{key:"drawCells",value:function(e){var t=this,i=this.getCellsWidth();e.forEach(function(e,n){if(e){var r=256*Math.floor(n/i);t.context.putImageData(e,n%i*256,r)}})}},{key:"drawLineSegment",value:function(e,t,i,n){var r=this;if(this.lastInput.x=i,this.lastInput.y=n,!this.isDrawing&&void 0!==e){var s=Math.ceil(this.context.canvas.width/256)*Math.ceil(this.context.canvas.height/256);this.cells="0".repeat(s).split("").map(function(){}),this.redrawBounds=void 0,this.drawBuffer=[],this.copyFromCanvas(this.prepDot(e,t,Math.max(.1,this.size)));var o=this.getAverage(e,t,Math.max(.1,this.size));0===o.a?this.blendCol={r:this.color.r,g:this.color.g,b:this.color.b,a:1-this.blending}:this.blendCol={r:o.r,g:o.g,b:o.b,a:o.a},this.mixCol.r=this.color.r*(1-this.blendCol.a)+(this.blending*this.blendCol.r+this.color.r*(1-this.blending))*this.blendCol.a,this.mixCol.g=this.color.g*(1-this.blendCol.a)+(this.blending*this.blendCol.g+this.color.g*(1-this.blending))*this.blendCol.a,this.mixCol.b=this.color.b*(1-this.blendCol.a)+(this.blending*this.blendCol.b+this.color.b*(1-this.blending))*this.blendCol.a;for(var l=this.settingOpacityPressure?1*this.opacity:this.opacity,h=this.settingSizePressure?Math.max(.1,1*this.size):Math.max(.1,this.size),c=Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2)),u=(i-e)/c,p=(n-t)/c,d=this.calcSpacing(h),g=0;g<=c;g+=d){var f=this.prepDot(e+u*g,t+p*g,h);f&&(this.copyFromCanvas(f),this.drawBuffer.push({x:e+u*g,y:t+p*g,size:h,opacity:l,x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,r:(0,a.BB).mix(this.color.r,this.mixCol.r,this.blending),g:(0,a.BB).mix(this.color.g,this.mixCol.g,this.blending),b:(0,a.BB).mix(this.color.b,this.mixCol.b,this.blending)}))}this.drawBuffer.forEach(function(e){r.drawDot(e)}),this.drawBuffer=[],this.history&&this.cells.find(function(e){return!!e})&&(this.drawCells(this.cells),this.historyEntry={tool:["brush","BlendBrush"],actions:[{action:"drawCells",params:[this.cells]}]},this.history.push(this.historyEntry),this.historyEntry=void 0),this.cells=[]}}}]),e}()}),n("ewgr9",function(t,n){e(t.exports,"SketchyBrush",function(){return h});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=(0,a.BB).canvas(32,32),l=(0,a.BB).ctx(o),h=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.context={},this.settingColor={},this.settingSize=1,this.settingOpacity=.2,this.settingBlending=.5,this.settingScale=1,this.lastX=0,this.lastY=0,this.inputIsDrawing=!1,this.lastInput={x:0,y:0,pressure:0},this.sketchySeed=0,this.points=[],this.count=0,this.mixMode=[function(e){return e},function(e,t){var i=new a.BB.RGB(e.r,e.g,e.b);return i.r*=t.r/255,i.g*=t.g/255,i.b*=t.b/255,i}]}return(0,s._)(e,[{key:"rand",value:function(){return this.sketchySeed++,.5*Math.sin(6324634.2345*Math.cos(5342.3423*this.sketchySeed))+.5}},{key:"setHistory",value:function(e){this.history=e}},{key:"setSeed",value:function(e){this.sketchySeed=parseInt(""+e)}},{key:"getSeed",value:function(){return parseInt(""+this.sketchySeed)}},{key:"getSize",value:function(){return this.settingSize/2}},{key:"setColor",value:function(e){this.settingColor=e}},{key:"getOpacity",value:function(){return this.settingOpacity}},{key:"setOpacity",value:function(e){this.settingOpacity=e}},{key:"getBlending",value:function(){return this.settingBlending}},{key:"setBlending",value:function(e){this.settingBlending=e}},{key:"setSize",value:function(e){this.settingSize=2*e}},{key:"getScale",value:function(){return this.settingScale}},{key:"setScale",value:function(e){this.settingScale=e}},{key:"setContext",value:function(e){this.context=e}},{key:"startLine",value:function(e,t,i,n){n&&this.lastInput.x?(this.inputIsDrawing=!0,this.endLine()):(this.inputIsDrawing=!0,this.lastX=e,this.lastY=t,this.lastInput.x=e,this.lastInput.y=t,this.historyEntry={tool:["brush","SketchyBrush"],actions:[{action:"setScale",params:[this.settingScale]},{action:"setSize",params:[this.settingSize/2]},{action:"setOpacity",params:[this.settingOpacity]},{action:"setColor",params:[this.settingColor]},{action:"setBlending",params:[this.settingBlending]},{action:"startLine",params:[e,t,i]}]})}},{key:"goLine",value:function(e,t,i,n){if(this.inputIsDrawing&&(e!==this.lastInput.x||t!==this.lastInput.y)){var r,s,o,l,h=parseInt(""+e),c=parseInt(""+t);this.points.push([h,c]);var u=this.settingColor.r,p=this.settingColor.g,d=this.settingColor.b;if(n)u=n.r,p=n.g,d=n.b;else if(0!==this.settingBlending&&h+5>=0&&c+5>=0&&h-5<this.context.canvas.width-1&&c-5<this.context.canvas.height-1){u=0,p=0,d=0;var g=Math.min(this.context.canvas.width-1,Math.max(0,h-5)),f=Math.min(this.context.canvas.height-1,Math.max(0,c-5)),v=Math.min(this.context.canvas.width-1,Math.max(0,h+5)),m=Math.min(this.context.canvas.height-1,Math.max(0,c+5));if(v-=g,m-=f,v>0&&m>0){for(var y=this.context.getImageData(g,f,v,m),x=0,b=0;b<y.data.length;b+=4)u+=y.data[b+0],p+=y.data[b+1],d+=y.data[b+2],x++;u/=x,p/=x,d/=x}var B=this.mixMode[0](new a.BB.RGB(u,p,d),this.settingColor);u=parseInt(""+(0,a.BB).mix(this.settingColor.r,B.r,this.settingBlending)),p=parseInt(""+(0,a.BB).mix(this.settingColor.g,B.g,this.settingBlending)),d=parseInt(""+(0,a.BB).mix(this.settingColor.b,B.b,this.settingBlending))}for(this.context.save(),this.context.strokeStyle="rgba("+u+", "+p+", "+d+", "+this.settingOpacity+")",this.context.lineWidth=this.settingSize,this.context.beginPath(),this.context.moveTo(this.lastX,this.lastY),this.context.lineTo(h,c),r=0;r<this.points.length;r++)(l=(s=this.points[r][0]-this.points[this.count][0])*s+(o=this.points[r][1]-this.points[this.count][1])*o)<4e3*this.settingScale*this.settingScale&&this.rand()>l/2e3/this.settingScale/this.settingScale&&(this.context.moveTo(this.points[this.count][0]+.3*s,this.points[this.count][1]+.3*o),this.context.lineTo(this.points[r][0]-.3*s,this.points[r][1]-.3*o));this.context.stroke(),this.context.restore(),this.count++,this.lastX=h,this.lastY=c,this.lastInput.x=h,this.lastInput.y=c,this.historyEntry.actions.push({action:"goLine",params:[e,t,i,{r:u,g:p,b:d}]})}}},{key:"endLine",value:function(){if(this.inputIsDrawing=!1,this.count=0,this.points=[],this.historyEntry){var e;this.historyEntry.actions.push({action:"endLine",params:[]}),null===(e=this.history)||void 0===e||e.push(this.historyEntry),this.historyEntry=void 0}}},{key:"drawLineSegment",value:function(e,t,i,n){if(this.lastInput.x=i,this.lastInput.y=n,!this.inputIsDrawing&&void 0!==e){this.context.save(),this.context.lineWidth=this.settingSize;var r,s={r:this.settingColor.r,g:this.settingColor.g,b:this.settingColor.b};if(e+5>=0&&t+5>=0&&e-5<this.context.canvas.width-1&&t-5<this.context.canvas.height-1){s.r=0,s.g=0,s.b=0;var h=Math.min(this.context.canvas.width-1,Math.max(0,e-5)),c=Math.min(this.context.canvas.height-1,Math.max(0,t-5)),u=Math.min(this.context.canvas.width-1,Math.max(0,e+5)),p=Math.min(this.context.canvas.height-1,Math.max(0,t+5));if(u-=h,p-=c,u>0&&p>0){var d=Math.min(o.width,u),g=Math.min(o.height,p);l.save(),l.globalCompositeOperation="copy",l.drawImage(this.context.canvas,h,c,u,p,0,0,d,g),l.restore();for(var f=l.getImageData(h,c,u,p),v=0,m=0;m<f.data.length;m+=4)s.r+=f.data[m+0],s.g+=f.data[m+1],s.b+=f.data[m+2],v++;s.r/=v,s.g/=v,s.b/=v}}var y=this.mixMode[0](new a.BB.RGB(s.r,s.g,s.b),this.settingColor);s.r=parseInt(""+(this.settingBlending*y.r+this.settingColor.r*(1-this.settingBlending))),s.g=parseInt(""+(this.settingBlending*y.g+this.settingColor.g*(1-this.settingBlending))),s.b=parseInt(""+(this.settingBlending*y.b+this.settingColor.b*(1-this.settingBlending))),this.context.strokeStyle="rgba("+s.r+", "+s.g+", "+s.b+", "+this.settingOpacity+")",this.context.beginPath(),this.context.moveTo(e,t),this.context.lineTo(i,n),this.context.stroke(),this.context.strokeStyle="rgba("+s.r+", "+s.g+", "+s.b+", "+this.settingOpacity+")",this.context.restore();var x={tool:["brush","SketchyBrush"],actions:[{action:"setScale",params:[this.settingScale]},{action:"setSize",params:[this.settingSize/2]},{action:"setOpacity",params:[this.settingOpacity]},{action:"setColor",params:[this.settingColor]},{action:"setBlending",params:[this.settingBlending]},{action:"drawLineSegment",params:[e,t,i,n]}]};null===(r=this.history)||void 0===r||r.push(x)}}},{key:"isDrawing",value:function(){return this.inputIsDrawing}}]),e}()}),n("kic4a",function(t,n){e(t.exports,"PixelBrush",function(){return h});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("fohxs"),l=i("7jh4K"),h=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.context={},this.settingHasSizePressure=!0,this.settingHasOpacityPressure=!1,this.settingSize=.5,this.settingSpacing=.9,this.settingOpacity=1,this.settingColor={},this.settingColorStr="",this.settingLockLayerAlpha=!1,this.settingIsEraser=!1,this.settingUseDither=!0,this.inputIsDrawing=!1,this.lineToolLastDot=0,this.lastInput={x:0,y:0,pressure:0},this.lastInput2={x:0,y:0,pressure:0},this.bezierLine=null,this.ditherArr=[[3,2],[1,0],[3,0],[1,2],[2,1],[0,3],[0,1],[2,3],[2,0],[0,2],[0,0],[2,2],[1,1],[3,3],[3,1],[1,3]],this.ditherPattern={},this.ditherCanvas=(0,a.BB).canvas(4,4),this.ditherCtx=(0,a.BB).ctx(this.ditherCanvas)}return(0,s._)(e,[{key:"updateDither",value:function(){this.ditherCtx.clearRect(0,0,4,4),this.ditherCtx.fillStyle=this.settingIsEraser?`rgb(${o.ERASE_COLOR},${o.ERASE_COLOR},${o.ERASE_COLOR})`:this.settingColorStr;for(var e=0;e<Math.max(1,Math.round(this.settingOpacity*this.ditherArr.length));e++)this.ditherCtx.fillRect(this.ditherArr[e][0],this.ditherArr[e][1],1,1);this.ditherPattern=(0,l.throwIfNull)(this.context.createPattern(this.ditherCanvas,"repeat"))}},{key:"cubicCurveOverThreshold",value:function(e,t,i,n,r){var s=(0,a.BB).Vec2.nor({x:n.x-e.x,y:n.y-e.y}),o=(0,a.BB).Vec2.nor({x:t.x-e.x,y:t.y-e.y}),l=(0,a.BB).Vec2.nor({x:n.x-i.x,y:n.y-i.y});return Math.max((0,a.BB).Vec2.dist(s,o),(0,a.BB).Vec2.dist(s,l))>r}},{key:"plotCubicBezierLine",value:function(e,t,i,n){var r=this.cubicCurveOverThreshold(e,t,i,n,.1);e.x=Math.floor(e.x),e.y=Math.floor(e.y),n.x=Math.floor(n.x),n.y=Math.floor(n.y);var s=(0,a.BB).dist(e.x,e.y,n.x,n.y);if(!r||s<7){this.plotLine(e.x,e.y,n.x,n.y,!0);return}for(var o=Math.max(2,Math.round(s/4)),l=[],h=0;h<=o;h++){var c=h/o,u=Math.pow(1-c,3),p=3*c*Math.pow(1-c,2),d=3*Math.pow(c,2)*(1-c),g=Math.pow(c,3);l.push({x:u*e.x+p*t.x+d*i.x+g*n.x,y:u*e.y+p*t.y+d*i.y+g*n.y})}for(var f=0;f<o;f++)this.plotLine(Math.round(l[f].x),Math.round(l[f].y),Math.round(l[f+1].x),Math.round(l[f+1].y),!0)}},{key:"drawDot",value:function(e,t,i,n){this.context.save(),this.settingIsEraser?(this.context.fillStyle=this.settingUseDither?this.ditherPattern:"#fff",this.settingLockLayerAlpha?this.context.globalCompositeOperation="source-atop":this.context.globalCompositeOperation="destination-out"):(this.context.fillStyle=this.settingUseDither?this.ditherPattern:this.settingColorStr,this.settingLockLayerAlpha&&(this.context.globalCompositeOperation="source-atop")),this.context.globalAlpha=this.settingUseDither?1:n,this.context.fillRect(Math.round(e+-i),Math.round(t+-i),Math.round(2*i),Math.round(2*i)),this.context.restore()}},{key:"continueLine",value:function(e,t,i,n){var r=this;null===this.bezierLine&&(this.bezierLine=new a.BB.BezierLine,this.bezierLine.add(this.lastInput.x,this.lastInput.y,0,function(){})),this.context.save();var s=function(e){var t=(0,a.BB).mix(r.lastInput2.pressure,n,e.t),i=r.settingOpacity*(r.settingHasOpacityPressure?t*t:1),s=Math.max(.5,r.settingSize*(r.settingHasSizePressure?t:1));r.drawDot(e.x,e.y,s,i)},o=function(e){r.plotCubicBezierLine(e.p1,e.p2,e.p3,e.p4)};if(1===Math.round(2*this.settingSize))null===e||null===t?this.bezierLine.addFinal(4,void 0,o):this.bezierLine.add(e,t,4,void 0,o);else{var l=i*this.settingSpacing;null===e||null===t?this.bezierLine.addFinal(l,s):this.bezierLine.add(e,t,l,s)}this.context.restore()}},{key:"plotLine",value:function(e,t,i,n,r){this.context.save(),this.settingIsEraser?(this.context.fillStyle=this.settingUseDither?this.ditherPattern:"#fff",this.settingLockLayerAlpha?this.context.globalCompositeOperation="source-atop":this.context.globalCompositeOperation="destination-out"):(this.context.fillStyle=this.settingUseDither?this.ditherPattern:this.settingColorStr,this.settingLockLayerAlpha&&(this.context.globalCompositeOperation="source-atop")),this.context.globalAlpha=this.settingUseDither?1:this.settingOpacity,e=Math.floor(e),t=Math.floor(t);for(var s=Math.abs((i=Math.floor(i))-e),a=e<i?1:-1,o=-Math.abs((n=Math.floor(n))-t),l=t<n?1:-1,h=s+o;r?r=!1:this.context.fillRect(e,t,1,1),e!==i||t!==n;){var c=2*h;c>=o&&(h+=o,e+=a),c<=s&&(h+=s,t+=l)}this.context.restore()}},{key:"startLine",value:function(e,t,i){this.historyEntry={tool:["brush","PixelBrush"],actions:[{action:"sizePressure",params:[this.settingHasSizePressure]},{action:"opacityPressure",params:[this.settingHasOpacityPressure]},{action:"setSize",params:[this.settingSize]},{action:"setSpacing",params:[this.settingSpacing]},{action:"setOpacity",params:[this.settingOpacity]},{action:"setColor",params:[this.settingColor]},{action:"setLockAlpha",params:[this.settingLockLayerAlpha]},{action:"setIsEraser",params:[this.settingIsEraser]},{action:"setUseDither",params:[this.settingUseDither]}]},this.settingUseDither&&this.updateDither(),i=Math.max(0,Math.min(1,i));var n=this.settingHasOpacityPressure?this.settingOpacity*i*i:this.settingOpacity,r=this.settingHasSizePressure?Math.max(.5,i*this.settingSize):Math.max(.5,this.settingSize);this.inputIsDrawing=!0,this.drawDot(e,t,r,n),this.lineToolLastDot=r*this.settingSpacing,this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=i,this.lastInput2=(0,a.BB).copyObj(this.lastInput),this.historyEntry.actions.push({action:"startLine",params:[e,t,i]})}},{key:"goLine",value:function(e,t,i){if(this.inputIsDrawing){this.historyEntry.actions.push({action:"goLine",params:[e,t,i]});var n=(0,a.BB).clamp(i,0,1),r=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);this.continueLine(e,t,r,this.lastInput.pressure),this.lastInput2=(0,a.BB).copyObj(this.lastInput),this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=n}}},{key:"endLine",value:function(e,t){var i,n=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);this.continueLine(null,null,n,this.lastInput.pressure),this.inputIsDrawing=!1,this.bezierLine=null,this.historyEntry&&(this.historyEntry.actions.push({action:"endLine",params:[e,t]}),null===(i=this.history)||void 0===i||i.push(this.historyEntry),this.historyEntry=void 0)}},{key:"drawLineSegment",value:function(e,t,i,n){if(this.lastInput.x=i,this.lastInput.y=n,this.lastInput.pressure=1,!this.inputIsDrawing&&void 0!==e){if(this.settingUseDither&&this.updateDither(),1===Math.round(2*this.settingSize))this.plotLine(e,t,i,n,!0);else{var r,s,a=Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2)),o=(i-e)/a,l=(n-t)/a,h=this.settingSize*this.settingSpacing;for(this.lineToolLastDot=this.settingSize*this.settingSpacing,s=this.lineToolLastDot;s<=a;s+=h)this.drawDot(e+o*s,t+l*s,this.settingSize,this.settingOpacity)}var c={tool:["brush","PixelBrush"],actions:[{action:"sizePressure",params:[this.settingHasSizePressure]},{action:"opacityPressure",params:[this.settingHasOpacityPressure]},{action:"setSize",params:[this.settingSize]},{action:"setSpacing",params:[this.settingSpacing]},{action:"setOpacity",params:[this.settingOpacity]},{action:"setColor",params:[this.settingColor]},{action:"setLockAlpha",params:[this.settingLockLayerAlpha]},{action:"setIsEraser",params:[this.settingIsEraser]},{action:"setUseDither",params:[this.settingUseDither]},{action:"drawLineSegment",params:[e,t,i,n]}]};null===(r=this.history)||void 0===r||r.push(c)}}},{key:"isDrawing",value:function(){return this.inputIsDrawing}},{key:"setColor",value:function(e){this.settingColor!==e&&(this.settingColor=e,this.settingColorStr="rgb("+this.settingColor.r+","+this.settingColor.g+","+this.settingColor.b+")")}},{key:"setContext",value:function(e){this.context=e}},{key:"setHistory",value:function(e){this.history=e}},{key:"setSize",value:function(e){this.settingSize=Math.round(2*e)/2}},{key:"setOpacity",value:function(e){this.settingOpacity=e}},{key:"setSpacing",value:function(e){this.settingSpacing=e}},{key:"sizePressure",value:function(e){this.settingHasSizePressure=e}},{key:"opacityPressure",value:function(e){this.settingHasOpacityPressure=e}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=e}},{key:"setIsEraser",value:function(e){this.settingIsEraser=e}},{key:"setUseDither",value:function(e){this.settingUseDither=e}},{key:"getSpacing",value:function(){return this.settingSpacing}},{key:"getSize",value:function(){return this.settingSize}},{key:"getOpacity",value:function(){return this.settingOpacity}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}},{key:"getIsEraser",value:function(){return this.settingIsEraser}},{key:"getUseDither",value:function(){return this.settingUseDither}}]),e}()}),n("7cUpm",function(t,n){e(t.exports,"EraserBrush",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("fohxs"),l=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.size=30,this.spacing=.4,this.opacity=1,this.useSizePressure=!0,this.useOpacityPressure=!1,this.isTransparentBG=!1,this.isBaseLayer=!1,this.context={},this.started=!1,this.lastInput={x:0,y:0,pressure:0},this.lastInput2={x:0,y:0,pressure:0}}return(0,s._)(e,[{key:"drawDot",value:function(e,t,i,n){this.context.save(),this.isBaseLayer?this.isTransparentBG?this.context.globalCompositeOperation="destination-out":this.context.globalCompositeOperation="source-atop":this.context.globalCompositeOperation="destination-out";var r=this.context.createRadialGradient(i,i,0,i,i,i),s=Math.pow(n,2);s=Math.max(0,Math.min((i-1)/i,s));var a=Math.max(0,Math.min(1,n));r.addColorStop(s,`rgba(${o.ERASE_COLOR}, ${o.ERASE_COLOR}, ${o.ERASE_COLOR}, `+(2*a-a*a)+")"),r.addColorStop(1,`rgba(${o.ERASE_COLOR}, ${o.ERASE_COLOR}, ${o.ERASE_COLOR}, 0)`),this.context.fillStyle=r,this.context.translate(e-i,t-i),this.context.fillRect(0,0,2*i,2*i),this.context.restore()}},{key:"continueLine",value:function(e,t,i){var n,r,s=this;i=Math.max(0,Math.min(1,i));var a=this.useSizePressure?Math.max(.1,i*this.size):Math.max(.1,this.size),o=Math.max(1,Math.max(.5,1-this.opacity)*a*this.spacing),l=function(e){var t=e.t;n=s.lastInput2.pressure*(1-t)+i*t,r=s.useOpacityPressure?s.opacity*n*n:s.opacity,a=s.useSizePressure?Math.max(.1,n*s.size):Math.max(.1,s.size),s.drawDot(e.x,e.y,a,r)};void 0===e||void 0===t?this.bezierLine.addFinal(o,l):this.bezierLine.add(e,t,o,l)}},{key:"startLine",value:function(e,t,i){this.historyEntry={tool:["brush","EraserBrush"],actions:[{action:"opacityPressure",params:[this.useOpacityPressure]},{action:"sizePressure",params:[this.useSizePressure]},{action:"setSize",params:[this.size]},{action:"setOpacity",params:[this.opacity]},{action:"setTransparentBG",params:[this.isTransparentBG]},{action:"startLine",params:[e,t,i]}]},this.isBaseLayer=0===this.context.canvas.index,i=Math.max(0,Math.min(1,i));var n=this.useOpacityPressure?this.opacity*i*i:this.opacity,r=this.useSizePressure?Math.max(.1,i*this.size):Math.max(.1,this.size);this.started=!0,r>1&&this.drawDot(e,t,r,n),this.lastDot=r*this.spacing,this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=i,this.lastInput2=(0,a.BB).copyObj(this.lastInput),this.bezierLine=new a.BB.BezierLine,this.bezierLine.add(e,t,0,function(){})}},{key:"goLine",value:function(e,t,i){var n;this.started&&this.historyEntry&&(null===(n=this.historyEntry.actions)||void 0===n||n.push({action:"goLine",params:[e,t,i]}),this.continueLine(e,t,this.lastInput.pressure),this.lastInput2=(0,a.BB).copyObj(this.lastInput),this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=i)}},{key:"endLine",value:function(){if(this.bezierLine&&this.continueLine(void 0,void 0,this.lastInput.pressure),this.started=!1,this.bezierLine=void 0,this.historyEntry){var e,t;null===(e=this.historyEntry.actions)||void 0===e||e.push({action:"endLine",params:[]}),null===(t=this.history)||void 0===t||t.push(this.historyEntry),this.historyEntry=void 0}}},{key:"drawLineSegment",value:function(e,t,i,n){if(this.isBaseLayer=0===this.context.canvas.index,this.lastInput.x=i,this.lastInput.y=n,!this.started&&void 0!==e){var r,s,a=Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2)),o=(i-e)/a,l=(n-t)/a,h=Math.max(1,Math.max(.5,1-this.opacity)*this.size*this.spacing);for(this.lastDot=0,s=this.lastDot;s<=a;s+=h)this.drawDot(e+o*s,t+l*s,this.size,this.opacity);var c={tool:["brush","EraserBrush"],actions:[{action:"opacityPressure",params:[this.useOpacityPressure]},{action:"sizePressure",params:[this.useSizePressure]},{action:"setSize",params:[this.size]},{action:"setOpacity",params:[this.opacity]},{action:"setTransparentBG",params:[this.isTransparentBG]},{action:"drawLineSegment",params:[e,t,i,n]}]};null===(r=this.history)||void 0===r||r.push(c)}}},{key:"isDrawing",value:function(){return this.started}},{key:"setContext",value:function(e){this.context=e}},{key:"setHistory",value:function(e){this.history=e}},{key:"setSize",value:function(e){this.size=e}},{key:"setOpacity",value:function(e){this.opacity=e}},{key:"sizePressure",value:function(e){this.useSizePressure=e}},{key:"opacityPressure",value:function(e){this.useOpacityPressure=e}},{key:"setTransparentBG",value:function(e){this.isTransparentBG=e}},{key:"getSize",value:function(){return this.size}},{key:"getOpacity",value:function(){return this.opacity}}]),e}()}),n("ltaBP",function(t,n){e(t.exports,"SmudgeBrush",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("eg83P"),l=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.context={},this.settingColor={r:0,g:0,b:0},this.settingSize=35,this.settingSpacing=.20446882736951905,this.settingOpacity=.8,this.settingHasSizePressure=!1,this.settingHasOpacityPressure=!1,this.settingLockLayerAlpha=!1,this.lineToolLastDot=0,this.lastInput={x:0,y:0,pressure:0},this.lastInput2={x:0,y:0,pressure:0},this.isDrawing=!1,this.copyImageData={},this.drawBuffer=[],this.copiedCells=[]}return(0,s._)(e,[{key:"resetRedrawBounds",value:function(){this.redrawBounds=void 0}},{key:"updateRedrawBounds",value:function(e){this.redrawBounds=(0,a.BB).updateBounds(this.redrawBounds,e)}},{key:"updateCompleteRedrawBounds",value:function(e,t,i,n){this.completeRedrawBounds=(0,a.BB).updateBounds(this.completeRedrawBounds,{x1:e,y1:t,x2:i,y2:n})}},{key:"copyFromCanvas",value:function(){var e=this,t=this.copiedCells.map(function(){return!1}),i=[],n=Math.ceil(this.copyImageData.width/256);this.redrawBounds&&(i.push({x1:Math.floor(this.redrawBounds.x1/256),y1:Math.floor(this.redrawBounds.y1/256),x2:Math.floor(this.redrawBounds.x2/256),y2:Math.floor(this.redrawBounds.y2/256)}),i.forEach(function(e){for(var i=e.x1;i<=e.x2;i++)for(var r=e.y1;r<=e.y2;r++)t[r*n+i]=!0}),t.forEach(function(t,i){if(t&&!e.copiedCells[i]){e.copiedCells[i]=!0;var r=i%n,s=Math.floor(i/n),o=(Math.min(256*r+256,e.copyImageData.width)-1)%256+1,l=(Math.min(256*s+256,e.copyImageData.height)-1)%256+1,h=(0,a.BB).canvas(o,l),c=(0,a.BB).ctx(h);c.drawImage(e.context.canvas,-(256*r),-(256*s));for(var u=c.getImageData(0,0,o,l),p=0;p<l;p++)for(var d=0,g=p*o*4,f=((256*s+p)*e.copyImageData.width+256*r)*4;d<o;d++,g+=4,f+=4)e.copyImageData.data[f]=u.data[g],e.copyImageData.data[f+1]=u.data[g+1],e.copyImageData.data[f+2]=u.data[g+2],e.copyImageData.data[f+3]=u.data[g+3]}}))}},{key:"prepDot",value:function(e,t,i,n){if(!this.lastDot){this.lastDot={x:e,y:t};return}var r=Math.round(2*(i=Math.round(i))),s=Math.round(2*i),o=function(e,t,i,n,r){if(i.x===n.x&&i.y===n.y)return null;i=(0,a.BB).copyObj(i),n=(0,a.BB).copyObj(n),r=(0,a.BB).copyObj(r);var s=0,o=0,l=0,h=0;return(i.x<0&&(h=-i.x),i.y<0&&(s=-i.y),n.x<0&&(h=Math.max(h,-n.x)),n.y<0&&(s=Math.max(s,-n.y)),i.x+r.w>e&&(o=i.x+r.w-e),i.y+r.h>t&&(l=i.y+r.h-t),n.x+r.w>e&&(o=Math.max(o,n.x+r.w-e)),n.y+r.h>t&&(l=Math.max(l,n.y+r.h-t)),i.x+=h,n.x+=h,i.y+=s,n.y+=s,r.w=r.w-h-o,r.h=r.h-s-l,r.w<=0||r.h<=0)?null:{aP:{x:i.x,y:i.y},bP:{x:n.x,y:n.y},size:{w:r.w,h:r.h}}}(this.copyImageData.width,this.copyImageData.height,{x:Math.round(this.lastDot.x-i),y:Math.round(this.lastDot.y-i)},{x:Math.round(e-i),y:Math.round(t-i)},{w:r,h:s});if(o){var l={aP:o.aP,bP:o.bP,size:o.size,brush:{center:{x:e,y:t},size:i,opacity:n,alphaLock:this.settingLockLayerAlpha}};this.updateRedrawBounds({x1:l.bP.x,y1:l.bP.y,x2:l.bP.x+2*l.brush.size,y2:l.bP.y+2*l.brush.size}),this.drawBuffer.push(l)}this.lastDot={x:e,y:t}}},{key:"continueLine",value:function(e,t,i,n){var r=this;this.drawBuffer=[],this.bezierLine||(this.bezierLine=new a.BB.BezierLine,this.bezierLine.add(this.lastInput.x,this.lastInput.y,0,function(){}));var s=[],l=function(e){var t=(0,a.BB).mix(r.lastInput2.pressure,n,e.t),i=r.settingOpacity*(r.settingHasOpacityPressure?t*t:1),o=Math.max(.1,r.settingSize*(r.settingHasSizePressure?t:1));s.push([e.x,e.y,o,i])},h=i*this.settingSpacing/3;void 0===e||void 0===t?this.bezierLine.addFinal(h,l):this.bezierLine.add(e,t,h,l);for(var c=0;c<s.length;c++){var u=s[c];this.prepDot(u[0],u[1],u[2],u[3])}this.copyFromCanvas();for(var p=0;p<this.drawBuffer.length;p++)!function(e,t){for(var i=(t=(0,a.BB).copyObj(t)).brush.size,n=t.brush.center.x,r=t.brush.center.y,s=t.aP.y*e.width+t.aP.x,l=(t.bP.y*e.width+t.bP.x-s)*4,h=0,c=i>30?1024:512,u=[],p=0;p<c;p++)u[p]=(Math.random()-.5)/1.001+.5;var d=Math.max(3,Math.min(8,t.brush.size-8)),g=function(s,l,p,g){var f,v=(0,a.BB).dist(n,r,p,g),m=1-t.brush.opacity*(1-(0,o.clamp)((v-(i-d))/d,0,1));1!==m&&(e.data[s+3]&&(e.data[l+3]?(f=e.data[s+3]<e.data[l+3]?1-e.data[s+3]/e.data[l+3]*(1-m):e.data[l+3]/e.data[s+3]*m,e.data[l]=Math.floor((0,a.BB).mix(e.data[s],e.data[l+0],f)+u[h]),e.data[l+1]=Math.floor((0,a.BB).mix(e.data[s+1],e.data[l+1],f)+u[h]),e.data[l+2]=Math.floor((0,a.BB).mix(e.data[s+2],e.data[l+2],f)+u[h]),h=(h+1)%c):(e.data[l]=e.data[s],e.data[l+1]=e.data[s+1],e.data[l+2]=e.data[s+2])),t.brush.alphaLock||(e.data[l+3]=Math.floor((0,a.BB).mix(e.data[s+3],e.data[l+3],m)+.5)))},f=4*t.bP.x,v=f+(t.size.w-1)*4;if(t.aP.y<t.bP.y)for(var m=t.size.h-1,y=t.bP.y+t.size.h-1;m>=0;m--,y--)for(var x=(m+t.bP.y)*e.width*4,b=v+x,B=v+x-l,w=t.bP.x+t.size.w-1;b>=f+x;b-=4,B-=4,w--)g(B,b,w,y);else if(t.aP.y>t.bP.y)for(var k=0,C=t.bP.y;k<t.size.h;k++,C++)for(var S=(k+t.bP.y)*e.width*4,E=v+S,L=v+S-l,A=t.bP.x+t.size.w-1;E>=f+S;E-=4,L-=4,A--)g(L,E,A,C);else if(t.aP.x<t.bP.x)for(var I=t.size.h-1,T=t.bP.y+t.size.h-1;I>=0;I--,T--)for(var P=(I+t.bP.y)*e.width*4,R=v+P,M=v+P-l,D=t.bP.x+t.size.w-1;R>=f+P;R-=4,M-=4,D--)g(M,R,D,T);else for(var O=0,_=t.bP.y;O<t.size.h;O++,_++)for(var N=(O+t.bP.y)*e.width*4,z=f+N,G=f+N-l,j=t.bP.x;z<v+N;z+=4,G+=4,j++)g(G,z,j,_)}(this.copyImageData,this.drawBuffer[p])}},{key:"startLine",value:function(e,t,i){this.historyEntry={tool:["brush","SmudgeBrush"],actions:[]},i=(0,a.BB).clamp(i,0,1);var n=this.settingHasOpacityPressure?this.settingOpacity*i*i:this.settingOpacity,r=this.settingHasSizePressure?Math.max(.1,i*this.settingSize):Math.max(.1,this.settingSize);this.lastDot=void 0,this.isDrawing=!0,this.copyImageData=new ImageData(this.context.canvas.width,this.context.canvas.height);var s=Math.ceil(this.context.canvas.width/256)*Math.ceil(this.context.canvas.height/256);this.copiedCells="0".repeat(s).split("").map(function(){return!1}),this.prepDot(e,t,r,n),this.lineToolLastDot=r*this.settingSpacing,this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=i,this.lastInput2.pressure=i,this.completeRedrawBounds=void 0}},{key:"goLine",value:function(e,t,i){if(this.isDrawing){this.resetRedrawBounds();var n=(0,a.BB).clamp(i,0,1),r=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);this.continueLine(e,t,r,this.lastInput.pressure),this.redrawBounds&&(this.context.putImageData(this.copyImageData,0,0,this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2-this.redrawBounds.x1-1,this.redrawBounds.y2-this.redrawBounds.y1-1),this.updateCompleteRedrawBounds(this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2,this.redrawBounds.y2)),this.lastInput.x=e,this.lastInput.y=t,this.lastInput2.pressure=this.lastInput.pressure,this.lastInput.pressure=n}}},{key:"endLine",value:function(){this.resetRedrawBounds();var e=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);if(this.context.save(),this.continueLine(void 0,void 0,e,this.lastInput.pressure),this.context.restore(),this.isDrawing=!1,this.bezierLine=void 0,this.redrawBounds&&(this.context.putImageData(this.copyImageData,0,0,this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2-this.redrawBounds.x1-1,this.redrawBounds.y2-this.redrawBounds.y1-1),this.updateCompleteRedrawBounds(this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2,this.redrawBounds.y2)),this.historyEntry&&this.completeRedrawBounds){var t,i=this.copyImageData;if(!(0===this.completeRedrawBounds.x1&&0===this.completeRedrawBounds.y1&&this.completeRedrawBounds.x2>=this.context.canvas.width-1&&this.completeRedrawBounds.y2>=this.context.canvas.height-1)){var n=(0,a.BB).canvas(this.completeRedrawBounds.x2-this.completeRedrawBounds.x1+1,this.completeRedrawBounds.y2-this.completeRedrawBounds.y1+1);(0,a.BB).ctx(n).drawImage(this.context.canvas,-this.completeRedrawBounds.x1,-this.completeRedrawBounds.y1),i=n}this.historyEntry.actions.push({action:"drawImage",params:[i,this.completeRedrawBounds.x1,this.completeRedrawBounds.y1]}),null===(t=this.history)||void 0===t||t.push(this.historyEntry),this.historyEntry=void 0}this.copyImageData={}}},{key:"drawImage",value:function(e,t,i){e instanceof ImageData?this.context.putImageData(e,t,i):(this.context.clearRect(t,i,e.width,e.height),this.context.drawImage(e,t,i))}},{key:"drawLineSegment",value:function(e,t,i,n){}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"setColor",value:function(e){(this.settingColor.r!==e.r||this.settingColor.g!==e.g||this.settingColor.b!==e.b)&&(this.settingColor={r:e.r,g:e.g,b:e.b})}},{key:"setContext",value:function(e){this.context=e}},{key:"setHistory",value:function(e){this.history=e}},{key:"setSize",value:function(e){this.settingSize=e}},{key:"setOpacity",value:function(e){this.settingOpacity=e}},{key:"setSpacing",value:function(e){this.settingSpacing=e}},{key:"sizePressure",value:function(e){this.settingHasSizePressure=e}},{key:"opacityPressure",value:function(e){this.settingHasOpacityPressure=e}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=e}},{key:"getSpacing",value:function(){return this.settingSpacing}},{key:"getSize",value:function(){return this.settingSize}},{key:"getOpacity",value:function(){return this.settingOpacity}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}}]),e}()}),n("6Nq1H",function(t,n){e(t.exports,"ChemyBrush",function(){return h});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("eWjiX"),l=i("fohxs"),h=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.context={},this.settingColor={},this.settingSize=.25,this.settingOpacity=1,this.settingLockLayerAlpha=!1,this.settingIsEraser=!1,this.settingMode="fill",this.settingDistort=0,this.settingXSymmetry=!1,this.settingYSymmetry=!1,this.settingGradient=!1,this.isDrawing=!1,this.copyCanvas={},this.path=[],this.minY=0,this.maxY=0}return(0,s._)(e,[{key:"updateCompleteRedrawBounds",value:function(e,t){var i={x1:e,y1:t,x2:e,y2:t};this.settingXSymmetry&&(i=(0,o.BB).updateBounds(i,{x1:-e+this.copyCanvas.width,y1:t,x2:-e+this.copyCanvas.width,y2:t})),this.settingYSymmetry&&(i=(0,o.BB).updateBounds(i,{x1:e,y1:-t+this.copyCanvas.height,x2:e,y2:-t+this.copyCanvas.height}));var n="stroke"===this.settingMode?this.settingSize+1:1;i.x1=Math.floor(i.x1-n),i.y1=Math.floor(i.y1-n),i.x2=Math.ceil(i.x2+n),i.y2=Math.ceil(i.y2+n),this.completeRedrawBounds=(0,o.BB).updateBounds(this.completeRedrawBounds,i)}},{key:"drawShape",value:function(){var e=this;this.context.save(),this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),this.context.drawImage(this.copyCanvas,0,0);var t=(0,a._)({},this.settingColor);if(this.settingIsEraser?(t.r=l.ERASE_COLOR,t.g=l.ERASE_COLOR,t.b=l.ERASE_COLOR,this.settingLockLayerAlpha?this.context.globalCompositeOperation="source-atop":this.context.globalCompositeOperation="destination-out"):this.settingLockLayerAlpha&&(this.context.globalCompositeOperation="source-atop"),this.path.length>1){var i=new Path2D;this.path.forEach(function(e,t){0===t?i.moveTo(e.x,e.y):i.lineTo(e.x,e.y)});var n=(0,o.BB).ColorConverter.toRgbaStr({r:t.r,g:t.g,b:t.b,a:this.settingOpacity});if(this.settingGradient){var r=this.path[0].x>this.path[this.path.length-1].x,s=this.context.createLinearGradient(0,r?this.minY:this.maxY,0,r?this.maxY:this.minY);s.addColorStop(0,(0,o.BB).ColorConverter.toRgbaStr({r:t.r,g:t.g,b:t.b,a:this.settingOpacity})),s.addColorStop(1,(0,o.BB).ColorConverter.toRgbaStr({r:t.r,g:t.g,b:t.b,a:0})),n=s}"fill"===this.settingMode?this.context.fillStyle=n:(this.context.lineWidth=2*this.settingSize,this.context.lineJoin="bevel",this.context.strokeStyle=n);var h=function(){"fill"===e.settingMode?e.context.fill(i):e.context.stroke(i)};h(),this.settingXSymmetry&&(this.context.save(),this.context.translate(this.context.canvas.width/2,0),this.context.scale(-1,1),this.context.translate(-this.context.canvas.width/2,0),h(),this.context.restore()),this.settingYSymmetry&&(this.context.save(),this.context.translate(0,this.context.canvas.height/2),this.context.scale(1,-1),this.context.translate(0,-this.context.canvas.height/2),h(),this.context.restore(),this.settingXSymmetry&&(this.context.save(),this.context.translate(this.context.canvas.width/2,this.context.canvas.height/2),this.context.scale(-1,-1),this.context.translate(-this.context.canvas.width/2,-this.context.canvas.height/2),h(),this.context.restore()))}this.context.restore()}},{key:"setHistory",value:function(e){this.history=e}},{key:"getSize",value:function(){return"stroke"===this.settingMode?this.settingSize:0}},{key:"setSize",value:function(e){this.settingSize=e}},{key:"getOpacity",value:function(){return this.settingOpacity}},{key:"setOpacity",value:function(e){this.settingOpacity=e}},{key:"setColor",value:function(e){this.settingColor=(0,o.BB).copyObj(e)}},{key:"setContext",value:function(e){this.context=e}},{key:"setMode",value:function(e){this.settingMode=e}},{key:"getMode",value:function(){return this.settingMode}},{key:"setDistort",value:function(e){this.settingDistort=(0,o.BB).clamp(e,0,1)}},{key:"getDistort",value:function(){return this.settingDistort}},{key:"setXSymmetry",value:function(e){this.settingXSymmetry=e}},{key:"getXSymmetry",value:function(){return this.settingXSymmetry}},{key:"setYSymmetry",value:function(e){this.settingYSymmetry=e}},{key:"getYSymmetry",value:function(){return this.settingYSymmetry}},{key:"setGradient",value:function(e){this.settingGradient=e}},{key:"getGradient",value:function(){return this.settingGradient}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=e}},{key:"getIsEraser",value:function(){return this.settingIsEraser}},{key:"setIsEraser",value:function(e){this.settingIsEraser=e}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"startLine",value:function(e,t){this.isDrawing=!0,this.path=[{x:e,y:t}],this.minY=t,this.maxY=t,this.copyCanvas=(0,o.BB).canvas(this.context.canvas.width,this.context.canvas.height),(0,o.BB).ctx(this.copyCanvas).drawImage(this.context.canvas,0,0),this.completeRedrawBounds=void 0,this.updateCompleteRedrawBounds(e,t)}},{key:"goLine",value:function(e,t){if(this.isDrawing){var i={x:e,y:t};this.settingDistort>0&&(i.x+=(Math.random()-.5)*this.settingDistort*80,i.y+=(Math.random()-.5)*this.settingDistort*80),this.minY=Math.min(this.minY,i.y),this.maxY=Math.max(this.maxY,i.y),this.path.push(i),this.updateCompleteRedrawBounds(e,t),this.drawShape()}}},{key:"endLine",value:function(){if(this.isDrawing=!1,this.completeRedrawBounds=(0,o.BB).boundsInArea(this.completeRedrawBounds,this.copyCanvas.width,this.copyCanvas.height),this.path.length>1&&this.completeRedrawBounds){var e,t=(0,o.BB).canvas(this.completeRedrawBounds.x2-this.completeRedrawBounds.x1+1,this.completeRedrawBounds.y2-this.completeRedrawBounds.y1+1);(0,o.BB).ctx(t).drawImage(this.context.canvas,-this.completeRedrawBounds.x1,-this.completeRedrawBounds.y1),null===(e=this.history)||void 0===e||e.push({tool:["brush","ChemyBrush"],actions:[{action:"drawImage",params:[t,this.completeRedrawBounds.x1,this.completeRedrawBounds.y1]}]})}this.path=[],this.copyCanvas={}}},{key:"drawImage",value:function(e,t,i){this.context.save(),this.context.clearRect(t,i,e.width,e.height),this.context.drawImage(e,t,i),this.context.restore()}},{key:"drawLineSegment",value:function(e,t,i,n){}}]),e}()}),n("3P46L",function(t,n){e(t.exports,"brushesUI",function(){return u});var r=i("cVFne"),s=i("9mjXI"),a=i("iYbUv"),o=i("brjBD"),l=i("9rc5F"),h=i("dS2qM"),c=i("vCnsd"),u={penBrush:r.penBrushUi,blendBrush:s.blendBrushUi,sketchyBrush:a.sketchyBrushUi,pixelBrush:o.pixelBrushUi,chemyBrush:c.chemyBrushUi,smudgeBrush:h.smudgeBrushUi,eraserBrush:l.eraserBrushUi}}),n("cVFne",function(n,r){e(n.exports,"penBrushUi",function(){return m});var s,a,o=i("eWjiX"),l=i("dAXbp"),h=i("7NTKy"),c=i("7bWhB"),u=i("aP0jf"),p=i("lCF5N"),d=i("dmG3C"),g=i("74D3O"),f=i("1mH1z"),v=i("iFIyy"),m=(s={image:/*@__PURE__*/t(d),tooltip:(0,f.LANG)("brush-pen"),sizeSlider:{min:.5,max:100,curve:(0,o.BB).quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1,curve:[[0,.01],[.5,.3],[1,1]]}},a=[(0,f.LANG)("brush-pen-circle"),(0,f.LANG)("brush-pen-chalk"),(0,f.LANG)("brush-pen-calligraphy"),(0,f.LANG)("brush-pen-square")],(0,f.languageStrings).subscribe(function(){s.tooltip=(0,f.LANG)("brush-pen"),a=[(0,f.LANG)("brush-pen-circle"),(0,f.LANG)("brush-pen-chalk"),(0,f.LANG)("brush-pen-calligraphy"),(0,f.LANG)("brush-pen-square")]}),s.Ui=function(e){var t,i,n,r,d=document.createElement("div"),m=new l.brushes.PenBrush;m.setHistory(e.history),e.onSizeChange(m.getSize());var y=new v.Options({optionArr:[0,1,2,3].map(function(e){var t=(0,o.BB).el({className:"dark-invert",css:{width:"31px",height:"31px",backgroundSize:"contain",margin:"2px"}}),i=(0,o.BB).canvas(70,70),n=(0,o.BB).ctx(i);return 0===e||3===e?0===e?(n.beginPath(),n.arc(35,35,30,0,2*Math.PI),n.closePath(),n.fill()):n.fillRect(5,5,60,60):1===e?n.drawImage((0,g.genBrushAlpha01)(60),5,5):2===e&&n.drawImage((0,g.genBrushAlpha02)(60),5,5),t.style.backgroundImage="url("+i.toDataURL("image/png")+")",{id:e,label:t,title:a[e]}}),initId:0,onChange:function(e){m.setAlpha(e)}}),x=new c.Checkbox({init:m.getLockAlpha(),label:(0,f.LANG)("lock-alpha"),callback:function(e){m.setLockAlpha(e)},doHighlight:!0,title:(0,f.LANG)("lock-alpha-title"),css:{display:"inline-block"}}),b=new o.BB.SplineInterpolator([[0,15],[8,7],[14,4],[30,3],[50,2.7],[100,2]]);function B(e){m.setSize(e),m.setSpacing(Math.max(2,b.interpolate(e))/15)}n=new u.KlSlider({label:(0,f.LANG)("brush-size"),width:225,height:30,min:s.sizeSlider.min,max:s.sizeSlider.max,value:m.getSize(),curve:s.sizeSlider.curve,eventResMs:h.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){B(t),e.onSizeChange(t)},formatFunc:function(e){return e<10?(0,o.BB).round(e,1):Math.round(e)},manualInputRoundDigits:1}),r=new u.KlSlider({label:(0,f.LANG)("opacity"),width:225,height:30,min:s.opacitySlider.min,max:s.opacitySlider.max,value:s.opacitySlider.max,curve:s.opacitySlider.curve,eventResMs:h.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){m.setOpacity(t),e.onOpacityChange(t)}}),t=(0,p.createPenPressureToggle)(!0,function(e){m.sizePressure(e)}),i=(0,p.createPenPressureToggle)(!1,function(e){m.opacityPressure(e)}),d.append((0,o.BB).el({content:[n.getElement(),t],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),(0,o.BB).el({content:[r.getElement(),i],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}),(0,o.BB).el({content:y.getElement(),css:{marginTop:"10px"}}),(0,o.BB).el({content:x.getElement(),css:{marginTop:"10px"}})),this.increaseSize=function(e){m.isDrawing()||n.changeSliderValue(e)},this.decreaseSize=function(e){m.isDrawing()||n.changeSliderValue(-e)},this.getSize=function(){return m.getSize()},this.setSize=function(e){B(e),n.setValue(e)},this.getOpacity=function(){return m.getOpacity()},this.setOpacity=function(e){m.setOpacity(e),r.setValue(e)},this.setColor=function(e){m.setColor(e)},this.setContext=function(e){m.setContext(e)},this.startLine=function(e,t,i){m.startLine(e,t,i)},this.goLine=function(e,t,i){m.goLine(e,t,i)},this.endLine=function(e,t){m.endLine(e,t)},this.getBrush=function(){return m},this.isDrawing=function(){return m.isDrawing()},this.getElement=function(){return d}},s)}),n("7NTKy",function(t,i){e(t.exports,"eventResMs",function(){return n});var n=20}),n("dmG3C",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"brush-pen.49a7b91e.svg"}),n("9mjXI",function(n,r){e(n.exports,"blendBrushUi",function(){return g});var s,a=i("eWjiX"),o=i("lCF5N"),l=i("7NTKy"),h=i("7bWhB"),c=i("dAXbp"),u=i("aP0jf"),p=i("eUs4x"),d=i("1mH1z"),g=(s={image:/*@__PURE__*/t(p),tooltip:(0,d.LANG)("brush-blend"),sizeSlider:{min:.5,max:100,curve:(0,a.BB).quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1}},(0,d.languageStrings).subscribe(function(){s.tooltip=(0,d.LANG)("brush-blend")}),s.Ui=function(e){var t,i,n,r,p,g,f=document.createElement("div"),v=new c.brushes.BlendBrush;function m(e){v.setSize(e)}v.setHistory(e.history),e.onSizeChange(v.getSize()),p=new u.KlSlider({label:(0,d.LANG)("brush-size"),width:225,height:30,min:s.sizeSlider.min,max:s.sizeSlider.max,value:58,curve:s.sizeSlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){m(t),e.onSizeChange(t)}}),g=new u.KlSlider({label:(0,d.LANG)("opacity"),width:225,height:30,min:s.opacitySlider.min,max:s.opacitySlider.max,value:v.getOpacity(),curve:s.opacitySlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){v.setOpacity(t),e.onOpacityChange(t)}}),(t=new u.KlSlider({label:(0,d.LANG)("brush-blending"),width:225,height:30,min:0,max:1,value:v.getBlending(),eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(e){v.setBlending(e)}})).getElement().style.marginTop="10px",i=(0,o.createPenPressureToggle)(!0,function(e){v.setSizePressure(e)}),n=(0,o.createPenPressureToggle)(!1,function(e){v.setOpacityPressure(e)}),r=new h.Checkbox({init:v.getLockAlpha(),label:(0,d.LANG)("lock-alpha"),callback:function(e){v.setLockAlpha(e)},doHighlight:!0,title:(0,d.LANG)("lock-alpha-title"),css:{marginTop:"10px",display:"inline-block"}}),f.append((0,a.BB).el({content:[p.getElement(),i],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),(0,a.BB).el({content:[g.getElement(),n],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}),t.getElement(),r.getElement()),this.increaseSize=function(e){v.getIsDrawing()||p.changeSliderValue(e)},this.decreaseSize=function(e){v.getIsDrawing()||p.changeSliderValue(-e)},this.getSize=function(){return v.getSize()},this.setSize=function(e){m(e),p.setValue(e)},this.getOpacity=function(){return v.getOpacity()},this.setOpacity=function(e){v.setOpacity(e),g.setValue(e)},this.setColor=function(e){v.setColor(e)},this.setContext=function(e){v.setContext(e)},this.startLine=function(e,t,i){v.startLine(e,t,i)},this.goLine=function(e,t,i,n){v.goLine(e,t,i,n)},this.endLine=function(){v.endLine()},this.getBrush=function(){return v},this.isDrawing=function(){return v.getIsDrawing()},this.getElement=function(){return f}},s)}),n("eUs4x",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"brush-blend.3706e8a1.svg"}),n("iYbUv",function(n,r){e(n.exports,"sketchyBrushUi",function(){return p});var s,a=i("dAXbp"),o=i("7NTKy"),l=i("aP0jf"),h=i("5oU8L"),c=i("1mH1z"),u=i("eWjiX"),p=(s={image:/*@__PURE__*/t(h),tooltip:(0,c.LANG)("brush-sketchy"),sizeSlider:{min:.5,max:10},opacitySlider:{min:.01,max:1}},(0,c.languageStrings).subscribe(function(){s.tooltip=(0,c.LANG)("brush-sketchy")}),s.Ui=function(e){var t,i,n,r,h=document.createElement("div"),p=new a.brushes.SketchyBrush;p.setHistory(e.history),e.onSizeChange(p.getSize()),n=new l.KlSlider({label:(0,c.LANG)("brush-size"),width:250,height:30,min:s.sizeSlider.min,max:s.sizeSlider.max,value:2*p.getSize(),eventResMs:o.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){p.setSize(t),e.onSizeChange(t)},formatFunc:function(e){return e<10?(0,u.BB).round(e,1):Math.round(e)},manualInputRoundDigits:1}),r=new l.KlSlider({label:(0,c.LANG)("opacity"),width:250,height:30,min:s.opacitySlider.min,max:s.opacitySlider.max,value:p.getOpacity(),eventResMs:o.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){p.setOpacity(t),e.onOpacityChange(t)}}),t=new l.KlSlider({label:(0,c.LANG)("brush-blending"),width:250,height:30,min:0,max:1,value:p.getBlending(),eventResMs:o.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(e){p.setBlending(e)}}),i=new l.KlSlider({label:(0,c.LANG)("brush-sketchy-scale"),width:250,height:30,min:1,max:20,value:p.getScale(),eventResMs:o.eventResMs,onChange:function(e){p.setScale(e)}}),r.getElement().style.marginTop="10px",t.getElement().style.marginTop="10px",i.getElement().style.marginTop="10px",h.append(n.getElement(),r.getElement(),t.getElement(),i.getElement()),this.increaseSize=function(e){p.isDrawing()||n.changeSliderValue(e)},this.decreaseSize=function(e){p.isDrawing()||n.changeSliderValue(-e)},this.getSize=function(){return p.getSize()},this.setSize=function(e){p.setSize(e),n.setValue(e)},this.getOpacity=function(){return p.getOpacity()},this.setOpacity=function(e){p.setOpacity(e),r.setValue(e)},this.setColor=function(e){p.setColor(e)},this.setContext=function(e){p.setContext(e)},this.startLine=function(e,t,i){p.startLine(e,t,i)},this.goLine=function(e,t,i){p.goLine(e,t,i,void 0)},this.endLine=function(){p.endLine()},this.getSeed=function(){return parseInt(""+p.getSeed())},this.setSeed=function(e){p.setSeed(parseInt(""+e))},this.getBrush=function(){return p},this.isDrawing=function(){return p.isDrawing()},this.getElement=function(){return h}},s)}),n("5oU8L",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"brush-sketchy.4c477c01.png"}),n("brjBD",function(n,r){e(n.exports,"pixelBrushUi",function(){return g});var s,a=i("eWjiX"),o=i("dAXbp"),l=i("7NTKy"),h=i("7bWhB"),c=i("aP0jf"),u=i("lCF5N"),p=i("Q7Itc"),d=i("1mH1z"),g=(s={image:/*@__PURE__*/t(p),tooltip:(0,d.LANG)("brush-pixel"),sizeSlider:{min:.5,max:100,curve:(0,a.BB).quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1,curve:[[0,.01],[.5,.3],[1,1]]}},(0,d.languageStrings).subscribe(function(){s.tooltip=(0,d.LANG)("brush-pixel")}),s.Ui=function(e){var t,i,n,r=document.createElement("div"),p=new o.brushes.PixelBrush;p.setHistory(e.history),e.onSizeChange(p.getSize());var g=new h.Checkbox({init:p.getLockAlpha(),label:(0,d.LANG)("lock-alpha"),callback:function(e){p.setLockAlpha(e)},doHighlight:!0,title:(0,d.LANG)("lock-alpha-title"),css:{marginRight:"10px"}}),f=new h.Checkbox({init:p.getIsEraser(),label:(0,d.LANG)("eraser"),callback:function(e){p.setIsEraser(e)},css:{marginRight:"10px"}}),v=new h.Checkbox({init:p.getUseDither(),label:(0,d.LANG)("brush-pixel-dither"),callback:function(e){p.setUseDither(e)}}),m=new a.BB.SplineInterpolator([[.5,.45],[100,4]]);function y(e){p.setSize(e),p.setSpacing(m.interpolate(e)/e)}i=new c.KlSlider({label:(0,d.LANG)("brush-size"),width:225,height:30,min:s.sizeSlider.min,max:s.sizeSlider.max,value:p.getSize(),curve:s.sizeSlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){y(t),e.onSizeChange(t)}}),n=new c.KlSlider({label:(0,d.LANG)("opacity"),width:225,height:30,min:s.opacitySlider.min,max:s.opacitySlider.max,value:s.opacitySlider.max,eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){p.setOpacity(t),e.onOpacityChange(t)}}),t=(0,u.createPenPressureToggle)(!0,function(e){p.sizePressure(e)}),r.append((0,a.BB).el({content:[i.getElement(),t],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),n.getElement()),(0,a.BB).el({parent:r,css:{display:"flex",marginTop:"10px"}}).append(g.getElement(),f.getElement(),v.getElement()),this.increaseSize=function(e){p.isDrawing()||i.changeSliderValue(e)},this.decreaseSize=function(e){p.isDrawing()||i.changeSliderValue(-e)},this.getSize=function(){return p.getSize()},this.setSize=function(e){y(e),i.setValue(2*e)},this.getOpacity=function(){return p.getOpacity()},this.setOpacity=function(e){p.setOpacity(e),n.setValue(100*e)},this.setColor=function(e){p.setColor(e)},this.setContext=function(e){p.setContext(e)},this.startLine=function(e,t,i){p.startLine(e,t,i)},this.goLine=function(e,t,i){p.goLine(e,t,i)},this.endLine=function(e,t){p.endLine(e,t)},this.getBrush=function(){return p},this.isDrawing=function(){return p.isDrawing()},this.toggleEraser=function(){f.setValue(!f.getValue()),p.setIsEraser(f.getValue())},this.getElement=function(){return r}},s)}),n("Q7Itc",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"brush-pixel.673f3e4c.svg"}),n("9rc5F",function(n,r){e(n.exports,"eraserBrushUi",function(){return g});var s,a=i("eWjiX"),o=i("dAXbp"),l=i("7NTKy"),h=i("aP0jf"),c=i("lCF5N"),u=i("7bWhB"),p=i("42pHn"),d=i("1mH1z"),g=(s={image:/*@__PURE__*/t(p),tooltip:(0,d.LANG)("eraser")+" [E]",sizeSlider:{min:.5,max:200,curve:(0,a.BB).quadraticSplineInput(.5,200,.1)},opacitySlider:{min:.01,max:1}},(0,d.languageStrings).subscribe(function(){s.tooltip=(0,d.LANG)("eraser")+" [E]"}),s.Ui=function(e){var t,i,n,r,p,g=document.createElement("div"),f=new o.brushes.EraserBrush;f.setHistory(e.history),e.onSizeChange(f.getSize());var v=!1;function m(e){f.setSize(e)}r=new h.KlSlider({label:(0,d.LANG)("brush-size"),width:225,height:30,min:s.sizeSlider.min,max:s.sizeSlider.max,value:30,curve:s.sizeSlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){m(t),e.onSizeChange(t)},formatFunc:function(e){return e<10?(0,a.BB).round(e,1):Math.round(e)},manualInputRoundDigits:1}),p=new h.KlSlider({label:(0,d.LANG)("opacity"),width:225,height:30,min:s.opacitySlider.min,max:s.opacitySlider.max,value:s.opacitySlider.max,eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){f.setOpacity(t),e.onOpacityChange(t)}}),t=(0,c.createPenPressureToggle)(!0,function(e){f.sizePressure(e)}),i=(0,c.createPenPressureToggle)(!1,function(e){f.opacityPressure(e)}),g.append((0,a.BB).el({content:[r.getElement(),t],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),(0,a.BB).el({content:[p.getElement(),i],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}})),n=new u.Checkbox({init:!1,label:(0,d.LANG)("brush-eraser-transparent-bg"),callback:function(e){v=e,f.setTransparentBG(e)},css:{marginTop:"10px"}}),g.append(n.getElement()),this.increaseSize=function(e){f.isDrawing()||r.changeSliderValue(e)},this.decreaseSize=function(e){f.isDrawing()||r.changeSliderValue(-e)},this.getSize=function(){return f.getSize()},this.setSize=function(e){m(e),r.setValue(e)},this.getOpacity=function(){return f.getOpacity()},this.setOpacity=function(e){f.setOpacity(e),p.setValue(e)},this.setColor=function(){},this.setContext=function(e){f.setContext(e)},this.startLine=function(e,t,i){f.startLine(e,t,i)},this.goLine=function(e,t,i){f.goLine(e,t,i)},this.endLine=function(){f.endLine()},this.getBrush=function(){return f},this.getIsTransparentBg=function(){return v},this.isDrawing=function(){return f.isDrawing()},this.getElement=function(){return g}},s)}),n("42pHn",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"brush-eraser.a9e10dce.svg"}),n("dS2qM",function(n,r){e(n.exports,"smudgeBrushUi",function(){return g});var s,a=i("eWjiX"),o=i("dAXbp"),l=i("7NTKy"),h=i("7bWhB"),c=i("aP0jf"),u=i("lCF5N"),p=i("cpAvL"),d=i("1mH1z"),g=(s={image:/*@__PURE__*/t(p),tooltip:(0,d.LANG)("brush-smudge"),sizeSlider:{min:.5,max:100,curve:(0,a.BB).quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1,curve:[[0,.01],[.5,.3],[1,1]]}},(0,d.languageStrings).subscribe(function(){s.tooltip=(0,d.LANG)("brush-smudge")}),s.Ui=function(e){var t,i,n,r,p=document.createElement("div"),g=new o.brushes.SmudgeBrush;g.setHistory(e.history),e.onSizeChange(g.getSize());var f=new h.Checkbox({init:g.getLockAlpha(),label:(0,d.LANG)("lock-alpha"),callback:function(e){g.setLockAlpha(e)},doHighlight:!0,title:(0,d.LANG)("lock-alpha-title")}),v=new a.BB.SplineInterpolator([[0,15],[8,7],[14,4],[30,3],[50,2.7],[100,2]]);function m(e){g.setSize(e),g.setSpacing(Math.max(2,v.interpolate(e))/15)}n=new c.KlSlider({label:(0,d.LANG)("brush-size"),width:225,height:30,min:s.sizeSlider.min,max:s.sizeSlider.max,value:g.getSize(),curve:s.sizeSlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){m(t),e.onSizeChange(t)},formatFunc:function(e){return e<10?(0,a.BB).round(e,1):Math.round(e)},manualInputRoundDigits:1}),r=new c.KlSlider({label:(0,d.LANG)("opacity"),width:225,height:30,min:s.opacitySlider.min,max:s.opacitySlider.max,value:g.getOpacity(),curve:s.opacitySlider.curve,eventResMs:l.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){g.setOpacity(t),e.onOpacityChange(t)}}),t=(0,u.createPenPressureToggle)(!1,function(e){g.sizePressure(e)}),i=(0,u.createPenPressureToggle)(!1,function(e){g.opacityPressure(e)}),p.append((0,a.BB).el({content:[n.getElement(),t],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),(0,a.BB).el({content:[r.getElement(),i],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}})),(0,a.BB).el({parent:p,css:{marginTop:"10px"}}).append(f.getElement()),this.increaseSize=function(e){g.getIsDrawing()||n.changeSliderValue(e)},this.decreaseSize=function(e){g.getIsDrawing()||n.changeSliderValue(-e)},this.getSize=function(){return g.getSize()},this.setSize=function(e){m(e),n.setValue(e)},this.getOpacity=function(){return g.getOpacity()},this.setOpacity=function(e){g.setOpacity(e),r.setValue(e)},this.setColor=function(e){g.setColor(e)},this.setContext=function(e){g.setContext(e)},this.startLine=function(e,t,i){g.startLine(e,t,i)},this.goLine=function(e,t,i){g.goLine(e,t,i)},this.endLine=function(){g.endLine()},this.getBrush=function(){return g},this.isDrawing=function(){return g.getIsDrawing()},this.getElement=function(){return p}},s)}),n("cpAvL",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"brush-smudge.45852bcd.svg"}),n("vCnsd",function(n,r){e(n.exports,"chemyBrushUi",function(){return f});var s,a=i("eWjiX"),o=i("7NTKy"),l=i("7bWhB"),h=i("dAXbp"),c=i("aP0jf"),u=i("1Sazw"),p=i("iFIyy"),d=i("cmnov"),g=i("1mH1z"),f=(s={image:/*@__PURE__*/t(u),tooltip:(0,g.LANG)("brush-chemy"),sizeSlider:{min:.25,max:25,curve:(0,a.BB).quadraticSplineInput(.25,25,.1),isDisabled:!0},opacitySlider:{min:.01,max:1}},(0,g.languageStrings).subscribe(function(){s.tooltip=(0,g.LANG)("brush-chemy")}),s.Ui=function(e){var t,i,n,r,u,f,v,m,y,x,b=document.createElement("div"),B=new h.brushes.ChemyBrush;function w(e){B.setSize(e)}B.setHistory(e.history),e.onSizeChange(B.getSize()),m=new c.KlSlider({label:(0,g.LANG)("brush-size"),width:250,height:30,min:s.sizeSlider.min,max:s.sizeSlider.max,value:B.getSize(),curve:s.sizeSlider.curve,eventResMs:o.eventResMs,isEnabled:"stroke"===B.getMode(),toDisplayValue:function(e){return 2*e},toValue:function(e){return e/2},onChange:function(t){w(t),e.onSizeChange(t)},formatFunc:function(e){return e<5?(0,a.BB).round(e,1):Math.round(e)},manualInputRoundDigits:1}),y=new c.KlSlider({label:(0,g.LANG)("opacity"),width:250,height:30,min:s.opacitySlider.min,max:s.opacitySlider.max,value:B.getOpacity(),eventResMs:o.eventResMs,toDisplayValue:function(e){return 100*e},toValue:function(e){return e/100},onChange:function(t){B.setOpacity(t),e.onOpacityChange(t)}}),(0,a.BB).css(y.getElement(),{marginTop:"10px"}),x=new l.Checkbox({init:B.getIsEraser(),label:(0,g.LANG)("eraser"),callback:function(e){B.setIsEraser(e)},css:{marginTop:"10px",marginLeft:"10px"}}),t=new l.Checkbox({init:B.getLockAlpha(),label:(0,g.LANG)("lock-alpha"),callback:function(e){B.setLockAlpha(e)},doHighlight:!0,title:(0,g.LANG)("lock-alpha-title"),css:{marginTop:"10px"}}),i=(0,a.BB).el({css:{display:"flex",marginTop:"10px"}}),n=new p.Options({optionArr:[{id:"fill",label:(0,a.BB).createSvg({class:"dark-invert",elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"#000",style:"transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(19, 19) translate(0.5px, 0.5px)",d:"M 0,0 C 1.5,0 -0.5,1 1,1"}]}),title:(0,g.LANG)("brush-chemy-fill")},{id:"stroke",label:(0,a.BB).createSvg({class:"dark-invert",elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(19, 19) translate(0.5px, 0.5px)",d:"M 0,0 C 1.5,0 -0.5,1 1,1"}]}),title:(0,g.LANG)("brush-chemy-stroke")}],initId:B.getMode(),onChange:function(t){B.setMode(t),s.sizeSlider.isDisabled="fill"===B.getMode(),m.setIsEnabled(!s.sizeSlider.isDisabled);var i=B.getSize();m.setValue(i),e.onSizeChange(i),e.onConfigChange()}}),r=new d.BoxToggle({label:(0,a.BB).createSvg({class:"dark-invert",elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 1px",d:"M 17.5,8 17.5,27"}]}),title:(0,g.LANG)("brush-chemy-mirror-x"),init:B.getXSymmetry(),onChange:function(e){B.setXSymmetry(e)}}),u=new d.BoxToggle({label:(0,a.BB).createSvg({class:"dark-invert",elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 1px",d:"M 8,17.5 27,17.5"}]}),title:(0,g.LANG)("brush-chemy-mirror-y"),init:B.getYSymmetry(),onChange:function(e){B.setYSymmetry(e)}}),f=new d.BoxToggle({label:(0,a.BB).createSvg({class:"dark-invert",elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"defs",childrenArr:[{elementType:"linearGradient",id:"gradient",x1:"0",y1:"0",x2:"0",y2:"1",childrenArr:[{elementType:"stop",offset:"0%","stop-color":"rgba(0,0,0,0)"},{elementType:"stop",offset:"100%","stop-color":"rgba(0,0,0,1)"}]}]},{elementType:"rect",fill:"url('#gradient')",x:"8",y:"8",width:"19",height:"19"}]}),title:(0,g.LANG)("brush-chemy-gradient"),init:B.getGradient(),onChange:function(e){B.setGradient(e)}}),(0,a.BB).css(r.getElement(),{marginLeft:"10px"}),v={marginLeft:"4px"},(0,a.BB).css(u.getElement(),v),(0,a.BB).css(f.getElement(),v),i.append(n.getElement(),r.getElement(),u.getElement(),f.getElement()),b.append(m.getElement(),y.getElement(),i,(0,a.BB).el({content:[t.getElement(),x.getElement()],css:{display:"flex"}})),this.increaseSize=function(e){B.getIsDrawing()||"stroke"!==B.getMode()||m.changeSliderValue(e)},this.decreaseSize=function(e){B.getIsDrawing()||"stroke"!==B.getMode()||m.changeSliderValue(-e)},this.getSize=function(){return B.getSize()},this.setSize=function(e){w(e),m.setValue(e)},this.getOpacity=function(){return B.getOpacity()},this.setOpacity=function(e){B.setOpacity(e),y.setValue(e)},this.setColor=function(e){B.setColor(e)},this.setContext=function(e){B.setContext(e)},this.startLine=function(e,t,i){B.startLine(e,t)},this.goLine=function(e,t,i,n){B.goLine(e,t)},this.endLine=function(){B.endLine()},this.getBrush=function(){return B},this.isDrawing=function(){return B.getIsDrawing()},this.toggleEraser=function(){x.setValue(!x.getValue()),B.setIsEraser(x.getValue())},this.getElement=function(){return b}},s)}),n("1Sazw",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"brush-chemy.a5a188f6.svg"}),n("h62LS",function(t,n){e(t.exports,"showIframeModal",function(){return o});var r=i("eWjiX"),s=i("dLlkc"),a=i("1mH1z");function o(e,t){if(!t&&(window.innerHeight<500||window.innerWidth<700)){window.open(e);return}var i,n=(0,r.BB).el({tagName:"iframe",custom:{src:e},css:{width:"100%",height:"100%",opacity:"0"}});setTimeout(function(){n.style.opacity=""},500);var o=(0,r.BB).el();t||(i=(0,r.BB).el({tagName:"a",parent:o,content:(0,a.LANG)("modal-new-tab"),custom:{href:"help",target:"_blank"},onClick:function(){l.close()}}),n.onload=function(){i&&n.contentWindow&&(0,r.BB).setAttributes(i,{href:""+n.contentWindow.location}),n.style.opacity=""});var l=new s.DynamicModal({title:o,content:n,width:880,isMaxHeight:!0,onClose:function(){i&&(n.src="about:blank",(0,r.BB).destroyEl(i),i=void 0)}})}}),n("fRGIf",function(t,n){e(t.exports,"RadioList",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=/*#__PURE__*/function(){function e(t){var i=this,n=t.name,s=t.init,o=t.items,l=t.ignoreFocus;(0,r._)(this,e),this.inputs=[],this.el=(0,a.BB).el({className:"kl-radio"}),o.forEach(function(e){var t=(0,a.BB).el({tagName:"label"}),r=(0,a.BB).el({tagName:"input",parent:t,custom:{name:n,value:e.value,type:"radio"}});l&&r.setAttribute("data-ignore-focus","true"),s===e.value&&(r.checked=!0),t.append(e.label),i.el.append(t),i.inputs.push(r)})}return(0,s._)(e,[{key:"getValue",value:function(){for(var e=0;e<this.inputs.length;e++)if(this.inputs[e].checked)return this.inputs[e].value;return null}},{key:"getElement",value:function(){return this.el}}]),e}()}),n("9pcu9",function(n,r){e(n.exports,"BrowserStorageUi",function(){return f});var s=i("1LaJZ"),a=i("cx0mh"),o=i("7h4XF"),l=i("2gUX3"),h=i("eWjiX"),c=i("4UZXr"),u=i("h62LS"),p=i("hrnUX"),d=i("1mH1z"),g=i("1C8RU"),f=/*#__PURE__*/function(){function e(i,n,r,o,p,f){var v,m=this;(0,a._)(this,e),this.projectStore=i,this.getProject=n,this.saveReminder=r,this.klRootEl=o,this.applyUncommitted=p,this.options=f,this.previewEl={},this.infoEl={},this.ageEl={},this.storeButtonEl={},this.clearButtonEl={},this.storeListener={},this.updateCheckerboard=function(){},this.element=(0,h.BB).el({css:{display:"grid",gridTemplateColumns:"1fr 0fr",gridTemplateRows:"0fr 0fr 0fr",gap:"0 0",gridTemplateAreas:'"title title" "preview store" "preview clear"'}});var y=(0,h.BB).el({parent:this.element,content:(0,d.LANG)("file-storage"),css:{gridArea:"title",display:"flex",margin:"-5px 0",gap:"5px"}});if(this.infoEl=(0,h.BB).el({parent:y,content:"?",className:"kl-info-btn",title:(0,d.LANG)("file-storage-about"),onClick:function(){(0,u.showIframeModal)("./help/#help-browser-storage",!1)}}),this.projectStore.isBroken()){(0,h.BB).el({parent:this.element,content:"\uD83D\uDD34 "+(0,d.LANG)("file-storage-cant-access"),css:{marginTop:"10px"}});return}this.previewEl=(0,h.BB).el({parent:this.element,title:(0,d.LANG)("file-storage-thumb-title"),className:"kl-storage-preview"}),this.ageEl=(0,h.BB).el({css:{position:"absolute",right:"1px",bottom:"1px",width:"calc(100% - 2px)",textAlign:"center",background:"rgba(0,0,0,0.7)",color:"#fff",textSize:"13px"}});var x=(null==f?void 0:f.isFocusable)?{}:{tabIndex:"-1"};this.storeButtonEl=(0,h.BB).el({parent:this.element,tagName:"button",className:"grid-button",content:(0,d.LANG)("file-storage-store"),css:{gridArea:"store"},custom:x,onClick:function(){return m.store()}}),this.clearButtonEl=(0,h.BB).el({parent:this.element,tagName:"button",className:"grid-button",content:'<img src="'+/*@__PURE__*/t(c)+'" height="20"/> '+(0,d.LANG)("file-storage-clear"),css:{gridArea:"clear"},custom:x,onClick:function(){return m.clear()}}),(null===(v=this.options)||void 0===v?void 0:v.hideClearButton)&&(this.clearButtonEl.style.visibility="hidden"),this.storeListener={onUpdate:function(e,t){m.updateThumb(e,t)}},this.projectStore.subscribe(this.storeListener),this.updateCheckerboard=function(){m.thumbnail&&(0,h.BB).css(m.thumbnail,{background:"url('"+(0,h.BB).createCheckerCanvas(4,(0,g.theme).isDark()).toDataURL("image/png")+"')"})},(0,g.theme).addIsDarkListener(this.updateCheckerboard),setInterval(function(){return m.updateAge()},6e4);var b=this;(0,s._)(function(){var e,t;return(0,l.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,b.projectStore.read()];case 1:return(e=i.sent())?b.updateThumb(e.timestamp,e.thumbnail):b.updateThumb(),[3,3];case 2:return t=i.sent(),setTimeout(function(){throw Error("storage-ui: failed initial read browser storage, "+t)},0),[3,3];case 3:return[2]}})})()}return(0,o._)(e,[{key:"updateAge",value:function(){if(this.timestamp){var e,t=new Date().getTime()-this.timestamp;t=Math.floor(t/1e3/60),e=(0,d.LANG)("file-storage-min-ago").replace("{x}",""+t),t>60&&(t=Math.floor(t/60),e=(0,d.LANG)("file-storage-hours-ago").replace("{x}",""+t),t>24&&(t=Math.floor(t/24),e=(0,d.LANG)("file-storage-days-ago").replace("{x}",""+t),t>31&&(e=(0,d.LANG)("file-storage-month-ago")))),this.ageEl.textContent=e}}},{key:"resetButtons",value:function(){this.timestamp?(this.storeButtonEl.textContent=(0,d.LANG)("file-storage-overwrite"),this.storeButtonEl.disabled=!1,this.clearButtonEl.disabled=!1):(this.storeButtonEl.textContent=(0,d.LANG)("file-storage-store"),this.storeButtonEl.disabled=!1,this.clearButtonEl.disabled=!0)}},{key:"updateThumb",value:function(e,t){this.timestamp=e,this.thumbnail=t,this.timestamp&&t?(t.classList.add("kl-storage-preview__im"),this.previewEl.innerHTML="",this.updateAge(),this.previewEl.append(t,this.ageEl)):this.previewEl.innerHTML=(0,d.LANG)("file-storage-empty"),this.resetButtons()}},{key:"store",value:function(){var e=this;return(0,s._)(function(){var t,i,n;return(0,l.__generator)(this,function(r){switch(r.label){case 0:return null===(t=(i=e).applyUncommitted)||void 0===t||t.call(i),e.storeButtonEl.textContent=(0,d.LANG)("file-storage-storing"),e.storeButtonEl.disabled=!0,e.clearButtonEl.disabled=!0,[4,new Promise(function(e){setTimeout(function(){return e(null)},20)})];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,e.projectStore.store(e.getProject())];case 3:return r.sent(),e.saveReminder.reset(),[3,5];case 4:return n=r.sent(),e.resetButtons(),(0,p.KL).popup({target:e.klRootEl,type:"error",message:`${(0,d.LANG)("file-storage-failed-1")}<ul><li>${(0,d.LANG)("file-storage-failed-2")}</li><li>${(0,d.LANG)("file-storage-failed-3")}</li><li>${(0,d.LANG)("file-storage-failed-4")}</li></ul>`,buttons:["Ok"]}),setTimeout(function(){throw Error("storage-ui: failed to store browser storage, "+n)},0),[3,5];case 5:return[2]}})})()}},{key:"clear",value:function(){var e=this;return(0,s._)(function(){var t;return(0,l.__generator)(this,function(i){switch(i.label){case 0:e.storeButtonEl.disabled=!0,e.clearButtonEl.disabled=!0,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.projectStore.clear()];case 2:return i.sent(),[3,4];case 3:return t=i.sent(),e.resetButtons(),(0,p.KL).popup({target:e.klRootEl,type:"error",message:(0,d.LANG)("file-storage-failed-clear"),buttons:["Ok"]}),setTimeout(function(){throw Error("storage-ui: failed to clear browser storage, "+t)},0),[3,4];case 4:return[2]}})})()}},{key:"getElement",value:function(){return this.element}},{key:"show",value:function(){}},{key:"hide",value:function(){}},{key:"destroy",value:function(){(0,h.BB).destroyEl(this.infoEl),(0,h.BB).destroyEl(this.storeButtonEl),(0,h.BB).destroyEl(this.clearButtonEl),(0,g.theme).removeIsDarkListener(this.updateCheckerboard),this.projectStore.unsubscribe(this.storeListener)}}]),e}()}),n("6mTnI",function(t,n){e(t.exports,"ProjectStore",function(){return p});var r=i("1LaJZ"),s=i("cx0mh"),a=i("7h4XF"),o=i("2gUX3"),l=i("3hwQ7"),h=i("9BlwZ"),c=i("6l0gQ");function u(e){return new Promise(function(t,i){e(t,i)})}var p=/*#__PURE__*/function(){function e(){var t=this;(0,s._)(this,e),this.listeners=[],this.accessHasFailed=!1,window.addEventListener("storage",function(e){if("indexedDbUpdatedAt"===e.key&&0!==t.listeners.length)try{(0,r._)(function(){var e;return(0,o.__generator)(this,function(i){switch(i.label){case 0:return[4,t.read()];case 1:return(e=i.sent())?t.emit(e.timestamp,e.thumbnail):t.emit(),[2]}})})()}catch(e){e instanceof Error&&0===e.message.indexOf("db-error")&&(t.accessHasFailed=!0)}})}return(0,a._)(e,[{key:"lowLevelStore",value:function(e){return(0,r._)(function(){return(0,o.__generator)(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t,i){(0,h.storeKlProjectObj)(e,t,i)})];case 1:return t.sent(),[2]}})})()}},{key:"lowLevelRead",value:function(){return(0,r._)(function(){return(0,o.__generator)(this,function(e){switch(e.label){case 0:return[4,u(h.getKlProjectObj)];case 1:return[2,e.sent()]}})})()}},{key:"lowLevelClear",value:function(){return(0,r._)(function(){return(0,o.__generator)(this,function(e){switch(e.label){case 0:return[4,u(h.clear)];case 1:return e.sent(),[2]}})})()}},{key:"emit",value:function(e,t){this.listeners.forEach(function(i){i.onUpdate(e,t)})}},{key:"updateTimestamp",value:function(){(0,c.LocalStorage).setItem("indexedDbUpdatedAt",""+new Date().getTime())}},{key:"read",value:function(){var e=this;return(0,r._)(function(){var t,i,n;return(0,o.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.lowLevelRead()];case 1:return t=r.sent(),[3,3];case 2:throw i=r.sent(),e.accessHasFailed=!0,Error("db-error: "+i);case 3:if(!t)return[2,void 0];r.label=4;case 4:return r.trys.push([4,6,,7]),[4,(0,l.ProjectConverter).readStorageProject(t)];case 5:return n=r.sent(),[3,7];case 6:throw Error("format-error: "+r.sent());case 7:return[2,n]}})})()}},{key:"store",value:function(e){var t=this;return(0,r._)(function(){var i,n,r,s,a;return(0,o.__generator)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),i=(0,l.ProjectConverter).createStorageProject(e),[4,t.lowLevelStore(i)];case 1:return o.sent(),[3,3];case 2:throw n=o.sent(),t.accessHasFailed=!0,Error("db-error: "+n);case 3:return[4,t.lowLevelRead()];case 4:r=o.sent(),o.label=5;case 5:return o.trys.push([5,7,,9]),[4,(0,l.ProjectConverter).readStorageProject(r)];case 6:return s=o.sent(),[3,9];case 7:return a=o.sent(),[4,t.lowLevelClear()];case 8:throw o.sent(),t.updateTimestamp(),setTimeout(function(){return t.emit()},0),Error("format-error: "+a);case 9:return t.updateTimestamp(),setTimeout(function(){return t.emit(s.timestamp,s.thumbnail)},0),[2]}})})()}},{key:"clear",value:function(){var e=this;return(0,r._)(function(){return(0,o.__generator)(this,function(t){switch(t.label){case 0:return[4,e.lowLevelClear()];case 1:return t.sent(),e.updateTimestamp(),setTimeout(function(){return e.emit()},0),[2]}})})()}},{key:"subscribe",value:function(e){this.listeners.includes(e)||this.listeners.push(e)}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.listeners.length;t++)if(e===this.listeners[t]){this.listeners.splice(t,1);return}}},{key:"isBroken",value:function(){return this.accessHasFailed}}]),e}()}),n("3hwQ7",function(t,n){e(t.exports,"ProjectConverter",function(){return p});var r=i("1LaJZ"),s=i("cx0mh"),a=i("7h4XF"),o=i("2gUX3"),l=i("eWjiX"),h=i("aSJRf"),c=i("2wCWz");function u(e){return new Promise(function(t,i){var n=new Image;try{n.src=(0,l.BB).imageBlobToUrl(e)}catch(e){i("imageBlobToUrl, "+(e instanceof Error?e.message:""));return}n.onload=function(){URL.revokeObjectURL(n.src),t(n)},n.onabort=function(){i("layer image failed loading")},n.onerror=function(){i("layer image failed loading")}})}var p=/*#__PURE__*/function(){function e(){(0,s._)(this,e)}return(0,a._)(e,null,[{key:"createThumbnail",value:function(e){var t=(0,l.BB).fitInto(e.width,e.height,240,240).width/e.width;return(0,h.drawProject)(e,t)}},{key:"createStorageProject",value:function(t){return{id:1,timestamp:new Date().getTime(),thumbnail:(0,c.base64ToBlob)(e.createThumbnail(t).toDataURL("image/png")),width:t.width,height:t.height,layers:t.layers.map(function(e){var t;if(e.image instanceof HTMLCanvasElement)t=(0,c.base64ToBlob)(e.image.toDataURL("image/png"));else throw Error("Not implemented");return{name:e.name,isVisible:e.isVisible,opacity:e.opacity,mixModeStr:e.mixModeStr,blob:t}})}}},{key:"readStorageProject",value:function(t){return(0,r._)(function(){var i,n,r;return(0,o.__generator)(this,function(s){switch(s.label){case 0:if(!t.width||!t.height||isNaN(t.width)||isNaN(t.height)||t.width<1||t.height<1)throw Error("readStorageProject invalid canvas size: "+t.width+", "+t.height);return n={width:t.width,height:t.height},[4,Promise.all(t.layers.map(function(e){return u(e.blob)}))];case 1:if(n.layers=s.sent().map(function(e,i){var n=t.layers[i];return{name:n.name,isVisible:!("isVisible"in n)||n.isVisible,opacity:n.opacity,mixModeStr:n.mixModeStr,image:e}}),i=n,!t.thumbnail)return[3,3];return[4,u(t.thumbnail)];case 2:return r=s.sent(),[3,4];case 3:r=e.createThumbnail(i),s.label=4;case 4:return[2,{project:i,timestamp:t.timestamp,thumbnail:r}]}})})()}}]),e}()}),n("2wCWz",function(t,i){e(t.exports,"base64ToBlob",function(){return n});function n(e){for(var t=e.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/),i=atob(t[3]),n=new Uint8Array(new ArrayBuffer(i.length)),r=0;r<n.length;r++)n[r]=i.charCodeAt(r);return new Blob([n],{type:t[1]})}}),n("6LAlx",function(n,r){e(n.exports,"FileUi",function(){return m});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("hrnUX"),h=i("9pcu9"),c=i("1mH1z"),u=i("cUI0B"),p=i("lamRy"),d=i("5OHFZ"),g=i("gp54e"),f=i("9amXA"),v=i("jLQSi"),m=/*#__PURE__*/function(){function e(i){var n=this;(0,s._)(this,e),this.exportType=i.exportType,this.applyUncommitted=i.applyUncommitted,this.rootEl=document.createElement("div"),setTimeout(function(){var e=document.createElement("div"),r=document.createElement("button"),s=document.createElement("button"),a=document.createElement("button"),m=document.createElement("button"),y=document.createElement("button");r.style.cssFloat="left",(0,o.BB).css(s,{cssFloat:"left",clear:"both",flexGrow:"1"}),(0,o.BB).css(y,{cssFloat:"left",clear:"both"}),r.tabIndex=-1,s.tabIndex=-1,a.tabIndex=-1,m.tabIndex=-1,y.tabIndex=-1,r.innerHTML=`<img class="dark-no-invert" src='${/*@__PURE__*/t(u)}' alt='icon' height='20'/>${(0,c.LANG)("file-new")}`,s.innerHTML=`<img src='${/*@__PURE__*/t(p)}' alt='icon' height='20'/>${(0,c.LANG)("file-save")}`,a.innerHTML=`<img src='${/*@__PURE__*/t(d)}' alt='icon' height='20'/>${(0,c.LANG)("file-share")}`,m.innerHTML=`<img style='float:left' src='${/*@__PURE__*/t(g)}' height='20' alt='icon'/>${(0,c.LANG)("file-upload")}`,y.innerHTML=`<img src='${/*@__PURE__*/t(v)}' alt='icon' height='20'/>${(0,c.LANG)("file-copy")}`,y.title=(0,c.LANG)("file-copy-title"),r.className="grid-button",s.className="grid-button grid-button--filter",a.className="grid-button",m.className="grid-button",y.className="grid-button";var x=(0,o.BB).el({className:"grid-button",css:{position:"relative",cursor:"pointer",cssFloat:"left"}}),b=(0,o.BB).el({parent:x,css:{width:"120px",height:"28px",overflow:"hidden",cursor:"pointer",position:"relative"}});n.importButton=(0,o.BB).el({tagName:"input",parent:b,css:{display:"none"}}),n.importButton.tabIndex=-1,n.importButton.type="file",n.importButton.multiple=!0,n.importButton.accept="image",n.importButton.size=71,n.importButton.onchange=function(){n.importButton&&(n.applyUncommitted(),n.importButton.files&&i.onFileSelect(n.importButton.files,"default"),n.importButton.value="")};var B=(0,o.BB).el({tagName:"button",parent:x,content:"<img class=\"dark-no-invert\" style='float:left' height='20' src='"+/*@__PURE__*/t(f)+"' alt='icon'/>"+(0,c.LANG)("file-import"),css:{width:"120px",display:"box",position:"absolute",left:"0",top:"0",cursor:"pointer"}});B.tabIndex=-1,B.onclick=function(){return n.importButton&&n.importButton.click()};var w=new l.KL.Select({optionArr:[["png","PNG"],["psd","PSD"],["layers",(0,c.LANG)("layers")+" (PNG)"]],initValue:n.exportType,onChange:function(e){n.exportType=e,i.onExportTypeChange(n.exportType),i.onSaveImageToComputer()},title:(0,c.LANG)("file-format")});(0,o.BB).css(w.getElement(),{width:"50%",height:"30px",marginTop:"10px",marginLeft:"10px"}),r.onclick=i.onNewImage,s.onclick=function(){i.onSaveImageToComputer()},a.onclick=function(){a.disabled=!0,i.onShareImage(function(){a.disabled=!1})},m.onclick=function(){return i.onUpload()},y.onclick=function(){y.blur(),i.onCopyToClipboard()};var k=(0,o.BB).el({className:"kl-toolspace-note",textContent:(0,c.LANG)("file-no-autosave"),css:{margin:"10px 10px 0 10px"}}),C=function(){var e=document.createElement("div"),t=document.createElement("div"),i=(0,o.BB).el({className:"grid-hr"});return e.append(t,i),(0,o.BB).css(t,{clear:"both"}),e};n.fileBrowserStorage=new h.BrowserStorageUi(i.projectStore,i.getProject,i.saveReminder,i.klRootEl,n.applyUncommitted),(0,o.BB).css(n.fileBrowserStorage.getElement(),{margin:"10px"});var S=(0,o.BB).el({content:[s,w.getElement()],className:"kl-file-save-row"});(0,o.BB).append(e,[k,r,x,(0,o.BB).el({css:{clear:"both"}}),S,y,(0,o.BB).canShareFiles()?a:void 0,(0,o.BB).el({css:{clear:"both"}}),C(),n.fileBrowserStorage.getElement(),C(),m]),n.rootEl.append(e)},1)}return(0,a._)(e,[{key:"refresh",value:function(){}},{key:"getElement",value:function(){return this.rootEl}},{key:"setIsVisible",value:function(e){e&&this.refresh()}},{key:"triggerImport",value:function(){this.importButton&&this.importButton.click()}}]),e}()}),n("gp54e",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"upload.5289e924.svg"}),n("2KGGj",function(t,n){e(t.exports,"FilterUi",function(){return p});var r=i("cx0mh"),s=i("7h4XF"),a=i("8N5YG"),o=i("eWjiX"),l=i("hrnUX"),h=i("1mH1z"),c=i("a5EFw"),u=i("amum4"),p=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.isInit=!1,this.klRootEl=t.klRootEl,this.klColorSlider=t.klColorSlider,this.layersUi=t.layersUi,this.getCurrentColor=t.getCurrentColor,this.getKlMaxCanvasSize=t.getKlMaxCanvasSize,this.klCanvas=t.klCanvas,this.getCurrentLayerCtx=t.getCurrentLayerCtx,this.isEmbed=t.isEmbed,this.statusOverlay=t.statusOverlay,this.onCanvasChanged=t.onCanvasChanged,this.applyUncommitted=t.applyUncommitted,this.history=t.history,this.rootEl=document.createElement("div")}return(0,s._)(e,[{key:"testHasWebGL",value:function(){return!!(0,c.getSharedFx)()}},{key:"init",value:function(){var e=this,t=l.KL.filterLib,i=[];if(!l.KL.filterLibStatus.isLoaded)throw Error("filters not loaded");var n=this.testHasWebGL();if(!n){var r=(0,o.BB).el({parent:this.rootEl,className:"kl-toolspace-note",content:"Features disabled because WebGL is failing.",css:{margin:"10px",marginBottom:"0"}});(0,o.BB).el({parent:r,tagName:"button",textContent:"Learn More",css:{marginLeft:"5px"}}).onclick=function(){(0,l.KL).popup({target:e.klRootEl,message:"<b>WebGL is not working</b>",div:(0,o.BB).el({content:`
See if your browser supports WebGL and has it enabled: <a href="https://get.webgl.org" target="_blank" rel="noopener noreferrer">get.webgl.org</a><br>
<br>
Recently (2023-05) a number of Chrome users on Chrome OS reported that WebGL fails, although it is enabled & supported.
This has been reported to Google.
`}),buttons:["Ok"],clickOnEnter:"Ok"})}}var s=function(r){var s=t[r],a=document.createElement("button"),c=(0,h.LANG)(s.lang.button),p="<img "+(s.darkNoInvert?'class="dark-no-invert"':"")+' height="20" width="18" src="'+s.icon+'" style="margin-right: 3px" alt="icon" />';a.innerHTML=p+c,a.className="grid-button grid-button--filter",(0,o.BB).css(a,{lineHeight:"20px",fontSize:"12px"}),a.tabIndex=-1;var d=(0,h.LANG)(s.lang.name),g=!0;return s.webGL&&!n&&(g=!1),g?a.onclick=function(){e.applyUncommitted();var i=function(e,t){var i;if(!("error"in t)){if("Cancel"==e){t.destroy&&t.destroy();return}try{i=t.getInput()}catch(e){if(-1!==e.message.indexOf(".getInput is not a function"))throw"filterDialog.getInput is not a function, filter: "+d;throw e}n(i)}};if(!("apply"in t[r])){(0,l.KL).popup({target:e.klRootEl,message:"Application not fully loaded",type:"error"});return}var n=function(i){!1===t[r].apply({context:e.getCurrentLayerCtx(),klCanvas:e.klCanvas,history:e.history,input:i})&&(0,l.KL).popup({target:e.klRootEl,message:"Couldn't apply the edit action",type:"error"}),t[r].updatePos&&e.onCanvasChanged(),e.layersUi.update()};if(t[r].isInstant)a.blur(),n(null),e.statusOverlay.out('"'+d+'" '+(0,h.LANG)("filter-applied"),!0);else{var o,c,p=e.klColorSlider.getSecondaryRGB(),g=void 0;try{g=t[r].getDialog({context:e.getCurrentLayerCtx(),klCanvas:e.klCanvas,maxWidth:e.getKlMaxCanvasSize(),maxHeight:e.getKlMaxCanvasSize(),currentColorRgb:{r:e.getCurrentColor().r,g:e.getCurrentColor().g,b:e.getCurrentColor().b},secondaryColorRgb:{r:p.r,g:p.g,b:p.b}})}catch(e){setTimeout(function(){throw e})}if(!g||"error"in g){(0,l.KL).popup({target:e.klRootEl,message:g?g.error:"Error: Could not perform action.",type:"error"});return}g.errorCallback=function(t){(0,l.KL).popup({target:e.klRootEl,message:"Error: Could not perform action.",type:"error"}),setTimeout(function(){throw t},0),o()};var f={};"width"in g&&(f.width=g.width+"px");var v=[(0,u.c)("b",d)];void 0!==s.lang.description&&v.push((0,u.c)({className:"kl-info-btn",onClick:function(){(0,l.KL).popup({target:e.klRootEl,message:(0,h.LANG)(s.lang.description)})},title:(0,h.LANG)(s.lang.description),noRef:!0},"?")),c=(0,u.c)(",flex,gap-5",v),(0,l.KL).popup({target:e.klRootEl,message:c,div:g.element,style:f,buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(e){i(e,g)},closeFunc:function(e){o=e}})}}:a.disabled=!0,i.push(a),a},c=function(i){Object.entries(t).forEach(function(t){var n=(0,a._)(t,2),r=n[0],o=n[1];i.includes(r)&&(!e.isEmbed||o.inEmbed)&&e.rootEl.append(s(r))})};c(["cropExtend","flip","perspective","resize","rotate","transform"]),this.rootEl.append((0,o.BB).el({className:"grid-hr"})),c(["brightnessContrast","curves","distort","hueSaturation","invert","tiltShift","toAlpha","blur","unsharpMask"]),this.rootEl.append((0,o.BB).el({className:"grid-hr"})),c(["grid","noise","pattern","vanishPoint"]),this.isInit=!0}},{key:"getElement",value:function(){return this.rootEl}},{key:"show",value:function(){this.isInit||this.init(),this.rootEl.style.display="block"}},{key:"hide",value:function(){this.rootEl.style.display="none"}}]),e}()}),n("a5EFw",function(t,n){e(t.exports,"getSharedFx",function(){return o});var r=i("6N0h0"),s=!1,a=null;function o(){if(s)return a;if(!a||a._.gl.isContextLost())try{a=(0,r.fxCanvas)()}catch(e){s=!0,a=null,setTimeout(function(){throw e})}return a}}),n("6N0h0",function(t,n){e(t.exports,"fxCanvas",function(){return w});var r=i("76shC"),s=i("fvBHO"),a=i("7dEWP"),o=i("8dg54"),l=i("1Vq1u"),h=i("h6IOH"),c=i("9uhWc"),u=i("e0olz"),p=i("2myDH"),d=i("44j8K"),g=i("kSoEy"),f=i("9WU1L"),v=i("bJIp5"),m=i("fkecp"),y=i("3u9Uu"),x=i("6lIef"),b=i("lwXVT"),B=i("eWjiX"),w=function(){function e(e){return{_:e,loadContentsOf:function(e){(0,a.setGl)(this._.gl),this._.loadContentsOf(e)},destroy:function(){(0,a.setGl)(this._.gl),this._.destroy()}}}function t(t){return e((0,o.FxTexture).fromElement(t))}function i(e,t){var i=function(){var e=a.gl.UNSIGNED_BYTE;if((0,a.gl).getExtension("WEBGL_color_buffer_float")&&(0,a.gl).getExtension("OES_texture_float")&&(0,a.gl).getExtension("OES_texture_float_linear")){var t=new o.FxTexture(100,100,a.gl.RGBA,a.gl.FLOAT);try{t.drawTo(function(){e=a.gl.FLOAT})}catch(e){}t.destroy()}return e}();this._.texture&&this._.texture.destroy(),this._.spareTexture&&this._.spareTexture.destroy(),this.width=e,this.height=t,this._.texture=new o.FxTexture(e,t,a.gl.RGBA,i),this._.spareTexture=new o.FxTexture(e,t,a.gl.RGBA,i),this._.extraTexture=this._.extraTexture||new o.FxTexture(0,0,a.gl.RGBA,i),this._.flippedShader=this._.flippedShader||new s.FxShader(null,`
uniform sampler2D texture;
varying vec2 texCoord;
void main() {
    gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));
}
        `,"flippedShader"),this._.isInitialized=!0}function n(e,t,n){return this._.isInitialized&&e._.width==this.width&&e._.height==this.height||i.call(this,t||e._.width,n||e._.height),e._.use(),this._.texture.drawTo(function(){(0,s.FxShader).getDefaultShader().drawRect()}),this}function w(){return this._.texture.use(),this._.flippedShader.drawRect(),this}function k(){var t=new o.FxTexture(this._.texture.width,this._.texture.height,a.gl.RGBA,a.gl.UNSIGNED_BYTE);return this._.texture.use(),t.drawTo(function(){(0,s.FxShader).getDefaultShader().drawRect()}),e(t)}function C(){var e=this._.texture.width,t=this._.texture.height,i=new Uint8Array(e*t*4);return this._.texture.drawTo(function(){(0,a.gl).readPixels(0,0,e,t,a.gl.RGBA,a.gl.UNSIGNED_BYTE,i)}),i}function S(e){return function(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];return(0,a.setGl)(this._.gl),e.apply(this,i)}}return function(){if(!window.WebGLRenderingContext)throw"WebGLRenderingContext not set. Browser does not support WebGL.";var e,i,s=(0,B.BB).canvas(1,1),o=(e={premultipliedAlpha:!1},i=null,["webgl","experimental-webgl","webgl2"].forEach(function(t){if(!i)try{i=s.getContext(t,e)}catch(e){}}),i);if(!o)throw"This browser does not support WebGL";return(0,a.setGl)(o),s._={gl:a.gl,isInitialized:!1,texture:null,spareTexture:null,flippedShader:null},s.texture=S(t),s.draw=S(n),s.update=S(w),s.contents=S(k),s.getPixelArray=S(C),s.brightnessContrast=S(r.brightnessContrast),s.hueSaturation=S(h.hueSaturation),s.triangleBlur=S(u.triangleBlur),s.unsharpMask=S(g.unsharpMask),s.perspective=S(m.perspective),s.matrixWarp=S(d.matrixWarp),s.tiltShift=S(p.tiltShift),s.noise=S(c.noise),s.curves=S(l.curves),s.invert=S(v.invert),s.multiplyAlpha=S(b.multiplyAlpha),s.unmultiplyAlpha=S(y.unmultiplyAlpha),s.toAlpha=S(f.toAlpha),s.distort=S(x.distort),s}}()}),n("76shC",function(t,n){e(t.exports,"brightnessContrast",function(){return l});var r=i("eWjiX"),s=i("jrAes"),a=i("fvBHO"),o=i("7dEWP"),l=function(e,t){return o.gl.brightnessContrast=o.gl.brightnessContrast||new a.FxShader(null,"        uniform sampler2D texture;        uniform float brightness;        uniform float contrast;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.rgb += brightness;            if (contrast > 0.0) {                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;            } else {                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;            }            gl_FragColor = color;        }    ","brightnessContrast"),(0,s.simpleShader).call(this,o.gl.brightnessContrast,{brightness:(0,r.BB).clamp(e,-1,1),contrast:(0,r.BB).clamp(t,-1,1)}),this}}),n("jrAes",function(t,i){e(t.exports,"simpleShader",function(){return n});function n(e,t,i,n){(i||this._.texture).use(),this._.spareTexture.drawTo(function(){e.uniforms(t).drawRect()}),this._.spareTexture.swapWith(n||this._.texture)}}),n("fvBHO",function(t,n){e(t.exports,"FxShader",function(){return c});var r,s=i("cx0mh"),a=i("7h4XF"),o=i("8N5YG"),l=i("7dEWP"),h=i("eWjiX"),c=/*#__PURE__*/function(){function e(t,i,n){if((0,s._)(this,e),this.vertexAttribute=null,this.texCoordAttribute=null,this.program=(0,h.BB).throwIfNull((0,l.gl).createProgram()),t=t||"    attribute vec2 vertex;    attribute vec2 _texCoord;    varying vec2 texCoord;    void main() {        texCoord = _texCoord;        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);    }",i=i||"    uniform sampler2D texture;    varying vec2 texCoord;    void main() {        gl_FragColor = texture2D(texture, texCoord);    }",r||(r=this.testPrecisionSupport(l.gl.HIGH_FLOAT)?"highp":this.testPrecisionSupport(l.gl.MEDIUM_FLOAT)?"mediump":"lowp"),i="precision "+r+" float;"+i,(0,l.gl).attachShader(this.program,this.compileSource(l.gl.VERTEX_SHADER,t,n+"(vertex)")),(0,l.gl).attachShader(this.program,this.compileSource(l.gl.FRAGMENT_SHADER,i,n+"(fragment)")),(0,l.gl).linkProgram(this.program),!(0,l.gl).getProgramParameter(this.program,l.gl.LINK_STATUS))throw"link error: "+(0,l.gl).getProgramInfoLog(this.program)}return(0,a._)(e,[{key:"compileSource",value:function(e,t,i){var n=(0,h.BB).throwIfNull((0,l.gl).createShader(e));if((0,l.gl).shaderSource(n,t.replace(/#define.*/,"")),(0,l.gl).compileShader(n),!(0,l.gl).getShaderParameter(n,l.gl.COMPILE_STATUS))throw"compile error: "+i+" - "+(0,l.gl).getShaderInfoLog(n);return n}},{key:"testPrecisionSupport",value:function(e){var t=(0,l.gl).getShaderPrecisionFormat(l.gl.FRAGMENT_SHADER,e);return null!==t&&0!==t.precision}},{key:"destroy",value:function(){(0,l.gl).deleteProgram(this.program),this.program=null}},{key:"uniforms",value:function(e){var t=this;return(0,l.gl).useProgram(this.program),Object.entries(e).forEach(function(e){var i=(0,o._)(e,2),n=i[0],r=i[1],s=(0,l.gl).getUniformLocation(t.program,n);if(null!==s){if("[object Array]"==Object.prototype.toString.call(r))switch(r.length){case 1:(0,l.gl).uniform1fv(s,new Float32Array(r));break;case 2:(0,l.gl).uniform2fv(s,new Float32Array(r));break;case 3:(0,l.gl).uniform3fv(s,new Float32Array(r));break;case 4:(0,l.gl).uniform4fv(s,new Float32Array(r));break;case 9:(0,l.gl).uniformMatrix3fv(s,!1,new Float32Array(r));break;case 16:(0,l.gl).uniformMatrix4fv(s,!1,new Float32Array(r));break;default:throw"dont't know how to load uniform \""+n+'" of length '+r.length}else if("[object Number]"==Object.prototype.toString.call(r))(0,l.gl).uniform1f(s,r);else throw'attempted to set uniform "'+n+'" to invalid value '+(r||"undefined").toString()}}),this}},{key:"textures",value:function(e){var t=this;return(0,l.gl).useProgram(this.program),Object.entries(e).forEach(function(e){var i=(0,o._)(e,2),n=i[0],r=i[1];(0,l.gl).uniform1i((0,l.gl).getUniformLocation(t.program,n),r)}),this}},{key:"drawRect",value:function(e,t,i,n){var r,s=(0,l.gl).getParameter(l.gl.VIEWPORT);t=t!==r?(t-s[1])/s[3]:0,e=e!==r?(e-s[0])/s[2]:0,i=i!==r?(i-s[0])/s[2]:1,n=n!==r?(n-s[1])/s[3]:1,(l.gl.vertexBuffer===r||null===l.gl.vertexBuffer)&&(l.gl.vertexBuffer=(0,h.BB).throwIfNull((0,l.gl).createBuffer())),(0,l.gl).bindBuffer(l.gl.ARRAY_BUFFER,l.gl.vertexBuffer),(0,l.gl).bufferData(l.gl.ARRAY_BUFFER,new Float32Array([e,t,e,n,i,t,i,n]),l.gl.STATIC_DRAW),null==l.gl.texCoordBuffer&&(l.gl.texCoordBuffer=(0,h.BB).throwIfNull((0,l.gl).createBuffer()),(0,l.gl).bindBuffer(l.gl.ARRAY_BUFFER,l.gl.texCoordBuffer),(0,l.gl).bufferData(l.gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),l.gl.STATIC_DRAW)),null==this.vertexAttribute&&(this.vertexAttribute=(0,l.gl).getAttribLocation(this.program,"vertex"),(0,l.gl).enableVertexAttribArray(this.vertexAttribute)),null==this.texCoordAttribute&&(this.texCoordAttribute=(0,l.gl).getAttribLocation(this.program,"_texCoord"),(0,l.gl).enableVertexAttribArray(this.texCoordAttribute)),(0,l.gl).useProgram(this.program),(0,l.gl).bindBuffer(l.gl.ARRAY_BUFFER,l.gl.vertexBuffer),(0,l.gl).vertexAttribPointer(this.vertexAttribute,2,l.gl.FLOAT,!1,0,0),(0,l.gl).bindBuffer(l.gl.ARRAY_BUFFER,l.gl.texCoordBuffer),(0,l.gl).vertexAttribPointer(this.texCoordAttribute,2,l.gl.FLOAT,!1,0,0),(0,l.gl).drawArrays(l.gl.TRIANGLE_STRIP,0,4)}}],[{key:"getDefaultShader",value:function(){return l.gl.defaultShader=l.gl.defaultShader||new e,l.gl.defaultShader}}]),e}()}),n("7dEWP",function(t,i){var n;function r(e){n=e}e(t.exports,"gl",function(){return n}),e(t.exports,"setGl",function(){return r})}),n("8dg54",function(t,n){e(t.exports,"FxTexture",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("7dEWP"),o=i("eWjiX"),l=/*#__PURE__*/function(){function e(t,i,n,s){(0,r._)(this,e),this.gl=a.gl,this.id=(0,o.BB).throwIfNull((0,a.gl).createTexture()),this.width=t,this.height=i,this.format=n,this.type=s,this.canvas=null,(0,a.gl).bindTexture(a.gl.TEXTURE_2D,this.id),(0,a.gl).texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_MAG_FILTER,a.gl.LINEAR),(0,a.gl).texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_MIN_FILTER,a.gl.LINEAR),(0,a.gl).texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_WRAP_S,a.gl.CLAMP_TO_EDGE),(0,a.gl).texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_WRAP_T,a.gl.CLAMP_TO_EDGE),t&&i&&(0,a.gl).texImage2D(a.gl.TEXTURE_2D,0,this.format,t,i,0,this.format,this.type,null)}return(0,s._)(e,[{key:"loadContentsOf",value:function(e){this.width=e.width||e.videoWidth,this.height=e.height||e.videoHeight,(0,a.gl).bindTexture(a.gl.TEXTURE_2D,this.id),(0,a.gl).texImage2D(a.gl.TEXTURE_2D,0,this.format,this.format,this.type,e)}},{key:"initFromBytes",value:function(e,t,i){this.width=e,this.height=t,this.format=a.gl.RGBA,this.type=a.gl.UNSIGNED_BYTE,(0,a.gl).bindTexture(a.gl.TEXTURE_2D,this.id),(0,a.gl).texImage2D(a.gl.TEXTURE_2D,0,a.gl.RGBA,e,t,0,a.gl.RGBA,this.type,new Uint8Array(i))}},{key:"destroy",value:function(){(0,a.gl).deleteTexture(this.id),this.id=null}},{key:"use",value:function(e){(0,a.gl).activeTexture(a.gl.TEXTURE0+(e||0)),(0,a.gl).bindTexture(a.gl.TEXTURE_2D,this.id)}},{key:"unuse",value:function(e){(0,a.gl).activeTexture(a.gl.TEXTURE0+(e||0)),(0,a.gl).bindTexture(a.gl.TEXTURE_2D,null)}},{key:"ensureFormat",value:function(e,t,i,n){(e!=this.width||t!=this.height||i!=this.format||n!=this.type)&&(this.width=e,this.height=t,this.format=i,this.type=n,(0,a.gl).bindTexture(a.gl.TEXTURE_2D,this.id),(0,a.gl).texImage2D(a.gl.TEXTURE_2D,0,this.format,e,t,0,this.format,this.type,null))}},{key:"ensureFormatViaTexture",value:function(e){this.ensureFormat(e.width,e.height,e.format,e.type)}},{key:"drawTo",value:function(e){if(a.gl.framebuffer=a.gl.framebuffer||(0,a.gl).createFramebuffer(),(0,a.gl).bindFramebuffer(a.gl.FRAMEBUFFER,a.gl.framebuffer),(0,a.gl).framebufferTexture2D(a.gl.FRAMEBUFFER,a.gl.COLOR_ATTACHMENT0,a.gl.TEXTURE_2D,this.id,0),(0,a.gl).checkFramebufferStatus(a.gl.FRAMEBUFFER)!==a.gl.FRAMEBUFFER_COMPLETE)throw Error("incomplete framebuffer");(0,a.gl).viewport(0,0,this.width,this.height),e(),(0,a.gl).bindFramebuffer(a.gl.FRAMEBUFFER,null)}},{key:"swapWith",value:function(e){var t;t=e.id,e.id=this.id,this.id=t,t=e.width,e.width=this.width,this.width=t,t=e.height,e.height=this.height,this.height=t,t=e.format,e.format=this.format,this.format=t}}],[{key:"fromElement",value:function(t){var i=new e(0,0,a.gl.RGBA,a.gl.UNSIGNED_BYTE);return i.loadContentsOf(t),i}}]),e}()}),n("1Vq1u",function(t,n){e(t.exports,"curves",function(){return l});var r=i("fRyi0"),s=i("7dEWP"),a=i("fvBHO"),o=i("jrAes"),l=function(e,t,i){for(var n=(0,r.splineInterpolate)(e),l=(0,r.splineInterpolate)(t),h=(0,r.splineInterpolate)(i),c=[],u=0;u<256;u++)c.splice(c.length,0,n[u],l[u],h[u],255);return this._.extraTexture.initFromBytes(256,1,c),this._.extraTexture.use(1),s.gl.curves=s.gl.curves||new a.FxShader(null,"        uniform sampler2D texture;        uniform sampler2D map;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.r = texture2D(map, vec2(color.r)).r;            color.g = texture2D(map, vec2(color.g)).g;            color.b = texture2D(map, vec2(color.b)).b;            gl_FragColor = color;        }    ","curves"),(0,s.gl).curves.textures({map:1}),(0,o.simpleShader).call(this,s.gl.curves,{}),this}}),n("fRyi0",function(t,n){e(t.exports,"splineInterpolate",function(){return s});var r=i("eWjiX");function s(e){for(var t=new r.BB.SplineInterpolator(e),i=[],n=0;n<256;n++)i.push((0,r.BB).clamp(Math.floor(256*t.interpolate(n/255)),0,255));return i}}),n("h6IOH",function(t,n){e(t.exports,"hueSaturation",function(){return l});var r=i("7dEWP"),s=i("fvBHO"),a=i("jrAes"),o=i("eWjiX"),l=function(e,t){return r.gl.hueSaturation=r.gl.hueSaturation||new s.FxShader(null,"        uniform sampler2D texture;        uniform float hue;        uniform float saturation;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);                        /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */            float angle = hue * 3.14159265;            float s = sin(angle), c = cos(angle);            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;            float len = length(color.rgb);            color.rgb = vec3(                dot(color.rgb, weights.xyz),                dot(color.rgb, weights.zxy),                dot(color.rgb, weights.yzx)            );                        /* saturation adjustment */            float average = (color.r + color.g + color.b) / 3.0;            if (saturation > 0.0) {                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));            } else {                color.rgb += (average - color.rgb) * (-saturation);            }                        gl_FragColor = color;        }    ","hueSaturation"),(0,a.simpleShader).call(this,r.gl.hueSaturation,{hue:(0,o.BB).clamp(e,-1,1),saturation:(0,o.BB).clamp(t,-1,1)}),this}}),n("9uhWc",function(n,r){e(n.exports,"noise",function(){return h});var s=i("7dEWP"),a=i("fvBHO"),o=i("jrAes"),l=i("3TO8L"),h=function(e,i,n,r,h,c,u,p,d,g,f,v,m){return s.gl.noise=s.gl.noise||new a.FxShader(null,/*@__PURE__*/t(l).replace(/#define.*/,""),"noise"),(0,o.simpleShader).call(this,s.gl.noise,{seed:e||0,type:i,scale:[n[0],n[1]],offset:r,octaves:h,samples:c,texSize:[this.width,this.height],peaks:u,brightness:p,contrast:d,isReversed:g?1:0,colA:f?[f.r/255,f.g/255,f.b/255]:[0,0,0],colB:v?[v.r/255,v.g/255,v.b/255]:[1,1,1],channels:"rgb"===m?0:1}),this}}),n("3TO8L",function(e,t){e.exports="#define GLSLIFY 1\nuniform sampler2D texture;\nvarying vec2 texCoord;\nuniform vec2 texSize;\n\nuniform float seed;\nuniform float type;\nuniform vec2 scale;\nuniform vec2 offset;\nuniform float octaves;\nuniform float samples;\n\nuniform float peaks;\nuniform float contrast;\nuniform float brightness;\nuniform float isReversed;\n\nuniform vec3 colA;\nuniform vec3 colB;\n\nuniform float channels; // 0 - rgb, 1 - alpha\n\n// fbm, cellular_noise based on\n// https://github.com/Gonkee/Gonkees-Shaders\n// MIT, Copyright © Gonkee\n\n// hash & simplex based on\n// https://www.shadertoy.com/view/Msf3WH\n// MIT, Copyright © 2013 Inigo Quilez\n// https://www.youtube.com/c/InigoQuilez\n// https://iquilezles.org\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nfloat value_noise(vec2 coord){\n    return rand(floor(coord) / 100.0);\n}\n\nfloat cellular_noise(vec2 coord) {\n    vec2 i = floor(coord);\n    vec2 f = fract(coord);\n\n    float min_dist = 99999.0;\n    for (float x = -1.0; x <= 1.0; x++) {\n        for (float y = -1.0; y <= 1.0; y++) {\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\n            min_dist = min(min_dist, dist);\n        }\n    }\n    return min_dist;\n}\n\n// ---------- Simplex Alternative ---------------------\n\nvec3 hash(vec3 p)\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\n, dot(p, vec3(269.5, 183.3, 246.1))\n, dot(p, vec3(113.5, 271.9, 124.6)))\n;return fract(sin(p)*43758.5453123)*2.-1.; }\n\nmat3 hash(mat3 p)\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\n\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\n\n//return noiseGra13dx as .x, and its derivatives as .yzw\n// https://www.shadertoy.com/view/llByD1\nvec3 noiseGra13dx(in vec3 x) {\n    vec3 p=floor(x), w=fract(x)\n    #if 1\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\n    #else\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\n    #endif\n    //gradients\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\n    //projections\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\n    //interpolations\n    float g=dot(G, w), f=dot(F, w-vec3(1));\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\n    mat3 S=D-mat3(G, G, G), W=D-E;\n    a.x=(a.x+a.y+a.z)+f-g;\n    ;float b=u.x*u.y*u.z;\n\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\n    return 0.5 + 0.5 * result.xxx;\n}\n\nfloat fbm(vec2 coord) {\n    float normalize_factor = 0.0;\n    float value = 0.0;\n    float scale = 0.5;\n\n    for (float i = 0.0; i < 7.0; i++){\n        if (i < octaves) {\n            if (type == 0.0) {\n                value += value_noise(coord) * scale;\n            } else if (type == 1.0) {\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\n            } else if (type == 2.0) {\n                value += cellular_noise(coord) * scale;\n            }\n            normalize_factor += scale;\n            coord *= 2.0;\n            scale *= 0.5;\n        }\n    }\n    return value / normalize_factor;\n}\n\nfloat render (vec2 pos) {\n    float result = fbm(pos);\n    //\n\n    if (peaks > 0.0) {\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\n    }\n\n    result += brightness;\n    if (contrast > 0.0) {\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\n    } else if (contrast < 0.0) {\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\n    }\n\n    if (isReversed == 1.0) {\n        result = 1.0 - result;\n    }\n    return result;\n}\n\nvoid main() {\n    vec4 color;\n\n    vec2 seedOffset;\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\n\n    float val = 0.0;\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\n\n    if (samples == 1.0) {\n        val = render(basePos);\n\n    }/* else if (samples == 4.0) {\n        for (float i = 0.0; i < 2.0; i++) {\n            for (float e = 0.0; e < 2.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\n            }\n        }\n        val /= 4.0;\n\n    }*/ else if (samples == 16.0) {\n        for (float i = 0.0; i < 4.0; i++) {\n            for (float e = 0.0; e < 4.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\n            }\n        }\n        val /= 16.0;\n    }\n\n    if (channels == 0.0) {\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\n    } else {\n        gl_FragColor = vec4(vec3(1.0), val);\n    }\n}"}),n("e0olz",function(t,n){e(t.exports,"triangleBlur",function(){return l});var r=i("7dEWP"),s=i("fvBHO"),a=i("4urfK"),o=i("jrAes"),l=function(e){return r.gl.triangleBlur=r.gl.triangleBlur||new s.FxShader(null,"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        "+a.randomShaderFunc+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta * percent);                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;        }    ","triangleBlur"),(0,o.simpleShader).call(this,r.gl.triangleBlur,{delta:[e/this.width,0]}),(0,o.simpleShader).call(this,r.gl.triangleBlur,{delta:[0,e/this.height]}),this}}),n("4urfK",function(t,i){e(t.exports,"randomShaderFunc",function(){return n});var n="    float random(vec3 scale, float seed) {        /* use the fragment position for a different seed per-pixel */        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);    }"}),n("2myDH",function(t,n){e(t.exports,"tiltShift",function(){return l});var r=i("7dEWP"),s=i("fvBHO"),a=i("4urfK"),o=i("jrAes"),l=function(e,t,i,n,l,h){r.gl.tiltShift=r.gl.tiltShift||new s.FxShader(null,"        uniform sampler2D texture;        uniform float blurRadius;        uniform float gradientRadius;        uniform vec2 start;        uniform vec2 end;        uniform vec2 delta;        uniform vec2 texSize;        varying vec2 texCoord;        "+a.randomShaderFunc+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;            for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;        }    ","tiltShift");var c=i-e,u=n-t,p=Math.sqrt(c*c+u*u);return(0,o.simpleShader).call(this,r.gl.tiltShift,{blurRadius:l,gradientRadius:h,start:[e,t],end:[i,n],delta:[c/p,u/p],texSize:[this.width,this.height]}),(0,o.simpleShader).call(this,r.gl.tiltShift,{blurRadius:l,gradientRadius:h,start:[e,t],end:[i,n],delta:[-u/p,c/p],texSize:[this.width,this.height]}),this}}),n("44j8K",function(t,n){e(t.exports,"matrixWarp",function(){return l});var r=i("7dEWP"),s=i("gDZ5A"),a=i("jrAes"),o=i("5taNf"),l=function(e,t,i){if(r.gl.matrixWarp=r.gl.matrixWarp||(0,s.warpShader)("        uniform mat3 matrix;        uniform bool useTextureSpace;    ","        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;        vec3 warp = matrix * vec3(coord, 1.0);        coord = warp.xy / warp.z;        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;    "),4==(e=e.flat()).length)e=[e[0],e[1],0,e[2],e[3],0,0,0,1];else if(9!=e.length)throw"can only warp with 2x2 or 3x3 matrix";return(0,a.simpleShader).call(this,r.gl.matrixWarp,{matrix:t?(0,o.getInverse)(e):e,texSize:[this.width,this.height],useTextureSpace:i?1:0}),this}}),n("gDZ5A",function(t,n){e(t.exports,"warpShader",function(){return s});var r=i("fvBHO");function s(e,t){return new r.FxShader(null,e+"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;    void main() {        vec2 coord = texCoord * texSize;        "+t+"        gl_FragColor = texture2D(texture, coord / texSize);        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);        if (coord != clampedCoord) {            /* fade to transparent if we are outside the image */            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));        }    }","warp")}}),n("5taNf",function(t,i){function n(e,t,i,n,r,s,a,o){var l=i-r,h=n-s,c=a-r,u=o-s,p=e-i+r-a,d=t-n+s-o,g=l*u-c*h,f=(p*u-c*d)/g,v=(l*d-p*h)/g;return[i-e+f*i,n-t+f*n,f,a-e+v*a,o-t+v*o,v,e,t,1]}function r(e){var t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8],c=t*s*h-t*a*l-i*r*h+i*a*o+n*r*l-n*s*o;return[(s*h-a*l)/c,(n*l-i*h)/c,(i*a-n*s)/c,(a*o-r*h)/c,(t*h-n*o)/c,(n*r-t*a)/c,(r*l-s*o)/c,(i*o-t*l)/c,(t*s-i*r)/c]}function s(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}e(t.exports,"getSquareToQuad",function(){return n}),e(t.exports,"getInverse",function(){return r}),e(t.exports,"multiply",function(){return s})}),n("kSoEy",function(t,n){e(t.exports,"unsharpMask",function(){return o});var r=i("7dEWP"),s=i("fvBHO"),a=i("jrAes"),o=function(e,t){return r.gl.unsharpMask=r.gl.unsharpMask||new s.FxShader(null,"        uniform sampler2D blurredTexture;        uniform sampler2D originalTexture;        uniform float strength;        uniform float threshold;        varying vec2 texCoord;        void main() {            vec4 blurred = texture2D(blurredTexture, texCoord);            vec4 original = texture2D(originalTexture, texCoord);            gl_FragColor = mix(blurred, original, 1.0 + strength);        }    ","unsharpMask"),this._.extraTexture.ensureFormatViaTexture(this._.texture),this._.texture.use(),this._.extraTexture.drawTo(function(){(0,s.FxShader).getDefaultShader().drawRect()}),this._.extraTexture.use(1),this.triangleBlur(e),(0,r.gl).unsharpMask.textures({originalTexture:1}),(0,a.simpleShader).call(this,r.gl.unsharpMask,{strength:t}),this._.extraTexture.unuse(1),this}}),n("9WU1L",function(t,n){e(t.exports,"toAlpha",function(){return o});var r=i("7dEWP"),s=i("fvBHO"),a=i("jrAes"),o=function(e,t){return r.gl.toAlpha=r.gl.toAlpha||new s.FxShader(null,"    uniform bool isInverted;    uniform vec4 replace;    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        float alpha = (color.r + color.g + color.b) / 3.0;        if (isInverted) alpha = 1.0 - alpha;        alpha = min(color.a, alpha);        if (replace.a > 0.0) color = replace;        gl_FragColor = vec4(color.r, color.g, color.b, alpha);    }","toAlpha"),(0,a.simpleShader).call(this,r.gl.toAlpha,{isInverted:e?1:0,replace:t?[t.r/255,t.g/255,t.b/255,t.a]:[0,0,0,0],texSize:[this.width,this.height]}),this}}),n("bJIp5",function(t,n){e(t.exports,"invert",function(){return o});var r=i("7dEWP"),s=i("fvBHO"),a=i("jrAes"),o=function(){return r.gl.invert=r.gl.invert||new s.FxShader(null,"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        color.rgb = 1.0 - color.rgb;        gl_FragColor = color;    }","invert"),(0,a.simpleShader).call(this,r.gl.invert,{texSize:[this.width,this.height]}),this}}),n("fkecp",function(t,n){e(t.exports,"perspective",function(){return a});var r=i("bX4ja"),s=i("5taNf"),a=function(e,t){var i=(0,s.getSquareToQuad).apply(void 0,(0,r._)(t)),n=(0,s.getSquareToQuad).apply(void 0,(0,r._)(e)),a=(0,s.multiply)((0,s.getInverse)(i),n);return this.matrixWarp(a)}}),n("3u9Uu",function(t,n){e(t.exports,"unmultiplyAlpha",function(){return o});var r=i("7dEWP"),s=i("fvBHO"),a=i("jrAes"),o=function(){return r.gl.unmultiplyAlpha=r.gl.unmultiplyAlpha||new s.FxShader(null,"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        if(color.a > 0.0) {            color.rgb /= color.a;        }        gl_FragColor = color;    }","unmultiplyAlpha"),(0,a.simpleShader).call(this,r.gl.unmultiplyAlpha,{texSize:[this.width,this.height]}),this}}),n("6lIef",function(t,n){e(t.exports,"distort",function(){return o});var r=i("7dEWP"),s=i("gDZ5A"),a=i("jrAes"),o=function(e){return r.gl.distort=r.gl.distort||(0,s.warpShader)(`
    uniform float stepSize;
    uniform vec2 scale;
    uniform vec2 strength;
    uniform vec2 phase;
    uniform float type;
    uniform vec2 offset;
`,`
    const float PI = 3.14159265;
    float x = coord.x + offset.x;
    float y = coord.y + offset.y;
    if (stepSize > 1.0) {
        x = floor(x / stepSize) * stepSize;
        y = floor(y / stepSize) * stepSize;
    }
    float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;
    float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;
    if (type == 0.0) {
        coord.y += distortX;
        coord.x += distortY;
    } else if (type == 1.0) {
        coord.x += distortX;
        coord.y += distortY;
    } else if (type == 2.0) {
        x -= offset.x;
        y -= offset.y;
        gl_FragColor = texture2D(texture, vec2(x, y) / texSize);
        coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;
        coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;
    }
    coord.x = mod(coord.x, texSize.x);
    coord.y = mod(coord.y, texSize.y);
`),(0,a.simpleShader).call(this,r.gl.distort,{stepSize:e.stepSize,type:e.distortType,scale:[e.scale.x,e.scale.y],strength:[e.strength.x,e.strength.y],phase:[e.phase.x,e.phase.y],offset:[e.offset.x,e.offset.y],texSize:[this.width,this.height]}),this}}),n("lwXVT",function(t,n){e(t.exports,"multiplyAlpha",function(){return o});var r=i("7dEWP"),s=i("fvBHO"),a=i("jrAes"),o=function(){return r.gl.multiplyAlpha=r.gl.multiplyAlpha||new s.FxShader(null,"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        color.rgb *= color.a;        gl_FragColor = color;    }","multiplyAlpha"),(0,a.simpleShader).call(this,r.gl.multiplyAlpha,{texSize:[this.width,this.height]}),this}}),n("5ENro",function(n,r){e(n.exports,"imgurUpload",function(){return d});var s=i("1LaJZ"),a=i("2gUX3"),o=i("eWjiX"),l=i("hrnUX"),h=i("2wCWz"),c=i("1mH1z"),u=i("bxAIr");function p(){return(p=(0,s._)(function(e,i,n,r,s){var l,p,d,g,f,v,m,y,x;return(0,a.__generator)(this,function(a){switch(a.label){case 0:if(l=(0,h.base64ToBlob)(e.toDataURL("image/"+r)),!(p=window.open()))throw Error("could not create new tab");d=p.document.createElement("div"),(g=p.document.createElement("img")).src=/*@__PURE__*/t(u),d.append(g),(0,o.BB).css(g,{filter:"invert(1)"}),(0,o.BB).css(p.document.body,{backgroundColor:"#121211",backgroundImage:"linear-gradient(#2b2b2b 0%, #121211 50%)",backgroundRepeat:"no-repeat"}),(f=p.document.createElement("div")).style.marginTop="10px",d.append(f),f.textContent=(0,c.LANG)("upload-uploading"),p.document.body.append(d),(0,o.BB).css(d,{marginLeft:"auto",marginRight:"auto",marginTop:"100px",fontFamily:"system-ui, sans-serif",fontSize:"20px",textAlign:"center",transition:"opacity 0.3s ease-in-out",opacity:"0",color:"#ccc"}),setTimeout(function(){d.style.opacity="1"},20),a.label=1;case 1:return a.trys.push([1,3,,4]),(m=new FormData).append("title",i),m.append("description",n),m.append("image",l),[4,fetch("https://api.imgur.com/3/image",{method:"POST",headers:{Authorization:"Client-ID "+s},body:m})];case 2:return v=a.sent(),[3,4];case 3:throw y=a.sent(),p.close(),y;case 4:if(!v.ok)throw p.close(),Error();return[4,v.json()];case 5:return x=a.sent().data,p.location.href=x.link.replace(/\.(jpg|png)/,""),[2,x]}})})).apply(this,arguments)}function d(e,t,i,n){if(!n)throw Error("imgur key missing");var r,h=(0,o.BB).el({tagName:"input"});h.type="text",h.value=(0,c.LANG)("upload-title-untitled");var u=(0,o.BB).el({tagName:"textarea",custom:{rows:"2"},css:{width:"100%",maxWidth:"100%"}}),d=(0,o.BB).el({textContent:(0,c.LANG)("upload-name")+":"}),g=(0,o.BB).el({textContent:(0,c.LANG)("upload-caption")+":",css:{marginTop:"10px"}}),f=(0,o.BB).el({content:`<br/><a href="https://imgur.com/tos" target="_blank" rel="noopener noreferrer">${(0,c.LANG)("terms-of-service")}</a>`}),v=new l.KL.RadioList({name:"filetype",init:"jpeg",items:[{label:"JPG",value:"jpeg"},{label:"PNG",value:"png"}],ignoreFocus:!0});(0,o.BB).css(v.getElement(),{marginBottom:"10px"});var m=(0,o.BB).el(),y=(0,o.BB).el({className:"info-hint",textContent:(0,c.LANG)("upload-link-notice")});m.append(y,v.getElement(),d,h,g,u,f),(0,l.KL).popup({target:t,message:`<b>${(0,c.LANG)("upload-title")}</b>`,type:"upload",div:m,buttons:[(0,c.LANG)("upload-submit"),"Cancel"],clickOnEnter:(0,c.LANG)("upload-submit"),primaries:[(0,c.LANG)("upload-submit")],autoFocus:(0,c.LANG)("upload-submit"),callback:(r=(0,s._)(function(r){var s;return(0,a.__generator)(this,function(a){switch(a.label){case 0:if(!(r===(0,c.LANG)("upload-submit")||"Yes"===r||"Ok"===r))return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(e,t,i,n,r){return p.apply(this,arguments)}(e.getCompleteCanvas(1),h.value,u.value,v.getValue(),n)];case 2:return s=a.sent(),(0,l.KL).popup({target:t,type:"ok",message:`<h3>${(0,c.LANG)("upload-success")}</h3><br>${(0,c.LANG)("upload-delete")}<br><a target='_blank' rel="noopener noreferrer" href='https://imgur.com/delete/${s.deletehash}'>imgur.com/delete/${s.deletehash}</a><br><br>`,buttons:["Ok"]}),i.reset(),[3,4];case 3:return a.sent(),(0,l.KL).popup({target:t,type:"error",message:(0,c.LANG)("upload-failed"),buttons:["Ok"]}),[3,4];case 4:return[2]}})}),function(e){return r.apply(this,arguments)})})}}),n("bxAIr",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"loading.7ff8a2ac.gif"}),n("5ngYX",function(t,n){e(t.exports,"SaveReminder",function(){return u});var r=i("cx0mh"),s=i("7h4XF"),a=i("hrnUX"),o=i("eWjiX"),l=i("1mH1z"),h=i("9pcu9"),c="kl-save-reminder",u=/*#__PURE__*/function(){function e(t,i,n,s,a,o){var l,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"Klecks";(0,r._)(this,e),this.showReminder=t,this.changeTitle=i,this.onSaveAsPsd=n,this.isDrawing=s,this.projectStore=a,this.getProject=o,this.title=h,this.history={},this.lastSavedAt=0,this.lastReminderShownAt=0,this.setting=null!==(l=localStorage.getItem(c))&&void 0!==l?l:"20min"}return(0,s._)(e,[{key:"showPopup",value:function(){var e=this;if(!this.projectStore||!this.getProject)throw Error("projectStore and getProject need to be set");var t=Math.round((performance.now()-this.lastSavedAt)/1e3/60),i=(0,o.BB).el();i.append((0,o.BB).el({content:(0,l.LANG)("save-reminder-text",{a:"<strong>"+t,b:"</strong>"}),css:{marginBottom:"20px"}}));var n=(0,o.BB).el({css:{borderTop:"1px solid #aaa",margin:"0 -20px",padding:"20px"}}),r=(0,o.BB).el({css:{borderTop:"1px solid #aaa",margin:"0 -20px",padding:"20px",paddingBottom:"0"}});i.append(n,r);var s=(0,o.BB).el({tagName:"button",className:"kl-button",content:(0,l.LANG)("save-reminder-save-psd"),onClick:function(){return e.onSaveAsPsd()}});n.append(s,(0,o.BB).el({content:(0,l.LANG)("save-reminder-psd-layers"),css:{marginTop:"10px"}}));var c=new h.BrowserStorageUi(this.projectStore,this.getProject,this,document.body,function(){},{hideClearButton:!0,isFocusable:!0});r.append(c.getElement()),(0,a.KL).popup({target:document.body,message:`<b>${(0,l.LANG)("save-reminder-title")}</b>`,div:i,ignoreBackground:!0,callback:function(){c.destroy(),(0,o.BB).destroyEl(s),e.closeFunc=void 0,e.lastReminderShownAt=performance.now()},closeFunc:function(t){e.closeFunc=t}}),setTimeout(function(){s.focus()},40)}},{key:"init",value:function(){var e=this;function t(e){e.preventDefault(),e.returnValue=""}void 0===this.lastSavedHistoryIndex&&(this.lastSavedHistoryIndex=this.history.getCurrentIndex(),this.lastReminderShownAt=performance.now(),this.lastSavedAt=performance.now(),this.showReminder&&setInterval(function(){if("visible"===document.visibilityState){var t=Math.abs(e.history.getCurrentIndex()-e.lastSavedHistoryIndex),i=6e4*({"20min":20,"40min":40,disabled:0})[e.setting];i>0&&0===(0,a.KL).dialogCounter.get()&&!e.isDrawing()&&e.lastReminderShownAt+i<performance.now()&&t>=100&&e.showPopup()}},5e3),this.history.addListener(function(){var i=e.history.getCurrentIndex();e.lastSavedHistoryIndex!==i?window.onbeforeunload=t:window.onbeforeunload=null}),this.changeTitle&&document.addEventListener("visibilitychange",function(){if("visible"===document.visibilityState)document.title=e.title,clearInterval(e.unsavedInterval);else{var t=e.history.getCurrentIndex();if(e.lastSavedHistoryIndex!==t){document.title=(0,l.LANG)("unsaved")+" - "+e.title;var i=0;e.unsavedInterval=setInterval(function(){1==(i=(i+1)%2)?document.title=(0,l.LANG)("unsaved")+" · "+e.title:document.title=(0,l.LANG)("unsaved")+" - "+e.title},18e4)}}}))}},{key:"reset",value:function(){void 0!==this.lastSavedHistoryIndex&&(this.lastSavedHistoryIndex=this.history.getCurrentIndex(),this.lastReminderShownAt=performance.now(),this.lastSavedAt=performance.now(),window.onbeforeunload=null,this.closeFunc&&this.closeFunc())}},{key:"getSetting",value:function(){return this.setting}},{key:"setSetting",value:function(e){this.setting=e,localStorage.setItem(c,this.setting)}},{key:"setHistory",value:function(e){this.history=e}}]),e}()}),n("eyygR",function(t,n){e(t.exports,"SaveToComputer",function(){return c});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("hrnUX"),l=i("6hBII"),h=i("hAS38"),c=/*#__PURE__*/function(){function e(t,i,n){(0,r._)(this,e),this.saveReminder=t,this.getExportType=i,this.klCanvas=n}return(0,s._)(e,[{key:"saveImage",value:function(e,t,i){var n=e.toDataURL(i).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);if(!n)throw Error("saveImage: empty parts");for(var r=atob(n[3]),s=new Uint8Array(new ArrayBuffer(r.length)),a=0;a<s.length;a++)s[a]=r.charCodeAt(a);var o=new Blob([s],{type:n[1]});(0,l.saveAs)(o,t)}},{key:"save",value:function(e){if(this.saveReminder.reset(),e||(e=this.getExportType()),"png"===e){var t=(0,a.BB).getDate()+h.klConfig.filenameBase+".png",i=this.klCanvas.getCompleteCanvas(1);try{this.saveImage(i,t,"image/png")}catch(e){throw alert("could not save"),Error("failed png export")}}else if("layers"===e)for(var n=(0,a.BB).getDate()+h.klConfig.filenameBase,r=this.klCanvas.getLayersFast(),s=0;s<r.length;s++){var c=r[s],u=[n,"_",(""+(s+1)).padStart(2,"0"),"_",c.name,".","png"];this.saveImage(c.canvas,u.join(""),"image/png")}else if("psd"===e){for(var p=this.klCanvas.getLayersFast(),d={width:this.klCanvas.getWidth(),height:this.klCanvas.getHeight(),children:[],canvas:this.klCanvas.getCompleteCanvas(1)},g=0;g<p.length;g++){var f=p[g];d.children.push({name:f.name,hidden:!f.isVisible,opacity:f.opacity,canvas:f.canvas,blendMode:(0,o.KL).PSD.blendKlToPsd(f.mixModeStr),left:0,top:0})}(0,o.KL).loadAgPsd().then(function(e){var t=new Blob([e.writePsdBuffer(d)],{type:"application/octet-stream"});(0,l.saveAs)(t,(0,a.BB).getDate()+h.klConfig.filenameBase+".psd")}).catch(function(){alert("Error: failed to load PSD library")})}}}]),e}()}),n("6hBII",function(t,i){e(t.exports,"saveAs",function(){return n});function n(e,t){var i=document.createElementNS("http://www.w3.org/1999/xhtml","a");i.download=t,i.rel="noopener",i.href=URL.createObjectURL(e),setTimeout(function(){return URL.revokeObjectURL(i.href)},4e4),setTimeout(function(){return i.click()},0)}}),n("hAS38",function(t,i){e(t.exports,"klConfig",function(){return n});var n={filenameBase:"Klecks"}}),n("7pyBK",function(t,n){e(t.exports,"BrushSettingService",function(){return a});var r=i("cx0mh"),s=i("7h4XF"),a=/*#__PURE__*/function(){function e(t){if((0,r._)(this,e),this.subscriberArr=[],this.onSetColor=t.onSetColor,this.onSetSize=t.onSetSize,this.onSetOpacity=t.onSetOpacity,this.onGetColor=t.onGetColor,this.onGetSize=t.onGetSize,this.onGetOpacity=t.onGetOpacity,this.onGetSliderConfig=t.onGetSliderConfig,e.instance)throw Error("BrushSettingService already instantiated");e.instance=this}return(0,s._)(e,[{key:"emit",value:function(e,t){for(var i=0;i<this.subscriberArr.length;i++)this.subscriberArr[i]!==t&&this.subscriberArr[i](e)}},{key:"emitColor",value:function(e,t){this.emit({type:"color",value:e},t)}},{key:"emitSize",value:function(e,t){this.emit({type:"size",value:e},t)}},{key:"emitOpacity",value:function(e,t){this.emit({type:"opacity",value:e},t)}},{key:"emitSliderConfig",value:function(e,t){this.emit({type:"sliderConfig",value:e},t)}},{key:"setColor",value:function(e,t){this.onSetColor(e),this.emitColor(e,t)}},{key:"setSize",value:function(e,t){this.onSetSize(e)}},{key:"setOpacity",value:function(e,t){this.onSetOpacity(e)}},{key:"getColor",value:function(){return this.onGetColor()}},{key:"getSize",value:function(){return this.onGetSize()}},{key:"getOpacity",value:function(){return this.onGetOpacity()}},{key:"getSliderConfig",value:function(){return this.onGetSliderConfig()}},{key:"subscribe",value:function(e){this.subscriberArr.includes(e)||this.subscriberArr.push(e)}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.subscriberArr.length;t++)e===this.subscriberArr[t]&&(this.subscriberArr.splice(t,1),t--)}}]),e}()}),n("byS9j",function(n,r){e(n.exports,"SettingsUi",function(){return B});var s=i("cx0mh"),a=i("7h4XF"),o=i("bX4ja"),l=i("eWjiX"),h=i("1mH1z"),c=i("hrnUX"),u=i("fgfvl"),p=i("k9cTC"),d=i("jXqqY"),g=i("4813m"),f=i("6l0gQ"),v=i("1C8RU"),m=i("7jh4K"),y=i("2H29m"),x=i("amum4"),b=i("2MaaK"),B=/*#__PURE__*/function(){function e(i){var n=i.onLeftRight,r=i.saveReminder,a=i.customAbout;(0,s._)(this,e);var B=function(e){return"dark"===e?"⬛ "+(0,h.LANG)("theme-dark"):"⬜ "+(0,h.LANG)("theme-light")},w=function(){return(0,l.BB).el({tagName:"a",content:(0,h.LANG)("licenses"),onClick:function(){return(0,y.showLicensesDialog)()}})};this.rootEl=(0,l.BB).el({css:{margin:"10px"}});var k=(0,h.languageStrings).getAutoLanguage(),C=(0,l.BB).el({parent:this.rootEl,content:(0,l.BB).el({content:(0,h.LANG)("settings-language")+":",css:{marginRight:"5px",marginBottom:"2px"}}),css:{display:"flex",alignItems:"center",flexWrap:"wrap"}}),S=[["auto",(0,h.LANG)("auto")+` \u{2192} ${k.name} (${k.code})`]].concat((0,o._)((0,u.languages).map(function(e){return[e.code,e.name+` (${e.code})`]}))),E=new c.KL.Select({initValue:(0,m.nullToUndefined)((0,f.LocalStorage).getItem(h.LS_LANGUAGE_KEY)?(0,f.LocalStorage).getItem(h.LS_LANGUAGE_KEY):"auto"),optionArr:S,onChange:function(e){"auto"===e?(0,f.LocalStorage).removeItem(h.LS_LANGUAGE_KEY):(0,f.LocalStorage).setItem(h.LS_LANGUAGE_KEY,e),L.style.display="block"}});(0,l.BB).css(E.getElement(),{flexGrow:"1"});var L=(0,l.BB).el({className:"kl-toolspace-note",content:(0,h.LANG)("settings-language-reload"),css:{display:"none",marginTop:"5px",flexGrow:"1"}});C.append(E.getElement(),L);var A=new c.KL.Select({optionArr:[["auto",(0,h.LANG)("auto")+" → "+B((0,v.theme).getMediaQueryTheme())],["light",B("light")],["dark",B("dark")]],initValue:(0,v.theme).getStoredTheme()||"auto",onChange:function(e){(0,v.theme).setStoredTheme("auto"===e?void 0:e)}});if((0,l.BB).css(A.getElement(),{flexGrow:"1"}),(0,m.addIsDarkListener)(function(){A.updateLabel("auto",(0,h.LANG)("auto")+" → "+B((0,v.theme).getMediaQueryTheme()))}),(0,l.BB).el({parent:this.rootEl,content:[(0,l.BB).el({content:(0,h.LANG)("settings-theme")+":",css:{marginRight:"5px",marginBottom:"2px"}}),A.getElement()],css:{marginTop:"15px",display:"flex",alignItems:"center",flexWrap:"wrap"}}),r){var I=new c.KL.Select({optionArr:[["20min",(0,h.LANG)("x-minutes",{x:"20"})],["40min",(0,h.LANG)("x-minutes",{x:"40"})],["disabled","⚠️ "+(0,h.LANG)("settings-save-reminder-disabled")]],initValue:r.getSetting(),onChange:function(e){if("disabled"!==e){r.setSetting(e);return}var t=(0,h.LANG)("settings-save-reminder-confirm-disable");(0,b.showModal)({target:document.body,message:"⚠️"+(0,h.LANG)("settings-save-reminder-confirm-title"),div:(0,x.c)("",[(0,x.c)(".info-hint",(0,h.LANG)("settings-save-reminder-confirm-a")),(0,h.LANG)("settings-save-reminder-confirm-b")]),buttons:[t,"Cancel"],callback:function(i){i===t?r.setSetting(e):I.setValue(r.getSetting())}})}});I.getElement().style.flexGrow="1",this.rootEl.append((0,x.c)(",flex,items-center,gap-5,mt-15,flexWrap",[(0,h.LANG)("settings-save-reminder-label")+":",I.getElement()]))}(0,l.BB).el({tagName:"button",parent:this.rootEl,content:'<img height="20" width="18" src="'+/*@__PURE__*/t(g)+'" alt="icon" style="margin-right: 5px"/>'+(0,h.LANG)("switch-ui-left-right"),onClick:function(){return n()},css:{marginTop:"15px"},custom:{tabIndex:"-1"}}),this.rootEl.append((0,l.BB).el({className:"grid-hr",css:{margin:"10px 0"}})),a?(this.rootEl.append(a),a.innerHTML||(0,l.BB).el({parent:a,css:{textAlign:"center"}}).append((0,l.BB).el({content:`<img alt="icon" height="20" style="vertical-align:middle" src="${/*@__PURE__*/t(p)}"> <a href="https://bitbof.com" target="_blank" tabIndex="-1">bitbof</a> \xa9 2024<br>`}),w())):(0,l.BB).el({parent:this.rootEl,css:{textAlign:"center"},content:`
<img alt="Klecks" class="dark-invert" height="25" src="${/*@__PURE__*/t(d)}"><br>
<img alt="icon" height="20" style="vertical-align:middle" src="${/*@__PURE__*/t(p)}"> <a href="https://bitbof.com" target="_blank" tabIndex="-1">bitbof</a> \xa9 2024<br>`}).append(w(),document.createTextNode(" | "),(0,l.BB).el({tagName:"a",content:(0,h.LANG)("donate"),custom:{href:"https://kleki.com/donate/",target:"_blank"}}),document.createTextNode(" | "),(0,l.BB).el({tagName:"a",content:(0,h.LANG)("source-code"),custom:{href:"https://klecks.org",target:"_blank"}})),window.addEventListener("storage",function(e){e.key===h.LS_LANGUAGE_KEY&&E.setValue((0,m.nullToUndefined)((0,f.LocalStorage).getItem(h.LS_LANGUAGE_KEY)?(0,f.LocalStorage).getItem(h.LS_LANGUAGE_KEY):"auto"))})}return(0,a._)(e,[{key:"getElement",value:function(){return this.rootEl}}]),e}()}),n("k9cTC",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"bitbof-logo.bc5e3ed5.svg"}),n("4813m",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"ui-swap-lr.7f474f51.svg"}),n("2H29m",function(t,n){e(t.exports,"showLicensesDialog",function(){return h});var r=i("amum4"),s=i("jXowp"),a=i("dLlkc"),o=i("eWjiX"),l=i("1mH1z");function h(){var e=(0,s.css)({display:"flex",flexDirection:"column",gap:"10px","details > div":{padding:"10px",boxShadow:"0 0 0 1px",marginTop:"5px",fontFamily:"monospace",background:"#aaa2",overflow:"hidden"},summary:{cursor:"pointer",userSelect:"none"}}),t=(0,r.c)("."+e,(0,l.LANG)("loading")),n=(0,r.c)("."+e,(0,l.LANG)("loading")),h=(0,r.c)(",flex,flexCol,gap-10",[t,n]);new a.DynamicModal({title:(0,o.BB).el({content:(0,l.LANG)("licenses")}),content:(0,o.BB).el({content:h,css:{height:"100%",overflowY:"auto",padding:"10px",boxSizing:"border-box"}}),width:800,isMaxHeight:!0,onClose:function(){"#licenses"===window.location.hash&&history.replaceState("",document.title,window.location.pathname+window.location.search)}}),i("9I1T6").then(function(e){t.innerHTML="",e.licenses.forEach(function(e){t.append((0,r.c)("details",[(0,r.c)("summary",e.title),(0,r.c)("",e.full.replace(/\n/g,"<br>"))]))})}),i("iaSvl").then(function(e){n.innerHTML="",e.fontLicenses.forEach(function(e){n.append((0,r.c)("details",[(0,r.c)("summary","Font: "+e.title),(0,r.c)("",e.full.replace(/\n/g,"<br>"))]))})})}}),n("9I1T6",function(e,t){e.exports=i("ih7W4")(i("2evKT").resolve("62mlz")).then(function(){return i("17YSH")})}),n("iaSvl",function(e,t){e.exports=i("ih7W4")(i("2evKT").resolve("76QQo")).then(function(){return i("evhrb")})}),n("iVHpg",function(t,n){e(t.exports,"ToolspaceScroller",function(){return h});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("1mH1z"),l=i("i8UFO"),h=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.toolspace=t.toolspace,this.upBtn=(0,a.BB).el({parent:this.toolspace,title:(0,o.LANG)("scroll"),className:"kl-scroller",css:{top:"0",transform:"rotate(180deg)"}}),this.downBtn=(0,a.BB).el({parent:this.toolspace,title:(0,o.LANG)("scroll"),className:"kl-scroller",css:{bottom:"0"}}),this.updateUiState(t.uiState),new a.BB.PointerListener({target:this.upBtn,onPointer:function(e){"pointerdown"===e.type&&(i.upInterval=setInterval(function(){i.toolspace.scrollBy(0,-13),i.update()},20)),"pointerup"===e.type&&(clearInterval(i.upInterval),setTimeout(function(){i.upInterval=null,i.update()},50))}}),new a.BB.PointerListener({target:this.downBtn,onPointer:function(e){"pointerdown"===e.type&&(i.downInterval=setInterval(function(){i.toolspace.scrollBy(0,13),i.update()},20)),"pointerup"===e.type&&(clearInterval(i.downInterval),setTimeout(function(){i.downInterval=null,i.update()},50))}});var n=function(e){i.toolspace.scrollBy(0,Math.round(.7*e.deltaY)),i.update()};this.upBtn.addEventListener("wheel",n,{passive:!1}),this.downBtn.addEventListener("wheel",n,{passive:!1}),this.update(),new MutationObserver(function(){return i.update()}).observe(this.toolspace,{attributes:!0,childList:!0,subtree:!0}),window.addEventListener("resize",function(){return i.update()}),(0,l.dialogCounter).subscribe(function(e){i.upBtn.style.opacity=e>=1?"0":"",i.downBtn.style.opacity=e>=1?"0":""})}return(0,s._)(e,[{key:"update",value:function(){var e=this.upBtn.style.display,t=this.downBtn.style.display;this.toolspace.scrollHeight>this.toolspace.offsetHeight+3?(this.upInterval||(e=0===this.toolspace.scrollTop?"none":"block"),this.downInterval||(t=this.toolspace.scrollTop+this.toolspace.offsetHeight+1>=this.toolspace.scrollHeight?"none":"block")):(e="none",t="none"),e!==this.upBtn.style.display&&(this.upBtn.style.display=e),t!==this.downBtn.style.display&&(this.downBtn.style.display=t)}},{key:"updateUiState",value:function(e){(0,a.BB).css(this.upBtn,{left:"left"===e?"0":"",right:"right"===e?"0":""}),(0,a.BB).css(this.downBtn,{left:"left"===e?"0":"",right:"right"===e?"0":""})}}]),e}()}),n("5Gc7M",function(t,n){e(t.exports,"GradientUi",function(){return u});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("aP0jf"),l=i("1mH1z"),h=i("7bWhB"),c=i("iFIyy"),u=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.settings={opacity:1,type:"linear",doLockAlpha:!1,doSnap:!1,isReversed:!1,isEraser:!1},this.colorSlider=t.colorSlider,this.rootEl=(0,a.BB).el({css:{margin:"10px"}}),this.isVisible=!0,this.colorDiv=(0,a.BB).el({parent:this.rootEl,css:{marginBottom:"10px"}}),this.iconArr=[],[0,1,2].forEach(function(){var e=(0,a.BB).el({className:"dark-invert",css:{width:"33px",height:"33px",borderRadius:"3px",margin:"1px"}});i.iconArr.push(e)}),this.updateIcons();var n=new c.Options({optionArr:[{id:"linear",label:this.iconArr[0],title:(0,l.LANG)("gradient-linear")},{id:"linear-mirror",label:this.iconArr[1],title:(0,l.LANG)("gradient-linear-mirror")},{id:"radial",label:this.iconArr[2],title:(0,l.LANG)("gradient-radial")}],initId:"linear",onChange:function(e){i.settings.type=e}});this.rootEl.append(n.getElement());var s=new o.KlSlider({label:(0,l.LANG)("opacity"),width:250,height:30,min:.01,max:1,value:this.settings.opacity,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e},onChange:function(e){i.settings.opacity=e}});(0,a.BB).css(s.getElement(),{marginTop:"10px"}),this.rootEl.append(s.getElement());var u=(0,a.BB).el({parent:this.rootEl,css:{display:"flex",alignItems:"center",marginTop:"10px"}}),p=new h.Checkbox({init:!1,label:(0,l.LANG)("reverse"),callback:function(e){i.settings.isReversed=e,i.updateIcons()},css:{width:"50%"}}),d=new h.Checkbox({init:!1,label:(0,l.LANG)("angle-snap"),title:(0,l.LANG)("angle-snap-title"),callback:function(e){i.settings.doSnap=e},css:{width:"50%"}});u.append(p.getElement(),d.getElement());var g=(0,a.BB).el({parent:this.rootEl,css:{display:"flex",alignItems:"center",marginTop:"10px"}}),f=new h.Checkbox({init:this.settings.isEraser,label:(0,l.LANG)("eraser"),callback:function(e){i.settings.isEraser=e},css:{width:"50%"}}),v=new h.Checkbox({init:!1,label:(0,l.LANG)("lock-alpha"),title:(0,l.LANG)("lock-alpha-title"),callback:function(e){i.settings.doLockAlpha=e},doHighlight:!0,css:{width:"50%"}});g.append(f.getElement(),v.getElement())}return(0,s._)(e,[{key:"updateIcons",value:function(){var e=this.settings.isReversed?"#0000":"#000",t=this.settings.isReversed?"#000":"#0000";this.iconArr[0].style.background=`linear-gradient(${e}, ${t})`,this.iconArr[1].style.background=`linear-gradient(${t}, ${e}, ${t})`,this.iconArr[2].style.background=`radial-gradient(${e}, ${t})`}},{key:"getElement",value:function(){return this.rootEl}},{key:"setIsVisible",value:function(e){this.isVisible=!!e,this.rootEl.style.display=e?"block":"none",e&&this.colorDiv.append(this.colorSlider.getElement(),this.colorSlider.getOutputElement())}},{key:"getSettings",value:function(){return(0,a.BB).copyObj(this.settings)}}]),e}()}),n("gWfkn",function(t,n){e(t.exports,"KlHistory",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("bX4ja"),o=i("7jh4K"),l=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.changeCount=0,this.entries=[],this.listeners=[],this.pauseStack=0,this.maxUndos=20,this.minIndex=-1,this.currentIndex=-1,this.beforePushListeners=[]}return(0,s._)(e,[{key:"broadcast",value:function(e){var t=this;setTimeout(function(){for(var i=0;i<t.listeners.length;i++)t.listeners[i](e);t.changeCount++},1)}},{key:"emitBeforePush",value:function(e){this.beforePushListeners.forEach(function(t){return t(e)})}},{key:"pause",value:function(e){e?this.pauseStack++:this.pauseStack=Math.max(0,this.pauseStack-1)}},{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"addBeforePushListener",value:function(e){this.beforePushListeners.includes(e)||this.beforePushListeners.push(e)}},{key:"removeBeforePushListener",value:function(e){for(var t=0;t<this.beforePushListeners.length;t++)if(this.beforePushListeners[t]===e){this.beforePushListeners.splice(t,1);return}}},{key:"push",value:function(e){if(!(this.pauseStack>0)){for(this.emitBeforePush(e);this.currentIndex<this.entries.length-1;)this.entries.pop();var t=this.entries[this.entries.length-1];if(t&&"canvas"===e.tool[0]&&"canvas"===t.tool[0]&&"layerOpacity"===e.action&&"layerOpacity"===t.action&&t.params[0]===e.params[0]){this.entries[this.entries.length-1]=e,this.changeCount++;return}if(t&&"canvas"===e.tool[0]&&"canvas"===t.tool[0]&&"setLayerIsVisible"===e.action&&"setLayerIsVisible"===t.action&&t.params[0]===e.params[0]&&t.params[1]!=e.params[1]){this.entries.pop(),this.currentIndex--,this.changeCount++,this.broadcast(null);return}if("focusLayer"===e.action&&t&&"focusLayer"===t.action){this.entries[this.entries.length-1]=e,this.changeCount++;return}if(this.entries[this.entries.length]=e,this.currentIndex=this.entries.length-1,e.isFree||e.isHidden){this.broadcast(null);return}var i,n,r=this.minIndex,s=0,a=this.currentIndex;do(null===(i=this.entries[a-1])||void 0===i?void 0:i.isFree)||(null===(n=this.entries[a-1])||void 0===n?void 0:n.isHidden)||s++,a--;while(this.minIndex<a&&s<this.maxUndos&&a>=0)if(this.minIndex=a,this.minIndex>r)for(var o=r+1;o<=this.minIndex;o++){var l=this.entries[o];if(!l)throw Error("this.dataArr[i] null");this.broadcast({bufferUpdate:l}),this.entries[o]=null}else this.broadcast(null)}}},{key:"decreaseCurrentIndex",value:function(){var e,t=[];if(!this.canUndo())return t;for(;(null===(e=this.entries[this.currentIndex])||void 0===e?void 0:e.isHidden)&&this.currentIndex>0;)this.currentIndex--;this.currentIndex--;for(var i=this.minIndex+1;i<=this.currentIndex;i++)t.push((0,o.throwIfNull)(this.entries[i]));return this.broadcast(null),t}},{key:"increaseCurrentIndex",value:function(){if(!this.canRedo())return[];var e,t=[];do this.currentIndex++,t.push((0,o.throwIfNull)(this.entries[this.currentIndex]));while(null===(e=this.entries[this.currentIndex+1])||void 0===e?void 0:e.isHidden)return this.broadcast(null),t}},{key:"getAll",value:function(){return(0,a._)(this.entries)}},{key:"canRedo",value:function(){return this.currentIndex<this.entries.length-1}},{key:"canUndo",value:function(){return this.currentIndex>this.minIndex}},{key:"getChangeCount",value:function(){return this.changeCount}},{key:"getCurrentIndex",value:function(){return this.currentIndex}}]),e}()}),n("jmL5A",function(n,r){e(n.exports,"EmbedToolspaceTopRow",function(){return u});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("4813m"),h=i("a2EGp"),c=i("1mH1z"),u=/*#__PURE__*/function(){function e(i){(0,s._)(this,e);var n=function(e){var t=6+(e.extraPadding?e.extraPadding:0),i=(0,o.BB).el({className:"toolspace-row-button nohighlight",title:e.title,onClick:e.onClick,css:{padding:e.content?"":e.contain?t+"px 0":""}});if(e.content)i.append(e.content);else{var n=(0,o.BB).el({className:"dark-invert",css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%"}});n.style.pointerEvents="none",i.append(n)}var r=new o.BB.PointerListener({target:i,onEnterLeave:function(e){i.classList.toggle("toolspace-row-button-hover",e)}});return{el:i,pointerListener:r}};this.rootEl=(0,o.BB).el({className:"kl-toolspace-row",css:{height:"36px",display:"flex"}});var r=n({onClick:i.onSubmit,title:(0,c.LANG)("submit-title"),content:(0,o.BB).el({content:(0,c.LANG)("submit"),className:"toolspace-row-button__submit",css:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%"}}),contain:!0});r.el.style.width="45px";var a=n({onClick:i.onHelp,title:(0,c.LANG)("help"),image:/*@__PURE__*/t(h),contain:!0}),u=n({onClick:i.onLeftRight,title:(0,c.LANG)("switch-ui-left-right"),image:/*@__PURE__*/t(l),contain:!0});this.rootEl.append(r.el,u.el,a.el)}return(0,a._)(e,[{key:"getElement",value:function(){return this.rootEl}}]),e}()}),n("iUR3L",function(t,n){e(t.exports,"importFilters",function(){return S});var r=i("kyVjY"),s=i("iiVKq"),a=i("lorQQ"),o=i("8Ri8I"),l=i("fADXF"),h=i("bIns5"),c=i("30jcG"),u=i("cCks8"),p=i("huXOx"),d=i("dsRff"),g=i("lhchB"),f=i("lXpcU"),v=i("1CjeM"),m=i("dNWKZ"),y=i("94Tq7"),x=i("d8Fqy"),b=i("gtdB1"),B=i("lQzx7"),w=i("10iZP"),k=i("dteOZ");function C(e,t){t.getDialog&&(e.getDialog=t.getDialog),e.apply=t.apply}function S(){r.filterLibStatus.isLoaded||(C(r.filterLib.brightnessContrast,s.filterBrightnessContrast),C(r.filterLib.cropExtend,a.filterCropExtend),C(r.filterLib.curves,o.filterCurves),C(r.filterLib.flip,l.filterFlip),C(r.filterLib.hueSaturation,h.filterHueSaturation),C(r.filterLib.invert,c.filterInvert),C(r.filterLib.perspective,u.filterPerspective),C(r.filterLib.resize,p.filterResize),C(r.filterLib.rotate,d.filterRotate),C(r.filterLib.tiltShift,g.filterTiltShift),C(r.filterLib.transform,f.filterTransform),C(r.filterLib.blur,v.filterBlur),C(r.filterLib.unsharpMask,m.filterUnsharpMask),C(r.filterLib.toAlpha,y.filterToAlpha),C(r.filterLib.grid,x.filterGrid),C(r.filterLib.noise,b.filterNoise),C(r.filterLib.pattern,B.filterPattern),C(r.filterLib.distort,w.filterDistort),C(r.filterLib.vanishPoint,k.filterVanishPoint),r.filterLibStatus.isLoaded=!0)}}),n("iiVKq",function(t,n){e(t.exports,"filterBrightnessContrast",function(){return g});var r=i("aP0jf"),s=i("cH2YE"),a=i("a5EFw"),o=i("1mH1z"),l=i("9tQ35"),h=i("jpkXO");i("fDKZh");var c=i("elJSU"),u=i("eWjiX"),p=i("bh77f"),d=i("ChldL"),g={getDialog(e){var t=(0,u.BB).el(),i={element:t},n=(0,p.testIsSmall)();n||(i.width=(0,d.getPreviewWidth)(n));var a=e.context,g=e.klCanvas;if(!a||!g)return!1;var f=g.getLayers(),v=g.getLayerIndex(a.canvas),m=0,y=0,x=new l.FxPreviewRenderer({original:a.canvas,onUpdate:function(e){return e.brightnessContrast(m,y)}});return setTimeout(function(){var e=new r.KlSlider({label:(0,o.LANG)("filter-bright-contrast-brightness"),width:300,height:30,min:0,max:100,value:(m+1)*50,eventResMs:s.eventResMs,onChange:function(e){m=e/50-1,g.render()}}),l=new r.KlSlider({label:(0,o.LANG)("filter-bright-contrast-contrast"),width:300,height:30,min:0,max:100,value:(y+1)*50,eventResMs:s.eventResMs,onChange:function(e){y=e/50-1,g.render()}});e.getElement().style.marginBottom="10px",l.getElement().style.marginBottom="10px",t.append(e.getElement(),l.getElement());for(var u=[],p=0;p<f.length;p++)u.push({image:p===v?x.render:f[p].context.canvas,isVisible:f[p].isVisible,opacity:f[p].opacity,mixModeStr:f[p].mixModeStr,hasClipping:!1});var g=new h.Preview({width:(0,d.getPreviewWidth)(n),height:(0,d.getPreviewHeight)(n),project:{width:a.canvas.width,height:a.canvas.height,layers:u}});g.render(),g.getElement().classList.add((0,c.css)({marginLeft:"-20px",marginRight:"-20px"})),t.append(g.getElement()),i.destroy=function(){e.destroy(),l.destroy(),x.destroy(),g.destroy()},i.getInput=function(){return i.destroy(),{brightness:m,contrast:y}}},1),i},apply(e){var t=e.context,i=e.input.brightness,n=e.input.contrast,r=e.history;if(!t)return!1;null==r||r.pause(!0);var s=(0,a.getSharedFx)();if(!s)return!1;var o=s.texture(t.canvas);return s.draw(o).brightnessContrast(i,n).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(s,0,0),o.destroy(),null==r||r.pause(!1),null==r||r.push({tool:["filter","brightnessContrast"],action:"apply",params:[{input:e.input}]}),!0}}}),n("cH2YE",function(t,i){e(t.exports,"eventResMs",function(){return n});var n=60}),n("9tQ35",function(t,n){e(t.exports,"FxPreviewRenderer",function(){return m});var r=i("cx0mh"),s=i("7h4XF"),a=i("bX4ja"),o=i("eWjiX"),l=i("a5EFw"),h=i("7jh4K");i("ciAU9");var c=i("cdZRx"),u=i("dZ59l"),p=i("kDVZW"),d=i("kFecW"),g=i("kr2fR"),f=i("1GsyD"),v=i("fzzhO"),m=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.texture=void 0,this.oldOnUpdateProps={textureWidth:0,textureHeight:0,transform:{scaleX:0,scaleY:0,angleDeg:0,x:0,y:0}},this.render=function(e,t,n){var r,s,o,l=(0,f.createMatrixFromTransform)(e),h=(0,c.applyToPoint)(l,{x:0,y:0}),m=(0,c.applyToPoint)(l,{x:i.original.width,y:i.original.height});m.x=Math.round(m.x),m.y=Math.round(m.y);var y={x:Math.max(0,h.x),y:Math.max(0,h.y)},x={x:Math.min(t-0,m.x),y:Math.min(n-0,m.y)};if((r={x:y.x,y:y.y,width:x.x-y.x,height:x.y-y.y}).width<=0||r.height<=0)return i.textureSource.width=1,i.textureSource.height=1,i.textureSource;var b=(0,u.compose)((0,p.inverse)(l),(0,g.translate)(0,0),(0,g.translate)(r.x-0,r.y-0)),B={textureWidth:Math.ceil(r.width),textureHeight:Math.ceil(r.height),transform:{scaleX:e.scaleX,scaleY:e.scaleY,angleDeg:e.angleDeg,x:e.x-r.x,y:e.y-r.y}},w=0,k=0;if(e.scaleX>1){var C=(0,c.applyToPoint)(b,{x:0,y:0});w=-C.x,k=-C.y,C.x=Math.max(0,Math.floor(C.x)),C.y=Math.max(0,Math.floor(C.y)),w+=C.x,k+=C.y;var S=(0,c.applyToPoint)(b,{x:r.width,y:r.height});S.x=Math.min(i.original.width,Math.ceil(S.x)),S.y=Math.min(i.original.height,Math.ceil(S.y));var E=S.x-C.x,L=S.y-C.y;B.textureWidth=E,B.textureHeight=L,B.transform={scaleX:1,scaleY:1,angleDeg:0,x:-C.x,y:-C.y},b=(0,u.compose)(b,(0,d.scale)(e.scaleX,e.scaleY),(0,g.translate)(w,k))}i.texture&&JSON.stringify(B)===JSON.stringify(i.oldOnUpdateProps)&&!i.postMix||(i.textureSource.width=B.textureWidth,i.textureSource.height=B.textureHeight,i.ctx.save(),i.ctx.imageSmoothingEnabled=!1,e.scaleX>1?(s=i.ctx).setTransform.apply(s,(0,a._)((0,v.matrixToTuple)((0,f.createMatrixFromTransform)(B.transform)))):(o=i.ctx).setTransform.apply(o,(0,a._)((0,v.matrixToTuple)((0,p.inverse)(b)))),i.ctx.drawImage(i.original,0,0),i.ctx.restore(),i.texture&&JSON.stringify(B)===JSON.stringify(i.oldOnUpdateProps)||(i.texture&&i.texture.destroy(),i.texture=i.fxCanvas.texture(i.textureSource)),i.postMix||(i.textureSource.width=1,i.textureSource.height=1)),i.oldOnUpdateProps=B;var A=i.onUpdate(i.fxCanvas.draw(i.texture),B.transform).update();return i.postMix?(i.ctx.save(),i.ctx.globalAlpha=i.postMix.opacity,i.ctx.globalCompositeOperation=i.postMix.operation,i.ctx.drawImage(A,0,0),i.ctx.restore(),{image:i.textureSource,transform:b}):{image:A,transform:b}},this.original=t.original,this.onUpdate=t.onUpdate,this.textureSource=(0,o.BB).canvas(1,1),this.ctx=(0,o.BB).ctx(this.textureSource),this.fxCanvas=(0,h.throwIfNull)((0,l.getSharedFx)()),this.postMix=t.postMix}return(0,s._)(e,[{key:"setPostMix",value:function(e){this.postMix=e}},{key:"destroy",value:function(){(0,o.BB).freeCanvas(this.textureSource),this.texture&&(this.texture=this.fxCanvas.texture(this.textureSource),this.fxCanvas.draw(this.texture).update(),this.texture&&this.texture.destroy())}}]),e}()}),n("lorQQ",function(t,n){e(t.exports,"filterCropExtend",function(){return p});var r=i("eWjiX"),s=i("dJPtW"),a=i("7bWhB"),o=i("43qNf"),l=i("32CBv"),h=i("1mH1z"),c=i("1C8RU"),u=i("ChldL"),p={getDialog(e){var t=e.klCanvas;if(!t)return!1;var i=(0,r.BB).canvas(),n=(0,r.BB).fitInto(t.getWidth(),t.getHeight(),560,400,1),p=parseInt(""+n.width),d=parseInt(""+n.height),g=p/t.getWidth();i.width=p,i.height=d,i.style.display="block",(0,r.BB).ctx(i).drawImage(t.getCompleteCanvas(g),0,0,p,d);var f=(0,r.BB).el(),v={element:f},m=0,y=0,x=0,b=0,B=!1,w=!1,k=!1,C=!1,S=e.maxWidth,E=e.maxHeight,L=1,A=(0,r.BB).el({css:{display:"flex",alignItems:"center"}}),I=(0,r.BB).el({css:{display:"flex",alignItems:"center",marginTop:"5px"}});f.append(A,I);var T=(0,s.input)({init:0,type:"number",min:-t.getWidth(),max:S,css:{width:"75px",marginRight:"20px"},callback:function(){B=!0,O()}}),P=(0,s.input)({init:0,type:"number",min:-t.getWidth(),max:S,css:{width:"75px"},callback:function(){w=!0,O()}}),R=(0,s.input)({init:0,type:"number",min:-t.getHeight(),max:E,css:{width:"75px",marginRight:"20px"},callback:function(){k=!0,O()}}),M=(0,s.input)({init:0,type:"number",min:-t.getHeight(),max:E,css:{width:"75px"},callback:function(){C=!0,O()}}),D={display:"inline-block",width:"65px",wordBreak:"break-word"};function O(){m=parseInt(T.value),y=parseInt(P.value),x=parseInt(R.value),b=parseInt(M.value);var e=t.getWidth()+m+y,i=t.getHeight()+x+b;e<=0&&(B&&(m=-t.getWidth()-y+1,T.value=""+m),w&&(y=-t.getWidth()-m+1,P.value=""+y),e=1),e>S&&(B&&(m=-t.getWidth()-y+S,T.value=""+m),w&&(y=-t.getWidth()-m+S,P.value=""+y),e=S),i<=0&&(k&&(x=-t.getHeight()-b+1,R.value=""+x),C&&(b=-t.getHeight()-x+1,M.value=""+b),i=1),i>E&&(k&&(x=-t.getHeight()-b+E,R.value=""+x),C&&(b=-t.getHeight()-x+E,M.value=""+b),i=E),Y.setTransform({x:-m,y:-x,width:e,height:i}),B=!1,w=!1,k=!1,C=!1}A.append((0,r.BB).el({content:(0,h.LANG)("filter-crop-left")+":",css:D}),T,(0,r.BB).el({content:(0,h.LANG)("filter-crop-right")+":",css:D}),P),I.append((0,r.BB).el({content:(0,h.LANG)("filter-crop-top")+":",css:D}),R,(0,r.BB).el({content:(0,h.LANG)("filter-crop-bottom")+":",css:D}),M);var _=!0,N=new a.Checkbox({init:!0,label:(0,h.LANG)("filter-crop-rule-thirds"),allowTab:!0,callback:function(e){_=e,Y.showThirds(_)}});f.append((0,r.BB).el({css:{clear:"both"}}));var z={r:0,g:0,b:0,a:0},G=[{r:0,g:0,b:0,a:0},{r:255,g:255,b:255,a:1},{r:0,g:0,b:0,a:1}];G.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),G.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1});var j=new o.ColorOptions({label:(0,h.LANG)("filter-crop-fill"),colorArr:G,onChange:function(e){0===(z=e).a?(V.style.background="",i.style.background=""):(V.style.background=(0,r.BB).ColorConverter.toRgbStr(z),(0,r.BB).createCheckerDataUrl(parseInt(""+50*L),function(e){i.style.background="url("+e+")"},(0,c.theme).isDark()))}}),F=(0,r.BB).el({css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"10px"}});function H(e){var n=(0,r.BB).fitInto(e.width,e.height,260,180,1);L=n.width/e.width;var s=(0,r.BB).centerWithin(u.smallPreview.width,U,n.width,n.height);i.style.width=t.getWidth()*L+"px",i.style.height=t.getHeight()*L+"px",W.style.left=s.x-e.x*L+"px",W.style.top=s.y-e.y*L+"px",m=parseInt(""+-e.x),x=parseInt(""+-e.y),y=parseInt(""+(e.x+e.width-t.getWidth())),b=parseInt(""+(e.y+e.height-t.getHeight())),T.value=""+m,R.value=""+x,P.value=""+y,M.value=""+b,(0,r.BB).createCheckerDataUrl(parseInt(""+50*L),function(e){X.style.background="url("+e+")",0!==z.a&&(i.style.background="url("+e+")")},(0,c.theme).isDark()),X.style.backgroundPosition=s.x+"px "+s.y+"px",Y.setScale(L)}f.append(F),F.append(N.getElement(),j.getElement());var U=u.smallPreview.height-2,X=(0,r.BB).el({className:"kl-edit-crop-preview",css:{width:u.smallPreview.width+"px",marginTop:"10px",marginLeft:"-20px",height:U+"px",backgroundColor:"#9e9e9e",position:"relative",borderTop:"1px solid rgb(144,144,144)",borderBottom:"1px solid rgb(144,144,144)",overflow:"hidden",userSelect:"none",touchAction:"none"}});X.oncontextmenu=function(){return!1};var V=(0,r.BB).el({css:{position:"absolute",left:"0",top:"0",bottom:"0",right:"0"}});X.append(V);var W=(0,r.BB).el({parent:X,css:{position:"absolute",left:"0",top:"0"}});(0,r.BB).el({parent:W,content:i,css:{boxShadow:"0 0 0px 1px rgb(130,130,130)",position:"absolute",left:"0px",top:"0px"}}),f.append(X);var Y=new l.Cropper({x:0,y:0,width:t.getWidth(),height:t.getHeight(),scale:L,callback:H,maxW:S,maxH:E});function K(){O()}return H(Y.getTransform()),W.append(Y.getElement()),(0,c.theme).addIsDarkListener(K),v.destroy=function(){Y.destroy(),N.destroy(),(0,c.theme).removeIsDarkListener(K),j.destroy()},v.getInput=function(){return v.destroy(),{left:m,right:y,top:x,bottom:b,fillColor:0===z.a?void 0:z}},v},apply(e){var t=e.klCanvas,i=e.history;return!(!t||isNaN(e.input.left)||isNaN(e.input.right)||isNaN(e.input.top)||isNaN(e.input.bottom))&&(null==i||i.pause(!0),t.resizeCanvas(e.input),null==i||i.pause(!1),null==i||i.push({tool:["filter","cropExtend"],action:"apply",params:[{input:(0,r.BB).copyObj(e.input)}]}),!0)}}}),n("8Ri8I",function(t,n){e(t.exports,"filterCurves",function(){return p});var r=i("eWjiX"),s=i("a5EFw"),a=i("hRvnE"),o=i("9tQ35"),l=i("jpkXO");i("fDKZh");var h=i("elJSU"),c=i("bh77f"),u=i("ChldL"),p={getDialog(e){var t=e.context,i=e.klCanvas;if(!t||!i)return!1;var n=i.getLayers(),s=i.getLayerIndex(t.canvas),p=(0,r.BB).el(),d={element:p},g=(0,c.testIsSmall)();g||(d.width=(0,u.getPreviewWidth)(g));var f=(0,a.getDefaultCurvesInput)(),v=new o.FxPreviewRenderer({original:t.canvas,onUpdate:function(e){return e.curves(f.r,f.g,f.b)}});return setTimeout(function(){for(var e=[],i=0;i<n.length;i++)e.push({image:i===s?v.render:n[i].context.canvas,isVisible:n[i].isVisible,opacity:n[i].opacity,mixModeStr:n[i].mixModeStr,hasClipping:!1});var r=new l.Preview({width:(0,u.getPreviewWidth)(g),height:(0,u.getPreviewHeight)(g),project:{width:t.canvas.width,height:t.canvas.height,layers:e}});r.getElement().classList.add((0,h.css)({marginLeft:"-20px",marginRight:"-20px"}));var o=new a.CurvesInput({curves:f,callback:function(e){f=e,r.render()}}),c=o.getModeButtons();p.append(o.getElement(),r.getElement()),d.destroy=function(){o.destroy(),c.destroy(),v.destroy(),r.destroy()},d.getInput=function(){return d.destroy(),{curves:f}}},1),d},apply(e){var t=e.context,i=e.input.curves,n=e.history;if(!t)return!1;null==n||n.pause(!0);var r=(0,s.getSharedFx)();if(!r)return!1;var a=r.texture(t.canvas);return r.draw(a).curves(i.r,i.g,i.b).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(r,0,0),a.destroy(),null==n||n.pause(!1),null==n||n.push({tool:["filter","curves"],action:"apply",params:[{input:e.input}]}),!0}}}),n("hRvnE",function(t,n){e(t.exports,"getDefaultCurvesInput",function(){return h}),e(t.exports,"CurvesInput",function(){return c});var r=i("cx0mh"),s=i("7h4XF"),a=i("iFIyy"),o=i("1mH1z"),l=i("eWjiX");function h(){return(0,l.BB).copyObj({r:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],g:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],b:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]]})}var c=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.rootEl=(0,l.BB).el({css:{position:"relative",marginBottom:"10px"}}),this.rootEl.oncontextmenu=function(){return!1};var n="All",s=t.curves;this.modeButtons=new a.Options({optionArr:[{id:"All",label:(0,o.LANG)("filter-curves-all")},{id:"Red",label:(0,o.LANG)("red")},{id:"Green",label:(0,o.LANG)("green")},{id:"Blue",label:(0,o.LANG)("blue")}],initId:"All",onChange:function(e){"All"===(n=e)&&(s=h());var t=s.r;"Green"===n&&(t=s.g),"Blue"===n&&(t=s.b),i.p0.setPos(0,p-t[0][1]*p),i.p1.setPos(t[1][0]*u,p-t[1][1]*p),i.p2.setPos(t[2][0]*u,p-t[2][1]*p),i.p3.setPos(u,p-t[3][1]*p),y()}}),this.rootEl.append(this.modeButtons.getElement());var c=(0,l.BB).el({parent:this.rootEl,className:"kl-curves-graph",css:{position:"relative",marginTop:"10px"}}),u=300,p=100,d=(0,l.BB).canvas(u,p),g=(0,l.BB).ctx(d);c.append(d);var f=function(e){return Math.max(0,Math.min(1,e))},v=function(e,t,i,n){var r=t,s=e,a=(0,l.BB).el({className:"kl-curves-graph__grip",css:{left:e-7+"px",top:t-7+"px",width:"14px",height:"14px",borderRadius:"14px"}}),o=function(){(0,l.BB).css(a,{left:e-7+"px",top:t-7+"px"})},h=new l.BB.PointerListener({target:a,onPointer:function(a){a.eventPreventDefault(),"pointerdown"===a.type&&(s=e,r=t),"left"===a.button&&"pointermove"===a.type&&(n||(s+=a.dX),e=Math.max(0,Math.min(u,s)),r+=a.dY,t=Math.max(0,Math.min(p,r)),o(),i({x:e,y:t}))}});return c.append(a),{el:a,setPos:function(i,n){e=i,r=t=n,s=e,(0,l.BB).css(a,{left:e-7+"px",top:t-7+"px"})},pointerListener:h}},m=function(e,t,i){"All"===n&&(s.r[e]=[f(t/u),f(1-i/p)],s.g[e]=[f(t/u),f(1-i/p)],s.b[e]=[f(t/u),f(1-i/p)]),"Red"===n&&(s.r[e]=[f(t/u),f(1-i/p)]),"Green"===n&&(s.g[e]=[f(t/u),f(1-i/p)]),"Blue"===n&&(s.b[e]=[f(t/u),f(1-i/p)])};this.p0=v(0,p,function(e){m(0,e.x,e.y),y()},!0),this.p1=v(u/3,p/3*2,function(e){m(1,e.x,e.y),y()}),this.p2=v(u/3*2,p/3,function(e){m(2,e.x,e.y),y()}),this.p3=v(u,0,function(e){m(3,e.x,e.y),y()},!0);var y=function(){(g=(0,l.BB).ctx(d)).clearRect(0,0,d.width,d.height);for(var e={r:[],g:[],b:[]},i=0;i<s.r.length;i++)e.r.push(s.r[i]),e.g.push(s.g[i]),e.b.push(s.b[i]);var r=function(e){g.beginPath();for(var t=new l.BB.SplineInterpolator(e),i=0;i<100;i++){var n=t.interpolate(i/100);n=Math.max(0,Math.min(1,n)),0===i?g.moveTo(i/100*u,p-n*p):g.lineTo(i/100*u,p-n*p)}g.stroke()};g.save(),"All"===n?(g.strokeStyle="black",r(e.r)):(g.globalAlpha=.5,g.strokeStyle="red",r(e.r),g.strokeStyle="green",r(e.g),g.strokeStyle="blue",r(e.b)),g.restore(),t.callback(e)};y()}return(0,s._)(e,[{key:"getElement",value:function(){return this.rootEl}},{key:"getModeButtons",value:function(){return this.modeButtons}},{key:"destroy",value:function(){this.p0.pointerListener.destroy(),this.p1.pointerListener.destroy(),this.p2.pointerListener.destroy(),this.p3.pointerListener.destroy()}}]),e}()}),n("fADXF",function(t,n){e(t.exports,"filterFlip",function(){return u});var r=i("eWjiX"),s=i("7bWhB"),a=i("5UrL9"),o=i("1mH1z"),l=i("7jh4K"),h=i("iFIyy"),c=i("ChldL"),u={getDialog(e){var t=e.context,i=e.klCanvas;if(!t||!i)return!1;var n=i.getLayers(),l=i.getLayerIndex(t.canvas),u=(0,r.BB).fitInto(t.canvas.width,t.canvas.height,280,200,1),p=parseInt(""+u.width),d=parseInt(""+u.height),g=(0,r.BB).el(),f={element:g},v=!0,m=!1,y=!0,x=new s.Checkbox({init:v,label:(0,o.LANG)("filter-flip-horizontal")+" ⟷",allowTab:!0,callback:function(e){v=e,E()},css:{marginBottom:"10px"}}),b=new s.Checkbox({init:m,label:(0,o.LANG)("filter-flip-vertical")+" ↕",allowTab:!0,callback:function(e){m=e,E()},css:{marginBottom:"10px"}});g.append(x.getElement()),g.append(b.getElement());var B=new h.Options({optionArr:[{id:!0,label:(0,o.LANG)("filter-flip-image")},{id:!1,label:(0,o.LANG)("filter-flip-layer")}],onChange:function(e){y=e,E()}});g.append(B.getElement());var w=(0,r.BB).el({className:"kl-preview-wrapper",css:{width:c.smallPreview.width+"px",height:c.smallPreview.height+"px"}}),k={image:(0,r.BB).canvas(Math.round(p),Math.round(d)),isVisible:!0,opacity:1,mixModeStr:"source-over"},C=new a.KlCanvasPreview({width:Math.round(p),height:Math.round(d),layers:[k]}),S=(0,r.BB).el({className:"kl-preview-wrapper__canvas",css:{width:parseInt(""+p)+"px",height:parseInt(""+d)+"px"}});function E(){var e=(0,r.BB).ctx(k.image);e.save(),e.clearRect(0,0,k.image.width,k.image.height),y&&(v&&(e.translate(k.image.width,0),e.scale(-1,1)),m&&(e.translate(0,k.image.height),e.scale(1,-1)));for(var t=0;t<n.length;t++)n[t].isVisible&&(e.save(),!y&&l===t&&(v&&(e.translate(k.image.width,0),e.scale(-1,1)),m&&(e.translate(0,k.image.height),e.scale(1,-1))),e.canvas.width>n[t].context.canvas.width&&(e.imageSmoothingEnabled=!1),e.globalAlpha=n[t].opacity,e.globalCompositeOperation=n[t].mixModeStr,e.drawImage(n[t].context.canvas,0,0,k.image.width,k.image.height),e.restore());C.render(),e.restore()}return S.append(C.getElement()),w.append(S),setTimeout(E,0),g.append(w),f.destroy=function(){x.destroy(),b.destroy(),B.destroy(),C.destroy()},f.getInput=function(){return f.destroy(),{horizontal:v,vertical:m,flipCanvas:y}},f},apply(e){var t=e.context,i=e.klCanvas,n=e.history,r=e.input.horizontal,s=e.input.vertical,a=e.input.flipCanvas;return!!t&&!!i&&(null==n||n.pause(!0),i.flip(r,s,a?void 0:(0,l.throwIfNull)(i.getLayerIndex(t.canvas))),null==n||n.pause(!1),null==n||n.push({tool:["filter","flip"],action:"apply",params:[{input:e.input}]}),!0)}}}),n("bIns5",function(t,n){e(t.exports,"filterHueSaturation",function(){return g});var r=i("cH2YE"),s=i("aP0jf"),a=i("a5EFw"),o=i("1mH1z"),l=i("9tQ35"),h=i("jpkXO");i("fDKZh");var c=i("elJSU"),u=i("eWjiX"),p=i("bh77f"),d=i("ChldL"),g={getDialog(e){var t=e.context,i=e.klCanvas;if(!t||!i)return!1;var n=i.getLayers(),a=i.getLayerIndex(t.canvas),g=(0,u.BB).el(),f={element:g},v=(0,p.testIsSmall)();v||(f.width=(0,d.getPreviewWidth)(v));var m=0,y=0,x=new l.FxPreviewRenderer({original:t.canvas,onUpdate:function(e){return e.hueSaturation(m,y)}});return setTimeout(function(){var e=new s.KlSlider({label:(0,o.LANG)("filter-hue-sat-hue"),width:300,height:30,min:-100,max:100,value:100*m,eventResMs:r.eventResMs,onChange:function(e){m=e/100,p.render()}}),i=new s.KlSlider({label:(0,o.LANG)("filter-hue-sat-saturation"),width:300,height:30,min:0,max:100,value:(y+1)*50,eventResMs:r.eventResMs,onChange:function(e){y=e/50-1,p.render()}});e.getElement().style.marginBottom="10px",i.getElement().style.marginBottom="10px",g.append(e.getElement(),i.getElement());for(var l=[],u=0;u<n.length;u++)l.push({image:u===a?x.render:n[u].context.canvas,isVisible:n[u].isVisible,opacity:n[u].opacity,mixModeStr:n[u].mixModeStr,hasClipping:!1});var p=new h.Preview({width:(0,d.getPreviewWidth)(v),height:(0,d.getPreviewHeight)(v),project:{width:t.canvas.width,height:t.canvas.height,layers:l}});p.render(),p.getElement().classList.add((0,c.css)({marginLeft:"-20px",marginRight:"-20px"})),g.append(p.getElement()),f.destroy=function(){e.destroy(),i.destroy(),x.destroy(),p.destroy()},f.getInput=function(){return f.destroy(),{hue:m,saturation:y}}},1),f},apply(e){var t=e.context,i=e.input.hue,n=e.history,r=e.input.saturation;if(!t||null===i||null===r)return!1;null==n||n.pause(!0);var s=(0,a.getSharedFx)();if(!s)return!1;var o=s.texture(t.canvas);return s.draw(o).hueSaturation(i,r).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(s,0,0),o.destroy(),null==n||n.pause(!1),null==n||n.push({tool:["filter","hueSaturation"],action:"apply",params:[{input:e.input}]}),!0}}}),n("30jcG",function(t,n){e(t.exports,"filterInvert",function(){return s});var r=i("a5EFw"),s={apply(e){var t=e.context,i=e.history;if(!t)return!1;var n=(0,r.getSharedFx)();if(!n)return!1;null==i||i.pause(!0);var s=n.texture(t.canvas);return n.draw(s).invert().update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(n,0,0),s.destroy(),null==i||i.pause(!1),null==i||i.push({tool:["filter","invert"],action:"apply",params:[{input:e.input}]}),!0}}}),n("cCks8",function(t,n){e(t.exports,"filterPerspective",function(){return f});var r=i("bX4ja"),s=i("eWjiX"),a=i("a5EFw"),o=i("1mH1z"),l=i("5vheV");i("ciAU9");var h=i("cdZRx"),c=i("jpkXO"),u=i("7jh4K"),p=i("3xvcu"),d=i("bh77f"),g=i("ChldL"),f={getDialog(e){var t=e.context,i=e.klCanvas;if(!t||!i)return!1;var n=(0,d.testIsSmall)(),f=i.getLayers(),v=i.getLayerIndex(t.canvas),m=(0,s.BB).el(),y={element:m};return n||(y.width=g.mediumPreview.width),setTimeout(function(){var e,i=(0,u.throwIfNull)((0,a.getSharedFx)()),d=(0,u.throwIfUndefined)(null==i?void 0:i.texture(t.canvas));function x(){C?i.draw(d).update():i.draw(d).perspective(k(B),k(w)).update(),A.render()}var b=[{x:0,y:0},{x:t.canvas.width,y:0},{x:t.canvas.width,y:t.canvas.height},{x:0,y:t.canvas.height}],B=b.map(function(e){return new p.DraggableInput({value:e,onChange:function(){x()}})});B.forEach(function(e){return e.getElement().style.display="none"});var w=b.map(function(e){return new p.DraggableInput({value:e,onChange:function(){x()}})});function k(e,t){return e.flatMap(function(e){var i=e.getValue();return t&&(i=(0,h.applyToPoint)(t,i)),[i.x,i.y]})}var C=!1,S=new l.TwoTabs({left:(0,o.LANG)("compare-before"),right:(0,o.LANG)("compare-after"),init:1,onChange:function(e){(C=0===e)?(B.forEach(function(e){return e.getElement().style.display="block"}),w.forEach(function(e){return e.getElement().style.display="none"})):(B.forEach(function(e,t){w[t].setValue(e.getValue())}),B.forEach(function(e){return e.getElement().style.display="none"}),w.forEach(function(e){return e.getElement().style.display="block"})),x()}});m.append(S.getElement());for(var E=[],L=0;L<f.length;L++)E.push({image:L===v?i:f[L].context.canvas,isVisible:f[L].isVisible,opacity:f[L].opacity,mixModeStr:f[L].mixModeStr,hasClipping:!1});var A=new c.Preview({width:(0,g.getPreviewWidth)(n),height:(0,g.getPreviewHeight)(n),project:{width:t.canvas.width,height:t.canvas.height,layers:E},onTransformChange:function(e){B.forEach(function(t){return t.setTransform(e)}),w.forEach(function(t){return t.setTransform(e)})}});(0,s.BB).css(A.getElement(),{overflow:"hidden",marginLeft:"-20px",marginRight:"-20px"}),(e=A.getElement()).append.apply(e,(0,r._)(B.map(function(e){return e.getElement()})).concat((0,r._)(w.map(function(e){return e.getElement()})))),m.append(A.getElement()),x(),y.destroy=function(){A.destroy(),d.destroy,B.forEach(function(e){return e.destroy()}),w.forEach(function(e){return e.destroy()})},y.getInput=function(){return y.destroy(),{before:k(B),after:k(w)}}},1),y},apply(e){var t=e.context,i=e.history,n=e.input.before,r=e.input.after;if(!t||!n||!r)return!1;null==i||i.pause(!0);var s=(0,a.getSharedFx)();if(!s)return!1;var o=s.texture(t.canvas);return s.draw(o).multiplyAlpha().perspective(n,r).unmultiplyAlpha().update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(s,0,0),o.destroy(),null==i||i.pause(!1),null==i||i.push({tool:["filter","perspective"],action:"apply",params:[{input:e.input}]}),!0}}}),n("5vheV",function(t,n){e(t.exports,"TwoTabs",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.value=t.init,this.rootEl=(0,a.BB).el({className:"kl-2-tabs"}),this.leftTab=(0,a.BB).el({parent:this.rootEl,content:t.left,className:"kl-2-tabs__left"}),this.leftTab.onpointerdown=function(){return!1},this.rightTab=(0,a.BB).el({parent:this.rootEl,content:t.right,className:"kl-2-tabs__right"}),this.rightTab.onpointerdown=function(){return!1},this.update(),this.leftTab.onclick=function(){0!==i.value&&(i.value=0,i.update(),t.onChange(i.value))},this.rightTab.onclick=function(){1!==i.value&&(i.value=1,i.update(),t.onChange(i.value))}}return(0,s._)(e,[{key:"update",value:function(){this.leftTab.classList.toggle("kl-2-tabs--active",0===this.value),this.rightTab.classList.toggle("kl-2-tabs--active",1===this.value)}},{key:"getElement",value:function(){return this.rootEl}}]),e}()}),n("3xvcu",function(t,n){e(t.exports,"DraggableInput",function(){return c});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("eWjiX");i("ciAU9");var l=i("cdZRx"),h=i("1GsyD"),c=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.value=(0,a._)({},t.value),this.transform={x:0,y:0,scale:1,angleDeg:0},this.rootEl=(0,o.BB).el({css:{width:"16px",height:"16px",backgroundColor:"#fff",border:"2px solid #000",borderRadius:"16px",position:"absolute",cursor:"move",userSelect:"none",touchAction:"none"}}),this.pointerListener=new o.BB.PointerListener({target:this.rootEl,onPointer:function(e){e.eventPreventDefault(),"left"===e.button&&"pointermove"===e.type&&(i.value.x+=e.dX/i.transform.scale,i.value.y+=e.dY/i.transform.scale,i.update(),t.onChange(i.value))}})}return(0,s._)(e,[{key:"update",value:function(){var e=(0,l.applyToPoint)((0,h.createMatrixFromTransform)(this.transform),this.value);(0,o.BB).css(this.rootEl,{left:e.x-8+"px",top:e.y-8+"px"})}},{key:"setTransform",value:function(e){JSON.stringify(this.transform)!==JSON.stringify(e)&&(this.transform=e,this.update())}},{key:"getValue",value:function(){return this.value}},{key:"setValue",value:function(e){this.value=(0,a._)({},e),this.update()}},{key:"getElement",value:function(){return this.rootEl}},{key:"destroy",value:function(){this.rootEl.remove(),this.pointerListener.destroy()}}]),e}()}),n("huXOx",function(n,r){e(n.exports,"filterResize",function(){return d});var s=i("eWjiX"),a=i("7bWhB"),o=i("eEL9N"),l=i("4p5bq"),h=i("1mH1z"),c=i("cNr8p"),u=i("1C8RU"),p=i("ChldL"),d={getDialog(e){var i=e.klCanvas;if(!i)return!1;var n=(0,s.BB).fitInto(i.getWidth(),i.getHeight(),280,200,1),r=parseInt(""+n.width),d=parseInt(""+n.height),g=r/i.getWidth(),f=i.getCompleteCanvas(1),v=(0,s.BB).el(),m={element:v},y=i.getWidth(),x=i.getHeight(),b=e.maxWidth,B=e.maxHeight,w=(0,s.BB).el({css:{width:"150px",height:"35px",lineHeight:"30px"}}),k=(0,s.BB).el({css:{width:"150px",height:"35px",lineHeight:"30px"}}),C=(0,s.BB).el({tagName:"input",css:{cssFloat:"right",width:"90px"},custom:{type:"number",min:"1",max:""+b,value:""+i.getWidth()}}),S=(0,s.BB).el({tagName:"input",css:{cssFloat:"right",width:"90px"},custom:{type:"number",min:"1",max:""+B,value:""+i.getHeight()}});C.onclick=function(){this.focus(),I=!0,_()},S.onclick=function(){this.focus(),A=!0,_()},C.onchange=function(){I=!0,_()},S.onchange=function(){A=!0,_()},w.append((0,h.LANG)("width")+": ",C),k.append((0,h.LANG)("height")+": ",S),(0,s.BB).el({css:{background:"url("+/*@__PURE__*/t(l)+") no-repeat 140px 5px",backgroundSize:"50px 52px"}}).append(w,k);var E=new Image;E.src=/*@__PURE__*/t(l),E.height=40;var L=(0,c.table)([[(0,h.LANG)("width")+":&nbsp;",C,E],[(0,s.BB).el({css:{height:"5px"}}),"",""],[(0,h.LANG)("height")+":&nbsp;",S]],{"0.2":{rowspan:3}});(0,s.BB).css(L,{marginBottom:"10px"}),v.append(L);var A=!1,I=!1,T=i.getWidth()/i.getHeight(),P=!0,R=new a.Checkbox({init:!0,label:(0,h.LANG)("constrain-proportions"),allowTab:!0,callback:function(e){P=e,E.style.display=P?"":"none",P&&(C.value=""+i.getWidth(),S.value=""+i.getHeight(),_())}});v.append((0,s.BB).el({css:{clear:"both"}}));var M=new o.Select({isFocusable:!0,optionArr:[["smooth",(0,h.LANG)("algorithm-smooth")],["pixelated",(0,h.LANG)("algorithm-pixelated")]],title:(0,h.LANG)("scaling-algorithm"),initValue:"smooth",onChange:function(){_()}});(0,s.BB).el({parent:v,css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}).append(R.getElement(),M.getElement());var D=(0,s.BB).canvas(r,d);D.style.imageRendering="pixelated";var O=(0,s.BB).ctx(D);function _(){if(0===C.value.length&&I||0===S.value.length&&A){A=!1,I=!1;return}if(C.value=""+Math.max(1,parseInt(C.value)),S.value=""+Math.max(1,parseInt(S.value)),P&&(A&&(C.value=""+parseInt(""+parseInt(S.value)*T)),I&&(S.value=""+parseInt(""+parseInt(C.value)/T)),parseInt(C.value)>b||parseInt(S.value)>B)){var e=(0,s.BB).fitInto(parseInt(C.value),parseInt(S.value),b,B,1);C.value=""+parseInt(""+e.width),S.value=""+parseInt(""+e.height)}parseInt(C.value)>b&&(C.value=""+b),parseInt(S.value)>B&&(S.value=""+B),A=!1,I=!1,y=parseInt(C.value),x=parseInt(S.value);var t=(0,s.BB).fitInto(y,x,280,200,1),n=parseInt(""+t.width),r=parseInt(""+t.height);g=n/y;var a=(0,s.BB).centerWithin(p.smallPreview.width,p.smallPreview.height,n,r);"smooth"===M.getValue()?(D.style.imageRendering=g>1?"pixelated":"",D.width=i.getWidth(),D.height=i.getHeight(),O.save(),O.imageSmoothingQuality="high",O.drawImage(f,0,0),(0,s.BB).resizeCanvas(D,y,x)):(D.style.imageRendering="pixelated",D.width=y,D.height=x,O.save(),O.imageSmoothingEnabled=!1,O.drawImage(f,0,0,D.width,D.height)),O.restore(),D.style.width=Math.max(1,n)+"px",D.style.height=Math.max(1,r)+"px",z.style.left=a.x+"px",z.style.top=a.y+"px",z.style.width=Math.max(1,n)+"px",z.style.height=Math.max(1,r)+"px"}var N=(0,s.BB).el({className:"kl-transparent-preview",css:{width:p.smallPreview.width+"px",height:p.smallPreview.height+"px",marginLeft:"-20px",display:"table",marginTop:"10px",position:"relative",userSelect:"none"}}),z=(0,s.BB).el({parent:N,content:D,className:"kl-transparent-preview__canvas",css:{width:r+"px",height:d+"px",position:"absolute",overflow:"hidden"}});function G(){(0,s.BB).createCheckerDataUrl(8,function(e){N.style.background="url("+e+")"},(0,u.theme).isDark())}return(0,u.theme).addIsDarkListener(G),G(),v.append(N),_(),m.destroy=function(){R.destroy(),(0,u.theme).removeIsDarkListener(G)},m.getInput=function(){return m.destroy(),{width:y,height:x,algorithm:M.getValue()}},m},apply(e){var t=e.klCanvas,i=e.history,n=e.input.width,r=e.input.height,s=e.input.algorithm;return!!t&&(null==i||i.pause(!0),t.resize(n,r,s),null==i||i.pause(!1),null==i||i.push({tool:["filter","resize"],action:"apply",params:[{input:e.input}]}),!0)}}}),n("4p5bq",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"constrain.62f04e45.svg"}),n("dsRff",function(t,n){e(t.exports,"filterRotate",function(){return o});var r=i("eWjiX"),s=i("1C8RU"),a=i("ChldL"),o={getDialog(e){var t=e.klCanvas;if(!t)return!1;var i=(0,r.BB).fitInto(t.getWidth(),t.getHeight(),280,200,1),n=parseInt(""+i.width),o=parseInt(""+i.height),l=n/t.getWidth(),h=(0,r.BB).canvas(n,o);h.style.display="block",(0,r.BB).ctx(h).drawImage(t.getCompleteCanvas(l),0,0,n,o);var c=(0,r.BB).el(),u={element:c},p=0;function d(){if(y.style.transform="rotate("+p+"deg)",90===Math.abs(p%180)){var e=parseInt(""+(0,r.BB).fitInto(o,n,280,200,1).height)/n;y.style.transform="rotate("+p+"deg) scale("+e+")"}}var g=document.createElement("button");g.innerHTML="<span style='font-size: 1.3em'>⟳</span> 90°";var f=document.createElement("button");f.innerHTML="<span style='font-size: 1.3em'>⟲</span> 90°",f.style.marginRight="5px",g.onclick=function(){p+=90,d()},f.onclick=function(){p-=90,d()},c.append(f,g);var v=(0,r.BB).el({className:"kl-preview-wrapper",css:{width:a.smallPreview.width+"px",height:a.smallPreview.height+"px",display:"table"}}),m=(0,r.BB).el({parent:v,css:{display:"table-cell",verticalAlign:"middle"}}),y=(0,r.BB).el({parent:m,content:h,className:"kl-preview-wrapper__canvas",css:{width:n+"px",height:o+"px",marginLeft:"auto",marginRight:"auto",overflow:"hidden"}});function x(){(0,r.BB).createCheckerDataUrl(8,function(e){y.style.background="url("+e+")"},(0,s.theme).isDark())}return(0,s.theme).addIsDarkListener(x),x(),y.style.transition="all 0.2s ease-out",c.append(v),d(),u.destroy=function(){(0,s.theme).removeIsDarkListener(x)},u.getInput=function(){return u.destroy(),{deg:p}},u},apply(e){var t=e.klCanvas,i=e.history;return!!t&&(null==i||i.pause(!0),t.rotate(e.input.deg),null==i||i.pause(!1),null==i||i.push({tool:["filter","rotate"],action:"apply",params:[{input:e.input}]}),!0)}}}),n("lhchB",function(t,n){e(t.exports,"filterTiltShift",function(){return v});var r=i("eWjiX"),s=i("cH2YE"),a=i("aP0jf"),o=i("a5EFw"),l=i("1mH1z"),h=i("9tQ35"),c=i("jpkXO"),u=i("1GsyD");i("ciAU9");var p=i("cdZRx"),d=i("3xvcu"),g=i("bh77f"),f=i("ChldL"),v={getDialog(e){var t=e.context,i=e.klCanvas;if(!t||!i)return!1;var n=i.getLayers(),o=i.getLayerIndex(t.canvas),v=(0,r.BB).el(),m={element:v},y=(0,g.testIsSmall)();y||(m.width=(0,f.getPreviewWidth)(y));var x=20,b=200,B={destroy:function(){}};return setTimeout(function(){function e(){E.render()}B=new h.FxPreviewRenderer({original:t.canvas,onUpdate:function(e,t){i.setTransform(E.getTransform()),g.setTransform(E.getTransform());var n=(0,u.createMatrixFromTransform)(t),r=(0,p.applyToPoint)(n,i.getValue()),s=(0,p.applyToPoint)(n,g.getValue());return e.multiplyAlpha().tiltShift(r.x,r.y,s.x,s.y,x*t.scaleX,b*t.scaleX).unmultiplyAlpha()}});var i=new d.DraggableInput({value:{x:t.canvas.width/4,y:t.canvas.height/2},onChange:function(){e()}}),g=new d.DraggableInput({value:{x:3*t.canvas.width/4,y:t.canvas.height/2},onChange:function(){e()}}),w=new a.KlSlider({label:(0,l.LANG)("filter-tilt-shift-gradient"),width:300,height:30,min:0,max:1e3,value:b,eventResMs:s.eventResMs,onChange:function(t){b=t,e()}});w.getElement().style.marginBottom="10px",v.append(w.getElement());var k=new a.KlSlider({label:(0,l.LANG)("filter-tilt-shift-blur"),width:300,height:30,min:0,max:200,value:x,eventResMs:s.eventResMs,onChange:function(t){x=t,e()}});k.getElement().style.marginBottom="10px",v.append(k.getElement());for(var C=[],S=0;S<n.length;S++)C.push({image:S===o?B.render:n[S].context.canvas,isVisible:n[S].isVisible,opacity:n[S].opacity,mixModeStr:n[S].mixModeStr,hasClipping:!1});var E=new c.Preview({width:(0,f.getPreviewWidth)(y),height:(0,f.getPreviewHeight)(y),project:{width:t.canvas.width,height:t.canvas.height,layers:C}});E.render(),(0,r.BB).css(E.getElement(),{overflow:"hidden",marginLeft:"-20px",marginRight:"-20px"}),E.getElement().append(i.getElement(),g.getElement()),v.append(E.getElement()),m.destroy=function(){k.destroy(),w.destroy(),i.destroy(),g.destroy(),B.destroy(),E.destroy()},m.getInput=function(){return m.destroy(),{a:i.getValue(),b:g.getValue(),blur:x,gradient:b}}},1),m},apply(e){var t=e.context,i=e.history,n=e.input.a,r=e.input.b,s=e.input.blur,a=e.input.gradient;if(!t)return!1;null==i||i.pause(!0);var l=(0,o.getSharedFx)();if(!l)return!1;var h=l.texture(t.canvas);return l.draw(h).multiplyAlpha().tiltShift(n.x,n.y,r.x,r.y,s,a).unmultiplyAlpha().update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(l,0,0),h.destroy(),null==i||i.pause(!1),null==i||i.push({tool:["filter","tiltShift"],action:"apply",params:[{input:e.input}]}),!0}}}),n("lXpcU",function(t,n){e(t.exports,"filterTransform",function(){return g});var r=i("eWjiX"),s=i("7bWhB"),a=i("cNhNm"),o=i("eEL9N"),l=i("1mH1z"),h=i("7jh4K"),c=i("jpkXO");i("fDKZh");var u=i("elJSU"),p=i("bh77f"),d=i("ChldL"),g={getDialog(e){var t=e.context,i=e.klCanvas;if(!t||!i)return!1;var n=(0,p.testIsSmall)(),g=i.getLayers(),f=(0,h.throwIfNull)(i.getLayerIndex(t.canvas)),v=(0,r.BB).canvasBounds(t);if(!v)return{error:(0,l.LANG)("filter-transform-empty")};var m={x:v.x+v.width/2,y:v.y+v.height/2,width:v.width,height:v.height,angleDeg:0},y=(0,r.BB).el(),x={element:y};n||(x.width=d.mediumPreview.width);var b=new r.BB.KeyListener({onDown:function(e){(0,r.BB).isInputFocused(!0)||("left"===e&&(S.value=""+(parseFloat(S.value)-1),Z()),"right"===e&&(S.value=""+(parseFloat(S.value)+1),Z()),"up"===e&&(C.value=""+(parseFloat(C.value)-1),Z()),"down"===e&&(C.value=""+(parseFloat(C.value)+1),Z()))}}),B=(0,r.BB).el(),w=(0,r.BB).el(),k=(0,r.BB).el(),C=(0,r.BB).el({tagName:"input"}),S=(0,r.BB).el({tagName:"input"}),E=(0,r.BB).el({tagName:"input"});B.style.width="100px",B.style.height="30px",w.style.width="100px",w.style.height="30px",w.style.display="inline-block",B.style.display="inline-block",k.style.display="inline-block",k.style.width="150px",k.style.height="30px",C.type="number",S.type="number",E.type="number",S.style.width="70px",C.style.width="70px",E.style.width="70px",C.value="0",S.value="0",E.value="0",C.onclick=function(){C.focus(),Z()},S.onclick=function(){S.focus(),Z()},E.onclick=function(){E.focus(),Z()},C.onchange=function(){Z()},S.onchange=function(){Z()},E.onchange=function(){Z()},C.onkeyup=function(){Z()},S.onkeyup=function(){Z()},E.onkeyup=function(){Z()},B.append("X: ",S),w.append("Y: ",C),k.append((0,l.LANG)("filter-transform-rotation")+": ",E),n||(0,r.BB).el({parent:y,css:{marginTop:"10px"}}).append(B,w,k);var L={marginLeft:"10px",marginTop:"10px"},A=(0,r.BB).el({parent:y,css:{display:"flex",flexWrap:"wrap",marginLeft:"-10px"}}),I=(0,r.BB).el({parent:A,tagName:"button",content:(0,l.LANG)("filter-transform-flip")+" X",onClick:function(){var e=q.getValue();q.setSize(-e.width,e.height)},css:L}),T=(0,r.BB).el({parent:A,tagName:"button",content:(0,l.LANG)("filter-transform-flip")+" Y",onClick:function(){var e=q.getValue();q.setSize(e.width,-e.height)},css:L}),P=(0,r.BB).el({parent:A,tagName:"button",content:"-90°",onClick:function(){var e=q.getValue();e.angleDeg-=90,e.angleDeg%=360,q.setAngleDeg(e.angleDeg),E.value=""+Math.round(e.angleDeg),K()},css:L}),R=(0,r.BB).el({parent:A,tagName:"button",content:"+90°",onClick:function(){var e=q.getValue();e.angleDeg+=90,e.angleDeg%=360,q.setAngleDeg(e.angleDeg),E.value=""+Math.round(e.angleDeg),K()},css:L}),M=(0,r.BB).el({parent:A,tagName:"button",content:"2x",onClick:function(){var e=q.getValue();N.getValue()?q.setSize(q.getRatio()*e.height*2,2*e.height):q.setSize(2*e.width,2*e.height)},css:L}),D=(0,r.BB).el({parent:A,tagName:"button",content:"1/2x",onClick:function(){var e=q.getValue();q.setSize(Math.round(e.width/2),Math.round(e.height/2))},css:L}),O=(0,r.BB).el({parent:A,tagName:"button",content:(0,l.LANG)("center"),onClick:function(){var e=q.getValue();q.setPos({x:t.canvas.width/2,y:t.canvas.height/2}),q.setAngleDeg(e.angleDeg),K()},css:L}),_=!0,N=new s.Checkbox({init:!0,label:(0,l.LANG)("filter-transform-constrain"),title:(0,l.LANG)("constrain-proportions"),allowTab:!0,callback:function(e){_=e,q.setIsConstrained(_)},css:{display:"inline-block"}}),z=!1,G=new s.Checkbox({init:!0,label:(0,l.LANG)("filter-transform-snap"),title:(0,l.LANG)("filter-transform-snap-title"),allowTab:!0,callback:function(e){z=e,q.setSnapping(z)},css:{display:"inline-block",marginLeft:"10px"}}),j=(0,r.BB).el();j.append(N.getElement(),G.getElement()),y.append((0,r.BB).el({css:{clear:"both",height:"10px"}}));var F=(0,r.BB).el({parent:y,css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),H=new o.Select({isFocusable:!0,optionArr:[["smooth",(0,l.LANG)("algorithm-smooth")],["pixelated",(0,l.LANG)("algorithm-pixelated")]],initValue:"smooth",title:(0,l.LANG)("scaling-algorithm"),onChange:function(){K(!0)}});F.append(j,H.getElement());for(var U=(0,r.BB).canvas(t.canvas.width,t.canvas.height),X=[],V=0;V<g.length;V++)X.push({image:V===f?U:g[V].context.canvas,isVisible:g[V].isVisible,opacity:g[V].opacity,mixModeStr:g[V].mixModeStr,hasClipping:!1});var W=new c.Preview({width:(0,d.getPreviewWidth)(n),height:(0,d.getPreviewHeight)(n),project:{width:t.canvas.width,height:t.canvas.height,layers:X},hasEditMode:!0,onModeChange:function(e){q.getElement().style.pointerEvents="edit"===e?"":"none",q.getElement().style.opacity="edit"===e?"":"0.5"},onTransformChange:function(e){q.setViewportTransform(e)},padding:30});W.render(),W.getElement().classList.add((0,u.css)({overflow:"hidden",marginLeft:"-20px",marginRight:"-20px"})),y.append(W.getElement());var Y="";function K(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(q){var t=q.getValue();if(JSON.stringify(t)!==Y||e){Y=JSON.stringify(t);var i=(0,r.BB).ctx(U);i.save(),i.clearRect(0,0,U.width,U.height),(0,r.BB).drawTransformedImageWithBounds(i,g[f].context.canvas,t,v,"pixelated"===H.getValue()||(0,r.BB).testShouldPixelate(t,t.width/m.width,t.height/m.height)),i.restore(),W.render()}}}var q=new a.FreeTransform({x:m.x,y:m.y,width:m.width,height:m.height,angleDeg:m.angleDeg,isConstrained:!0,snapX:[0,t.canvas.width],snapY:[0,t.canvas.height],callback:function(e){S.value=""+Math.round(e.x-m.x),C.value=""+Math.round(e.y-m.y),E.value=""+Math.round(e.angleDeg),K()},viewportTransform:W.getTransform()});function Z(){q.setPos({x:parseInt(S.value)+m.x,y:parseInt(C.value)+m.y}),q.setAngleDeg(parseInt(E.value)),K()}return(0,r.BB).css(q.getElement(),{position:"absolute",left:"0",top:"0"}),W.getElement().append(q.getElement()),K(),x.destroy=function(){b.destroy(),q.destroy(),N.destroy(),G.destroy(),(0,r.BB).destroyEl(I),(0,r.BB).destroyEl(T),(0,r.BB).destroyEl(P),(0,r.BB).destroyEl(R),(0,r.BB).destroyEl(M),(0,r.BB).destroyEl(D),(0,r.BB).destroyEl(O),W.destroy(),(0,r.BB).freeCanvas(U)},x.getInput=function(){var e=q.getValue(),t={transform:e,bounds:v,isPixelated:"pixelated"===H.getValue()||(0,r.BB).testShouldPixelate(e,e.width/m.width,e.height/m.height)};return x.destroy(),(0,r.BB).copyObj(t)},x},apply(e){var t=e.context,i=e.history;if(!t)return!1;null==i||i.pause(!0);var n=e.input,s=(0,r.BB).copyCanvas(t.canvas);return t.clearRect(0,0,t.canvas.width,t.canvas.height),(0,r.BB).drawTransformedImageWithBounds(t,s,n.transform,n.bounds,n.isPixelated),null==i||i.pause(!1),null==i||i.push({tool:["filter","transform"],action:"apply",params:[{input:n}]}),!0}}}),n("1CjeM",function(t,n){e(t.exports,"filterBlur",function(){return g});var r=i("aP0jf"),s=i("cH2YE"),a=i("a5EFw"),o=i("1mH1z"),l=i("9tQ35"),h=i("jpkXO");i("fDKZh");var c=i("elJSU"),u=i("eWjiX"),p=i("bh77f"),d=i("ChldL"),g={getDialog(e){var t=e.klCanvas,i=e.context;if(!t||!i)return!1;var n=t.getLayers(),a=t.getLayerIndex(i.canvas),g=(0,u.BB).el(),f={element:g},v=(0,p.testIsSmall)();v||(f.width=(0,d.getPreviewWidth)(v));var m=10,y=new l.FxPreviewRenderer({original:i.canvas,onUpdate:function(e,t){return e.multiplyAlpha().triangleBlur(m*t.scaleX).unmultiplyAlpha()}});return setTimeout(function(){var e=new r.KlSlider({label:(0,o.LANG)("radius"),width:300,height:30,min:1,max:200,value:m,eventResMs:s.eventResMs,onChange:function(e){m=e,u.render()}});e.getElement().style.marginBottom="10px",g.append(e.getElement());for(var t=[],l=0;l<n.length;l++)t.push({image:l===a?y.render:n[l].context.canvas,isVisible:n[l].isVisible,opacity:n[l].opacity,mixModeStr:n[l].mixModeStr,hasClipping:!1});var u=new h.Preview({width:(0,d.getPreviewWidth)(v),height:(0,d.getPreviewHeight)(v),project:{width:i.canvas.width,height:i.canvas.height,layers:t}});u.render(),u.getElement().classList.add((0,c.css)({marginLeft:"-20px",marginRight:"-20px"})),g.append(u.getElement()),f.destroy=function(){e.destroy(),y.destroy(),u.destroy()},f.getInput=function(){return f.destroy(),{radius:m}}},1),f},apply(e){var t=e.context,i=e.history,n=e.input.radius;if(!t||!n)return!1;null==i||i.pause(!0);var r=(0,a.getSharedFx)();if(!r)return!1;var s=r.texture(t.canvas);return r.draw(s).multiplyAlpha().triangleBlur(n).unmultiplyAlpha().update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(r,0,0),s.destroy(),null==i||i.pause(!1),null==i||i.push({tool:["filter","blur"],action:"apply",params:[{input:e.input}]}),!0}}}),n("dNWKZ",function(t,n){e(t.exports,"filterUnsharpMask",function(){return d});var r=i("aP0jf"),s=i("a5EFw"),a=i("1mH1z"),o=i("jpkXO"),l=i("jXowp"),h=i("9tQ35"),c=i("eWjiX"),u=i("bh77f"),p=i("ChldL"),d={getDialog(e){var t=e.context,i=e.klCanvas;if(!t||!i)return!1;var n=i.getLayers(),s=i.getLayerIndex(t.canvas),d=(0,c.BB).el(),g={element:d},f=(0,u.testIsSmall)();f||(g.width=(0,p.getPreviewWidth)(f));var v=2,m=.51,y=new h.FxPreviewRenderer({original:t.canvas,onUpdate:function(e,t){return e.unsharpMask(v*t.scaleX,m)}});return setTimeout(function(){function e(){x.render()}var i=new r.KlSlider({label:(0,a.LANG)("radius"),width:300,height:30,min:0,max:200,value:2,onChange:function(t){v=t,e()},curve:[[0,0],[.1,2],[.5,50],[1,200]]}),h=new r.KlSlider({label:(0,a.LANG)("filter-unsharp-mask-strength"),width:300,height:30,min:0,max:50,value:5.1,onChange:function(t){m=t/10,e()},curve:[[0,0],[.1,2],[.5,10],[1,50]]});i.getElement().style.marginBottom="10px",h.getElement().style.marginBottom="10px",d.append(i.getElement()),d.append(h.getElement());for(var c=[],u=0;u<n.length;u++)c.push({image:u===s?y.render:n[u].context.canvas,isVisible:n[u].isVisible,opacity:n[u].opacity,mixModeStr:n[u].mixModeStr,hasClipping:!1});var x=new o.Preview({width:(0,p.getPreviewWidth)(f),height:(0,p.getPreviewHeight)(f),project:{width:t.canvas.width,height:t.canvas.height,layers:c}});e(),x.getElement().classList.add((0,l.css)({marginLeft:"-20px",marginRight:"-20px"})),d.append(x.getElement()),g.destroy=function(){i.destroy(),h.destroy(),y.destroy(),x.destroy()},g.getInput=function(){return g.destroy(),{radius:v,strength:m}}},1),g},apply(e){var t=e.context,i=e.history,n=e.input.radius,r=e.input.strength;if(!t||null===n||null===r)return!1;null==i||i.pause(!0);var a=(0,s.getSharedFx)();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).unsharpMask(n,r).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),null==i||i.pause(!1),null==i||i.push({tool:["filter","unsharpMask"],action:"apply",params:[{input:e.input}]}),!0}}}),n("94Tq7",function(t,n){e(t.exports,"filterToAlpha",function(){return g});var r=i("iFIyy"),s=i("43qNf"),a=i("a5EFw"),o=i("1mH1z"),l=i("9tQ35"),h=i("jpkXO");i("fDKZh");var c=i("elJSU"),u=i("eWjiX"),p=i("bh77f"),d=i("ChldL"),g={getDialog(e){var t=e.context,i=e.klCanvas;if(!t||!i)return!1;var n=i.getLayers(),a=i.getLayerIndex(t.canvas),g=(0,u.BB).el(),f={element:g},v=(0,p.testIsSmall)();return v||(f.width=(0,d.getPreviewWidth)(v)),setTimeout(function(){var i=new l.FxPreviewRenderer({original:t.canvas,onUpdate:function(e){return e.toAlpha("inverted-luminance"===u,m)}}),u="inverted-luminance",p=new r.Options({optionArr:[{id:"inverted-luminance",label:(0,o.LANG)("filter-to-alpha-inverted-lum")},{id:"luminance",label:(0,o.LANG)("filter-to-alpha-lum")}],initId:u,onChange:function(e){u=e,w.render()}});g.append(p.getElement());var m={r:0,g:0,b:0,a:1},y=[null,{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1},{r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1},{r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1}],x=new s.ColorOptions({label:(0,o.LANG)("filter-to-alpha-replace"),colorArr:y,initialIndex:1,onChange:function(e){m=e,w.render()}});x.getElement().style.marginTop="10px",x.getElement().style.marginBottom="10px",g.append(x.getElement());for(var b=[],B=0;B<n.length;B++)b.push({image:B===a?i.render:n[B].context.canvas,isVisible:n[B].isVisible,opacity:n[B].opacity,mixModeStr:n[B].mixModeStr,hasClipping:!1});var w=new h.Preview({width:(0,d.getPreviewWidth)(v),height:(0,d.getPreviewHeight)(v),project:{width:t.canvas.width,height:t.canvas.height,layers:b}});w.render(),w.getElement().classList.add((0,c.css)({marginLeft:"-20px",marginRight:"-20px"})),g.append(w.getElement()),f.destroy=function(){p.destroy(),x.destroy(),i.destroy(),w.destroy()},f.getInput=function(){return f.destroy(),{sourceId:u,selectedRgbaObj:m}}},1),f},apply(e){var t=e.context,i=e.history,n=e.input.sourceId,r=e.input.selectedRgbaObj;if(!t||!n)return!1;null==i||i.pause(!0);var s=(0,a.getSharedFx)();if(!s)return!1;var o=s.texture(t.canvas);return s.draw(o).toAlpha("inverted-luminance"===n,r).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(s,0,0),o.destroy(),null==i||i.pause(!1),null==i||i.push({tool:["filter","toAlpha"],action:"apply",params:[{input:e.input}]}),!0}}}),n("d8Fqy",function(t,n){e(t.exports,"filterGrid",function(){return g});var r=i("eWjiX"),s=i("1mH1z"),a=i("dJPtW"),o=i("43qNf"),l=i("1xi6g"),h=i("7jh4K"),c=i("jpkXO");i("fDKZh");var u=i("elJSU"),p=i("bh77f"),d=i("ChldL"),g={getDialog(e){var t=e.context,i=e.klCanvas;if(!t||!i)return!1;var n=i.getLayers(),g=(0,h.throwIfNull)(i.getLayerIndex(t.canvas)),f=(0,r.BB).el(),v={element:f},m=(0,p.testIsSmall)();m||(v.width=(0,d.getPreviewWidth)(m));var y={x:2,y:2,thickness:8,color:"#000",opacity:1},x=(0,r.BB).el({parent:f,css:{display:"flex",alignItems:"center"}}),b=(0,r.BB).el({parent:f,css:{display:"flex",alignItems:"center",marginTop:"10px",marginBottom:"10px"}}),B=(0,a.input)({init:2,type:"number",min:1,css:{width:"75px",marginRight:"20px"},callback:function(e){y.x=parseFloat(e),R()}}),w=(0,a.input)({init:2,type:"number",min:1,css:{width:"75px",marginRight:"20px"},callback:function(e){y.y=parseFloat(e),R()}}),k=(0,a.input)({init:y.thickness,type:"number",min:1,css:{width:"75px",marginRight:"20px"},callback:function(e){y.thickness=parseFloat(e),R()}}),C={r:0,g:0,b:0,a:1},S=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];S.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),S.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1}),y.color=(0,r.BB).ColorConverter.toRgbStr(C);var E=new o.ColorOptions({label:(0,s.LANG)("shape-stroke"),colorArr:S,onChange:function(e){C=e,y.color=(0,r.BB).ColorConverter.toRgbStr(C),R()}}),L={display:"inline-block",marginRight:"5px"};x.append((0,r.BB).el({content:"X:",css:L}),B,(0,r.BB).el({content:"Y:",css:L}),w),b.append((0,r.BB).el({content:(0,s.LANG)("shape-line-width")+":",css:L}),k,(0,r.BB).el({css:{flexGrow:"1"}}),E.getElement());var A=(0,r.BB).canvas(t.canvas.width,t.canvas.height),I=(0,r.BB).ctx(A),T=n.map(function(e,t){return{image:t===g?A:e.context.canvas,isVisible:e.isVisible,opacity:e.opacity,mixModeStr:e.mixModeStr,hasClipping:!1}}),P=new c.Preview({width:(0,d.getPreviewWidth)(m),height:(0,d.getPreviewHeight)(m),project:{width:t.canvas.width,height:t.canvas.height,layers:T}});function R(){I.save(),I.clearRect(0,0,A.width,A.height),I.drawImage(t.canvas,0,0),(0,l.drawGrid)(I,y.x,y.y,Math.max(y.thickness,1),y.color,y.opacity),I.restore(),P.render()}return P.getElement().classList.add((0,u.css)({marginLeft:"-20px",marginRight:"-20px"})),f.append(P.getElement()),R(),P.render(),v.destroy=function(){P.destroy(),(0,r.BB).freeCanvas(A),E.destroy()},v.getInput=function(){return v.destroy(),(0,r.BB).copyObj(y)},v},apply(e){var t=e.context,i=e.klCanvas,n=e.history;return!!t&&!!i&&(null==n||n.pause(!0),(0,l.drawGrid)(t,e.input.x,e.input.y,e.input.thickness,e.input.color,e.input.opacity),null==n||n.pause(!1),null==n||n.push({tool:["filter","grid"],action:"apply",params:[{input:e.input}]}),!0)}}}),n("1xi6g",function(t,i){e(t.exports,"drawGrid",function(){return n});function n(e,t,i,n,r,s){e.save();var a=e.canvas.width,o=e.canvas.height,l=(n=Math.round(n))%2==0;e.beginPath(),e.lineWidth=n,e.strokeStyle=r,e.globalAlpha=s;for(var h=0;h<t-1;h++){var c=a/t*(h+1);c=l?Math.round(c):Math.round(c+.5)-.5,e.moveTo(c,0),e.lineTo(c,o)}for(var u=0;u<i-1;u++){var p=o/i*(u+1);p=l?Math.round(p):Math.round(p+.5)-.5,e.moveTo(0,p),e.lineTo(a,p)}e.stroke(),e.restore()}}),n("gtdB1",function(t,n){e(t.exports,"filterNoise",function(){return k});var r=i("eWjiX"),s=i("1mH1z"),a=i("aP0jf"),o=i("a5EFw"),l=i("iFIyy"),h=i("cH2YE"),c=i("eEL9N"),u=i("bBcC4"),p=i("hrnUX"),d=i("dJ1E2"),g=i("7bWhB"),f=i("7jh4K"),v=i("9tQ35"),m=i("jpkXO");i("fDKZh");var y=i("elJSU"),x=i("ChldL"),b=i("bh77f"),B=[{type:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0,octaves:1,samples:1,peaks:0,brightness:0,contrast:0,isReversed:!0},{type:1,scaleX:166,scaleY:164,offsetX:105,offsetY:30,octaves:6,samples:1,peaks:0,brightness:.055,contrast:.23,isReversed:!0},{type:1,scaleX:235,scaleY:190,offsetX:3227,offsetY:2156,octaves:4,samples:16,peaks:22,brightness:-.375,contrast:1,isReversed:!1},{type:1,scaleX:40,scaleY:40,offsetX:0,offsetY:0,octaves:1,samples:1,peaks:0,brightness:0,contrast:0,isReversed:!1},{type:0,scaleX:26,scaleY:26,offsetX:557,offsetY:365,octaves:1,samples:1,peaks:0,brightness:.02,contrast:1,isReversed:!0},{type:1,scaleX:1500,scaleY:1500,offsetX:745,offsetY:2871,octaves:5,samples:16,peaks:156.02,brightness:.03,contrast:1,isReversed:!0},{type:1,scaleX:11,scaleY:11,offsetX:2940,offsetY:2045,octaves:1,samples:16,peaks:1,brightness:-.045,contrast:1,isReversed:!0},{type:2,scaleX:74,scaleY:74,offsetX:4816,offsetY:1304,octaves:3,samples:1,peaks:2.78,brightness:0,contrast:0,isReversed:!1}];function w(e,t){e.noise(t.seed,t.type,[t.scaleX,t.scaleY],[e.width/2,e.height/2],t.octaves,t.samples,t.peaks,t.brightness,t.contrast,t.isReversed,t.colA,t.colB,t.channels?t.channels:"rgb").update()}var k={getDialog(e){var t=e.context,i=e.klCanvas;if(!t||!i)return!1;var n=i.getLayers(),k=(0,f.throwIfNull)(i.getLayerIndex(t.canvas)),C=[],S=(0,f.throwIfNull)((0,o.getSharedFx)()),E=(0,r.BB).canvas(32,32),L=(0,r.BB).ctx(E),A=S.texture(E);S.draw(A).update(),A.destroy(),B.forEach(function(e){var t=new Image,i=(0,r.BB).copyObj(e);i.scaleX/=10,i.scaleY/=10,w(S,i),L.drawImage(S,0,0),t.src=E.toDataURL("image/png"),C.push(t)}),A.destroy();var I=(0,r.BB).el(),T={element:I},P=(0,b.testIsSmall)();P||(T.width=(0,x.getPreviewWidth)(P));var R={seed:300*Math.random(),presetIndex:0,scale:50,opacity:.5,isReversed:!1,channels:"rgb",mixModeStr:"source-over",colA:{r:0,g:0,b:0},colB:{r:255,g:255,b:255}},M=new l.Options({optionArr:C.map(function(e,t){return(0,r.BB).css(e,{margin:"1px",borderRadius:"3px",transition:"all 0.1s ease-in-out"}),{id:""+t,label:e}}),initId:"0",onChange:function(e){R.presetIndex=Number(e),q()}});M.getElement().style.marginBottom="10px",I.append(M.getElement());var D=new a.KlSlider({label:(0,s.LANG)("filter-noise-scale"),width:300,height:30,min:1,max:1e3,value:R.scale,eventResMs:h.eventResMs,curve:(0,r.BB).quadraticSplineInput(1,1e3,.1),onChange:function(e){R.scale=e,q()}});D.getElement().style.marginBottom="10px";var O=new a.KlSlider({label:(0,s.LANG)("opacity"),width:300,height:30,min:.01,max:1,value:R.opacity,eventResMs:h.eventResMs,toValue:function(e){return e/100},toDisplayValue:function(e){return 100*e},onChange:function(e){R.opacity=e,q()}});O.getElement().style.marginBottom="10px";var _=(0,r.BB).el({css:{display:"flex",alignItems:"center",marginBottom:"10px"}}),N=(0,r.BB).el({css:{display:"flex",marginBottom:"10px"}}),z=new l.Options({optionArr:[{id:"rgb",label:"RGB"},{id:"alpha",label:(0,s.LANG)("filter-noise-alpha")}],initId:"rgb",onChange:function(e){R.channels=e,"rgb"===e?N.style.visibility="":N.style.visibility="hidden",q()}}),G=new g.Checkbox({label:(0,s.LANG)("reverse"),callback:function(e){R.isReversed=e,q()},allowTab:!0}),j=new c.Select({isFocusable:!0,optionArr:["source-over",void 0,"darken","multiply","color-burn",void 0,"lighten","screen","color-dodge",void 0,"overlay","soft-light","hard-light",void 0,"difference","exclusion",void 0,"hue","saturation","color","luminosity"].map(function(e){return e?[e,(0,u.translateBlending)(e)]:void 0}),initValue:R.mixModeStr,onChange:function(e){R.mixModeStr=e,q()}});j.getElement().title=(0,s.LANG)("layers-blending");var F=(0,r.BB).el({css:{display:"flex"}}),H={width:"34px",height:"34px",marginRight:"5px"},U=(0,p.KL).input({type:"color",init:"#"+(0,d.ColorConverter).toHexString(R.colA),callback:function(e){var t=(0,d.ColorConverter).hexToRGB(e);t&&(R.colA=t,q())},css:H}),X=(0,p.KL).input({type:"color",init:"#"+(0,d.ColorConverter).toHexString(R.colB),callback:function(e){var t=(0,d.ColorConverter).hexToRGB(e);t&&(R.colB=t,q())},css:H});F.append(U,X),_.append(z.getElement(),(0,r.BB).el({css:{flexGrow:"1"}}),G.getElement()),N.append(j.getElement(),(0,r.BB).el({css:{flexGrow:"1"}}),F),I.append(D.getElement(),O.getElement(),_,N);for(var V=new v.FxPreviewRenderer({original:t.canvas,onUpdate:function(e,i){var n=(0,r.BB).copyObj(B[R.presetIndex]);return n.seed=R.seed,n.scaleX=n.scaleX*R.scale/50*i.scaleX,n.scaleY=n.scaleY*R.scale/50*i.scaleY,n.colA=R.colA,n.colB=R.colB,n.isReversed=R.isReversed?!n.isReversed:n.isReversed,n.channels=R.channels,n.offsetX=t.canvas.width/2*i.scaleX+i.x,n.offsetY=t.canvas.height/2*i.scaleY+i.y,e.noise(n.seed,n.type,[n.scaleX,n.scaleY],[n.offsetX,n.offsetY],n.octaves,n.samples,n.peaks,n.brightness,n.contrast,n.isReversed,n.colA,n.colB,n.channels?n.channels:"rgb")},postMix:{opacity:R.opacity,operation:"alpha"===R.channels?"destination-out":R.mixModeStr}}),W=[],Y=0;Y<n.length;Y++)W.push({image:Y===k?V.render:n[Y].context.canvas,isVisible:n[Y].isVisible,opacity:n[Y].opacity,mixModeStr:n[Y].mixModeStr,hasClipping:!1});var K=new m.Preview({width:(0,x.getPreviewWidth)(P),height:(0,x.getPreviewHeight)(P),project:{width:t.canvas.width,height:t.canvas.height,layers:W}});function q(){V.setPostMix({opacity:R.opacity,operation:"alpha"===R.channels?"destination-out":R.mixModeStr}),K.render()}return K.render(),K.getElement().classList.add((0,y.css)({marginLeft:"-20px",marginRight:"-20px"})),I.append(K.getElement()),T.destroy=function(){M.destroy(),D.destroy(),O.destroy(),G.destroy(),z.destroy(),j.destroy(),K.destroy(),V.destroy()},T.getInput=function(){return T.destroy(),(0,r.BB).copyObj(R)},T},apply(e){var t=e.context,i=e.klCanvas,n=e.history;if(!t||!i)return!1;null==n||n.pause(!0);var s=(0,o.getSharedFx)();if(!s)return!1;var a=s.texture(t.canvas);s.draw(a).update(),a.destroy();var l=e.input,h=(0,r.BB).copyObj(B[l.presetIndex]);return h.seed=l.seed,h.scaleX=h.scaleX*l.scale/50,h.scaleY=h.scaleY*l.scale/50,h.colA=l.colA,h.colB=l.colB,h.isReversed=l.isReversed?!h.isReversed:h.isReversed,h.channels=l.channels,w(s,h),t.save(),t.globalAlpha=l.opacity,"alpha"===l.channels?t.globalCompositeOperation="destination-out":t.globalCompositeOperation=l.mixModeStr,t.drawImage(s,0,0),t.restore(),null==n||n.pause(!1),null==n||n.push({tool:["canvas"],action:"replaceLayer",params:[i.getLayerIndex(t.canvas),t.getImageData(0,0,t.canvas.width,t.canvas.height)]}),!0}}}),n("lQzx7",function(t,n){e(t.exports,"filterPattern",function(){return f});var r=i("eWjiX"),s=i("dJPtW"),a=i("aP0jf"),o=i("1mH1z"),l=i("cH2YE"),h=i("5UrL9"),c=i("5vheV"),u=i("7jh4K"),p=i("bh77f"),d=i("ChldL");function g(e,t){var i=t.blend?Math.round(t.blend*t.width/2):0,n=t.blend?Math.round(t.blend*t.height/2):0,s=(0,r.BB).canvas(t.width,t.height);if(t.blend){var a=(0,r.BB).canvas(2*t.width,2*t.height),o=(0,r.BB).ctx(a),l="#0000",h="#000";o.drawImage(e.canvas,-t.x+i,-t.y+n),o.save();var c=o.createLinearGradient(0,t.height,0,2*t.height);c.addColorStop(0,h),c.addColorStop(t.blend,l),o.globalCompositeOperation="destination-in",o.fillStyle=c,o.fillRect(0,0,a.width,a.height),o.restore(),o.save(),(c=o.createLinearGradient(0,0,0,t.height)).addColorStop(0,l),c.addColorStop(t.blend,h),o.globalCompositeOperation="destination-in",o.fillStyle=c,o.fillRect(0,0,2*t.width,2*t.height),o.restore(),o.save(),o.globalCompositeOperation="lighter",o.drawImage(a,0,-t.height),o.restore(),o.save(),(c=o.createLinearGradient(t.width,0,2*t.width,0)).addColorStop(0,h),c.addColorStop(t.blend,l),o.globalCompositeOperation="destination-in",o.fillStyle=c,o.fillRect(0,0,a.width,a.height),o.restore(),o.save(),(c=o.createLinearGradient(0,0,t.width,0)).addColorStop(0,l),c.addColorStop(t.blend,h),o.globalCompositeOperation="destination-in",o.fillStyle=c,o.fillRect(0,0,2*t.width,2*t.height),o.restore(),o.save(),o.globalCompositeOperation="lighter",o.drawImage(a,-t.width,0),o.restore(),(0,r.BB).ctx(s).drawImage(a,0,0)}else(0,r.BB).ctx(s).drawImage(e.canvas,-t.x,-t.y);e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.translate(t.offsetX-i,t.offsetY-n),e.fillStyle=(0,u.throwIfNull)(e.createPattern(s,"repeat")),e.fillRect(-t.offsetX+i,-t.offsetY+n,e.canvas.width,e.canvas.height),e.restore()}var f={getDialog(e){var t,i=(0,p.testIsSmall)(),n=(0,r.BB).el(),f=e.context,v=f.canvas.width,m=f.canvas.height,y={x:0,y:0,width:v<=250?Math.round(v/4):200,height:m<=250?Math.round(m/4):200,blend:0,offsetX:0,offsetY:0},x=(0,r.BB).canvasBounds(f);x&&x.width<=1024&&x.height<=1024&&(x.width<.75*v||x.height<.75*m)?(y.x=x.x,y.y=x.y,y.width=x.width,y.height=x.height):(y.x=Math.round(v/2-y.width/2),y.y=Math.round(m/2-y.height/2));var b=(0,s.input)({init:y.x,type:"number",min:0,max:v,css:{width:"100%"},callback:function(e){y.x=Number(e),Z()}}),B=(0,s.input)({init:y.y,type:"number",min:0,max:m,css:{width:"100%"},callback:function(e){y.y=Number(e),Z()}}),w=(0,s.input)({init:y.width,type:"number",min:1,max:Math.min(1024,v),css:{width:"100%"},callback:function(e){y.width=Number(e),Z()}}),k=(0,s.input)({init:y.height,type:"number",min:1,max:Math.min(1024,m),css:{width:"100%"},callback:function(e){y.height=Number(e),Z()}}),C={marginLeft:"5px",flex:"1"};n.append((0,r.BB).el({content:[(0,r.BB).el({tagName:"label",content:["X:",b],css:C}),(0,r.BB).el({tagName:"label",content:["Y:",B],css:C}),(0,r.BB).el({tagName:"label",content:[(0,o.LANG)("width")+":",w],css:C}),(0,r.BB).el({tagName:"label",content:[(0,o.LANG)("height")+":",k],css:C})],css:{display:"flex",marginLeft:"-5px"}}));var S=new a.KlSlider({label:(0,o.LANG)("brush-blending"),width:300,height:30,min:0,max:1,value:y.blend,eventResMs:l.eventResMs,onChange:function(e){y.blend=e,Z()},formatFunc:function(e){return(0,r.BB).round(e,2)},manualInputRoundDigits:2});(0,r.BB).css(S.getElement(),{margin:"10px 0"}),n.append(S.getElement());var E=1,L=new c.TwoTabs({left:(0,o.LANG)("compare-before"),right:(0,o.LANG)("compare-after"),init:E,onChange:function(e){E=e,F.style.display=0===e?"block":"none",Z(!0)}});n.append(L.getElement());var A=e.klCanvas,I=A.getLayers(),T=(0,u.throwIfNull)(A.getLayerIndex(f.canvas)),P=(0,r.BB).fitInto(f.canvas.width,f.canvas.height,i?280:490,i?200:240,1),R=parseInt(""+P.width),M=parseInt(""+P.height),D=Math.min(R,f.canvas.width),O=Math.min(M,f.canvas.height),_=R/f.canvas.width,N=(0,r.BB).el({className:"kl-preview-wrapper",css:{width:(0,d.getPreviewWidth)(i)+"px",height:(0,d.getPreviewHeight)(i)+"px",marginTop:"0"}}),z={image:(0,r.BB).canvas(D,O),isVisible:I[T].isVisible,opacity:I[T].opacity,mixModeStr:I[T].mixModeStr},G=I.map(function(e,t){return t===T?z:{image:e.context.canvas,isVisible:e.isVisible,opacity:e.opacity,mixModeStr:e.mixModeStr}}),j=new h.KlCanvasPreview({width:Math.round(R),height:Math.round(M),layers:G}),F=(0,r.BB).canvas(R,M);(0,r.BB).css(F,{position:"absolute",left:"0",top:"0",mixBlendMode:"difference",imageRendering:"pixelated"});var H=(0,r.BB).el({className:"kl-preview-wrapper__canvas",css:{width:parseInt(""+R)+"px",height:parseInt(""+M)+"px"}});H.append(j.getElement(),F),N.append(H),n.append(N);var U={};function X(){b.value=""+y.x,B.value=""+y.y,w.value=""+y.width,k.value=""+y.height}var V=new r.BB.KeyListener({});N.oncontextmenu=function(){return!1},H.style.touchAction="none";var W=new r.BB.PointerListener({target:H,onPointer:function(e){if(0===E){if("pointerdown"===e.type){if(!U.state){U.oldSettings=(0,r.BB).copyObj(y);var t=e.relX/_,i=e.relY/_;(0,r.BB).isInsideRect({x:t,y:i},{x:y.x,y:y.y,width:y.width,height:y.height})?U.state="move":U.state="select",U.start={x:t,y:i}}}else if("pointermove"===e.type){var n=e.relX/_,s=e.relY/_;if("select"===U.state){U.end={x:n,y:s};var a=Math.max(0,Math.min(U.start.x,U.end.x)),o=Math.max(0,Math.min(U.start.y,U.end.y)),l=Math.min(v,Math.max(U.start.x,U.end.x)),h=Math.min(m,Math.max(U.start.y,U.end.y));y.x=Math.floor(a),y.y=Math.floor(o),y.width=Math.min(1024,Math.ceil(l-y.x)),y.height=Math.min(1024,Math.ceil(h-y.y)),V.isPressed("shift")&&(y.width=Math.min(y.width,y.height),y.height=Math.min(y.width,y.height)),(0===y.width||0===y.height)&&(y=(0,r.BB).copyObj(U.oldSettings)),X(),Z()}else if("move"===U.state){var c=Math.round(n-U.start.x),u=Math.round(s-U.start.y);y.x=(0,r.BB).clamp(U.oldSettings.x+c,0,v-y.width),y.y=(0,r.BB).clamp(U.oldSettings.y+u,0,m-y.height),X(),Z()}}else"pointerup"===e.type&&U.state&&(U.state=null)}else"pointerdown"===e.type?U.state||(U.state="move",U.oldSettings=(0,r.BB).copyObj(y),U.start={x:e.relX/_,y:e.relY/_},U.end=null):"pointermove"===e.type?U.state&&(U.end={x:e.relX/_,y:e.relY/_},y.offsetX=Math.round(U.end.x-U.start.x)+U.oldSettings.offsetX,y.offsetY=Math.round(U.end.y-U.start.y)+U.oldSettings.offsetY,Z()):"pointerup"===e.type&&U.state&&(U.end||(y.offsetX=0,y.offsetY=0,Z()),U.state=null)}}),Y=(0,r.BB).canvas(v,m),K=(0,r.BB).ctx(Y);function q(e,t,i,n,r){var s=Math.round(t+.5)-.5,a=Math.round(i+.5)-.5,o=Math.round(t+n-s),l=Math.round(i+r-a);e.strokeRect(s,a,o,l)}function Z(e){if(e||!t||JSON.stringify(t)!==JSON.stringify(y)){if(0===E){K.clearRect(0,0,v,m),K.drawImage(f.canvas,0,0);var i=z.image,n=(0,r.BB).ctx(i);n.save(),n.clearRect(0,0,D,O),n.drawImage(Y,0,0,D,O),n.restore();var s=y.width*_,a=y.height*_,o=(0,r.BB).ctx(F);o.save(),o.clearRect(0,0,R,M),o.strokeStyle="#fff",q(o,y.x*_,y.y*_,s,a),y.blend>.05&&(o.strokeStyle="#f0f",q(o,y.x*_-s/2*y.blend,y.y*_-a/2*y.blend,s*(1+y.blend),a*(1+y.blend))),o.restore()}else{K.clearRect(0,0,v,m),K.drawImage(f.canvas,0,0),g(K,y);var l=z.image,h=(0,r.BB).ctx(l);h.clearRect(0,0,D,O),h.drawImage(Y,0,0,D,O)}j.render(),t=(0,r.BB).copyObj(y)}}Z();var $=function(){S.destroy(),V.destroy(),W.destroy(),j.destroy()},Q={element:n,destroy:$,getInput:function(){return $(),(0,r.BB).copyObj(y)}};return i||(Q.width=d.mediumPreview.width),Q},apply(e){var t=e.klCanvas,i=e.context,n=e.history;return!!t&&(null==n||n.pause(!0),g(i,e.input),null==n||n.pause(!1),null==n||n.push({tool:["filter","pattern"],action:"apply",params:[{input:e.input}]}),!0)}}}),n("10iZP",function(t,n){e(t.exports,"filterDistort",function(){return m});var r=i("eWjiX"),s=i("aP0jf"),a=i("1mH1z"),o=i("cH2YE"),l=i("a5EFw"),h=i("iFIyy"),c=i("7bWhB"),u=i("7jh4K"),p=i("9tQ35"),d=i("jpkXO");i("fDKZh");var g=i("elJSU"),f=i("bh77f"),v=i("ChldL"),m={getDialog(e){var t=(0,f.testIsSmall)(),i=(0,r.BB).el(),n=e.context,m=!0,y={stepSize:1,distortType:0,scale:{x:100,y:100},strength:{x:20,y:20},phase:{x:0,y:0},offset:{x:0,y:0}},x=[],b=(0,r.BB).canvas(32,32),B=(0,r.BB).ctx(b);B.beginPath(),B.arc(16,16,12.8,0,2*Math.PI),B.fill();var w=B.createLinearGradient(0,0,32,32);w.addColorStop(0,"#00f"),w.addColorStop(.5,"#f00"),w.addColorStop(1,"#fff"),B.fillStyle=w,B.globalCompositeOperation="source-atop",B.fillRect(0,0,32,32),(w=B.createLinearGradient(32,0,0,32)).addColorStop(0,"#000"),w.addColorStop(1,"#000"),B.fillStyle=w,B.globalCompositeOperation="destination-atop",B.fillRect(0,0,32,32);var k=(0,u.throwIfNull)((0,l.getSharedFx)()),C=k.texture(b);k.draw(C).update(),[0,1,2].forEach(function(e){var t=new Image,i=(0,r.BB).copyObj(y);i.distortType=e,i.scale.x/=20,i.scale.y/=20,i.strength.x/=20,i.strength.y/=20,k.draw(C).multiplyAlpha().distort(i).unmultiplyAlpha().update(),B.clearRect(0,0,32,32),B.drawImage(k,0,0),t.src=b.toDataURL("image/png"),x.push(t)}),C.destroy();var S=(0,r.BB).el({parent:i,css:{display:"flex",alignItems:"center"}}),E=new h.Options({optionArr:x.map(function(e,t){return(0,r.BB).css(e,{margin:"1px",borderRadius:"3px",transition:"all 0.1s ease-in-out"}),{id:""+t,label:e}}),initId:"0",onChange:function(e){y.distortType=Number(e),j.render()}});function L(e){"x"===e?(y.scale.y=y.scale.x,y.strength.y=y.strength.x,y.phase.y=y.phase.x,M[3].setValue(y.scale.y),M[4].setValue(y.strength.y),M[5].setValue(y.phase.y)):(y.scale.x=y.scale.y,y.strength.x=y.strength.y,y.phase.x=y.phase.y,M[0].setValue(y.scale.x),M[1].setValue(y.strength.x),M[2].setValue(y.phase.x)),j.render()}var A=new c.Checkbox({init:!0,label:(0,a.LANG)("filter-distort-sync-xy"),callback:function(e){(m=e)&&L("x")}});S.append(E.getElement(),(0,r.BB).el({css:{flexGrow:"1"}}),A.getElement());var I=(0,r.BB).el({parent:i,css:{display:"flex",flexWrap:"wrap"}}),T=(0,r.BB).el({parent:I,css:{marginRight:"10px"}}),P=(0,r.BB).el({parent:I}),R=t?300:245,M=[];["x","y"].forEach(function(e,t){var i=0===t?T:P,n=new s.KlSlider({label:(0,a.LANG)("filter-noise-scale")+" "+e.toUpperCase(),width:R,height:30,min:1,max:1e3,curve:"quadratic",value:y.scale[e],eventResMs:o.eventResMs,onChange:function(t){y.scale[e]=t,m?L(e):j.render()}});n.getElement().style.marginTop="20px",i.append(n.getElement());var l=new s.KlSlider({label:(0,a.LANG)("filter-unsharp-mask-strength")+" "+e.toUpperCase(),width:R,height:30,min:0,max:200,curve:"quadratic",value:y.strength[e],eventResMs:o.eventResMs,onChange:function(t){y.strength[e]=t,m?L(e):j.render()}});l.getElement().style.marginTop="10px",i.append(l.getElement());var h=new s.KlSlider({label:(0,a.LANG)("filter-distort-phase")+" "+e.toUpperCase(),width:R,height:30,min:0,max:1,value:y.phase[e],manualInputRoundDigits:2,eventResMs:o.eventResMs,formatFunc:function(e){return(0,r.BB).round(e,2)},onChange:function(t){y.phase[e]=t,m?L(e):j.render()}});h.getElement().style.marginTop="10px",i.append(h.getElement()),M.push(n),M.push(l),M.push(h)});var D=new s.KlSlider({label:(0,a.LANG)("filter-distort-stepsize"),width:300,height:30,min:1,max:300,curve:"quadratic",value:y.stepSize,eventResMs:o.eventResMs,onChange:function(e){y.stepSize=Math.round(e),j.render()}});D.getElement().style.marginTop="20px",D.getElement().style.marginBottom="10px",i.append(D.getElement());var O=e.klCanvas,_=O.getLayers(),N=(0,u.throwIfNull)(O.getLayerIndex(n.canvas)),z=new p.FxPreviewRenderer({original:n.canvas,onUpdate:function(e,t){var i=(0,r.BB).copyObj(y);return i.stepSize*=t.scaleX,i.strength.x*=t.scaleX,i.strength.y*=t.scaleY,2!==i.distortType&&(i.scale.x*=t.scaleX,i.scale.y*=t.scaleY),i.offset.x=-t.x,i.offset.y=-t.y,e.multiplyAlpha().distort(i).unmultiplyAlpha()}}),G=_.map(function(e,t){return{image:t===N?z.render:e.context.canvas,isVisible:e.isVisible,opacity:e.opacity,mixModeStr:e.mixModeStr,hasClipping:!1}}),j=new d.Preview({width:(0,v.getPreviewWidth)(t),height:(0,v.getPreviewHeight)(t),project:{width:n.canvas.width,height:n.canvas.height,layers:G}});j.render(),j.getElement().classList.add((0,g.css)({marginLeft:"-20px",marginRight:"-20px"})),i.append(j.getElement());var F=function(){E.destroy(),M.forEach(function(e){return e.destroy()}),D.destroy(),A.destroy(),z.destroy(),j.destroy()},H={element:i,destroy:F,getInput:function(){return F(),(0,r.BB).copyObj(y)}};return t||(H.width=v.mediumPreview.width),H},apply(e){var t=e.klCanvas,i=e.context,n=e.history;if(!t)return!1;null==n||n.pause(!0);var r=(0,l.getSharedFx)();if(!r)return!1;var s=r.texture(i.canvas);return r.draw(s).multiplyAlpha().distort(e.input).unmultiplyAlpha().update(),i.clearRect(0,0,i.canvas.width,i.canvas.height),i.drawImage(r,0,0),s.destroy(),null==n||n.pause(!1),null==n||n.push({tool:["filter","distort"],action:"apply",params:[{input:e.input}]}),!0}}}),n("dteOZ",function(t,n){e(t.exports,"filterVanishPoint",function(){return v});var r=i("eWjiX"),s=i("1mH1z"),a=i("dJPtW"),o=i("43qNf"),l=i("jsIPR"),h=i("aP0jf"),c=i("cH2YE"),u=i("7jh4K"),p=i("jpkXO"),d=i("3xvcu"),g=i("bh77f"),f=i("ChldL"),v={getDialog(e){var t=e.context,i=e.klCanvas;if(!t||!i)return!1;var n=i.getLayers(),v=(0,u.throwIfNull)(i.getLayerIndex(t.canvas)),m=(0,r.BB).canvas(t.canvas.width,t.canvas.height),y=(0,r.BB).ctx(m),x=(0,r.BB).el(),b={element:x},B=(0,g.testIsSmall)();B||(b.width=(0,f.getPreviewWidth)(B));var w={x:t.canvas.width/2,y:t.canvas.height/2,lines:8,thickness:2,color:{r:0,g:0,b:0},opacity:1},k=new h.KlSlider({label:(0,s.LANG)("filter-vanish-point-lines"),width:300,height:30,min:2,max:20,value:w.lines,curve:"quadratic",eventResMs:c.eventResMs,onChange:function(e){w.lines=Math.round(e),M()}});k.getElement().style.marginBottom="10px",x.append(k.getElement());var C=(0,r.BB).el({parent:x,css:{display:"flex",alignItems:"center"}}),S=(0,r.BB).el({parent:x,css:{display:"flex",alignItems:"center",marginTop:"10px",marginBottom:"10px"}}),E=(0,a.input)({init:w.x,type:"number",css:{width:"75px",marginRight:"20px"},callback:function(e){w.x=parseFloat(e),z.setValue({x:w.x,y:w.y}),M()}}),L=(0,a.input)({init:w.y,type:"number",css:{width:"75px",marginRight:"20px"},callback:function(e){w.y=parseFloat(e),z.setValue({x:w.x,y:w.y}),M()}}),A=(0,a.input)({init:2,type:"number",min:1,css:{width:"75px",marginRight:"20px"},callback:function(e){w.thickness=parseFloat(e),M()}}),I={r:0,g:0,b:0,a:1},T=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];T.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),T.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1}),w.color=(0,r.BB).copyObj(I);var P=new o.ColorOptions({label:(0,s.LANG)("shape-stroke"),colorArr:T,onChange:function(e){I=e,w.color=(0,r.BB).copyObj(I),M()}}),R={display:"inline-block",marginRight:"5px"};function M(){var e=m.width,i=m.height;y.save(),y.clearRect(0,0,e,i),y.drawImage(t.canvas,0,0,e,i),(0,l.drawVanishPoint)(y,w.x,w.y,w.lines,Math.max(w.thickness,1),w.color,w.opacity),y.restore(),N.render()}C.append((0,r.BB).el({content:"X:",css:R}),E,(0,r.BB).el({content:"Y:",css:R}),L),S.append((0,r.BB).el({content:(0,s.LANG)("shape-line-width")+":",css:R}),A,(0,r.BB).el({css:{flexGrow:"1"}}),P.getElement());for(var D=function(){return z.setTransform(N.getTransform()),m},O=[],_=0;_<n.length;_++)O.push({image:_===v?D:n[_].context.canvas,isVisible:n[_].isVisible,opacity:n[_].opacity,mixModeStr:n[_].mixModeStr,hasClipping:!1});var N=new p.Preview({width:(0,f.getPreviewWidth)(B),height:(0,f.getPreviewHeight)(B),project:{width:t.canvas.width,height:t.canvas.height,layers:O}});(0,r.BB).css(N.getElement(),{marginLeft:"-20px",marginRight:"-20px",overflow:"hidden"});var z=new d.DraggableInput({value:{x:w.x,y:w.y},onChange:function(e){w.x=Math.round(e.x),w.y=Math.round(e.y),E.value=""+w.x,L.value=""+w.y,M()}});return M(),N.getElement().append(z.getElement()),x.append(N.getElement()),b.destroy=function(){k.destroy(),P.destroy(),N.destroy()},b.getInput=function(){return b.destroy(),(0,r.BB).copyObj(w)},b},apply(e){var t=e.context,i=e.klCanvas,n=e.history;return!!t&&!!i&&(null==n||n.pause(!0),(0,l.drawVanishPoint)(t,e.input.x,e.input.y,e.input.lines,e.input.thickness,e.input.color,e.input.opacity),null==n||n.pause(!1),null==n||n.push({tool:["filter","vanishPoint"],action:"apply",params:[{input:e.input}]}),!0)}}}),n("jsIPR",function(t,n){e(t.exports,"drawVanishPoint",function(){return a});var r=i("3ujzu"),s=i("eWjiX");function a(e,t,i,n,a,o,l){e.save();for(var h=180/n,c=0;c<180;c+=h){var u=(0,s.BB).rotateAround({x:t,y:i},{x:t+9999,y:i},c);(0,r.drawShape)(e,{type:"line",x1:t,y1:i,x2:u.x,y2:u.y,isOutwards:!0,opacity:l,strokeRgb:o,lineWidth:a})}e.restore()}}),n("3WOmu",function(t,n){e(t.exports,"klCanvasToPsdBlob",function(){return l});var r=i("1LaJZ"),s=i("2gUX3"),a=i("hrnUX"),o=i("iVf04");function l(e){return h.apply(this,arguments)}function h(){return(h=(0,r._)(function(e){var t,i;return(0,s.__generator)(this,function(n){switch(n.label){case 0:return t=e.getLayersFast(),i={width:e.getWidth(),height:e.getHeight(),children:t.map(function(e){return{name:e.name,hidden:!e.isVisible,opacity:e.opacity,canvas:e.canvas,blendMode:(0,a.KL).PSD.blendKlToPsd(e.mixModeStr),left:0,top:0}})},[4,(0,o.loadAgPsd)()];case 1:return[2,new Blob([n.sent().writePsdBuffer(i)],{type:"application/octet-stream"})]}})})).apply(this,arguments)}}),n("iuTWx",function(t,n){e(t.exports,"LineSmoothing",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.smoothing=(0,a.BB).clamp(t.smoothing,0,1)}return(0,s._)(e,[{key:"chainIn",value:function(e){var t=this;if(e=(0,a.BB).copyObj(e),this.timeout&&clearTimeout(this.timeout),this.interval&&clearInterval(this.interval),"down"===e.type&&(this.lastMixedInput={x:e.x,y:e.y,pressure:e.pressure}),"move"===e.type){var i=e.x,n=e.y,r=e.pressure;e.x=(0,a.BB).mix(e.x,this.lastMixedInput.x,this.smoothing),e.y=(0,a.BB).mix(e.y,this.lastMixedInput.y,this.smoothing),e.pressure=(0,a.BB).mix(e.pressure,this.lastMixedInput.pressure,this.smoothing),this.lastMixedInput={x:e.x,y:e.y,pressure:e.pressure},this.smoothing>0&&(this.timeout=setTimeout(function(){t.interval=setInterval(function(){(e=JSON.parse(JSON.stringify(e))).x=(0,a.BB).mix(i,t.lastMixedInput.x,t.smoothing),e.y=(0,a.BB).mix(n,t.lastMixedInput.y,t.smoothing),e.pressure=(0,a.BB).mix(r,t.lastMixedInput.pressure,t.smoothing),t.lastMixedInput={x:e.x,y:e.y,pressure:e.pressure},t.chainOut&&t.chainOut(e)},35)},80))}return e}},{key:"setChainOut",value:function(e){this.chainOut=e}},{key:"setSmoothing",value:function(e){this.smoothing=(0,a.BB).clamp(e,0,1)}}]),e}()}),n("57YJz",function(t,n){e(t.exports,"LineSanitizer",function(){return a});var r=i("cx0mh"),s=i("7h4XF"),a=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.isDrawing=!1}return(0,s._)(e,[{key:"chainIn",value:function(e){return("down"===e.type&&(this.isDrawing?this.chainOut&&this.chainOut({type:"up",scale:e.scale,shiftIsPressed:e.shiftIsPressed,isCoalesced:!1}):this.isDrawing=!0),this.isDrawing||"move"!==e.type&&"up"!==e.type)?("up"===e.type&&this.isDrawing&&(this.isDrawing=!1),e):null}},{key:"setChainOut",value:function(e){this.chainOut=e}},{key:"getIsDrawing",value:function(){return this.isDrawing}}]),e}()}),n("aId1u",function(t,i){e(t.exports,"translateSmoothing",function(){return n});function n(e){return 1==e?.5:2==e?.84:3==e?.965:4==e?.9825:5==e?.99125:e}}),n("4hRms",function(t,n){e(t.exports,"KlAppImportHandler",function(){return c});var r=i("cx0mh"),s=i("7h4XF"),a=i("hrnUX"),o=i("1mH1z"),l=i("eWjiX"),h=i("7jh4K"),c=/*#__PURE__*/function(){function e(t,i){(0,r._)(this,e),this.klRootEl=t.klRootEl,this.klMaxCanvasSize=t.klMaxCanvasSize,this.layersUi=t.layersUi,this.setCurrentLayer=t.setCurrentLayer,this.klCanvas=t.klCanvas,this.onImportConfirm=t.onImportConfirm,this.onColor=i.onColor}return(0,s._)(e,[{key:"importFinishedLoading",value:function(e,t,i){var n=this;if(!e||isNaN(e.width)||isNaN(e.height)||e.width<=0||e.height<=0){(0,a.KL).popup({target:this.klRootEl,type:"error",message:(0,o.LANG)("import-broken-file"),buttons:["Ok"]});return}var r=function(e,t){var i=parseInt(""+e),r=parseInt(""+t);return i>n.klMaxCanvasSize&&(r=n.klMaxCanvasSize/i*r,i=n.klMaxCanvasSize),r>n.klMaxCanvasSize&&(i=n.klMaxCanvasSize/r*i,r=n.klMaxCanvasSize),{width:i=parseInt(""+i),height:r=parseInt(""+r)}},s=function(e){var i=r(e.width,e.height),s=(0,l.BB).canvas(e.width,e.height);(0,l.BB).ctx(s).drawImage(e,0,0),(0,l.BB).resizeCanvas(s,i.width,i.height),n.klCanvas.reset({width:i.width,height:i.height,image:s,layerName:t}),n.layersUi.update(0),n.setCurrentLayer(n.klCanvas.getLayer(0)),n.onImportConfirm()},c=function(e,t){var i,s=function(e,t,i){t.width=t.width,(0,l.BB).ctx(t).drawImage(e,-i.x,-i.y),e.width=i.width,e.height=i.height,(0,l.BB).ctx(e).drawImage(t,0,0)};if(t&&(t.width!==e.width||t.height!==e.height)){var a=(0,l.BB).canvas(t.width,t.height);if(e.width=t.width,e.height=t.height,e.layers||s(e.canvas,a,t),e.layers)for(var o=0;o<e.layers.length;o++)s(e.layers[o].image,a,t)}var c=r(e.width,e.height);if(e.width=c.width,e.height=c.height,e.layers||(0,l.BB).resizeCanvas(e.canvas,e.width,e.height),e.layers)for(var u=0;u<e.layers.length;u++){var p=e.layers[u];(0,l.BB).resizeCanvas(p.image,e.width,e.height)}i=e.layers?n.klCanvas.reset({width:e.width,height:e.height,layers:e.layers}):n.klCanvas.reset({width:e.width,height:e.height,image:e.canvas}),n.layersUi.update(i),n.setCurrentLayer((0,h.throwIfNull)(n.klCanvas.getLayer(i))),n.onImportConfirm()},u=function(e){(0,a.KL).showImportAsLayerDialog({target:n.klRootEl,klCanvas:n.klCanvas,importImage:e,callback:function(i,r){if(i){null===(s=n.klCanvas.getHistory())||void 0===s||s.pause(!0),n.klCanvas.addLayer();var s,a,o,c=n.klCanvas.getLayers().length-1;t&&n.klCanvas.renameLayer(c,t);var u=(0,h.throwIfNull)(n.klCanvas.getLayerContext(c));(0,l.BB).drawTransformedImageWithBounds(u,e,i,void 0,r),n.setCurrentLayer((0,h.throwIfNull)(n.klCanvas.getLayer(c))),n.layersUi.update(c),null===(a=n.klCanvas.getHistory())||void 0===a||a.pause(!1),null===(o=n.klCanvas.getHistory())||void 0===o||o.push({tool:["misc"],action:"importImage",params:[(0,l.BB).copyCanvas(u.canvas),t]})}}})};"default"!==i&&i||(0,a.KL).showImportImageDialog({image:e,target:this.klRootEl,maxSize:this.klMaxCanvasSize,callback:function(e){"as-image"===e.type?s(e.image):"as-image-psd"===e.type?c(e.image,e.cropObj):"as-layer"===e.type?u(e.image):e.type}}),"layer"===i&&u(e.canvas),"image"===i&&("psd"===e.type?c(e):s(e.canvas))}},{key:"onPaste",value:function(e){var t=this;!((0,a.KL).dialogCounter.get()>0)&&(e.stopPropagation(),e.preventDefault(),e.clipboardData&&(e.clipboardData.files[0]?function(e,t){if(e){for(var i=0;i<e.length;i++)if(-1!=e[i].type.indexOf("image")){var n=e[i].getAsFile();n&&t(n)}}}(e.clipboardData.items,function(e){var i=new Image;i.onload=function(){URL.revokeObjectURL(i.src),t.importFinishedLoading({type:"image",width:i.width,height:i.height,canvas:i},void 0,"default")};var n=window.URL||window.webkitURL;i.src=n.createObjectURL(e)}):e.clipboardData.items[0]&&e.clipboardData.items[0].getAsString(function(e){if((e=e.trim()).match(/^https?/)){var i=new Image;i.onload=function(){t.importFinishedLoading({type:"image",width:i.width,height:i.height,canvas:i},void 0,"default")},i.onerror=function(e){console.log("error loading",e)},i.crossOrigin="Anonymous",i.src=e}else if(e.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)){var n=(0,l.BB).ColorConverter.hexToRGB(e.replace("#",""));n&&t.onColor(n)}})))}},{key:"handleFileSelect",value:function(e,t){for(var i,n=this,r=function(){(0,a.KL).popup({target:n.klRootEl,type:"warning",message:(0,o.LANG)("import-psd-unsupported")+"<br /><br />",buttons:["Ok"]})},s=!1,c=0;i=e[c];c++){var u=i.name.split(".");"psd"===u[u.length-1].toLowerCase()?function(i){if(i.size>=1073741824){(0,a.KL).popup({target:n.klRootEl,type:"error",message:"File too big. Unable to import.<br /><br />",buttons:["Ok"]});return}var s,l=1===e.length&&i.size>=26214400,c=!0;l&&(0,a.KL).popup({target:n.klRootEl,message:(0,o.LANG)("import-opening"),callback:function(e){c=!1,s=null},closeFunc:function(e){s=e}});var u=new FileReader;u.onload=function(e){var u=(0,h.throwIfNull)(e.target);(0,a.KL).loadAgPsd().then(function(e){if(!l||c)try{var p;if((p=e.readPsd(u.result,{skipLayerImageData:!0,skipThumbnail:!0,skipCompositeImageData:!0})).width>4096||p.height>4096){s&&s(),(0,a.KL).popup({target:n.klRootEl,type:"error",message:(0,o.LANG)("import-psd-too-large").replace(/{x}/g,"4096")+"<br /><br />"+(0,o.LANG)("import-psd-size")+": "+p.width+" x "+p.height+" pixels<br /><br />",buttons:["Ok"]});return}p=null;try{p=e.readPsd(u.result)}catch(e){}if(p){var d=(0,a.KL).PSD.readPsd(p);"image"===t&&d.error&&r(),s&&s(),n.importFinishedLoading(d,i.name,t)}else p=e.readPsd(u.result,{skipLayerImageData:!0,skipThumbnail:!0}),"image"===t&&r(),s&&s(),n.importFinishedLoading({type:"psd",width:p.width,height:p.height,canvas:(0,h.throwIfUndefined)(p.canvas),error:!0},i.name,t)}catch(e){s&&s(),(0,a.KL).popup({target:n.klRootEl,type:"error",message:"Failed to load PSD.<br /><br />",buttons:["Ok"]}),console.log(e),setTimeout(function(){throw Error("psd load error")})}}).catch(function(e){s&&s(),alert("Error: failed to load PSD library")})},u.readAsArrayBuffer(i)}(i):i.type.match("image.*")?function(e){window.URL=window.URL||window.webkitURL;var i=window.URL.createObjectURL(e),r=new Image;r.src=i,(0,l.BB).loadImage(r,function(){n.importFinishedLoading({type:"image",width:r.width,height:r.height,canvas:r},e.name,t)})}(i):s=!0}s&&(0,a.KL).popup({target:this.klRootEl,message:(0,o.LANG)("import-unsupported-file"),type:"error",buttons:["OK"]})}}]),e}()}),n("gJS5i",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"tab-settings.be84ac7c.svg"}),n("O7B1d",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"tab-layers.c8a104e7.svg"}),n("qur3y",function(t,n){e(t.exports,"createConsoleApi",function(){return s});var r=i("bX4ja");function s(e){var t,i,n=["Draw via the console! Learn more: %cKL.help()","background: #000; color: #0f0;"];return"info"in console?(t=console).info.apply(t,(0,r._)(n)):(i=console).log.apply(i,(0,r._)(n)),Object.freeze({draw:function(t){e.onDraw(t)},help:function(){console.log(`KL.draw({x: number; y: number}[]) // draw a line
KL.help() // print help
`)}})}}),n("8I3X7",function(t,n){e(t.exports,"Easel",function(){return E});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("4EWN2"),l=i("8N5YG"),h=i("bX4ja"),c=i("amum4"),u=i("bMICc"),p=i("04lDo"),d=i("eWjiX"),g=i("lUrXo"),f=i("8G4G9"),v=i("1GsyD");i("ciAU9");var m=i("cdZRx"),y=i("kDVZW"),x=i("6wbw7"),b=i("idV3L"),B=i("63yUO"),w=i("b7Uwg"),k=i("hAS38"),C=i("eg83P"),S=i("7JyFK"),E=/*#__PURE__*/function(){function e(t){var i,n,s,o=this,k=this;(0,r._)(this,e),this.doRender=!1,this.isFrozen=!1,this.lastTransform={},this.easelInterface={setCursor:function(e){return o.rootEl.style.cursor=e},getTransform:function(){return o.viewport.getTransform()},getSize:function(){return{width:o.width,height:o.height}},getProjectSize:function(){return{width:o.project.width,height:o.project.height}},setTransform:function(e){return o.setTransform(e)},requestRender:function(){return o.requestRender()},isKeyPressed:function(e){return o.keyListener.isPressed(e)},minScale:S.EASEL_MIN_SCALE,maxScale:S.EASEL_MAX_SCALE,setAngleDeg:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return k.setAngleDeg.apply(k,(0,h._)(t))},keyListener:{},updateDoubleTapPointerTypes:function(){return o.updateDoubleTapPointerTypes()},setRenderedSelection:function(e){return o.selectionRenderer.setRenderedSelection(e)},clearRenderedSelection:function(e){return o.selectionRenderer.clearRenderedSelection(e)}},this.project=t.project,this.width=t.width,this.height=t.height,this.tool=t.tool,this.toolsMap=(0,a._)({},t.tools),this.onTransformChange=t.onTransformChange,this.onUndo=t.onUndo,this.onRedo=t.onRedo,this.tempTools=Object.fromEntries((0,S.TEMP_TRIGGERS).map(function(e){return[e,Object.entries(o.toolsMap).filter(function(t){var i=(0,l._)(t,2),n=(i[0],i[1]);return n.tempTriggers&&n.tempTriggers.includes(e)}).map(function(e){return e[0]})[0]]})),this.viewport=new u.ProjectViewport({width:this.width,height:this.height,project:{width:this.project.width,height:this.project.height,layers:this.project.layers},transform:this.getResetTransform(),renderAfter:function(e,t){var i,n=o.getActiveTool();null===(i=n.renderAfterViewport)||void 0===i||i.call(n,e,t)}}),Object.values(this.toolsMap).forEach(function(e){var t,i;null===(t=e.setEaselInterface)||void 0===t||t.call(e,o.easelInterface),null===(i=e.onResize)||void 0===i||i.call(e,o.width,o.height)});var E=!1,L=!1,A=!1;this.pointerPreprocessor=new x.EaselPointerPreprocessor({onUndo:this.onUndo,onRedo:this.onRedo,onPinch:function(e){if("move"===e.type){var t=o.viewport.getTransform();o.pinchInitialTransform||(o.pinchInitialTransform=(0,d.BB).copyObj(t),A=o.pinchInitialTransform.angleDeg%180==0);var i=o.pinchInitialTransform.angleDeg+e.angleRad/Math.PI*180;(i=(0,C.minimizeAngleDeg)((0,C.snapAngleDeg)(i,90,A?12:4)))%90!=0&&(A=!1);var n=(0,g.toMetaTransform)(o.pinchInitialTransform,{x:e.downRelX,y:e.downRelY});n.scale=(0,d.BB).clamp(o.pinchInitialTransform.scale*e.scale,S.EASEL_MIN_SCALE,S.EASEL_MAX_SCALE),n.viewportP.x+=e.relX-e.downRelX,n.viewportP.y+=e.relY-e.downRelY,n.angleDeg=i,o.viewport.setTransform((0,f.createTransform)(n.viewportP,n.canvasP,n.scale,n.angleDeg)),o.requestRender()}else"end"===e.type&&(o.pinchInitialTransform=void 0)},onDoubleTap:function(e){o.fitTransform()?o.requestRender():o.scale(2,e.relX,e.relY)},onChainOut:function(e){if(o.cursorPos={x:e.relX,y:e.relY},"pointerdown"===e.type)"middle"===e.button&&(E=!0,o.pushTempTool(o.tempTools["mouse-middle"])),"right"===e.button&&(L=!0,o.pushTempTool(o.tempTools["mouse-right"]));else if("pointermove"===e.type);else if("pointerup"===e.type){if(E){E=!1,o.getActiveTool().onPointer(e),o.popTempTool(o.tempTools["mouse-middle"]);return}if(L){L=!1,o.getActiveTool().onPointer(e),o.popTempTool(o.tempTools["mouse-right"]);return}}o.getActiveTool().onPointer(e)}}),this.pointerListener=new p.PointerListener({target:this.viewport.getElement(),onPointer:function(e){o.pointerPreprocessor.chainIn(e)},onWheel:function(e){if(null===(t=e.event)||void 0===t||t.preventDefault(),e.event&&e.event.ctrlKey&&!o.keyListener.isPressed("ctrl")){var t,i=1;0===e.event.deltaMode&&(i=6),e.deltaY*=i}o.keyListener.isPressed("shift")&&(e.deltaY/=4);var n=o.viewport.getTransform(),r={x:e.relX,y:e.relY},s=(0,v.createMatrixFromTransform)(n),a=(0,m.applyToPoint)((0,y.inverse)(s),r),l=(0,d.BB).clamp(n.scale*Math.pow(1.4,-e.deltaY),S.EASEL_MIN_SCALE,S.EASEL_MAX_SCALE);o.setTransform((0,f.createTransform)(r,a,l,n.angleDeg)),o.requestRender()},onEnterLeave:function(e){var t,i=o.getActiveTool();e||(o.cursorPos=void 0,null===(t=i.onPointerLeave)||void 0===t||t.call(i))},useDirtyWheel:!0,isWheelPassive:!1,maxPointers:3}),this.windowPointerListener=function(e){var t,i;o.rootEl.contains(e.target)||null===(t=(i=o.getActiveTool()).onClickOutside)||void 0===t||t.call(i)},window.addEventListener("pointerdown",this.windowPointerListener),this.keyListener=new b.KeyListener({onDown:function(e,t,i,n){if(!o.isFrozen){if("plus"===i){var r,s=o.getTransform().scale,a=(0,B.zoomByStep)(s,o.keyListener.isPressed("shift")?1/8:.5);o.scale(a/s)}if("minus"===i){var l=o.getTransform().scale,h=(0,B.zoomByStep)(l,o.keyListener.isPressed("shift")?-1/8:-.5);o.scale(h/l)}if(o.keyListener.comboOnlyContains(["left","right","up","down"])){var c,u,p=o.getActiveTool();(null===(u=p.onArrowKeys)||void 0===u?void 0:u.call(p,e))||("left"===e&&o.translate(40,0),"right"===e&&o.translate(-40,0),"up"===e&&o.translate(0,40),"down"===e&&o.translate(0,-40))}(0,S.TEMP_TRIGGERS_KEYS).forEach(function(e){i===e&&o.toolsMap[o.tool].blockTrigger!==e&&o.pushTempTool(o.tempTools[e])});var d=o.toolsMap[null!==(r=o.tempTool)&&void 0!==r?r:o.tool];null===(c=d.onKeyDown)||void 0===c||c.call(d,e,t,i,n)}},onUp:function(e,t,i){if(!o.isFrozen){(0,S.TEMP_TRIGGERS_KEYS).forEach(function(t){e===t&&o.toolsMap[o.tool].blockTrigger!==t&&o.popTempTool(o.tempTools[t])});var n,r,s=o.toolsMap[null!==(r=o.tempTool)&&void 0!==r?r:o.tool];null===(n=s.onKeyUp)||void 0===n||n.call(s,e,t,i)}},onBlur:function(){var e,t,i=o.toolsMap[null!==(t=o.tempTool)&&void 0!==t?t:o.tool];null===(e=i.onBlur)||void 0===e||e.call(i)}}),this.easelInterface.keyListener=this.keyListener,this.selectionRenderer=new w.SelectionRenderer({transform:this.viewport.getTransform(),selection:this.project.selection,width:this.width,height:this.height}),this.svgEl=(0,d.BB).createSvg({elementType:"svg",width:""+this.width,height:""+this.height}),(0,d.BB).css(this.svgEl,{position:"absolute",left:"0",top:"0",pointerEvents:"none"}),(i=this.svgEl).append.apply(i,[this.selectionRenderer.getElement()].concat((0,h._)(Object.values(this.toolsMap).map(function(e){return e.getSvgElement()})))),this.updateToolSvgs(),this.rootEl=(0,c.c)({css:{userSelect:"none",touchAction:"none",overscrollBehaviorX:"none"}},[this.viewport.getElement(),this.svgEl]),this.rootEl.addEventListener("contextmenu",function(e){return e.preventDefault(),!1},{passive:!1}),this.rootEl.addEventListener("touchend",function(e){return e.preventDefault(),!1}),this.rootEl.addEventListener("dragstart",function(e){return e.preventDefault(),!1}),null===(n=(s=this.toolsMap[this.tool]).activate)||void 0===n||n.call(s,this.cursorPos),this.renderLoop()}return(0,s._)(e,[{key:"updateToolSvgs",value:function(){var e,t=this,i=null!==(e=this.tempTool)&&void 0!==e?e:this.tool;Object.keys(this.toolsMap).forEach(function(e){t.toolsMap[e].getSvgElement().style.display=e===i?"":"none"})}},{key:"updateDoubleTapPointerTypes",value:function(){var e,t,i=null!==(t=this.toolsMap[null!==(e=this.tempTool)&&void 0!==e?e:this.tool].doubleTapPointerTypes)&&void 0!==t?t:S.defaultDoubleTapPointerTypes;this.pointerPreprocessor.setDoubleTapPointerTypes(i)}},{key:"renderLoop",value:function(){var e,t=this;if(this.animationFrameId=requestAnimationFrame(function(){return t.renderLoop()}),this.doRender){this.doRender=!1;var i=this.getActiveTool(),n=this.viewport.getTransform(),r=n.x!==this.lastTransform.x||n.y!==this.lastTransform.y,s=n.scale!==this.lastTransform.scale||n.angleDeg!==this.lastTransform.angleDeg;this.viewport.render(),(r||s)&&(null===(e=i.onUpdateTransform)||void 0===e||e.call(i,n),this.selectionRenderer.setTransform(n),this.onTransformChange(n,s),this.lastTransform=n)}}},{key:"pushTempTool",value:function(e){if(void 0===this.tempTool&&void 0!==e){var t,i,n,r=this.toolsMap[this.tool];null!==(t=r.getIsLocked)&&void 0!==t&&t.call(r)||(this.tempTool=e,null===(i=(n=this.getActiveTool()).activate)||void 0===i||i.call(n,this.cursorPos),this.updateToolSvgs(),this.updateDoubleTapPointerTypes())}}},{key:"popTempTool",value:function(e){var t,i;this.tempTool===e&&void 0!==e&&(this.tempTool=void 0,null===(t=(i=this.getActiveTool()).activate)||void 0===t||t.call(i,this.cursorPos,!0),this.updateToolSvgs(),this.updateDoubleTapPointerTypes())}},{key:"getActiveTool",value:function(){var e;return this.toolsMap[null!==(e=this.tempTool)&&void 0!==e?e:this.tool]}},{key:"getResetTransform",value:function(){return(0,f.createTransform)({x:this.width/2,y:this.height/2},{x:this.project.width/2,y:this.project.height/2},1,0)}},{key:"getFitTransform",value:function(){var e=this.viewport.getTransform(),t=(0,C.snapAngleDeg)(e.angleDeg,90,90),i=this.project.width,n=this.project.height,r=[[0,0],[i,0],[i,n],[0,n],[i/2,n/2]],s=(0,d.BB).Matrix.getIdentity();s=(0,d.BB).Matrix.multiplyMatrices(s,(0,d.BB).Matrix.createRotationMatrix(t/180*Math.PI));for(var a=0;a<r.length;a++){var o=[r[a][0],r[a][1],0,1];o=(0,d.BB).Matrix.multiplyMatrixAndPoint(s,o),r[a][0]=o[0],r[a][1]=o[1]}for(var l={},h=0;h<r.length;h++)(void 0===l.x1||r[h][0]<l.x1)&&(l.x1=r[h][0]),(void 0===l.y1||r[h][1]<l.y1)&&(l.y1=r[h][1]),(void 0===l.x2||r[h][0]>l.x2)&&(l.x2=r[h][0]),(void 0===l.y2||r[h][1]>l.y2)&&(l.y2=r[h][1]);var c=l.x2-l.x1,u=l.y2-l.y1,p=(0,d.BB).fitInto(c,u,this.width-0,this.height-0,1).width,g=Math.min(S.EASEL_MAX_SCALE,p/c),v={width:this.width,height:this.height},m={x:v.width/2,y:v.height/2};return(0,f.createTransform)(m,{x:i/2,y:n/2},g,t)}},{key:"setProject",value:function(e){var t,i;this.project=e,this.viewport.setProject({width:this.project.width,height:this.project.height,layers:this.project.layers}),this.selectionRenderer.setSelection(this.project.selection),null===(t=(i=this.getActiveTool()).onUpdateSelection)||void 0===t||t.call(i,this.project.selection),this.requestRender()}},{key:"setSize",value:function(e,t){var i,n,r=(0,v.createMatrixFromTransform)(this.viewport.getTransform()),s=(0,m.applyToPoint)((0,y.inverse)(r),{x:this.width/2,y:this.height/2});this.width=e,this.height=t,(0,d.BB).setAttributes(this.svgEl,{width:""+this.width,height:""+this.height}),this.selectionRenderer.setSize(e,t),null===(i=(n=this.getActiveTool()).onResize)||void 0===i||i.call(n,e,t),this.viewport.setSize(e,t);var a=this.viewport.getTransform();this.viewport.setTransform((0,f.createTransform)({x:this.width/2,y:this.height/2},s,a.scale,a.angleDeg)),this.requestRender()}},{key:"requestRender",value:function(){this.doRender=!0}},{key:"getTransform",value:function(){return this.viewport.getTransform()}},{key:"setTransform",value:function(e){this.viewport.setTransform(e),this.requestRender()}},{key:"setTool",value:function(e){var t,i;e!==this.tool&&(this.tool=e,null===(t=(i=this.toolsMap[this.tool]).activate)||void 0===t||t.call(i,this.cursorPos),this.updateToolSvgs(),this.updateDoubleTapPointerTypes(),this.requestRender())}},{key:"getTool",value:function(){return this.tool}},{key:"translate",value:function(e,t){var i=this.viewport.getTransform();this.viewport.setTransform((0,o._)((0,a._)({},i),{x:i.x+e,y:i.y+t})),this.requestRender()}},{key:"scale",value:function(e,t,i){var n=this.viewport.getTransform(),r={width:this.width,height:this.height};t=null!=t?t:r.width/2,i=null!=i?i:r.height/2;var s=(0,g.toMetaTransform)(n,{x:t,y:i});s.scale=(0,d.BB).clamp(s.scale*e,S.EASEL_MIN_SCALE,S.EASEL_MAX_SCALE),this.viewport.setTransform((0,f.createTransform)(s.viewportP,s.canvasP,s.scale,s.angleDeg)),this.requestRender()}},{key:"resetTransform",value:function(){var e=this.getResetTransform();this.viewport.setTransform(e),this.requestRender()}},{key:"fitTransform",value:function(){var e=this.viewport.getTransform(),t=this.getFitTransform(),i=t.x!==e.x||t.y!==e.y,n=t.scale!==e.scale||t.angleDeg!==e.angleDeg;return(!!i||!!n)&&(this.viewport.setTransform(t),this.requestRender(),!0)}},{key:"resetOrFitTransform",value:function(){!k.klConfig.disableAutoFit&&this.project.width<=this.width/4&&this.project.height<=this.height/4?this.fitTransform():this.resetTransform()}},{key:"setAngleDeg",value:function(e,t){var i=this.viewport.getTransform(),n=(0,v.createMatrixFromTransform)(i),r={width:this.width,height:this.height},s={x:r.width/2,y:r.height/2},a=t?i.angleDeg+e:e,o=(0,f.createTransform)(s,(0,m.applyToPoint)((0,y.inverse)(n),s),i.scale,a);this.viewport.setTransform(o),this.requestRender()}},{key:"getIsLocked",value:function(){var e,t,i;return null!==(i=null===(e=(t=this.getActiveTool()).getIsLocked)||void 0===e?void 0:e.call(t))&&void 0!==i&&i}},{key:"setIsFrozen",value:function(e){this.isFrozen=e}},{key:"getElement",value:function(){return this.rootEl}},{key:"destroy",value:function(){this.viewport.destroy(),this.pointerListener.destroy(),this.keyListener.destroy(),void 0!==this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.selectionRenderer.destroy(),window.removeEventListener("pointerdown",this.windowPointerListener)}}]),e}()}),n("6wbw7",function(t,n){e(t.exports,"EaselPointerPreprocessor",function(){return h});var r=i("cx0mh"),s=i("7h4XF"),a=i("bX4ja"),o=i("eWjiX"),l=i("gCzYB"),h=/*#__PURE__*/function(){function e(t){(0,r._)(this,e);var i=[];t.onUndo&&(this.twoFingerTap=new o.BB.NFingerTapper({fingers:2,onTap:t.onUndo}),i.push(this.twoFingerTap)),t.onRedo&&(this.threeFingerTap=new o.BB.NFingerTapper({fingers:3,onTap:t.onRedo}),i.push(this.threeFingerTap)),this.mainDoubleTapper=new o.BB.DoubleTapper({onDoubleTap:t.onDoubleTap}),this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"]),this.middleDoubleTapper=new o.BB.DoubleTapper({onDoubleTap:t.onDoubleTap}),this.middleDoubleTapper.setAllowedButtonArr(["middle"]),this.pinchZoomer=new o.BB.PinchZoomer({onPinch:t.onPinch}),this.pointerEventChain=new l.EventChain({chainArr:(0,a._)(i).concat([this.mainDoubleTapper,this.middleDoubleTapper,this.pinchZoomer,new o.BB.OnePointerLimiter])}),this.pointerEventChain.setChainOut(t.onChainOut)}return(0,s._)(e,[{key:"chainIn",value:function(e){this.pointerEventChain.chainIn(e)}},{key:"setDoubleTapPointerTypes",value:function(e){this.mainDoubleTapper.setAllowedPointerTypeArr(e)}},{key:"destroy",value:function(){}}]),e}()}),n("b7Uwg",function(t,n){e(t.exports,"SelectionRenderer",function(){return p});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("gwUZZ"),l=i("1GsyD"),h=i("9b3eo"),c=i("bbA6w"),u=i("e4nYk"),p=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.renderedSelection=null,this.viewportTransform=t.transform,this.viewportMat=(0,l.createMatrixFromTransform)(this.viewportTransform),this.selection=t.selection,this.viewportWidth=t.width,this.viewportHeight=t.height,this.svgPath1=(0,a.BB).createSvg({elementType:"path","vector-effect":"non-scaling-stroke"}),this.svgPath1.classList.add(o.whitePath),this.svgPath2=(0,a.BB).createSvg({elementType:"path","vector-effect":"non-scaling-stroke"}),this.svgPath2.classList.add(o.blackPath),this.rootEl=(0,a.BB).createSvg({elementType:"g"}),this.rootEl.append(this.svgPath1,this.svgPath2)}return(0,s._)(e,[{key:"update",value:function(){var e=null===this.renderedSelection?this.selection:this.renderedSelection;if(!e){this.svgPath1.setAttribute("d",""),this.svgPath2.setAttribute("d","");return}var t=(0,c.transformMultiPolygon)(e,this.viewportMat),i=(0,u.applyPolygonClipping)("intersection",t,[[[-10,-10],[this.viewportWidth+10,-10],[this.viewportWidth+10,this.viewportHeight+10],[-10,this.viewportHeight+10],[-10,-10]]]),n=(0,h.getSvgPathD)(i);this.svgPath1.setAttribute("d",n),this.svgPath2.setAttribute("d",n)}},{key:"setTransform",value:function(e){this.viewportTransform=e,this.viewportMat=(0,l.createMatrixFromTransform)(this.viewportTransform),this.update()}},{key:"setSelection",value:function(e){this.selection!==e&&(this.selection=e,null===this.renderedSelection&&this.update())}},{key:"setRenderedSelection",value:function(e,t){this.renderedSelection!==e&&(this.renderedSelection=e,this.update())}},{key:"clearRenderedSelection",value:function(e){this.renderedSelection=null,e&&this.update()}},{key:"setSize",value:function(e,t){this.viewportWidth=e,this.viewportHeight=t}},{key:"getElement",value:function(){return this.rootEl}},{key:"destroy",value:function(){this.rootEl.remove(),this.selection=void 0}}]),e}()}),n("gwUZZ",function(t,i){var n,r,s,a;e(t.exports,"blackAnim",function(){return n},function(e){return n=e}),e(t.exports,"blackPath",function(){return r},function(e){return r=e}),e(t.exports,"whiteAnim",function(){return s},function(e){return s=e}),e(t.exports,"whitePath",function(){return a},function(e){return a=e}),n="uIhb5a_blackAnim",r="uIhb5a_blackPath",s="uIhb5a_whiteAnim",a="uIhb5a_whitePath"}),n("e4nYk",function(t,n){e(t.exports,"applyPolygonClipping",function(){return a});var r=i("bX4ja"),s=i("1TV6j");function a(e,t){for(var i=arguments.length,n=Array(i>2?i-2:0),a=2;a<i;a++)n[a-2]=arguments[a];var o=[];try{o=s[e].apply(s,[t].concat((0,r._)(n)))}catch(e){}return o}}),n("1TV6j",function(e,t){var n,r=i("cx0mh"),s=i("7h4XF");i("gMdwd"),n=function(){var e=function(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null};function t(e,t){return e>t?1:e<t?-1:0}function i(t,i,n){for(var r=new e(null,null),s=r,a=r;;){var o=n(t,i.key);if(o<0){if(null===i.left)break;if(0>n(t,i.left.key)){var l=i.left;if(i.left=l.right,l.right=i,null===(i=l).left)break}a.left=i,a=i,i=i.left}else if(o>0){if(null===i.right)break;if(n(t,i.right.key)>0){var l=i.right;if(i.right=l.left,l.left=i,null===(i=l).right)break}s.right=i,s=i,i=i.right}else break}return s.right=i.left,a.left=i.right,i.left=r.right,i.right=r.left,i}function n(t,n,r,s){var a=new e(t,n);if(null===r)return a.left=a.right=null,a;r=i(t,r,s);var o=s(t,r.key);return o<0?(a.left=r.left,a.right=r,r.left=null):o>=0&&(a.right=r.right,a.left=r,r.right=null),a}function a(e,t,n){var r=null,s=null;if(t){t=i(e,t,n);var a=n(t.key,e);0===a?(r=t.left,s=t.right):a<0?(s=t.right,t.right=null,r=t):(r=t.left,t.left=null,s=t)}return{left:r,right:s}}var o=function(){function r(e){void 0===e&&(e=t),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=n(e,t,this._root,this._comparator)},r.prototype.add=function(t,n){var r=new e(t,n);null===this._root&&(r.left=r.right=null,this._size++,this._root=r);var s=this._comparator,a=i(t,this._root,s),o=s(t,a.key);return 0===o?this._root=a:(o<0?(r.left=a.left,r.right=a,a.left=null):o>0&&(r.right=a.right,r.left=a,a.right=null),this._size++,this._root=r),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var r;return null===t?null:(t=i(e,t,n),0===n(e,t.key))?(null===t.left?r=t.right:(r=i(e,t.left,n)).right=t.right,this._size--,r):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=i(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,i=this._comparator;t;){var n=i(e,t.key);if(0===n)return t;t=n<0?t.left:t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=i(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},r.prototype.contains=function(e){for(var t=this._root,i=this._comparator;t;){var n=i(e,t.key);if(0===n)return!0;t=n<0?t.left:t.right}return!1},r.prototype.forEach=function(e,t){for(var i=this._root,n=[],r=!1;!r;)null!==i?(n.push(i),i=i.left):0!==n.length?(i=n.pop(),e.call(t,i),i=i.right):r=!0;return this},r.prototype.range=function(e,t,i,n){for(var r=[],s=this._comparator,a=this._root;0!==r.length||a;)if(a)r.push(a),a=a.left;else{if(s((a=r.pop()).key,t)>0)break;if(s(a.key,e)>=0&&i.call(n,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var i=t.key;return e.push(i)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var i=t.data;return e.push(i)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,i=!1,n=0,r=[];!i;)if(t)r.push(t),t=t.left;else if(r.length>0){if(t=r.pop(),n===e)return t;n++,t=t.right}else i=!0;return null},r.prototype.next=function(e){var t=this._root,i=null;if(e.right){for(i=e.right;i.left;)i=i.left;return i}for(var n=this._comparator;t;){var r=n(e.key,t.key);if(0===r)break;r<0?(i=t,t=t.left):t=t.right}return i},r.prototype.prev=function(e){var t=this._root,i=null;if(null!==e.left){for(i=e.left;i.right;)i=i.right;return i}for(var n=this._comparator;t;){var r=n(e.key,t.key);if(0===r)break;r<0?t=t.left:(i=t,t=t.right)}return i},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return function(t){for(var i=t,n=[],r=!1,s=new e(null,null),a=s;!r;)i?(n.push(i),i=i.left):n.length>0?i=(i=a=a.next=n.pop()).right:r=!0;return a.next=null,s.next}(this._root)},r.prototype.load=function(t,i,n){void 0===i&&(i=[]),void 0===n&&(n=!1);var r=t.length,s=this._comparator;if(n&&function e(t,i,n,r,s){if(!(n>=r)){for(var a=t[n+r>>1],o=n-1,l=r+1;;){do o++;while(0>s(t[o],a))do l--;while(s(t[l],a)>0)if(o>=l)break;var h=t[o];t[o]=t[l],t[l]=h,h=i[o],i[o]=i[l],i[l]=h}e(t,i,n,l,s),e(t,i,l+1,r,s)}}(t,i,0,r-1,s),null===this._root)this._root=function t(i,n,r,s){var a=s-r;if(a>0){var o=r+Math.floor(a/2),l=new e(i[o],n[o]);return l.left=t(i,n,r,o),l.right=t(i,n,o+1,s),l}return null}(t,i,0,r),this._size=r;else{var a=function(t,i,n){for(var r=new e(null,null),s=r,a=t,o=i;null!==a&&null!==o;)0>n(a.key,o.key)?(s.next=a,a=a.next):(s.next=o,o=o.next),s=s.next;return null!==a?s.next=a:null!==o&&(s.next=o),r.next}(this.toList(),function(t,i){for(var n=new e(null,null),r=n,s=0;s<t.length;s++)r=r.next=new e(t[s],i[s]);return r.next=null,n.next}(t,i),s);r=this._size+r,this._root=function e(t,i,n){var r=n-i;if(r>0){var s=i+Math.floor(r/2),a=e(t,i,s),o=t.head;return o.left=a,t.head=t.head.next,o.right=e(t,s+1,n),o}return null}({head:a},0,r)}return this},r.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return function e(t,i,n,r,s){if(t){r(""+i+(n?"└── ":"├── ")+s(t)+"\n");var a=i+(n?"    ":"│   ");t.left&&e(t.left,a,!1,r,s),t.right&&e(t.right,a,!0,r,s)}}(this._root,"",!0,function(e){return t.push(e)},e),t.join("")},r.prototype.update=function(e,t,r){var s,o,l=this._comparator,h=a(e,this._root,l),c=h.left,u=h.right;0>l(e,t)?u=n(t,r,u,l):c=n(t,r,c,l),this._root=(s=c,null===(o=u)?s:(null===s||((o=i(s.key,o,l)).left=s),o))},r.prototype.split=function(e){return a(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,i;return(/**
     * splaytree v3.1.2
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     *//*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function(e,t){var i,n,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(i)throw TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{i=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}(this,function(n){switch(n.label){case 0:e=this._root,t=[],i=!1,n.label=1;case 1:if(i)return[3,6];if(!(null!==e))return[3,2];return t.push(e),e=e.left,[3,5];case 2:if(!(0!==t.length))return[3,4];return[4,e=t.pop()];case 3:return n.sent(),e=e.right,[3,5];case 4:i=!0,n.label=5;case 5:return[3,1];case 6:return[2]}}))},r}(),l=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},h=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var i=e.ll.x<t.ll.x?t.ll.x:e.ll.x,n=e.ur.x<t.ur.x?e.ur.x:t.ur.x;return{ll:{x:i,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:n,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}}},c=Number.EPSILON;void 0===c&&(c=2220446049250313e-31);var u=c*c,p=function(e,t){if(-c<e&&e<c&&-c<t&&t<c)return 0;var i=e-t;return i*i<u*e*t?0:e<t?-1:1},d=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.reset()}return(0,s._)(e,[{key:"reset",value:function(){this.xRounder=new g,this.yRounder=new g}},{key:"round",value:function(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}]),e}(),g=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.tree=new o,this.round(0)}return(0,s._)(e,[{key:"round",value:function(e){var t=this.tree.add(e),i=this.tree.prev(t);if(null!==i&&0===p(t.key,i.key))return this.tree.remove(e),i.key;var n=this.tree.next(t);return null!==n&&0===p(t.key,n.key)?(this.tree.remove(e),n.key):e}}]),e}(),f=new d,v=(3+8881784197001252e-31)*11102230246251565e-32;function m(e,t,i,n,r){var s,a,o,l,h=t[0],c=n[0],u=0,p=0;c>h==c>-h?(s=h,h=t[++u]):(s=c,c=n[++p]);var d=0;if(u<e&&p<i)for(c>h==c>-h?(a=h+s,o=s-(a-h),h=t[++u]):(a=c+s,o=s-(a-c),c=n[++p]),s=a,0!==o&&(r[d++]=o);u<e&&p<i;)c>h==c>-h?(l=(a=s+h)-s,o=s-(a-l)+(h-l),h=t[++u]):(l=(a=s+c)-s,o=s-(a-l)+(c-l),c=n[++p]),s=a,0!==o&&(r[d++]=o);for(;u<e;)l=(a=s+h)-s,o=s-(a-l)+(h-l),h=t[++u],s=a,0!==o&&(r[d++]=o);for(;p<i;)l=(a=s+c)-s,o=s-(a-l)+(c-l),c=n[++p],s=a,0!==o&&(r[d++]=o);return(0!==s||0===d)&&(r[d++]=s),d}function y(e){return new Float64Array(e)}var x=(3+17763568394002505e-31)*11102230246251565e-32,b=(2+13322676295501878e-31)*11102230246251565e-32,B=(9+7105427357601002e-30)*11102230246251565e-32*11102230246251565e-32,w=y(4),k=y(8),C=y(12),S=y(16),E=y(4),L=function(e,t){return e.x*t.y-e.y*t.x},A=function(e,t){return e.x*t.x+e.y*t.y},I=function(e,t,i){var n,r,s,a,o,l,h,c,u,p,d=(n=e.x,r=e.y,s=t.x,a=t.y,o=i.x,Math.abs(u=(h=(r-(l=i.y))*(s-o))-(c=(n-o)*(a-l)))>=x*(p=Math.abs(h+c))?u:-function(e,t,i,n,r,s,a){var o,l,h,c,u,p,d,g,f,y,x,L,A,I,T,P,R,M,D=e-r,O=i-r,_=t-s,N=n-s;I=D*N,d=(p=134217729*D)-(p-D),g=D-d,f=(p=134217729*N)-(p-N),T=g*(y=N-f)-(I-d*f-g*f-d*y),P=_*O,d=(p=134217729*_)-(p-_),g=_-d,f=(p=134217729*O)-(p-O),x=T-(R=g*(y=O-f)-(P-d*f-g*f-d*y)),u=T-x,w[0]=T-(x+u)+(u-R),u=(L=I+x)-I,x=(A=I-(L-u)+(x-u))-P,u=A-x,w[1]=A-(x+u)+(u-P),u=(M=L+x)-L,w[2]=L-(M-u)+(x-u),w[3]=M;var z=function(e,t){for(var i=t[0],n=1;n<4;n++)i+=t[n];return i}(0,w),G=b*a;if(z>=G||-z>=G||(u=e-D,o=e-(D+u)+(u-r),u=i-O,h=i-(O+u)+(u-r),u=t-_,l=t-(_+u)+(u-s),u=n-N,c=n-(N+u)+(u-s),0===o&&0===l&&0===h&&0===c)||(G=B*a+v*Math.abs(z),(z+=D*c+N*o-(_*h+O*l))>=G||-z>=G))return z;I=o*N,d=(p=134217729*o)-(p-o),g=o-d,f=(p=134217729*N)-(p-N),T=g*(y=N-f)-(I-d*f-g*f-d*y),P=l*O,d=(p=134217729*l)-(p-l),g=l-d,f=(p=134217729*O)-(p-O),x=T-(R=g*(y=O-f)-(P-d*f-g*f-d*y)),u=T-x,E[0]=T-(x+u)+(u-R),u=(L=I+x)-I,x=(A=I-(L-u)+(x-u))-P,u=A-x,E[1]=A-(x+u)+(u-P),u=(M=L+x)-L,E[2]=L-(M-u)+(x-u),E[3]=M;var j=m(4,w,4,E,k);I=D*c,d=(p=134217729*D)-(p-D),g=D-d,f=(p=134217729*c)-(p-c),T=g*(y=c-f)-(I-d*f-g*f-d*y),P=_*h,d=(p=134217729*_)-(p-_),g=_-d,f=(p=134217729*h)-(p-h),x=T-(R=g*(y=h-f)-(P-d*f-g*f-d*y)),u=T-x,E[0]=T-(x+u)+(u-R),u=(L=I+x)-I,x=(A=I-(L-u)+(x-u))-P,u=A-x,E[1]=A-(x+u)+(u-P),u=(M=L+x)-L,E[2]=L-(M-u)+(x-u),E[3]=M;var F=m(j,k,4,E,C);I=o*c,d=(p=134217729*o)-(p-o),g=o-d,f=(p=134217729*c)-(p-c),T=g*(y=c-f)-(I-d*f-g*f-d*y),P=l*h,d=(p=134217729*l)-(p-l),g=l-d,f=(p=134217729*h)-(p-h),x=T-(R=g*(y=h-f)-(P-d*f-g*f-d*y)),u=T-x,E[0]=T-(x+u)+(u-R),u=(L=I+x)-I,x=(A=I-(L-u)+(x-u))-P,u=A-x,E[1]=A-(x+u)+(u-P),u=(M=L+x)-L,E[2]=L-(M-u)+(x-u),E[3]=M;var H=m(F,C,4,E,S);return S[H-1]}(n,r,s,a,o,l,p));return d>0?-1:d<0?1:0},T=function(e){return Math.sqrt(A(e,e))},P=function(e,t,i){var n={x:t.x-e.x,y:t.y-e.y},r={x:i.x-e.x,y:i.y-e.y};return L(r,n)/T(r)/T(n)},R=function(e,t,i){var n={x:t.x-e.x,y:t.y-e.y},r={x:i.x-e.x,y:i.y-e.y};return A(r,n)/T(r)/T(n)},M=function(e,t,i){return 0===t.y?null:{x:e.x+t.x/t.y*(i-e.y),y:i}},D=function(e,t,i){return 0===t.x?null:{x:i,y:e.y+t.y/t.x*(i-e.x)}},O=function(e,t,i,n){if(0===t.x)return D(i,n,e.x);if(0===n.x)return D(e,t,i.x);if(0===t.y)return M(i,n,e.y);if(0===n.y)return M(e,t,i.y);var r=L(t,n);if(0==r)return null;var s={x:i.x-e.x,y:i.y-e.y},a=L(s,t)/r,o=L(s,n)/r;return{x:(e.x+o*t.x+(i.x+a*n.x))/2,y:(e.y+o*t.y+(i.y+a*n.y))/2}},_=/*#__PURE__*/function(){function e(t,i){(0,r._)(this,e),void 0===t.events?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=i}return(0,s._)(e,[{key:"link",value:function(e){if(e.point===this.point)throw Error("Tried to link already linked events");for(var t=e.point.events,i=0,n=t.length;i<n;i++){var r=t[i];this.point.events.push(r),r.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,t=0;t<e;t++){var i=this.point.events[t];if(void 0===i.segment.consumedBy)for(var n=t+1;n<e;n++){var r=this.point.events[n];void 0===r.consumedBy&&i.otherSE.point.events===r.otherSE.point.events&&i.segment.consume(r.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],t=0,i=this.point.events.length;t<i;t++){var n=this.point.events[t];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&e.push(n)}return e}},{key:"getLeftmostComparator",value:function(e){var t=this,i=new Map,n=function(n){var r=n.otherSE;i.set(n,{sine:P(t.point,e.point,r.point),cosine:R(t.point,e.point,r.point)})};return function(e,t){i.has(e)||n(e),i.has(t)||n(t);var r=i.get(e),s=r.sine,a=r.cosine,o=i.get(t),l=o.sine,h=o.cosine;return s>=0&&l>=0?a<h?1:a>h?-1:0:s<0&&l<0?a<h?-1:a>h?1:0:l<s?-1:l>s?1:0}}}],[{key:"compare",value:function(t,i){var n=e.comparePoints(t.point,i.point);return 0!==n?n:(t.point!==i.point&&t.link(i),t.isLeft!==i.isLeft)?t.isLeft?1:-1:z.compare(t.segment,i.segment)}},{key:"comparePoints",value:function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}}]),e}(),N=0,z=/*#__PURE__*/function(){function e(t,i,n,s){(0,r._)(this,e),this.id=++N,this.leftSE=t,t.segment=this,t.otherSE=i,this.rightSE=i,i.segment=this,i.otherSE=t,this.rings=n,this.windings=s}return(0,s._)(e,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var t=this.leftSE.point,i=this.rightSE.point,n=this.vector();if(t.x===i.x)return e.x===t.x?0:e.x<t.x?1:-1;var r=(e.y-t.y)/n.y,s=t.x+r*n.x;if(e.x===s)return 0;var a=(e.x-t.x)/n.x,o=t.y+a*n.y;return e.y===o?0:e.y<o?-1:1}},{key:"getIntersection",value:function(e){var t=this.bbox(),i=e.bbox(),n=h(t,i);if(null===n)return null;var r=this.leftSE.point,s=this.rightSE.point,a=e.leftSE.point,o=e.rightSE.point,c=l(t,a)&&0===this.comparePoint(a),u=l(i,r)&&0===e.comparePoint(r),p=l(t,o)&&0===this.comparePoint(o),d=l(i,s)&&0===e.comparePoint(s);if(u&&c)return d&&!p?s:!d&&p?o:null;if(u)return p&&r.x===o.x&&r.y===o.y?null:r;if(c)return d&&s.x===a.x&&s.y===a.y?null:a;if(d&&p)return null;if(d)return s;if(p)return o;var g=O(r,this.vector(),a,e.vector());return null!==g&&l(n,g)?f.round(g.x,g.y):null}},{key:"split",value:function(t){var i=[],n=void 0!==t.events,r=new _(t,!0),s=new _(t,!1),a=this.rightSE;this.replaceRightSE(s),i.push(s),i.push(r);var o=new e(r,a,this.rings.slice(),this.windings.slice());return _.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),_.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(r.checkForConsuming(),s.checkForConsuming()),i}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}},{key:"consume",value:function(t){for(var i=this,n=t;i.consumedBy;)i=i.consumedBy;for(;n.consumedBy;)n=n.consumedBy;var r=e.compare(i,n);if(0!==r){if(r>0){var s=i;i=n,n=s}if(i.prev===n){var a=i;i=n,n=a}for(var o=0,l=n.rings.length;o<l;o++){var h=n.rings[o],c=n.windings[o],u=i.rings.indexOf(h);-1===u?(i.rings.push(h),i.windings.push(c)):i.windings[u]+=c}n.rings=null,n.windings=null,n.consumedBy=i,n.leftSE.consumedBy=i.leftSE,n.rightSE.consumedBy=i.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,i=this._afterState.windings,n=this._afterState.multiPolys,r=0,s=this.rings.length;r<s;r++){var a=this.rings[r],o=this.windings[r],l=t.indexOf(a);-1===l?(t.push(a),i.push(o)):i[l]+=o}for(var h=[],c=[],u=0,p=t.length;u<p;u++)if(0!==i[u]){var d=t[u],g=d.poly;if(-1===c.indexOf(g)){if(d.isExterior)h.push(g);else{-1===c.indexOf(g)&&c.push(g);var f=h.indexOf(d.poly);-1!==f&&h.splice(f,1)}}}for(var v=0,m=h.length;v<m;v++){var y=h[v].multiPoly;-1===n.indexOf(y)&&n.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var e,t,i=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(W.type){case"union":var r=0===i.length,s=0===n.length;this._isInResult=r!==s;break;case"intersection":i.length<n.length?(e=i.length,t=n.length):(e=n.length,t=i.length),this._isInResult=t===W.numMultiPolys&&e<t;break;case"xor":var a=Math.abs(i.length-n.length);this._isInResult=a%2==1;break;case"difference":var o=function(e){return 1===e.length&&e[0].isSubject};this._isInResult=o(i)!==o(n);break;default:throw Error(`Unrecognized operation type found ${W.type}`)}return this._isInResult}}],[{key:"compare",value:function(e,t){var i=e.leftSE.point.x,n=t.leftSE.point.x,r=e.rightSE.point.x,s=t.rightSE.point.x;if(s<i)return 1;if(r<n)return -1;var a=e.leftSE.point.y,o=t.leftSE.point.y,l=e.rightSE.point.y,h=t.rightSE.point.y;if(i<n){if(o<a&&o<l)return 1;if(o>a&&o>l)return -1;var c=e.comparePoint(t.leftSE.point);if(c<0)return 1;if(c>0)return -1;var u=t.comparePoint(e.rightSE.point);return 0!==u?u:-1}if(i>n){if(a<o&&a<h)return -1;if(a>o&&a>h)return 1;var p=t.comparePoint(e.leftSE.point);if(0!==p)return p;var d=e.comparePoint(t.rightSE.point);return d<0?1:d>0?-1:1}if(a<o)return -1;if(a>o)return 1;if(r<s){var g=t.comparePoint(e.rightSE.point);if(0!==g)return g}if(r>s){var f=e.comparePoint(t.rightSE.point);if(f<0)return 1;if(f>0)return -1}if(r!==s){var v=l-a,m=r-i,y=h-o,x=s-n;if(v>m&&y<x)return 1;if(v<m&&y>x)return -1}return r>s?1:r<s||l<h?-1:l>h?1:e.id<t.id?-1:e.id>t.id?1:0}},{key:"fromRing",value:function(t,i,n){var r,s,a,o=_.comparePoints(t,i);if(o<0)r=t,s=i,a=1;else if(o>0)r=i,s=t,a=-1;else throw Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);return new e(new _(r,!0),new _(s,!1),[n],[a])}}]),e}(),G=/*#__PURE__*/function(){function e(t,i,n){if((0,r._)(this,e),!Array.isArray(t)||0===t.length||(this.poly=i,this.isExterior=n,this.segments=[],"number"!=typeof t[0][0]||"number"!=typeof t[0][1]))throw Error("Input geometry is not a valid Polygon or MultiPolygon");var s=f.round(t[0][0],t[0][1]);this.bbox={ll:{x:s.x,y:s.y},ur:{x:s.x,y:s.y}};for(var a=s,o=1,l=t.length;o<l;o++){if("number"!=typeof t[o][0]||"number"!=typeof t[o][1])throw Error("Input geometry is not a valid Polygon or MultiPolygon");var h=f.round(t[o][0],t[o][1]);(h.x!==a.x||h.y!==a.y)&&(this.segments.push(z.fromRing(a,h,this)),h.x<this.bbox.ll.x&&(this.bbox.ll.x=h.x),h.y<this.bbox.ll.y&&(this.bbox.ll.y=h.y),h.x>this.bbox.ur.x&&(this.bbox.ur.x=h.x),h.y>this.bbox.ur.y&&(this.bbox.ur.y=h.y),a=h)}(s.x!==a.x||s.y!==a.y)&&this.segments.push(z.fromRing(a,s,this))}return(0,s._)(e,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,i=this.segments.length;t<i;t++){var n=this.segments[t];e.push(n.leftSE),e.push(n.rightSE)}return e}}]),e}(),j=/*#__PURE__*/function(){function e(t,i){if((0,r._)(this,e),!Array.isArray(t))throw Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new G(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,s=t.length;n<s;n++){var a=new G(t[n],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=i}return(0,s._)(e,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),t=0,i=this.interiorRings.length;t<i;t++)for(var n=this.interiorRings[t].getSweepEvents(),r=0,s=n.length;r<s;r++)e.push(n[r]);return e}}]),e}(),F=/*#__PURE__*/function(){function e(t,i){if((0,r._)(this,e),!Array.isArray(t))throw Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof t[0][0][0]&&(t=[t])}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,s=t.length;n<s;n++){var a=new j(t[n],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=i}return(0,s._)(e,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,i=this.polys.length;t<i;t++)for(var n=this.polys[t].getSweepEvents(),r=0,s=n.length;r<s;r++)e.push(n[r]);return e}}]),e}(),H=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.events=t;for(var i=0,n=t.length;i<n;i++)t[i].segment.ringOut=this;this.poly=null}return(0,s._)(e,[{key:"getGeom",value:function(){for(var e=this.events[0].point,t=[e],i=1,n=this.events.length-1;i<n;i++){var r=this.events[i].point;0!==I(r,e,this.events[i+1].point)&&(t.push(r),e=r)}if(1===t.length)return null;0===I(t[0],e,t[1])&&t.shift(),t.push(t[0]);for(var s=this.isExteriorRing()?1:-1,a=this.isExteriorRing()?0:t.length-1,o=this.isExteriorRing()?t.length:-1,l=[],h=a;h!=o;h+=s)l.push([t[h].x,t[h].y]);return l}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],t=1,i=this.events.length;t<i;t++){var n=this.events[t];_.compare(e,n)>0&&(e=n)}for(var r=e.segment.prevInResult(),s=r?r.prevInResult():null;;){if(!r)return null;if(!s)return r.ringOut;if(s.ringOut!==r.ringOut){if(s.ringOut.enclosingRing()!==r.ringOut)return r.ringOut;return r.ringOut.enclosingRing()}s=(r=s.prevInResult())?r.prevInResult():null}}}],[{key:"factory",value:function(t){for(var i=[],n=0,r=t.length;n<r;n++){var s=t[n];if(s.isInResult()&&!s.ringOut){for(var a=null,o=s.leftSE,l=s.rightSE,h=[o],c=o.point,u=[];a=o,o=l,h.push(o),o.point!==c;)for(;;){var p=o.getAvailableLinkedEvents();if(0===p.length){var d=h[0].point,g=h[h.length-1].point;throw Error(`Unable to complete output ring starting at [${d.x}, ${d.y}]. Last matching segment found ends at [${g.x}, ${g.y}].`)}if(1===p.length){l=p[0].otherSE;break}for(var f=null,v=0,m=u.length;v<m;v++)if(u[v].point===o.point){f=v;break}if(null!==f){var y=u.splice(f)[0],x=h.splice(y.index);x.unshift(x[0].otherSE),i.push(new e(x.reverse()));continue}u.push({index:h.length,point:o.point});var b=o.getLeftmostComparator(a);l=p.sort(b)[0].otherSE;break}i.push(new e(h))}}return i}}]),e}(),U=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return(0,s._)(e,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(var t=0,i=this.interiorRings.length;t<i;t++){var n=this.interiorRings[t].getGeom();null!==n&&e.push(n)}return e}}]),e}(),X=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.rings=t,this.polys=this._composePolys(t)}return(0,s._)(e,[{key:"getGeom",value:function(){for(var e=[],t=0,i=this.polys.length;t<i;t++){var n=this.polys[t].getGeom();null!==n&&e.push(n)}return e}},{key:"_composePolys",value:function(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i];if(!r.poly){if(r.isExteriorRing())t.push(new U(r));else{var s=r.enclosingRing();s.poly||t.push(new U(s)),s.poly.addInterior(r)}}}return t}}]),e}(),V=/*#__PURE__*/function(){function e(t){(0,r._)(this,e);var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.compare;this.queue=t,this.tree=new o(i),this.segments=[]}return(0,s._)(e,[{key:"process",value:function(e){var t=e.segment,i=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),i;var n=e.isLeft?this.tree.add(t):this.tree.find(t);if(!n)throw Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);for(var r=n,s=n,a=void 0,o=void 0;void 0===a;)null===(r=this.tree.prev(r))?a=null:void 0===r.key.consumedBy&&(a=r.key);for(;void 0===o;)null===(s=this.tree.next(s))?o=null:void 0===s.key.consumedBy&&(o=s.key);if(e.isLeft){var l=null;if(a){var h=a.getIntersection(t);if(null!==h&&(t.isAnEndpoint(h)||(l=h),!a.isAnEndpoint(h)))for(var c=this._splitSafely(a,h),u=0,p=c.length;u<p;u++)i.push(c[u])}var d=null;if(o){var g=o.getIntersection(t);if(null!==g&&(t.isAnEndpoint(g)||(d=g),!o.isAnEndpoint(g)))for(var f=this._splitSafely(o,g),v=0,m=f.length;v<m;v++)i.push(f[v])}if(null!==l||null!==d){var y=null;y=null===l?d:null===d?l:0>=_.comparePoints(l,d)?l:d,this.queue.remove(t.rightSE),i.push(t.rightSE);for(var x=t.split(y),b=0,B=x.length;b<B;b++)i.push(x[b])}i.length>0?(this.tree.remove(t),i.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&o){var w=a.getIntersection(o);if(null!==w){if(!a.isAnEndpoint(w))for(var k=this._splitSafely(a,w),C=0,S=k.length;C<S;C++)i.push(k[C]);if(!o.isAnEndpoint(w))for(var E=this._splitSafely(o,w),L=0,A=E.length;L<A;L++)i.push(E[L])}}this.tree.remove(t)}return i}},{key:"_splitSafely",value:function(e,t){this.tree.remove(e);var i=e.rightSE;this.queue.remove(i);var n=e.split(t);return n.push(i),void 0===e.consumedBy&&this.tree.add(e),n}}]),e}(),W=new/*#__PURE__*/(function(){function e(){(0,r._)(this,e)}return(0,s._)(e,[{key:"run",value:function(e,t,i){W.type=e,f.reset();for(var n=[new F(t,!0)],r=0,s=i.length;r<s;r++)n.push(new F(i[r],!1));if(W.numMultiPolys=n.length,"difference"===W.type)for(var a=n[0],l=1;l<n.length;)null!==h(n[l].bbox,a.bbox)?l++:n.splice(l,1);if("intersection"===W.type){for(var c=0,u=n.length;c<u;c++)for(var p=n[c],d=c+1,g=n.length;d<g;d++)if(null===h(p.bbox,n[d].bbox))return[]}for(var v=new o(_.compare),m=0,y=n.length;m<y;m++)for(var x=n[m].getSweepEvents(),b=0,B=x.length;b<B;b++)if(v.insert(x[b]),v.size>1e6)throw Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).");for(var w=new V(v),k=v.size,C=v.pop();C;){var S=C.key;if(v.size===k){var E=S.segment;throw Error(`Unable to pop() ${S.isLeft?"left":"right"} SweepEvent [${S.point.x}, ${S.point.y}] from segment #${E.id} [${E.leftSE.point.x}, ${E.leftSE.point.y}] -> [${E.rightSE.point.x}, ${E.rightSE.point.y}] from queue.`)}if(v.size>1e6)throw Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(w.segments.length>1e6)throw Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");for(var L=w.process(S),A=0,I=L.length;A<I;A++){var T=L[A];void 0===T.consumedBy&&v.insert(T)}k=v.size,C=v.pop()}return f.reset(),new X(H.factory(w.segments)).getGeom()}}]),e}());return{union:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return W.run("union",e,i)},intersection:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return W.run("intersection",e,i)},xor:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return W.run("xor",e,i)},difference:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return W.run("difference",e,i)}}},e.exports=n()}),n("gMdwd",function(e,t){var i,n,r,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function l(e){if(i===setTimeout)return setTimeout(e,0);if((i===a||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:a}catch(e){i=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var h=[],c=!1,u=-1;function p(){c&&r&&(c=!1,r.length?h=r.concat(h):u=-1,h.length&&d())}function d(){if(!c){var e=l(p);c=!0;for(var t=h.length;t;){for(r=h,h=[];++u<t;)r&&r[u].run();u=-1,t=h.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];h.push(new g(e,t)),1!==h.length||c||l(d)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}),n("7JyFK",function(t,n){e(t.exports,"defaultDoubleTapPointerTypes",function(){return s}),e(t.exports,"TEMP_TRIGGERS_KEYS",function(){return a}),e(t.exports,"TEMP_TRIGGERS",function(){return o}),e(t.exports,"EASEL_MIN_SCALE",function(){return l}),e(t.exports,"EASEL_MAX_SCALE",function(){return h});var r=i("bX4ja"),s=["touch"],a=["space","alt","r","z"],o=["mouse-middle","mouse-right"].concat((0,r._)(a)),l=1/16,h=128}),n("8TwnO",function(t,n){e(t.exports,"EaselHand",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("eWjiX"),l=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.easel={},this.doubleTapPointerTypes=["touch","mouse","pen"],this.tempTriggers=["space","mouse-middle"],this.svgEl=(0,o.BB).createSvg({elementType:"g"})}return(0,s._)(e,[{key:"getSvgElement",value:function(){return this.svgEl}},{key:"onPointer",value:function(e){if(this.easel.setCursor("grab"),"pointerdown"===e.type&&["left","middle"].includes(e.button),"pointermove"===e.type&&["left","middle"].includes(e.button)){var t=(0,a._)({},this.easel.getTransform());t.x+=e.dX,t.y+=e.dY,this.easel.setTransform(t),this.easel.requestRender(),this.easel.setCursor("grabbing")}"pointerup"===e.type&&e.button}},{key:"setEaselInterface",value:function(e){this.easel=e}},{key:"activate",value:function(e){this.easel.setCursor("grab")}}]),e}()}),n("8AUlO",function(t,n){e(t.exports,"EaselBrush",function(){return v});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("4EWN2"),l=i("eWjiX"),h=i("1GsyD");i("ciAU9");var c=i("cdZRx"),u=i("kDVZW"),p=i("jjWRi"),d=i("gCzYB"),g=i("giULT"),f=i("buFTd"),v=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.easel={},this.oldScale=1,this.isDragging=!1,this.lastPos={x:0,y:0},this.isOver=!1,this.radius=t.radius,this.onLineStart=t.onLineStart,this.onLineGo=t.onLineGo,this.onLineEnd=t.onLineEnd,this.onLine=t.onLine,this.svgEl=(0,l.BB).createSvg({elementType:"g"}),this.brushCursorRound=new f.BrushCursorRound,this.brushCursorPixelSquare=new g.BrushCursorPixelSquare,this.currentCursor=this.brushCursorRound,this.svgEl.append(this.currentCursor.getElement()),this.eventChain=new d.EventChain({chainArr:[new p.CoalescedExploder]}),this.eventChain.setChainOut(function(e){i.onExplodedPointer(e)})}return(0,s._)(e,[{key:"onExplodedPointer",value:function(e){var t,i=this.easel.getTransform(),n=(0,h.createMatrixFromTransform)(i),r=(0,c.applyToPoint)((0,u.inverse)(n),{x:e.relX,y:e.relY}),s=r.x,l=r.y;i.scale!==this.oldScale&&(this.oldScale=i.scale),e.isCoalesced||(this.lastPos.x=e.relX,this.lastPos.y=e.relY,this.currentCursor.update(this.easel.getTransform(),{x:e.relX,y:e.relY},this.radius),this.isOver||"pointerup"===e.type||this._onPointerEnter());var p=null!==(t=e.pressure)&&void 0!==t?t:1,d=e.isCoalesced,g=this.easel.keyListener.isPressed("shift");if(g&&!this.firstShiftPos&&(this.firstShiftPos={x:e.relX,y:e.relY}),g||(this.firstShiftPos=void 0,this.lineToolDirection=void 0),"pointerdown"===e.type&&"left"===e.button){if(g){this.lastLineEnd&&this.onLine(this.lastLineEnd,{x:s,y:l});return}this.onLineStart({x:s,y:l,pressure:p,isCoalesced:d}),this.isDragging=!0}if("pointermove"===e.type&&"left"===e.button){if(g){if(!this.lineToolDirection){var f=Math.abs(e.relX-this.firstShiftPos.x),v=Math.abs(e.relY-this.firstShiftPos.y);(f>5||v>5)&&(this.lineToolDirection=f>v?"x":"y")}if(this.lineToolDirection){var m={x:"x"===this.lineToolDirection?e.relX:this.firstShiftPos.x,y:"y"===this.lineToolDirection?e.relY:this.firstShiftPos.y},y=(0,c.applyToPoint)((0,u.inverse)(n),m);this.onLineGo((0,o._)((0,a._)({},y),{pressure:p,isCoalesced:d}))}}else this.onLineGo({x:s,y:l,pressure:p,isCoalesced:d})}"pointerup"===e.type&&void 0===e.button&&this.isDragging&&(this.onLineEnd(),this.isDragging=!1,"touch"===e.pointerType&&this.onPointerLeave())}},{key:"_onPointerEnter",value:function(){clearTimeout(this.hideCursorTimeout),this.svgEl.setAttribute("opacity","1"),this.isOver=!0}},{key:"getSvgElement",value:function(){return this.svgEl}},{key:"onPointer",value:function(e){this.eventChain.chainIn(e)}},{key:"onPointerLeave",value:function(){clearTimeout(this.hideCursorTimeout),this.svgEl.setAttribute("opacity","0"),this.isOver=!1}},{key:"setEaselInterface",value:function(e){this.easel=e}},{key:"onUpdateTransform",value:function(e){this.currentCursor.update(e,{x:this.lastPos.x,y:this.lastPos.y},this.radius)}},{key:"getIsLocked",value:function(){return this.isDragging}},{key:"setBrush",value:function(e){var t=this;if(void 0!==e.radius){this.radius=e.radius,this.isOver||(this.svgEl.setAttribute("opacity","1"),clearTimeout(this.hideCursorTimeout),this.hideCursorTimeout=setTimeout(function(){t.svgEl.setAttribute("opacity","0")},500));var i=this.easel.getSize(),n=i.width,r=i.height;this.currentCursor.update(this.easel.getTransform(),this.isOver?this.lastPos:{x:n/2,y:r/2},this.radius)}if(void 0!==e.type){var s="round"===e.type?this.brushCursorRound:this.brushCursorPixelSquare;s!==this.currentCursor&&(this.currentCursor.getElement().remove(),this.currentCursor=s,this.getSvgElement().append(this.currentCursor.getElement()))}}},{key:"setLastDrawEvent",value:function(e){this.lastLineEnd=e?(0,a._)({},e):void 0}},{key:"activate",value:function(e){this.easel.setCursor("crosshair"),this.isDragging=!1,e?(this.lastPos.x=e.x,this.lastPos.y=e.y,this.currentCursor.update(this.easel.getTransform(),{x:e.x,y:e.y},this.radius)):this.onPointerLeave()}}]),e}()}),n("giULT",function(t,n){e(t.exports,"BrushCursorPixelSquare",function(){return u});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("7jh4K");i("ciAU9");var l=i("cdZRx"),h=i("kDVZW"),c=i("1GsyD"),u=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.rootEl=(0,a.BB).createSvg({elementType:"g",childrenArr:[{elementType:"path",fill:"none",stroke:"rgba(255,255,255,0.7)","stroke-width":"1"},{elementType:"path",fill:"none",stroke:"rgba(0,0,0,0.7)","stroke-width":"1"}]})}return(0,s._)(e,[{key:"update",value:function(e,t,i){var n=(0,c.createMatrixFromTransform)(e),r=Math.round(2*(i=Math.round(2*i)/2)),s=(0,l.applyToPoint)((0,h.inverse)(n),t);s.x=r%2==0?Math.round(s.x):Math.floor(s.x)+.5,s.y=r%2==0?Math.round(s.y):Math.floor(s.y)+.5;var a=[[s.x-i,s.y-i],[s.x+i,s.y-i],[s.x+i,s.y+i],[s.x-i,s.y+i],[s.x-i,s.y-i]].map(function(e){return(0,l.applyToPoint)(n,e)}),u="M ";a.forEach(function(e){u+=e.join(",")+" "}),(0,o.setAttributes)(this.rootEl.children[1],{d:u});var p=1/e.scale,d=[[s.x-i+p,s.y-i+p],[s.x+i-p,s.y-i+p],[s.x+i-p,s.y+i-p],[s.x-i+p,s.y+i-p],[s.x-i+p,s.y-i+p]].map(function(e){return(0,l.applyToPoint)(n,e)}),g="M ";d.forEach(function(e){g+=e.join(",")+" "}),(0,o.setAttributes)(this.rootEl.firstChild,{d:g})}},{key:"getElement",value:function(){return this.rootEl}}]),e}()}),n("buFTd",function(t,n){e(t.exports,"BrushCursorRound",function(){return o});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.rootEl=(0,a.BB).createSvg({elementType:"g",childrenArr:[{elementType:"circle",cx:"0",cy:"0",fill:"none",stroke:"rgba(255,255,255,0.7)","stroke-width":"1"},{elementType:"circle",cx:"0",cy:"0",fill:"none",stroke:"rgba(0,0,0,0.7)","stroke-width":"1"}]})}return(0,s._)(e,[{key:"update",value:function(e,t,i){(0,a.BB).setAttributes(this.rootEl.children[0],{r:""+Math.max(0,i*e.scale-1)}),(0,a.BB).setAttributes(this.rootEl.children[1],{r:""+i*e.scale}),(0,a.BB).setAttributes(this.rootEl,{transform:`translate(${t.x} ${t.y})`})}},{key:"getElement",value:function(){return this.rootEl}}]),e}()}),n("iXbuc",function(t,n){e(t.exports,"EaselProjectUpdater",function(){return l});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("7jh4K"),l=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.compositeCanvas=(0,a.BB).canvas(1,1),this.klCanvas=t.klCanvas,this.easel=t.easel,this.update()}return(0,s._)(e,[{key:"update",value:function(){var e=this,t=this.klCanvas.getWidth(),i=this.klCanvas.getHeight();this.easel.setProject({width:t,height:i,layers:this.klCanvas.getLayersFast().map(function(n){return{image:n.canvas.compositeObj?function(){(e.compositeCanvas.width!=t||e.compositeCanvas.height!=i)&&(e.compositeCanvas.width=t,e.compositeCanvas.height=i);var r,s=e.compositeCanvas.getContext("2d");return s.clearRect(0,0,t,i),s.drawImage(n.canvas,0,0),null===(r=n.canvas.compositeObj)||void 0===r||r.draw((0,o.throwIfNull)(e.compositeCanvas.getContext("2d"))),e.compositeCanvas}:n.canvas,isVisible:n.isVisible,opacity:n.opacity,mixModeStr:n.mixModeStr,hasClipping:!1}}),selection:this.klCanvas.getSelection()})}},{key:"freeCompositeCanvas",value:function(){this.compositeCanvas.width=1,this.compositeCanvas.height=1}}]),e}()}),n("4tNj6",function(n,r){e(n.exports,"EaselEyedropper",function(){return p});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("iWXP6"),h=i("1GsyD");i("ciAU9");var c=i("cdZRx"),u=i("kDVZW"),p=/*#__PURE__*/function(){function e(t){(0,s._)(this,e),this.easel={},this.isDragging=!1,this.tempTriggers=["mouse-right","alt"],this.svgEl=(0,o.BB).createSvg({elementType:"g"}),this.onPick=t.onPick,this.onPickEnd=t.onPickEnd,this.previewBorder=(0,o.BB).createSvg({elementType:"circle",r:"47",stroke:"black","stroke-width":"22",fill:"none"}),this.previewColor=(0,o.BB).createSvg({elementType:"circle",r:"47",stroke:"black","stroke-width":"20",fill:"none"}),this.svgEl.append(this.previewBorder,this.previewColor)}return(0,a._)(e,[{key:"getSvgElement",value:function(){return this.svgEl}},{key:"onPointer",value:function(e){this.easel.setCursor("url('"+/*@__PURE__*/t(l)+"') 0 15, crosshair");var i=this.easel.getTransform(),n=(0,h.createMatrixFromTransform)(i),r=(0,c.applyToPoint)((0,u.inverse)(n),{x:e.relX,y:e.relY}),s=void 0,a=["left","right"].includes(e.button);if(a?(this.svgEl.setAttribute("transform",`translate(${e.relX},${e.relY})`),this.svgEl.style.opacity="1"):this.svgEl.style.opacity="0","pointerdown"===e.type&&a&&(s=this.onPick(r),this.isDragging=!0,a=!0),"pointermove"===e.type&&a&&(s=this.onPick(r),a=!0),"pointerup"===e.type&&void 0===e.button&&this.isDragging&&(this.onPickEnd(),this.isDragging=!1),s&&a){this.previewColor.setAttribute("stroke",(0,o.BB).ColorConverter.toRgbStr(s));var p=(0,o.BB).testIsWhiteBestContrast(s)?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)";this.previewBorder.setAttribute("stroke",p)}}},{key:"setEaselInterface",value:function(e){this.easel=e}},{key:"activate",value:function(e){this.easel.setCursor("url('"+/*@__PURE__*/t(l)+"') 0 15, crosshair"),this.isDragging=!1,this.svgEl.style.opacity="0"}},{key:"onPointerLeave",value:function(){this.isDragging||(this.svgEl.style.opacity="0")}}]),e}()}),n("iWXP6",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"cursor-picker.dc155349.png"}),n("gAXzN",function(n,r){e(n.exports,"EaselPaintBucket",function(){return p});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("1SGGT"),h=i("1GsyD");i("ciAU9");var c=i("cdZRx"),u=i("kDVZW"),p=/*#__PURE__*/function(){function e(t){(0,s._)(this,e),this.easel={},this.svgEl=(0,o.BB).createSvg({elementType:"g"}),this.onFill=t.onFill}return(0,a._)(e,[{key:"getSvgElement",value:function(){return this.svgEl}},{key:"onPointer",value:function(e){this.easel.setCursor("url('"+/*@__PURE__*/t(l)+"') 1 12, crosshair");var i=this.easel.getTransform(),n=(0,h.createMatrixFromTransform)(i),r=(0,c.applyToPoint)((0,u.inverse)(n),{x:e.relX,y:e.relY});"pointerdown"===e.type&&"left"===e.button&&this.onFill({x:Math.floor(r.x),y:Math.floor(r.y)})}},{key:"setEaselInterface",value:function(e){this.easel=e}},{key:"activate",value:function(e){this.easel.setCursor("url('"+/*@__PURE__*/t(l)+"') 1 12, crosshair")}}]),e}()}),n("1SGGT",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"cursor-fill.999c4916.png"}),n("9Q2gk",function(t,n){e(t.exports,"EaselGradient",function(){return c});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("1GsyD");i("ciAU9");var l=i("cdZRx"),h=i("kDVZW"),c=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.easel={},this.isDragging=!1,this.svgEl=(0,a.BB).createSvg({elementType:"g"}),this.onDown=t.onDown,this.onMove=t.onMove,this.onUp=t.onUp}return(0,s._)(e,[{key:"getSvgElement",value:function(){return this.svgEl}},{key:"onPointer",value:function(e){this.easel.setCursor("crosshair");var t=this.easel.getTransform(),i=(0,o.createMatrixFromTransform)(t),n=(0,l.applyToPoint)((0,h.inverse)(i),{x:e.relX,y:e.relY});"pointerdown"===e.type&&"left"===e.button&&(this.onDown(n,t.angleDeg/180*Math.PI),this.isDragging=!0),"pointermove"===e.type&&"left"===e.button&&this.onMove(n),"pointerup"===e.type&&void 0===e.button&&this.isDragging&&(this.onUp(n),this.isDragging=!1)}},{key:"setEaselInterface",value:function(e){this.easel=e}},{key:"getIsLocked",value:function(){return this.isDragging}},{key:"activate",value:function(e){this.easel.setCursor("crosshair"),this.isDragging=!1}}]),e}()}),n("15tXE",function(n,r){e(n.exports,"EaselText",function(){return p});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("ZlWNx"),h=i("1GsyD");i("ciAU9");var c=i("cdZRx"),u=i("kDVZW"),p=/*#__PURE__*/function(){function e(t){(0,s._)(this,e),this.easel={},this.svgEl=(0,o.BB).createSvg({elementType:"g"}),this.onDown=t.onDown}return(0,a._)(e,[{key:"getSvgElement",value:function(){return this.svgEl}},{key:"onPointer",value:function(e){this.easel.setCursor("url('"+/*@__PURE__*/t(l)+"') 1 12, crosshair");var i=this.easel.getTransform(),n=(0,h.createMatrixFromTransform)(i),r=(0,c.applyToPoint)((0,u.inverse)(n),{x:e.relX,y:e.relY});"pointerdown"===e.type&&"left"===e.button&&this.onDown(r,i.angleDeg/180*Math.PI)}},{key:"setEaselInterface",value:function(e){this.easel=e}},{key:"activate",value:function(e){this.easel.setCursor("url('"+/*@__PURE__*/t(l)+"') 1 12, crosshair")}}]),e}()}),n("ZlWNx",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"cursor-text.582bc0db.png"}),n("2jK1Y",function(t,n){e(t.exports,"EaselShape",function(){return c});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("1GsyD");i("ciAU9");var l=i("cdZRx"),h=i("kDVZW"),c=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.easel={},this.isDragging=!1,this.svgEl=(0,a.BB).createSvg({elementType:"g"}),this.onDown=t.onDown,this.onMove=t.onMove,this.onUp=t.onUp}return(0,s._)(e,[{key:"getSvgElement",value:function(){return this.svgEl}},{key:"onPointer",value:function(e){this.easel.setCursor("crosshair");var t=this.easel.getTransform(),i=(0,o.createMatrixFromTransform)(t),n=(0,l.applyToPoint)((0,h.inverse)(i),{x:e.relX,y:e.relY});"pointerdown"===e.type&&"left"===e.button&&(this.onDown(n,t.angleDeg/180*Math.PI),this.isDragging=!0),"pointermove"===e.type&&"left"===e.button&&this.onMove(n),"pointerup"===e.type&&void 0===e.button&&this.isDragging&&(this.onUp(n),this.isDragging=!1)}},{key:"setEaselInterface",value:function(e){this.easel=e}},{key:"getIsLocked",value:function(){return this.isDragging}},{key:"activate",value:function(e){this.easel.setCursor("crosshair"),this.isDragging=!1}}]),e}()}),n("3hiBf",function(t,n){e(t.exports,"EaselRotate",function(){return u});var r=i("cx0mh"),s=i("7h4XF"),a=i("eWjiX"),o=i("1GsyD");i("ciAU9");var l=i("cdZRx"),h=i("kDVZW"),c=i("8G4G9"),u=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.easel={},this.downPos=void 0,this.tempTriggers=["r"],this.svgEl=(0,a.BB).createSvg({elementType:"g"}),this.compassSize=30,this.compass=(0,a.BB).createSvg({elementType:"g"}),(0,a.BB).css(this.compass,{transition:"opacity 0.25s ease-in-out"}),this.compassInner=(0,a.BB).createSvg({elementType:"g",transform:"rotate(0)"}),this.compassBaseCircle=(0,a.BB).createSvg({elementType:"circle",fill:"rgba(0,0,0,0.9)",stroke:"none",cx:"0",cy:"0",r:""+this.compassSize}),this.compassLineCircle=(0,a.BB).createSvg({elementType:"circle",fill:"none",stroke:"rgba(255,255,255,0.75)","stroke-width":"1",cx:"0",cy:"0",r:""+.9*this.compassSize}),this.needleWrapper=(0,a.BB).createSvg({elementType:"g"}),this.compassUpperTriangle=(0,a.BB).createSvg({elementType:"path",fill:"#f00",stroke:"none",d:"M -"+.25*this.compassSize+",0 "+.25*this.compassSize+",0 0,-"+.9*this.compassSize+" z"}),this.compassLowerTriangle=(0,a.BB).createSvg({elementType:"path",fill:"#fff",stroke:"none",d:"M -"+.25*this.compassSize+",0 "+.25*this.compassSize+",0 0,"+.9*this.compassSize+" z"}),this.needleWrapper.append(this.compassUpperTriangle,this.compassLowerTriangle),this.compassInner.append(this.compassBaseCircle,this.compassLineCircle,this.needleWrapper),this.compass.append(this.compassInner),this.svgEl.append(this.compass)}return(0,s._)(e,[{key:"getSvgElement",value:function(){return this.svgEl}},{key:"onPointer",value:function(e){if(this.easel.setCursor("left"===e.button?"grabbing":"grab"),"pointerdown"===e.type&&"left"===e.button)this.downPos={x:e.relX,y:e.relY},this.downTransform=(0,a.BB).copyObj(this.easel.getTransform());else if("left"===e.button&&this.downPos&&this.downTransform){var t=this.easel.getSize(),i={x:t.width/2,y:t.height/2},n=(0,a.BB).Vec2.angle(i,this.downPos),r=((0,a.BB).Vec2.angle(i,{x:e.relX,y:e.relY})-n)/Math.PI*180,s=this.downTransform.angleDeg+r;this.easel.isKeyPressed("shift")&&(s=45*Math.round(s/45));var u=(0,o.createMatrixFromTransform)(this.downTransform),p=(0,l.applyToPoint)((0,h.inverse)(u),i);this.easel.setTransform((0,c.createTransform)(i,p,this.downTransform.scale,s)),this.easel.requestRender()}else"pointerup"===e.type&&this.downPos&&(this.downPos=void 0,this.downTransform=void 0)}},{key:"onUpdateTransform",value:function(e){this.needleWrapper.setAttribute("transform","rotate("+e.angleDeg+")"),this.compassLineCircle.style.opacity=e.angleDeg%90==0?"1":"0"}},{key:"setEaselInterface",value:function(e){this.easel=e}},{key:"activate",value:function(e){this.easel.setCursor("grab");var t=this.easel.getSize(),i=t.width,n=t.height;this.compass.setAttribute("transform","translate("+i/2+", "+n/2+")"),this.onUpdateTransform(this.easel.getTransform())}},{key:"onKeyDown",value:function(e,t,i){["r+left","r+right"].includes(i)&&("left"===e&&this.easel.setAngleDeg(-15,!0),"right"===e&&this.easel.setAngleDeg(15,!0)),["r+up"].includes(i)&&this.easel.setAngleDeg(0,!1)}},{key:"onResize",value:function(e,t){this.compass.setAttribute("transform","translate("+e/2+", "+t/2+")")}}]),e}()}),n("6dnxC",function(n,r){e(n.exports,"EaselZoom",function(){return d});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("96FJP");i("ciAU9");var h=i("cdZRx"),c=i("kDVZW"),u=i("1GsyD"),p=i("8G4G9"),d=/*#__PURE__*/function(){function e(t){(0,s._)(this,e),this.easel={},this.downPos=void 0,this.tempTriggers=["z"],this.svgEl=(0,o.BB).createSvg({elementType:"g"})}return(0,a._)(e,[{key:"getSvgElement",value:function(){return this.svgEl}},{key:"onPointer",value:function(e){if(this.easel.setCursor("url('"+/*@__PURE__*/t(l)+"') 7 7, zoom-in"),"pointerdown"===e.type&&["left"].includes(e.button)&&(this.downPos={x:e.relX,y:e.relY},this.downTransform=(0,o.BB).copyObj(this.easel.getTransform())),"pointermove"===e.type&&["left"].includes(e.button)&&this.downPos&&this.downTransform){var i=this.downPos,n=(0,u.createMatrixFromTransform)(this.downTransform),r=(0,h.applyToPoint)((0,c.inverse)(n),i),s=e.relX-this.downPos.x,a=(0,o.BB).clamp(this.downTransform.scale*Math.pow(1+1/400,s),this.easel.minScale,this.easel.maxScale);this.easel.setTransform((0,p.createTransform)(i,r,a,this.downTransform.angleDeg)),this.easel.requestRender()}"pointerup"===e.type&&void 0===e.button&&(this.downPos=void 0,this.downTransform=void 0)}},{key:"setEaselInterface",value:function(e){this.easel=e}},{key:"activate",value:function(e){this.easel.setCursor("url('"+/*@__PURE__*/t(l)+"') 7 7, zoom-in")}}]),e}()}),n("96FJP",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"cursor-zoom-ew.9ecaf1c2.png"}),n("kwvlO",function(t,n){e(t.exports,"KlAppSelect",function(){return m});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("4EWN2"),l=i("3JH7a"),h=i("fSpPw"),c=i("705qg"),u=i("7jh4K"),p=i("eQPGJ"),d=i("k5Z00");i("ciAU9");var g=i("83Kse"),f=i("2MaaK"),v=i("1mH1z"),m=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.selectMode="select",this.targetLayerIndex=0,this.initialTransform={transform:(0,g.identity)(),doClone:!1,targetLayerIndex:0},this.klCanvas=t.klCanvas,this.onUpdateProject=t.onUpdateProject,this.getCurrentLayerCtx=t.getCurrentLayerCtx,this.klHistory=t.klHistory,this.tempHistory=t.tempHistory,this.statusOverlay=t.statusOverlay,this.onFill=t.onFill,this.onErase=t.onErase,this.klHistory.addListener(function(){i.selectUi.setHasSelection(!!i.klCanvas.getSelection()),"transform"===i.selectMode&&i.updateUiLayerList()}),this.klHistory.addBeforePushListener(function(e){!i.tempHistory.getIsActive()&&i.klCanvas.getSelectionSample()&&((0,c.isKlCanvasHistoryEntry)(e)&&("transformCloneViaSelection"===e.action||"transformViaSelection"===e.action||"clearSelectionSample"===e.action)||i.klCanvas.clearSelectionSample())}),this.selectTool=new p.SelectTool({klCanvas:this.klCanvas}),this.transformTool=new d.SelectTransformTool,this.easelSelect=new h.EaselSelect({selectMode:this.selectMode,onStartSelect:function(e,t){return i.selectTool.startSelect(e,t)},onGoSelect:function(e){i.selectTool.goSelect(e),i.easelSelect.setRenderedSelection(i.selectTool.getSelection())},onEndSelect:function(){i.selectTool.endSelect();var e=i.selectTool.getSelection();i.easelSelect.clearRenderedSelection(),i.klCanvas.setSelection(e),i.selectUi.setHasSelection(!!e)},onStartMoveSelect:function(e){i.selectTool.startMoveSelect(e)},onGoMoveSelect:function(e){i.selectTool.goMoveSelect(e),i.easelSelect.setRenderedSelection(i.selectTool.getSelection())},onEndMoveSelect:function(){if(i.selectTool.endMoveSelect(),i.selectTool.getDidMove()){var e=i.selectTool.getSelection();i.easelSelect.clearRenderedSelection(),i.klCanvas.setSelection(e),i.selectUi.setHasSelection(!!e)}},onSelectAddPoly:function(e,t){i.selectTool.addPoly(e,t);var n=i.selectTool.getSelection();i.klCanvas.setSelection(n),i.selectUi.setHasSelection(!!n)},onTranslateTransform:function(e){i.transformTool.translate(e),i.propagateTransformationChange()},onResetSelection:function(){return i.resetSelection()}}),this.selectUi=new l.SelectUi({onChangeMode:function(e){if(i.selectMode=e,"select"===i.selectMode){i.tempHistory.clear(),i.tempHistory.setIsActive(!1);var n=(0,u.throwIfNull)(i.klCanvas.getLayerIndex(i.getCurrentLayerCtx().canvas));(i.transformTool.isTransformationChanged()||i.transformTool.getDoClone()||n!==i.targetLayerIndex)&&(i.transformTool.getDoClone()?i.klCanvas.transformCloneViaSelection({sourceLayer:n,targetLayer:i.targetLayerIndex,transformation:i.transformTool.getTransform()}):i.klCanvas.transformViaSelection({sourceLayer:n,targetLayer:i.targetLayerIndex,transformation:i.transformTool.getTransform()}),t.statusOverlay.out((0,v.LANG)("select-transform-applied"),!0)),i.klCanvas.setComposite(n,void 0),i.klCanvas.setComposite(i.targetLayerIndex,void 0),i.easelSelect.clearRenderedSelection(!0);var r=i.klCanvas.getSelection();i.selectTool.setSelection(r),i.selectUi.setHasSelection(!!r),i.onUpdateProject()}else{i.tempHistory.setIsActive(!0);var s=i.selectTool.getSelection()||[];if(0===s.length){var a=i.klCanvas.getWidth(),o=i.klCanvas.getHeight();s=[[[[0,0],[a,0],[a,o],[0,o],[0,0]]]]}i.transformTool.setSelection(s),i.transformTool.setDoClone(!1),i.transformTool.setSelectionSample(i.klCanvas.getSelectionSample());var l=i.getCurrentLayerCtx().canvas,h=(0,u.throwIfNull)(i.klCanvas.getLayerIndex(l));i.initialTransform.targetLayerIndex=h,i.targetLayerIndex=h,i.updateComposites();var c=i.transformTool.getTransformedSelection();i.easelSelect.setRenderedSelection(c),i.selectUi.setHasSelection(!!s),i.updateUiLayerList(),i.selectUi.setMoveToLayer(void 0),i.onUpdateProject()}i.easelSelect.setMode(i.selectMode)},onChangeBooleanOperation:function(e){i.easelSelect.setBooleanOperation(e)},canTransform:function(){var e=(0,u.throwIfNull)(i.klCanvas.getLayerIndex(i.getCurrentLayerCtx().canvas)),t=!!i.klCanvas.getSelectionArea(e);return t||setTimeout(function(){(0,f.showModal)({target:document.body,message:(0,v.LANG)("select-transform-empty"),type:"error"})}),t},select:{shape:this.selectTool.getShape(),onChangeShape:function(e){i.selectTool.setShape(e),i.easelSelect.setSelectShape(e)},onReset:function(){return i.resetSelection()},onAll:function(){i.selectTool.selectAll();var e=i.selectTool.getSelection();i.klCanvas.setSelection(e),i.selectUi.setHasSelection(!!e)},onInvert:function(){i.selectTool.invertSelection();var e=i.selectTool.getSelection();i.klCanvas.setSelection(e),i.selectUi.setHasSelection(!!e)}},transform:{onFlipY:function(){i.transformTool.flip("y"),i.propagateTransformationChange()},onFlipX:function(){i.transformTool.flip("x"),i.propagateTransformationChange()},onRotateDeg:function(e){i.transformTool.rotateDeg(e),i.propagateTransformationChange()},onClone:function(){i.tempHistory.clear();var e=(0,u.throwIfNull)(i.klCanvas.getLayerIndex(i.getCurrentLayerCtx().canvas));i.transformTool.getDoClone()?i.klCanvas.transformCloneViaSelection({sourceLayer:e,targetLayer:i.targetLayerIndex,transformation:i.transformTool.getTransform()}):i.transformTool.isTransformationChanged()&&i.klCanvas.transformViaSelection({sourceLayer:e,targetLayer:i.targetLayerIndex,transformation:i.transformTool.getTransform()});var t=i.transformTool.getTransformedSelection(),n=i.klCanvas.getSelection()||t;i.transformTool.setSelection(n),i.transformTool.setDoClone(!0),i.transformTool.setSelectionSample(i.klCanvas.getSelectionSample()),i.updateComposites(),i.easelSelect.setRenderedSelection(i.transformTool.getTransformedSelection()),i.selectUi.setHasSelection(!!n),i.onUpdateProject(),i.statusOverlay.out((0,v.LANG)("select-transform-clone-applied"),!0)},onMoveToLayer:function(e){i.resetComposites(),i.targetLayerIndex=e,i.updateComposites(),i.onUpdateProject(),i.tempHistory.replaceTop({type:"select-transform",data:{transform:i.transformTool.getTransform(),doClone:i.transformTool.getDoClone(),targetLayerIndex:i.targetLayerIndex}})}},onErase:function(){i.onErase()},onFill:function(){i.onFill()}}),this.klHistory.addListener(function(e){var t=i.klCanvas.getSelection();"select"===i.selectMode&&i.selectTool.setSelection(t)})}return(0,s._)(e,[{key:"resetComposites",value:function(){var e=this.getCurrentLayerCtx(),t=(0,u.throwIfNull)(this.klCanvas.getLayerIndex(e.canvas));this.klCanvas.setComposite(t,void 0),this.targetLayerIndex!==t&&this.klCanvas.setComposite(this.targetLayerIndex,void 0)}},{key:"updateComposites",value:function(){var e=this.getCurrentLayerCtx().canvas,t=(0,u.throwIfNull)(this.klCanvas.getLayerIndex(e));t===this.targetLayerIndex?this.klCanvas.setComposite(t,this.transformTool.createComposite(e)):(this.klCanvas.setComposite(t,this.transformTool.createSourceComposite(e)),this.klCanvas.setComposite(this.targetLayerIndex,this.transformTool.createTargetComposite(e)))}},{key:"updateUiLayerList",value:function(){this.selectUi.setLayers(this.klCanvas.getLayers().map(function(e){return e.name}))}},{key:"resetSelection",value:function(){this.selectTool.reset();var e=this.selectTool.getSelection();this.klCanvas.setSelection(e),this.selectUi.setHasSelection(!!e)}},{key:"propagateTransformationChange",value:function(){var e=this.transformTool.getTransformedSelection();this.easelSelect.setRenderedSelection(e),this.updateComposites(),this.onUpdateProject(),this.tempHistory.replaceTop({type:"select-transform",data:{transform:this.transformTool.getTransform(),doClone:this.transformTool.getDoClone(),targetLayerIndex:this.targetLayerIndex}})}},{key:"getSelectUi",value:function(){return this.selectUi}},{key:"getEaselSelect",value:function(){return this.easelSelect}},{key:"commitTransform",value:function(){var e=!1;return"transform"===this.selectMode&&(this.selectUi.setMode("select"),e=!0),e}},{key:"discardTransform",value:function(){if("transform"===this.selectMode){this.transformTool.reset(),this.transformTool.setDoClone(!1);var e=this.getCurrentLayerCtx().canvas;this.targetLayerIndex=(0,u.throwIfNull)(this.klCanvas.getLayerIndex(e)),this.selectUi.setMode("select")}}},{key:"setSelectMode",value:function(e){}},{key:"onHistory",value:function(e){if("undo"===e)this.selectUi.setMode("select");else if("tempUndo"===e||"tempRedo"===e){this.resetComposites();var t,i=this.tempHistory.getEntries().at(-1),n=(0,o._)((0,a._)({},this.initialTransform),{doClone:this.transformTool.getDoClone()});i&&"select-transform"===(t=i).type&&t.data&&(n=i.data),this.transformTool.setTransform(n.transform),this.transformTool.setDoClone(n.doClone),this.targetLayerIndex=n.targetLayerIndex;var r=this.transformTool.getTransformedSelection();this.easelSelect.setRenderedSelection(r),this.selectUi.setMoveToLayer(this.klCanvas.getLayerIndex(this.getCurrentLayerCtx().canvas)===n.targetLayerIndex?void 0:n.targetLayerIndex),this.updateComposites(),this.onUpdateProject()}}},{key:"destroy",value:function(){}}]),e}()}),n("3JH7a",function(n,r){e(n.exports,"SelectUi",function(){return w});var s=i("cx0mh"),a=i("7h4XF"),o=i("eWjiX"),l=i("iFIyy"),h=i("ieR9b"),c=i("d2WoL"),u=i("amum4"),p=i("kdWGf"),d=i("8ijl3"),g=i("gkFrC"),f=i("33r5R"),v=i("bNE0c"),m=i("eJ3Qy"),y=i("6ybCd"),x=i("4UZXr"),b=i("eEL9N"),B=i("1mH1z"),w=/*#__PURE__*/function(){function e(i){var n=this;(0,s._)(this,e),this.isVisible=!0,this.hasSelection=!1,this.onChangeMode=i.onChangeMode,this.modeOptions=new l.Options({optionArr:[{id:"select",label:(0,u.c)("",[(0,u.c)({content:"<img class='dark-invert' src='"+/*@__PURE__*/t(h)+"' height='20'/><span>"+(0,B.LANG)("select-select")+"</span>",css:{display:"flex",gap:"5px",alignItems:"center",height:"100%",margin:"10px 10px",justifyContent:"center"}})])},{id:"transform",label:(0,u.c)("",[(0,u.c)({content:"<img class='dark-invert' src='"+/*@__PURE__*/t(c)+"' height='20'/><span>"+(0,B.LANG)("select-transform")+"</span>",css:{display:"flex",gap:"5px",alignItems:"center",height:"100%",margin:"10px 10px",justifyContent:"center"}})])}],initId:"select",onChange:function(e){"select"===e&&n.operationOptions.setValue("new"),n.onChangeMode(e),M()},onBeforeChange:function(e){return"transform"!==e||i.canTransform()},optionCss:{flexGrow:"1",flexBasis:"0"}}),this.modeOptions.getElement().style.marginBottom="10px";var r=(0,o.BB).el(),a=new Image;a.src=/*@__PURE__*/t(p),a.classList.add("dark-invert");var w=new Image;w.src=/*@__PURE__*/t(d),w.classList.add("dark-invert");var k=new Image;k.src=/*@__PURE__*/t(g),k.classList.add("dark-invert"),this.operationOptions=new l.Options({optionArr:[{id:"new",label:a,title:(0,B.LANG)("select-boolean-replace")},{id:"union",label:w,title:(0,B.LANG)("select-boolean-add")},{id:"difference",label:k,title:(0,B.LANG)("select-boolean-subtract")}],initId:"new",onChange:function(e){i.onChangeBooleanOperation(e)}}),this.operationOptions.getElement().style.marginBottom="10px";var C={width:"32px",height:"32px"},S=new Image;S.src=/*@__PURE__*/t(f),S.classList.add("dark-invert"),(0,o.BB).css(S,C);var E=new Image;E.src=/*@__PURE__*/t(v),E.classList.add("dark-invert"),(0,o.BB).css(E,C);var L=new Image;L.src=/*@__PURE__*/t(m),L.classList.add("dark-invert"),(0,o.BB).css(L,C);var A=new Image;A.src=/*@__PURE__*/t(y),A.classList.add("dark-invert"),(0,o.BB).css(A,C);var I=new l.Options({optionArr:[{id:"rect",label:S,title:(0,B.LANG)("shape-rect")},{id:"ellipse",label:E,title:(0,B.LANG)("shape-ellipse")},{id:"lasso",label:L,title:(0,B.LANG)("select-lasso")},{id:"poly",label:A,title:(0,B.LANG)("select-polygon")}],initId:i.select.shape,onChange:function(e){i.select.onChangeShape(e)}});I.getElement().style.marginBottom="10px",r.append(I.getElement(),this.operationOptions.getElement());var T=(0,o.BB).el({parent:r,css:{display:"flex",gap:"5px"}});(0,o.BB).el({parent:T,tagName:"button",content:(0,B.LANG)("select-all"),onClick:function(){i.select.onAll()},custom:{tabindex:"-1"},css:{minHeight:"30px"}}),(0,o.BB).el({parent:T,tagName:"button",content:(0,B.LANG)("select-invert"),onClick:function(){i.select.onInvert()},custom:{tabindex:"-1"},css:{minHeight:"30px"}}),this.selectResetBtn=(0,o.BB).el({parent:T,tagName:"button",content:"<img src='"+/*@__PURE__*/t(x)+'\' height="20" style="margin-right: 3px; filter: invert(1)"/>'+(0,B.LANG)("select-reset"),className:"kl-button kl-button-primary",css:{paddingRight:"8px",display:"none"},onClick:function(){i.select.onReset()},custom:{tabindex:"-1"}}),(0,o.BB).el({className:"grid-hr",parent:r,css:{margin:"10px 0"}});var P=(0,o.BB).el({parent:r,css:{display:"flex",gap:"5px"}});(0,o.BB).el({parent:P,tagName:"button",content:(0,B.LANG)("select-erase"),onClick:function(){i.onErase()},custom:{tabindex:"-1"}}),(0,o.BB).el({parent:P,tagName:"button",content:(0,B.LANG)("select-fill"),onClick:function(){i.onFill()},custom:{tabindex:"-1"}});var R=(0,o.BB).el();(0,o.BB).el({parent:R,tagName:"button",content:(0,B.LANG)("filter-transform-flip")+" X",className:"kl-button",css:{marginRight:"5px"},onClick:function(){i.transform.onFlipX()},custom:{tabindex:"-1"}}),(0,o.BB).el({parent:R,tagName:"button",content:(0,B.LANG)("filter-transform-flip")+" Y",css:{marginRight:"5px"},onClick:function(){i.transform.onFlipY()},custom:{tabindex:"-1"}}),(0,o.BB).el({parent:R,tagName:"button",content:"-90°",onClick:function(){i.transform.onRotateDeg(-90)},css:{marginRight:"5px"},custom:{tabindex:"-1"}}),(0,o.BB).el({parent:R,tagName:"button",content:"+90°",onClick:function(){i.transform.onRotateDeg(90)},css:{marginRight:"5px"},custom:{tabindex:"-1"}}),this.transformDuplicateBtn=(0,o.BB).el({parent:R,tagName:"button",content:(0,B.LANG)("select-transform-clone"),onClick:function(){i.transform.onClone()},css:{marginTop:"10px",display:"block"}}),this.moveToLayerSelect=new b.Select({optionArr:[["1","Layer 2"],["0","Layer 1"]],onChange:function(e){i.transform.onMoveToLayer(+e)}}),R.append((0,u.c)(",flex,items-center,gap-5,mt-10,flexWrap",[(0,B.LANG)("select-transform-move-to-layer"),this.moveToLayerSelect.getElement()]));var M=function(){"select"===n.modeOptions.getValue()?(n.rootEl.append(r),R.remove()):(r.remove(),n.rootEl.append(R))},D=(0,o.BB).el({className:"kl-toolspace-note",textContent:(0,B.LANG)("wip"),css:{marginBottom:"10px"}});this.rootEl=(0,o.BB).el({content:[D,this.modeOptions.getElement()],css:{margin:"10px"}}),M()}return(0,a._)(e,[{key:"update",value:function(){this.selectResetBtn.style.display=this.hasSelection?"block":"none"}},{key:"setIsVisible",value:function(e){this.isVisible=e,this.rootEl.style.display=this.isVisible?"block":"none",this.isVisible&&this.operationOptions.setValue("new")}},{key:"setMode",value:function(e){this.modeOptions.setValue(e)}},{key:"setLayers",value:function(e){this.moveToLayerSelect.setOptionArr(e.map(function(e,t){return[""+t,e]}).reverse())}},{key:"setMoveToLayer",value:function(e){this.moveToLayerSelect.setValue(void 0===e?void 0:""+e)}},{key:"setHasSelection",value:function(e){this.hasSelection=e,this.update()}},{key:"getElement",value:function(){return this.rootEl}},{key:"destroy",value:function(){}}]),e}()}),n("ieR9b",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"select-mode-select.a497171d.svg"}),n("d2WoL",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"select-mode-move.3778aa02.svg"}),n("kdWGf",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"select-default.59c89a67.svg"}),n("8ijl3",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"select-union.89b92ea7.svg"}),n("gkFrC",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"select-subtract.8960756d.svg"}),n("33r5R",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"select-shape-rect.4ee8affe.svg"}),n("bNE0c",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"select-shape-ellipse.2cdd0c2d.svg"}),n("eJ3Qy",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"select-shape-lasso.91ac9c84.svg"}),n("6ybCd",function(e,t){e.exports=i("f6OTe").getBundleURL("dafOa")+"select-shape-poly.8eed0bea.svg"}),n("fSpPw",function(t,n){e(t.exports,"EaselSelect",function(){return y});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("4EWN2"),l=i("eWjiX"),h=i("1GsyD");i("ciAU9");var c=i("cdZRx"),u=i("kDVZW"),p=i("eg83P"),d=i("9b3eo"),g=i("gCzYB"),f=i("c1lmK"),v={select:"default",transform:"move"},m={new:"default",union:"copy",difference:"alias"},y=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.easel={},this.viewportTransform={},this.tempCtx=(0,l.BB).ctx((0,l.BB).canvas(1,1)),this.canvasSelection=[],this.selectionPath=(0,d.getSelectionPath2d)([]),this.mode="select",this.isDragging=!1,this.selectSelectMode="select",this.didSelectionMove=!1,this.defaultBooleanOperation="new",this.selectShape="rect",this.polyShape=[],this.movement=void 0,this.lastCanvasMovement=void 0,this.doubleTapPointerTypes=["touch"],this.blockTrigger="alt",this.onTranslateTransform=t.onTranslateTransform,this.mode=t.selectMode,this.onStartSelect=t.onStartSelect,this.onGoSelect=t.onGoSelect,this.onEndSelect=t.onEndSelect,this.onStartMoveSelect=t.onStartMoveSelect,this.onGoMoveSelect=t.onGoMoveSelect,this.onEndMoveSelect=t.onEndMoveSelect,this.onSelectAddPoly=t.onSelectAddPoly,this.onResetSelection=t.onResetSelection,this.pointerChain=new g.EventChain({chainArr:[new f.DoubleTapper({onDoubleTap:function(e){if(!(i.polyShape.length<3)){var n=i.polyShape.map(function(e){return{x:e.x,y:e.y}});i.resetPolyShape(),n.length>1&&(n.push((0,a._)({},n[0])),t.onSelectAddPoly(n,i.appliedBooleanOperation))}},isInstant:!0})]}),this.svgEl=(0,l.BB).createSvg({elementType:"g"})}return(0,s._)(e,[{key:"viewportToCanvas",value:function(e){var t=(0,u.inverse)((0,h.createMatrixFromTransform)(this.easel.getTransform()));return(0,c.applyToPoint)(t,e)}},{key:"updateSelectionPath",value:function(){this.selectionPath=(0,d.getSelectionPath2d)(this.canvasSelection)}},{key:"resetPolyShape",value:function(){this.polyShape=[],this.doubleTapPointerTypes=["touch"],this.easel.updateDoubleTapPointerTypes(),this.easel.requestRender()}},{key:"getEffectiveBooleanOperation",value:function(){var e="new"===this.defaultBooleanOperation?this.easel.keyListener.isPressed("alt"):"difference"===this.defaultBooleanOperation,t="new"===this.defaultBooleanOperation?this.easel.keyListener.isPressed("shift"):"union"===this.defaultBooleanOperation;return e?"difference":t?"union":"new"}},{key:"getDoMoveSelection",value:function(e,t){var i=this.polyShape.length<2&&this.selectionPath&&this.tempCtx.isPointInPath(this.selectionPath,t.x,t.y);return"new"===e&&i}},{key:"selectOnPointer",value:function(e){var t,i=this.getEffectiveBooleanOperation(),n=this.isDragging,r=this.viewportToCanvas({x:e.relX,y:e.relY}),s=this.getDoMoveSelection(i,r);if("pointerdown"===e.type&&(this.isDragging=!0,s?this.selectSelectMode="move":this.selectSelectMode="select"),"pointerup"===e.type&&(this.isDragging=!1),"move"===this.selectSelectMode)"pointerdown"===e.type&&"left"===e.button&&(this.didSelectionMove=!1,this.onStartMoveSelect(r)),"pointermove"===e.type&&"left"===e.button&&(this.didSelectionMove=!0,this.onGoMoveSelect(r)),"pointerup"!==e.type||(this.onEndMoveSelect(),this.didSelectionMove||this.onResetSelection());else if("poly"===this.selectShape){if("pointermove"===e.type&&((null===(h=this.polyShape[this.polyShape.length-1])||void 0===h?void 0:h.temp)&&this.polyShape.pop(),this.polyShape.push((0,o._)((0,a._)({},r),{temp:!0})),this.easel.requestRender()),"pointerup"===e.type&&n){this.polyShape.length<2&&(this.appliedBooleanOperation=i),this.doubleTapPointerTypes=[],this.easel.updateDoubleTapPointerTypes(),(null===(c=this.polyShape[this.polyShape.length-1])||void 0===c?void 0:c.temp)&&this.polyShape.pop(),this.polyShape.push(r);var h,c,u=this.polyShape[0],p=this.polyShape[this.polyShape.length-1];if(this.polyShape.length>2&&(0,l.BB).dist(u.x,u.y,p.x,p.y)*this.viewportTransform.scale<4){this.polyShape.pop(),this.polyShape.push((0,a._)({},this.polyShape[0]));var d=this.polyShape;this.polyShape=[],this.onSelectAddPoly(d,this.appliedBooleanOperation),this.appliedBooleanOperation=void 0}}}else"pointerdown"===e.type&&"left"===e.button&&(this.appliedBooleanOperation=i,this.onStartSelect(r,this.appliedBooleanOperation)),"pointermove"===e.type&&"left"===e.button&&this.isDragging&&this.onGoSelect(r),"pointerup"===e.type&&n&&(this.onEndSelect(),this.appliedBooleanOperation=void 0);e.button||(s?this.selectSelectMode="move":this.selectSelectMode="select"),"move"===this.selectSelectMode?this.easel.setCursor("move"):this.easel.setCursor(m[null!==(t=this.appliedBooleanOperation)&&void 0!==t?t:i])}},{key:"transformOnPointer",value:function(e){if(this.easel.setCursor("move"),"pointerdown"===e.type&&"left"===e.button&&(this.movement={x:0,y:0},this.lastCanvasMovement={x:0,y:0},this.updateSelectionPath(),this.isDragging=!0),"pointermove"===e.type&&"left"===e.button){this.movement.x+=e.dX,this.movement.y+=e.dY,this.updateSelectionPath();var t=this.movement,i=this.easel.getTransform(),n=(0,l.BB).Vec2.mul(t,1/i.scale);(n=(0,p.rotate)(n.x,n.y,-this.viewportTransform.angleDeg)).x=Math.round(n.x),n.y=Math.round(n.y);var r={x:Math.round(n.x-this.lastCanvasMovement.x),y:Math.round(n.y-this.lastCanvasMovement.y)};(0!==r.x||0!==r.y)&&(this.onTranslateTransform(r),this.lastCanvasMovement={x:this.lastCanvasMovement.x+r.x,y:this.lastCanvasMovement.y+r.y})}"pointerup"===e.type&&void 0===e.button&&this.isDragging&&(this.movement=void 0,this.updateSelectionPath(),this.isDragging=!1)}},{key:"onPointerChainOut",value:function(e){"select"===this.mode?this.selectOnPointer(e):this.transformOnPointer(e)}},{key:"getSvgElement",value:function(){return this.svgEl}},{key:"onPointer",value:function(e){this.onPointerChainOut(e),this.pointerChain.chainIn(e)}},{key:"setEaselInterface",value:function(e){this.easel=e,this.viewportTransform=this.easel.getTransform()}},{key:"setMode",value:function(e){this.mode=e,this.resetPolyShape()}},{key:"activate",value:function(e,t){this.easel.setCursor(v[this.mode]),this.isDragging=!1,this.onUpdateTransform(this.easel.getTransform()),t||this.resetPolyShape()}},{key:"onUpdateTransform",value:function(e){this.viewportTransform=e,this.updateSelectionPath()}},{key:"onUpdateSelection",value:function(e){this.canvasSelection=e||[],this.updateSelectionPath()}},{key:"setRenderedSelection",value:function(e){this.easel.setRenderedSelection(e)}},{key:"clearRenderedSelection",value:function(e){this.easel.clearRenderedSelection(e)}},{key:"setBooleanOperation",value:function(e){this.defaultBooleanOperation=e}},{key:"setSelectShape",value:function(e){this.resetPolyShape(),this.selectShape=e}},{key:"getIsLocked",value:function(){return this.isDragging}},{key:"renderAfterViewport",value:function(e,t){if(!(this.polyShape.length<2)){e.save(),e.globalCompositeOperation="difference",e.beginPath();var i=this.polyShape;e.moveTo(i[0].x,i[0].y);for(var n=1;n<i.length;n++)e.lineTo(i[n].x,i[n].y);e.lineWidth=1/t.scaleX,e.strokeStyle="white",e.lineCap="round",e.lineJoin="round",e.stroke(),e.restore()}}},{key:"onKeyDown",value:function(e){"esc"===e&&this.resetPolyShape()}},{key:"onClickOutside",value:function(){this.resetPolyShape()}},{key:"onBlur",value:function(){this.resetPolyShape()}},{key:"onArrowKeys",value:function(e){if("select"===this.mode)return!1;var t={x:0,y:0};"left"===e&&(t={x:-1,y:0}),"right"===e&&(t={x:1,y:0}),"up"===e&&(t={x:0,y:-1}),"down"===e&&(t={x:0,y:1});var i=(0,p.rotate)(t.x,t.y,-(0,p.snapAngleDeg)(this.easel.getTransform().angleDeg,90,90));return this.onTranslateTransform(i),!0}}]),e}()}),n("eQPGJ",function(t,n){e(t.exports,"SelectTool",function(){return d});var r=i("cx0mh"),s=i("7h4XF"),a=i("8N5YG"),o=i("lDHUl"),l=i("1uHkt"),h=i("eWjiX"),c=i("e4nYk");function u(e){return parseFloat(e.toFixed(2))}function p(e){return e.map(function(e){return e.map(function(e){var t=(0,a._)(e,2),i=t[0],n=t[1];return[u(i),u(n)]})})}var d=/*#__PURE__*/function(){function e(t){(0,r._)(this,e),this.shape="rect",this.selectOperation="new",this.selectDragInputs=[],this.didMove=!1,this.klCanvas=t.klCanvas}return(0,s._)(e,[{key:"reset",value:function(){this.selection=void 0}},{key:"combineSelection",value:function(e){var t,i=null!==(t=this.selection)&&void 0!==t?t:[];if("new"===this.selectOperation)i=[e];else if(this.selection&&this.selection.length>0){var n="difference"===this.selectOperation?"difference":"union";i=(0,c.applyPolygonClipping)(n,this.selection,e)}else"union"===this.selectOperation&&(i=[e]);return i}},{key:"getSelection",value:function(){var e=this.selection||[];if(this.selectDragInputs.length>1){if(this.selectOperation,"rect"===this.shape){var t=this.selectDragInputs[0],i=this.selectDragInputs[this.selectDragInputs.length-1],n=Math.floor(Math.min(t.x,i.x)),r=Math.floor(Math.min(t.y,i.y)),s=Math.ceil(Math.max(t.x,i.x)),a=Math.ceil(Math.max(t.y,i.y));e=this.combineSelection([[[n,r],[s,r],[s,a],[n,a]]])}else if("ellipse"===this.shape){var o=this.selectDragInputs[0],h=this.selectDragInputs[this.selectDragInputs.length-1],c=(o.x+h.x)/2,d=(o.y+h.y)/2,g=Math.abs(h.x-o.x)/2,f=Math.abs(h.y-o.y)/2;e=this.combineSelection(p((0,l.getEllipsePath)(c,d,g,f,50)))}else"lasso"===this.shape&&(e=this.combineSelection([this.selectDragInputs.map(function(e){return[u(e.x),u(e.y)]})]))}return 0===e.length?void 0:e}},{key:"startSelect",value:function(e,t){this.selectOperation=t,"new"===this.selectOperation&&this.reset(),this.selectDragInputs=[e]}},{key:"goSelect",value:function(e){this.selectDragInputs.push({x:e.x,y:e.y})}},{key:"endSelect",value:function(){this.selectDragInputs.length>1?this.selection=this.getSelection():this.reset(),this.selectDragInputs=[]}},{key:"addPoly",value:function(e,t){this.selectOperation=t,this.selection=this.combineSelection([e.map(function(e){return[u(e.x),u(e.y)]})])}},{key:"startMoveSelect",value:function(e){this.moveLastPos=e,this.didMove=!1}},{key:"goMoveSelect",value:function(e){if(this.moveLastPos){this.didMove=!0;var t=Math.round(e.x-this.moveLastPos.x),i=Math.round(e.y-this.moveLastPos.y);this.selection&&(this.selection=(0,o.translateMultiPolygon)(this.selection,t,i)),this.moveLastPos={x:this.moveLastPos.x+t,y:this.moveLastPos.y+i}}}},{key:"endMoveSelect",value:function(){this.moveLastPos=void 0}},{key:"getDidMove",value:function(){return this.didMove}},{key:"selectAll",value:function(){this.reset();var e=this.klCanvas.getWidth(),t=this.klCanvas.getHeight();this.selection=[[[[0,0],[e,0],[e,t],[0,t],[0,0]]]]}},{key:"invertSelection",value:function(){var e,t=null!==(e=this.selection)&&void 0!==e?e:[],i=this.klCanvas.getWidth(),n=this.klCanvas.getHeight();this.selection=(0,c.applyPolygonClipping)("difference",[[[0,0],[i,0],[i,n],[0,n]]],t)}},{key:"setShape",value:function(e){this.shape=e}},{key:"getShape",value:function(){return this.shape}},{key:"setSelection",value:function(e){this.selection=e?(0,h.BB).copyObj(e).map(p):void 0}}]),e}()}),n("lDHUl",function(t,i){e(t.exports,"translateMultiPolygon",function(){return n});function n(e,t,i){return e.map(function(e){return e.map(function(e){return e.map(function(e){return[e[0]+t,e[1]+i]})})})}}),n("1uHkt",function(t,i){e(t.exports,"getEllipsePath",function(){return n});function n(e,t,i,n,r){for(var s=[],a=2*Math.PI/r,o=0;o<2*Math.PI;o+=a)s.push([Math.cos(o)*i+e,Math.sin(o)*n+t]);return[s]}}),n("k5Z00",function(t,n){e(t.exports,"SelectTransformTool",function(){return C});var r=i("cx0mh"),s=i("7h4XF"),a=i("cL71g"),o=i("4EWN2"),l=i("8N5YG"),h=i("bX4ja"),c=i("9b3eo");i("ciAU9");var u=i("cdZRx"),p=i("dZ59l"),d=i("gvDD3"),g=i("83Kse"),f=i("1RMPr"),v=i("kFecW"),m=i("kr2fR"),y=i("bbA6w"),x=i("g03EN"),b=i("eWjiX"),B=i("lt7cS"),w=i("eg83P"),k=i("fzzhO"),C=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.selection=[],this.selectionBounds={},this.transform={},this.doClone=!1}return(0,s._)(e,[{key:"setSelection",value:function(e){this.selection=e,this.selectionBounds=(0,w.integerBounds)((0,x.getMultiPolyBounds)(this.selection)),this.transform=(0,g.identity)()}},{key:"isTransformationChanged",value:function(){for(var e=(0,g.identity)(),t=Object.keys(e),i=0;i<t.length;i++){var n=t[i];if(e[n]!==this.transform[n])return!0}return!1}},{key:"reset",value:function(){this.transform=(0,g.identity)(),this.selection=[],this.selectionBounds={x1:0,y1:0,x2:0,y2:0}}},{key:"translate",value:function(e){this.transform=(0,p.compose)((0,m.translate)(e.x,e.y),this.transform)}},{key:"flip",value:function(e){var t={x:(this.selectionBounds.x1+this.selectionBounds.x2)/2,y:(this.selectionBounds.y1+this.selectionBounds.y2)/2},i=(0,u.applyToPoint)(this.transform,t);this.transform=(0,p.compose)((0,m.translate)(i.x,i.y),(0,v.scale)("x"===e?-1:1,"y"===e?-1:1),(0,m.translate)(-i.x,-i.y),this.transform)}},{key:"rotateDeg",value:function(e){var t={x:(this.selectionBounds.x1+this.selectionBounds.x2)/2,y:(this.selectionBounds.y1+this.selectionBounds.y2)/2},i=(0,u.applyToPoint)(this.transform,t);this.transform=(0,p.compose)((0,m.translate)(i.x,i.y),(0,f.rotate)(e/180*Math.PI),(0,m.translate)(-i.x,-i.y),this.transform)}},{key:"setDoClone",value:function(e){this.doClone=e}},{key:"getDoClone",value:function(){return this.doClone}},{key:"getTransform",value:function(){var e,t,i,n,r,s,h,c,g,y,x,w,k,C,S,E,L,A,I,T,P,R,M=(e=this.transform,i={x:(t=this.selectionBounds).x1+(t.x2-t.x1)/2,y:t.y1+(t.y2-t.y1)/2},n=(0,u.applyToPoint)(e,i),r=(0,d.decomposeTSR)(e),s=(0,b.BB).round(r.rotation.angle/Math.PI*180,7),h={x:t.x1,y:t.y1},c={x:t.x2,y:t.y1},g={x:t.x1,y:t.y2},x=(y=(0,l._)([h,c,g].map(function(t){return(0,u.applyToPoint)(e,t)}),3))[0],w=y[1],k=y[2],C=(0,b.BB).Vec2.dist(w,x),S=(0,b.BB).Vec2.dist(k,x),r.scale.sx<0&&(C=-C),r.scale.sy<0&&(S=-S),(0,o._)((0,a._)({},n),{width:C,height:S,angleDeg:s}));return(0,B.snapToPixel)(M),L={x:(E=this.selectionBounds).x1+(E.x2-E.x1)/2,y:E.y1+(E.y2-E.y1)/2},A=E.x2-E.x1,I=E.y2-E.y1,T=M.width/A,P=M.height/I,R=M.angleDeg/180*Math.PI,(0,p.compose)((0,m.translate)(M.x,M.y),(0,f.rotate)(R),(0,v.scale)(T,P),(0,m.translate)(-L.x,-L.y))}},{key:"setTransform",value:function(e){this.transform=e}},{key:"getTransformedSelection",value:function(){return(0,y.transformMultiPolygon)(this.selection,this.getTransform())}},{key:"setSelectionSample",value:function(e){this.selectionSample=e}},{key:"createComposite",value:function(e){var t=this,i=(0,c.getSelectionPath2d)(this.selection),n=this.getTransform();return{draw:function(r){if(r.save(),t.selectionSample&&t.doClone){if(t.selectionSample.image){r.setTransform.apply(r,(0,h._)((0,k.matrixToTuple)(n))),r.clip(i);var s=(0,p.compose)(n,t.selectionSample.transformation);r.setTransform.apply(r,(0,h._)((0,k.matrixToTuple)(s))),r.drawImage(t.selectionSample.image,0,0)}}else t.doClone||(r.save(),r.clip(i),r.clearRect(0,0,e.width,e.height),r.restore()),r.setTransform.apply(r,(0,h._)((0,k.matrixToTuple)(n))),r.clip(i),r.drawImage(e,0,0);r.restore()}}}},{key:"createSourceComposite",value:function(e){var t=(0,c.getSelectionPath2d)(this.selection);if(!this.doClone)return{draw:function(i){i.save(),i.clip(t),i.clearRect(0,0,e.width,e.height),i.restore()}}}},{key:"createTargetComposite",value:function(e){var t=this,i=(0,c.getSelectionPath2d)(this.selection),n=this.getTransform();return{draw:function(r){if(r.save(),t.selectionSample&&t.doClone){if(t.selectionSample.image){r.setTransform.apply(r,(0,h._)((0,k.matrixToTuple)(n))),r.clip(i);var s=(0,p.compose)(n,t.selectionSample.transformation);r.setTransform.apply(r,(0,h._)((0,k.matrixToTuple)(s))),r.drawImage(t.selectionSample.image,0,0)}}else r.setTransform.apply(r,(0,h._)((0,k.matrixToTuple)(n))),r.clip(i),r.drawImage(e,0,0);r.restore()}}}}]),e}()}),n("age0w",function(t,n){e(t.exports,"KlTempHistory",function(){return a});var r=i("cx0mh"),s=i("7h4XF"),a=/*#__PURE__*/function(){function e(){(0,r._)(this,e),this.entries=[],this.currentIndex=-1,this.listeners=[],this.isActive=!1}return(0,s._)(e,[{key:"emit",value:function(e){this.listeners.forEach(function(t){return t(e)})}},{key:"push",value:function(e){var t=this;this.currentIndex<this.entries.length-1&&this.entries.splice(this.currentIndex+1),this.entries.push(e),this.currentIndex=this.entries.length-1,setTimeout(function(){return t.emit("push")})}},{key:"replaceTop",value:function(e){var t=this;this.entries.splice(this.currentIndex),this.entries.push(e),this.currentIndex=this.entries.length-1,setTimeout(function(){return t.emit("push")})}},{key:"canDecreaseIndex",value:function(){return this.currentIndex>-1}},{key:"canIncreaseIndex",value:function(){return this.currentIndex<this.entries.length-1}},{key:"decreaseIndex",value:function(){var e=this;this.canDecreaseIndex()&&(this.currentIndex--,setTimeout(function(){return e.emit("decrease")}))}},{key:"increaseIndex",value:function(){var e=this;this.canIncreaseIndex()&&(this.currentIndex++,setTimeout(function(){return e.emit("increase")}))}},{key:"getEntries",value:function(){return this.entries.slice(0,this.currentIndex+1)}},{key:"clear",value:function(){var e=this;this.entries=[],this.currentIndex=-1,setTimeout(function(){return e.emit("clear")})}},{key:"addListener",value:function(e){this.listeners.includes(e)||this.listeners.push(e)}},{key:"removeListener",value:function(e){var t=this;this.listeners.map(function(i,n){i===e&&t.listeners.splice(n,1)})}},{key:"setIsActive",value:function(e){this.isActive!==e&&(this.isActive=e,this.emit("active"))}},{key:"getIsActive",value:function(){return this.isActive}}]),e}()}),n("c3rQS",function(t,n){e(t.exports,"KlHistoryExecutor",function(){return u});var r=i("cx0mh"),s=i("7h4XF"),a=i("8N5YG"),o=i("bX4ja"),l=i("hrnUX"),h=i("7jh4K");function c(e,t,i,n,r,s){if("brush"===e.tool[0]){var c=n[e.tool[1]];e.actions.forEach(function(e){c[e.action].apply(c,(0,o._)(e.params))})}else if("canvas"===e.tool[0]){var u=e.params,p=i[e.action].apply(i,(0,o._)(u));if("number"==typeof p){t=p;var d=(0,h.throwIfNull)(i.getLayerContext(t));r(d),Object.entries(n).forEach(function(e){return(0,a._)(e,2)[1].setContext(d)})}}else if("filter"===e.tool[0]){var g,f=[{context:s(),klCanvas:i,input:e.params[0].input}];(g=(0,l.KL).filterLib[e.tool[1]])[e.action].apply(g,(0,o._)(f))}else if("misc"===e.tool[0]&&"focusLayer"===e.action){t=e.params[0];var v=(0,h.throwIfNull)(i.getLayerContext(t));r(v),Object.entries(n).forEach(function(e){return(0,a._)(e,2)[1].setContext(v)})}else if("misc"===e.tool[0]&&"importImage"===e.action){var m=i.addLayer();if("number"==typeof m){t=m,e.params[1]&&i.renameLayer(t,e.params[1]);var y=(0,h.throwIfNull)(i.getLayerContext(t));r(y),Object.entries(n).forEach(function(e){return(0,a._)(e,2)[1].setContext(y)})}s().drawImage(e.params[0],0,0)}return t}var u=/*#__PURE__*/function(){function e(t){var i=this;(0,r._)(this,e),this.doIgnore=!1,this.lastCanUndo=!1,this.lastCanRedo=!1,this.history=t.history,this.tempHistory=t.tempHistory,this.brushUiMap=t.brushUiMap,this.getOldestProjectState=t.getOldestProjectState,this.klCanvas=t.klCanvas,this.getCurrentLayerCtx=t.getCurrentLayerCtx,this.setCurrentLayerCtx=t.setCurrentLayerCtx,this.onExecuted=t.onExecuted,this.onCanUndoRedoChange=t.onCanUndoRedoChange,this.history.addListener(function(e){i.updateOldestAppState(e),i.emitOnUndoRedoChange()}),this.tempHistory.addListener(function(){i.emitOnUndoRedoChange()})}return(0,s._)(e,[{key:"shouldIgnoreTest",value:function(){var e=this;return!!this.doIgnore||(this.doIgnore=!0,setTimeout(function(){e.doIgnore=!1},0),!1)}},{key:"emitOnUndoRedoChange",value:function(){var e=this.canUndo(),t=this.canRedo();(this.lastCanUndo!==e||this.lastCanRedo!==t)&&(this.lastCanUndo=e,this.lastCanRedo=t,this.onCanUndoRedoChange(e,t))}},{key:"undo",value:function(){var e=this;if(this.shouldIgnoreTest())return!1;if(this.tempHistory.getIsActive()&&this.tempHistory.canDecreaseIndex())return this.tempHistory.decreaseIndex(),this.onExecuted(!1,"tempUndo"),this.emitOnUndoRedoChange(),!0;if(!this.history.canUndo())return!1;var t=this.history.decreaseCurrentIndex();this.history.pause(!0);var i=this.getOldestProjectState(),n={w:this.klCanvas.getWidth(),h:this.klCanvas.getHeight()};this.klCanvas.copy(i.canvas);var r=i.focus;this.setCurrentLayerCtx((0,h.throwIfNull)(this.klCanvas.getLayerContext(r)));var s={};return Object.entries(l.KL.brushes).forEach(function(t){var i=(0,a._)(t,2),n=i[0],r=i[1];s[n]=new r,s[n].setContext(e.getCurrentLayerCtx())}),s.SketchyBrush.setSeed(i.brushes.SketchyBrush.getSeed()),t.forEach(function(t){r=c(t,r,e.klCanvas,s,function(t){return e.setCurrentLayerCtx(t)},function(){return e.getCurrentLayerCtx()})}),this.brushUiMap.sketchyBrush.setSeed(s.SketchyBrush.getSeed()),this.history.pause(!1),this.onExecuted(n.w!==this.klCanvas.getWidth()||n.h!==this.klCanvas.getHeight(),"undo"),!0}},{key:"redo",value:function(){var e=this;if(this.shouldIgnoreTest())return!1;if(this.tempHistory.getIsActive()&&this.tempHistory.canIncreaseIndex())return this.tempHistory.increaseIndex(),this.emitOnUndoRedoChange(),this.onExecuted(!1,"tempRedo"),!0;if(!this.history.canRedo())return!1;var t=this.history.increaseCurrentIndex();if(0===t.length)return setTimeout(function(){throw Error("redo failed. redo entry undefined")}),!1;this.history.pause(!0);var i={w:this.klCanvas.getWidth(),h:this.klCanvas.getHeight()},n={};return Object.entries(l.KL.brushes).forEach(function(t){var i=(0,a._)(t,2),r=i[0],s=i[1];n[r]=new s,n[r].setContext(e.getCurrentLayerCtx())}),n.SketchyBrush.setSeed(this.brushUiMap.sketchyBrush.getSeed()),t.forEach(function(t){c(t,0,e.klCanvas,n,function(t){return e.setCurrentLayerCtx(t)},function(){return e.getCurrentLayerCtx()})}),this.brushUiMap.sketchyBrush.setSeed(n.SketchyBrush.getSeed()),this.history.pause(!1),this.onExecuted(i.w!==this.klCanvas.getWidth()||i.h!==this.klCanvas.getHeight(),"redo"),!0}},{key:"updateOldestAppState",value:function(e){if(e&&e.bufferUpdate){var t=this.getOldestProjectState(),i=(0,h.throwIfNull)(t.canvas.getLayerContext(t.focus));t.focus=c(e.bufferUpdate,t.focus,t.canvas,t.brushes,function(e){i=e},function(){return i})}}},{key:"canUndo",value:function(){return this.tempHistory.getIsActive()&&this.tempHistory.canDecreaseIndex()||this.history.canUndo()}},{key:"canRedo",value:function(){return this.tempHistory.getIsActive()?this.tempHistory.canIncreaseIndex():this.history.canRedo()}}]),e}()}),n("bB2ML",function(t,n){e(t.exports,"PinchZoomWatcher",function(){return a});var r=i("cx0mh"),s=i("eWjiX"),a=function e(){(0,r._)(this,e);var t=function(){if(!n){var e=(0,s.BB).el({parent:document.body,css:{position:"fixed",inset:"0",zIndex:"-1"}}),t=e.getBoundingClientRect();e.remove();var r=(i.width!==Math.round(t.width)||i.height!==Math.round(t.height))&&i.scale>1;r?((0,s.BB).css(a,{left:i.offsetLeft+"px",top:i.offsetTop+"px",width:i.width+"px",height:i.height+"px"}),l||(document.body.append(o),document.body.append(a))):l&&(o.remove(),a.remove()),l=r}};if("visualViewport"in window&&null!==visualViewport){var i=visualViewport,n=!1,a=(0,s.BB).el({content:"Double-tap or pinch-out to reset browser zoom.",className:"kl-pinch-overlay",css:{position:"fixed",pointerEvents:"none",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"100",flexDirection:"column",gap:"10px",padding:"10px"}});(0,s.BB).el({parent:a,tagName:"button",content:"Ignore",onClick:function(){n=!0,o.remove(),a.remove()},css:{pointerEvents:"initial"}});var o=(0,s.BB).el({tagName:"iframe",css:{position:"fixed",width:"100vw",height:"100vh",zIndex:"99",opacity:"0"}}),l=!1;i.addEventListener("resize",t),i.addEventListener("scroll",t),setTimeout(t)}}})}();
//# sourceMappingURL=main-embed.3f8baca9.js.map
